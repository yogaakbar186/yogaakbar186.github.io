// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
/*
 Chen, Yi-Cyuan 2015-2017
 @license MIT
 Cropper.js v1.5.1
 https://fengyuanchen.github.io/cropperjs

 Copyright 2015-present Chen Fengyuan
 Released under the MIT license

 Date: 2019-03-10T09:55:53.729Z
 inherited ||
        // if it is inherited, we need to check to make sure there isn't an existing property */
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./dijit/AGOLLoading ./portalUrlUtils ./portalUtils esri/config esri/tasks/GeometryService".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f){function h(u,t){var z=q.clone(u),x=l.widgetProperties;"undefined"===typeof t&&(t=!1);delete z.mode;delete z.configWabVersion;
l.visitElement(z,function(y,D){y.widgets?(delete y.isOnScreen,delete y.gid,"jimu.js/images/group_icon.png"===y.icon&&delete y.icon,delete y.openType,D.isOnScreen&&y.panel&&l.isEqual(y.panel,z.widgetOnScreen.panel)&&delete y.panel):(D=y.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion,y.icon&&y.icon===D&&delete y.icon,delete y.panel,delete y.folderUrl,delete y.amdFolder,delete y.thumbnail,delete y.configFile,delete y.gid,delete y.isOnScreen,delete y.isRemote,delete y.featureActions,x.forEach(function(H){delete y[H]}),
t?"undefined"===typeof y.openAtStart&&(y.openAtStart=!1):(y.visible&&delete y.visible,y.manifest&&y.label===y.manifest.label&&delete y.label,y.isDefaultConfig&&(delete y.config,delete y.isDefaultConfig)),delete y.manifest,y.itemId&&delete y.uri)});delete z.rawAppConfig;delete z._ssl;delete z.getConfigElementById;delete z.getConfigElementsByName;delete z.processNoUriWidgets;delete z.addElementId;delete z.getCleanConfig;delete z.visitElement;delete z.agolConfig;delete z._itemData;delete z.oldWabVersion;
delete z.titleColor;return z}var p=null;var B=E(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(u){this.urlParams=u||{};this.listenBuilderEvents();this.versionManager=new n;this.widgetManager=k.getInstance();this.configLoader=d.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&q.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(m);
"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&q.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(m);l.isMobileUa()||r(window,"resize",q.hitch(this,this._onWindowResize));r(window,"orientationchange",q.hitch(this,this._onOrientationChange))},listenBuilderEvents:function(){m.subscribe("builder/widgetChanged",q.hitch(this,this._onWidgetChanged));m.subscribe("builder/groupChanged",q.hitch(this,this._onGroupChanged));m.subscribe("builder/layoutDefinitionChanged",
q.hitch(this,this._onLayoutDefinitionChanged));m.subscribe("builder/onScreenGroupsChanged",q.hitch(this,this._onOnScreenGroupsChanged));m.subscribe("builder/widgetPoolChanged",q.hitch(this,this._onWidgetPoolChanged));m.subscribe("builder/openAtStartChange",q.hitch(this,this._onOpenAtStartChanged));m.subscribe("builder/onScreenOrderChanged",q.hitch(this,this._onScreenOrderChanged));m.subscribe("builder/mapContentModified",q.hitch(this,this._onMapContentModified));m.subscribe("builder/mapChanged",q.hitch(this,
this._onMapChanged));m.subscribe("builder/mapOptionsChanged",q.hitch(this,this._onMapOptionsChanged));m.subscribe("builder/mapRefreshIntervalChanged",q.hitch(this,this._onMapRefreshIntervalChanged));m.subscribe("builder/appAttributeChanged",q.hitch(this,this._onAppAttributeChanged));m.subscribe("builder/dataSourceChanged",q.hitch(this,this._onDataSourceChanged));m.subscribe("builder/setAppConfig",q.hitch(this,this._onAppConfigSet));m.subscribe("builder/themeChanged",q.hitch(this,this._onThemeChanged));
m.subscribe("builder/layoutChanged",q.hitch(this,this._onLayoutChanged));m.subscribe("builder/styleChanged",q.hitch(this,this._onStyleChanged));m.subscribe("builder/syncExtent",q.hitch(this,this._onSyncExtent));m.subscribe("builder/loadingPageChanged",q.hitch(this,this._onLoadingPageChanged));m.subscribe("builder/templateConfigChanged",q.hitch(this,this._onTemplateConfigChanged));m.subscribe("builder/appProxyForMapChanged",q.hitch(this,this._onAppProxyForMapChanged));m.subscribe("builder/appProxyForUrlChanged",
q.hitch(this,this._onAppProxyForUrlChanged));m.subscribe("builder/sharedThemeChanged",q.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==this.urlParams.mode&&"config"!==this.urlParams.mode){var u=new g;u.placeAt(window.jimuConfig.layoutId);return this.configLoader.loadConfig().then(q.hitch(this,function(t){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(t);console.timeEnd("Load Config");window.appInfo.isRunInMobile=l.inMobileSize();t=
this.getAppConfig();u.destroy();m.publish("appConfigLoaded",t);return t}),q.hitch(this,function(t){u.destroy();console.error(t);t&&t.message&&"string"===typeof t.message&&this._showErrorMessage(t)}))}},_showErrorMessage:function(u){if(!1===u.isSelfOrigin){w.create("div",{"class":"app-error",innerHTML:l.sanitizeHTML(u.message||u)},document.body);u=w.create("div",{"class":"app-error",innerHTML:l.sanitizeHTML(window.jimuNls.common.close)},document.body);w.setStyle(u,{"margin-top":"80px","padding-top":0,
background:"none",cursor:"pointer"});r(u,"click",q.hitch(this,function(){window.close()}));w.setStyle(u,"display","none");u=w.create("div",{"class":"app-error"},document.body);w.setStyle(u,{"margin-top":"90px","padding-top":0,background:"none"});u=w.create("div",{"class":"app-error-advanced-button",innerHTML:l.sanitizeHTML(window.jimuNls.advancedOptions)},u);w.setStyle(u,{margin:"0 auto 0 auto",color:"#666",padding:"8px 12px 8px 12px",background:"none",border:"1px solid #ccc",display:"inline-block",
"border-radius":"4px",cursor:"pointer"});r(u,"click",q.hitch(this,function(){w.setStyle(z,"display","block")}));u=window.location.href;var t=b.getStandardPortalUrl(window.location.origin);t=b.getArcgisOnlineUrl(t);u=u.replace(window.location.origin,t);u=window.jimuNls.proceedTo.replace("${value}","\x3ca href\x3d"+u+"\x3e"+u+"\x3c/a\x3e");var z=w.create("div",{"class":"app-error",innerHTML:l.sanitizeHTML(u)},document.body);w.setStyle(z,{"margin-top":"140px",display:"none","padding-top":0,background:"none"})}else w.create("div",
{"class":"app-error",innerHTML:l.sanitizeHTML(u.message||u)},document.body);w.setStyle(jimuConfig.loadingId,"display","none")},getAppConfig:function(){if(window.appInfo.isRunInMobile){var u=q.clone(this._getMobileConfig(this.appConfig));u._originConfig=q.clone(this.appConfig)}else u=q.clone(this.appConfig);u.getConfigElementById=function(t){return l.getConfigElementById(this,t)};u.getConfigElementsByName=function(t){return l.getConfigElementsByName(this,t)};u.getCleanConfig=function(t){return this._originConfig?
h(this._originConfig,t):h(this,t)};u.visitElement=function(t){l.visitElement(this,t)};return u},_onOrientationChange:function(){this.appConfig&&m.publish("appConfigChanged",this.getAppConfig(),"layoutChange")},_onWindowResize:function(){var u=l.inMobileSize();window.appInfo.isRunInMobile!==u&&(window.appInfo.isRunInMobile=u,this.appConfig&&m.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_getMobileConfig:function(u){return l.mixinAppConfigPosition(u,u.mobileLayout)},_updateDataSourceForWidget:function(u){this._deleteDataSourcesFromWidget(u);
this._addDataSourcesForWidget(u)},_deleteDataSourcesFromWidget:function(u){for(var t in this.appConfig.dataSource.dataSources)t.startWith("widget~"+u.id+"~")&&delete this.appConfig.dataSource.dataSources[t]},_addDataSourcesForWidget:function(u){A.forEach(u.provideDataSources,function(t){var z="widget~"+u.id+"~"+t.id;t.id=z;this.appConfig.dataSource.dataSources[z]=t},this);delete u.provideDataSources},_addIdForWidgets:function(u){var t=0,z;this.getAppConfig().visitElement(function(x){if(x.id){x.id=
x.id.replace(/\//g,"_");var y=x.id.lastIndexOf("_");-1<y&&(z=x.id.substr(y+1),t=Math.max(t,z))}});A.forEach(u,function(x){x.id||(t++,x.id=x.itemId?x.itemId+"_"+t:x.uri?x.uri.replace(/\//g,"_")+"_"+t:"_"+t)})},_onWidgetChanged:function(u){var t=l.reCreateObject(u);u=l.getConfigElementById(this.appConfig,u.id);this._updateDataSourceForWidget(t);!1!==t.inPanel||u.uri||(t.closeable=!0);for(var z in t)u[z]=t[z];delete u.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
m.publish("appConfigChanged",this.getAppConfig(),"widgetChange",t)},_onGroupChanged:function(u){var t=l.reCreateObject(u);u=l.getConfigElementById(this.appConfig,u.id);this._handleDataSourceForWidgets(u,t);for(var z in t)u[z]=t[z];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);m.publish("appConfigChanged",this.getAppConfig(),"groupChange",t)},_handleDataSourceForWidgets:function(u,t){var z=A.filter(t.widgets,function(x){return x.id?0===A.filter(u.widgets,function(y){return x.id===
y.id}).length:!0},this);this._addIdForWidgets(z);A.forEach(z,function(x){this._addDataSourcesForWidget(x)},this);z=A.filter(u.widgets,function(x){return 0===A.filter(t.widgets,function(y){return y.id===x.id}).length},this);A.forEach(z,function(x){this._deleteDataSourcesFromWidget(x)},this);A.forEach(t.widgets,function(x){A.forEach(u.widgets,function(y){x.id===y.id&&x.provideDataSources&&this._updateDataSourceForWidget(x)},this)},this)},_onWidgetPoolChanged:function(u){var t=l.reCreateObject(u);this._handleDataSourceForWidgetsSection(this.appConfig.widgetPool,
t);1===this.widgetManager.getControllerWidgets().length?(this.appConfig.widgetPool.widgets=t.widgets,this.appConfig.widgetPool.groups=t.groups):(u=l.getConfigElementById(this.appConfig,t.controllerId),A.forEach(u.controlledWidgets,function(z){this._removeWidgetOrGroupFromPoolById(this.appConfig,z)},this),A.forEach(u.controlledGroups,function(z){this._removeWidgetOrGroupFromPoolById(this.appConfig,z)},this),this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?t.widgets:
this.appConfig.widgetPool.widgets.concat(t.widgets),this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?t.groups:this.appConfig.widgetPool.groups.concat(t.groups),u.controlledWidgets=A.map(t.widgets,function(z){return z.id}),u.controlledGroups=A.map(t.groups,function(z){return z.id}));this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(q.hitch(this,function(z){this.appConfig=z;this._addDefaultValues(this.appConfig);
m.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",t)}))},_handleDataSourceForWidgetsSection:function(u,t){var z=t.widgets;A.forEach(t.groups,function(y){z=z.concat(y.widgets)},this);var x=u.widgets;A.forEach(u.groups,function(y){x=x.concat(y.widgets)},this);this._handleDataSourceForWidgets({widgets:x},{widgets:z})},_removeWidgetOrGroupFromPoolById:function(u,t){A.some(u.widgetPool.widgets,function(z,x){if(z.id===t)return u.widgetPool.widgets.splice(x,1),!0});A.some(u.widgetPool.groups,
function(z,x){if(z.id===t)return u.widgetPool.groups.splice(x,1),!0})},_onOpenAtStartChanged:function(u){var t=l.reCreateObject(u),z=this.appConfig;u.isOnScreen?(z=z.widgetOnScreen&&z.widgetOnScreen.widgets)&&0<z.length&&A.forEach(z,q.hitch(this,function(x){x.id===u.id?x.openAtStart=!x.openAtStart:delete x.openAtStart})):((z=z.widgetPool)&&z.groups&&0<z.groups.length&&A.forEach(z.groups,q.hitch(this,function(x){x.id===u.id?x.openAtStart=!x.openAtStart:delete x.openAtStart})),z&&z.widgets&&0<z.widgets.length&&
A.forEach(z.widgets,q.hitch(this,function(x){x.id===u.id?x.openAtStart=!x.openAtStart:delete x.openAtStart})));m.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",t)},_onScreenOrderChanged:function(u){var t=l.reCreateObject(u);A.forEach(this.appConfig.widgetOnScreen.widgets,function(z){z.isController||(!1!==z.inPanel||!0!==z.closeable)&&!0!==z.inPanel&&z.uri||A.some(t,function(x){if(z.id===x.id)return z.position=x.position,!0})},this);m.publish("appConfigChanged",this.getAppConfig(),
"onScreenOrderChange",t)},_onAppAttributeChanged:function(u){u=l.reCreateObject(u);q.mixin(this.appConfig,u);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);m.publish("appConfigChanged",this.getAppConfig(),"attributeChange",u)},_onDataSourceChanged:function(u){var t=l.reCreateObject(u);this.appConfig.dataSource=t;m.publish("appConfigChanged",this.getAppConfig(),"dataSourceChange",u)},_onLoadingPageChanged:function(u){u=
l.reCreateObject(u);if("backgroundColor"in u)this.appConfig.loadingPage.backgroundColor=u.backgroundColor;else if("backgroundImage"in u){var t=this.appConfig.loadingPage.backgroundImage||{};this.appConfig.loadingPage.backgroundImage=q.mixin(t,u.backgroundImage)}else"loadingGif"in u&&(t=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=q.mixin(t,u.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);m.publish("appConfigChanged",
this.getAppConfig(),"loadingPageChange",u)},_onAppProxyForMapChanged:function(u){u=l.reCreateObject(u);"appProxy"in this.appConfig.map?this.appConfig.map.appProxy.mapItemId!==u.mapItemId?this.appConfig.map.appProxy=u:A.forEach(u.proxyItems,q.hitch(this,function(t){if(!A.some(this.appConfig.map.appProxy.proxyItems,function(x){if(x.sourceUrl===t.sourceUrl)return x.useProxy=t.useProxy,x.proxyUrl=t.proxyUrl||"",x.proxyId=t.proxyId||"",isNaN(t.hitsPerInterval)||(x.hitsPerInterval=t.hitsPerInterval),isNaN(t.intervalSeconds)||
(x.intervalSeconds=t.intervalSeconds),!0})&&t.useProxy&&t.proxyUrl){var z=this.appConfig.map.appProxy.proxyItems||[];z.push(t);this.appConfig.map.appProxy.proxyItems=z}})):this.appConfig.map.appProxy=u;m.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",u)},_onAppProxyForUrlChanged:function(u){u=l.reCreateObject(u);this.appConfig.appProxies=u;m.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",u)},_onTemplateConfigChanged:function(u){u=l.reCreateObject(u);this.appConfig.templateConfig=
u;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);m.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",u)},_onMapContentModified:function(){m.publish("mapContentModified")},_onMapChanged:function(u){var t=l.reCreateObject(u);this.appConfig.map.mapOptions&&l.deleteMapOptions(this.appConfig.map.mapOptions);this.appConfig.map.mapRefreshInterval={useWebMapRefreshInterval:!0};q.mixin(this.appConfig.map,t);this._deleteDataSourcesFromMap();this.configLoader.addNeedValues(this.appConfig);
this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(q.hitch(this,function(z){this.appConfig=z;this._addDefaultValues(this.appConfig);m.publish("appConfigChanged",this.getAppConfig(),"mapChange",t)}))},_deleteDataSourcesFromMap:function(){A.forEach(Object.keys(this.appConfig.dataSource.dataSources),function(u){u.startWith("map")&&delete this.appConfig.dataSource.dataSources[u]},this)},_onMapOptionsChanged:function(u){u=l.reCreateObject(u);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions=
{});q.mixin(this.appConfig.map.mapOptions,u);m.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",u)},_onMapRefreshIntervalChanged:function(u){u=l.reCreateObject(u);this.appConfig.map.mapRefreshInterval||(this.appConfig.map.mapRefreshInterval={});q.mixin(this.appConfig.map.mapRefreshInterval,u);this.appConfig.map.mapRefreshInterval.useWebMapRefreshInterval&&delete this.appConfig.map.mapRefreshInterval.minutes;m.publish("appConfigChanged",this.getAppConfig(),"mapRefreshIntervalChange",
u)},_onThemeChanged:function(u){this._getAppConfigFromTheme(u).then(q.hitch(this,function(t){var z=q.clone(this.appConfig.widgetOnScreen);this.appConfig=t;this._handleDataSourceForWidgetsSection(z,{});m.publish("appConfigChanged",this.getAppConfig(),"themeChange",u.getName())}))},_onLayoutChanged:function(u){this.appConfig=l.mixinAppConfigPosition(this.appConfig,u.layoutConfig);this.appConfig.layoutDefinition=u.layoutConfig.layoutDefinition;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
m.publish("appConfigChanged",this.getAppConfig(),"layoutChange",u.name)},_onStyleChanged:function(u){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,u.name);u.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:u.styleColor}:(delete this.appConfig.theme.customStyles,delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme={isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});m.publish("appConfigChanged",this.getAppConfig(),
"styleChange",u.name)},_onOnScreenGroupsChanged:function(u){u=l.reCreateObject(u);this.appConfig.widgetOnScreen.groups=u.groups;m.publish("appConfigChanged",this.getAppConfig(),"onScreenGroupsChange",u.groups)},_onLayoutDefinitionChanged:function(u){u=l.reCreateObject(u);l.isEqual(this.appConfig.layoutDefinition,u.layoutDefinition)||(this.appConfig.layoutDefinition=u.layoutDefinition,this.appConfig.widgetOnScreen.groups=l.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,u.groupIds),
this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),m.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",u.layoutDefinition))},_onSharedThemeChanged:function(u){var t=this.appConfig.theme.sharedTheme;u=l.reCreateObject(u);u.useHeader&&!t.useHeader&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},
this.appConfig.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));!u.useHeader&&t.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));u.useLogo&&!t.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo&&
this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));!u.useLogo&&t.useLogo&&this._onAppAttributeChanged({logo:this.appConfig.logo});q.mixin(t,u);m.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",
u)},_onSyncExtent:function(u){m.publish("syncExtent",u)},_genStyles:function(u,t){var z=[];z.push(t);A.forEach(u,function(x){0>z.indexOf(x)&&z.push(x)});return z},_getAppConfigFromTheme:function(u){var t=new v,z=[],x=this.getAppConfig().getCleanConfig();x.mode=this.urlParams.mode;A.forEach(x.widgetPool.groups,function(H){delete H.panel},this);if(u.appConfig){var y=q.clone(u.appConfig);y.map=x.map;y.map.position=u.appConfig.map.position;this._copyPoolToThemePool(x,y);y.links=x.links;y.title=x.title;
y.subtitle=x.subtitle;y.logo=x.logo}else{var D=u.getCurrentLayout();z=u.getCurrentStyle();y=q.clone(x);D=q.clone(D.layoutConfig);y.widgetOnScreen=D.widgetOnScreen;D.widgetPool&&(A.forEach(D.widgetPool.widgets,function(H){H.isPreconfiguredInTheme=!0}),A.forEach(D.widgetPool.groups,function(H){H.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(x,D);y.widgetPool=D.widgetPool;D.map&&D.map.position&&(y.map.position=D.map.position);y.mobileLayout=D.mobileLayout;y.layoutDefinition=D.layoutDefinition;
z=this._genStyles(A.map(u.getStyles(),function(H){return H.name}),z.name);y.theme={name:u.getName(),styles:z,version:u.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(y.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},y.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):(y.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},y.theme.customStyles={mainBackgroundColor:""});y.titleColor=
x.titleColor;y.logoLink=x.logoLink}this.configLoader.addNeedValues(y);this.configLoader.loadWidgetsManifest(y).then(q.hitch(this,function(H){return this.configLoader.loadAndUpgradeAllWidgetsConfig(H)})).then(q.hitch(this,function(){this._addDefaultValues(y);t.resolve(y)}));return t},_copyPoolToThemePool:function(u,t){var z=u.widgetPool;t.widgetPool||(t.widgetPool={});u=t.widgetPool;var x=A.filter(u.widgets,function(I){if(I.isPreconfiguredInTheme||!A.some(z.widgets,function(N){return N.name===I.name}))return!0}),
y=A.filter(u.groups,function(I){return I.isPreconfiguredInTheme}),D=A.filter(z.widgets,function(I){return!I.isPreconfiguredInTheme}),H=A.filter(z.groups,function(I){return!I.isPreconfiguredInTheme});D=this._getPoolWidgetsWithoutDuplicated(D,t.widgetOnScreen.widgets||[]);u.widgets=D.concat(x);u.groups=H.concat(y)},_getPoolWidgetsWithoutDuplicated:function(u,t){for(var z=q.clone(u),x=this.getAppConfig(),y=u.length-1;0<=y;y--)for(var D=t.length-1;0<=D;D--)if(t[D].uri){var H=t[D].name;H||(H=l.getWidgetNameFromUri(t[D].uri));
var I=x.getConfigElementById(u[y].id);u[y]&&u[y].name===H&&!1===I.supportMultiInstance&&(console.log("Widget",u[y].name,"is not copied to new theme because this widget exists in new theme."),z.splice(y,1))}return z},_onAppConfigSet:function(u){u=l.reCreateObject(u);window.appInfo.isRunInMobile=l.inMobileSize();this.configLoader.processProxy(u);this.configLoader.addNeedValues(u);this.configLoader.loadAndUpgradeAllWidgetsConfig(u).then(q.hitch(this,function(t){this._addDefaultValues(t);c.setPortalUrl(t.portalUrl);
window.portalUrl=t.portalUrl;this.appConfig?(l.deleteMapOptions(t.map.mapOptions),this.appConfig=t,this._deleteDataSourcesFromMap(),m.publish("appConfigChanged",this.getAppConfig(),"resetConfig",t)):(this.appConfig=t,e.getPortal(t.portalUrl).loadSelfInfo().then(q.hitch(this,function(z){this.portalSelf=z;m.publish("appConfigLoaded",this.getAppConfig())})));t=c.getPortalCredential(window.portalUrl);window.postMessageToSw({type:"to_sw_credential",credential:t.toJson()})}))},_addDefaultValues:function(u){this._addDefaultPortalUrl(u);
this._addDefaultGeometryService(u);this._addDefaultStyle(u);this._addDefaultMap(u);this._addDefaultVisible(u);this._addDefaultDataSource(u);this._addDefaultSharedTheme(u);"undefined"===typeof u.widgetOnScreen&&(u.widgetOnScreen={});"undefined"===typeof u.widgetPool&&(u.widgetPool={});this._addDefaultPanelAndPosition(u);this._addDefaultOfWidgetGroup(u);(u.widgetPool.widgets&&0<u.widgetPool.widgets.length&&void 0===u.widgetPool.widgets[0].index||u.widgetPool.groups&&0<u.widgetPool.groups.length&&void 0===
u.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(u);return u},_addDefaultDataSource:function(u){u.dataSource?(u.dataSource.dataSources||(u.dataSource.dataSources={}),u.dataSource.settings||(u.dataSource.settings={})):u.dataSource={dataSources:{},settings:{}}},_addDefaultPortalUrl:function(u){"undefined"===typeof u.portalUrl&&(u.portalUrl="http://www.arcgis.com/");u.portalUrl&&"/"!==u.portalUrl.substr(u.portalUrl.length-1)&&(u.portalUrl+="/")},_addDefaultGeometryService:function(u){var t=
u&&u.geometryService;t=t&&"string"===typeof t&&q.trim(t)?q.trim(t):this.portalSelf.helperServices.geometry.url;u.geometryService=t;a.defaults.geometryService=new f(u.geometryService)},_addDefaultStyle:function(u){!u.theme||u.theme.styles&&0!==u.theme.styles.length||(u.theme.styles=["default"])},_addDefaultMap:function(u){u.map.id="map";"undefined"===typeof u.map["3D"]&&"undefined"===typeof u.map["2D"]&&(u.map["2D"]=!0);"undefined"===typeof u.map.position&&(u.map.position={left:0,right:0,top:0,bottom:0});
"undefined"===typeof u.map.portalUrl&&(u.map.portalUrl=u.portalUrl)},_addDefaultVisible:function(u){l.visitElement(u,function(t){void 0===t.visible&&(t.visible=!0)})},_addDefaultSharedTheme:function(u){u.theme.sharedTheme?("undefined"===typeof u.theme.sharedTheme.useHeader&&(u.theme.sharedTheme.useHeader=!1),"undefined"===typeof u.theme.sharedTheme.useLogo&&(u.theme.sharedTheme.useLogo=!1)):u.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(u){this._addOnScreenDefaultPanelAndPosition(u);
this._addPoolDefaultPanelAndPosition(u)},_addOnScreenDefaultPanelAndPosition:function(u){var t;if(u=u.widgetOnScreen){var z=u.panel&&u.panel.positionRelativeTo?u.panel.positionRelativeTo:"map";"undefined"===typeof u.panel||"undefined"===typeof u.panel.uri?u.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:z}}:"undefined"===typeof u.panel.position?u.panel.position={relativeTo:z}:"undefined"===typeof u.panel.position.relativeTo&&(u.panel.position.relativeTo=z);if(u.widgets)for(z=0;z<u.widgets.length;z++)u.widgets[z].position||
(u.widgets[z].position={}),u.widgets[z].position.relativeTo||(u.widgets[z].position.relativeTo=u.widgets[z]&&u.widgets[z].positionRelativeTo?u.widgets[z].positionRelativeTo:"map"),!0!==u.widgets[z].inPanel||u.widgets[z].panel||(u.widgets[z].panel=q.clone(u.panel),u.widgets[z].panel.position=u.widgets[z].position,u.widgets[z].panel.position.relativeTo=u.widgets[z].position.relativeTo);if(u.groups)for(z=0;z<u.groups.length;z++)for(u.groups[z].panel||(u.groups[z].panel=u.panel),u.groups[z].panel&&!u.groups[z].panel.position&&
(u.groups[z].panel.position={}),u.groups[z].panel.position.relativeTo||(u.groups[z].panel.position.relativeTo=u.groups[z].panel.positionRelativeTo?u.groups[z].panel.positionRelativeTo:"map"),u.groups[z].widgets||(u.groups[z].widgets=[]),t=0;t<u.groups[z].widgets.length;t++)u.groups[z].widgets[t].panel=u.groups[z].panel}},_addPoolDefaultPanelAndPosition:function(u){var t,z=u.widgetPool;if(z){var x=z.panel&&z.panel.positionRelativeTo?z.panel.positionRelativeTo:"map";"undefined"===typeof z.panel||"undefined"===
typeof z.panel.uri?z.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:x}}:"undefined"===typeof z.panel.position?z.panel.position={relativeTo:x}:"undefined"===typeof z.panel.position.relativeTo&&(z.panel.position.relativeTo=x);if(z.groups)for(x=0;x<z.groups.length;x++)for(z.groups[x].panel?z.groups[x].panel.position.relativeTo||(z.groups[x].panel.position.relativeTo=z.groups[x].panel.positionRelativeTo?z.groups[x].panel.positionRelativeTo:"map"):z.groups[x].panel=z.panel,z.groups[x].widgets||
(z.groups[x].widgets=[]),t=0;t<z.groups[x].widgets.length;t++)z.groups[x].widgets[t].panel=z.groups[x].panel;if(z.widgets)for(x=0;x<z.widgets.length;x++)!1===z.widgets[x].inPanel?(t=z.widgets[x].positionRelativeTo?z.widgets[x].positionRelativeTo:"map",z.widgets[x].position)?z.widgets[x].position.relativeTo||(z.widgets[x].position.relativeTo=t):z.widgets[x].position={relativeTo:t}:z.widgets[x].panel||(z.widgets[x].panel=u.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(u){l.visitElement(u,q.hitch(this,
function(t,z){t.isOnScreen=z.isOnScreen;t.widgets?(t.gid=t.id,1===t.widgets.length?(t.label||(t.label=t.widgets[0].label?t.widgets[0].label:window.apiNls.common.groupLabel),t.icon||(t.icon=t.widgets[0].uri?this._getDefaultIconFromUri(t.widgets[0].uri):"jimu.js/images/group_icon.png")):(t.icon=t.icon?t.icon:"jimu.js/images/group_icon.png",t.label=t.label?t.label:window.apiNls.common.groupLabel+" "+z.index)):t.gid=z.groupId}))},_getDefaultIconFromUri:function(u){u=u.split("/");u.pop();return u.join("/")+
"/images/icon.png?wab_dv\x3d"+window.deployVersion},_addIndexForWidgetPool:function(u){var t=0,z,x;if(u.widgetPool.widgets)for(z=0;z<u.widgetPool.widgets.length;z++)u.widgetPool.widgets[z].index=t,t++;if(u.widgetPool.groups)for(z=0;z<u.widgetPool.groups.length;z++)for(u.widgetPool.groups[z].index=t,t++,x=0;x<u.widgetPool.groups[z].widgets.length;x++)u.widgetPool.groups[z].widgets[x].index=x}});B.getInstance=function(u){null===p?p=new B(u):u&&(p.urlParams=u,p.configLoader&&(p.configLoader.urlParams=
u));window.getAppConfig=q.hitch(p,p.getAppConfig);return p};return B})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/lang moment/moment esri/arcgis/utils esri/dijit/PopupTemplate esri/SpatialReference esri/geometry/Extent esri/geometry/geometryEngine esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/tasks/FeatureSet esri/symbols/PictureMarkerSymbol esri/urlUtils esri/request esri/tasks/query esri/tasks/QueryTask esri/graphicsUtils jimu/portalUrlUtils ./shared/utils ./accessibleUtils ./zoomToUtils libs/caja-html-sanitizer-minified".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u,t,z,x,y,D,H,I,N,S,M,Q,da,J,R,W,X,ia,ma,ha,xa){function ua(C,G){var L=C.match(/url\([^)]+\)/gi),P;if(null===L||""===G)return C;for(P=0;P<L.length;P++){var T=L[P].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i);if(4<=T.length){var Y=T[2];/^data:image\/.*;/.test(Y)||(G.endWith("/")||(G+="/"),C=C.replace(T[1]+Y+T[3],T[1]+G+Y+T[3]))}}return C}function na(C,G){var L=Array.isArray(G),P=L&&[]||{};L?(C=C||[],P=P.concat(C),G.forEach(function(T,Y){"undefined"===typeof C[Y]?
P[Y]=T:"object"===typeof T?P[Y]=na(C[Y],T):-1===C.indexOf(T)&&P.push(T)})):(C&&"object"===typeof C&&Object.keys(C).forEach(function(T){P[T]=C[T]}),Object.keys(G).forEach(function(T){P[T]="object"===typeof G[T]&&G[T]?C[T]?na(C[T],G[T]):G[T]:G[T]}));return P}function va(C,G){var L=C.map(function(Y){return Y.id});q.forEach(G,function(Y){0>L.indexOf(Y)&&C.push({id:Y,widgets:[]})},this);var P=[];C=q.filter(C,function(Y){return 0>G.indexOf(Y.id)?(P.push(Y),!1):!0},this);if(0===C.length)return[];var T=C[C.length-
1];q.forEach(P,function(Y){T.widgets=T.widgets.concat(Y.widgets)},this);return C=C.sort(function(Y,fa){return G.indexOf(Y.id)-G.indexOf(fa.id)})}function ra(C,G,L){function P(Y,fa){return E.isArray(Y[fa.key])?Y[fa.key][fa.index]:Y[fa.key]}G=function(Y){var fa=[];Y.split("_").forEach(function(ja){var ka=!1;"--"===ja.slice(ja.length-2)&&(ka=!0,ja=ja.slice(0,ja.length-2));var ta=ja.search(/\[[0-9]+\]/);-1===ta&&(ta=ja.length);fa.push({key:ja.slice(0,ta),index:Number(ja.slice(ta+1,-1)),deleteFlag:ka})});
return fa}(G);for(var T=1;T<G.length-1;T++)if(C=P(C,G[T]),!C)return;if(G[G.length-1].deleteFlag)!0===L&&(E.isArray(C[G[G.length-1].key])?delete C[G[G.length-1].key][G[G.length-1].index]:delete C[G[G.length-1].key]);else if(E.isArray(C[G[G.length-1].key])){if(void 0===L)return C[G[G.length-1].key][G[G.length-1].index];C[G[G.length-1].key][G[G.length-1].index]=L}else{if(void 0===L)return C[G[G.length-1].key];C[G[G.length-1].key]=L}}function wa(C,G,L){function P(ja){ja=Z.template.getSearchRange(G,ja,
"]");var ka=G.slice(ja.firstPos,ja.lastPos);return-1!==ja.firstPos?(ka=G.slice(ja.firstPos+ka.indexOf("[")+1,ja.lastPos-1),ja=G.slice(ja.lastPos+1),(ka=Z.getConfigElementById(C,ka))?{object:ka,key:"section_"+ja,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var T=C,Y=G=G.replace(/\//g,"_"),fa=P("groups\\[.+\\]");if("deleted"!==fa.state&&("isSection"===fa.state&&(T=fa.object,Y=fa.key),fa=P("widgets\\[.+\\]"),"delete"!==fa.state))return"isSection"===fa.state&&(T=fa.object,Y=fa.key),ra(T,
Y,L)}var Z={},Da={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};E.mixin(Z,ma);E.mixin(Z,ha);E.mixin(Z,xa);window.atob||(window.atob=function(C){C=f.decode(C);for(var G="",L=0,P=C.length;L<P;L++)G+=String.fromCharCode(C[L]);return G});window.btob||(window.btob=function(C){for(var G=[],L=0,P=C.length;L<P;L++)G.push(String.charCodeAt(C[L]));return f.encode(G)});var Ca=[];require.on("error",function(C){q.forEach(Ca,function(G){C.info[0]&&-1<C.info[0].indexOf(G.resKey)&&
G.def.reject(C);for(var L in C.info)-1<L.indexOf(G.resKey)&&G.def.reject(C)})});Z.checkError=function(C,G){Ca.push({resKey:C,def:G})};Z.replacePlaceHolder=function(C,G){var L=c.stringify(C),P=L.match(/\$\{(\w)+\}/g);if(null===P)return C;for(C=0;C<P.length;C++){var T=P[C].match(/(\w)+/g)[0];G[T]&&(L=L.replace(P[C],G[T]))}return c.parse(L)};Z.changeUnit=function(C){var G=Math.abs(C);C=Math.floor(G);var L=Math.floor(60*(G-C));G=(60*(60*(G-C)-L)).toFixed(2);return C+"\u00b0"+(10>L?"0"+L:L)+"'"+(10>G?
"0"+G:G)+'"'};Z.formatTime=function(C){var G=C/1E3;C=Math.floor(G/60);G=Number(G-60*C).toFixed(1);return(10>C?"0"+C:C)+":"+(10>G?"0"+G:G)};Z.parseTime=function(C){var G=/(\d{2,}):(\d{2})\.(\d{1})/;if(!G.test(C))return console.log("wrong time format."),-1;C=C.match(G);return 1E3*(60*parseInt(C[1],10)+parseInt(C[2],10)+parseInt(C[3],10)/10)};Z.preloadImg=function(C,G){var L=[];L="string"===typeof C?[C]:C;q.forEach(L,function(P){(new Image).src=G?G+P:P})};Z.setWABLogoDefaultAlt=function(C){if(C){C=r("img",
C);for(var G=["img_1412759111499","img_1545621838463","img_1560482577021"],L=0,P=C.length;L<P;L++){var T=C[L];-1<G.indexOf(A.getAttr(T,"id"))&&!A.getAttr(T,"alt")&&A.setAttr(T,"alt","ArcGIS Web AppBuilder.png")}}};var O=null;Z.getImagesSize=function(C){var G=new k;if(!C||0!==C.indexOf("http"))return G.reject(),G;null===O&&(O=A.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var L=d(O,"load",function(){clearTimeout(P);P=null;L.remove();
var T=A.getContentBox(O);1===T.w&&1===T.h||0===T.w||0===T.h?G.reject():G.resolve([T.w,T.h])},{}),P=setTimeout(function(){clearTimeout(P);P=null;G.reject()},5E3);A.setAttr(O,"src",C);return G};Z.getPositionStyle=function(C){var G={};if(!C)return G;C=E.clone(C);if(window.isRTL){if("undefined"!==typeof C.left&&"undefined"!==typeof C.right){var L=C.left;C.left=C.right;C.right=L}else"undefined"!==typeof C.left?(C.right=C.left,delete C.left):"undefined"!==typeof C.right&&(C.left=C.right,delete C.right);
"undefined"!==typeof C.paddingLeft&&"undefined"!==typeof C.paddingRight?(L=C.paddingLeft,C.paddingLeft=C.paddingRight,C.paddingRight=L):"undefined"!==typeof C.paddingLeft?(C.paddingRight=C.paddingLeft,delete C.paddingLeft):"undefined"!==typeof C.paddingRight&&(C.paddingLeft=C.paddingRight,delete C.paddingRight);"undefined"!==typeof C.marginLeft&&"undefined"!==typeof C.marginRight?(L=C.marginLeft,C.marginLeft=C.marginRight,C.marginRight=L):"undefined"!==typeof C.marginLeft?(C.marginRight=C.marginLeft,
delete C.marginLeft):"undefined"!==typeof C.marginRight&&(C.marginLeft=C.marginRight,delete C.marginRight)}L="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom margin marginLeft marginRight marginTop marginBottom".split(" ");for(var P=0;P<L.length;P++){var T=L[P];"number"===typeof C[T]?G[T]=C[T]+"px":"undefined"!==typeof C[T]?G[T]=C[T]:"padding"===T.substr(0,7)||"margin"===T.substr(0,7)?G[T]=0:G[T]="auto"}G.zIndex="undefined"===typeof C.zIndex?"auto":C.zIndex;
return G};Z.isEqual=function(C,G){function L(Y,fa){var ja;if(null===Y&&null===fa||"undefined"===typeof Y&&"undefined"===typeof fa)return!0;if(null===Y&&null!==fa||null===fa&&null!==Y||"undefined"===typeof Y&&"undefined"!==typeof fa||"undefined"===typeof fa&&"undefined"!==typeof Y)return!1;if(isNaN(Y)&&isNaN(fa)&&"number"===typeof Y&&"number"===typeof fa||Y===fa)return!0;if("function"===typeof Y&&"function"===typeof fa||Y instanceof Date&&fa instanceof Date||Y instanceof RegExp&&fa instanceof RegExp||
Y instanceof String&&fa instanceof String||Y instanceof Number&&fa instanceof Number)return Y.toString()===fa.toString();if(-1<P.indexOf(Y)||-1<T.indexOf(fa))return!1;if(null!==fa){for(ja in fa)if(fa.hasOwnProperty(ja)!==Y.hasOwnProperty(ja)||typeof fa[ja]!==typeof Y[ja])return!1;for(ja in Y){if(fa.hasOwnProperty(ja)!==Y.hasOwnProperty(ja)||typeof fa[ja]!==typeof Y[ja])return!1;switch(typeof Y[ja]){case "object":case "function":P.push(Y);T.push(fa);if(!L(Y[ja],fa[ja]))return!1;P.pop();T.pop();break;
default:if(!(isNaN(Y[ja])&&isNaN(fa[ja])&&"number"===typeof Y[ja]&&"number"===typeof fa[ja]||Y[ja]===fa[ja]))return!1}}}return!0}var P=[];var T=[];return L(C,G)?!0:!1};Z.file={loadFileAPI:function(){var C=new k;C.resolve();return C},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return w("safari")&&6>w("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var C=null;if(document.all)try{C=
new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(G){C=null}else navigator.plugins&&0<navigator.plugins.length&&(C=navigator.plugins["Shockwave Flash"]);return!!C},containSeparator:function(C){return 0<=C.indexOf("/")?!0:0<=C.indexOf("\\")?!0:!1},getNameFromPath:function(C){var G="";G=0<=C.indexOf("/")?"/":"\\";C=C.split(G);return 0<C.length?C[C.length-1]:null},getFolderFromPath:function(C){return C.substr(0,C.length-Z.file.getNameFromPath(C).length)},readFile:function(C,G,L,P){if(this.supportHTML5()){var T=
C.target.files[0];T&&(T.type.match(G)?T.size>=L?P({errCode:"exceed"}):(C=new FileReader,C.onload=function(fa){P(null,T.name,fa.target.result)},C.readAsDataURL(T)):P({errCode:"invalidType"}))}else if(this.supportFileAPI()){var Y=window.FileAPI.getFiles(C);Y[0].type.match(G)?Y[0].size>=L?P({errCode:"exceed"}):window.FileAPI.readAsDataURL(Y[0],function(fa){fa&&fa.result?P(null,Y[0].name,fa.result):P({errCode:"readError"})}):P({errCode:"invalidType"})}}};Z.getUriInfo=function(C){var G={};var L=C.indexOf("/");
C.substring(0,L);L=C.substring(0,C.lastIndexOf("/")+1);G.folderUrl=require(Z.getRequireConfig()).toUrl(L);G.amdFolder=L;G.url=G.folderUrl;if(/^http(s)?:\/\//.test(C)||/^\/\//.test(C))G.isRemote=!0;return G};Z.widgetJson=function(){var C={addManifest2WidgetJson:function(G,L){E.mixin(G,L.properties);G.name=L.name;G.label||(G.label=L.label);G.manifest=L;G.isRemote=L.isRemote;L.featureActions&&(G.featureActions=L.featureActions);G.icon||(G.icon=L.icon);G.thumbnail||(G.thumbnail=L.thumbnail);G.folderUrl=
L.folderUrl;G.amdFolder=L.amdFolder},removeManifestFromWidgetJson:function(G){if(G.manifest){for(var L in G.manifest.properties)G[L]=void 0;G.name=void 0;G.label=void 0;G.featureActions=void 0;G.manifest=void 0}},getUriFromItem:function(G){return G.url?C.getFolderUrlFromItem(G)+"Widget":null},getFolderUrlFromItem:function(G){if(!G.url)return null;G=/manifest\.json$/.test(G.url)?G.url.substring(0,G.url.length-13):/\/$/.test(G.url)?G.url:G.url+"/";"https:"===window.location.protocol&&(G=G.replace(/^http:\/\//,
"https://"));return G}};return C}();Z.getRequireConfig=function(){if(jimuConfig){var C=[];jimuConfig.widgetsPackage&&(C=C.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(C=C.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(C=C.concat(jimuConfig.configsPackage));return{packages:C}}return{}};Z.getTypeByGeometryType=function(C){var G="",L="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),
P=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(C)?G="point":0<=L.indexOf(C)?G="polyline":0<=P.indexOf(C)&&(G="polygon");return G};Z.getSymbolTypeByGeometryType=function(C){var G=null;C=Z.getTypeByGeometryType(C);"point"===C?G="marker":"polyline"===C?G="line":"polygon"===C&&(G="fill");return G};Z.getServices=function(){return Da};Z.getArcGISDefaultGeometryService=function(){return new N(Da.geometryService)};Z.restoreToDefaultWebMapExtent=
function(C,G,L){var P=new k;if(!C||"esri.Map"!==C.declaredClass)return setTimeout(function(){P.reject("Invalid map.")},0),P;G=G&&G.itemInfo;if(!G)return setTimeout(function(){P.reject("Invalid itemInfo")},0),P;G=G.item&&G.item.extent;if(!G)return setTimeout(function(){P.reject("Invalid itemInfo.item.extent")}),P;var T=new t({wkid:4326});T=new z(G[0][0],G[0][1],G[1][0],G[1][1],T);if(4326===parseInt(C.spatialReference.wkid,10))return C.setExtent(T);if(C.spatialReference.isWebMercator())return T=I.geographicToWebMercator(T),
C.setExtent(T);G=new S;G.geometries=[T];G.outSR=C.spatialReference;T=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;T&&"esri.tasks.GeometryService"===T.declaredClass||(L&&"string"===typeof L&&E.trim(L)?(L=E.trim(L),T=new N(L)):T=Z.getArcGISDefaultGeometryService());T.project(G).then(function(Y){if(Y=Y&&Y[0])return C.setExtent(Y);P.reject("Invalid projected geometry.");return P},function(Y){console.error(Y);P.reject(Y);return P});return P};Z.getAncestorWindow=function(){for(var C=
window;C&&C.parent&&C!==C.parent;)C=C.parent;return C};Z.getAncestorDom=function(C,G,L){if(C&&1===C.nodeType&&G&&"function"===typeof G){var P=100,T=document.body;L&&("number"===typeof L?(L=parseInt(L,10),0<L&&(P=L)):1===L.nodeType&&(T=L));for(L=0;C.parentNode&&L<P&&A.isDescendant(C.parentNode,T);){if(G(C.parentNode))return C.parentNode;C=C.parentNode;L++}}return null};Z.bindClickAndDblclickEvents=function(C,G,L,P){var T=null;if(C&&1===C.nodeType&&G&&"function"===typeof G&&L&&"function"===typeof L){var Y=
200;P&&"number"===typeof P&&(P=parseInt(P,10),0<P&&(Y=P));var fa=0;T=d(C,"click",function(ja){fa++;1===fa?setTimeout(function(){1===fa&&(fa=0,G(ja))},Y):2===fa&&(fa=0,L(ja))})}return T};Z.isScrollToBottom=function(C){var G=A.getContentBox(C);return 1>C.scrollHeight-(C.scrollTop+G.h)};Z.getAllItemTypes=function(){var C=[];C=C.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service",
"Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return C=C.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};Z.getItemQueryStringByTypes=function(C){var G="",L=Z.getAllItemTypes();if(C&&0<C.length&&0<C.length){var P="";q.forEach(C,function(T,Y){P+=' type:"'+T+'" ';Y!==C.length-1&&(P+=" OR ")});G=" ( "+P+" ) ";L=C.concat(L);L=q.filter(L,function(T){return q.every(C,
function(Y){return 0>Y.toLowerCase().indexOf(T.toLowerCase())})});q.forEach(L,function(T){G+=' -type:"'+T+'" '})}return G};Z.getItemQueryStringByTypeKeywords=function(C){var G="";C&&0<C.length&&(G=' typekeywords:"'+C.join(",")+'" ');return G};Z.isNotEmptyString=function(C,G){var L=C&&"string"===typeof C;return L?G?L&&E.trim(C):!0:!1};Z.isNotEmptyStringArray=function(C,G){for(var L=0;L<C.length;L++){var P=C[L];if(!Z.isNotEmptyString(P.value?P.value:P,G))return!1}return!0};Z.isValidNumber=function(C){return"number"===
typeof C&&!isNaN(C)};Z.isValidNumberArray=function(C){for(var G=0;G<C.length;G++){var L=C[G];L=L.value||0===L.value?L.value:L;if(!Z.isValidNumber(L))return!1}return!0};Z.isValidDate=function(C){if(C)try{var G=Z.getDateByDateTimeStr(C);return!isNaN(G.getTime())}catch(L){return console.error(L),!1}else return!1};Z.isObject=function(C){return C&&"object"===typeof C};Z.createWebMap=function(C,G,L,P){C=ia.getStandardPortalUrl(C);C=ia.getBaseItemUrl(C);B.arcgisUrl=C;return B.createMap(G,L,P)};Z.getRandomString=
function(){var C=Math.random().toString();return C=C.slice(2,C.length)};Z._getDomainsByServerName=function(C){var G=C.split("."),L=G.length;return q.map(G,E.hitch(this,function(P,T){P=G.slice(T,L);var Y="",fa=P.length-1;q.forEach(P,E.hitch(this,function(ja,ka){Y+=ja;ka!==fa&&(Y+=".")}));return Y}))};Z.removeCookie=function(C,G){var L=this._getDomainsByServerName(window.location.hostname);q.forEach(L,E.hitch(this,function(P){g(C,null,{expires:-1,path:G});g(C,null,{expires:-1,path:G,domain:P});g(C,
null,{expires:-1,path:G,domain:"."+P})}))};Z.isLocaleChanged=function(C,G){return!C.startWith(G)};Z.hashToObject=function(C){C=C.replace("#","");C=v.queryToObject(C);for(var G in C)if(C.hasOwnProperty(G))try{C[G]=c.parse(C[G])}catch(L){}return C};Z.reCreateObject=function(C){function G(P){var T=[];P.forEach(function(Y){Array.isArray(Y)?T.push(G(Y)):"object"===typeof Y?T.push(L(Y)):T.push(Y)});return T}function L(P){var T={},Y;for(Y in P)P.hasOwnProperty(Y)&&(null===P[Y]?T[Y]=null:Array.isArray(P[Y])?
T[Y]=G(P[Y]):T[Y]="object"===typeof P[Y]?L(P[Y]):P[Y]);return T}return Array.isArray(C)?G(C):L(C)};Z.setVerticalCenter=function(C){setTimeout(function(){var G=r(".jimu-vcenter-text",C),L,P;q.forEach(G,function(T){L=A.getContentBox(T).h;A.setStyle(T,{lineHeight:L+"px"})},this);G=r(".jimu-vcenter",C);q.forEach(G,function(T){L=A.getContentBox(T).h;P=A.getContentBox(r(T).parent()[0]).h;A.setStyle(T,{marginTop:(P-L)/2+"px"})},this)},10)};Z.merge=na;Z.loadStyleLink=function(C,G,L){var P=new k,T=require(Z.getRequireConfig()).toUrl(G);
if(require.cache["url:"+T]){var Y=require.cache["url:"+T];var fa=T.split("/").pop();T=T.substr(0,T.length-fa.length);Y=ua(Y,T);C=L?A.create("style",{id:C,type:"text/css"},A.byId(L),"before"):A.create("style",{id:C,type:"text/css"},document.getElementsByTagName("head")[0]);C.styleSheet&&!C.sheet?C.styleSheet.cssText=Y:C.appendChild(A.toDom(Y));P.resolve("load");return P}Y=L?A.create("link",{id:C,rel:"stylesheet",type:"text/css",href:T+"?wab_dv\x3d"+window.deployVersion},A.byId(L),"before"):A.create("link",
{id:C,rel:"stylesheet",type:"text/css",href:T+"?wab_dv\x3d"+window.deployVersion},document.getElementsByTagName("head")[0]);d(Y,"load",function(){P.resolve("load")});var ja=setInterval(function(){var ka;if(q.some(document.styleSheets,function(ta){if(ta.href&&ta.href.substr(ta.href.indexOf(G),ta.href.length)===G)return ka=ta,!0}))try{!P.isFulfilled()&&(ka.cssRules&&ka.cssRules.length||ka.rules&&ka.rules.length)&&P.resolve("load"),clearInterval(ja)}catch(ta){}},50);return P};Z.changeLocation=function(C){window.history.pushState&&
window.history.pushState({path:C},"",encodeURI(C))};Z.urlToObject=function(C){var G=null;-1===C.indexOf("#")?(G=da.urlToObject(C),G.hash=null):(C=C.split("#"),G=da.urlToObject(C[0]),G.hash=C[1]?-1<C[1].indexOf("\x3d")?v.queryToObject(C[1]):C[1]:null);return G};Z.manifest=function(){function C(G){G.panels.forEach(function(L){L.uri="panels/"+L.name+"/Panel.js"});G.styles.forEach(function(L){L.uri="styles/"+L.name+"/style.css"});G.layouts.forEach(function(L){L.uri="layouts/"+L.name+"/config.json";L.icon=
"layouts/"+L.name+"/icon.png";L.RTLIcon="layouts/"+L.name+"/icon_rtl.png"})}return{addManifestProperies:function(G){G.icon||(G.icon=G.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion);G.thumbnail||(G.thumbnail=G.folderUrl+"images/thumbnail.png");"theme"===G.category?C(G):("undefined"!==typeof G["2D"]&&(G.support2D=G["2D"]),"undefined"!==typeof G["3D"]&&(G.support3D=G["3D"]),"undefined"===typeof G["2D"]&&"undefined"===typeof G["3D"]&&(G.support2D=!0),delete G["2D"],delete G["3D"],"undefined"===
typeof G.properties&&(G.properties={}),ma.processWidgetProperties(G))},processManifestLabel:function(G,L){var P=L.split("-")[0];G.label=G.i18nLabels&&(G.i18nLabels[L]||G.i18nLabels[P]||G.i18nLabels.defaultLabel)||G.label||G.name;G.layouts&&q.forEach(G.layouts,function(T){var Y="i18nLabels_layout_"+T.name;T.label=G[Y]&&(G[Y][L]||G[Y].defaultLabel)||T.label||T.name});G.styles&&q.forEach(G.styles,function(T){var Y="i18nLabels_style_"+T.name;T.label=G[Y]&&(G[Y][L]||G[Y].defaultLabel)||T.label||T.name})},
addI18NLabel:function(G){var L=new k;if(G.i18nLabels)return L.resolve(G),L;G.i18nLabels={};if(G.properties&&!1===G.properties.hasLocale)return L.resolve(G),L;var P=G.isRemote?G.amdFolder+"nls/strings.js":G.amdFolder+"nls/strings";require(Z.getRequireConfig(),["dojo/i18n!"+P],function(T){var Y={};Y[dojoConfig.locale]=T;ma.addI18NLabelToManifest(G,null,Y);L.resolve(G)});return L}}}();Z.isNumberField=function(C){return 0<=["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle",
"esriFieldTypeDouble"].indexOf(C)};Z.getTime=function(C){var G=C.getTimezoneOffset();G=0>G?"+"+Math.abs(G)/60:"-"+G/60;return C.getTime()+36E5*G};Z.getUniqueValues=function(C,G,L,P,T){return function(){var Y=new k,fa={};P?(fa.layerDefinition=P,T&&(fa.fieldPopupInfo=T),Y.resolve(fa)):Y=J({url:C,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(ja){fa.layerDefinition=ja;return fa},function(ja){console.log("Error: ",ja.message)});return Y}().then(function(Y){return Z._getUniqueValues(C,
G,L,Y.layerDefinition).then(function(fa){return Z._getValues(Y.layerDefinition,Y.fieldPopupInfo,G,fa)})})};Z._getValues=function(C,G,L,P){var T=[];T=Z.getFieldInfoByFieldName(C.fields,L);var Y=null,fa=Z.isNumberField(T.type),ja="esriFieldTypeDate"===T.type?!0:!1;if(T){if(fa)P=q.map(P,function(ka){ka=parseFloat(ka);isNaN(ka)&&(ka=null);return ka});else if(ja)return T=q.map(P,E.hitch(this,function(ka){var ta=ka,pa=ka;Z.isValidDate(ka)&&(ta=Z.getDateTimeStrByFieldInfo(ka,G),pa=Z.localizeDateByFieldInfo(ka,
G));return{value:ta,label:pa}}));C=Z.getCodedValueListForCodedValueOrSubTypes(C,L);if(null!==C)for(Y={},L=0;L<C.length;L++)Y[C[L].value]=C[L].label}return T=q.map(P,function(ka){var ta=null;ta=null===ka||void 0===ka?"\x3cNull\x3e":Y&&Y.hasOwnProperty(ka)?Y[ka]:fa?G?Z.localizeNumberByFieldInfo(ka,G):Z.localizeNumber(ka):ja?Z.localizeDateByFieldInfo(new Date(ka),G):ka;return{value:ka,label:ta}})};Z._getUniqueValues=function(C,G,L,P){var T=new k;C=C.replace(/\/*$/g,"");L||(L="1\x3d1");T=/\/ImageServer$/gi.test(C);
var Y=-1<C.indexOf("MapServer/dynamicLayer");T||Y?T=Z._getUniqueValuesByQueryTask(C,G,L):(T=Z.getFieldInfoByFieldName(P.fields,G),T=0<Z.getCodedValuesOrTypesCount(T,P)?Z._getUniqueValuesByQueryTask(C,G,L):Z._getUniqueValuesByGenerateRenderer(C,G,L));return T};Z.getCodedValuesOrTypesCount=function(C,G){return C?G.typeIdField&&G.typeIdField.toUpperCase()===C.name.toUpperCase()&&G.types?G.types.length:(C=Z._getAllCodedValue(G,C))?C.length:0:0};Z._getUniqueValuesByQueryTask=function(C,G,L){var P=new R;
P.where=L;P.returnDistinctValues=!0;P.returnGeometry=!1;P.outFields=[G];return(new W(C)).execute(P).then(function(T){var Y=[];T.features&&0<T.features.length&&q.forEach(T.features,function(fa){fa&&fa.attributes&&Y.push(fa.attributes[G])});return Y})};Z._getUniqueValuesByGenerateRenderer=function(C,G,L){var P=new k,T=C.split("?");C=1<T.length?T[0].replace(/\/*$/g,"")+"/generateRenderer?"+T[1]:C.replace(/\/*$/g,"")+"/generateRenderer";G=c.stringify({type:"uniqueValueDef",uniqueValueFields:[G]});J({url:C,
content:{classificationDef:G,f:"json",where:L},handleAs:"json",callbackParamName:"callback"}).then(E.hitch(this,function(Y){var fa=[];(Y=Y&&Y.uniqueValueInfos)&&0<Y.length&&(fa=q.map(Y,E.hitch(this,function(ja){return ja.value})));P.resolve(fa)}),E.hitch(this,function(Y){P.reject(Y)}));return P};Z.isCodedValuesSupportFilter=function(C,G){C=C.currentVersion?C:C.toJson().layerDefinition;var L=parseFloat(C.currentVersion);return G<=parseFloat(C.maxRecordCount)&&10.1<L};Z.combineRadioCheckBoxWithLabel=
function(C,G){var L=!1;if(C&&1===C.nodeType&&"input"===C.tagName.toLowerCase()){var P=C.getAttribute("type")||"";P=P.toLowerCase();if("radio"===P||"checkbox"===P)L=!0}P=!1;G&&1===G.nodeType&&"label"===G.tagName.toLowerCase()&&(P=!0);L&&P&&(L=C.getAttribute("id"),L||(L="input_"+Z.getRandomString(),C.setAttribute("id",L)),G.setAttribute("for",L),A.setStyle(G,"cursor","pointer"))};Z.groupRadios=function(C,G){var L=[],P="radiogroup_"+Z.getRandomString();q.forEach(C,function(T){T.name=P;G&&(T=d(T,"change",
G),L.push(T))});return L};Z.convertExtentToPolygon=function(C){var G=C.xmin,L=C.xmax,P=C.ymin,T=C.ymax;return new H({rings:[[[G,T],[L,T],[L,P],[G,P],[G,T]]],spatialReference:C.toJson()})};Z.combineGeometries=function(C){function G(pa){var V={points:[],spatialReference:pa[0].spatialReference.toJson()};q.forEach(pa,function(ca){"point"===ca.type?V.points=V.points.concat([[ca.x,ca.y]]):"multipoint"===ca.type&&(V.points=V.points.concat(ca.points))});return new y(V)}function L(pa){var V={paths:[],spatialReference:pa[0].spatialReference.toJson()};
q.forEach(pa,function(ca){V.paths=V.paths.concat(ca.paths)});return new D(V)}function P(pa){var V={rings:[],spatialReference:pa[0].spatialReference.toJson()};q.forEach(pa,function(ca){"polygon"===ca.type?V.rings=V.rings.concat(ca.rings):"extent"===ca.type&&(ca=Z.convertExtentToPolygon(ca),V.rings=V.rings.concat(ca.rings))});return new H(V)}var T=null;if(C&&0<C.length)if(1===C.length)T=C[0];else{for(var Y=null,fa=null,ja=null,ka=null,ta=0;ta<C.length;ta++){Y=C[ta];switch(Y.type){case "point":case "multipoint":ka=
"point";break;case "polyline":ka="polyline";break;case "polygon":case "extent":ka="polygon";break;default:return null}if(0===ta)ja=ka;else if(ja!==ka)return null;if(ta!==C.length-1&&(fa=C[ta+1],!Y.spatialReference.equals(fa.spatialReference)))return null}"point"===ka?T=G(C):"polyline"===ka?T=L(C):"polygon"===ka&&(T=P(C))}return T};Z.combineGeometriesByGraphics=function(C){var G=null;C&&0<C.length&&(C=q.map(C,function(L){return L.geometry}),G=Z.combineGeometries(C));return G};Z.isFeaturelayerUrlSupportQuery=
function(C,G){var L=!1,P=/\/featureserver\//gi.test(C);C=/\/mapserver\//gi.test(C);G=(G||"").toLowerCase();P?L=0<=G.indexOf("query"):C&&(L=0<=G.indexOf("data"));return L};Z.isImageServiceSupportQuery=function(C){return 0<=(C||"").toLowerCase().indexOf("catalog")};Z.isStringEndWith=function(C,G){return C.lastIndexOf(G)+G.length===C.length};Z._localizeNumber=function(C,G){var L=(C.toString().split(".")[1]||"").length,P="";P=G&&isFinite(G.places)&&G.places;P=0<P||0<L?"#,###,###,##0.0"+Array.prototype.join.call({length:0<
P?P+1:L},"0"):"#,###,###,##0";L={locale:G&&G.locale||m.locale,pattern:P};E.mixin(L,G||{});try{return b.format(C,L)}catch(T){return console.error(T),C.toLocaleString()}};Z.localizeNumber=function(C,G){if(!Z.isNumberOrNumberString(C))return C;C=Number(C);var L=!1;0>C&&(L=!0,C=Math.abs(C));C=Z._localizeNumber(C,G);L&&(C=window.isRTL?C+"-":"-"+C);return C};Z.isLocalizedNumber=function(C){C=b.parse(C,{locale:m.locale});return isNaN(C)?!1:!isNaN(parseFloat(C))};Z.parseNumberToUSENFormat=function(C){var G=
b.parse(C,{locale:m.locale});return isNaN(G)?parseFloat(h.isDefined(C)&&C.replace?C.replace(",","."):C):G};Z.parseNumber=function(C,G){var L={locale:m.locale};E.mixin(L,G||{});try{return b.parse(C,L)}catch(P){return console.error(P),C}};Z.localizeDate=function(C,G){var L={locale:m.locale,fullYear:!0};E.mixin(L,G||{});"ar"===m.locale&&"long"!==L.formatLength&&"full"!==L.formatLength&&(L.formatLength="long");try{return e.format(C,L)}catch(P){return console.error(P),"date"===L.selector?C.toLocaleDateString():
"time"===L.selector?C.toLocaleTimeString():C.toLocaleString()}};Z.localizeNumberByFieldInfo=function(C,G){var L=null;L=E.exists("format.places",G)&&G.format.places;L=Z.localizeNumber(C,{places:L});return E.exists("format.digitSeparator",G)&&!G.format.digitSeparator?L.toString().replace(new RegExp("\\"+a.group,"g"),""):L};Z.localizeDateByFieldInfo=function(C,G){var L=null;try{var P={date:C instanceof Date?C.getTime():C},T=E.exists("format.dateFormat",G)?G.format.dateFormat:"longMonthDayYear";L=h.substitute(P,
"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+u.prototype._dateFormats[T]}})}catch(Y){console.error(Y),L=C}return L};Z.getDatePatternsByFormat=function(C){return u.prototype._dateFormatsJson[C]};Z.localizeDateTimeByFieldInfo=function(C,G,L,P){var T={h:"h",m:"h:mm",s:"h:mm:ss"},Y={h:"H",m:"H:mm",s:"H:mm:ss"},fa=function(ca,aa,ea){ca=Z.getDatePatternsByFormat(ca).datePattern;var la=T[aa];la=ea||"h"===aa?T[aa]+" a":Y[aa];return"(datePattern: '"+ca+"', timePattern: '"+la+"', selector: 'date and time')"},
ja,ka,ta=null;try{var pa={date:C instanceof Date?C.getTime():C};if(E.exists("format.dateFormat",G)){var V=G.format.dateFormat;L?ka=0<V.indexOf("Time")?fa(V,P,0>V.indexOf("24")):fa(V,P):ja=V.split("ShortTime")[0].split("LongTime")[0]}else L?ka=fa("longMonthDayYear",P):ja="longMonthDayYear";ka=ka?ka:u.prototype._dateFormats[ja];ta=h.substitute(pa,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+ka}})}catch(ca){console.error(ca),ta=C}return ta};Z.getDateTimeStr=function(C,G){G=G?"YYYY-MM-DD HH:mm:ss":
"YYYY-MM-DD";return p(C).format(G)};Z.getDateByDateTimeStr=function(C){return p(C).toDate()};Z.getDateByDateTimeStrAndFormat=function(C,G){C=Z.getDateByDateTimeStr(C);E.exists("format.dateFormat",G)&&(G=G.format.dateFormat,0<=G.indexOf("ShortTime")?C.setSeconds(0):0>G.indexOf("Time")&&(C.setHours(0),C.setMinutes(0),C.setSeconds(0)));return C};Z.getDateTimeStrByFieldInfo=function(C,G){var L="YYYY-MM-DD";E.exists("format.dateFormat",G)&&(G=G.format.dateFormat,0<=G.indexOf("LongTime")?L+=" HH:mm:ss":
0<=G.indexOf("ShortTime")&&(L+=" HH:mm"));return p(C).format(L)};Z.fieldFormatter={getFormattedUrl:function(C){if(C&&"string"===typeof C){var G=C.indexOf("http:");-1===G&&(G=C.indexOf("https:"));if(-1<G&&-1===C.indexOf("href\x3d")){var L=C.indexOf(" ",G);-1===L&&(L=C.length);var P=-1<C.indexOf("\r\n",G)?C.indexOf("\r\n",G):-1<C.indexOf("\n",G)?C.indexOf("\n",G):L;L=P<L?P:L;P=C.substring(G,L);C=C.substring(0,G)+'\x3cA href\x3d"'+P+'" target\x3d"_blank"\x3e'+P+"\x3c/A\x3e"+C.substring(L,C.length)}}return null===
C?"":C},getFormattedNumber:function(C,G){if("number"===typeof C){var L=(C.toString().split(".")[1]||"").length;C=Z.localizeNumberByFieldInfo(C,{format:{places:G&&"number"===typeof G.places?parseInt(G.places,10):L,digitSeparator:G&&G.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(C||"")+"\x3c/span\x3e"}return C},getFormattedDate:function(C,G){if("number"===typeof C||C instanceof Date)C=Z.localizeDateByFieldInfo(C,{format:G});return C||""},getCodedValue:function(C,G){if(C&&C.codedValues){for(var L=
0,P=C.codedValues.length;L<P;L++){var T=C.codedValues[L];if(h.isDefined(G)&&E.exists("code",T)&&G.toString()===T.code.toString())return T.name}return G}return G||null},getTypeName:function(C,G){for(var L=G.length,P=0;P<L;P++)if(C===G[P].id)return G[P].name;return C}};Z.addRelativePathInCss=ua;Z.url={isAbsolute:function(C){return C?C.startWith("http")||C.startWith("/"):!1},removeQueryParamFromUrl:function(C,G){C=da.urlToObject(C);C.query&&delete C.query[G];G=C.path;for(var L in C.query)G=G===C.path?
G+"?"+L+"\x3d"+C.query[L]:G+"\x26"+L+"\x3d"+C.query[L];return G},addQueryParamToUrl:function(C,G,L){C=da.urlToObject(C);C.query||(C.query={});C.query[G]=L;G=C.path;for(var P in C.query)G=G===C.path?G+"?"+P+"\x3d"+C.query[P]:G+"\x26"+P+"\x3d"+C.query[P];return G},compareUrl:function(C,G){C=this.getUrlPath(C);G=this.getUrlPath(G);C=ia.removeProtocol(C.toString().toLowerCase()).replace(/\/+/g,"/");G=ia.removeProtocol(G.toString().toLowerCase()).replace(/\/+/g,"/");return C===G},getUrlPath:function(C){return da.urlToObject(C).path}};
Z.processUrlInWidgetConfig=function(C,G){if(C)return C.startWith("data:")||C.startWith("http")||C.startWith("/")?C:C.startWith("${appPath}")?C.replace("${appPath}",window.appInfo.appPath):G+C};Z.processUrlInAppConfig=function(C){if(C)return C.startWith("data:")||C.startWith("http")||C.startWith("/")?C:window.appInfo.appPath+C};Z.getLocationUrlWithoutHashAndQueryParams=function(){var C=window.location,G=C.protocol+"//"+C.host+C.pathname;C=da.urlToObject(C.href);C.query&&C.query.apiurl&&(G=Z.url.addQueryParamToUrl(G,
"apiurl",C.query.apiurl));return G};Z.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};Z.invertColor=function(C){C=C.substring(1);3===C.length&&(C=C.slice(0,1)+C.slice(0,1)+C.slice(1,1)+C.slice(1,1)+C.slice(2,1)+C.slice(2,1));C=parseInt(C,16);return 7829367<C?"#000000":"#ffffff"};Z.isLightColor=function(C){C=C.substring(1);3===C.length&&(C=C.slice(0,1)+C.slice(0,1)+C.slice(1,1)+C.slice(1,1)+C.slice(2,1)+C.slice(2,1));C=parseInt(C,16);return 7829367<C?!0:!1};Z.mixinAppConfigPosition=
function(C,G){var L=E.clone(C);if(!G)return L;G=E.clone(G);var P=L.widgetOnScreen,T=G.widgetOnScreen;T&&T.widgets&&("[object Object]"===Object.prototype.toString.call(T.widgets)?q.forEach(P.widgets,function(Y,fa){fa=Y.uri?Y.uri:"ph_"+fa;T.widgets[fa]&&T.widgets[fa].position&&(T.widgets[fa].position.relativeTo||(T.widgets[fa].position.relativeTo="map"),Y.position=T.widgets[fa].position)},this):q.forEach(T.widgets,function(Y,fa){Y.position&&!Y.position.relativeTo&&(Y.position.relativeTo="map");P.widgets[fa]&&
Y.position&&(P.widgets[fa].position=Y.position)}));T&&T.groups&&("[object Object]"===Object.prototype.toString.call(T.groups)?q.forEach(P.groups,function(Y,fa){fa=Y.label?Y.label:"g_"+fa;T.groups[fa]&&T.groups[fa].panel&&T.groups[fa].panel.position&&(T.groups[fa].panel.position.relativeTo||(T.groups[fa].panel.position.relativeTo="map"),Y.panel.position=T.groups[fa].panel.position)},this):(C=C.layoutDefinition?C.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager","jimu/layoutManagers/AbsolutePositionLayoutManager"===
C?q.forEach(T.groups,function(Y,fa){Y.panel&&Y.panel.position&&!Y.panel.position.relativeTo&&(Y.panel.position.relativeTo="map");P.groups[fa]&&Y.panel&&Y.panel.position&&(P.groups[fa].panel.position=Y.panel.position)}):"jimu/layoutManagers/GridLayoutManager"===C&&(P.groups=va(P.groups,T.groups.map(function(Y){return Y.id})))));G.map&&G.map.position&&(L.map?L.map.position=G.map.position:L.map={position:G.map.position});G.widgetPool&&G.widgetPool.panel&&(G.widgetPool.panel.position&&!G.widgetPool.panel.position.relativeTo&&
(G.widgetPool.panel.position.relativeTo="map"),L.widgetPool.panel.position=G.widgetPool.panel.position);G.mobileLayout&&(L.mobileLayout=G.mobileLayout);return L};Z.handleGridLayoutOnScreenGroupChange=va;Z.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(C,G,L){var P=-1;G=C.search(new RegExp(G));0<=G&&(C=C.slice(G,C.length),C=C.indexOf(L),P=G+C+L.length);return{firstPos:G,lastPos:P}},setConfigValue:function(C,G,L){ra(C,G,L)},getConfigValue:function(C,
G){return ra(C,G)},setConfigValueWithId:function(C,G,L){wa(C,G,L)},getConfigValueWithId:function(C,G){return wa(C,G)},getKeyInfo:function(C){var G=this.getWidgetIdByKey(C);if(null!==G)return{type:"widget",id:G};C=this.getGroupIdByKey(C);return null!==C?{type:"group",id:C}:{type:"unknow",id:null}},getWidgetIdByKey:function(C){var G=Z.template.getSearchRange(C,Z.template.widgetIdentification,"]");if(-1===G.firstPos)C=null;else{var L=C.slice(G.firstPos,G.lastPos);C=C.slice(G.firstPos+L.indexOf("[")+
1,G.lastPos-1)}return C},getGroupIdByKey:function(C){var G=Z.template.getSearchRange(C,Z.template.groupIdentification,"]");if(-1===G.firstPos)C=null;else{var L=C.slice(G.firstPos,G.lastPos);C=C.slice(G.firstPos+L.indexOf("[")+1,G.lastPos-1)}return C},getConfigedWidgetsByTemplateConfig:function(C){var G=[],L=Z.template.widgetIdentification+"_config",P;q.forEach(C.configurationSettings,function(T){q.forEach(T.fields,function(Y){Y.fieldName&&(P=Z.template.getSearchRange(Y.fieldName,L,"]"),0<=P.firstPos&&
(Y=Z.template.getWidgetIdByKey(Y.fieldName),-1===G.indexOf(Y)&&G.push(Y)))},this)},this);return G},mergeTemplateAppConfigToAppConfig:function(C,G,L){function P(ja){var ka=[];q.forEach(ja,function(ta){ta&&ka.push(ta)},this);return ka}var T=C.widgetOnScreen,Y=C.portalUrl;G.values.webmap&&(C.map.itemId=G.values.webmap);L&&(C.map.portalUrl=Y,G.values.app_title||(G.values.app_title=L.title),G.values.app_subtitle||(G.values.app_subtitle=L.snippet));for(var fa in G.values)"webmap"!==fa&&Z.template.setConfigValueWithId(C,
fa,G.values[fa]);C.widgetPool.widgets=P(C.widgetPool.widgets);T.widgets=P(T.widgets);if(C.widgetPool.groups)for(G=0;G<C.widgetPool.groups.length;G++)C.widgetPool.groups[G].widgets=P(C.widgetPool.groups[G].widgets);if(T.groups)for(G=0;G<T.groups.length;G++)T.groups[G].widgets=P(T.groups[G].widgets);return C}};Z.deleteMapOptions=function(C){C&&(delete C.extent,delete C.lods,delete C.center,delete C.scale,delete C.zoom,delete C.maxScale,delete C.maxZoom,delete C.minScale,delete C.minZoom)};Z.sanitizeHTML=
function(C){return C?html_sanitize(C,function(G){return G},function(G){return G}):C};Z.stripHTML=function(C){return C?-1<C.indexOf("\x3c")&&-1<C.indexOf("\x3e")?C.replace(/<(?:.|\s)*?>/g,""):C:C};Z.encodeHTML=function(C){return String(C).replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#39;")};Z.removeSuffixSlashes=function(C){return C.replace(/\/*$/g,"")};Z.getBestDisplayAttributes=function(C,G){var L={},P=null,T;for(T in C)P=Z.getBestDisplayValue(T,
C,G),L[T]=P;return L};Z.getBestDisplayValue=function(C,G,L){var P="",T=null;E.isArrayLike(L)?T=Z.getFieldInfoByFieldName(L,C):"object"===typeof L&&L.name===C&&(T=L);T&&(P=G[C],"esriFieldTypeDate"===T.type?P&&(C=new Date(parseInt(P,10)),P=Z._tryLocaleDate(C)):"number"===typeof P&&(T.domain&&"codedValue"===T.domain.type?q.some(T.domain.codedValues,function(Y){if(Y.code===P)return P=Y.name,!0}):P=Z._tryLocaleNumber(P)));if(null===P||void 0===P)P="";return P};Z._getCodedValues=function(C){var G=null;
(C=C.domain)&&"codedValue"===C.type&&C.codedValues&&0<C.codedValues.length&&(G=C.codedValues,G=q.map(G,E.hitch(this,function(L){return{value:L.code,label:L.name}})));return G};Z._getSubTypes=function(C){var G=null;C.subtypeField&&C.subtypes&&0<C.subtypes.length&&(G=q.map(C.subtypes,E.hitch(this,function(L){return{value:L.id,label:L.name}})));return G};Z._getRenderTypes=function(C){var G=null;C.typeIdField&&C.types&&0<C.types.length&&(G=q.map(C.types,E.hitch(this,function(L){return{value:L.id,label:L.name}})));
return G};Z._getCodedValueOrSubtypes=function(C,G,L){var P=Z.getFieldInfoByFieldName(C.fields,G),T;return P?T=void 0!==L&&null!==L?Z._getCodedValueBySubTypeId(C,G,L,P):Z._getAllCodedValue(C,P):T};Z._getDisplayValueForCodedValueOrSubtype=function(C,G,L,P){var T={isCodedValueOrSubtype:!1,displayValue:L+""};(C=Z._getCodedValueOrSubtypes(C,G,P))&&0<C.length&&q.some(C,E.hitch(this,function(Y){return Y.value===L?(T={isCodedValueOrSubtype:!0,displayValue:Y.label},!0):!1}));return T};Z._deleteSubtypePropertiesTemp=
function(C){delete C.subtypeField;delete C.subtypes};Z.getDisplayValueForCodedValueOrSubtype=function(C,G,L){Z._deleteSubtypePropertiesTemp(C);var P=L[G],T,Y=C.typeIdField;L.hasOwnProperty(Y)&&(T=L[Y]);(Y=C.subtypeField)&&C.subtypes&&0<C.subtypes.length&&L.hasOwnProperty(Y)&&(T=L[Y]);P=Z._getDisplayValueForCodedValueOrSubtype(C,G,P,T);C.typeIdField===G&&(P.displayValue=Z._updateCodedValueListFromRender(C,[{value:L[G],label:P.displayValue}])[0].label);return P};Z._getDisplayValueFromCodedValues=function(C,
G){var L={isCodedValueOrSubtype:!1,displayValue:C+""};G&&0<G.length&&q.some(G,E.hitch(this,function(P){return P.value===C?(L={isCodedValueOrSubtype:!0,displayValue:P.label},!0):!1}));L.value=C;return L};Z.getDisplayValueForCodedValueOrSubtypeBatch=function(C,G,L){Z._deleteSubtypePropertiesTemp(C);var P={},T=C.typeIdField,Y=C.subtypeField,fa=Z.getFieldInfoByFieldName(C.fields,G);Y&&C.subtypes&&0<C.subtypes.length?(P.subType=Z._getSubTypes(C),T=Y,P.all=Z._getAllCodedValueNew(C,fa)):(P.all=Z._getAllCodedValue(C,
fa),P.subType=Z._getRenderTypes(C));if(P.subType&&0<P.subType.length){Y=P.subType;for(var ja in Y){var ka=Y[ja].value,ta=Z._getCodedValueBySubTypeId(C,G,ka,fa);P[ka]=C.typeIdField===G?Z._updateCodedValueListFromRender(C,ta):ta}}C.typeIdField===G&&(P.subType=Z._updateCodedValueListFromRender(C,P.subType),P.all=Z._updateCodedValueListFromRender(C,P.all));ka=[];ja=[];for(var pa in L)ka=L[pa],Y=ka[G],T===G?ka=P.subType:ka.hasOwnProperty(T)?(ka=ka[T],ka=P[ka],ka||(ka=Z._getCodedValues(fa),C.typeIdField===
G&&(ka=Z._updateCodedValueListFromRender(C,ka)))):ka=P.all,Y=Z._getDisplayValueFromCodedValues(Y,ka),ja.push(Y);return ja};Z._getUniquCodedValue=function(C,G,L){C[G]?L!==C[G]&&(C[G]=C[G]+", "+L):C[G]=L;return C};Z._getAllCodedValue=function(C,G){var L=G.name,P={},T=null,Y=!0;if(C.typeIdField&&C.types&&0<C.types.length)q.map(C.types,E.hitch(this,function(ta){ta.domains&&ta.domains[L]&&(ta=ta.domains[L],"inherited"===ta.type?Y&&(Y=!1,ta=Z._getCodedValues(G),q.map(ta,E.hitch(this,function(pa){P=Z._getUniquCodedValue(P,
pa.value,pa.label)}))):ta.codedValues&&0<ta.codedValues.length&&q.map(ta.codedValues,E.hitch(this,function(pa){P=Z._getUniquCodedValue(P,pa.code,pa.name)})))})),T||(T=Z._getCodedValues(G));else return this._getCodedValues(G);C=[];var fa=Z.isNumberField(G.type),ja;for(ja in P){var ka=fa?parseFloat(ja):ja;C.push({value:ka,label:P[ja]})}0<C.length&&(T=C);return T};Z._getAllCodedValueNew=function(C,G){var L=G.name,P={},T=null,Y=!0;if(C.subtypeField&&C.subtypes&&0<C.subtypes.length)q.map(C.subtypes,E.hitch(this,
function(ta){ta.domains&&ta.domains[L]&&(ta=ta.domains[L],"inherited"===ta.type?Y&&(Y=!1,ta=Z._getCodedValues(G),q.map(ta,E.hitch(this,function(pa){P=Z._getUniquCodedValue(P,pa.value,pa.label)}))):ta.codedValues&&0<ta.codedValues.length&&q.map(ta.codedValues,E.hitch(this,function(pa){P=Z._getUniquCodedValue(P,pa.code,pa.name)})))})),T||(T=Z._getCodedValues(G));else return this._getCodedValues(G);C=[];var fa=Z.isNumberField(G.type),ja;for(ja in P){var ka=fa?parseFloat(ja):ja;C.push({value:ka,label:P[ja]})}0<
C.length&&(T=C);return T};Z._getCodedValueBySubTypeId=function(C,G,L,P){var T="typeIdField",Y="types";C.subtypeField&&C.subtypes&&0<C.subtypes.length&&(T="subtypeField",Y="subtypes");var fa=null;P=P?P:Z.getFieldInfoByFieldName(C.fields,G);if(!P)return fa;C[T]&&C[Y]&&0<C[Y].length?(q.map(C[Y],E.hitch(this,function(ja){if(ja.id===L){if(G===C[T])return fa=[{value:ja.id,label:ja.name}],!0;ja.domains&&ja.domains[G]?(ja=ja.domains[G],"inherited"===ja.type?fa=Z._getCodedValues(P):ja.codedValues&&0<ja.codedValues.length&&
(fa=q.map(ja.codedValues,E.hitch(this,function(ka){return{value:ka.code,label:ka.name}})))):ja.domains&&(fa=Z._getCodedValues(P))}})),fa||(fa=Z._getCodedValues(P))):fa=Z._getCodedValues(P);return fa};Z.getCodedValueListForCodedValueOrSubTypes=function(C,G,L){Z._deleteSubtypePropertiesTemp(C);var P=null;P=Z.getFieldInfoByFieldName(C.fields,G);if(L){var T=L[C.typeIdField];var Y=L[C.subtypeField]}if(C.subtypeField&&C.subtypes&&0<C.subtypes.length)return G===C.subtypeField?(P=Z._getSubTypes(C),void 0!==
Y&&(L=Z._getDisplayValueFromCodedValues(Y,P),P=[{value:L.value,label:L.displayValue}])):P=void 0===Y?Z._getAllCodedValueNew(C,P):Z._getCodedValueBySubTypeId(C,G,Y,P),G===C.typeIdField&&(P=Z._updateCodedValueListFromRender(C,P)),P;C.subtypeField="";C.subtypes=[];C.typeIdField&&C.typeIdField.toUpperCase()===G.toUpperCase()?(P=Z._getRenderTypes(C),L&&void 0!==T&&null!==T&&(L=Z._getDisplayValueFromCodedValues(T,P),P=[{value:L.value,label:L.displayValue}])):P=L&&void 0!==T&&null!==T?Z._getCodedValueBySubTypeId(C,
G,T,P):Z._getAllCodedValue(C,P);G===C.typeIdField&&(P=Z._updateCodedValueListFromRender(C,P));return P};Z._verifyIfFieldIsSubtypeField=function(C,G){var L={isSubtypeField:!1,subtypeField:""};if(C.subtypeField)return L={isSubtypeField:C.subtypeField===G.name,subtypeField:C.subtypeField};["esriFieldTypeSmallInteger","esriFieldTypeInteger"].indexOf(G.type)&&C.typeIdField===G.name&&C.types&&0<C.types.length&&(void 0===C.types[0].domains[G.name]?L={isSubtypeField:!0,subtypeField:G.name}:L.isSubtypeField=
!1);return!1};Z.getUniqueRendererByLayerDefinition=function(C){var G=null;C.drawingInfo&&C.drawingInfo.renderer&&"uniqueValue"===C.drawingInfo.renderer.type&&(G=C.drawingInfo.renderer);return G};Z.isUniqueReneredByLayerObject=function(C,G){return"uniqueValue"===C.type&&G&&G.field1===C.field1};Z._getRenderValueLabelsForUnique=function(C){var G=null,L=null,P=Z.getUniqueRendererByLayerDefinition(C);P?(G={},L=P.uniqueValueInfos):C.renderer&&(P=C.toJson().layerDefinition,P=Z.getUniqueRendererByLayerDefinition(P),
C=C.renderer.toJson(),Z.isUniqueReneredByLayerObject(C,P)?(G={},L=C.uniqueValueInfos):P&&(G={},L=P.uniqueValueInfos));if(L)for(C=0;C<L.length;C++)P=L[C],G[P.value]=P.label;return G};Z._updateCodedValueListFromRender=function(C,G){if((C=Z._getRenderValueLabelsForUnique(C))&&G)for(var L=0;L<G.length;L++){var P=G[L];C[P.value]&&(P.label=C[P.value])}return G};Z.getDefaultPortalFieldInfo=function(C){var G=C.name;G={fieldName:G,label:C.alias||G,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};
switch(C.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":G.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":G.format={places:2,digitSeparator:!0};break;case "esriFieldTypeDate":G.format={dateFormat:"longMonthDayYear"}}return G};Z.getDefaultPopupInfo=function(C,G,L){var P=null;C&&C.fields&&(P={title:G,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},q.forEach(C.fields,function(T){var Y=!1;L?q.some(L,E.hitch(this,function(fa){return fa&&
T.name.toLowerCase()===fa.toLowerCase()}))&&(Y=!0):Y=!0;Y&&(Y=this.getDefaultPortalFieldInfo(T),Y.visible=!0,Y.isEditable=T.editable,P.fieldInfos.push(Y))},this));return P};Z._tryLocaleNumber=function(C){var G=Z.localizeNumber(C);if(null===G||void 0===G)G=C;return G};Z._tryLocaleDate=function(C){var G=Z.localizeDate(C);G||(G=C.toLocaleDateString());return G};Z.getFieldInfoByFieldName=function(C,G){var L=null;C&&0<C.length&&q.some(C,E.hitch(this,function(P){return P.name===G?(L=P,!0):!1}));return L};
Z.getDateFieldFormatByFieldName=function(C,G){if(C&&0<C.length)for(var L=0;L<C.length;L++){var P=C[L];if(P.fieldName===G){if(P.format&&P.format.dateFormat)return P.format.dateFormat;break}}return""};Z.completePopupFieldFromLayerField=function(C,G){if(!G)return C;for(var L in C){var P=C[L].name,T=!1,Y;for(Y in G)if(G[Y].fieldName===P){T=!0;break}T||(P=Z.getPopupFieldFromLayerField(C[L]),G.push(P))}return G};Z.getPopupFieldFromLayerField=function(C){return{fieldName:C.name,isEditable:C.editable,label:C.alias,
visible:C.visible?C.visible:!1,stringFieldOption:"esriFieldTypeString"===C.type?"textbox":null,tooltips:"",domain:C.domain?C.domain:null}};Z.containsNonLatinCharacter=function(C){for(var G=0;G<C.length;G++)if(255<C.charCodeAt(G))return!0;return!1};Z.has=function(C){var G=w(C);if(G)return G;if("ie"===C.toLowerCase()){C=0;var L=/MSIE (\d+\.\d+);/.test(navigator.userAgent),P=!!navigator.userAgent.match(/Trident\/7.0/),T=navigator.userAgent.indexOf("rv:11.0");L&&(C=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&
(C=10);P&&-1!==T&&(C=11);return 11===C&&11||G}if("edge"===C.toLowerCase())return navigator.userAgent.split("Edge/")[1]||G};Z.detectUserAgent=function(){return window.userAgent};Z.isMobileUa=function(){return window.isMobileUa};Z.inMobileSize=function(){var C=A.getMarginBox(document.body);if(C.w<=window.jimuConfig.breakPoints[0]||C.h<=window.jimuConfig.breakPoints[0])return A.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;A.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1};
Z.getObjectIdField=function(C){if(C.objectIdField)return C.objectIdField;C=C.fields;for(var G=0;G<C.length;G++){var L=C[G];if("esriFieldTypeOID"===L.type)return L.name}return null};Z.isNeedHttpsButNot=function(){var C=navigator.geolocation,G=window.hasOwnProperty("isSecureContext");return(G&&window.isSecureContext||!G&&"https:"===window.location.protocol)&&C?!1:!0};Z.toFeatureSet=function(C){var G=new M;"[object Object]"===Object.prototype.toString.call(C)&&(C=[C]);G.features=C;if(0<C.length){var L;
q.some(C,function(T){if(T.geometry)return L=T,!0});if(L){C=L.getLayer();var P={};C&&(G.displayFieldName=C.displayField,q.forEach(C.fields,E.hitch(this,function(T){var Y=T.name;P[Y]=T.alias||Y})),G.fieldAliases=P);G.geometryType=L.geometry.type;G.spatialReference=L.geometry.spatialReference}}return G};Z.showValidationErrorTipForFormDijit=function(C){try{!C.validate()&&C.domNode&&C.focusNode&&(C.focusNode.focus(),setTimeout(E.hitch(this,function(){C.focusNode.blur()}),100))}catch(G){console.error(G)}};
Z.getFeatureLayerDefinition=function(C){var G=null,L=C.graphics;C.graphics=[];var P=C.toJson();C.graphics=L;P&&(G=P.layerDefinition);return G};Z.simulateClickEvent=function(C){if(w("safari")){var G=document.createEvent("MouseEvents");G.initEvent("click",!0,!0);C.dispatchEvent(G)}else C.click()};Z.getFeatureSetByLayerAndFeatures=function(C,G){var L=new M;L.fields=E.clone(C.fields);L.features=G;L.geometryType=C.geometryType;L.fieldAliases={};q.forEach(L.fields,E.hitch(this,function(P){var T=P.name;
L.fieldAliases[T]=P.alias||T}));return L};Z.featureAction=function(){return{zoomTo:function(C,G,L){L||(L={});if(C&&G&&0<G.length){var P=q.every(G,function(T){return T&&T.spatialReference&&T.type});if(q.every(G,function(T){return T&&T.geometry&&T.geometry.spatialReference&&T.geometry.type})||P)P&&(G=q.map(G,function(T){return{geometry:T}})),Z.zoomToFeatureSet(C,{features:G},L.extentFactor)}},flash:function(C,G){function L(ka,ta){q.forEach(T,function(pa,V){pa.setSymbol(ta?ka:Y[V]||fa)})}function P(ka){return function(){setTimeout(function(){L(ja,
!0);T[0]&&G&&G.redraw();setTimeout(function(){L(null,!1);T[0]&&G&&G.redraw();ka()},200)},200)}}if(q.every(C||[],function(ka){return ka&&ka.geometry})){var T=C;C=T[0];var Y=q.map(T,function(ka){return ka.symbol}),fa=C.symbol||E.getObject("renderer.symbol",!1,G),ja=null;G&&"esriGeometryPoint"===G.geometryType?ja=new Q(require.toUrl("jimu")+"/images/flash.gif",20,20):(ja=E.clone(fa))&&(ja.outline?ja.outline.setColor("#ffc500"):ja.setColor("#ffc500"));C&&fa&&ja&&G&&("esriGeometryPoint"===G.geometryType?
(L(ja,!0),G.redraw(),setTimeout(function(){L(null,!1);G.redraw()},2E3)):P(P(P(function(){})))())}},panTo:function(C,G){q.every(G||[],function(L){return L&&L.geometry})&&(0<G.length?G=X.graphicsExtent(G).getCenter():(G=G[0].geometry,G="polyline"===G.type||"polygon"===G.type?G.getExtent().getCenter():"extent"===G.type?G.getCenter():"multipoint"===G.type?1<G.points.length?G.getExtent().getCenter():G.getPoint(0):G),C.centerAt(G))},showPopup:function(C,G){q.every(G||[],function(L){return L&&L.geometry})&&
(C=C.infoWindow,C.setFeatures(G),G=G[0],"point"===G.geometry.type?C.show(G.geometry,{closetFirst:!0}):C.show(G.geometry.getExtent().getCenter(),{closetFirst:!0}))}}}();Z.isInConfigOrPreviewWindow=function(){var C=!1;try{C=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(G){C=!1}return!!C};Z.getAppHref=function(){var C="";return C=Z.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};Z.getAppIdFromUrl=function(){var C=!0,G=Z.getAppHref();
if(-1!==G.indexOf("id\x3d")||-1!==G.indexOf("appid\x3d")||-1!==G.indexOf("apps"))C=!1;if(!0===C)return G;C=this.urlToObject(window.location.href);if(C.query&&(C.query.id||C.query.appid))return C.query.id||C.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(C=window.appInfo.appPath.split("/"),C.length&&2<C.length)return C[C.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};Z.getEditorContentHeight=function(C,G,L){var P=new k;this._content=
C;this._dom=G;this._domParam=L;var T=setTimeout(E.hitch(this,function(){clearTimeout(T);T=null;var Y=0,fa=this._domParam.contentWidth;try{var ja=document.createElement("div");ja.setAttribute("id","fakeContent");A.setStyle(ja,"background-size","contain");ja.innerHTML=this._content;this._dom.appendChild(ja);if(ja){var ka=r("img",ja);ka&&ka.length&&ka.style({maxWidth:fa-20+"px"});A.setStyle(ja,"position","absolute");A.setStyle(ja,"width",fa+"px");A.setStyle(ja,"left","-99999px");A.setStyle(ja,"top",
"-99999px");A.setStyle(ja,"visibility","hidden");var ta=A.getContentBox(ja);ta.h&&(Y=ta.h,Y+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(pa){console.error("can't getEditorContentHeight"+pa),Y=200}P.resolve(Y)}),1500);return P};Z.getBase64Data=function(C){var G=new k;if(C&&C.startWith("data:image"))G.resolve(C);else try{J({url:C,handleAs:"arraybuffer"}).then(function(L){var P=new FileReader;P.onloadend=function(){G.resolve(P.result)};P.onerror=function(){G.resolve(null)};
P.readAsDataURL(new Blob([L],{type:"image/png"}))},function(){G.resolve(null)})}catch(L){console.warn(L),G.resolve(null)}return G};Z.getEditorTextColor=function(C,G){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:Z.getColorRecordName(C),forceAttr:G}}};Z.getEditorBackgroundColor=function(C){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:Z.getColorRecordName(C)}}};Z.getColorRecordName=function(C){return"wab_cr_"+(C||"")};Z.b64toBlob=function(C,G,L){G=
G||"";L=L||512;C=window.atob(C.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""));for(var P=[],T=0;T<C.length;T+=L){for(var Y=C.slice(T,T+L),fa=Array(Y.length),ja=0;ja<Y.length;ja++)fa[ja]=Y.charCodeAt(ja);Y=new Uint8Array(fa);P.push(Y)}return new Blob(P,{type:G})};Z.subtractionArray=function(C,G){for(var L=C.length-1;0<=L;L--)for(var P=C[L],T=G.length-1;0<=T;T--)if(P===G[T]){C.splice(L,1);G.splice(T,1);break}return C};Z.resourcesUrlToBlob=function(C){return J({url:C,handleAs:"blob"})};Z.processItemResourceOfAppConfig=
function(C,G){function L(ka){var ta=ka.obj,pa=ka.key,V={obj:ta,key:pa};"number"===typeof ka.i?(V.i=ka.i,V.value=ta[pa][ka.i]):V.value=ta[pa];return V}function P(ka){for(var ta in ka)if("object"===typeof ka[ta])if(Array.isArray(ka[ta]))for(var pa=ka,V=ta,ca=0;ca<pa[V].length;ca++)"string"===typeof pa[V][ca]?T(pa,V,ca):"object"===typeof pa[V][ca]&&P(pa[V][ca]);else P(ka[ta]);else"string"===typeof ka[ta]&&T(ka,ta)}function T(ka,ta,pa){"number"===typeof pa?G.test(ka[ta][pa])&&(ja=G.func(L({obj:ka,key:ta,
i:pa})),"function"===typeof ja.then?fa.push(ja):Y.push(ja)):G.test(ka[ta])&&(ja=G.func(L({obj:ka,key:ta})),"function"===typeof ja.then?fa.push(ja):Y.push(ja))}var Y=[],fa=[],ja;P(C);return 0<fa.length?n(fa).then(function(ka){0<Y.length&&(ka=ka.concat(Y));return{appConfig:C,result:ka}}):{appConfig:C,result:Y}};Z.isEsriDomain=function(C){return/^https?:\/\/(?:[\w\-_]+\.)+(?:esri|arcgis)\.com/.test(C)};Z.uniqueArray=function(C){for(var G=[],L=0;L<C.length;L++)-1===G.indexOf(C[L])&&G.push(C[L]);return G};
Z.isNotEmptyObject=function(C,G){return G?Z.isObject(C)&&0<Object.keys(C).length&&Array.isArray(C):Z.isObject(C)&&0<Object.keys(C).length};Z.getMinOfArray=function(C){return Number(Math.min.apply(Math,C))};Z.getDataSchemaFromLayerDefinition=function(C){var G=C.fields.filter(function(L){return"esriFieldTypeOID"===L.type});G=0<G.length?G[0]:null;return{geometryType:C.geometryType,fields:C.fields,displayField:C.displayField,objectIdField:G,typeIdField:C.typeIdField}};Z.isValidPointGeometry=function(C){return C&&
"point"===C.type&&Z.isTrueOrZero(C.x)&&Z.isTrueOrZero(C.y)};Z.isVaildPointGeometry=Z.isValidPointGeometry;Z.isNumberOrNumberString=function(C){return/^-?[1-9]\d*$/.test(C)||/^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$/.test(C)};Z.convertNumberToPercentage=function(C,G,L){if(!Z.isNumberOrNumberString(C))return C;"undefined"===typeof L&&(L=!0);"undefined"===typeof G&&(G=2);G={format:{places:G,digitSeparator:L}};L=m.locale;L="ar"===L||"tr"===L;C=Number(C);var P=!1;0>C&&(P=!0,C=Math.abs(C));C=Z.localizeNumberByFieldInfo(100*
C,G);C=L?"%"+C:C+"%";P&&(C=window.isRTL?C+"-":"-"+C);return C};Z.getClientFeaturesFromMap=function(C,G,L,P){var T=[],Y=!1;if(G){L?0<G.getSelectedFeatures().length?(T=G.getSelectedFeatures(),Y=!0):T=G.graphics:T=G.graphics;P&&(T=Z.filterFeaturesByExtent(C.extent,T));if(T&&0<T.length){var fa=Z.getObjectIdField(G);fa&&(C=T[0])&&C.attributes&&C.attributes.hasOwnProperty(fa)&&T.sort(function(ja,ka){ja.attributes||(ja.attributes={});ka.attributes||(ka.attributes={});ja=ja.attributes[fa];ka=ka.attributes[fa];
return ja<ka?-1:ja>ka?1:0})}T.isSelectedFeatures=Y;return T}};Z.filterFeaturesByExtent=function(C,G){var L=C.normalize();return G=q.filter(G,E.hitch(this,function(P){try{if(P.geometry){var T="point"===P.geometry.type||"multipoint"===P.geometry;return q.some(L,E.hitch(this,function(Y){return T?Y.contains(P.geometry):x.intersects(Y,P.geometry)}))}}catch(Y){console.error(Y)}return!1}))};Z.upperCaseString=function(C){return C&&"string"===typeof C?C.toUpperCase():C};Z.lowerCaseString=function(C){return C&&
"string"===typeof C?C.toLowerCase():C};Z.getSubstituteString=function(C,G){return h.substitute({value:C},G)};Z.getUUID=function(){function C(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return C()+C()+"_"+C()+"_"+C()+"_"+C()+"_"+C()+C()+C()};Z.getStyleColorInTheme=function(C){var G=new k;if(window&&window.isBuilder){var L="./stemapp/themes/";var P=window.appConfig}else L="./themes/",P=window.getAppConfig();if(P&&P.theme.customStyles&&P.theme.customStyles.mainBackgroundColor)return G.resolve(P.theme.customStyles.mainBackgroundColor),
G.promise;var T=P.theme.name,Y=P.theme.styles[0];C&&(Y=C);J({url:L+T+"/manifest.json",handleAs:"json"}).then(E.hitch(this,function(fa){if(fa&&fa.styles){fa=fa.styles;for(var ja=0;ja<fa.length;ja++){var ka=fa[ja];ka.name===Y&&G.resolve(ka.styleColor)}}}),E.hitch(this,function(fa){console.error(fa);G.reject(null)}));return G.promise};Z.themesHeaderLogoA11y=function(C,G,L){C.logoLink?(A.setAttr(L.link,"href",C.logoLink),A.setAttr(L.link,"tabIndex",G),A.setAttr(L.link,"target","_blank"),A.setAttr(L.logo,
"alt",C.logoLink),A.setStyle(L.icon,"cursor","pointer")):(A.setAttr(L.link,"href","javascript:void(0)"),A.setAttr(L.link,"tabIndex",-1),A.setAttr(L.link,"target",""),A.removeAttr(L.logo,"alt"),A.setAttr(L.logo,"role","presentation"),A.setStyle(L.icon,"cursor","default"));C.logoAlt&&A.setAttr(L.logo,"alt",C.logoAlt)};return Z})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(E,q,A){var w=E.NodeList;q.extend(w,{_buildArrayFromCallback:function(m){for(var v=
[],r=0;r<this.length;r++){var l=m.call(this[r],this[r],v);l&&(v=v.concat(l))}return v},_getUniqueAsNodeList:function(m){for(var v=[],r=0,l;l=m[r];r++)1==l.nodeType&&-1==A.indexOf(v,l)&&v.push(l);return this._wrap(v,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(m,v){m=this._getUniqueAsNodeList(m);m=v?E._filterResult(m,v):m;return m._stash(this)},_getRelatedUniqueNodes:function(m,v){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(v),m)},children:function(m){return this._getRelatedUniqueNodes(m,
function(v,r){return q._toArray(v.childNodes)})},closest:function(m,v){return this._getRelatedUniqueNodes(null,function(r,l){do if(E._filterResult([r],m,v).length)return r;while(r!=v&&(r=r.parentNode)&&1==r.nodeType);return null})},parent:function(m){return this._getRelatedUniqueNodes(m,function(v,r){return v.parentNode})},parents:function(m){return this._getRelatedUniqueNodes(m,function(v,r){for(r=[];v.parentNode;)v=v.parentNode,r.push(v);return r})},siblings:function(m){return this._getRelatedUniqueNodes(m,
function(v,r){r=[];for(var l=v.parentNode&&v.parentNode.childNodes,k=0;k<l.length;k++)l[k]!=v&&r.push(l[k]);return r})},next:function(m){return this._getRelatedUniqueNodes(m,function(v,r){for(v=v.nextSibling;v&&1!=v.nodeType;)v=v.nextSibling;return v})},nextAll:function(m){return this._getRelatedUniqueNodes(m,function(v,r){for(r=[];v=v.nextSibling;)1==v.nodeType&&r.push(v);return r})},prev:function(m){return this._getRelatedUniqueNodes(m,function(v,r){for(v=v.previousSibling;v&&1!=v.nodeType;)v=v.previousSibling;
return v})},prevAll:function(m){return this._getRelatedUniqueNodes(m,function(v,r){for(r=[];v=v.previousSibling;)1==v.nodeType&&r.push(v);return r})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(m,v){return 0!=v%2})},odd:function(){return this.filter(function(m,v){return 0==v%2})}});return w})},"dojo/cookie":function(){define(["./_base/kernel",
"./regexp"],function(E,q){E.cookie=function(A,w,m){var v=document.cookie;if(1==arguments.length)var r=(r=v.match(new RegExp("(?:^|; )"+q.escapeString(A)+"\x3d([^;]*)")))?decodeURIComponent(r[1]):void 0;else{m=m||{};v=m.expires;if("number"==typeof v){var l=new Date;l.setTime(l.getTime()+864E5*v);v=m.expires=l}v&&v.toUTCString&&(m.expires=v.toUTCString());w=encodeURIComponent(w);v=A+"\x3d"+w;for(var k in m)v+="; "+k,l=m[k],!0!==l&&(v+="\x3d"+l);document.cookie=v}return r};E.cookie.isSupported=function(){"cookieEnabled"in
navigator||(this("__djCookieTest__","CookiesAllowed"),navigator.cookieEnabled="CookiesAllowed"==this("__djCookieTest__"),navigator.cookieEnabled&&this("__djCookieTest__","",{expires:-1}));return navigator.cookieEnabled};return E.cookie})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],function(E){E=E.getObject("dojox.encoding.base64",!0);E.encode=function(q){var A=[],w=q.length,m=w%3;w-=m;for(var v=0;v<w;){var r=q[v++]<<16|q[v++]<<8|q[v++];A.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>
18&63));A.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>12&63));A.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>6&63));A.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r&63))}switch(m){case 2:r=q[v++]<<16|q[v++]<<8;A.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>18&63));A.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>12&
63));A.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>6&63));A.push("\x3d");break;case 1:r=q[v++]<<16,A.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>18&63)),A.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>12&63)),A.push("\x3d"),A.push("\x3d")}return A.join("")};E.decode=function(q){q=q.split("");for(var A=[],w=q.length;"\x3d"==q[--w];);for(var m=0;m<w;){var v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(q[m++])<<
18;m<=w&&(v|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(q[m++])<<12);m<=w&&(v|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(q[m++])<<6);m<=w&&(v|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(q[m++]));A.push(v>>>16&255);A.push(v>>>8&255);A.push(v&255)}for(;0==A[A.length-1];)A.pop();return A};return E})},"moment/moment":function(){(function(E,q){"object"===typeof exports&&"undefined"!==typeof module?module.exports=
q():"function"===typeof define&&define.amd?define(q):E.moment=q()})(this,function(){function E(){return Bc.apply(null,arguments)}function q(F){return F instanceof Array||"[object Array]"===Object.prototype.toString.call(F)}function A(F){return null!=F&&"[object Object]"===Object.prototype.toString.call(F)}function w(F,K){return Object.prototype.hasOwnProperty.call(F,K)}function m(F){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(F).length;for(var K in F)if(w(F,K))return!1;return!0}
function v(F){return void 0===F}function r(F){return"number"===typeof F||"[object Number]"===Object.prototype.toString.call(F)}function l(F){return F instanceof Date||"[object Date]"===Object.prototype.toString.call(F)}function k(F,K){var U=[],ba,qa=F.length;for(ba=0;ba<qa;++ba)U.push(K(F[ba],ba));return U}function n(F,K){for(var U in K)w(K,U)&&(F[U]=K[U]);w(K,"toString")&&(F.toString=K.toString);w(K,"valueOf")&&(F.valueOf=K.valueOf);return F}function d(F,K,U,ba){return Ra(F,K,U,ba,!0).utc()}function c(F){null==
F._pf&&(F._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1});return F._pf}function g(F){if(null==F._isValid){var K=c(F),U=Cc.call(K.parsedDateParts,function(ba){return null!=ba});U=!isNaN(F._d.getTime())&&0>K.overflow&&!K.empty&&!K.invalidEra&&!K.invalidMonth&&!K.invalidWeekday&&!K.weekdayMismatch&&!K.nullInput&&!K.invalidFormat&&
!K.userInvalidated&&(!K.meridiem||K.meridiem&&U);F._strict&&(U=U&&0===K.charsLeftOver&&0===K.unusedTokens.length&&void 0===K.bigHour);if(null!=Object.isFrozen&&Object.isFrozen(F))return U;F._isValid=U}return F._isValid}function b(F){var K=d(NaN);null!=F?n(c(K),F):c(K).userInvalidated=!0;return K}function e(F,K){var U,ba=oc.length;v(K._isAMomentObject)||(F._isAMomentObject=K._isAMomentObject);v(K._i)||(F._i=K._i);v(K._f)||(F._f=K._f);v(K._l)||(F._l=K._l);v(K._strict)||(F._strict=K._strict);v(K._tzm)||
(F._tzm=K._tzm);v(K._isUTC)||(F._isUTC=K._isUTC);v(K._offset)||(F._offset=K._offset);v(K._pf)||(F._pf=c(K));v(K._locale)||(F._locale=K._locale);if(0<ba)for(U=0;U<ba;U++){var qa=oc[U];var Aa=K[qa];v(Aa)||(F[qa]=Aa)}return F}function a(F){e(this,F);this._d=new Date(null!=F._d?F._d.getTime():NaN);this.isValid()||(this._d=new Date(NaN));!1===fc&&(fc=!0,E.updateOffset(this),fc=!1)}function f(F){return F instanceof a||null!=F&&null!=F._isAMomentObject}function h(F){!1===E.suppressDeprecationWarnings&&"undefined"!==
typeof console&&console.warn&&console.warn("Deprecation warning: "+F)}function p(F,K){var U=!0;return n(function(){null!=E.deprecationHandler&&E.deprecationHandler(null,F);if(U){var ba=[],qa,Aa,Ga=arguments.length;for(qa=0;qa<Ga;qa++){var Ja="";if("object"===typeof arguments[qa]){Ja+="\n["+qa+"] ";for(Aa in arguments[0])w(arguments[0],Aa)&&(Ja+=Aa+": "+arguments[0][Aa]+", ");Ja=Ja.slice(0,-2)}else Ja=arguments[qa];ba.push(Ja)}h(F+"\nArguments: "+Array.prototype.slice.call(ba).join("")+"\n"+Error().stack);
U=!1}return K.apply(this,arguments)},K)}function B(F,K){null!=E.deprecationHandler&&E.deprecationHandler(F,K);pc[F]||(h(K),pc[F]=!0)}function u(F){return"undefined"!==typeof Function&&F instanceof Function||"[object Function]"===Object.prototype.toString.call(F)}function t(F,K){var U=n({},F),ba;for(ba in K)w(K,ba)&&(A(F[ba])&&A(K[ba])?(U[ba]={},n(U[ba],F[ba]),n(U[ba],K[ba])):null!=K[ba]?U[ba]=K[ba]:delete U[ba]);for(ba in F)w(F,ba)&&!w(K,ba)&&A(F[ba])&&(U[ba]=n({},U[ba]));return U}function z(F){null!=
F&&this.set(F)}function x(F,K,U){var ba=""+Math.abs(F);return(0<=F?U?"+":"":"-")+Math.pow(10,Math.max(0,K-ba.length)).toString().substr(1)+ba}function y(F,K,U,ba){var qa=ba;"string"===typeof ba&&(qa=function(){return this[ba]()});F&&(Kb[F]=qa);K&&(Kb[K[0]]=function(){return x(qa.apply(this,arguments),K[1],K[2])});U&&(Kb[U]=function(){return this.localeData().ordinal(qa.apply(this,arguments),F)})}function D(F){return F.match(/\[[\s\S]/)?F.replace(/^\[|\]$/g,""):F.replace(/\\/g,"")}function H(F){var K=
F.match(gc),U;var ba=0;for(U=K.length;ba<U;ba++)K[ba]=Kb[K[ba]]?Kb[K[ba]]:D(K[ba]);return function(qa){var Aa="",Ga;for(Ga=0;Ga<U;Ga++)Aa+=u(K[Ga])?K[Ga].call(qa,F):K[Ga];return Aa}}function I(F,K){if(!F.isValid())return F.localeData().invalidDate();K=N(K,F.localeData());hc[K]=hc[K]||H(K);return hc[K](F)}function N(F,K){function U(qa){return K.longDateFormat(qa)||qa}var ba=5;for(Yb.lastIndex=0;0<=ba&&Yb.test(F);)F=F.replace(Yb,U),Yb.lastIndex=0,--ba;return F}function S(F,K){var U=F.toLowerCase();
Sb[U]=Sb[U+"s"]=Sb[K]=F}function M(F){return"string"===typeof F?Sb[F]||Sb[F.toLowerCase()]:void 0}function Q(F){var K={},U,ba;for(ba in F)w(F,ba)&&(U=M(ba))&&(K[U]=F[ba]);return K}function da(F){var K=[],U;for(U in F)w(F,U)&&K.push({unit:U,priority:fb[U]});K.sort(function(ba,qa){return ba.priority-qa.priority});return K}function J(F){return 0===F%4&&0!==F%100||0===F%400}function R(F){return 0>F?Math.ceil(F)||0:Math.floor(F)}function W(F){F=+F;var K=0;0!==F&&isFinite(F)&&(K=R(F));return K}function X(F,
K){return function(U){return null!=U?(ma(this,F,U),E.updateOffset(this,K),this):ia(this,F)}}function ia(F,K){return F.isValid()?F._d["get"+(F._isUTC?"UTC":"")+K]():NaN}function ma(F,K,U){if(F.isValid()&&!isNaN(U))if("FullYear"===K&&J(F.year())&&1===F.month()&&29===F.date())U=W(U),F._d["set"+(F._isUTC?"UTC":"")+K](U,F.month(),ra(U,F.month()));else F._d["set"+(F._isUTC?"UTC":"")+K](U)}function ha(F,K,U){ic[F]=u(K)?K:function(ba,qa){return ba&&U?U:K}}function xa(F){return ua(F.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,
function(K,U,ba,qa,Aa){return U||ba||qa||Aa}))}function ua(F){return F.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$\x26")}function na(F,K){var U,ba=K;"string"===typeof F&&(F=[F]);r(K)&&(ba=function(Aa,Ga){Ga[K]=W(Aa)});var qa=F.length;for(U=0;U<qa;U++)jc[F[U]]=ba}function va(F,K){na(F,function(U,ba,qa,Aa){qa._w=qa._w||{};K(U,qa._w,qa,Aa)})}function ra(F,K){if(isNaN(F)||isNaN(K))return NaN;var U=(K%12+12)%12;F+=(K-U)/12;return 1===U?J(F)?29:28:31-U%7%2}function wa(F,K){if(!F.isValid())return F;if("string"===
typeof K)if(/^\d+$/.test(K))K=W(K);else if(K=F.localeData().monthsParse(K),!r(K))return F;var U=Math.min(F.date(),ra(F.year(),K));F._d["set"+(F._isUTC?"UTC":"")+"Month"](K,U);return F}function Z(F){return null!=F?(wa(this,F),E.updateOffset(this,!0),this):ia(this,"Month")}function Da(){function F(Ga,Ja){return Ja.length-Ga.length}var K=[],U=[],ba=[],qa;for(qa=0;12>qa;qa++){var Aa=d([2E3,qa]);K.push(this.monthsShort(Aa,""));U.push(this.months(Aa,""));ba.push(this.months(Aa,""));ba.push(this.monthsShort(Aa,
""))}K.sort(F);U.sort(F);ba.sort(F);for(qa=0;12>qa;qa++)K[qa]=ua(K[qa]),U[qa]=ua(U[qa]);for(qa=0;24>qa;qa++)ba[qa]=ua(ba[qa]);this._monthsShortRegex=this._monthsRegex=new RegExp("^("+ba.join("|")+")","i");this._monthsStrictRegex=new RegExp("^("+U.join("|")+")","i");this._monthsShortStrictRegex=new RegExp("^("+K.join("|")+")","i")}function Ca(F,K,U,ba,qa,Aa,Ga){100>F&&0<=F?(K=new Date(F+400,K,U,ba,qa,Aa,Ga),isFinite(K.getFullYear())&&K.setFullYear(F)):K=new Date(F,K,U,ba,qa,Aa,Ga);return K}function O(F){if(100>
F&&0<=F){var K=Array.prototype.slice.call(arguments);K[0]=F+400;K=new Date(Date.UTC.apply(null,K));isFinite(K.getUTCFullYear())&&K.setUTCFullYear(F)}else K=new Date(Date.UTC.apply(null,arguments));return K}function C(F,K,U){U=7+K-U;return-((7+O(F,0,U).getUTCDay()-K)%7)+U-1}function G(F,K,U,ba,qa){U=(7+U-ba)%7;ba=C(F,ba,qa);ba=1+7*(K-1)+U+ba;0>=ba?(K=F-1,F=(J(K)?366:365)+ba):ba>(J(F)?366:365)?(K=F+1,F=ba-(J(F)?366:365)):(K=F,F=ba);return{year:K,dayOfYear:F}}function L(F,K,U){var ba=C(F.year(),K,U);
ba=Math.floor((F.dayOfYear()-ba-1)/7)+1;1>ba?(F=F.year()-1,K=ba+P(F,K,U)):ba>P(F.year(),K,U)?(K=ba-P(F.year(),K,U),F=F.year()+1):(F=F.year(),K=ba);return{week:K,year:F}}function P(F,K,U){var ba=C(F,K,U);K=C(F+1,K,U);return((J(F)?366:365)-ba+K)/7}function T(F,K){return F.slice(K,7).concat(F.slice(0,K))}function Y(F,K,U){var ba;F=F.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],ba=0;7>ba;++ba){var qa=d([2E3,1]).day(ba);this._minWeekdaysParse[ba]=
this.weekdaysMin(qa,"").toLocaleLowerCase();this._shortWeekdaysParse[ba]=this.weekdaysShort(qa,"").toLocaleLowerCase();this._weekdaysParse[ba]=this.weekdays(qa,"").toLocaleLowerCase()}if(U)K="dddd"===K?db.call(this._weekdaysParse,F):"ddd"===K?db.call(this._shortWeekdaysParse,F):db.call(this._minWeekdaysParse,F);else if("dddd"===K){K=db.call(this._weekdaysParse,F);if(-1!==K)return K;K=db.call(this._shortWeekdaysParse,F);if(-1!==K)return K;K=db.call(this._minWeekdaysParse,F)}else if("ddd"===K){K=db.call(this._shortWeekdaysParse,
F);if(-1!==K)return K;K=db.call(this._weekdaysParse,F);if(-1!==K)return K;K=db.call(this._minWeekdaysParse,F)}else{K=db.call(this._minWeekdaysParse,F);if(-1!==K)return K;K=db.call(this._weekdaysParse,F);if(-1!==K)return K;K=db.call(this._shortWeekdaysParse,F)}return-1!==K?K:null}function fa(){function F(Oa,Ya){return Ya.length-Oa.length}var K=[],U=[],ba=[],qa=[],Aa;for(Aa=0;7>Aa;Aa++){var Ga=d([2E3,1]).day(Aa);var Ja=ua(this.weekdaysMin(Ga,""));var Pa=ua(this.weekdaysShort(Ga,""));Ga=ua(this.weekdays(Ga,
""));K.push(Ja);U.push(Pa);ba.push(Ga);qa.push(Ja);qa.push(Pa);qa.push(Ga)}K.sort(F);U.sort(F);ba.sort(F);qa.sort(F);this._weekdaysMinRegex=this._weekdaysShortRegex=this._weekdaysRegex=new RegExp("^("+qa.join("|")+")","i");this._weekdaysStrictRegex=new RegExp("^("+ba.join("|")+")","i");this._weekdaysShortStrictRegex=new RegExp("^("+U.join("|")+")","i");this._weekdaysMinStrictRegex=new RegExp("^("+K.join("|")+")","i")}function ja(){return this.hours()%12||12}function ka(F,K){y(F,0,0,function(){return this.localeData().meridiem(this.hours(),
this.minutes(),K)})}function ta(F,K){return K._meridiemParse}function pa(F){return F?F.toLowerCase().replace("_","-"):F}function V(F){var K=null;if(void 0===$a[F]&&"undefined"!==typeof module&&module&&module.exports&&null!=F.match("^[^/\\\\]*$"))try{K=Tb._abbr;var U=require;U("./locale/"+F);ca(K)}catch(ba){$a[F]=null}return $a[F]}function ca(F,K){F&&((K=v(K)?ea(F):aa(F,K))?Tb=K:"undefined"!==typeof console&&console.warn&&console.warn("Locale "+F+" not found. Did you forget to load it?"));return Tb._abbr}
function aa(F,K){if(null!==K){var U=qc;K.abbr=F;if(null!=$a[F])B("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),U=$a[F]._config;else if(null!=K.parentLocale)if(null!=$a[K.parentLocale])U=$a[K.parentLocale]._config;else if(U=V(K.parentLocale),null!=U)U=U._config;else return Ub[K.parentLocale]||
(Ub[K.parentLocale]=[]),Ub[K.parentLocale].push({name:F,config:K}),null;$a[F]=new z(t(U,K));Ub[F]&&Ub[F].forEach(function(ba){aa(ba.name,ba.config)});ca(F);return $a[F]}delete $a[F];return null}function ea(F){var K;F&&F._locale&&F._locale._abbr&&(F=F._locale._abbr);if(!F)return Tb;if(!q(F)){if(K=V(F))return K;F=[F]}a:{K=0;for(var U,ba,qa,Aa;K<F.length;){Aa=pa(F[K]).split("-");U=Aa.length;for(ba=(ba=pa(F[K+1]))?ba.split("-"):null;0<U;){if(qa=V(Aa.slice(0,U).join("-"))){F=qa;break a}if(qa=ba&&ba.length>=
U){b:{qa=void 0;var Ga=Math.min(Aa.length,ba.length);for(qa=0;qa<Ga;qa+=1)if(Aa[qa]!==ba[qa])break b;qa=Ga}qa=qa>=U-1}if(qa)break;U--}K++}F=Tb}return F}function la(F){var K;(K=F._a)&&-2===c(F).overflow&&(K=0>K[sb]||11<K[sb]?sb:1>K[rb]||K[rb]>ra(K[ib],K[sb])?rb:0>K[eb]||24<K[eb]||24===K[eb]&&(0!==K[ob]||0!==K[tb]||0!==K[Db])?eb:0>K[ob]||59<K[ob]?ob:0>K[tb]||59<K[tb]?tb:0>K[Db]||999<K[Db]?Db:-1,c(F)._overflowDayOfYear&&(K<ib||K>rb)&&(K=rb),c(F)._overflowWeeks&&-1===K&&(K=Dc),c(F)._overflowWeekday&&
-1===K&&(K=Ec),c(F).overflow=K);return F}function oa(F){var K=F._i;var U=Fc.exec(K)||Gc.exec(K);var ba=Zb.length;var qa=kc.length;if(U){c(F).iso=!0;for(K=0;K<ba;K++)if(Zb[K][1].exec(U[1])){var Aa=Zb[K][0];var Ga=!1!==Zb[K][2];break}if(null==Aa)F._isValid=!1;else{if(U[3]){K=0;for(ba=qa;K<ba;K++)if(kc[K][1].exec(U[3])){var Ja=(U[2]||" ")+kc[K][0];break}if(null==Ja){F._isValid=!1;return}}if(Ga||null==Ja){if(U[4])if(Hc.exec(U[4]))var Pa="Z";else{F._isValid=!1;return}F._f=Aa+(Ja||"")+(Pa||"");ya(F)}else F._isValid=
!1}}else F._isValid=!1}function za(F){var K=Ic.exec(F._i.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(K){var U=K[3],ba=K[2],qa=K[5],Aa=K[6],Ga=K[7],Ja=parseInt(K[4],10);U=[49>=Ja?2E3+Ja:999>=Ja?1900+Ja:Ja,rc.indexOf(U),parseInt(ba,10),parseInt(qa,10),parseInt(Aa,10)];Ga&&U.push(parseInt(Ga,10));a:{if(Ga=K[1])if(Ga=sc.indexOf(Ga),ba=(new Date(U[0],U[1],U[2])).getDay(),Ga!==ba){c(F).weekdayMismatch=!0;Ga=F._isValid=!1;break a}Ga=!0}Ga&&(F._a=
U,(Ga=K[8])?K=Jc[Ga]:K[9]?K=0:(K=parseInt(K[10],10),Ga=K%100,K=(K-Ga)/100*60+Ga),F._tzm=K,F._d=O.apply(null,F._a),F._d.setUTCMinutes(F._d.getUTCMinutes()-F._tzm),c(F).rfc2822=!0)}else F._isValid=!1}function sa(F){var K=Kc.exec(F._i);null!==K?F._d=new Date(+K[1]):(oa(F),!1===F._isValid&&(delete F._isValid,za(F),!1===F._isValid&&(delete F._isValid,F._strict?F._isValid=!1:E.createFromInputFallback(F))))}function Ea(F,K,U){return null!=F?F:null!=K?K:U}function Ba(F){var K=[];if(!F._d){var U=new Date(E.now());
U=F._useUTC?[U.getUTCFullYear(),U.getUTCMonth(),U.getUTCDate()]:[U.getFullYear(),U.getMonth(),U.getDate()];if(F._w&&null==F._a[rb]&&null==F._a[sb]){var ba=F._w;if(null!=ba.GG||null!=ba.W||null!=ba.E){var qa=1;var Aa=4;var Ga=Ea(ba.GG,F._a[ib],L(Ia(),1,4).year);var Ja=Ea(ba.W,1);var Pa=Ea(ba.E,1);if(1>Pa||7<Pa)var Oa=!0}else if(qa=F._locale._week.dow,Aa=F._locale._week.doy,Ja=L(Ia(),qa,Aa),Ga=Ea(ba.gg,F._a[ib],Ja.year),Ja=Ea(ba.w,Ja.week),null!=ba.d){if(Pa=ba.d,0>Pa||6<Pa)Oa=!0}else if(null!=ba.e){if(Pa=
ba.e+qa,0>ba.e||6<ba.e)Oa=!0}else Pa=qa;1>Ja||Ja>P(Ga,qa,Aa)?c(F)._overflowWeeks=!0:null!=Oa?c(F)._overflowWeekday=!0:(Oa=G(Ga,Ja,Pa,qa,Aa),F._a[ib]=Oa.year,F._dayOfYear=Oa.dayOfYear)}if(null!=F._dayOfYear){Oa=Ea(F._a[ib],U[ib]);if(F._dayOfYear>(J(Oa)?366:365)||0===F._dayOfYear)c(F)._overflowDayOfYear=!0;Oa=O(Oa,0,F._dayOfYear);F._a[sb]=Oa.getUTCMonth();F._a[rb]=Oa.getUTCDate()}for(Oa=0;3>Oa&&null==F._a[Oa];++Oa)F._a[Oa]=K[Oa]=U[Oa];for(;7>Oa;Oa++)F._a[Oa]=K[Oa]=null==F._a[Oa]?2===Oa?1:0:F._a[Oa];
24===F._a[eb]&&0===F._a[ob]&&0===F._a[tb]&&0===F._a[Db]&&(F._nextDay=!0,F._a[eb]=0);F._d=(F._useUTC?O:Ca).apply(null,K);K=F._useUTC?F._d.getUTCDay():F._d.getDay();null!=F._tzm&&F._d.setUTCMinutes(F._d.getUTCMinutes()-F._tzm);F._nextDay&&(F._a[eb]=24);F._w&&"undefined"!==typeof F._w.d&&F._w.d!==K&&(c(F).weekdayMismatch=!0)}}function ya(F){if(F._f===E.ISO_8601)oa(F);else if(F._f===E.RFC_2822)za(F);else{F._a=[];c(F).empty=!0;var K=""+F._i,U,ba=K.length,qa=0;var Aa=N(F._f,F._locale).match(gc)||[];var Ga=
Aa.length;for(U=0;U<Ga;U++){var Ja=Aa[U];var Pa=K;var Oa=Pa.match;var Ya=Ja;var Vb=F;Ya=w(ic,Ya)?ic[Ya](Vb._strict,Vb._locale):new RegExp(xa(Ya));if(Pa=(Oa.call(Pa,Ya)||[])[0])Oa=K.substr(0,K.indexOf(Pa)),0<Oa.length&&c(F).unusedInput.push(Oa),K=K.slice(K.indexOf(Pa)+Pa.length),qa+=Pa.length;if(Kb[Ja]){if(Pa?c(F).empty=!1:c(F).unusedTokens.push(Ja),Oa=F,null!=Pa&&w(jc,Ja))jc[Ja](Pa,Oa._a,Oa,Ja)}else F._strict&&!Pa&&c(F).unusedTokens.push(Ja)}c(F).charsLeftOver=ba-qa;0<K.length&&c(F).unusedInput.push(K);
12>=F._a[eb]&&!0===c(F).bigHour&&0<F._a[eb]&&(c(F).bigHour=void 0);c(F).parsedDateParts=F._a.slice(0);c(F).meridiem=F._meridiem;K=F._a;U=eb;ba=F._locale;Aa=F._a[eb];qa=F._meridiem;null!=qa&&(null!=ba.meridiemHour?Aa=ba.meridiemHour(Aa,qa):null!=ba.isPM&&((ba=ba.isPM(qa))&&12>Aa&&(Aa+=12),ba||12!==Aa||(Aa=0)));K[U]=Aa;K=c(F).era;null!==K&&(F._a[ib]=F._locale.erasConvertYear(K,F._a[ib]));Ba(F);la(F)}}function Ha(F){if(!F._d){var K=Q(F._i);F._a=k([K.year,K.month,void 0===K.day?K.date:K.day,K.hour,K.minute,
K.second,K.millisecond],function(U){return U&&parseInt(U,10)});Ba(F)}}function Na(F){var K=F._i,U=F._f;F._locale=F._locale||ea(F._l);if(null===K||void 0===U&&""===K)return b({nullInput:!0});"string"===typeof K&&(F._i=K=F._locale.preparse(K));if(f(K))return new a(la(K));if(l(K))F._d=K;else if(q(U)){var ba=!1,qa=F._f.length;if(0===qa)c(F).invalidFormat=!0,F._d=new Date(NaN);else{for(K=0;K<qa;K++){U=0;var Aa=!1;var Ga=e({},F);null!=F._useUTC&&(Ga._useUTC=F._useUTC);Ga._f=F._f[K];ya(Ga);g(Ga)&&(Aa=!0);
U+=c(Ga).charsLeftOver;U+=10*c(Ga).unusedTokens.length;c(Ga).score=U;if(ba)U<Ja&&(Ja=U,Pa=Ga);else if(null==Ja||U<Ja||Aa){var Ja=U;var Pa=Ga;Aa&&(ba=!0)}}n(F,Pa||Ga)}}else U?ya(F):Qa(F);g(F)||(F._d=null);return F}function Qa(F){var K=F._i;v(K)?F._d=new Date(E.now()):l(K)?F._d=new Date(K.valueOf()):"string"===typeof K?sa(F):q(K)?(F._a=k(K.slice(0),function(U){return parseInt(U,10)}),Ba(F)):A(K)?Ha(F):r(K)?F._d=new Date(K):E.createFromInputFallback(F)}function Ra(F,K,U,ba,qa){var Aa={};if(!0===K||!1===
K)ba=K,K=void 0;if(!0===U||!1===U)ba=U,U=void 0;if(A(F)&&m(F)||q(F)&&0===F.length)F=void 0;Aa._isAMomentObject=!0;Aa._useUTC=Aa._isUTC=qa;Aa._l=U;Aa._i=F;Aa._f=K;Aa._strict=ba;F=new a(la(Na(Aa)));F._nextDay&&(F.add(1,"d"),F._nextDay=void 0);return F}function Ia(F,K,U,ba){return Ra(F,K,U,ba,!1)}function Xa(F,K){var U;1===K.length&&q(K[0])&&(K=K[0]);if(!K.length)return Ia();var ba=K[0];for(U=1;U<K.length;++U)if(!K[U].isValid()||K[U][F](ba))ba=K[U];return ba}function Va(F){var K=Q(F);F=K.year||0;var U=
K.quarter||0,ba=K.month||0,qa=K.week||K.isoWeek||0,Aa=K.day||0,Ga=K.hour||0,Ja=K.minute||0,Pa=K.second||0,Oa=K.millisecond||0;a:{var Ya,Vb=!1,Lc=Wb.length;for(Ya in K)if(w(K,Ya)&&(-1===db.call(Wb,Ya)||null!=K[Ya]&&isNaN(K[Ya]))){K=!1;break a}for(Ya=0;Ya<Lc;++Ya)if(K[Wb[Ya]]){if(Vb){K=!1;break a}parseFloat(K[Wb[Ya]])!==W(K[Wb[Ya]])&&(Vb=!0)}K=!0}this._isValid=K;this._milliseconds=+Oa+1E3*Pa+6E4*Ja+36E5*Ga;this._days=+Aa+7*qa;this._months=+ba+3*U+12*F;this._data={};this._locale=ea();this._bubble()}
function gb(F){return F instanceof Va}function ab(F){return 0>F?-1*Math.round(-1*F):Math.round(F)}function Ma(F,K){y(F,0,0,function(){var U=this.utcOffset(),ba="+";0>U&&(U=-U,ba="-");return ba+x(~~(U/60),2)+K+x(~~U%60,2)})}function Ka(F,K){F=(K||"").match(F);if(null===F)return null;F=((F[F.length-1]||[])+"").match(Mc)||["-",0,0];K=+(60*F[1])+W(F[2]);return 0===K?0:"+"===F[0]?K:-K}function Wa(F,K){return K._isUTC?(K=K.clone(),F=(f(F)||l(F)?F.valueOf():Ia(F).valueOf())-K.valueOf(),K._d.setTime(K._d.valueOf()+
F),E.updateOffset(K,!1),K):Ia(F).local()}function lb(){return this.isValid()?this._isUTC&&0===this._offset:!1}function Ua(F,K){var U=F,ba=null;gb(F)?U={ms:F._milliseconds,d:F._days,M:F._months}:r(F)||!isNaN(+F)?(U={},K?U[K]=+F:U.milliseconds=+F):(ba=Nc.exec(F))?(U="-"===ba[1]?-1:1,U={y:0,d:W(ba[rb])*U,h:W(ba[eb])*U,m:W(ba[ob])*U,s:W(ba[tb])*U,ms:W(ab(1E3*ba[Db]))*U}):(ba=Oc.exec(F))?(U="-"===ba[1]?-1:1,U={y:La(ba[2],U),M:La(ba[3],U),w:La(ba[4],U),d:La(ba[5],U),h:La(ba[6],U),m:La(ba[7],U),s:La(ba[8],
U)}):null==U?U={}:"object"===typeof U&&("from"in U||"to"in U)&&(ba=Ia(U.from),U=Ia(U.to),ba.isValid()&&U.isValid()?(U=Wa(U,ba),ba.isBefore(U)?U=cb(ba,U):(U=cb(U,ba),U.milliseconds=-U.milliseconds,U.months=-U.months),ba=U):ba={milliseconds:0,months:0},U={},U.ms=ba.milliseconds,U.M=ba.months);U=new Va(U);gb(F)&&w(F,"_locale")&&(U._locale=F._locale);gb(F)&&w(F,"_isValid")&&(U._isValid=F._isValid);return U}function La(F,K){F=F&&parseFloat(F.replace(",","."));return(isNaN(F)?0:F)*K}function cb(F,K){var U=
{};U.months=K.month()-F.month()+12*(K.year()-F.year());F.clone().add(U.months,"M").isAfter(K)&&--U.months;U.milliseconds=+K-+F.clone().add(U.months,"M");return U}function hb(F,K){return function(U,ba){if(null!==ba&&!isNaN(+ba)){B(K,"moment()."+K+"(period, number) is deprecated. Please use moment()."+K+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.");var qa=U;U=ba;ba=qa}U=Ua(U,ba);Lb(this,U,F);return this}}function Lb(F,K,U,ba){var qa=K._milliseconds,
Aa=ab(K._days);K=ab(K._months);F.isValid()&&(ba=null==ba?!0:ba,K&&wa(F,ia(F,"Month")+K*U),Aa&&ma(F,"Date",ia(F,"Date")+Aa*U),qa&&F._d.setTime(F._d.valueOf()+qa*U),ba&&E.updateOffset(F,Aa||K))}function xb(F){return"string"===typeof F||F instanceof String}function jb(F){var K=q(F),U=!1;K&&(U=0===F.filter(function(ba){return!r(ba)&&xb(F)}).length);return K&&U}function yb(F,K){if(F.date()<K.date())return-yb(K,F);var U=12*(K.year()-F.year())+(K.month()-F.month()),ba=F.clone().add(U,"months");0>K-ba?(F=
F.clone().add(U-1,"months"),K=(K-ba)/(ba-F)):(F=F.clone().add(U+1,"months"),K=(K-ba)/(F-ba));return-(U+K)||0}function Mb(F){if(void 0===F)return this._locale._abbr;F=ea(F);null!=F&&(this._locale=F);return this}function Eb(){return this._locale}function pb(F,K){return(F%K+K)%K}function Nb(F,K,U){return 100>F&&0<=F?new Date(F+400,K,U)-126227808E5:(new Date(F,K,U)).valueOf()}function Ob(F,K,U){return 100>F&&0<=F?Date.UTC(F+400,K,U)-126227808E5:Date.UTC(F,K,U)}function Fb(F,K){return K.erasAbbrRegex(F)}
function Gb(){var F=[],K=[],U=[],ba=[],qa,Aa=this.eras();var Ga=0;for(qa=Aa.length;Ga<qa;++Ga)K.push(ua(Aa[Ga].name)),F.push(ua(Aa[Ga].abbr)),U.push(ua(Aa[Ga].narrow)),ba.push(ua(Aa[Ga].name)),ba.push(ua(Aa[Ga].abbr)),ba.push(ua(Aa[Ga].narrow));this._erasRegex=new RegExp("^("+ba.join("|")+")","i");this._erasNameRegex=new RegExp("^("+K.join("|")+")","i");this._erasAbbrRegex=new RegExp("^("+F.join("|")+")","i");this._erasNarrowRegex=new RegExp("^("+U.join("|")+")","i")}function Hb(F,K){y(0,[F,F.length],
0,K)}function bb(F,K,U,ba,qa){if(null==F)return L(this,ba,qa).year;var Aa=P(F,ba,qa);K>Aa&&(K=Aa);F=G(F,K,U,ba,qa);F=O(F.year,0,F.dayOfYear);this.year(F.getUTCFullYear());this.month(F.getUTCMonth());this.date(F.getUTCDate());return this}function ub(F,K){K[Db]=W(1E3*("0."+F))}function qb(F){return F}function kb(F,K,U,ba){var qa=ea();K=d().set(ba,K);return qa[U](K,F)}function Ib(F,K,U){r(F)&&(K=F,F=void 0);F=F||"";if(null!=K)return kb(F,K,U,"month");var ba=[];for(K=0;12>K;K++)ba[K]=kb(F,K,U,"month");
return ba}function zb(F,K,U,ba){"boolean"!==typeof F&&(U=K=F,F=!1);r(K)&&(U=K,K=void 0);K=K||"";var qa=ea();F=F?qa._week.dow:0;qa=[];if(null!=U)return kb(K,(U+F)%7,ba,"day");for(U=0;7>U;U++)qa[U]=kb(K,(U+F)%7,ba,"day");return qa}function Ab(F,K,U,ba){K=Ua(K,U);F._milliseconds+=ba*K._milliseconds;F._days+=ba*K._days;F._months+=ba*K._months;return F._bubble()}function Bb(F){return 0>F?Math.floor(F):Math.ceil(F)}function mb(F){return function(){return this.as(F)}}function Jb(F){return function(){return this.isValid()?
this._data[F]:NaN}}function Pc(F,K,U,ba,qa){return qa.relativeTime(K||1,!!U,F,ba)}function Pb(F){return(0<F)-(0>F)||+F}function $b(){if(!this.isValid())return this.localeData().invalidDate();var F=lc(this._milliseconds)/1E3,K=lc(this._days),U=lc(this._months),ba=this.asSeconds();if(!ba)return"P0D";var qa=R(F/60);var Aa=R(qa/60);F%=60;qa%=60;var Ga=R(U/12);U%=12;var Ja=F?F.toFixed(3).replace(/\.?0+$/,""):"";var Pa=0>ba?"-":"";var Oa=Pb(this._months)!==Pb(ba)?"-":"";var Ya=Pb(this._days)!==Pb(ba)?"-":
"";ba=Pb(this._milliseconds)!==Pb(ba)?"-":"";return Pa+"P"+(Ga?Oa+Ga+"Y":"")+(U?Oa+U+"M":"")+(K?Ya+K+"D":"")+(Aa||qa||F?"T":"")+(Aa?ba+Aa+"H":"")+(qa?ba+qa+"M":"")+(F?ba+Ja+"S":"")}var Cc=Array.prototype.some?Array.prototype.some:function(F){var K=Object(this),U=K.length>>>0,ba;for(ba=0;ba<U;ba++)if(ba in K&&F.call(this,K[ba],ba,K))return!0;return!1};var oc=E.momentProperties=[],fc=!1,pc={};E.suppressDeprecationWarnings=!1;E.deprecationHandler=null;var Qc=Object.keys?Object.keys:function(F){var K,
U=[];for(K in F)w(F,K)&&U.push(K);return U};var gc=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Yb=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,hc={},Kb={},Sb={},fb={},tc=/\d/,nb=/\d\d/,uc=/\d{3}/,mc=/\d{4}/,ac=/[+-]?\d{6}/,Za=/\d\d?/,vc=/\d\d\d\d?/,wc=/\d\d\d\d\d\d?/,bc=/\d{1,3}/,nc=/\d{1,4}/,cc=/[+-]?\d{1,6}/,Qb=/\d+/,dc=/[+-]?\d+/,Rc=/Z|[+-]\d\d:?\d\d/gi,
ec=/Z|[+-]\d\d(?::?\d\d)?/gi,Xb=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;var ic={};var jc={},ib=0,sb=1,rb=2,eb=3,ob=4,tb=5,Db=6,Dc=7,Ec=8;var db=Array.prototype.indexOf?Array.prototype.indexOf:function(F){var K;for(K=0;K<this.length;++K)if(this[K]===F)return K;return-1};y("M",["MM",2],"Mo",function(){return this.month()+1});y("MMM",0,0,function(F){return this.localeData().monthsShort(this,
F)});y("MMMM",0,0,function(F){return this.localeData().months(this,F)});S("month","M");fb.month=8;ha("M",Za);ha("MM",Za,nb);ha("MMM",function(F,K){return K.monthsShortRegex(F)});ha("MMMM",function(F,K){return K.monthsRegex(F)});na(["M","MM"],function(F,K){K[sb]=W(F)-1});na(["MMM","MMMM"],function(F,K,U,ba){ba=U._locale.monthsParse(F,ba,U._strict);null!=ba?K[sb]=ba:c(U).invalidMonth=F});var rc="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),xc=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;y("Y",0,0,
function(){var F=this.year();return 9999>=F?x(F,4):"+"+F});y(0,["YY",2],0,function(){return this.year()%100});y(0,["YYYY",4],0,"year");y(0,["YYYYY",5],0,"year");y(0,["YYYYYY",6,!0],0,"year");S("year","y");fb.year=1;ha("Y",dc);ha("YY",Za,nb);ha("YYYY",nc,mc);ha("YYYYY",cc,ac);ha("YYYYYY",cc,ac);na(["YYYYY","YYYYYY"],ib);na("YYYY",function(F,K){K[ib]=2===F.length?E.parseTwoDigitYear(F):W(F)});na("YY",function(F,K){K[ib]=E.parseTwoDigitYear(F)});na("Y",function(F,K){K[ib]=parseInt(F,10)});E.parseTwoDigitYear=
function(F){return W(F)+(68<W(F)?1900:2E3)};var yc=X("FullYear",!0);y("w",["ww",2],"wo","week");y("W",["WW",2],"Wo","isoWeek");S("week","w");S("isoWeek","W");fb.week=5;fb.isoWeek=5;ha("w",Za);ha("ww",Za,nb);ha("W",Za);ha("WW",Za,nb);va(["w","ww","W","WW"],function(F,K,U,ba){K[ba.substr(0,1)]=W(F)});y("d",0,"do","day");y("dd",0,0,function(F){return this.localeData().weekdaysMin(this,F)});y("ddd",0,0,function(F){return this.localeData().weekdaysShort(this,F)});y("dddd",0,0,function(F){return this.localeData().weekdays(this,
F)});y("e",0,0,"weekday");y("E",0,0,"isoWeekday");S("day","d");S("weekday","e");S("isoWeekday","E");fb.day=11;fb.weekday=11;fb.isoWeekday=11;ha("d",Za);ha("e",Za);ha("E",Za);ha("dd",function(F,K){return K.weekdaysMinRegex(F)});ha("ddd",function(F,K){return K.weekdaysShortRegex(F)});ha("dddd",function(F,K){return K.weekdaysRegex(F)});va(["dd","ddd","dddd"],function(F,K,U,ba){ba=U._locale.weekdaysParse(F,ba,U._strict);null!=ba?K.d=ba:c(U).invalidWeekday=F});va(["d","e","E"],function(F,K,U,ba){K[ba]=
W(F)});var sc="Sun Mon Tue Wed Thu Fri Sat".split(" ");y("H",["HH",2],0,"hour");y("h",["hh",2],0,ja);y("k",["kk",2],0,function(){return this.hours()||24});y("hmm",0,0,function(){return""+ja.apply(this)+x(this.minutes(),2)});y("hmmss",0,0,function(){return""+ja.apply(this)+x(this.minutes(),2)+x(this.seconds(),2)});y("Hmm",0,0,function(){return""+this.hours()+x(this.minutes(),2)});y("Hmmss",0,0,function(){return""+this.hours()+x(this.minutes(),2)+x(this.seconds(),2)});ka("a",!0);ka("A",!1);S("hour",
"h");fb.hour=13;ha("a",ta);ha("A",ta);ha("H",Za);ha("h",Za);ha("k",Za);ha("HH",Za,nb);ha("hh",Za,nb);ha("kk",Za,nb);ha("hmm",vc);ha("hmmss",wc);ha("Hmm",vc);ha("Hmmss",wc);na(["H","HH"],eb);na(["k","kk"],function(F,K,U){F=W(F);K[eb]=24===F?0:F});na(["a","A"],function(F,K,U){U._isPm=U._locale.isPM(F);U._meridiem=F});na(["h","hh"],function(F,K,U){K[eb]=W(F);c(U).bigHour=!0});na("hmm",function(F,K,U){var ba=F.length-2;K[eb]=W(F.substr(0,ba));K[ob]=W(F.substr(ba));c(U).bigHour=!0});na("hmmss",function(F,
K,U){var ba=F.length-4,qa=F.length-2;K[eb]=W(F.substr(0,ba));K[ob]=W(F.substr(ba,2));K[tb]=W(F.substr(qa));c(U).bigHour=!0});na("Hmm",function(F,K,U){U=F.length-2;K[eb]=W(F.substr(0,U));K[ob]=W(F.substr(U))});na("Hmmss",function(F,K,U){U=F.length-4;var ba=F.length-2;K[eb]=W(F.substr(0,U));K[ob]=W(F.substr(U,2));K[tb]=W(F.substr(ba))});var Sc=X("Hours",!0),qc={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",
sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:"January February March April May June July August September October November December".split(" "),
monthsShort:rc,week:{dow:0,doy:6},weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),weekdaysMin:"Su Mo Tu We Th Fr Sa".split(" "),weekdaysShort:sc,meridiemParse:/[ap]\.?m?\.?/i},$a={},Ub={},Tb,Fc=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Gc=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,
Hc=/Z|[+-]\d\d(?::?\d\d)?/,Zb=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],kc=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],
["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Kc=/^\/?Date\((-?\d+)/i,Ic=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Jc={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};E.createFromInputFallback=p("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",
function(F){F._d=new Date(F._i+(F._useUTC?" UTC":""))});E.ISO_8601=function(){};E.RFC_2822=function(){};var Tc=p("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var F=Ia.apply(null,arguments);return this.isValid()&&F.isValid()?F<this?this:F:b()}),Uc=p("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var F=Ia.apply(null,arguments);return this.isValid()&&F.isValid()?F>this?
this:F:b()}),Wb="year quarter month week day hour minute second millisecond".split(" ");Ma("Z",":");Ma("ZZ","");ha("Z",ec);ha("ZZ",ec);na(["Z","ZZ"],function(F,K,U){U._useUTC=!0;U._tzm=Ka(ec,F)});var Mc=/([\+\-]|\d\d)/gi;E.updateOffset=function(){};var Nc=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,Oc=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;Ua.fn=Va.prototype;Ua.invalid=
function(){return Ua(NaN)};var Vc=hb(1,"add"),Wc=hb(-1,"subtract");E.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";E.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var zc=p("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(F){return void 0===F?this.localeData():this.locale(F)});y("N",0,0,"eraAbbr");y("NN",0,0,"eraAbbr");y("NNN",0,0,"eraAbbr");y("NNNN",0,0,"eraName");y("NNNNN",0,0,"eraNarrow");y("y",["y",1],
"yo","eraYear");y("y",["yy",2],0,"eraYear");y("y",["yyy",3],0,"eraYear");y("y",["yyyy",4],0,"eraYear");ha("N",Fb);ha("NN",Fb);ha("NNN",Fb);ha("NNNN",function(F,K){return K.erasNameRegex(F)});ha("NNNNN",function(F,K){return K.erasNarrowRegex(F)});na(["N","NN","NNN","NNNN","NNNNN"],function(F,K,U,ba){(K=U._locale.erasParse(F,ba,U._strict))?c(U).era=K:c(U).invalidEra=F});ha("y",Qb);ha("yy",Qb);ha("yyy",Qb);ha("yyyy",Qb);ha("yo",function(F,K){return K._eraYearOrdinalRegex||Qb});na(["y","yy","yyy","yyyy"],
ib);na(["yo"],function(F,K,U,ba){var qa;U._locale._eraYearOrdinalRegex&&(qa=F.match(U._locale._eraYearOrdinalRegex));K[ib]=U._locale.eraYearOrdinalParse?U._locale.eraYearOrdinalParse(F,qa):parseInt(F,10)});y(0,["gg",2],0,function(){return this.weekYear()%100});y(0,["GG",2],0,function(){return this.isoWeekYear()%100});Hb("gggg","weekYear");Hb("ggggg","weekYear");Hb("GGGG","isoWeekYear");Hb("GGGGG","isoWeekYear");S("weekYear","gg");S("isoWeekYear","GG");fb.weekYear=1;fb.isoWeekYear=1;ha("G",dc);ha("g",
dc);ha("GG",Za,nb);ha("gg",Za,nb);ha("GGGG",nc,mc);ha("gggg",nc,mc);ha("GGGGG",cc,ac);ha("ggggg",cc,ac);va(["gggg","ggggg","GGGG","GGGGG"],function(F,K,U,ba){K[ba.substr(0,2)]=W(F)});va(["gg","GG"],function(F,K,U,ba){K[ba]=E.parseTwoDigitYear(F)});y("Q",0,"Qo","quarter");S("quarter","Q");fb.quarter=7;ha("Q",tc);na("Q",function(F,K){K[sb]=3*(W(F)-1)});y("D",["DD",2],"Do","date");S("date","D");fb.date=9;ha("D",Za);ha("DD",Za,nb);ha("Do",function(F,K){return F?K._dayOfMonthOrdinalParse||K._ordinalParse:
K._dayOfMonthOrdinalParseLenient});na(["D","DD"],rb);na("Do",function(F,K){K[rb]=W(F.match(Za)[0])});var Ac=X("Date",!0);y("DDD",["DDDD",3],"DDDo","dayOfYear");S("dayOfYear","DDD");fb.dayOfYear=4;ha("DDD",bc);ha("DDDD",uc);na(["DDD","DDDD"],function(F,K,U){U._dayOfYear=W(F)});y("m",["mm",2],0,"minute");S("minute","m");fb.minute=14;ha("m",Za);ha("mm",Za,nb);na(["m","mm"],ob);var Xc=X("Minutes",!1);y("s",["ss",2],0,"second");S("second","s");fb.second=15;ha("s",Za);ha("ss",Za,nb);na(["s","ss"],tb);var Yc=
X("Seconds",!1);y("S",0,0,function(){return~~(this.millisecond()/100)});y(0,["SS",2],0,function(){return~~(this.millisecond()/10)});y(0,["SSS",3],0,"millisecond");y(0,["SSSS",4],0,function(){return 10*this.millisecond()});y(0,["SSSSS",5],0,function(){return 100*this.millisecond()});y(0,["SSSSSS",6],0,function(){return 1E3*this.millisecond()});y(0,["SSSSSSS",7],0,function(){return 1E4*this.millisecond()});y(0,["SSSSSSSS",8],0,function(){return 1E5*this.millisecond()});y(0,["SSSSSSSSS",9],0,function(){return 1E6*
this.millisecond()});S("millisecond","ms");fb.millisecond=16;ha("S",bc,tc);ha("SS",bc,nb);ha("SSS",bc,uc);var Cb;for(Cb="SSSS";9>=Cb.length;Cb+="S")ha(Cb,Qb);for(Cb="S";9>=Cb.length;Cb+="S")na(Cb,ub);var Zc=X("Milliseconds",!1);y("z",0,0,"zoneAbbr");y("zz",0,0,"zoneName");var Fa=a.prototype;Fa.add=Vc;Fa.calendar=function(F,K){if(1===arguments.length)if(arguments[0]){var U=arguments[0],ba;if(!(ba=f(U)||l(U)||xb(U)||r(U)||jb(U))){ba=A(U)&&!m(U);var qa=!1,Aa="years year y months month M days day d dates date D hours hour h minutes minute m seconds second s milliseconds millisecond ms".split(" "),
Ga,Ja=Aa.length;for(Ga=0;Ga<Ja;Ga+=1){var Pa=Aa[Ga];qa=qa||w(U,Pa)}ba=ba&&qa}if(ba||null===U||void 0===U)F=arguments[0],K=void 0;else{U=arguments[0];ba=A(U)&&!m(U);qa=!1;Aa="sameDay nextDay lastDay nextWeek lastWeek sameElse".split(" ");for(Ga=0;Ga<Aa.length;Ga+=1)Pa=Aa[Ga],qa=qa||w(U,Pa);ba&&qa&&(K=arguments[0],F=void 0)}}else K=F=void 0;U=F||Ia();ba=Wa(U,this).startOf("day");ba=E.calendarFormat(this,ba)||"sameElse";qa=K&&(u(K[ba])?K[ba].call(this,U):K[ba]);return this.format(qa||this.localeData().calendar(ba,
this,Ia(U)))};Fa.clone=function(){return new a(this)};Fa.diff=function(F,K,U){if(!this.isValid())return NaN;F=Wa(F,this);if(!F.isValid())return NaN;var ba=6E4*(F.utcOffset()-this.utcOffset());K=M(K);switch(K){case "year":K=yb(this,F)/12;break;case "month":K=yb(this,F);break;case "quarter":K=yb(this,F)/3;break;case "second":K=(this-F)/1E3;break;case "minute":K=(this-F)/6E4;break;case "hour":K=(this-F)/36E5;break;case "day":K=(this-F-ba)/864E5;break;case "week":K=(this-F-ba)/6048E5;break;default:K=
this-F}return U?K:R(K)};Fa.endOf=function(F){F=M(F);if(void 0===F||"millisecond"===F||!this.isValid())return this;var K=this._isUTC?Ob:Nb;switch(F){case "year":var U=K(this.year()+1,0,1)-1;break;case "quarter":U=K(this.year(),this.month()-this.month()%3+3,1)-1;break;case "month":U=K(this.year(),this.month()+1,1)-1;break;case "week":U=K(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case "isoWeek":U=K(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case "day":case "date":U=
K(this.year(),this.month(),this.date()+1)-1;break;case "hour":U=this._d.valueOf();U+=36E5-pb(U+(this._isUTC?0:6E4*this.utcOffset()),36E5)-1;break;case "minute":U=this._d.valueOf();U+=6E4-pb(U,6E4)-1;break;case "second":U=this._d.valueOf(),U+=1E3-pb(U,1E3)-1}this._d.setTime(U);E.updateOffset(this,!0);return this};Fa.format=function(F){F||(F=this.isUtc()?E.defaultFormatUtc:E.defaultFormat);F=I(this,F);return this.localeData().postformat(F)};Fa.from=function(F,K){return this.isValid()&&(f(F)&&F.isValid()||
Ia(F).isValid())?Ua({to:this,from:F}).locale(this.locale()).humanize(!K):this.localeData().invalidDate()};Fa.fromNow=function(F){return this.from(Ia(),F)};Fa.to=function(F,K){return this.isValid()&&(f(F)&&F.isValid()||Ia(F).isValid())?Ua({from:this,to:F}).locale(this.locale()).humanize(!K):this.localeData().invalidDate()};Fa.toNow=function(F){return this.to(Ia(),F)};Fa.get=function(F){F=M(F);return u(this[F])?this[F]():this};Fa.invalidAt=function(){return c(this).overflow};Fa.isAfter=function(F,K){F=
f(F)?F:Ia(F);if(!this.isValid()||!F.isValid())return!1;K=M(K)||"millisecond";return"millisecond"===K?this.valueOf()>F.valueOf():F.valueOf()<this.clone().startOf(K).valueOf()};Fa.isBefore=function(F,K){F=f(F)?F:Ia(F);if(!this.isValid()||!F.isValid())return!1;K=M(K)||"millisecond";return"millisecond"===K?this.valueOf()<F.valueOf():this.clone().endOf(K).valueOf()<F.valueOf()};Fa.isBetween=function(F,K,U,ba){F=f(F)?F:Ia(F);K=f(K)?K:Ia(K);if(!(this.isValid()&&F.isValid()&&K.isValid()))return!1;ba=ba||
"()";return("("===ba[0]?this.isAfter(F,U):!this.isBefore(F,U))&&(")"===ba[1]?this.isBefore(K,U):!this.isAfter(K,U))};Fa.isSame=function(F,K){F=f(F)?F:Ia(F);if(!this.isValid()||!F.isValid())return!1;K=M(K)||"millisecond";if("millisecond"===K)return this.valueOf()===F.valueOf();F=F.valueOf();return this.clone().startOf(K).valueOf()<=F&&F<=this.clone().endOf(K).valueOf()};Fa.isSameOrAfter=function(F,K){return this.isSame(F,K)||this.isAfter(F,K)};Fa.isSameOrBefore=function(F,K){return this.isSame(F,K)||
this.isBefore(F,K)};Fa.isValid=function(){return g(this)};Fa.lang=zc;Fa.locale=Mb;Fa.localeData=Eb;Fa.max=Uc;Fa.min=Tc;Fa.parsingFlags=function(){return n({},c(this))};Fa.set=function(F,K){if("object"===typeof F){F=Q(F);K=da(F);var U,ba=K.length;for(U=0;U<ba;U++)this[K[U].unit](F[K[U].unit])}else if(F=M(F),u(this[F]))return this[F](K);return this};Fa.startOf=function(F){F=M(F);if(void 0===F||"millisecond"===F||!this.isValid())return this;var K=this._isUTC?Ob:Nb;switch(F){case "year":var U=K(this.year(),
0,1);break;case "quarter":U=K(this.year(),this.month()-this.month()%3,1);break;case "month":U=K(this.year(),this.month(),1);break;case "week":U=K(this.year(),this.month(),this.date()-this.weekday());break;case "isoWeek":U=K(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case "day":case "date":U=K(this.year(),this.month(),this.date());break;case "hour":U=this._d.valueOf();U-=pb(U+(this._isUTC?0:6E4*this.utcOffset()),36E5);break;case "minute":U=this._d.valueOf();U-=pb(U,6E4);break;
case "second":U=this._d.valueOf(),U-=pb(U,1E3)}this._d.setTime(U);E.updateOffset(this,!0);return this};Fa.subtract=Wc;Fa.toArray=function(){return[this.year(),this.month(),this.date(),this.hour(),this.minute(),this.second(),this.millisecond()]};Fa.toObject=function(){return{years:this.year(),months:this.month(),date:this.date(),hours:this.hours(),minutes:this.minutes(),seconds:this.seconds(),milliseconds:this.milliseconds()}};Fa.toDate=function(){return new Date(this.valueOf())};Fa.toISOString=function(F){if(!this.isValid())return null;
var K=(F=!0!==F)?this.clone().utc():this;return 0>K.year()||9999<K.year()?I(K,F?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):u(Date.prototype.toISOString)?F?this.toDate().toISOString():(new Date(this.valueOf()+6E4*this.utcOffset())).toISOString().replace("Z",I(K,"Z")):I(K,F?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")};Fa.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var F="moment",K="";this.isLocal()||(F=0===this.utcOffset()?"moment.utc":
"moment.parseZone",K="Z");F="["+F+'("]';var U=0<=this.year()&&9999>=this.year()?"YYYY":"YYYYYY";return this.format(F+U+"-MM-DD[T]HH:mm:ss.SSS"+(K+'[")]'))};"undefined"!==typeof Symbol&&null!=Symbol.for&&(Fa[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment\x3c"+this.format()+"\x3e"});Fa.toJSON=function(){return this.isValid()?this.toISOString():null};Fa.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")};Fa.unix=function(){return Math.floor(this.valueOf()/
1E3)};Fa.valueOf=function(){return this._d.valueOf()-6E4*(this._offset||0)};Fa.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}};Fa.eraName=function(){var F,K=this.localeData().eras();var U=0;for(F=K.length;U<F;++U){var ba=this.clone().startOf("day").valueOf();if(K[U].since<=ba&&ba<=K[U].until||K[U].until<=ba&&ba<=K[U].since)return K[U].name}return""};Fa.eraNarrow=function(){var F,K=this.localeData().eras();var U=0;for(F=K.length;U<
F;++U){var ba=this.clone().startOf("day").valueOf();if(K[U].since<=ba&&ba<=K[U].until||K[U].until<=ba&&ba<=K[U].since)return K[U].narrow}return""};Fa.eraAbbr=function(){var F,K=this.localeData().eras();var U=0;for(F=K.length;U<F;++U){var ba=this.clone().startOf("day").valueOf();if(K[U].since<=ba&&ba<=K[U].until||K[U].until<=ba&&ba<=K[U].since)return K[U].abbr}return""};Fa.eraYear=function(){var F,K=this.localeData().eras();var U=0;for(F=K.length;U<F;++U){var ba=K[U].since<=K[U].until?1:-1;var qa=
this.clone().startOf("day").valueOf();if(K[U].since<=qa&&qa<=K[U].until||K[U].until<=qa&&qa<=K[U].since)return(this.year()-E(K[U].since).year())*ba+K[U].offset}return this.year()};Fa.year=yc;Fa.isLeapYear=function(){return J(this.year())};Fa.weekYear=function(F){return bb.call(this,F,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)};Fa.isoWeekYear=function(F){return bb.call(this,F,this.isoWeek(),this.isoWeekday(),1,4)};Fa.quarter=Fa.quarters=function(F){return null==
F?Math.ceil((this.month()+1)/3):this.month(3*(F-1)+this.month()%3)};Fa.month=Z;Fa.daysInMonth=function(){return ra(this.year(),this.month())};Fa.week=Fa.weeks=function(F){var K=this.localeData().week(this);return null==F?K:this.add(7*(F-K),"d")};Fa.isoWeek=Fa.isoWeeks=function(F){var K=L(this,1,4).week;return null==F?K:this.add(7*(F-K),"d")};Fa.weeksInYear=function(){var F=this.localeData()._week;return P(this.year(),F.dow,F.doy)};Fa.weeksInWeekYear=function(){var F=this.localeData()._week;return P(this.weekYear(),
F.dow,F.doy)};Fa.isoWeeksInYear=function(){return P(this.year(),1,4)};Fa.isoWeeksInISOWeekYear=function(){return P(this.isoWeekYear(),1,4)};Fa.date=Ac;Fa.day=Fa.days=function(F){if(!this.isValid())return null!=F?this:NaN;var K=this._isUTC?this._d.getUTCDay():this._d.getDay();if(null!=F){var U=this.localeData();"string"===typeof F&&(isNaN(F)?(F=U.weekdaysParse(F),F="number"===typeof F?F:null):F=parseInt(F,10));return this.add(F-K,"d")}return K};Fa.weekday=function(F){if(!this.isValid())return null!=
F?this:NaN;var K=(this.day()+7-this.localeData()._week.dow)%7;return null==F?K:this.add(F-K,"d")};Fa.isoWeekday=function(F){if(!this.isValid())return null!=F?this:NaN;if(null!=F){var K=this.localeData();F="string"===typeof F?K.weekdaysParse(F)%7||7:isNaN(F)?null:F;return this.day(this.day()%7?F:F-7)}return this.day()||7};Fa.dayOfYear=function(F){var K=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864E5)+1;return null==F?K:this.add(F-K,"d")};Fa.hour=Fa.hours=Sc;Fa.minute=Fa.minutes=
Xc;Fa.second=Fa.seconds=Yc;Fa.millisecond=Fa.milliseconds=Zc;Fa.utcOffset=function(F,K,U){var ba=this._offset||0,qa;if(!this.isValid())return null!=F?this:NaN;if(null!=F){if("string"===typeof F){if(F=Ka(ec,F),null===F)return this}else 16>Math.abs(F)&&!U&&(F*=60);!this._isUTC&&K&&(qa=-Math.round(this._d.getTimezoneOffset()));this._offset=F;this._isUTC=!0;null!=qa&&this.add(qa,"m");ba!==F&&(!K||this._changeInProgress?Lb(this,Ua(F-ba,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,E.updateOffset(this,
!0),this._changeInProgress=null));return this}return this._isUTC?ba:-Math.round(this._d.getTimezoneOffset())};Fa.utc=function(F){return this.utcOffset(0,F)};Fa.local=function(F){this._isUTC&&(this.utcOffset(0,F),this._isUTC=!1,F&&this.subtract(-Math.round(this._d.getTimezoneOffset()),"m"));return this};Fa.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"===typeof this._i){var F=Ka(Rc,this._i);null!=F?this.utcOffset(F):this.utcOffset(0,!0)}return this};Fa.hasAlignedHourOffset=
function(F){if(!this.isValid())return!1;F=F?Ia(F).utcOffset():0;return 0===(this.utcOffset()-F)%60};Fa.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()};Fa.isLocal=function(){return this.isValid()?!this._isUTC:!1};Fa.isUtcOffset=function(){return this.isValid()?this._isUTC:!1};Fa.isUtc=lb;Fa.isUTC=lb;Fa.zoneAbbr=function(){return this._isUTC?"UTC":""};Fa.zoneName=function(){return this._isUTC?"Coordinated Universal Time":
""};Fa.dates=p("dates accessor is deprecated. Use date instead.",Ac);Fa.months=p("months accessor is deprecated. Use month instead",Z);Fa.years=p("years accessor is deprecated. Use year instead",yc);Fa.zone=p("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(F,K){return null!=F?("string"!==typeof F&&(F=-F),this.utcOffset(F,K),this):-this.utcOffset()});Fa.isDSTShifted=p("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",
function(){if(!v(this._isDSTShifted))return this._isDSTShifted;var F={};e(F,this);F=Na(F);if(F._a){var K=F._isUTC?d(F._a):Ia(F._a);var U;if(U=this.isValid()){F=F._a;K=K.toArray();U=Math.min(F.length,K.length);var ba=Math.abs(F.length-K.length),qa=0,Aa;for(Aa=0;Aa<U;Aa++)W(F[Aa])!==W(K[Aa])&&qa++;U=0<qa+ba}this._isDSTShifted=U}else this._isDSTShifted=!1;return this._isDSTShifted});var Ta=z.prototype;Ta.calendar=function(F,K,U){F=this._calendar[F]||this._calendar.sameElse;return u(F)?F.call(K,U):F};
Ta.longDateFormat=function(F){var K=this._longDateFormat[F],U=this._longDateFormat[F.toUpperCase()];if(K||!U)return K;this._longDateFormat[F]=U.match(gc).map(function(ba){return"MMMM"===ba||"MM"===ba||"DD"===ba||"dddd"===ba?ba.slice(1):ba}).join("");return this._longDateFormat[F]};Ta.invalidDate=function(){return this._invalidDate};Ta.ordinal=function(F){return this._ordinal.replace("%d",F)};Ta.preparse=qb;Ta.postformat=qb;Ta.relativeTime=function(F,K,U,ba){var qa=this._relativeTime[U];return u(qa)?
qa(F,K,U,ba):qa.replace(/%d/i,F)};Ta.pastFuture=function(F,K){F=this._relativeTime[0<F?"future":"past"];return u(F)?F(K):F.replace(/%s/i,K)};Ta.set=function(F){var K;for(K in F)if(w(F,K)){var U=F[K];u(U)?this[K]=U:this["_"+K]=U}this._config=F;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)};Ta.eras=function(F,K){var U=this._eras||ea("en")._eras;F=0;for(K=U.length;F<K;++F){switch(typeof U[F].since){case "string":var ba=
E(U[F].since).startOf("day");U[F].since=ba.valueOf()}switch(typeof U[F].until){case "undefined":U[F].until=Infinity;break;case "string":ba=E(U[F].until).startOf("day").valueOf(),U[F].until=ba.valueOf()}}return U};Ta.erasParse=function(F,K,U){var ba,qa=this.eras();F=F.toUpperCase();var Aa=0;for(ba=qa.length;Aa<ba;++Aa){var Ga=qa[Aa].name.toUpperCase();var Ja=qa[Aa].abbr.toUpperCase();var Pa=qa[Aa].narrow.toUpperCase();if(U)switch(K){case "N":case "NN":case "NNN":if(Ja===F)return qa[Aa];break;case "NNNN":if(Ga===
F)return qa[Aa];break;case "NNNNN":if(Pa===F)return qa[Aa]}else if(0<=[Ga,Ja,Pa].indexOf(F))return qa[Aa]}};Ta.erasConvertYear=function(F,K){var U=F.since<=F.until?1:-1;return void 0===K?E(F.since).year():E(F.since).year()+(K-F.offset)*U};Ta.erasAbbrRegex=function(F){w(this,"_erasAbbrRegex")||Gb.call(this);return F?this._erasAbbrRegex:this._erasRegex};Ta.erasNameRegex=function(F){w(this,"_erasNameRegex")||Gb.call(this);return F?this._erasNameRegex:this._erasRegex};Ta.erasNarrowRegex=function(F){w(this,
"_erasNarrowRegex")||Gb.call(this);return F?this._erasNarrowRegex:this._erasRegex};Ta.months=function(F,K){return F?q(this._months)?this._months[F.month()]:this._months[(this._months.isFormat||xc).test(K)?"format":"standalone"][F.month()]:q(this._months)?this._months:this._months.standalone};Ta.monthsShort=function(F,K){return F?q(this._monthsShort)?this._monthsShort[F.month()]:this._monthsShort[xc.test(K)?"format":"standalone"][F.month()]:q(this._monthsShort)?this._monthsShort:this._monthsShort.standalone};
Ta.monthsParse=function(F,K,U){var ba;if(this._monthsParseExact){a:{F=F.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],ba=0;12>ba;++ba){var qa=d([2E3,ba]);this._shortMonthsParse[ba]=this.monthsShort(qa,"").toLocaleLowerCase();this._longMonthsParse[ba]=this.months(qa,"").toLocaleLowerCase()}if(U)K="MMM"===K?db.call(this._shortMonthsParse,F):db.call(this._longMonthsParse,F);else if("MMM"===K){K=db.call(this._shortMonthsParse,F);
if(-1!==K)break a;K=db.call(this._longMonthsParse,F)}else{K=db.call(this._longMonthsParse,F);if(-1!==K)break a;K=db.call(this._shortMonthsParse,F)}K=-1!==K?K:null}return K}this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]);for(ba=0;12>ba;ba++)if(qa=d([2E3,ba]),U&&!this._longMonthsParse[ba]&&(this._longMonthsParse[ba]=new RegExp("^"+this.months(qa,"").replace(".","")+"$","i"),this._shortMonthsParse[ba]=new RegExp("^"+this.monthsShort(qa,"").replace(".","")+
"$","i")),U||this._monthsParse[ba]||(qa="^"+this.months(qa,"")+"|^"+this.monthsShort(qa,""),this._monthsParse[ba]=new RegExp(qa.replace(".",""),"i")),U&&"MMMM"===K&&this._longMonthsParse[ba].test(F)||U&&"MMM"===K&&this._shortMonthsParse[ba].test(F)||!U&&this._monthsParse[ba].test(F))return ba};Ta.monthsRegex=function(F){if(this._monthsParseExact)return w(this,"_monthsRegex")||Da.call(this),F?this._monthsStrictRegex:this._monthsRegex;w(this,"_monthsRegex")||(this._monthsRegex=Xb);return this._monthsStrictRegex&&
F?this._monthsStrictRegex:this._monthsRegex};Ta.monthsShortRegex=function(F){if(this._monthsParseExact)return w(this,"_monthsRegex")||Da.call(this),F?this._monthsShortStrictRegex:this._monthsShortRegex;w(this,"_monthsShortRegex")||(this._monthsShortRegex=Xb);return this._monthsShortStrictRegex&&F?this._monthsShortStrictRegex:this._monthsShortRegex};Ta.week=function(F){return L(F,this._week.dow,this._week.doy).week};Ta.firstDayOfYear=function(){return this._week.doy};Ta.firstDayOfWeek=function(){return this._week.dow};
Ta.weekdays=function(F,K){K=q(this._weekdays)?this._weekdays:this._weekdays[F&&!0!==F&&this._weekdays.isFormat.test(K)?"format":"standalone"];return!0===F?T(K,this._week.dow):F?K[F.day()]:K};Ta.weekdaysMin=function(F){return!0===F?T(this._weekdaysMin,this._week.dow):F?this._weekdaysMin[F.day()]:this._weekdaysMin};Ta.weekdaysShort=function(F){return!0===F?T(this._weekdaysShort,this._week.dow):F?this._weekdaysShort[F.day()]:this._weekdaysShort};Ta.weekdaysParse=function(F,K,U){var ba;if(this._weekdaysParseExact)return Y.call(this,
F,K,U);this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]);for(ba=0;7>ba;ba++){var qa=d([2E3,1]).day(ba);U&&!this._fullWeekdaysParse[ba]&&(this._fullWeekdaysParse[ba]=new RegExp("^"+this.weekdays(qa,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[ba]=new RegExp("^"+this.weekdaysShort(qa,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[ba]=new RegExp("^"+this.weekdaysMin(qa,"").replace(".","\\.?")+"$","i"));
this._weekdaysParse[ba]||(qa="^"+this.weekdays(qa,"")+"|^"+this.weekdaysShort(qa,"")+"|^"+this.weekdaysMin(qa,""),this._weekdaysParse[ba]=new RegExp(qa.replace(".",""),"i"));if(U&&"dddd"===K&&this._fullWeekdaysParse[ba].test(F)||U&&"ddd"===K&&this._shortWeekdaysParse[ba].test(F)||U&&"dd"===K&&this._minWeekdaysParse[ba].test(F)||!U&&this._weekdaysParse[ba].test(F))return ba}};Ta.weekdaysRegex=function(F){if(this._weekdaysParseExact)return w(this,"_weekdaysRegex")||fa.call(this),F?this._weekdaysStrictRegex:
this._weekdaysRegex;w(this,"_weekdaysRegex")||(this._weekdaysRegex=Xb);return this._weekdaysStrictRegex&&F?this._weekdaysStrictRegex:this._weekdaysRegex};Ta.weekdaysShortRegex=function(F){if(this._weekdaysParseExact)return w(this,"_weekdaysRegex")||fa.call(this),F?this._weekdaysShortStrictRegex:this._weekdaysShortRegex;w(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Xb);return this._weekdaysShortStrictRegex&&F?this._weekdaysShortStrictRegex:this._weekdaysShortRegex};Ta.weekdaysMinRegex=function(F){if(this._weekdaysParseExact)return w(this,
"_weekdaysRegex")||fa.call(this),F?this._weekdaysMinStrictRegex:this._weekdaysMinRegex;w(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Xb);return this._weekdaysMinStrictRegex&&F?this._weekdaysMinStrictRegex:this._weekdaysMinRegex};Ta.isPM=function(F){return"p"===(F+"").toLowerCase().charAt(0)};Ta.meridiem=function(F,K,U){return 11<F?U?"pm":"PM":U?"am":"AM"};ca("en",{eras:[{since:"0001-01-01",until:Infinity,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-Infinity,
offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(F){var K=F%10;K=1===W(F%100/10)?"th":1===K?"st":2===K?"nd":3===K?"rd":"th";return F+K}});E.lang=p("moment.lang is deprecated. Use moment.locale instead.",ca);E.langData=p("moment.langData is deprecated. Use moment.localeData instead.",ea);var vb=Math.abs,$c=mb("ms"),ad=mb("s"),bd=mb("m"),cd=mb("h"),dd=mb("d"),ed=mb("w"),fd=mb("M"),gd=mb("Q"),hd=mb("y"),id=Jb("milliseconds"),jd=Jb("seconds"),
kd=Jb("minutes"),ld=Jb("hours"),md=Jb("days"),nd=Jb("months"),od=Jb("years"),wb=Math.round,Rb={ss:44,s:45,m:45,h:22,d:26,w:null,M:11},lc=Math.abs,Sa=Va.prototype;Sa.isValid=function(){return this._isValid};Sa.abs=function(){var F=this._data;this._milliseconds=vb(this._milliseconds);this._days=vb(this._days);this._months=vb(this._months);F.milliseconds=vb(F.milliseconds);F.seconds=vb(F.seconds);F.minutes=vb(F.minutes);F.hours=vb(F.hours);F.months=vb(F.months);F.years=vb(F.years);return this};Sa.add=
function(F,K){return Ab(this,F,K,1)};Sa.subtract=function(F,K){return Ab(this,F,K,-1)};Sa.as=function(F){if(!this.isValid())return NaN;var K=this._milliseconds;F=M(F);if("month"===F||"quarter"===F||"year"===F){var U=this._days+K/864E5;U=this._months+4800*U/146097;switch(F){case "month":return U;case "quarter":return U/3;case "year":return U/12}}else switch(U=this._days+Math.round(146097*this._months/4800),F){case "week":return U/7+K/6048E5;case "day":return U+K/864E5;case "hour":return 24*U+K/36E5;
case "minute":return 1440*U+K/6E4;case "second":return 86400*U+K/1E3;case "millisecond":return Math.floor(864E5*U)+K;default:throw Error("Unknown unit "+F);}};Sa.asMilliseconds=$c;Sa.asSeconds=ad;Sa.asMinutes=bd;Sa.asHours=cd;Sa.asDays=dd;Sa.asWeeks=ed;Sa.asMonths=fd;Sa.asQuarters=gd;Sa.asYears=hd;Sa.valueOf=function(){return this.isValid()?this._milliseconds+864E5*this._days+this._months%12*2592E6+31536E6*W(this._months/12):NaN};Sa._bubble=function(){var F=this._milliseconds,K=this._days,U=this._months,
ba=this._data;0<=F&&0<=K&&0<=U||0>=F&&0>=K&&0>=U||(F+=864E5*Bb(146097*U/4800+K),U=K=0);ba.milliseconds=F%1E3;F=R(F/1E3);ba.seconds=F%60;F=R(F/60);ba.minutes=F%60;F=R(F/60);ba.hours=F%24;K+=R(F/24);F=R(4800*K/146097);U+=F;K-=Bb(146097*F/4800);F=R(U/12);ba.days=K;ba.months=U%12;ba.years=F;return this};Sa.clone=function(){return Ua(this)};Sa.get=function(F){F=M(F);return this.isValid()?this[F+"s"]():NaN};Sa.milliseconds=id;Sa.seconds=jd;Sa.minutes=kd;Sa.hours=ld;Sa.days=md;Sa.weeks=function(){return R(this.days()/
7)};Sa.months=nd;Sa.years=od;Sa.humanize=function(F,K){if(!this.isValid())return this.localeData().invalidDate();var U=!1,ba=Rb;"object"===typeof F&&(K=F,F=!1);"boolean"===typeof F&&(U=F);"object"===typeof K&&(ba=Object.assign({},Rb,K),null!=K.s&&null==K.ss&&(ba.ss=K.s-1));F=this.localeData();K=!U;var qa=Ua(this).abs(),Aa=wb(qa.as("s")),Ga=wb(qa.as("m")),Ja=wb(qa.as("h")),Pa=wb(qa.as("d")),Oa=wb(qa.as("M")),Ya=wb(qa.as("w"));qa=wb(qa.as("y"));Aa=Aa<=ba.ss&&["s",Aa]||Aa<ba.s&&["ss",Aa]||1>=Ga&&["m"]||
Ga<ba.m&&["mm",Ga]||1>=Ja&&["h"]||Ja<ba.h&&["hh",Ja]||1>=Pa&&["d"]||Pa<ba.d&&["dd",Pa];null!=ba.w&&(Aa=Aa||1>=Ya&&["w"]||Ya<ba.w&&["ww",Ya]);Aa=Aa||1>=Oa&&["M"]||Oa<ba.M&&["MM",Oa]||1>=qa&&["y"]||["yy",qa];Aa[2]=K;Aa[3]=0<+this;Aa[4]=F;K=Pc.apply(null,Aa);U&&(K=F.pastFuture(+this,K));return F.postformat(K)};Sa.toISOString=$b;Sa.toString=$b;Sa.toJSON=$b;Sa.locale=Mb;Sa.localeData=Eb;Sa.toIsoString=p("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",$b);Sa.lang=zc;
y("X",0,0,"unix");y("x",0,0,"valueOf");ha("x",dc);ha("X",/[+-]?\d+(\.\d{1,3})?/);na("X",function(F,K,U){U._d=new Date(1E3*parseFloat(F))});na("x",function(F,K,U){U._d=new Date(W(F))});E.version="2.29.4";var Bc=Ia;E.fn=Fa;E.min=function(){var F=[].slice.call(arguments,0);return Xa("isBefore",F)};E.max=function(){var F=[].slice.call(arguments,0);return Xa("isAfter",F)};E.now=function(){return Date.now?Date.now():+new Date};E.utc=d;E.unix=function(F){return Ia(1E3*F)};E.months=function(F,K){return Ib(F,
K,"months")};E.isDate=l;E.locale=ca;E.invalid=b;E.duration=Ua;E.isMoment=f;E.weekdays=function(F,K,U){return zb(F,K,U,"weekdays")};E.parseZone=function(){return Ia.apply(null,arguments).parseZone()};E.localeData=ea;E.isDuration=gb;E.monthsShort=function(F,K){return Ib(F,K,"monthsShort")};E.weekdaysMin=function(F,K,U){return zb(F,K,U,"weekdaysMin")};E.defineLocale=aa;E.updateLocale=function(F,K){if(null!=K){var U=qc;if(null!=$a[F]&&null!=$a[F].parentLocale)$a[F].set(t($a[F]._config,K));else{var ba=
V(F);null!=ba&&(U=ba._config);K=t(U,K);null==ba&&(K.abbr=F);K=new z(K);K.parentLocale=$a[F];$a[F]=K}ca(F)}else null!=$a[F]&&(null!=$a[F].parentLocale?($a[F]=$a[F].parentLocale,F===ca()&&ca(F)):null!=$a[F]&&delete $a[F]);return $a[F]};E.locales=function(){return Qc($a)};E.weekdaysShort=function(F,K,U){return zb(F,K,U,"weekdaysShort")};E.normalizeUnits=M;E.relativeTimeRounding=function(F){return void 0===F?wb:"function"===typeof F?(wb=F,!0):!1};E.relativeTimeThreshold=function(F,K){if(void 0===Rb[F])return!1;
if(void 0===K)return Rb[F];Rb[F]=K;"s"===F&&(Rb.ss=K-1);return!0};E.calendarFormat=function(F,K){F=F.diff(K,"days",!0);return-6>F?"sameElse":-1>F?"lastWeek":0>F?"lastDay":1>F?"sameDay":2>F?"nextDay":7>F?"nextWeek":"sameElse"};E.prototype=Fa;E.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};return E})},
"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(E,q,A,w,m,v,r,l){E=E(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var k=A.map(this.geometries,function(d){return d.toJson()}),n={};n.outSR=this.outSR.wkid||w.toJson(this.outSR.toJson());n.inSR=this.geometries[0].spatialReference.wkid||
w.toJson(this.geometries[0].spatialReference.toJson());n.geometries=w.toJson({geometryType:l.getJsonType(this.geometries[0]),geometries:k});this.transformation&&(n.transformation=this.transformation.wkid||w.toJson(this.transformation));r.isDefined(this.transformForward)&&(n.transformForward=this.transformForward);return n}});m("extend-esri")&&q.setObject("tasks.ProjectParameters",E,v);return E})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(E,
q){var A=E.clone(q);A.declaredClass="jimu.portalUrlUtils";A.getPortalUrlFromLocation=function(){return A.getPortalServerFromLocation()+A.getDeployContextFromLocation()};A.getPortalSignInUrlFromLocation=function(){var w=A.getPortalUrlFromLocation();return A.setHttpsProtocol(w+"home/signin.html")};A.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};A.getDeployContextFromLocation=function(){var w=window.location.href.split("?")[0],m=w.indexOf("/home/");
0>m&&(m=w.indexOf("/apps/"));w=w.substring(w.indexOf(window.location.host)+window.location.host.length+1,m);"/"!==w&&(w="/"+w+"/");return w};A.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+A.getDeployContextFromLocation()+"sharing/rest/"};return A})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var E={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,
"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(q){return this.substr(0,q.length)===q});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(q){return this.substr(this.length-q.length,q.length)===q});E.getServerByUrl=function(q){q=(q||"").trim();q=q.replace(/^(http(s?):?)\/\//gi,"");0===q.indexOf("//")&&(q=q.slice(2));return q.split("/")[0]};E.getServerWithProtocol=function(q){var A="";if(q=(q||"").trim()){var w=
E.getServerByUrl(q);if(!w)return A;var m=E.getProtocol(q);m?A=m+"://"+w:0===q.indexOf("//")&&(A="//"+w)}return A};E.isSameServer=function(q,A){q=E.getServerByUrl(q)||"";A=E.getServerByUrl(A)||"";return q.toLowerCase()===A.toLowerCase()};E.getDomain=function(q){var A="";if(q=E.getServerByUrl(q))q=q.replace(/:\d+$/,""),q=q.match(/[^.]\w+\.\w+$/),null!==q&&(A=q[0],/^\d+\.\d+$/.test(A)&&(A=""));return A};E.isSameDomain=function(q,A){q=E.getDomain(q);A=E.getDomain(A);return""!==q&&q===A};E.isOrgOnline=
function(q){return 0<=E.getServerByUrl(q).toLowerCase().indexOf(".maps.arcgis.com")};E.isOnline=function(q){return 0<=E.getServerByUrl(q).toLowerCase().indexOf(".arcgis.com")};E.isArcGIScom=function(q){q=E.getServerByUrl(q).toLowerCase();return"www.arcgis.com"===q||"arcgis.com"===q};E.getStandardPortalUrl=function(q){var A=E.getServerByUrl(q);if(""===A)return"";E.isOnline(A)?(E.isArcGIScom(A)&&(A="www.arcgis.com"),q=E.addProtocol(q),q=E.getProtocol(q)+"://"+A):(q=(q||"").trim().replace(/sharing(.*)/gi,
"").replace(/\/*$/g,""),q=E.addProtocol(q),q.replace(new RegExp("http(s?)://"+A,"g"),"")||(q+="/arcgis"));return q};E.isSamePortalUrl=function(q,A){var w=/^http(s?):\/\//gi,m=/^\/\//gi;q=E.getStandardPortalUrl(q).toLowerCase().replace(w,"").replace(m,"");A=E.getStandardPortalUrl(A).toLowerCase().replace(w,"").replace(m,"");return q===A};E.addProtocol=function(q){if(-1>=q.toLowerCase().indexOf("http://")&&-1>=q.toLowerCase().indexOf("https://")){var A="";"undefined"!==typeof window&&window.location?
(A=window.location.protocol,q=q.startWith("//")?A+q:q.startWith("/")?A+"//"+window.location.host+q:A+"//"+q):(A="http:",q=q.startWith("//")?A+q:A+"//"+q)}return q};E.getProtocol=function(q){var A="";q=q.toLowerCase();0===q.indexOf("https://")?A="https":0===q.indexOf("http://")&&(A="http");return A};E.updateUrlProtocolByOtherUrl=function(q,A){A=A.toLowerCase();0===A.indexOf("https://")?q=E.setHttpsProtocol(q):0===A.indexOf("http://")&&(q=E.setHttpProtocol(q));return q};E.removeProtocol=function(q){return q.replace(/^http(s?):\/\//i,
"//")};E.setHttpProtocol=function(q){q=E.addProtocol(q);return q.replace(/^https:\/\//,"http://")};E.setHttpsProtocol=function(q){q=E.addProtocol(q);return q.replace(/^http:\/\//,"https://")};E.setProtocol=function(q,A){return 0<=A.indexOf("https")?E.setHttpsProtocol(q):0<=A.indexOf("http")?E.setHttpProtocol(q):q};E.getSharingUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/sharing/rest");return A};E.getOAuth2Url=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/sharing/rest/oauth2");
return A};E.getAppIdUrl=function(q,A){var w="";(q=E.getStandardPortalUrl(q))&&(w=q+"/sharing/rest/oauth2/apps/"+A);return w};E.getSignInUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/home/signin.html");return A};E.getBaseSearchUrl=function(q){var A="";q=E.getStandardPortalUrl(q);(q=q.replace(/\/*$/g,""))&&(A=q+"/sharing/rest/search");return A};E.getBaseItemUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/sharing/rest/content/items");return A};E.getItemUrl=function(q,
A){var w="";(q=E.getBaseItemUrl(q))&&A&&(w=q+"/"+A);return w};E.getItemDataUrl=function(q,A){var w="";(q=E.getItemUrl(q,A))&&(w=q+"/data");return w};E.getItemGroupsUrl=function(q,A){var w="";(q=E.getItemUrl(q,A))&&(w=q+"/groups");return w};E.getGenerateTokenUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/sharing/generateToken");return A};E.getItemDetailsPageUrl=function(q,A){var w="";q&&A&&(q=E.getStandardPortalUrl(q),w=q+"/home/item.html?id\x3d"+A);return w};E.getUserProfilePageUrl=
function(q,A){var w="";q&&A&&(q=E.getStandardPortalUrl(q),w=q+"/home/user.html?user\x3d"+A);return w};E.getBaseGroupUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/sharing/rest/community/groups");return A};E.getPortalSelfInfoUrl=function(q){var A="";(q=E.getStandardPortalUrl(q||""))&&(A=q+"/sharing/rest/portals/self");return A};E.getPortalHelpMapUrl=function(q){var A="";(q=E.getStandardPortalUrl(q||""))&&(A=q+"/sharing/rest/portals/helpmap");return A};E.getCommunitySelfUrl=function(q){var A=
"";(q=E.getStandardPortalUrl(q||""))&&(A=q+"/sharing/rest/community/self");return A};E.getBaseUserUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/sharing/rest/community/users");return A};E.getUserUrl=function(q,A){var w="",m=E.getBaseUserUrl(q);q&&A&&(w=m+"/"+A);return w};E.getUserTagsUrl=function(q,A){var w="",m=E.getUserUrl(q,A);q&&A&&(w=m+"/tags");return w};E.getUserThumbnailUrl=function(q,A,w){var m="";(q=E.getUserUrl(q,A))&&w&&(m=q+"/info/"+w);return m};E.getContentUrl=function(q){var A=
"";q&&(q=E.getStandardPortalUrl(q),A=q+"/sharing/rest/content");return A};E.getUserContentUrl=function(q,A,w){var m="";m="";q&&A&&(m=E.getContentUrl(q),m=w?m+"/users/"+A+"/"+w:m+"/users/"+A);return m};E.getUserContentItemUrl=function(q,A,w){var m="";m="";q&&A&&w&&(m=E.getUserContentUrl(q,A),m=m+"/items/"+w);return m};E.getItemResourceUrl=function(q,A,w){var m="";m="";q&&A&&(m=E.getContentUrl(q),m=w?m+"/items/"+A+"/resources/"+w:m+"/items/"+A+"/resources");return m};E.getAddItemUrl=function(q,A,w){var m=
"";m="";q&&A&&(m=E.getUserContentUrl(q,A,w),m+="/addItem");return m};E.getDeleteItemUrl=function(q,A,w){var m="";(q=E.getUserItemsUrl(q,A))&&(m=q+"/"+w+"/delete");return m};E.getUserItemsUrl=function(q,A,w){var m="";m="";q&&A&&(m=E.getUserContentUrl(q,A,w),m+="/items");return m};E.getUpdateItemUrl=function(q,A,w,m){var v="";v="";q&&A&&(v=E.getUserItemsUrl(q,A,m),v=v+"/"+w+"/update");return v};E.shareItemUrl=function(q,A,w,m){var v="";v="";q&&A&&(v=E.getUserItemsUrl(q,A,m),v=v+"/"+w+"/share");return v};
E.getHomeIndexUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/home/index.html");return A};E.getHomeMapViewerUrl=function(q,A){var w="";if(q=E.getStandardPortalUrl(q))w=q+"/home/webmap/viewer.html",w=A?w+("?webmap\x3d"+A):w+"?useExisting\x3d1";return w};E.getHomeSceneViewerUrl=function(q,A){var w="";if(q=E.getStandardPortalUrl(q))w=q+"/home/webscene/viewer.html",A&&(w+="?webscene\x3d"+A);return w};E.getHomeGalleryUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/home/gallery.html");
return A};E.getHomeGroupsUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/home/groups.html");return A};E.getHomeMyContentUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/home/content.html");return A};E.getHomeMyOrganizationUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/home/organization.html");return A};E.getHomeUserUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/home/user.html");return A};E.getPortalHelpUrl=function(q,A){var w="";(q=E.getStandardPortalUrl(q))&&
(w=q+"/portalhelp/"+(A||"en")+"/portal/");return w};E.getPortalAdminHelpUrl=function(q,A){var w="";(q=E.getStandardPortalUrl(q))&&(w=q+"/portalhelp/"+(A||"en")+"/admin/help/");return w};E.getPortalProxyUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/sharing/proxy");return A};E.getOAuth2SignOutUrl=function(q){var A="";(q=E.getStandardPortalUrl(q))&&(A=q+"/sharing/rest/oauth2/signout");return A};E.getNewPrintUrl=function(q){var A="";if(q=E.getStandardPortalUrl(q))q=E.setHttpProtocol(q),
A=q+"/sharing/tools/newPrint";return A};E.getSwitchAccoutnsUrl=function(q,A,w){var m="";if(q=E.getStandardPortalUrl(q))m=q+"/home/pages/Account/manage_accounts.html#client_id\x3d"+A,w&&(m+="\x26redirect_uri\x3d"+w);m&&(m=E.setHttpsProtocol(m));return m};E.getArcgisOnlineUrl=function(q){return q.endsWith("mapsdevext.arcgis.com")||q.endsWith("mapsdevext.arcgis.com/")?"https://devext.arcgis.com":q.endsWith("mapsqa.arcgis.com")||q.endsWith("mapsqa.arcgis.com/")?"https://qaext.arcgis.com":"https://www.arcgis.com"};
return E})},"jimu/shared/utils":function(){define([],function(){function E(w,m){function v(r,l){var k,n,d="widgetOnScreen"===r;if(w[r]){if(w[r].groups)for(k=0;k<w[r].groups.length;k++){var c=w[r].groups[k];l(c,{index:k,isWidget:!1,groupId:c.id,isThemeWidget:!1,isOnScreen:d});if(w[r].groups[k].widgets)for(n=0;n<w[r].groups[k].widgets.length;n++){var g=w[r].groups[k].widgets[n];l(g,{index:n,isWidget:!0,groupId:c.id,isThemeWidget:g.uri&&-1<g.uri.indexOf("themes/"+w.theme.name),isOnScreen:d})}}if(w[r].widgets)for(k=
0;k<w[r].widgets.length;k++)g=w[r].widgets[k],l(w[r].widgets[k],{index:k,isWidget:!0,groupId:r,isThemeWidget:g.uri&&-1<g.uri.indexOf("themes/"+w.theme.name),isOnScreen:d})}}v("widgetOnScreen",m);v("widgetPool",m)}var q={},A="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance mirrorIconForRTL".split(" ");q.visitElement=E;q.getConfigElementById=function(w,
m){var v;if("map"===m)return w.map;E(w,function(r){if(r.id===m)return v=r,!0});return v};q.getConfigElementByLabel=function(w,m){var v;if("map"===m)return w.map;E(w,function(r){if(r.label||r.name===m)return v=r,!0});return v};q.getConfigElementsByName=function(w,m){var v=[];if("map"===m)return[w.map];E(w,function(r){r.name===m&&v.push(r)});return v};q.getWidgetNameFromUri=function(w){w=w.split("/");w.pop();return w.pop()};q.getAmdFolderFromUri=function(w){w=w.split("/");w.pop();return w.join("/")+
"/"};q.widgetProperties=A;q.processWidgetProperties=function(w){"undefined"===typeof w.properties.isController&&(w.properties.isController=!1);"undefined"===typeof w.properties.isThemeWidget&&(w.properties.isThemeWidget=!1);"undefined"===typeof w.properties.hasVersionManager&&(w.properties.hasVersionManager=!1);"undefined"===typeof w.properties.mirrorIconForRTL&&(w.properties.mirrorIconForRTL=!1);A.forEach(function(m){"undefined"===typeof w.properties[m]&&(w.properties[m]=!0)})};q.getControllerWidgets=
function(w){var m=[];w.visitElement(function(v){v.isController&&m.push(v)});return m};q.addI18NLabelToManifest=function(w,m,v){function r(n,d){d[l]&&(w.i18nLabels[n]=d[l]);"theme"===w.category&&(w.layouts&&w.layouts.forEach(function(c){w["i18nLabels_layout_"+c.name]||(w["i18nLabels_layout_"+c.name]={});w["i18nLabels_layout_"+c.name][n]=d["_layout_"+c.name]}),w.styles&&w.styles.forEach(function(c){w["i18nLabels_style_"+c.name]||(w["i18nLabels_style_"+c.name]={});w["i18nLabels_style_"+c.name][n]=d["_style_"+
c.name]}));"widget"===w.category&&w.featureActions&&w.featureActions.forEach(function(c){w["i18nLabels_featureAction_"+c.name]||(w["i18nLabels_featureAction_"+c.name]={});w["i18nLabels_featureAction_"+c.name][n]=d["_featureAction_"+c.name]})}w.i18nLabels={};var l="widget"===w.category?"_widgetLabel":"_themeLabel";m&&m.root&&m.root[l]&&(w.i18nLabels.defaultLabel=m.root[l],"theme"===w.category&&(w.layouts&&w.layouts.forEach(function(n){w["i18nLabels_layout_"+n.name]={};w["i18nLabels_layout_"+n.name].defaultLabel=
m.root["_layout_"+n.name]}),w.styles&&w.styles.forEach(function(n){w["i18nLabels_style_"+n.name]={};w["i18nLabels_style_"+n.name].defaultLabel=m.root["_style_"+n.name]})),"widget"===w.category&&w.featureActions&&w.featureActions.forEach(function(n){w["i18nLabels_featureAction_"+n.name]={};w["i18nLabels_featureAction_"+n.name].defaultLabel=m.root["_featureAction_"+n.name]}));for(var k in v)r(k,v[k])};q.isHostedService=function(w){if(!w)return!1;var m=-1!==w.indexOf(".arcgis.com/");w=-1!==w.indexOf("//services")||
-1!==w.indexOf("//tiles")||-1!==w.indexOf("//features");return m&&w};return q})},"jimu/accessibleUtils":function(){define("dojo/_base/lang dojo/_base/html dojo/query esri/lang dojo/keys dojo/on".split(" "),function(E,q,A,w,m,v){var r={firstFocusNodeClass:"firstFocusNode",lastFocusNodeClass:"lastFocusNode",lastFocusNodeClassInDOM:"lastFocusNodeInDOM",isInNavMode:function(){return q.hasClass(document.body,"jimu-nav-mode")?!0:!1},initTabIndexAndOrder:function(l){var k=r.getFirstFocusNode(l.domNode,l.inPanel),
n=r.getLastFocusNode(l.domNode);k&&!n&&(n=k);l.isController&&(k=n=null);r.initFirstFocusNode(l.domNode,k);r.initLastFocusNode(l.domNode,n);r.addLabelToWidgetDOM(l)},addLabelToWidgetDOM:function(l){if(0<=["ZoomSlider","AttributeTable","Search","ExtentNavigate","OverviewMap"].indexOf(l.name)){var k=w.substitute({widgetLabel:l.name},window.jimuNls.widgetToolTip);q.setAttr(l.domNode,"aria-label",k)}},isOnScreenNotCloseableOffPanel:function(l){return l.isOnScreen&&!l.inPanel&&!0!==l.closeable},preventMapNavigation:function(l){0<=
[m.NUMPAD_PLUS,61,187,m.NUMPAD_MINUS,173,189,m.UP_ARROW,m.NUMPAD_8,m.RIGHT_ARROW,m.NUMPAD_6,m.DOWN_ARROW,m.NUMPAD_2,m.LEFT_ARROW,m.NUMPAD_4,m.PAGE_UP,m.NUMPAD_9,m.PAGE_DOWN,m.NUMPAD_3,m.END,m.NUMPAD_1,m.HOME,m.NUMPAD_7].indexOf(l.keyCode)&&l.stopPropagation()},_addAttrsOnWidgetDom:function(l){var k=0<=["MyLocation","HomeButton","FullScreen"].indexOf(l.name)?"button":"";l.inPanel||q.setAttr(l.domNode,"role",k)},initWidgetCancelEvent:function(l){this._addAttrsOnWidgetDom(l);v(l.domNode,"keydown",E.hitch(this,
function(k){r.preventMapNavigation(k);var n=k.target;l.inPanel||0>[m.ENTER,m.ESCAPE].indexOf(k.keyCode)||(r.isOnScreenNotCloseableOffPanel(l)?k.keyCode===m.ENTER&&q.hasClass(n,l.baseClass)?(k.preventDefault(),r.focusFirstFocusNode(l.domNode)):k.keyCode===m.ESCAPE&&(q.hasClass(n,l.baseClass)?"Splash"!==l.name&&(n=l.domNode.parentNode,"map"===q.getAttr(n,"id")?(k.preventDefault(),n.focus()):(k="jimu-layout-manager"===q.getAttr(n,"id")?l.domNode:l.domNode.parentNode,r.trapToNextFocusContainer(k))):(k.stopPropagation(),
l.domNode.focus())):k.keyCode!==m.ESCAPE||q.hasClass(n,l.baseClass)||(l.domNode.focus(),l.onClose(),k.preventDefault(),k.stopPropagation()))}))},initFirstFocusNode:function(l,k){var n=r.getFirstFocusNode(l);n&&(q.removeClass(n,r.firstFocusNodeClass),n.firstNodeEvent&&n.firstNodeEvent.remove(),n===l&&(q.setAttr(n,"tabindex",null),q.setAttr(n,"role","")));k&&(k===l&&(q.setAttr(k,"tabindex",0),q.setAttr(k,"role","document")),q.addClass(k,r.firstFocusNodeClass),k.firstNodeEvent=v(k,"keydown",E.hitch(this,
function(d){q.hasClass(d.target,r.firstFocusNodeClass)&&d.keyCode===m.TAB&&(window.currentMsgPopup&&window.currentMsgPopup.firstFocusNode?(window.currentMsgPopup.focusedNodeBeforeOpen=d.target,d.preventDefault(),window.currentMsgPopup.firstFocusNode.focus()):!r.tryToFocusSplashWidget(d,l)&&d.shiftKey&&(d.preventDefault(),d=r.getLastFocusNode(l),r.isDomFocusable(d)?d.focus():(d=r.getFocusNodesInDom(d),1<=d.length&&d[d.length-1].focus())))})))},tryToFocusSplashWidget:function(l,k){var n=A(".jimu-widget-splash",
A("#jimu-layout-manager")[0])[0];return n&&"none"!==q.getStyle(n,"display")&&n!==k?(l.stopPropagation(),l.preventDefault(),A("."+r.firstFocusNodeClass,n)[0].focus(),!0):!1},initLastFocusNode:function(l,k){var n=r.getLastFocusNode(l);n&&(q.removeClass(n,r.lastFocusNodeClass),n.lastNodeEvent&&n.lastNodeEvent.remove(),n===l&&q.setAttr(n,"tabindex",null));k&&(k===l&&q.setAttr(k,"tabindex",0),q.addClass(k,r.lastFocusNodeClass),k.lastNodeEvent=v(k,"keydown",E.hitch(this,function(d){if(!d.shiftKey&&d.keyCode===
m.TAB)if(l===k||q.hasClass(d.target,r.lastFocusNodeClass)&&r.isDomFocusable(d.target))d.preventDefault(),this.focusFirstFocusNode(l);else{var c=this.getFocusNodesInDom(k);if(0===c.length||r._isLastFromInnerNodes(c,d.target))d.preventDefault(),this.focusFirstFocusNode(l)}})))},_isLastFromInnerNodes:function(l,k){var n=!1;if(k===l[l.length-1])n=!0;else for(var d=0;d<l.length;d++)if(k===l[d]&&q.hasClass(l[d],r.lastFocusNodeClassInDOM)){n=!0;break}return n},focusFirstFocusNode:function(l){var k=A("."+
r.firstFocusNodeClass,l)[0];(k?k:l).focus()},getFirstFocusNode:function(l,k){var n=q.hasClass(l,r.firstFocusNodeClass)?l:A("."+r.firstFocusNodeClass,l)[0];!n&&k&&(n=l,null===q.getAttr(n,"tabindex")&&q.setAttr(n,"tabindex","0"));return n},getLastFocusNode:function(l){return q.hasClass(l,r.lastFocusNodeClass)?l:A("."+r.lastFocusNodeClass,l)[0]},getFirstSkipLink:function(){return A("#skipContainer a")[0]},focusOnFirstSkipLink:function(){r.getFirstSkipLink().focus()},traversalDom:function(l,k){k=k?k:
[];for(var n=l.childNodes,d=0;d<n.length;d++)l=n[d],1===l.nodeType&&(k.push(l),r.traversalDom(l,k));return k},getFocusNodesInDom:function(l){l=r.traversalDom(l);for(var k=[],n=0;n<l.length;n++){var d=l[n];r.isDomFocusable(d)&&k.push(d)}return k},isDomFocusable:function(l){var k=["A","INPUT","BUTTON","SELECT","TEXTAREA"],n="hidden"!==q.getAttr(l,"type")&&"none"!==q.getStyle(l,"display"),d=!0!==q.getAttr(l,"disabled"),c=parseInt(q.getAttr(l,"tabindex"),10);return n&&d&&(0<=k.indexOf(l.tagName)&&-1!==
c||0>k.indexOf(l.tagName)&&0<=c)?!0:!1},getFrameNodesByAsc:function(){for(var l=A("#jimu-layout-manager")[0].children,k=[],n=0;n<l.length;n++){var d=l[n];0<parseInt(q.getAttr(d,"tabindex"),10)&&"none"!==q.getStyle(d,"display")&&k.push(d)}k.sort(function(c,g){c=parseInt(q.getAttr(c,"tabindex"),10);g=parseInt(q.getAttr(g,"tabindex"),10);return c<g?-1:c===g?0:1});return k},trapToNextFocusContainer:function(l){var k=r.getFrameNodesByAsc(),n=null;if("skipContainer"===q.getAttr(l,"id"))return(n=k[0])&&
n.focus(),n;k.unshift(r.getFirstSkipLink());l=parseInt(q.getAttr(l,"tabindex"),10);for(var d=0;d<k.length;d++)if(parseInt(q.getAttr(k[d],"tabindex"),10)===l){n=d===k.length-1?k[0]:k[d+1];break}k=!r.isInNavMode()&&"link"===q.getAttr(n,"role");n&&!k&&n.focus();return n},isAutoFocusFirstNodeWidget:function(l){var k=!0;r.isOnScreenNotCloseableOffPanel(l)?k=!1:l.openAtStart?l.openAtStartAysn?k=l.openAtStartAysn=!1:l._isFirstOpenAtStart||(l._isFirstOpenAtStart=!0,k=!1):l.isOnScreen&&"widgetOnScreen"!==
l.gid?k=!1:l.inGroupPanel&&(k=!1);return k},_getTooltipLabel:function(l,k){var n=q.getAttr(l,"aria-label");l=q.getAttr(l,"title");return n||l||k},addTooltipByDomNode:function(l,k,n){l.defaultPosition=["below-centered","above-centered","after-centered","before-centered"];var d;v(k,"focus",E.hitch(this,function(c){r.isInNavMode()&&(d&&q.setAttr(d,"role","presentation"),l.show(r._getTooltipLabel(k,n)+"\x26nbsp;\x26nbsp;",c.target),d||(d=A(".dijitTooltipContainer",document.body)[0],q.setAttr(d,"role",
"presentation")))}));v(k,"blur",E.hitch(this,function(c){l&&l.hide(c.target)}))}};return r})},"jimu/zoomToUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred esri/config esri/graphic esri/graphicsUtils esri/geometry/Extent esri/geometry/Point esri/SpatialReference esri/geometry/webMercatorUtils esri/tasks/ProjectParameters".split(" "),function(E,q,A,w,m,v,r,l,k,n,d){var c={zoomToFeatureSet:function(g,b,e){var a=b.features&&0<b.features.length&&b.features[0].getLayer&&b.features[0].getLayer();
a=a?a.id:null;b=c.graphicsExtent(b.features,e);return c.zoomToExtent(g,b,a)},zoomToExtent:function(g,b,e){if(!g||!c.isValidExtent(b)){var a=new A;a.reject();return a}e?(a=new A,require(["jimu/LayerStructure"],function(f){(f=f.getInstance().getNodeById(e))?f.zoomTo(b).then(function(){a.resolve()},function(){a.reject()}):c.projectToMapSpatialReference(g,b).then(function(h){b.isSinglePoint&&(h=c.convertSinglePointExtent(g,h));g.setExtent(h,!0);a.resolve()},function(){a.reject()})})):a=c.projectToMapSpatialReference(g,
b).then(function(f){b.isSinglePoint&&(f=c.convertSinglePointExtent(g,f));return g.setExtent(f,!0)});return a},isValidExtent:function(g){return g&&c.isTrueOrZero(g.xmin)&&c.isTrueOrZero(g.ymin)&&c.isTrueOrZero(g.xmax)&&c.isTrueOrZero(g.ymax)}};c.isVaildExtent=c.isValidExtent;c.isTrueOrZero=function(g){return 0===g?!0:!!g};c.convertSinglePointExtent=function(g,b){var e=g.getScale();if(e=c.getMedianScale(g,e,0))b=c.adjustHeightToAspectRatio(g,b),b=c.getExtentForScale(b,g.width,e);return b};c.graphicsExtent=
function(g,b){var e=null;try{if(g&&1===g.length&&g[0].geometry&&"esri.geometry.Multipoint"===g[0].geometry.declaredClass&&1===g[0].geometry.points.length){var a=g[0].geometry.points[0],f=new l(a[0],a[1],g[0].geometry.spatialReference);g=[new m(f)]}if(g&&1===g.length&&g[0].geometry&&"esri.geometry.Point"===g[0].geometry.declaredClass){var h=g[0].geometry;e=new r(h.x-1E-4,h.y-1E-4,h.x+1E-4,h.y+1E-4,h.spatialReference);e.isSinglePoint=!0}else g&&0<g.length&&(e=v.graphicsExtent(g))&&"number"===typeof b&&
0<b&&(e=e.expand(b))}catch(p){console.error(p)}return e};c.projectToMapSpatialReference=function(g,b){return c.projectToSpatialReference(b,g.spatialReference)};c.projectToSpatialReference=function(g,b){var e=new A,a=g;if(b&&g)if(b.equals(g.spatialReference))e.resolve(a);else if(b.isWebMercator()&&g.spatialReference.equals(new k(4326)))a=n.geographicToWebMercator(g),a.isSinglePoint=g.isSinglePoint,e.resolve(a);else if(b.equals(new k(4326))&&g.spatialReference.isWebMercator())a=n.webMercatorToGeographic(g),
a.isSinglePoint=g.isSinglePoint,e.resolve(a);else{var f=w&&w.defaults&&w.defaults.geometryService;if(f&&"esri.tasks.GeometryService"===f.declaredClass){var h=new d;h.geometries=[g];h.outSR=b;f.project(h).then(function(p){(a=p&&0<p.length&&p[0])?(a.isSinglePoint=g.isSinglePoint,e.resolve(a)):e.reject()},function(){})}else e.reject()}else e.reject();return e};c.getMapLods=function(g){var b=null;g._params&&g._params.lods&&(b=q.map(g._params.lods,E.hitch(this,function(e){return e.toJson()})));return b};
c.getMedianScale=function(g,b,e){return c.getTargetScale(g,2,b,e)};c.getTargetScale=function(g,b,e,a){g=c.getMapLods(g);var f=1;if(g){var h=[],p=[];q.forEach(g,function(B){0<e&&B.scale>e||(B.scale<a?p.push(B.scale):h.push(B.scale))});h.reverse();1<=h.length?(f=p.length?p.length/g.length:1,b=Math.floor((h.length-1)/(b/f)),b=h[b]):b=null}else b=0===e?null:(e-a)/b;return b};c.getScaleForNextTileLevel=function(g,b,e){if(g=c.getMapLods(g)){if(e){for(e=0;e<g.length;e++)if(g[e].scale<b)return g[e].scale-
1;return g[g.length-1].scale-1}for(e=g.length-1;0<=e;e--)if(g[e].scale>b)return g[e].scale+1;return g[0].scale+1}return e?b-1:b+1};c.adjustExtentToAspectRatio=function(g,b){g=g.width/g.height;var e=b.getWidth()/b.getHeight();e>g?(g=b.getWidth()/g/2,E.mixin(b,{ymin:b.getCenter().y-g,ymax:b.getCenter().y+g})):e<g&&(g=b.getHeight()*g/2,E.mixin(b,{xmin:b.getCenter().x-g,xmax:b.getCenter().x+g}));return b};c.adjustHeightToAspectRatio=function(g,b){g=b.getWidth()*(g.height/g.width)/5;E.mixin(b,{ymin:b.getCenter().y-
g,ymax:b.getCenter().y+g});return b};c.getExtentForScale=function(g,b,e){var a=20015077/180,f=esri.config.defaults,h=esri.WKIDUnitConversion,p=g.spatialReference;if(p){var B=p.wkid;var u=p.wkt}p=null;B?p=h.values[h[B]]:u&&-1!==u.search(/^PROJCS/i)&&(h=/UNIT\[([^\]]+)\]\]$/i.exec(u))&&h[1]&&(p=parseFloat(h[1].split(",")[1]));return g.expand(e*b/(39.37*(p||a)*f.screenDPI)/g.getWidth())};c.getScaleForExtent=function(g,b){var e=20015077/180,a=esri.config.defaults,f=esri.WKIDUnitConversion,h=g.spatialReference;
if(h){var p=h.wkid;var B=h.wkt}h=null;p?h=f.values[f[p]]:B&&-1!==B.search(/^PROJCS/i)&&(f=/UNIT\[([^\]]+)\]\]$/i.exec(B))&&f[1]&&(h=parseFloat(f[1].split(",")[1]));return g.getWidth()/b*(h||e)*39.37*a.screenDPI};return c})},"libs/caja-html-sanitizer-minified":function(){(function(){var E=function(){function w(a){return(a=(""+a).match(g))?new k(n(a[1]),n(a[2]),n(a[3]),n(a[4]),n(a[5]),n(a[6]),n(a[7])):null}function m(a,f){return"string"==typeof a?encodeURI(a).replace(f,v):null}function v(a){a=a.charCodeAt(0);
return"%"+"0123456789ABCDEF".charAt(a>>4&15)+"0123456789ABCDEF".charAt(a&15)}function r(a){if(null===a)return null;a=a.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/");for(var f=d,h;(h=a.replace(f,"$1"))!=a;a=h);return a}function l(a,f){a=a.R();var h=f.K();h?a.fa(f.j):h=f.V();h?a.ca(f.m):h=f.W();h?a.da(f.k):h=f.Y();var p=f.g,B=r(p);if(h)a.ba(f.T()),B=B&&B.replace(c,"");else if(h=!!p){if(47!==B.charCodeAt(0)){B=r(a.g||"").replace(c,"");var u=B.lastIndexOf("/")+1;B=r((u?B.substring(0,u):"")+
r(p)).replace(c,"")}}else B=B&&B.replace(c,""),B!==p&&a.G(B);h?a.G(B):h=f.Z();h?a.M(f.l):h=f.X();h&&a.ea(f.n);return a}function k(a,f,h,p,B,u,t){this.j=a;this.m=f;this.k=h;this.h=p;this.g=B;this.l=u;this.n=t}function n(a){return"string"==typeof a&&0<a.length?a:null}var d=RegExp(/(\/|^)(?:[^./][^/]*|\.{2,}(?:[^./][^/]*)|\.{3,}[^/]*)\/\.\.(?:\/|$)/),c=/^(?:\.\.\/)*(?:\.\.$)?/;k.prototype.toString=function(){var a=[];null!==this.j&&a.push(this.j,":");null!==this.k&&(a.push("//"),null!==this.m&&a.push(this.m,
"@"),a.push(this.k),null!==this.h&&a.push(":",this.h.toString()));null!==this.g&&a.push(this.g);null!==this.l&&a.push("?",this.l);null!==this.n&&a.push("#",this.n);return a.join("")};k.prototype.R=function(){return new k(this.j,this.m,this.k,this.h,this.g,this.l,this.n)};k.prototype.U=function(){return this.j&&decodeURIComponent(this.j).toLowerCase()};k.prototype.fa=function(a){this.j=a?a:null};k.prototype.K=function(){return null!==this.j};k.prototype.ca=function(a){this.m=a?a:null};k.prototype.V=
function(){return null!==this.m};k.prototype.da=function(a){this.k=a?a:null;this.G(this.g)};k.prototype.W=function(){return null!==this.k};k.prototype.T=function(){return this.h&&decodeURIComponent(this.h)};k.prototype.ba=function(a){if(a){a=Number(a);if(a!==(a&65535))throw Error("Bad port number "+a);this.h=""+a}else this.h=null};k.prototype.Y=function(){return null!==this.h};k.prototype.S=function(){return this.g&&decodeURIComponent(this.g)};k.prototype.G=function(a){a?(a=""+a,this.g=!this.k||/^\//.test(a)?
a:"/"+a):this.g=null};k.prototype.M=function(a){this.l=a?a:null};k.prototype.Z=function(){return null!==this.l};k.prototype.aa=function(a){if("object"===typeof a&&!(a instanceof Array)&&(a instanceof Object||"[object Array]"!==Object.prototype.toString.call(a))){var f=[],h=-1;for(u in a){var p=a[u];"string"===typeof p&&(f[++h]=u,f[++h]=p)}a=f}f=[];h="";for(var B=0;B<a.length;){var u=a[B++];p=a[B++];f.push(h,encodeURIComponent(u.toString()));h="\x26";p&&f.push("\x3d",encodeURIComponent(p.toString()))}this.l=
f.join("")};k.prototype.ea=function(a){this.n=a?a:null};k.prototype.X=function(){return null!==this.n};var g=/^(?:([^:/?#]+):)?(?:\/\/(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,b=/[#\/\?@]/g,e=/[#\?]/g;k.parse=w;k.create=function(a,f,h,p,B,u,t){a=new k(m(a,b),m(f,b),"string"==typeof h?encodeURIComponent(h):null,0<p?p.toString():null,m(B,e),null,"string"==typeof t?encodeURIComponent(t):null);u&&("string"===typeof u?a.M(u.replace(/[^?&=0-9A-Za-z_\-~.%]/g,v)):a.aa(u));
return a};k.$=l;k.ja=r;k.ua={oa:function(a){return/\.html$/.test(w(a).S())?"text/html":"application/javascript"},$:function(a,f){return a?l(w(a),w(f)).toString():""+f}};return k}();"undefined"!==typeof window&&(window.URI=E);var q={e:{NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10,MEDIA_QUERY:13}};q.atype=q.e;q.w={"*::class":9,"*::dir":0,"*::draggable":0,"*::hidden":0,"*::id":4,"*::inert":0,"*::itemprop":0,"*::itemref":6,
"*::itemscope":0,"*::lang":0,"*::onblur":2,"*::onchange":2,"*::onclick":2,"*::ondblclick":2,"*::onerror":2,"*::onfocus":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::onreset":2,"*::onscroll":2,"*::onselect":2,"*::onsubmit":2,"*::ontouchcancel":2,"*::ontouchend":2,"*::ontouchenter":2,"*::ontouchleave":2,"*::ontouchmove":2,"*::ontouchstart":2,"*::onunload":2,"*::spellcheck":0,"*::style":3,
"*::tabindex":0,"*::title":0,"*::translate":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::shape":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::target":10,"audio::controls":0,"audio::loop":0,"audio::mediagroup":5,"audio::muted":0,"audio::preload":0,"audio::src":1,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,
"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"command::checked":0,"command::command":5,"command::disabled":0,"command::icon":1,"command::label":0,"command::radiogroup":0,
"command::type":0,"data::value":0,"del::cite":1,"del::datetime":0,"details::open":0,"dir::compact":0,"div::align":0,"dl::compact":0,"fieldset::disabled":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::novalidate":0,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,
"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::inputmode":0,"input::ismap":0,"input::list":5,"input::max":0,
"input::maxlength":0,"input::min":0,"input::multiple":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::pattern":0,"input::placeholder":0,"input::readonly":0,"input::required":0,"input::size":0,"input::src":1,"input::step":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,
"map::name":7,"menu::compact":0,"menu::label":0,"menu::type":0,"meter::high":0,"meter::low":0,"meter::max":0,"meter::min":0,"meter::optimum":0,"meter::value":0,"ol::compact":0,"ol::reversed":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"output::for":6,"output::name":8,"p::align":0,"pre::width":0,"progress::max":0,"progress::min":0,"progress::value":0,"q::cite":1,"select::autocomplete":0,"select::disabled":0,
"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::required":0,"select::size":0,"source::type":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,
"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::autocomplete":0,"textarea::cols":0,"textarea::disabled":0,"textarea::inputmode":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::placeholder":0,"textarea::readonly":0,"textarea::required":0,"textarea::rows":0,"textarea::wrap":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,
"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"track::default":0,"track::kind":0,"track::label":0,"track::srclang":0,"ul::compact":0,"ul::type":0,"video::controls":0,"video::height":0,"video::loop":0,"video::mediagroup":5,
"video::muted":0,"video::poster":1,"video::preload":0,"video::src":1,"video::width":0};q.ATTRIBS=q.w;q.c={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256};q.eflags=q.c;q.f={a:0,abbr:0,acronym:0,address:0,applet:272,area:2,article:0,aside:0,audio:0,b:0,base:274,basefont:274,bdi:0,bdo:0,big:0,blockquote:0,body:305,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,command:2,data:0,datalist:0,dd:1,del:0,details:0,dfn:0,dialog:272,
dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:274,frameset:272,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:305,header:0,hgroup:0,hr:2,html:305,i:0,iframe:4,img:2,input:2,ins:0,isindex:274,kbd:0,keygen:274,label:0,legend:0,li:1,link:274,map:0,mark:0,menu:0,meta:274,meter:0,nav:0,nobr:0,noembed:276,noframes:276,noscript:276,object:272,ol:0,optgroup:0,option:1,output:0,p:1,param:274,pre:0,progress:0,q:0,s:0,samp:0,script:84,section:0,select:0,small:0,source:2,span:0,
strike:0,strong:0,style:148,sub:0,summary:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:0,title:280,tr:1,track:2,tt:0,u:0,ul:0,"var":0,video:0,wbr:2};q.ELEMENTS=q.f;q.O={a:"HTMLAnchorElement",abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",b:"HTMLElement",base:"HTMLBaseElement",basefont:"HTMLBaseFontElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",
blockquote:"HTMLQuoteElement",body:"HTMLBodyElement",br:"HTMLBRElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",caption:"HTMLTableCaptionElement",center:"HTMLElement",cite:"HTMLElement",code:"HTMLElement",col:"HTMLTableColElement",colgroup:"HTMLTableColElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLModElement",details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",
dl:"HTMLDListElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLFieldSetElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLFontElement",footer:"HTMLElement",form:"HTMLFormElement",frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",h1:"HTMLHeadingElement",h2:"HTMLHeadingElement",h3:"HTMLHeadingElement",h4:"HTMLHeadingElement",h5:"HTMLHeadingElement",h6:"HTMLHeadingElement",head:"HTMLHeadElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLHRElement",html:"HTMLHtmlElement",
i:"HTMLElement",iframe:"HTMLIFrameElement",img:"HTMLImageElement",input:"HTMLInputElement",ins:"HTMLModElement",isindex:"HTMLUnknownElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLLabelElement",legend:"HTMLLegendElement",li:"HTMLLIElement",link:"HTMLLinkElement",map:"HTMLMapElement",mark:"HTMLElement",menu:"HTMLMenuElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",nav:"HTMLElement",nobr:"HTMLElement",noembed:"HTMLElement",noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLObjectElement",
ol:"HTMLOListElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",q:"HTMLQuoteElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLScriptElement",section:"HTMLElement",select:"HTMLSelectElement",small:"HTMLElement",source:"HTMLSourceElement",span:"HTMLSpanElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLStyleElement",sub:"HTMLElement",summary:"HTMLElement",
sup:"HTMLElement",table:"HTMLTableElement",tbody:"HTMLTableSectionElement",td:"HTMLTableDataCellElement",textarea:"HTMLTextAreaElement",tfoot:"HTMLTableSectionElement",th:"HTMLTableHeaderCellElement",thead:"HTMLTableSectionElement",time:"HTMLTimeElement",title:"HTMLTitleElement",tr:"HTMLTableRowElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLUListElement","var":"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"};q.ELEMENT_DOM_INTERFACES=q.O;q.N={NOT_LOADED:0,SAME_DOCUMENT:1,
NEW_DOCUMENT:2};q.ueffects=q.N;q.J={"a::href":2,"area::href":2,"audio::src":1,"blockquote::cite":0,"command::icon":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0,"video::poster":1,"video::src":1};q.URIEFFECTS=q.J;q.L={UNSANDBOXED:2,SANDBOXED:1,DATA:0};q.ltypes=q.L;q.I={"a::href":2,"area::href":2,"audio::src":2,"blockquote::cite":2,"command::icon":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2,"video::poster":1,"video::src":2};
q.LOADERTYPES=q.I;"undefined"!==typeof window&&(window.html4=q);var A=function(w){function m(na,va){if(z.hasOwnProperty(va))na=z[va];else{var ra=va.match(x);na=ra?String.fromCharCode(parseInt(ra[1],10)):(ra=va.match(y))?String.fromCharCode(parseInt(ra[1],16)):H&&D.test(va)?(H.innerHTML="\x26"+va+";",ra=H.textContent,z[va]=ra):"\x26"+va+";"}return na}function v(na){return na.replace(N,m)}function r(na){return(""+na).replace(M,"\x26amp;").replace(da,"\x26lt;").replace(J,"\x26gt;").replace(R,"\x26#34;")}
function l(na){return na.replace(Q,"\x26amp;$1").replace(da,"\x26lt;").replace(J,"\x26gt;")}function k(na){var va={z:na.z||na.cdata,A:na.A||na.comment,B:na.B||na.endDoc,r:na.r||na.endTag,d:na.d||na.pcdata,F:na.F||na.rcdata,H:na.H||na.startDoc,v:na.v||na.startTag};return function(ra,wa){var Z=/(<\/|\x3c!--|<[!?]|[&<>])/g;ra+="";if(X)ra=ra.split(Z);else{for(var Da=[],Ca=0,O;null!==(O=Z.exec(ra));)Da.push(ra.substring(Ca,O.index)),Da.push(O[0]),Ca=O.index+O[0].length;Da.push(ra.substring(Ca));ra=Da}d(va,
ra,0,{o:!1,C:!1},wa)}}function n(na,va,ra,wa,Z){return function(){d(na,va,ra,wa,Z)}}function d(na,va,ra,wa,Z){try{na.H&&0==ra&&na.H(Z);for(var Da,Ca,O,C=va.length;ra<C;){var G=va[ra++],L=va[ra];switch(G){case "\x26":S.test(L)?(na.d&&na.d("\x26"+L,Z,ma,n(na,va,ra,wa,Z)),ra++):na.d&&na.d("\x26amp;",Z,ma,n(na,va,ra,wa,Z));break;case "\x3c/":if(Da=/^([-\w:]+)[^'"]*/.exec(L))if(Da[0].length===L.length&&"\x3e"===va[ra+1])ra+=2,O=Da[1].toLowerCase(),na.r&&na.r(O,Z,ma,n(na,va,ra,wa,Z));else{var P=va,T=ra,
Y=na,fa=Z,ja=ma,ka=wa,ta=g(P,T);ta?(Y.r&&Y.r(ta.name,fa,ja,n(Y,P,T,ka,fa)),ra=ta.next):ra=P.length}else na.d&&na.d("\x26lt;/",Z,ma,n(na,va,ra,wa,Z));break;case "\x3c":if(Da=/^([-\w:]+)\s*\/?/.exec(L))if(Da[0].length===L.length&&"\x3e"===va[ra+1]){ra+=2;O=Da[1].toLowerCase();na.v&&na.v(O,[],Z,ma,n(na,va,ra,wa,Z));var pa=w.f[O];pa&ia&&(ra=c(va,{name:O,next:ra,c:pa},na,Z,ma,wa))}else{P=va;T=na;Y=Z;fa=ma;ja=wa;var V=g(P,ra);V?(T.v&&T.v(V.name,V.P,Y,fa,n(T,P,V.next,ja,Y)),ra=V.c&ia?c(P,V,T,Y,fa,ja):V.next):
ra=P.length}else na.d&&na.d("\x26lt;",Z,ma,n(na,va,ra,wa,Z));break;case "\x3c!--":if(!wa.C){for(Ca=ra+1;Ca<C&&("\x3e"!==va[Ca]||!/--$/.test(va[Ca-1]));Ca++);if(Ca<C){if(na.A){var ca=va.slice(ra,Ca).join("");na.A(ca.substr(0,ca.length-2),Z,ma,n(na,va,Ca+1,wa,Z))}ra=Ca+1}else wa.C=!0}wa.C&&na.d&&na.d("\x26lt;!--",Z,ma,n(na,va,ra,wa,Z));break;case "\x3c!":if(/^\w/.test(L)){if(!wa.o){for(Ca=ra+1;Ca<C&&"\x3e"!==va[Ca];Ca++);Ca<C?ra=Ca+1:wa.o=!0}wa.o&&na.d&&na.d("\x26lt;!",Z,ma,n(na,va,ra,wa,Z))}else na.d&&
na.d("\x26lt;!",Z,ma,n(na,va,ra,wa,Z));break;case "\x3c?":if(!wa.o){for(Ca=ra+1;Ca<C&&"\x3e"!==va[Ca];Ca++);Ca<C?ra=Ca+1:wa.o=!0}wa.o&&na.d&&na.d("\x26lt;?",Z,ma,n(na,va,ra,wa,Z));break;case "\x3e":na.d&&na.d("\x26gt;",Z,ma,n(na,va,ra,wa,Z));break;case "":break;default:na.d&&na.d(G,Z,ma,n(na,va,ra,wa,Z))}}na.B&&na.B(Z)}catch(aa){if(aa!==ma)throw aa;}}function c(na,va,ra,wa,Z,Da){var Ca=na.length;ha.hasOwnProperty(va.name)||(ha[va.name]=RegExp("^"+va.name+"(?:[\\s\\/]|$)","i"));for(var O=ha[va.name],
C=va.next,G=va.next+1;G<Ca&&("\x3c/"!==na[G-1]||!O.test(na[G]));G++);G<Ca&&--G;Ca=na.slice(C,G).join("");if(va.c&w.c.CDATA)ra.z&&ra.z(Ca,wa,Z,n(ra,na,G,Da,wa));else if(va.c&w.c.RCDATA)ra.F&&ra.F(l(Ca),wa,Z,n(ra,na,G,Da,wa));else throw Error("bug");return G}function g(na,va){var ra=/^([-\w:]+)/.exec(na[va]),wa={};wa.name=ra[1].toLowerCase();wa.c=w.f[wa.name];var Z=na[va].substr(ra[0].length);va+=1;for(var Da=na.length;va<Da&&"\x3e"!==na[va];va++)Z+=na[va];if(!(Da<=va)){for(var Ca=[];""!==Z;)if(ra=
W.exec(Z))if(ra[4]&&!ra[5]||ra[6]&&!ra[7]){ra=ra[4]||ra[6];var O=!1;for(Z=[Z,na[va++]];va<Da;va++){if(O){if("\x3e"===na[va])break}else 0<=na[va].indexOf(ra)&&(O=!0);Z.push(na[va])}if(Da<=va)break;Z=Z.join("")}else{O=ra[1].toLowerCase();if(ra[2]){var C=ra[3];var G=C.charCodeAt(0);if(34===G||39===G)C=C.substr(1,C.length-2);C=v(C.replace(I,""))}else C="";Ca.push(O,C);Z=Z.substr(ra[0].length)}else Z=Z.replace(/^[\s\S][^a-z\s]*/,"");wa.P=Ca;wa.next=va+1;return wa}}function b(na){function va(Z,Da){wa||
Da.push(Z)}var ra,wa;return k({startDoc:function(){ra=[];wa=!1},startTag:function(Z,Da,Ca){if(!wa&&w.f.hasOwnProperty(Z)){var O=w.f[Z];if(!(O&w.c.FOLDABLE)){var C=na(Z,Da);if(C){if("object"!==typeof C)throw Error("tagPolicy did not return object (old API?)");if("attribs"in C)Da=C.attribs;else throw Error("tagPolicy gave no attribs");var G;"tagName"in C?(G=C.tagName,C=w.f[G]):(G=Z,C=O);if(O&w.c.OPTIONAL_ENDTAG){var L=ra[ra.length-1];L&&L.D===Z&&(L.t!==G||Z!==G)&&Ca.push("\x3c/",L.t,"\x3e")}O&w.c.EMPTY||
ra.push({D:Z,t:G});Ca.push("\x3c",G);Z=0;for(L=Da.length;Z<L;Z+=2){var P=Da[Z],T=Da[Z+1];null!==T&&void 0!==T&&Ca.push(" ",P,'\x3d"',r(T),'"')}Ca.push("\x3e");O&w.c.EMPTY&&!(C&w.c.EMPTY)&&Ca.push("\x3c/",G,"\x3e")}else wa=!(O&w.c.EMPTY)}}},endTag:function(Z,Da){if(wa)wa=!1;else if(w.f.hasOwnProperty(Z)){var Ca=w.f[Z];if(!(Ca&(w.c.EMPTY|w.c.FOLDABLE))){if(Ca&w.c.OPTIONAL_ENDTAG)for(Ca=ra.length;0<=--Ca;){var O=ra[Ca].D;if(O===Z)break;if(!(w.f[O]&w.c.OPTIONAL_ENDTAG))return}else for(Ca=ra.length;0<=
--Ca&&ra[Ca].D!==Z;);if(!(0>Ca)){for(O=ra.length;--O>Ca;){var C=ra[O].t;w.f[C]&w.c.OPTIONAL_ENDTAG||Da.push("\x3c/",C,"\x3e")}Ca<ra.length&&(Z=ra[Ca].t);ra.length=Ca;Da.push("\x3c/",Z,"\x3e")}}}},pcdata:va,rcdata:va,cdata:va,endDoc:function(Z){for(;ra.length;ra.length--)Z.push("\x3c/",ra[ra.length-1].t,"\x3e")}})}function e(na,va,ra,wa,Z){if(!Z)return null;try{var Da=E.parse(""+na);if(Da&&(!Da.K()||xa.test(Da.U()))){var Ca=Z(Da,va,ra,wa);return Ca?Ca.toString():null}}catch(O){}return null}function a(na,
va,ra,wa,Z){ra||na(va+" removed",{Q:"removed",tagName:va});if(wa!==Z){var Da="changed";wa&&!Z?Da="removed":!wa&&Z&&(Da="added");na(va+"."+ra+" "+Da,{Q:Da,tagName:va,ia:ra,oldValue:wa,newValue:Z})}}function f(na,va,ra){va=va+"::"+ra;if(na.hasOwnProperty(va))return na[va];va="*::"+ra;if(na.hasOwnProperty(va))return na[va]}function h(na,va,ra,wa,Z){for(var Da=0;Da<va.length;Da+=2){var Ca=va[Da],O=va[Da+1],C=O,G=null,L;if((L=na+"::"+Ca,w.w.hasOwnProperty(L))||(L="*::"+Ca,w.w.hasOwnProperty(L)))G=w.w[L];
if(null!==G)switch(G){case w.e.NONE:break;case w.e.SCRIPT:O=null;Z&&a(Z,na,Ca,C,O);break;case w.e.STYLE:if("undefined"===typeof u){O=null;Z&&a(Z,na,Ca,C,O);break}var P=[];u(O,{declaration:function(T,Y){var fa=T.toLowerCase();t(fa,Y,ra?function(ja){return e(ja,w.N.ga,w.L.ha,{TYPE:"CSS",CSS_PROP:fa},ra)}:null);Y.length&&P.push(fa+": "+Y.join(" "))}});O=0<P.length?P.join(" ; "):null;Z&&a(Z,na,Ca,C,O);break;case w.e.ID:case w.e.IDREF:case w.e.IDREFS:case w.e.GLOBAL_NAME:case w.e.LOCAL_NAME:case w.e.CLASSES:O=
wa?wa(O):O;Z&&a(Z,na,Ca,C,O);break;case w.e.URI:O=e(O,f(w.J,na,Ca),f(w.I,na,Ca),{TYPE:"MARKUP",XML_ATTR:Ca,XML_TAG:na},ra);Z&&a(Z,na,Ca,C,O);break;case w.e.URI_FRAGMENT:O&&"#"===O.charAt(0)?(O=O.substring(1),O=wa?wa(O):O,null!==O&&void 0!==O&&(O="#"+O)):O=null;Z&&a(Z,na,Ca,C,O);break;default:O=null,Z&&a(Z,na,Ca,C,O)}else O=null,Z&&a(Z,na,Ca,C,O);va[Da+1]=O}return va}function p(na,va,ra){return function(wa,Z){if(w.f[wa]&w.c.UNSAFE)ra&&a(ra,wa,void 0,void 0,void 0);else return{attribs:h(wa,Z,na,va,
ra)}}}function B(na,va){var ra=[];b(va)(na,ra);return ra.join("")}var u,t;"undefined"!==typeof window&&(u=window.parseCssDeclarations,t=window.sanitizeCssProperty);var z={lt:"\x3c",LT:"\x3c",gt:"\x3e",GT:"\x3e",amp:"\x26",AMP:"\x26",quot:'"',apos:"'",nbsp:"\u00a0"},x=/^#(\d+)$/,y=/^#x([0-9A-Fa-f]+)$/,D=/^[A-Za-z][A-za-z0-9]+$/,H="undefined"!==typeof window&&window.document?window.document.createElement("textarea"):null,I=/\0/g,N=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,S=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,
M=/&/g,Q=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,da=/[<]/g,J=/>/g,R=/"/g,W=/^\s*([-.:\w]+)(?:\s*(=)\s*((")[^"]*("|$)|(')[^']*('|$)|(?=[a-z][-\w]*\s*=)|[^"'\s]*))?/i,X=3==="a,b".split(/(,)/).length,ia=w.c.CDATA|w.c.RCDATA,ma={},ha={},xa=/^(?:https?|mailto)$/i,ua={};ua.ka=ua.escapeAttrib=r;ua.la=ua.makeHtmlSanitizer=b;ua.ma=ua.makeSaxParser=k;ua.na=ua.makeTagPolicy=p;ua.pa=ua.normalizeRCData=l;ua.qa=ua.sanitize=function(na,va,ra,wa){return B(na,p(va,ra,wa))};ua.ra=ua.sanitizeAttribs=h;ua.sa=
ua.sanitizeWithPolicy=B;ua.ta=ua.unescapeEntities=v;return ua}(q);q=A.sanitize;"undefined"!==typeof window&&(window.html=A,window.html_sanitize=q);"function"===typeof define&&define.amd&&define([],function(){return A})})()},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dijit/Tooltip dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all dijit/registry ./utils jimu/tokenUtils ./dijit/Message ./DataSourceManager ./portalUrlUtils ./portalUtils".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u){var t=null,z=E(r,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;this.widgetsUri={};window.isBuilder?(v.subscribe("app/mapLoaded",q.hitch(this,this._onMapLoaded)),v.subscribe("app/mapChanged",q.hitch(this,this._onMapChanged))):(v.subscribe("mapLoaded",q.hitch(this,this._onMapLoaded)),v.subscribe("mapChanged",q.hitch(this,this._onMapChanged)));window.isBuilder?(v.subscribe("app/sceneViewLoaded",q.hitch(this,this._onSceneViewLoaded)),
v.subscribe("app/sceneViewChanged",q.hitch(this,this._onSceneViewChanged))):(v.subscribe("sceneViewLoaded",q.hitch(this,this._onSceneViewLoaded)),v.subscribe("sceneViewChanged",q.hitch(this,this._onSceneViewChanged)));window.isBuilder?(v.subscribe("app/appConfigLoaded",q.hitch(this,this._onAppConfigLoaded)),v.subscribe("app/appConfigChanged",q.hitch(this,this._onAppConfigChanged))):(v.subscribe("appConfigLoaded",q.hitch(this,this._onAppConfigLoaded)),v.subscribe("appConfigChanged",q.hitch(this,this._onAppConfigChanged)));
v.subscribe("userSignIn",q.hitch(this,this._onUserSignIn));v.subscribe("userSignOut",q.hitch(this,this._onUserSignOut));v.subscribe("builder/actionTriggered",q.hitch(this,this._onActionTriggered));v.subscribe("/dnd/move/start",q.hitch(this,this._onMoveStart))},loadWidget:function(x){var y=new m,D;x=q.clone(x);(D=this.getWidgetById(x.id))?y.resolve(D):this.getWidgetUri(x).then(q.hitch(this,function(H){x.uri=H;b([this.loadWidgetClass(x),this.loadWidgetManifest(x)]).then(q.hitch(this,function(I){var N=
I[0],S=I[1];this.loadWidgetResources(S).then(q.hitch(this,function(M){try{var Q=this.createWidget(S,N,M);w.setAttr(Q.domNode,"data-widget-name",S.name);console.log("widget ["+S.uri+"] created.")}catch(da){console.log("create ["+S.uri+"] error:"+da.stack),new h({message:window.jimuNls.widgetManager.createWidgetError+": "+S.uri}),e.byId(S.id)&&e.byId(S.id).destroy(),y.reject(da)}setTimeout(q.hitch(this,function(){y.resolve(Q);this.emit("widget-created",Q);v.publish("widgetCreated",Q)}),50)}),function(M){y.reject(M)})}),
function(I){y.reject(I)})}));return y},loadWidgetClass:function(x){var y=new m;var D=x.isRemote?x.uri+".js":x.uri;require(a.getRequireConfig(),[D],q.hitch(this,function(H){y.resolve(H)}));a.checkError(x.uri,y);return y},loadWidgetResources:function(x){var y=new m,D=[];var H=q.clone(x);x=this.tryLoadWidgetConfig(H);var I=this._tryLoadResource(H,"i18n");var N=this._tryLoadResource(H,"style");H=this._tryLoadResource(H,"template");D.push(x);D.push(I);D.push(H);D.push(N);b(D).then(q.hitch(this,function(S){var M=
{};M.config=S[0];M.i18n=S[1];M.template=S[2];M.style=S[3];y.resolve(M)}),function(S){y.reject(S)});return y},getWidgetUri:function(x){if(this.widgetsUri[x.id])return this.widgetsUri[x.id];var y=x.itemId?u.getPortal(window.portalUrl).getItemById(x.itemId).then(function(D){if(B.isOnline(window.portalUrl)){if(!B.isOnline(D.url)||"Web AppBuilder Widget"!==D.type)return(new m).reject("Not allow.",x.itemId)}else if("AppBuilder Extension"!==D.type)return(new m).reject("Not allow.",x.itemId);return a.widgetJson.getUriFromItem(D)}):
a.getUriInfo(x.uri).isRemote?(new m).reject("Not allow.",x.uri):(new m).resolve(x.uri);return this.widgetsUri[x.id]=y},loadWidgetManifest:function(x){var y=new m;return this.getWidgetUri(x).then(q.hitch(this,function(D){x.uri=D;if(x.manifest)return y.resolve(x),y;D=a.getUriInfo(D).folderUrl+"manifest.json";return g(D,{handleAs:"json",headers:{"X-Requested-With":null}}).then(q.hitch(this,function(H){if(H.error&&H.error.code)return y.reject(H.error);H.category="widget";q.mixin(H,a.getUriInfo(x.uri));
return a.manifest.addI18NLabel(H).then(q.hitch(this,function(){this._processManifest(H);a.widgetJson.addManifest2WidgetJson(x,H);y.resolve(x);return y}))}))}),function(D){y.reject(D)})},getWidgetMarginBox:function(x){if("string"===typeof x&&(x=this.getWidgetById(x),!x))return{};if(x._marginBox)return x._marginBox;var y={left:-9999,top:-9999,relativeTo:x.position.relativeTo};x._isTestSizeFlag=!0;x.setPosition(y);this.openWidget(x);x._marginBox=x.getMarginBox();this.closeWidget(x);"undefined"!==typeof x._isTestSizeFlag&&
delete x._isTestSizeFlag;return x._marginBox},_processManifest:function(x){a.manifest.addManifestProperies(x);a.manifest.processManifestLabel(x,window.dojoConfig.locale)},createWidget:function(x,y,D){if(this.getWidgetById(x.id))return this.getWidgetById(x.id);D.config&&D.i18n&&(D.config=a.replacePlaceHolder(D.config,D.i18n));x.rawConfig=x.config;x.config=D.config||{};this.appConfig._appData&&this._mergeAgolConfig(x);x.nls=D.i18n||{};D.template&&(x.templateString=D.template);x["class"]="jimu-widget";
x.label||(x.label=x.name);this.map&&(x.map=this.map);x.appConfig=this.appConfig;D={};for(var H in x)x.hasOwnProperty(H)&&(D[H]=x[H]);D.widgetManager=this;x=new y(D);x.clazz=y;n.after(x,"startup",q.hitch(this,this._postWidgetStartup,x));n.before(x,"destroy",q.hitch(this,this._onDestroyWidget,x));x.domNode.addEventListener(this._getActiveEventName(),q.hitch(this,this._onClickWidget,x),{capture:!0});this.loaded.push(x);return x},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var x=
A.map(this.loaded,function(y){return y.id});A.forEach(x,function(y){this.destroyWidget(y)},this);this.loaded=[]},loadWidgetSettingPage:function(x){var y=new m;x=q.clone(x);x.id+="_setting";b([this.loadWidgetSettingClass(x)]).then(q.hitch(this,function(D){var H=D[0];this.loadWidgetSettingPageResources(x).then(q.hitch(this,function(I){var N={nls:I.i18n,appConfig:this.appConfig,"class":"jimu-widget-setting"};null!==I.template&&(N.templateString=I.template);"HTML3D"===window.appInfo.appType?N.sceneView=
this.sceneView:N.map=this.map;for(var S in x)x.hasOwnProperty(S)&&(N[S]=x[S]);try{var M=new H(N);w.setAttr(M.domNode,"data-widget-name-setting",N.name);n.before(M,"destroy",q.hitch(this,this._onDestroyWidgetSetting,M));y.resolve(M)}catch(Q){new h({message:window.jimuNls.widgetManager.createWidgetSettingPageError+":"+x.uri}),e.byId(N.id)&&e.byId(N.id).destroy(),y.reject(Q)}}),function(I){console.log(I)})}),function(D){y.reject(D)});return y},loadWidgetSettingClass:function(x){var y=new m;var D=x.isRemote?
x.folderUrl+"setting/Setting.js":x.amdFolder+"setting/Setting";require(a.getRequireConfig(),[D],q.hitch(this,function(H){y.resolve(H)}));a.checkError(x.folderUrl+"setting/Setting.js",y);return y},loadWidgetSettingPageResources:function(x){var y=new m,D=[];x=q.clone(x);var H=this._tryLoadResource(x,"settingI18n");var I=this._tryLoadResource(x,"settingTemplate");x=this._tryLoadResource(x,"settingStyle");D.push(H);D.push(I);D.push(x);b(D).then(q.hitch(this,function(N){var S={};S.i18n=N[0]||{};S.template=
N[1];S.style=N[2];y.resolve(S)}),function(N){console.log(N)});return y},getWidgetById:function(x){var y;A.some(this.loaded,function(D){if(D.id===x)return y=D,!0},this);return y},getWidgetByLabel:function(x){var y;A.some(this.loaded,function(D){if(D.label===x)return y=D,!0},this);return y},getWidgetsByName:function(x){var y=[];A.some(this.loaded,function(D){D.name===x&&y.push(D)},this);return y},changeWindowStateTo:function(x,y){"normal"===y?this.normalizeWidget(x):"minimized"===y?this.minimizeWidget(x):
"maximized"===y?this.maximizeWidget(x):console.log("error state: "+y)},closeWidget:function(x){if("string"===typeof x&&(x=this.getWidgetById(x),!x))return;if("closed"!==x.state){this.activeWidget&&this.activeWidget.id===x.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);w.setStyle(x.domNode,"display","none");x.setState("closed");try{x.onClose()}catch(y){console.log(console.error("fail to close widget "+x.name+". "+y.stack))}}this.appConfig.mode||this._removeDataSourceUsage(x)},openWidget:function(x){if("string"===
typeof x&&(x=this.getWidgetById(x),!x))return;if(!x.started)try{x.started=!0,x.startup()}catch(y){console.error("fail to startup widget "+x.name+". "+y.stack)}if("closed"===x.state){w.setStyle(x.domNode,"display","");x.setState("opened");try{x.onOpen()}catch(y){console.error("fail to open widget "+x.name+". "+y.stack)}!x._isTestSizeFlag&&a.isAutoFocusFirstNodeWidget(x)&&a.focusFirstFocusNode(x.domNode);this.appConfig.mode||this._addDataSourceUsage(x)}},activateWidget:function(x){if("string"===typeof x&&
(x=this.getWidgetById(x),!x))return;"opened"===x.state&&this._activeWidget(x)},maximizeWidget:function(x){if("string"===typeof x&&(x=this.getWidgetById(x),!x))return;"closed"===x.state&&this.openWidget(x);x.setWindowState("maximized");try{x.onMaximize()}catch(y){console.log(console.error("fail to maximize widget "+x.name+". "+y.stack))}},minimizeWidget:function(x){if("string"===typeof x&&(x=this.getWidgetById(x),!x))return;"closed"===x.state&&this.openWidget(x);x.setWindowState("minimized");try{x.onMinimize()}catch(y){console.log(console.error("fail to minimize widget "+
x.name+". "+y.stack))}},normalizeWidget:function(x){if("string"===typeof x&&(x=this.getWidgetById(x),!x))return;"closed"===x.state&&this.openWidget(x);x.setWindowState("normal");try{x.onNormalize()}catch(y){console.log(console.error("fail to normalize widget "+x.name+". "+y.stack))}},destroyWidget:function(x){if("string"===typeof x&&(x=this.getWidgetById(x),!x))return;this._removeWidget(x);try{x.destroy()}catch(y){console.log(console.error("fail to destroy widget "+x.name+". "+y.stack))}},tryLoadWidgetConfig:function(x){return this._tryLoadWidgetConfig(x).then(q.hitch(this,
function(y){return this._upgradeWidgetConfig(x,y).then(function(D){return x.config=D})}))},triggerWidgetOpen:function(x){function y(N){var S=n.after(N,"onOpen",function(){S.remove();D.resolve(N)})}var D=new m,H=this.getWidgetById(x);if(H){if("closed"!==H.state)return D.resolve(H),D;y(H)}else var I=v.subscribe("widgetCreated",q.hitch(this,function(N){N.id===x&&(I.remove(),D.resolve(N))}));v.publish("openWidget",x);return D},_tryLoadWidgetConfig:function(x){var y=new m;if(x.config&&q.isObject(x.config))return y.resolve(x.config),
y;if(x.config){if(require.cache["url:"+x.config])return y.resolve(d.parse(require.cache["url:"+x.config])),y;y=a.processUrlInAppConfig(x.config);y=y.split("/");y[y.length-1]=encodeURIComponent(y[y.length-1]);y=y.join("/");return g(y,{handleAs:"json",headers:{"X-Requested-With":null}})}return this._tryLoadResource(x,"config").then(function(D){x.isDefaultConfig=!0;return D})},_upgradeWidgetConfig:function(x,y){var D=new m,H=x.manifest.version,I=x.version,N;if(H===I)return D.resolve(y),D;if(!1===x.hasVersionManager)return x.version=
H,D.resolve(y),D;require(a.getRequireConfig(),[x.amdFolder+(x.isRemote?"VersionManager.js":"VersionManager")],q.hitch(this,function(S){S=new S;var M=S.getVersionIndex(I),Q=S.getVersionIndex(H);if(M>Q)D.reject("Bad widget version number, "+x.name+","+I);else try{N=S.upgrade(y,I,H),x.version=H,D.resolve(N)}catch(da){console.log("Read widget ["+x.name+"] old config error,"+da.stack),D.resolve(y)}}));return D},loadWidgetStyle:function(x){var y=this._getStyleIdFromWidgetJson(x,!1),D=new m;return w.byId(y)?
(D.resolve("load"),D):a.loadStyleLink(y,x.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(x){var y=this._getStyleIdFromWidgetJson(x,!0),D=new m;return w.byId(y)?(D.resolve("load"),D):a.loadStyleLink(y,x.settingStyleFile)},loadWidgetConfig:function(x){x=require(a.getRequireConfig()).toUrl(x.configFile);if(require.cache["url:"+x]){var y=new m;y.resolve(d.parse(require.cache["url:"+x]));return y}return g(x,{handleAs:"json",headers:{"X-Requested-With":null}})},
loadWidgetI18n:function(x){var y=new m;require(a.getRequireConfig(),["dojo/i18n!"+x.i18nFile],function(D){y.resolve(D)});return y},loadWidgetSettingI18n:function(x){var y=new m;require(a.getRequireConfig(),["dojo/i18n!"+x.settingI18nFile],function(D){y.resolve(D)});return y},loadWidgetTemplate:function(x){var y=new m;require(a.getRequireConfig(),["dojo/text!"+x.templateFile],function(D){y.resolve(D)});a.checkError(x.templateFile,y);return y},loadWidgetSettingTemplate:function(x){var y=new m;require(a.getRequireConfig(),
["dojo/text!"+x.settingTemplateFile],function(D){y.resolve(D)});a.checkError(x.settingTemplateFile,y);return y},removeWidgetStyle:function(x){this._removeStyle(this._getStyleIdFromWidgetJson(x,!1))},removeWidgetSettingStyle:function(x){this._removeStyle(this._getStyleIdFromWidgetJson(x,!0))},_removeStyle:function(x){if(w.byId(x)){var y=w.attr(x,"data-import-styles");if(y)for(var D=0;D<parseInt(y,10);D++)w.destroy(x+"_import_"+D);w.destroy(x)}},_getStyleIdFromWidgetJson:function(x,y){return this._replaceId("widget/style/"+
(x.itemId?x.itemId:x.uri)+(y?"/setting":""))},getControllerWidgets:function(){return A.filter(this.loaded,function(x){return x.isController})},getOffPanelWidgets:function(){return A.filter(this.loaded,function(x){return!x.inPanel})},getOnScreenOffPanelWidgets:function(){return A.filter(this.loaded,function(x){return x.isOnScreen&&!x.inPanel})},closeOtherWidgetsInTheSameGroup:function(x){if("string"===typeof x&&(x=this.getWidgetById(x),!x))return;for(var y=0;y<this.loaded.length;y++)this.loaded[y].gid===
x.gid&&this.loaded[y].id!==x.id&&this.closeWidget(this.loaded[y])},closeAllWidgetsInGroup:function(x){for(var y=0;y<this.loaded.length;y++)this.loaded[y].gid===x&&this.closeWidget(this.loaded[y])},_addDataSourceUsage:function(x){A.forEach(this._getUsedDataSourceIdFromWidget(x),function(y){p.getInstance().addDataSourceUsage(y,x.id)})},_removeDataSourceUsage:function(x){A.forEach(this._getUsedDataSourceIdFromWidget(x),function(y){p.getInstance().removeDataSourceUsage(y,x.id)})},_getUsedDataSourceIdFromWidget:function(x){if((x=
this.appConfig.getConfigElementById(x.id))&&x.config){var y=d.stringify(x.config);return A.filter(Object.keys(this.appConfig.dataSource.dataSources),function(D){return-1<y.indexOf(D)},this)}},_mergeAgolConfig:function(x){var y=this.appConfig._appData.values,D="widgets["+x.id+"]",H;for(H in y){var I=H.replace(/\//g,"_").indexOf(D+"_config");0<=I&&a.template.setConfigValue(x,H.replace(/\//g,"_").substr(I,H.length).replace(D,"widget"),y[H])}},_onUserSignIn:function(x){A.forEach(this.loaded,function(y){y.onSignIn(x)},
this)},_onUserSignOut:function(){A.forEach(this.loaded,function(x){x.onSignOut()},this)},_activeWidget:function(x){if(this.activeWidget){if(this.activeWidget.id===x.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&w.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&w.setStyle(x.domNode,"zIndex","zIndex"in x.position?x.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=
x;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&w.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),v.publish("widgetActived",x))},_onClickWidget:function(x,y){var D=c(".jimu-widget",x.domNode);if(0<D.length)for(var H=0;H<D.length;H++)if(y.target===D[H]||w.isDescendant(y.target,D[H]))return;this._activeWidget(x)},_onMoveStart:function(x){A.forEach(this.loaded,function(y){y.domNode===
x.node&&this._activeWidget(y)},this)},_onAppConfigLoaded:function(x){this.appConfig=x=q.clone(x);f.setPortalUrl(x.portalUrl)},_onMapLoaded:function(x){this.map=x},_onMapChanged:function(x){this.map=x},_onSceneViewLoaded:function(x){this.sceneView=x},_onSceneViewChanged:function(x){this.sceneView=x},_onAppConfigChanged:function(x,y,D,H){var I=q.clone(x);this.appConfig=I;A.forEach(this.loaded,function(N){N&&(N.onAppConfigChanged(I,y,D,H),"widgetChange"===y&&this._onConfigChanged(D.id,D.config,H))},
this)},_onConfigChanged:function(x,y){if(x=this.getWidgetById(x))x.onConfigChanged(y),q.mixin(x.config,y)},_onActionTriggered:function(x){if("map"!==x.elementId&&"app"!==x.elementId){var y=this.getWidgetById(x.elementId);if(y)y.onAction(x.action,x.data);else this.missedActions.push({id:x.elementId,action:{name:x.action,data:x.data}});A.forEach(this.getControllerWidgets(),function(D){if(D.widgetIsControlled(x.elementId))D.onAction(x.action,{widgetId:x.elementId,data:x.data})},this)}},_resetFirstFocusNode:function(x){if(window.isMoveFocusWhenInit){var y=
this.getWidgetsByName("Splash")[0];if(y&&"none"!==w.getStyle(y.domNode,"display"))window.isMoveFocusWhenInit=!1,x&&"Splash"===x.name||y.domNode.focus();else if(window.currentMsgPopup&&window.currentMsgPopup.firstFocusNode)window.isMoveFocusWhenInit=!1,window.currentMsgPopup.focusedNodeBeforeOpen=a.getFirstSkipLink(),window.currentMsgPopup.firstFocusNode.focus();else if(window.isMoveFocusWhenInit)window.isMoveFocusWhenInit=!1,a.isInNavMode()&&a.focusOnFirstSkipLink();else return!1;return!0}},_postWidgetStartup:function(x){x.started=
!0;a.setVerticalCenter(x.domNode);n.after(x,"resize",q.hitch(this,a.setVerticalCenter,x.domNode));a.initTabIndexAndOrder(x);a.initWidgetCancelEvent(x);var y=x.position||x.panel&&x.panel.position;y&&"browser"===y.relativeTo&&l(x.domNode,"focus",q.hitch(this,function(){this._resetFirstFocusNode()}));this.openWidget(x);if(y=f.getPortalCredential(this.appConfig.portalUrl))x.onSignIn(y);else x.onSignOut();this._triggerMissedAction(x);x.inPanel||a.addTooltipByDomNode(k,x.domNode,x.label)},_triggerMissedAction:function(x){this.missedActions.forEach(function(y){if(y.id===
x.id)x.onAction(y.action.name,y.action.data)})},_remove:function(x){delete this.widgetsUri[x];return A.some(this.loaded,function(y,D){if(y.id===x)return this.loaded.splice(D,1),!0},this)},_tryLoadResource:function(x,y){var D=new m,H=function(){if("config"===y)var N=this.loadWidgetConfig(x);else if("style"===y)N=this.loadWidgetStyle(x);else if("i18n"===y)N=this.loadWidgetI18n(x);else if("template"===y)N=this.loadWidgetTemplate(x);else if("settingTemplate"===y)N=this.loadWidgetSettingTemplate(x);else if("settingStyle"===
y)N=this.loadWidgetSettingStyle(x);else if("settingI18n"===y)N=this.loadWidgetSettingI18n(x);else return D;N.then(function(S){D.resolve(S)},function(S){console.error("Load widget resource error. resource:",y);console.error(S);new h({message:window.jimuNls.widgetManager.loadWidgetResourceError+": "+x.uri});D.reject(S)})};if("config"===y){var I=x.amdFolder+"config.json";x.configFile=I;I="hasConfig"}else if("style"===y)I=x.amdFolder+"css/style.css",x.styleFile=I,I="hasStyle";else if("i18n"===y)I=x.amdFolder+
"nls/strings.js",x.i18nFile=x.isRemote?I:x.amdFolder+"nls/strings",I="hasLocale";else if("template"===y)I=x.amdFolder+"Widget.html",x.templateFile=I,I="hasUIFile";else if("settingTemplate"===y)I=x.amdFolder+"setting/Setting.html",x.settingTemplateFile=I,I="hasSettingUIFile";else if("settingI18n"===y)I=x.amdFolder+"setting/nls/strings.js",x.settingI18nFile=x.isRemote?I:x.amdFolder+"setting/nls/strings",I="hasSettingLocale";else if("settingStyle"===y)I=x.amdFolder+"setting/css/style.css",x.settingStyleFile=
I,I="hasSettingStyle";else return D;x[I]?H.apply(this):D.resolve(null);return D},_replaceId:function(x){return x.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(x){"closed"!==x.state&&this.closeWidget(x);this._removeWidget(x);this.emit("widget-destroyed",x.id);v.publish("widgetDestroyed",x.id);console.log("destroy widget ["+x.uri+"].")},_onDestroyWidgetSetting:function(x){this.removeWidgetSettingStyle(x)},_removeWidget:function(x){if("string"===typeof x&&(x=this.getWidgetById(x),
!x))return;this.activeWidget&&this.activeWidget.id===x.id&&(this.activeWidget=null);this._remove(x.id);0===this.getWidgetsByName(x.name).length&&this.removeWidgetStyle(x)},_getActiveEventName:function(){var x="PointerEvent"in window?"pointer":"MSPointerEvent"in window?"MSPointer":!1,y=x&&"MS"===x.slice(0,2);return x?x+(y?"Down":"down"):"mousedown"}});z.getInstance=function(x){null===t&&(t=new z(x),window._widgetManager=t);return t};return z})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/config esri/request esri/urlUtils esri/sniff esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils esri/layers/vectorTiles/kernel".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h){"function"!==typeof m.getAll&&(m.getAll=function(p){var B=[];(p=m(p))&&B.push(p);return B});b={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return f.isInConfigOrPreviewWindow()},isStringStartWith:function(p,B){return p.substr(0,B.length)===B},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(p){(p=a.getStandardPortalUrl(p))&&
(p+="/");this.portalUrl=p},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(p){var B=new w,u=a.getStandardPortalUrl(p);p=u+"/sharing";var t=a.setHttpsProtocol(u+"/sharing/generateToken?f\x3djson"),z=a.setHttpsProtocol(p);l.get(t,{jsonp:"callback"}).then(E.hitch(this,function(x){x.token?(this.webTierPortalUrls.push(u),this.removeWabAuthInfo(),k.id.getCredential(z).then(E.hitch(this,function(y){function D(I){var N=I.creationTime||(new Date).getTime(),S=I.expires;0<N&&0<S&&S>N&&
setTimeout(function(){l.get(t,{jsonp:"callback"}).then(function(M){M.token&&(I.token=M.token,I.expires=M.expires,I.creationTime=(new Date).getTime(),I.refreshServerTokens(),D(I))},function(M){console.error(M)})},.8*(S-N))}y.token||(y.token=x.token);y.expires||(y.expires=x.expires);var H=this.findServerFromCorsEnabledServers(y.server);-1<H&&n.defaults.io.corsEnabledServers.splice(H,1);this._pushCorsEnabledServerInfo({host:a.getServerByUrl(u),withCredentials:!0});B.resolve(!0);D(y)}),E.hitch(this,function(){B.resolve(!0)}))):
B.resolve(!1)}),E.hitch(this,function(x){console.error(x);B.reject(x)}));return B},addAuthorizedCrossOriginDomains:function(p){if(p&&0<p.length)for(var B=0;B<p.length;B++)this.addWithCredentialDomain(p[B])},addWithCredentialDomain:function(p){if(p&&"string"===typeof p){var B=n.defaults.io.corsEnabledServers,u=a.getServerByUrl(p);(p=a.getServerWithProtocol(p))||(p="http://"+u);p=this.findServerFromCorsEnabledServers(p);-1<p&&B.splice(p,1);this._pushCorsEnabledServerInfo({host:u,withCredentials:!0})}},
findServerFromCorsEnabledServers:function(p){var B=n.defaults.io.corsEnabledServers,u,t=-1;g("esri-cors")&&B&&B.length&&q.some(B,function(z,x){z=!z||"object"!==typeof z||z instanceof RegExp?z:z.host;return!(z instanceof RegExp)&&z&&(u=0!==z.trim().toLowerCase().indexOf("http"),c.hasSameOrigin(p,u?"http://"+z:z)||u&&c.hasSameOrigin(p,"https://"+z))?(t=x,!0):!1});return t},_pushCorsEnabledServerInfo:function(p){if(p){var B=n.defaults.io.corsEnabledServers,u="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");
if("object"===typeof p&&"string"===typeof p.host){for(var t in p.host)p[t]="function"===typeof p.host[t]?function(){return p.host[t].apply(p.host,arguments)}:p.host[t];p.length=p.host.length;q.forEach(u,function(z){"function"===typeof p.host[z]&&(p[z]=function(){return p.host[z].apply(p.host,arguments)})})}B.push(p)}},tryRegisterCredential:function(p){return this.isValidCredential(p)?q.some(k.id.credentials,E.hitch(this,function(B){return p.token===B.token}))?!1:(k.id.credentials.push(p),!0):!1},
registerToken:function(p){var B=a.getSharingUrl(this.portalUrl);k.id.findCredential(B)&&q.some(k.id.credentials,E.hitch(this,function(u,t){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,u))return k.id.credentials.splice(t,1),!0}));return this._getTokenInfo(p).then(function(u){u&&k.id.registerToken(u)})},_getTokenInfo:function(p){var B=a.getPortalSelfInfoUrl(this.portalUrl);return l.get(B+("?f\x3djson\x26token\x3d"+p),{jsonp:"callback"}).then(E.hitch(this,function(u){return u.user?{server:a.getSharingUrl(this.portalUrl),
ssl:u.allSSL,token:p,userId:u.user.username}:null}),function(u){console.error(u);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(p){return p&&"string"===typeof p&&E.trim(p)},signInPortal:function(p){var B=new w;if(this._isInvalidPortalUrl(p)){p=a.getStandardPortalUrl(p);var u=a.getSharingUrl(p),t=this.getPortalCredential(p);t?setTimeout(E.hitch(this,function(){B.resolve(t)}),0):B=k.id.getCredential(u)}else setTimeout(E.hitch(this,function(){B.reject("Invalid portalurl.")}),
0);return B},_loadPortalSelfInfo:function(p){p=a.getPortalSelfInfoUrl(p);return d({url:p,handleAs:"json",content:{f:"json"},callbackParamName:"callback"})},registerOAuthInfo:function(p,B,u){if(!p||"string"!==typeof p||!B||"string"!==typeof B)return null;u||(u=0);var t=k.id.findOAuthInfo(p);t||(t=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+"/oauth-callback.html",t=new e({appId:B,expiration:20159,portalUrl:p,authNamespace:"/",popup:!0,flowType:8.4<=Number(u)?"authorization-code":
"auto",popupCallbackUrl:t}),k.id.registerOAuthInfos([t]));t.appId=B;return t},signOutAll:function(p){var B=a.getStandardPortalUrl(this.portalUrl)+"/sharing/rest",u=a.getPortalSignInUrlFromLocation();u=u+"?returnUrl\x3d"+encodeURIComponent(window.location.href);var t=f.getLocationUrlWithoutHashAndQueryParams();t=f.url.addQueryParamToUrl(t,"action","setportalurl");window.appInfo.isRunInPortal?(this.removeEsriAuthCookieStorage(),window.location.href=B+"/oauth2/signout?client_id\x3darcgisonline\x26redirect_uri\x3d"+
u):(this.removeWabAuthInfo(),p&&p.supportsOAuth?(p=B+"/oauth2/signout?client_id\x3d"+p.appId+"\x26redirect_uri\x3d"+t,window.location.href=p):window.location.href=t)},userHaveSignInPortal:function(p){return!!this.getPortalCredential(E.trim(p||""))},isValidCredential:function(p){var B=!1;if(p){B=p.token;var u=p.server,t=p.scope;B=B&&"string"===typeof B&&E.trim(B);u=u&&"string"===typeof u&&E.trim(u);t="portal"===t||"server"===t;var z=!0;p.expires&&(p=parseInt(p.expires,10),z=(new Date).getTime(),z=
p>z);B=B&&u&&t&&z}return B},isValidPortalCredentialOfPortalUrl:function(p,B){var u=!1;this.isValidCredential(B)&&(u="portal"===B.scope,p=a.isSameServer(p,B.server),u=u&&p);return u},getPortalCredential:function(p){var B=null;p=E.trim(p||"");if(!p)return null;p=a.getStandardPortalUrl(p);(B=this._filterPortalCredential(p,k.id.credentials))||this._tryConvertArcGIScomCrendentialToOrgCredential();return B},_tryConvertArcGIScomCrendentialToOrgCredential:function(){var p=this.portalUrl;if(p&&(p=a.getStandardPortalUrl(p),
a.isOrgOnline(p)&&!this._filterPortalCredential(p,k.id.credentials))){var B=this._filterPortalCredential("http://www.arcgis.com",k.id.credentials);B&&k.id.registerToken({token:B.token,scope:"portal",userId:B.userId,server:p+"/sharing/rest",expires:B.expires})}},saveAndRegisterCookieToCredential:function(p){p=E.clone(p);p.referer=window.location.host;p.scope="portal";p.isAdmin=!!p.isAdmin;this.saveWabAuthInfo(p);var B=p.server+"/sharing/rest";p.server=B;k.id.registerToken(p);return k.id.findCredential(B,
p.userId)},registerAuth2Hash:function(p){p=E.clone(p);var B=1E3*parseInt(p.expires_in,10);B=(new Date).getTime()+B;var u=a.getStandardPortalUrl(p.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:u,token:p.access_token,expires:B,userId:p.username,scope:"portal",isAdmin:!!p.isAdmin})},readWabAuthInfo:function(){var p=null,B=localStorage.getItem("wab_token");try{var u=m("wab_auth");u&&(p=v.parse(u),p.token=B)}catch(t){console.error(t)}return p},saveWabAuthInfo:function(p){p=
E.clone(p);this.removeWabAuthInfo();localStorage.setItem("wab_token",p.token);delete p.token;m("wab_auth",v.stringify(p),{expires:new Date(p.expires),path:"/"})},removeWabAuthInfo:function(){this.removeCookie("wab_auth");localStorage.removeItem("wab_token")},removeEsriAuthCookieStorage:function(){window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(p,B){var u=null;p=a.getStandardPortalUrl(p);
B&&0<B.length&&(B=q.filter(B,E.hitch(this,function(t){return this.isValidPortalCredentialOfPortalUrl(p,t)})),0<B.length&&(u=B[B.length-1]));return u},_removePortalCredential:function(p){var B=E.trim(p||"");if(B){B=a.getStandardPortalUrl(B);for(p=q.filter(k.id.credentials,E.hitch(this,function(u){return this.isValidPortalCredentialOfPortalUrl(B,u)}));0<p.length;)p[0].destroy(),p.splice(0,1);k.id.credentials=q.filter(k.id.credentials,E.hitch(this,function(u){return!this.isValidPortalCredentialOfPortalUrl(B,
u)}))}},getUserIdByToken:function(p,B){var u=new w;if(p&&"string"===typeof p&&B&&"string"===typeof B){var t=a.getStandardPortalUrl(B);B=q.filter(k.id.credentials,E.hitch(this,function(x){var y=x.token===p&&x.userId;x=a.isSameServer(t,x.server);return y&&x}));if(0<B.length){var z=B[0];setTimeout(E.hitch(this,function(){u.resolve(z.userId)}),0);return u}B=a.getCommunitySelfUrl(t);d({url:B,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(E.hitch(this,function(x){u.resolve(x&&x.username||
"")}),E.hitch(this,function(x){console.error(x);u.reject("fail to get userId by token")}))}else setTimeout(E.hitch(this,function(){u.reject("invalid parameters")}),0);return u},xtGetCredentialFromCookie:function(p){var B=this.readWabAuthInfo();if(!B||"object"!==typeof B||!a.isSameServer(p,B.server)||window.location.host!==B.referer)return null;B.expires=parseInt(B.expires,10);var u=(new Date).getTime();if(!(B.expires>u))return this.removeWabAuthInfo(),null;p+="/sharing/rest";B.server=p;(u=k.id.findCredential(p))||
k.id.registerToken(B);return u=k.id.findCredential(p)},removeCookie:function(p){var B=this.getCookiePath();f.removeCookie(p,B)},_getDomainsByServerName:function(p){var B=p.split("."),u=B.length;return q.map(B,E.hitch(this,function(t,z){t=B.slice(z,u);var x="",y=t.length-1;q.forEach(t,E.hitch(this,function(D,H){x+=D;H!==y&&(x+=".")}));return x}))},_publishCurrentPortalUserSignIn:function(p){if(this.isValidCredential(p))try{r.publish("userSignIn",p)}catch(B){console.error(B)}},_publishAnyUserSignIn:function(p){if(this.isValidCredential(p))try{r.publish("anyUserSignIn",
p)}catch(B){console.error(B)}},_publishCurrentPortalUserSignOut:function(p){try{r.publish("userSignOut",p)}catch(B){console.error(B)}},_signInSuccess:function(p){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,p)&&this._publishCurrentPortalUserSignIn(p),this._publishAnyUserSignIn(p)}catch(B){console.error(B)}},_bindEvents:function(){A.after(k.id,"signIn",E.hitch(this,function(p,B){console.log(B[1]);A.after(p,"callback",E.hitch(this,function(u,t){this._signInSuccess(t[0],!1)}));return p}))},
isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var p=window.parent;if(p){var B=p.esri&&p.esri.id;B._wab="builder";if(B){k.id=B;var u=window.esriConfig.defaults.io;p=p.esriConfig.defaults.io;u.corsEnabledServers=p.corsEnabledServers;u.webTierAuthServers=p.webTierAuthServers;u._processedCorsServers=p._processedCorsServers;u.corsStatus=p.corsStatus;Object.defineProperty(h,"id",{get:function(){return B},enumerable:!0,configurable:!0})}}}this._bindEvents();
this._started=!0}}};b.startup();return b})},"esri/layers/vectorTiles/kernel":function(){define(["require","exports","esri/kernel","./identity/IdentityManager"],function(E,q,A,w){return function(){function m(){}Object.defineProperty(m,"id",{get:function(){return A.id?w:null},enumerable:!0,configurable:!0});m.workerMessages={};return m}()})},"esri/layers/vectorTiles/identity/IdentityManager":function(){define(["require","exports","esri/IdentityManager"],function(E,q,A){Object.defineProperty(q,"__esModule",
{value:!0});q.findCredential=function(w){return A.findCredential(w)}})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),function(E,q,A,w,m,v){return E(v,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,customZIndex:null,postMixInProperties:function(){this.content=this.message;window.currentMsgPopup=this},_createTitleNode:function(){this.titleLabel&&
(this.titleNode=A.create("div",{"class":"title"},this.domNode),this.titleLabeNode=A.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=A.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing",role:"button",tabindex:0},this.titleNode),this.own(m(this.closeBtnNode,"click",q.hitch(this,this.close))),this.own(m(this.closeBtnNode,"keydown",q.hitch(this,function(r){r.keyCode===w.ENTER&&(this.close(),this.focusLastActiveNode())}))))},
_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:w.ENTER,onClick:q.hitch(this,this.close)})},_increaseZIndex:function(){A.setStyle(this.domNode,"zIndex",501);A.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/Evented dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/keys dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b){var e=0;return E([g,A],{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",classNames:[],titleLabel:"",content:null,container:null,customZIndex:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,isResize:!0,horizontalWidthRate:0,maxHeight:800,maxWidth:1024,enableMoveable:!0,hasTitle:!0,contentHasNoMargin:!1,hasOverlay:!0,moveToCenter:!0,customPosition:null,hiddenAfterInit:!1,useFocusLogic:!0,constructor:function(){this.buttons=
[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},focusLastActiveNode:function(){this.focusedNodeBeforeOpen&&this.useFocusLogic&&this.focusedNodeBeforeOpen.focus()},postCreate:function(){this.focusedNodeBeforeOpen=document.activeElement;this._preProcessing();this.inherited(arguments);this._initDomNode();this._addStylesByHeightType();this._calcAndSetPosition();m.place(this.domNode,this.container);setTimeout(q.hitch(this,function(){this._calcAndSetPosition(!0,
!1);this.initFocusNodes()}),50);this.isResize&&this.own(r(window,"resize",q.hitch(this,function(){this._calcAndSetPosition(!0,!0)})));this.hasOverlay&&(this.overlayNode=m.create("div",{"class":"jimu-overlay"},this.container));this.customZIndex||0===this.customZIndex?(m.setStyle(this.domNode,"zIndex",this.customZIndex+1),this.overlayNode&&m.setStyle(this.overlayNode,"zIndex",this.customZIndex)):this._increaseZIndex();this.hiddenAfterInit&&this.hide();v.animateProperty({node:this.domNode,properties:{opacity:1},
duration:200}).play();m.setAttr(this.domNode,"aria-label",window.jimuNls.common.popup);this.own(r(this.domNode,"keydown",q.hitch(this,function(a){a.keyCode===l.ESCAPE&&(this.closeBtnNode?this.closeBtnNode.focus():(this.close(),this.focusLastActiveNode()));b.preventMapNavigation(a)})))},initFocusNodes:function(){if(this.useFocusLogic){if("string"===typeof this.content){var a="uniqMsgId_"+b.getUUID();m.setAttr(this.contentContainerNode,"id",a);m.setAttr(this.domNode,"tabindex","0");m.setAttr(this.domNode,
"aria-labelledby",a)}this.firstFocusNode=this._getFirstFocusNode();this.lastFocusNode=this._getLastFocusNode();this.firstFocusNode&&(this.own(r(this.firstFocusNode,"keydown",q.hitch(this,function(f){f.shiftKey&&f.keyCode===l.TAB&&(f.preventDefault(),this.firstFocusNode.focus())}))),this.firstFocusNode.focus());this.lastFocusNode&&this.own(r(this.lastFocusNode,"keydown",q.hitch(this,function(f){f.shiftKey||f.keyCode!==l.TAB||(f.preventDefault(),this.firstFocusNode.focus())})))}},_getFirstFocusNode:function(){var a=
this.closeBtnNode;"string"===typeof this.content&&(a=this.domNode);if(!a){var f=[];this.content.domNode?f=b.getFocusNodesInDom(this.content.domNode):1===this.content.nodeType&&(f=b.getFocusNodesInDom(this.content));0<f.length?a=f[0]:this.buttons.length&&(a=this._getFirstBtn())}return a},_getLastFocusNode:function(){var a=this._getLastBtn();if(!a)if(this.content&&"string"!==typeof this.content){var f;this.content.domNode?f=b.getFocusNodesInDom(this.content.domNode):1===this.content.nodeType&&(f=b.getFocusNodesInDom(this.content));
a=0<f.length?f[f.length-1]:this.closeBtnNode}else a=this.closeBtnNode;return a},_getFirstBtn:function(){for(var a=null,f=d(".jimu-btn",this.buttonContainer),h=0;h<=f.length-1;h++)if("none"!==m.getStyle(f[h],"display")){a=f[h];break}return a},_getLastBtn:function(){for(var a=null,f=d(".jimu-btn",this.buttonContainer),h=f.length-1;0<=h;h--)if("none"!==m.getStyle(f[h],"display")){a=f[h];break}return a},_preProcessing:function(){"number"!==typeof this.width&&(this.width=this.maxWidth);"number"===typeof this.height&&
(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=m.create("div",{"class":"title"},this.domNode);this.titleLabeNode=m.create("span",{"class":"title-label jimu-float-leading",innerHTML:b.sanitizeHTML(this.titleLabel)||"\x26nbsp"},this.titleNode);this.closeBtnNode=m.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing",tabindex:0,"aria-label":window.jimuNls.common.close,role:"button"},this.titleNode);
var a=null;a="ontouchstart"in document?n.press:"click";this.own(r(this.closeBtnNode,a,q.hitch(this,this.close)));this.own(r(this.closeBtnNode,"keydown",q.hitch(this,function(f){f.keyCode!==l.ENTER&&f.keyCode!==l.SPACE||this.close()})))},_initDomNode:function(){for(var a=0;a<=this.classNames.length-1;a++)m.addClass(this.domNode,this.classNames[a]);this.hasTitle&&this._createTitleNode();this.contentContainerNode=m.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?
this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&m.place(this.content,this.contentContainerNode));this.buttonContainer=m.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&m.setStyle(this.buttonContainer,"display","none");for(a=0;a<=this.buttons.length-1;a++)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=
this.enabledButtons.length;if(0!==a){var f=m.getContentBox(this.buttonContainer),h=m.getMarginExtents(this.enabledButtons[0]),p=m.getPadBorderExtents(this.enabledButtons[0]),B=0;p=8===k("ie")?p.l+p.r:0;B=(f.w-(h.l+h.r+p)*a)/a;0<B&&(w.forEach(this.enabledButtons,q.hitch(this,function(u){m.setStyle(u,"maxWidth",B+"px")})),w.forEach(this.disabledButtons,q.hitch(this,function(u){m.setStyle(u,"maxWidth",B+"px")})))}},_moveableNode:function(a,f){this.moveable&&(this.moveable.destroy(),this.moveable=null);
var h=m.getMarginBox(this.container);h.l=h.l-a+f;h.w+=2*(a-f);this.moveable=new c.boxConstrainedMoveable(this.domNode,{box:h,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(r(this.moveable,"Moving",q.hitch(this,this.onMoving)));this.own(r(this.moveable,"MoveStop",q.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===d("#header").length?{t:0,l:0,w:0,h:0}:m.getMarginBox("header")},_getFooterBox:function(){return 0===d(".footer",this.container).length?{t:0,l:0,w:0,
h:0}:m.getMarginBox(d(".footer",this.container)[0])},_calcAndSetPosition:function(a,f){var h=m.getMarginBox(this.domNode);if("string"!==typeof this.container||m.byId(this.container)){var p=m.getContentBox(this.container),B=this._getHeaderBox(),u=this._getFooterBox();u=p.h-B.h-u.h-40;var t=0,z=0;this.customPosition&&this.customPosition.height?(this.height=this.customPosition.height,z="number"===typeof this.height?this.height+"px":this.height):(this.height=this._fixedHeight?this.height>u?u:this.height:
this.autoHeight?(h.h>u?u:h.h)||u-200:u>this.maxHeight?this.maxHeight:u,z=this.height+"px");this.customPosition&&this.customPosition.width?(this.width=this.customPosition.width,t="number"===typeof this.width?this.width+"px":this.width):("number"===typeof this.horizontalWidthRate&&0<this.horizontalWidthRate?(t=m.getMarginBox(window.document.body).w*this.horizontalWidthRate,this.width=t=t>this.maxWidth?t:this.maxWidth):this.width=this.width||this.maxWidth,t=this.width+"px");var x=h=0;this.customPosition?
(h="number"===typeof this.customPosition.left?this.customPosition.left+"px":this.customPosition.left,x="number"===typeof this.customPosition.top?this.customPosition.top+"px":this.customPosition.top):this.moveToCenter&&(x=(u-this.height)/2+B.h+20,x=x<B.h?B.h:x,h=(p.w-this.width)/2+"px",x+="px");m.setStyle(this.domNode,{width:t,height:this.autoHeight?"auto":z,left:h,top:x});this.enableMoveable&&this._moveableNode(this.width,100);!this.moveToCenter&&a&&"block"===m.getStyle(this.domNode,"display")&&this.emit("popupHasInitedSuccessfully",
f)}},setDomNodeStyls:function(a){m.setStyle(this.domNode,a)},setCustomPosition:function(a,f,h,p){this.width=h||this.width||this.maxWidth;this.height=p||this.height||this.maxHeight;h="number"===typeof this.width?this.width+"px":this.width;p="number"===typeof this.height?this.height+"px":this.height;m.setStyle(this.domNode,{left:"number"===typeof a?a+"px":a,top:"number"===typeof f?f+"px":f,width:h,height:this.autoHeight?"auto":p})},_addStylesByHeightType:function(){this.autoHeight?(m.addClass(this.contentContainerNode,
"content-static"),0===this.buttons.length&&m.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(m.addClass(this.contentContainerNode,"content-absolute"),this.hasTitle||m.addClass(this.contentContainerNode,"no-popup-title-content-absolute"),m.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&m.setStyle(this.contentContainerNode,{bottom:"15px"}));this.contentHasNoMargin&&m.addClass(this.contentContainerNode,"content-fill-Popup")},_increaseZIndex:function(){m.setStyle(this.domNode,
"zIndex",e+200+1);this.overlayNode&&m.setStyle(this.overlayNode,"zIndex",e+200);e++},setTitleLabel:function(a){this.titleNode.innerHTML=b.stripHTML(a)},onMoving:function(a){m.setStyle(a.node,"opacity",.9)},onMoveStop:function(a){m.setStyle(a.node,"opacity",1)},show:function(){this.overlayNode&&m.setStyle(this.overlayNode,"display","block");m.setStyle(this.domNode,"display","block")},hide:function(){this.overlayNode&&m.setStyle(this.overlayNode,"display","none");m.setStyle(this.domNode,"display","none")},
close:function(){if(!this.onClose||!1!==this.onClose()){var a=this.domNode.parentNode,f=q.clone(this.domNode);m.setStyle(this.domNode,"display","none");this.overlayNode&&m.destroy(this.overlayNode);this.destroy();this.moveable&&this.moveable.destroy();m.place(f,a);v.animateProperty({node:f,properties:{opacity:0},duration:200,onEnd:function(){m.destroy(f)}}).play();this.focusLastActiveNode();window.currentMsgPopup=null}},addButton:function(a){this._createButton(a)},_createButton:function(a){var f=
" ";a.classNames&&0<a.classNames.length&&"function"===typeof a.classNames.join&&(f+=a.classNames.join(" "));var h=m.create("div",{"class":"jimu-btn jimu-popup-action-btn jimu-float-trailing jimu-trailing-margin1 "+f,innerHTML:a.label,tabindex:0,role:"button",title:a.title||a.label},this.buttonContainer);this.enabledButtons.push(h);f=m.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+f,title:a.title||a.label,innerHTML:a.label,tabindex:0,role:"button",
"aria-disabled":"true",style:{display:"none"}},this.buttonContainer);this.disabledButtons.push(f);this.own(r(h,"click",q.hitch(this,function(p){if(a.onClick)a.onClick(p);else this.close()})));this.own(r(h,"keydown",q.hitch(this,function(p){if(p.keyCode===l.ENTER||p.keyCode===l.SPACE)if(a.onClick)a.onClick(p);else this.close()})))},setButtonProps:function(a,f){"number"===typeof a&&isFinite(a)||(f=a,a=0);if(f&&0!==this.enabledButtons.length)for(var h in f)"title"===h?(m.setAttr(this.enabledButtons[a],
"title",f[h]),m.setAttr(this.disabledButtons[a],"title",f[h])):"label"===h&&(m.setProp(this.enabledButtons[a],"innerHTML",f[h]),m.setProp(this.disabledButtons[a],"innerHTML",f[h]))},enableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.enabledButtons.length?(m.setStyle(this.enabledButtons[a],"display","inline-block"),m.setStyle(this.disabledButtons[a],"display","none")):(w.forEach(this.enabledButtons[a],q.hitch(this,function(f){m.setStyle(f,"display","inline-block")})),w.forEach(this.disabledButtons[a],
q.hitch(this,function(f){m.setStyle(f,"display","none")})))},disableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(m.setStyle(this.disabledButtons[a],"display","inline-block"),m.setStyle(this.enabledButtons[a],"display","none")):(w.forEach(this.disabledButtons,q.hitch(this,function(f){m.setStyle(f,"display","inline-block")})),w.forEach(this.enabledButtons,q.hitch(this,function(f){m.setStyle(f,"display","none")})))},showButton:function(a){this.enableButton(a)},
hideButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(m.setStyle(this.disabledButtons[a],"display","none"),m.setStyle(this.enabledButtons[a],"display","none")):(w.forEach(this.disabledButtons,q.hitch(this,function(f){m.setStyle(f,"display","none")})),w.forEach(this.enabledButtons,q.hitch(this,function(f){m.setStyle(f,"display","none")})))},resize:function(a){a&&(this.width=a.w,this.height=a.h);this._calcAndSetPosition();this.content&&this.content.domNode&&this.content.resize&&
this.content.resize()}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(E,q,A,w,m,v){w=E("dojo.dnd.move.constrainedMoveable",v,{constraints:function(){},within:!1,constructor:function(r,l){l||(l={});this.constraints=l.constraints;this.within=l.within},onFirstMove:function(r){var l=this.constraintBox=this.constraints.call(this,r);l.r=l.l+l.w;l.b=l.t+l.h;this.within&&(r=q.getMarginSize(r.node),l.r-=r.w,l.b-=r.h)},
onMove:function(r,l){var k=this.constraintBox,n=r.node.style;this.onMoving(r,l);l.l=l.l<k.l?k.l:k.r<l.l?k.r:l.l;l.t=l.t<k.t?k.t:k.b<l.t?k.b:l.t;n.left=l.l+"px";n.top=l.t+"px";this.onMoved(r,l)}});m=E("dojo.dnd.move.boxConstrainedMoveable",w,{box:{},constructor:function(r,l){var k=l&&l.box;this.constraints=function(){return k}}});E=E("dojo.dnd.move.parentConstrainedMoveable",w,{area:"content",constructor:function(r,l){var k=l&&l.area;this.constraints=function(){var n=this.node.parentNode,d=A.getComputedStyle(n),
c=q.getMarginBox(n,d);if("margin"==k)return c;var g=q.getMarginExtents(n,d);c.l+=g.l;c.t+=g.t;c.w-=g.w;c.h-=g.h;if("border"==k)return c;g=q.getBorderExtents(n,d);c.l+=g.l;c.t+=g.t;c.w-=g.w;c.h-=g.h;if("padding"==k)return c;g=q.getPadExtents(n,d);c.l+=g.l;c.t+=g.t;c.w-=g.w;c.h-=g.h;return c}}});return{constrainedMoveable:w,boxConstrainedMoveable:m,parentConstrainedMoveable:E}})},"jimu/DataSourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Evented dojo/when ./utils jimu/LayerInfos/LayerInfos jimu/portalUtils jimu/portalUrlUtils jimu/filterUtils esri/tasks/query esri/tasks/QueryTask esri/tasks/StatisticDefinition ./Query".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e){var a=null,f=E(m,{constructor:function(){this._listeners=[];this._refreshTimers=[];this._dataStore={};this._jimuQueryObject={};this._dataSourceUsage={};this._itemsFilter={};this.filterUtils=new d;window.isBuilder?(w.subscribe("app/mapLoaded",q.hitch(this,this._onMapLoaded)),w.subscribe("app/mapChanged",q.hitch(this,this._onMapChanged))):(w.subscribe("mapLoaded",q.hitch(this,this._onMapLoaded)),w.subscribe("mapChanged",q.hitch(this,this._onMapChanged)));window.isBuilder?
(w.subscribe("app/appConfigLoaded",q.hitch(this,this._onAppConfigLoaded)),w.subscribe("app/appConfigChanged",q.hitch(this,this._onAppConfigChanged))):(w.subscribe("appConfigLoaded",q.hitch(this,this._onAppConfigLoaded)),w.subscribe("appConfigChanged",q.hitch(this,this._onAppConfigChanged)));w.subscribe("updateDataSourceData",q.hitch(this,this._onUpdataDataSourceData));window.isBuilder&&w.subscribe("app/dataSourceDataUpdated",q.hitch(this,this._onDataSourceDataUpdatedInApp))},getData:function(h){return this._dataStore[h]},
getDataSourceConfig:function(h){return this.appConfig.dataSource.dataSources[h]},parseDataSourceId:function(h){var p=h.split("~"),B={};if(2>p.length)return console.error("Bad data source id:",h),B;switch(p[0]){case "map":return p=h.lastIndexOf("~"),B={from:"map",layerId:h.substring(4,p)};case "widget":return B={from:"widget",widgetId:p[1]};case "external":return B={from:"external"};default:console.error("Bad data source id:",h)}},addDataSourceUsage:function(h,p){this._dataSourceUsage[h]?(0>this._dataSourceUsage[h].indexOf(p)&&
this._dataSourceUsage[h].push(p),1===this._dataSourceUsage[h].length&&this._startOneDataSource(this.appConfig.dataSource.dataSources[h])):(this._dataSourceUsage[h]=[p],this._startOneDataSource(this.appConfig.dataSource.dataSources[h]))},removeDataSourceUsage:function(h,p){this._dataSourceUsage[h]&&0<=this._dataSourceUsage[h].indexOf(p)&&(this._dataSourceUsage[h]=A.filter(this._dataSourceUsage[h],function(B){return B!==p}))},_onUpdataDataSourceData:function(h,p){this.appConfig.dataSource.dataSources[h]?
"widget"!==this.parseDataSourceId(h).from?console.error("Please update data source from widget only.",h):this._updateDataSourceData(h,p):console.error("Not found data source id:",h)},_updateDataSourceData:function(h,p){this._dataStore[h]=p;w.publish("dataSourceDataUpdated",h,p);this.emit("update",h,p)},_onDataSourceDataUpdatedInApp:function(h,p){this._updateDataSourceData(h,p)},_onMapLoaded:function(h){this.map=h;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,this.appConfig,"mapLoaded")},
_onMapChanged:function(h){this.map=h;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,this.appConfig,"mapChanged")},_onAppConfigLoaded:function(h){this.appConfig=q.clone(h)},_onAppConfigChanged:function(h,p){h=q.clone(h);window.isBuilder||("dataSourceChange"===p?this._handleDataSourceConfigChange(this.appConfig,h,p):"mapChange"===p&&this._cleanForConfigChangedDataSource(this.appConfig,h));this.appConfig=h},_handleDataSourceConfigChange:function(h,p,B){h&&(this._removeListeners(),
this._removeTimers(),this._cleanForConfigChangedDataSource(h,p));A.forEach(Object.keys(p.dataSource.dataSources),function(u){p.dataSource.dataSources[u].idObj=this.parseDataSourceId(u)},this);this._listenDataSourceChange(p.dataSource.dataSources);this._startRefreshTimer(p.dataSource,B);this._initStaticDataSource(p.dataSource)},_cleanForConfigChangedDataSource:function(h,p){var B=h.dataSource.dataSources,u=p.dataSource.dataSources;A.forEach(Object.keys(B),function(t){if(!u[t]||u[t]&&!r.isEqual(u[t],
B[t]))delete this._jimuQueryObject[t],this._updateDataSourceData(t,{features:[]}),delete this._dataStore[t]},this)},_isGlobalRefresh:function(h){return h.unifiedRefreshInterval&&0<h.unifiedRefreshInterval},_startOneDataSource:function(h){var p=this._isGlobalRefresh(this.appConfig.dataSource.settings)?this.appConfig.dataSource.settings.unifiedRefreshInterval:h.refreshInterval;if("map"===h.idObj.from)this._listenMapDataSourceChange(h);else if("external"===h.idObj.from&&h.filterByExtent){var B={};B.handle=
this.map.on("extent-change",q.hitch(this,this._onLayerDataChange,h));B.dsId=h.id;this._listeners.push(B)}if("map"===h.idObj.from||"external"===h.idObj.from)this._refeshDataSource(h),h.isDynamic&&(B={},B.handle=setInterval(q.hitch(this,this._refeshDataSource,h),6E4*p),B.dsId=h.id,this._refreshTimers.push(B))},_stopAndCleanOneDataSource:function(h){this._listeners=A.filter(this._listeners,function(p){return p.dsId===h.id?(p.handle.remove(),!1):!0},this);this._refreshTimers=A.filter(this._refreshTimers,
function(p){return p.dsId===h.id?(clearInterval(p.handle),!1):!0},this);this._updateDataSourceData(h.id,{features:[]})},_listenDataSourceChange:function(h){A.forEach(Object.keys(h),function(p){p=h[p];if("map"===p.idObj.from)this._listenMapDataSourceChange(p);else if("external"===p.idObj.from&&p.filterByExtent){var B={};B.handle=this.map.on("extent-change",q.hitch(this,this._onLayerDataChange,p));B.dsId=p.id;this._listeners.push(B)}},this)},_listenMapDataSourceChange:function(h){this._getLayerObject(h.idObj.layerId).then(q.hitch(this,
function(p){if(p){var B={};B.handle=p.on("edits-complete",q.hitch(this,this._onLayerDataChange,h));B.dsId=h.id;this._listeners.push(B);B={};B.handle=this._getLayerInfo(h.idObj.layerId).on("filterChanged",q.hitch(this,this._onLayerDataChange,h));B.dsId=h.id;this._listeners.push(B);h.filterByExtent&&(B={},B.handle=this.map.on("extent-change",q.hitch(this,this._onLayerDataChange,h)),B.dsId=h.id,this._listeners.push(B))}else console.error("Can not find layer that data source depends on.",h.id)}))},_onLayerDataChange:function(h){this._doQueryForDataSource(h)},
_doQueryForDataSource:function(h){("config"===this.appConfig.mode||this._dataSourceUsage[h.id]&&0!==this._dataSourceUsage[h.id].length)&&this.doQuery(h).then(q.hitch(this,function(p){this._updateDataSourceData(h.id,{features:p.features})}))},_getLayerObject:function(h){return(h=l.getInstanceSync().getLayerOrTableInfoById(h))?h.getLayerObject():v(null)},_getLayerInfo:function(h){return l.getInstanceSync().getLayerOrTableInfoById(h)},_startRefreshTimer:function(h,p){var B=h.dataSources,u=h.settings;
A.forEach(Object.keys(B),function(t){t=B[t];if("widget"!==t.idObj.from&&t.isDynamic&&t.url){var z=this._isGlobalRefresh(u)?u.unifiedRefreshInterval:t.refreshInterval;"dataSourceChange"===p?("external"===t.idObj.from||"map"===t.idObj.from)&&this._refeshDataSource(t):"external"===t.idObj.from&&this._refeshDataSource(t);t={handle:setInterval(q.hitch(this,this._refeshDataSource,t),6E4*z),dsId:h.id};this._refreshTimers.push(t)}},this)},_initStaticDataSource:function(h){A.forEach(Object.keys(h.dataSources),
function(p){p=h.dataSources[p];"widget"!==p.idObj.from&&!p.isDynamic&&p.url&&this._doQueryForDataSource(p)},this)},_refeshDataSource:function(h){this._doQueryForDataSource(h)},_getDataSourceFilter:function(h){if("map"===h.idObj.from){var p=l.getInstanceSync().getLayerOrTableInfoById(h.idObj.layerId),B;p&&(B=p.getFilter());p=h.filter?this._getFilterExpr(h.filter,h.url):"1\x3d1";var u=B?"("+B+") and ("+p+")":p;return v(u)}return"external"===h.idObj.from?h.portalUrl&&h.itemId?this._getFilterFromItem(h.portalUrl,
h.itemId,h.url).then(q.hitch(this,function(t){var z=h.filter?this._getFilterExpr(h.filter,h.url):"1\x3d1";return u=t?"("+t+") and ("+z+")":z})):v(h.filter?this._getFilterExpr(h.filter,h.url):"1\x3d1"):v(h.filter?this._getFilterExpr(h.filter,h.url):"1\x3d1")},_getFilterExpr:function(h,p){return this.filterUtils.hasVirtualDate(h)?(this.filterUtils.isHosted=r.isHostedService(p),this.filterUtils.getExprByFilterObj(h)):h.expr},_getFilterFromItem:function(h,p,B){var u=n.getItemUrl(h,p);if(this._itemsFilter[u])return v(this._itemsFilter[u]);
var t=k.getPortal(h);return t.getItemById(p).then(q.hitch(this,function(z){return"Feature Service"!==z.type?this._itemsFilter[u]=null:t.getItemData(p).then(q.hitch(this,function(x){var y=B.split("/"),D=y.pop();D||(D=y.pop());if(!x.layers)return this._itemsFilter[u]=null;x=x.layers.filter(function(H){return H.id+""===D})[0];return x&&x.layerDefinition?this._itemsFilter[u]=x.layerDefinition.definitionExpression:this._itemsFilter[u]=null}))}))},doQuery:function(h){h.idObj||(h.idObj=this.parseDataSourceId(h.id));
this.emit("begin-update",h.id);return this._getQueryObjectFromDataSource(h).then(q.hitch(this,function(p){if("Features"===h.type){if("serviceLimitation"===h.resultRecordType){var B=p;var u=new g(h.url);return u.execute(B)}var t=this._jimuQueryObject[h.id];!t||t.url===h.url&&r.isEqual(t.query.toJson(),p.toJson())||(delete this._jimuQueryObject[h.id],t=null);t||(t={},t.url=h.url,t.query=p,"all"!==h.resultRecordType&&(t.pageSize=h.resultRecordCount),t=new e(t),this._jimuQueryObject[h.id]=t);return"all"===
h.resultRecordType?t.getAllFeatures():t.queryByPage(1)}u=new g(h.url);B=new c;return this._getDataSourceFilter(h).then(q.hitch(this,function(z){B.where=z;h.filterByExtent&&(B.geometry=this.map.extent);h.dataSchema.groupByFields&&0<h.dataSchema.groupByFields.length&&(B.groupByFieldsForStatistics=h.dataSchema.groupByFields);h.dataSchema.orderByFields&&0<h.dataSchema.orderByFields.length&&(B.orderByFields=h.dataSchema.orderByFields);B.outStatistics=h.dataSchema.statistics.map(function(x){var y=x.onStatisticField+
"_"+x.statisticType;"count"===x.statisticType&&(y="STAT_COUNT");y=r.upperCaseString(y);var D=new b;D.statisticType=x.statisticType;D.onStatisticField=x.onStatisticField;D.outStatisticFieldName=y;return D});return u.execute(B)}))}))},_getQueryObjectFromDataSource:function(h){return this._getDataSourceFilter(h).then(q.hitch(this,function(p){var B=new c;B.where=p;h.filterByExtent&&(B.geometry=this.map.extent);B.outFields=h.dataSchema.fields.map(function(u){return u.name});h.dataSchema.orderByFields&&
0<h.dataSchema.orderByFields.length&&(B.orderByFields=h.dataSchema.orderByFields);B.returnGeometry=!0;B.outSpatialReference=this.map.spatialReference;return v(B)}))},_removeListeners:function(){this._listeners.forEach(q.hitch(this,function(h){h.handle.remove()}));this._listeners=[]},_removeTimers:function(){this._refreshTimers.forEach(q.hitch(this,function(h){clearInterval(h.handle)}));this._refreshTimers=[]}});f.getInstance=function(){null===a&&(a=new f,window._datasourceManager=a);return a};return f})},
"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/Evented dojo/promise/all ./LayerInfoFactory libs/crc".split(" "),function(E,q,A,w,m,v,r,l,k,n){var d=E([r],{declaredClass:"jimu.LayerInfos",map:null,_operLayers:null,_layerInfos:null,_finalLayerInfos:null,_tableInfos:null,_basemapLayerInfos:null,_finalBasemapLayerInfos:null,_basemapLayers:null,_unreachableLayersTitleOfWebmap:null,_objectId:null,_layerInfoFactory:null,
_previousLayerOrder:null,constructor:function(b,e){this._objectId=Math.random();this._unreachableLayersTitleOfWebmap=[];this._basemapLayers=e.baseMap.baseMapLayers;this._operLayers=e.operationalLayers;this._tables=e.tables;this._layerInfoFactory=new k(b,this);this.map=b;this._previousLayerOrder=[].concat(this.map.layerIds,this.map.graphicsLayerIds);this._initLayerInfos();this._initBasemapLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();
this._clearAddedFlag(this._finalLayerInfos);this._clearAddedFlag(this._finalBasemapLayerInfos);this._initFinalLayerInfos();this._initFinalBasemapLayerInfos();this._markFirstOrLastNode()},getLayerInfoArrayOfWebmap:function(){var b=[];q.forEach(this.getLayerInfoArray(),function(e){for(var a=0;a<this._operLayers.length;a++)if(e.id===this._operLayers[a].id){b.push(e);break}a===this._operLayers.length&&0<=this._removedLayerInfoIdsFromFeatureCollection.indexOf(e.id)&&b.push(e)},this);return b},getTableInfoArrayOfWebmap:function(){var b=
[];q.forEach(this.getTableInfoArray(),function(e){for(var a=0;a<this._tables.length;a++)if(e.id===this._tables[a].id){b.push(e);break}},this);return b},getLayerInfoArray:function(){return q.filter(this._finalLayerInfos,function(b){A.getObject("_wabProperties.isTemporaryLayer",!1,b.layerObject)&&(b._flag._isTemporaryLayerInfo=!0);return!b._flag._isTemporaryLayerInfo})},getTableInfoArray:function(){return this._tableInfos},getBasemapLayerInfoArray:function(){return this._finalBasemapLayerInfos},addFeatureCollection:function(b,
e){var a=this._getUniqueTopLayerInfoId(e),f={layers:[]};q.forEach(b,function(p,B){p.id=a+"_"+B;f.layers.push({id:p.id,layerObject:p})},this);this.map.addLayers(b);try{var h=this._layerInfoFactory.create({featureCollection:f,title:e||a,id:a},this.map);h.init()}catch(p){console.warn(p.message),h=null}h&&(h._extraOfWebmapLayerInfo=!0,this._layerInfos.push(h),this.update(),this._onLayersUpdated(h,h.getRootLayerInfo()))},addTable:function(b){b=this._addTables([b],this._tableInfos);return b[0]?b[0]:null},
removeTable:function(b){var e=-1;q.forEach(this._tableInfos,function(f,h){b.id===f.id&&(e=h)});if(0<=e){var a=this._tableInfos[e];this._tableInfos.splice(e,1);a.destroy();this._onTableChange([b],d.REMOVED)}},_addTables:function(b,e){var a=[],f=[];q.forEach(b,function(h){try{h.layerObject={url:h.url,featureCollectionData:h.featureCollectionData,empty:!0};h.id=this._getUniqueTableId(h.id);h.selfType="table";var p=this._layerInfoFactory.create(h);p.init()}catch(B){console.warn(B.message),p=null}p&&(a.push(p),
e.push(p),f.push(p.getLayerObject()))},this);l(f).then(A.hitch(this,function(h){var p=[];q.forEach(h,function(B,u){u=a[u];B?p.push(u):(this.removeTable(u),u.destroy())},this);this._onTableChange(p,d.ADDED)}));return a},_getUniqueTableId:function(b){var e=this._tableInfos.concat(this._tableInfos||[]);return this._getUniqueLayerOrTableId(b,e)},_getUniqueTopLayerInfoId:function(b){return this._getUniqueLayerOrTableId(b,this._finalLayerInfos)},_getUniqueLayerOrTableId:function(b,e){var a=1,f;b||(b="table");
for(f=b;;){for(var h=0;h<e.length&&e[h].id!==f;h++);if(h===e.length)return f;f=b+"_"+a.toString();a++}},_traversal:function(b,e){for(var a=0;a<e.length;a++)if(e[a].traversal(b))return!0;return!1},traversal:function(b){var e=this.getLayerInfoArray();return this._traversal(b,e)},traversalLayerInfosOfWebmap:function(b){var e=this.getLayerInfoArrayOfWebmap();return this._traversal(b,e)},traversalAll:function(b){var e=this.getLayerInfoArray(),a=this.getBasemapLayerInfoArray(),f=this.getTableInfoArray();
e=e.concat(a.concat(f));return this._traversal(b,e)},_traversalAllWithSpecialLayerInfo:function(b){return this._traversal(b,this._finalLayerInfos.concat(this._tableInfos))},getLayerInfoById:function(b){return this._findLayerInfoById(b)},getTableInfoById:function(b){var e=null;q.some(this.getTableInfoArray(),function(a){if(a.id===b)return e=a,!0});return e},getLayerOrTableInfoById:function(b){var e=null;this.traversalAll(function(a){if(a.id===b)return e=a,!0});return e},getLayerInfoByTopLayerId:function(b){return this._findTopLayerInfoById(b)},
moveUpLayer:function(b,e){var a=null;e=e?e:1;b=this._getTopLayerInfoIndexById(b.id);0<=b-e&&(a=this._finalLayerInfos[b-e].obtainLayerIndexesInMap().length,this._finalLayerInfos[b].moveRightOfIndex(this._finalLayerInfos[b-e].obtainLayerIndexesInMap()[a-1].index),a=this._finalLayerInfos[b-e]);return a},_reorderLayerInfosArray:function(b,e,a){"moveup"===a?(a=this._finalLayerInfos[b],this._finalLayerInfos.splice(b,1),this._finalLayerInfos.splice(b-e,0,a)):(a=this._finalLayerInfos[b],this._finalLayerInfos.splice(b+
e+1,0,a),this._finalLayerInfos.splice(b,1));this._markFirstOrLastNode();return a},moveDownLayer:function(b,e){var a=null;e=e?e:1;b=this._getTopLayerInfoIndexById(b.id);b+e<=this._finalLayerInfos.length-1&&(this._finalLayerInfos[b].moveLeftOfIndex(this._finalLayerInfos[b+e].obtainLayerIndexesInMap()[0].index),a=this._finalLayerInfos[b+e]);return a},getBasemapLayers:function(){var b=[];q.forEach(this.map.layerIds.concat(this.map.graphicsLayerIds||[]),function(e){e=this.map.getLayer(e);"basemap"!==e._basemapGalleryLayerType&&
"reference"!==e._basemapGalleryLayerType||b.push(e)},this);return b.reverse()},getMapNotesLayerInfoArray:function(){return q.filter(this.getLayerInfoArray(),function(b){return b.isMapNotesLayerInfo()},this)},restoreState:function(b){var e=b&&b.layerOptions?b.layerOptions:null;q.forEach(this._finalLayerInfos,function(a){a.resetLayerObjectVisibility(e)},this)},_getEncodedLayerIdsOfCurrentMap:function(){this._encodedLayerIds||(this._encodedLayerIds={encodedToLayerIds:{},layerIdsToEncoded:{}},this.traversal(A.hitch(this,
function(b){var e=this._encodeLayerId(b.id);this._encodedLayerIds.encodedToLayerIds[e]=b.id;this._encodedLayerIds.layerIdsToEncoded[b.id]=e})));return this._encodedLayerIds},_getShowOrHideLayerIdsBySimpleState:function(b){var e=[],a=[],f={showLayerIds:null,hideLayerIds:null},h=this._getEncodedLayerIdsOfCurrentMap().encodedToLayerIds;b&&b.showLayersEncoded&&h?(q.forEach(b.showLayersEncoded,function(p){(p=h[p])&&e.push(p)}),f.showLayerIds=e):b&&b.showLayers?f.showLayerIds=b.showLayers:b&&b.hideLayersEncoded&&
h?(q.forEach(b.hideLayersEncoded,function(p){(p=h[p])&&a.push(p)}),f.hideLayerIds=a):b&&b.hideLayers&&(f.hideLayerIds=b.hideLayers);return f},_getSibilingLayerInfos:function(b){return b.isRootLayer()?this._finalLayerInfos:b.parentLayerInfo.getSubLayers()},_revertSibilingLayersOnState:function(b,e,a){b=this._getSibilingLayerInfos(b);q.some(b,A.hitch(this,function(f){f=f.id;e.layerOptions[f]||(e.layerOptions[f]={visible:a})}))},setSimplificationState:function(b){var e={layerOptions:{}},a=this._getShowOrHideLayerIdsBySimpleState(b);
this.traversal(A.hitch(this,function(f){var h=null;if(a.showLayerIds){var p=a.showLayerIds;var B=!0}else p=a.hideLayerIds,B=!1;q.some(p,function(u){if(f.id===u)return h=f.id,!0;if(f.title.trim&&u.trim&&f.title.trim()===u.trim())return h=f.id,!1});B?null!==h?(e.layerOptions[f.id]={visible:!0},this._revertSibilingLayersOnState(f,e,!1)):0===p.length&&(e.layerOptions[f.id]={visible:!1}):null!==h?(e.layerOptions[f.id]={visible:!1},this._revertSibilingLayersOnState(f,e,!0)):0===p.length&&(e.layerOptions[f.id]=
{visible:!0})}));this.restoreState(e)},getSimplificationState:function(){var b={showLayers:[],showLayersEncoded:[],hideLayers:[],hideLayersEncoded:[]};this.traversal(A.hitch(this,function(e){e.isVisible()?(b.showLayers.push(e.id),b.showLayersEncoded.push(this._encodeLayerId(e.id))):(b.hideLayers.push(e.id),b.hideLayersEncoded.push(this._encodeLayerId(e.id)))}));return b},_encodeLayerId:function(b){var e=n.crc24;b=e(b);b=parseInt(b,16);return b=b.toString(36)},getUnreachableLayersTitle:function(){return this._unreachableLayersTitleOfWebmap},
getObjectId:function(){return this._objectId},_initLayerInfos:function(){this._layerInfos=[];this._initSpecifiedLayerInfos(this._operLayers,this._layerInfos)},_initBasemapLayerInfos:function(){this._basemapLayerInfos=[];this._initSpecifiedLayerInfos(this._basemapLayers,this._basemapLayerInfos)},_initSpecifiedLayerInfos:function(b,e){var a;q.forEach(b,function(f){try{a=this._layerInfoFactory.create(f),a.init()}catch(h){console.warn(h.message),a=null,0<=h.message.indexOf("declaredClass")&&this._unreachableLayersTitleOfWebmap.push(f.title)}a&&
e.push(a)},this)},_extraSetLayerInfos:function(){this._removedLayerInfoIdsFromFeatureCollection=[];q.forEach(this._finalLayerInfos||this._layerInfos,function(b,e){if(b._needToRenew()){try{var a=this._layerInfoFactory.create(b.originOperLayer);a.init()}catch(h){console.warn(h.message),a=null}a&&(b.destroy(),this._finalLayerInfos[e]=a)}else if(b.originOperLayer.featureCollection){var f=[];q.forEach(b.getSubLayers(),function(h){f.push(h.id)});q.forEach(f,function(h){this.map.getLayer(h)||b.removeSubLayerById(h)},
this);1===b.getSubLayers().length&&(e=b.getSubLayers()[0],this.map.getLayer(e.id).title=b.title,b.removeSubLayerById(e.id),this._removedLayerInfoIdsFromFeatureCollection.push(e.id),b.id+="_logically_removed")}},this)},_refineFinalLayerInfos:function(){this._finalLayerInfos&&(this._finalLayerInfos=q.filter(this._finalLayerInfos,function(b){return!b._flag._invalid}))},_initFinalLayerInfos:function(){var b,e=this._finalLayerInfos||this._layerInfos;this._finalLayerInfos=[];for(b=this.map.graphicsLayerIds.length-
1;0<=b;b--){var a=this.map.graphicsLayerIds[b];this._isBasemap(a)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(a,e),a,!0)}for(b=this.map.layerIds.length-1;0<=b;b--)a=this.map.layerIds[b],this._isBasemap(a)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(a,e),a,!1);this._refineFinalLayerInfos()},_initTablesInfos:function(){this._tableInfos=[];var b=this._tables&&this._tables.reverse();b&&this._addTables(b,this._tableInfos)},_initFinalBasemapLayerInfos:function(){var b=
this._finalBasemapLayerInfos||this._basemapLayerInfos;this._finalBasemapLayerInfos=[];q.forEach(this.getBasemapLayers(),function(e){var a;q.some(b,function(f){if(f.id===e.id)return a=f,!0},this);this._addToFinalBasemapLayerInfos(a,e.id,!1)},this)},_isBasemap:function(b){for(var e=!1,a=this.getBasemapLayers(),f=0;f<a.length;f++)a[f].id===b&&(e=!0);return e},_addToFinalBasemapLayerInfos:function(b,e,a){this._addToSpecifiedLayerInfos(b,e,a,this._finalBasemapLayerInfos)},_addToFinalLayerInfos:function(b,
e,a){this._addToSpecifiedLayerInfos(b,e,a,this._finalLayerInfos)},_addToSpecifiedLayerInfos:function(b,e,a,f){if(b)b._addedFlag||b.isGraphicLayer()!==a||(f.push(b),b._addedFlag=!0);else{b=this.map.getLayer(e);if("esri.layers.GraphicsLayer"!==b.declaredClass&&"esri.layers.LabelLayer"!==b.declaredClass){try{var h={layerObject:b,title:this._getLayerTitle(b),id:b.id||" "};A.mixin(h,A.getObject("_wabProperties.originOperLayer",!1,b));var p=this._layerInfoFactory.create(h,this.map);p.init()}catch(B){console.warn(B.message),
p=null}p&&(A.getObject("_wabProperties.isTemporaryLayer",!1,b)&&(p._flag._isTemporaryLayerInfo=!0),f.push(p))}("esri.layers.ArcGISDynamicMapServiceLayer"===b.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===b.declaredClass)&&p&&p._getServiceDefinition().then(A.hitch(this,function(B){var u=[];q.forEach(B.tables,function(t){t.url=p.getUrl()+"/"+t.id;t.id=p.id+"_"+t.id;t.title=this._getLayerTitle(t);u.push(t)},this);this._addTables(u,this._tableInfos)}))}},_getLayerTitle:function(b){if(b.title)return b.title;
if(A.getObject("_wabProperties.originalLayerName",!1,b))return b.name||b.id;var e=b.label||b.name||"";if(b.url&&!A.getObject("_wabProperties.itemLayerInfo",!1,b)){var a=b.url.indexOf("/FeatureServer");-1===a&&(a=b.url.indexOf("/MapServer"));-1===a&&(a=b.url.indexOf("/service"));-1<a&&(a=b.url.substring(0,a),a=a.substring(a.lastIndexOf("/")+1,a.length),e=e?a+" - "+e:a)}return e||b.id},_findLayerInfoByIdAndReturnTopLayer:function(b,e){var a,f=null;e||(e=this._finalLayerInfos);for(a=0;a<e.length;a++)if(f=
e[a].findLayerInfoById(b)){f=e[a];break}return f},_findLayerInfoById:function(b,e){var a,f=null;e||(e=this._finalLayerInfos);for(a=0;a<e.length&&!(f=e[a].findLayerInfoById(b));a++);return f},_findTopLayerInfoById:function(b){var e,a=null,f=[].concat(this._finalLayerInfos||[],this._tableInfos||[]);for(e=0;e<f.length;e++)if(f[e].id===b){a=f[e];break}return a},_getTopLayerInfoIndexById:function(b){var e,a=-1;for(e=0;e<this._finalLayerInfos.length;e++)if(this._finalLayerInfos[e].id===b){a=e;break}return a},
_clearAddedFlag:function(b){q.forEach(b,function(e){e._addedFlag=!1})},_markFirstOrLastNode:function(){var b;if(this._finalLayerInfos.length){for(b=0;b<this._finalLayerInfos.length;b++)this._finalLayerInfos[b].isFirst=!1,this._finalLayerInfos[b].isLast=!1;this._finalLayerInfos[0].isFirst=!0;this._finalLayerInfos[this._finalLayerInfos.length-1].isLast=!0;for(b=0;b<this._finalLayerInfos.length;b++)if(!this._finalLayerInfos[b].isGraphicLayer()){b&&(this._finalLayerInfos[b-1].isLast=!0);this._finalLayerInfos[b].isFirst=
!0;break}}},_onReceiveBasemapGalleryeData:function(b,e,a){"BasemapGallery"===b&&(this._basemapLayers.length=0,q.forEach(a,A.hitch(this,function(f){this._basemapLayers.push({layerObject:f,id:f.id})}),this),this.update(),this.emit("layerInfosChanged"))},_onBasemapChange:function(b){var e;for(e=this._basemapLayers.length=0;e<b.layers.length;e++)this._basemapLayers.push({layerObject:b.layer[e],id:b.layers[e].id})},_destroyLayerInfos:function(){q.forEach(this._finalLayerInfos,A.hitch(this,function(b){b.destroy()}))},
_bindEvents:function(){var b=m(this.map,"layer-add-result",A.hitch(this,this._onLayersChange,d.ADDED));var e=m(this.map,"layer-remove",A.hitch(this,this._onLayersChange,d.REMOVED));var a=m(this.map,"layer-reorder",A.hitch(this,this._onLayerReorder));var f=v.subscribe("layerInfos/layerInfo/isShowInMapChanged",A.hitch(this,this._onShowInMapChanged));var h=v.subscribe("layerInfos/layerInfo/visibleChanged",A.hitch(this,this._onVisibleChanged));var p=v.subscribe("layerInfos/layerInfo/filterChanged",A.hitch(this,
this._onFilterChanged));var B=v.subscribe("layerInfos/layerInfo/rendererChanged",A.hitch(this,this._onRendererChanged));var u=v.subscribe("layerInfos/layerInfo/opacityChanged",A.hitch(this,this._onOpacityChanged));var t=v.subscribe("layerInfos/layerInfo/scaleRangeChanged",A.hitch(this,this._onScaleRangeChanged));var z=v.subscribe("layerInfos/layerInfo/timeExtentChanged",A.hitch(this,this._onTimeExtentChanged));var x=m(this.map,"before-unload",A.hitch(this,function(){b.remove();e.remove();a.remove();
f.remove();h.remove();p.remove();B.remove();x.remove();u.remove();t.remove();z.remove();this._destroyLayerInfos()}))},_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(b){console.warn(b)}},_emitEventForEveryLayerInfo:function(b,e,a){try{q.forEach(e,function(f){f.emitEvent(b,a)},this)}catch(f){console.warn(f)}},_onLayersChange:function(b,e){var a=null;if(!e.error&&"esri.layers.GraphicsLayer"!==e.layer.declaredClass&&"esri.layers.LabelLayer"!==e.layer.declaredClass){if(b===d.ADDED){this.update();
a=b=this._findLayerInfoById(e.layer.id,e.layer._basemapGalleryLayerType?this._finalBasemapLayerInfos:this._finalLayerInfos);var f=d.ADDED;b&&!b.isRootLayer()&&(a=b.getRootLayerInfo(),f=d.SUBLAYER_ADDED)}else a=b=this._findLayerInfoById(e.layer.id,e.layer._basemapGalleryLayerType?this._finalBasemapLayerInfos:this._finalLayerInfos),f=d.REMOVED,b&&!b.isRootLayer()&&(a=b.getRootLayerInfo(),f=d.SUBLAYER_REMOVED),b&&b.destroy(),this.update();a&&(e.layer._basemapGalleryLayerType?(this._emitEvent("basemapLayersChanged"),
this._emitEvent("basemapLayerInfosChanged",a,f,b)):this._emitEvent("layerInfosChanged",a,f,b))}},_onTableChange:function(b,e){this._emitEvent("tableInfosChanged",b,e,b)},_onLayersUpdated:function(b,e){b.isTable?this._emitEvent("tableInfosChanged",[b],d.UPDATED,[e]):this._emitEvent("layerInfosChanged",b,d.UPDATED,e)},_onShowInMapChanged:function(b){this._emitEvent("layerInfosIsShowInMapChanged",b);this._emitEventForEveryLayerInfo("isShowInMapChanged",b)},_onVisibleChanged:function(b){this._emitEvent("layerInfosIsVisibleChanged",
b);this._emitEventForEveryLayerInfo("isVisibleChanged",b)},_onFilterChanged:function(b,e){this._emitEvent("layerInfosFilterChanged",b,e);this._emitEventForEveryLayerInfo("filterChanged",b,e)},_onLayerReorder:function(){var b=[].concat(this.map.layerIds,this.map.graphicsLayerIds),e=q.some(b,A.hitch(this,function(a,f){return a===this._previousLayerOrder[f]?!1:!0}));b.length===this._previousLayerOrder.length&&e&&(this.update(),this._emitEvent("layerInfosReorder",null,d.REORDERED));this._previousLayerOrder=
b},_onRendererChanged:function(b){this._emitEvent("layerInfosRendererChanged",b);this._emitEventForEveryLayerInfo("rendererChanged",b)},_onOpacityChanged:function(b){this._emitEvent("layerInfosOpacityChanged",b);this._emitEventForEveryLayerInfo("opacityChanged",b)},_onScaleRangeChanged:function(b){this._emitEvent("layerInfosScaleRangeChanged",b);this._emitEventForEveryLayerInfo("scaleRangeChanged",b)},_onTimeExtentChanged:function(b){this._emitEvent("layerInfosTimeExtentChanged",b);this._emitEventForEveryLayerInfo("timeExtentChanged",
b)}});d.getLayerInfoArrayByType=function(b,e){var a=new w,f=[],h=[];d.getInstance(b,b.iteminfo).then(function(p){p.traversal(function(B){var u=B.getLayerType();u.layerInfo=B;f.push(u)});l(f).then(function(B){q.forEach(B,function(u,t){e===u&&h.push(f[t].layerInfo)});a.resolve(h)})});return a};var c=null,g=null;d.getInstance=function(b,e){var a=new w;a.resolve(d.getInstanceSyncForInit(b,e));return a};d.getInstanceSyncForInit=function(b,e){c&&c!==b&&(g=c=null);g||(g=new d(b,e.itemData),c=b);return g};
d.getInstanceSync=function(){return g};d.setInstance=function(b,e){c=b;g=e};d.createInstance=function(b){var e=null;return e=new d(b,b.itemInfo.itemData)};A.mixin(d,{ADDED:"added",REMOVED:"removed",SUBLAYER_ADDED:"subLayerAdded",SUBLAYER_REMOVED:"subLayerRemoved",UPDATED:"updated",REORDERED:"reordered"});return d})},"jimu/LayerInfos/LayerInfoFactory":function(){define("dojo/_base/declare jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultDynamicShipFeatureLayer jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream jimu/LayerInfos/LayerInfoForDefaultKML".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e){return E(null,{constructor:function(a,f){this.map=a;this.layerInfos=f},create:function(a){var f=null;if(a.featureCollection)f=new q(a,this.map,this,this.layerInfos);else if("esri.layers.KMLLayer"===a.layerObject.declaredClass)f=new w(a,this.map,this,this.layerInfos);else if("esri.layers.GeoRSSLayer"===a.layerObject.declaredClass)f=new m(a,this.map,this,this.layerInfos);else if("esri.layers.WMSLayer"!==a.layerObject.declaredClass||a.selfType)if("esri.layers.ArcGISDynamicMapServiceLayer"===
a.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.layerObject.declaredClass)f=new A(a,this.map,this,this.layerInfos);else if("esri.layers.ArcGISImageServiceLayer"===a.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===a.layerObject.declaredClass)f=new g(a,this.map,this,this.layerInfos);else if("esri.layers.StreamLayer"===a.layerObject.declaredClass)f=new b(a,this.map,this,this.layerInfos);else switch("Table"===a.layerObject.type&&(a.selfType="table"),
a.selfType){case "mapservice_dynamic_ship_featurelayer":f=new k(a,this.map,this,this.layerInfos);break;case "mapservice_dynamic_group":case "mapservice_dynamic":f=new l(a,this.map,this,this.layerInfos);break;case "mapservice_tiled_group":case "mapservice_tiled":f=new n(a,this.map,this,this.layerInfos);break;case "wms":f=new d(a,this.map,this,this.layerInfos);break;case "kml":f=new e(a,this.map,this,this.layerInfos);break;case "table":f=new c(a,this.map,this,this.layerInfos);break;default:f=new v(a,
this.map,this,this.layerInfos)}else f=new r(a,this.map,this,this.layerInfos);return f}})})},"jimu/LayerInfos/LayerInfoForCollection":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/promise/all esri/lang jimu/utils ./LayerInfo".split(" "),function(E,q,A,w,m,v,r){return E(r,{constructor:function(){this.layerObject={declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection",empty:!0}},_getExtent:function(){var l=null,k=[];q.forEach(this.getSubLayers(),function(n){k.push(n._getExtent())},
this);return w(k).then(A.hitch(this,function(n){q.forEach(n,function(d){v.isValidExtent(d)&&(l=l?l.union(d):d)},this);return l}))},_resetLayerObjectVisiblity:function(l){var k=l?l[this.id]:null;if(k){var n={},d;for(d in l)l.hasOwnProperty(d)&&"function"!==typeof l[d]&&(n[d]=l[d].visible);this._setSubLayerVisibleByCheckedInfo(n);this._setTopLayerVisible(k.visible)}},_setSubLayerVisibleByCheckedInfo:function(l){q.forEach(this.newSubLayers,function(k){m.isDefined(l[k.id])&&k.layerObject.setVisibility(l[k.id])},
this)},_initVisible:function(){var l=!1,k;for(k=0;k<this.newSubLayers.length;k++)l=l||this.newSubLayers[k].layerObject.visible;l&&(this._visible=!0)},_setTopLayerVisible:function(l){this._visible=l?!0:!1;q.forEach(this.newSubLayers,function(k){k.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var l=[];q.forEach(this.originOperLayer.featureCollection.layers,function(k){this._getLayerIndexesInMapByLayerId(k.layerObject.id)&&(A.setObject("_wabProperties.originOperLayer.showLegend",
this.originOperLayer.featureCollection.showLegend,k.layerObject),k=this._layerInfoFactory.create({layerObject:k.layerObject,title:k.layerObject.label||k.layerObject.title||k.layerObject.name||k.layerObject.id||" ",id:k.id||"-",subId:k.id||"-",collection:{layerInfo:this},selfType:"collection",showLegend:!0,parentLayerInfo:this}),l.push(k),k.init())},this);l.reverse();return l},_obtainLayerIndexesInMap:function(){var l=[],k,n;for(n=this.newSubLayers.length-1;0<=n;n--)(k=this._getLayerIndexesInMapByLayerId(this.newSubLayers[n].layerObject.id))&&
l.push(k);return l},moveLeftOfIndex:function(l){var k;for(k=0;k<this.newSubLayers.length;k++)this.map.reorderLayer(this.newSubLayers[k].layerObject,l)},moveRightOfIndex:function(l){var k;for(k=this.newSubLayers.length-1;0<=k;k--)this.map.reorderLayer(this.newSubLayers[k].layerObject,l)},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.featureCollection.showLegend?this.originOperLayer.featureCollection.showLegend:!0},getOpacity:function(){var l,k=0;for(l=0;l<this.newSubLayers.length;l++)if(this.newSubLayers[l].layerObject.opacity)k=
this.newSubLayers[l].layerObject.opacity>k?this.newSubLayers[l].layerObject.opacity:k;else return 1;return k},setOpacity:function(l){q.forEach(this.newSubLayers,function(k){k.layerObject.setOpacity&&k.layerObject.setOpacity(l)})},getScaleRange:function(){var l=this.getSubLayers();return l[0]?l[0].getScaleRange():{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic dojo/aspect dojo/Evented dojo/request/script jimu/portalUrlUtils jimu/portalUtils jimu/LayerNode jimu/utils jimu/privilegeUtils ./RequestBuffer esri/kernel esri/tasks/query esri/request".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p){var B=E([k],{declaredClass:"jimu.LayerInfo",originOperLayer:null,layerObject:null,map:null,title:null,id:null,subId:null,newSubLayers:null,parentLayerInfo:null,isTable:null,isTiled:null,_oldIsShowInMap:null,_oldFilter:null,_eventHandles:null,_subLayerInfoIndex:null,_serviceDefinitionBuffer:null,_flag:null,_objectId:null,_itemInfo:null,_adaptor:null,constructor:function(u,t,z,x){this.originOperLayer=u;this.layerObject=u.layerObject;this.map=t;this.title=
this.originOperLayer.title||this.originOperLayer.id||"";this.id=this.originOperLayer.id;this.subId=void 0!==this.originOperLayer.subId?this.originOperLayer.subId:this.id;this.parentLayerInfo=u.parentLayerInfo?u.parentLayerInfo:null;this.isTiled=this.isTable=!1;this._eventHandles=[];this._layerInfoFactory=z;this._layerInfos=x;this._flag={};this._objectId=Math.random();this._adaptor=new g(this)},init:function(){this.newSubLayers=this.obtainNewSubLayers();this._initSubLayerInfoIndex();this._initVisible();
this.originOperLayer.popupInfo&&(this.popupVisible=!0);this._oldIsShowInMap=this.isShowInMap();this._initOldFilter();this._initServiceDefinitionBuffer();this._bindEvent()},_initOldFilter:function(){this._oldFilter=null},_initServiceDefinitionBuffer:function(){this._serviceDefinitionBuffer=new a(A.hitch(this,this._serviceDefinitionRequest))},isGraphicLayer:function(){var u=this._obtainLayerIndexesInMap();return u.length?u[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},
getObjectId:function(){return this._objectId},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(u){this.layerObject.setOpacity&&this.layerObject.setOpacity(u)},moveLeftOfIndex:function(u){this.map.reorderLayer(this.layerObject,u)},moveRightOfIndex:function(u){this.map.reorderLayer(this.layerObject,u)},traversal:function(u){if(u(this))return!0;for(var t=this.getSubLayers(),z=0;z<t.length;z++)if(t[z].traversal(u))return!0},findLayerInfoById:function(u){var t=
null,z=0;if(this.id&&this.id===u)return this;for(z=0;z<this.newSubLayers.length&&!(t=this.newSubLayers[z].findLayerInfoById(u));z++);return t},setTopLayerVisible:function(u){this._setTopLayerVisible(u)},_setTopLayerVisible:function(u){},_setSubLayerVisible:function(u,t){},setLayerVisiblefromTopLayer:function(){},_resetLayerObjectVisiblity:function(){},resetLayerObjectVisibility:function(u){this.isRootLayer()&&this._resetLayerObjectVisiblity(u)},_initVisible:function(){},isVisible:function(){return this._visible?
!0:!1},show:function(){this._setTopLayerVisible(!0)},hide:function(){this._setTopLayerVisible(!1)},_obtainLayerIndexesInMap:function(){var u=[],t;(t=this._getLayerIndexesInMapByLayerId(this.id))&&u.push(t);return u},_getLayerIndexesInMapByLayerId:function(u){var t;for(t=0;t<this.map.graphicsLayerIds.length;t++)if(this.map.graphicsLayerIds[t]===u)return{isGraphicLayer:!0,index:t};for(t=0;t<this.map.layerIds.length;t++)if(this.map.layerIds[t]===u)return{isGraphicLayer:!1,index:t};return null},_isShowInMapChanged:function(){var u=
!1,t=this.isShowInMap();!1===t&&this.map.infoWindow.hide();this._oldIsShowInMap!==t&&(this._oldIsShowInMap=t,u=!0);return u},_isShowInMapChanged2:function(){var u=[];this.traversal(function(t){t._isShowInMapChanged()&&u.push(t)});r.publish("layerInfos/layerInfo/isShowInMapChanged",u)},_visibleChanged:function(){r.publish("layerInfos/layerInfo/visibleChanged",[this])},_initSubLayerInfoIndex:function(){var u={};this.isRootLayer()&&this.traversal(function(t){t.isRootLayer()||(u[t.subId]=t)});this._subLayerInfoIndex=
u},_getLayerInfosObj:function(){return this._layerInfos},obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return v.create("div",{"class":"legends-div"})},drawLegends:function(u,t){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.showLegend?this.originOperLayer.showLegend:!0},_needToRenew:function(){return!1},_getServiceDefinition:function(){var u=
new w;u.resolve(null);return u},_serviceDefinitionRequest:function(u){return this._normalRequest(u,{f:"json"},"json")},getServiceDefinition:function(){return this._getServiceDefinition()},_normalRequest:function(u,t,z){return p({url:u,content:t,handleAs:z,callbackParamName:"callback"})},getLayerObject:function(){var u=new w;this.layerObject?u.resolve(this.layerObject):u.resolve(null);return u},getLayerObjectTryUsingFeatureService:function(){return this.getLayerObject()},getSubLayers:function(){return this.newSubLayers},
isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},getLayerLevel:function(){for(var u=0,t=this;t.parentLayerInfo;)u++,t=t.parentLayerInfo;return u},getRootLayerInfo:function(){for(var u=this;u.parentLayerInfo;)u=u.parentLayerInfo;return u},isShowInMap:function(){for(var u=!0,t=this;t;)u=u&&t.isVisible(),t=t.parentLayerInfo;return u},getLayerType:function(){var u=[null],t=new w;this.layerObject.declaredClass&&(u=this.layerObject.declaredClass.split("."));
t.resolve(u[u.length-1]);return t},getPopupInfo:function(){return this.originOperLayer.popupInfo},getPopupInfoFromLayerObject:function(){var u=this.getInfoTemplate(),t=null;u&&(t=u.info);return t},loadPopupInfo:function(){var u=new w;this.loadInfoTemplate().then(A.hitch(this,function(t){var z=null;t&&(z=t.info);u.resolve(z)}));return u},loadInfoTemplate:function(){var u=new w;u.resolve(null);return u},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?
this.originOperLayer.layerDefinition.definitionExpression:null},getFilter:function(){return null},setFilter:function(){},getShowLegendOfWebmap:function(){for(var u=this,t=!0;u;)t=t&&u._getShowLegendOfWebmap(),u=u.parentLayerInfo;return t},getUrl:function(){return this.layerObject.url||this.layerObject._url},hasLayerTypes:function(u){},getSupportTableInfo:function(){var u=new w,t={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},z=this.getLayerType(),x=this.getLayerObject();m({type:z,layerObject:x}).then(A.hitch(this,
function(y){var D=y.type;y=y.layerObject;t.layerType=D;0<=this._getLayerTypesOfSupportTable().indexOf(D)&&(t.isSupportedLayer=!0);if(!y)t.isSupportQuery=!1;else if(this.parentLayerInfo&&this.parentLayerInfo.isMapNotesLayerInfo())t.isSupportQuery=!1;else if(!y.url||y.capabilities&&y.capabilities.indexOf&&0<=y.capabilities.indexOf("Query"))t.isSupportQuery=!0;u.resolve(t)}),function(){u.resolve(t)});return u},getRelatedTableInfoArray:function(u){u=new w;u.resolve([]);return u},getRelatedRecords:function(u,
t){u=new w;u.resolve([]);return u},removeSubLayerById:function(u){var t=[];q.forEach(this.newSubLayers,function(z){z.id!==u?t.push(z):z.destroy()});this.newSubLayers=t},releaseResource:function(){q.forEach(this._eventHandles,function(u){u.remove()});this.destroyLabelLayer();this._adaptor&&this._adaptor.destroy()},destroy:function(){q.forEach(this.newSubLayers,function(u){u.destroy()});this.releaseResource();this.inherited(arguments)},update:function(){q.forEach(this.newSubLayers,function(u){u.destroy()});
this.releaseResource();this.init()},isMapNotesLayerInfo:function(){return this.originOperLayer.featureCollection&&0===this.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===this.originOperLayer.layerType&&!this.map.getLayer(this.id)?!0:!1},getMSShipFeatures:function(){var u=new w;u.resolve(null);return u},_getExtent:function(){var u=new w;u.resolve(this.layerObject.fullExtent||this.layerObject.initialExtent);return u},getExtent:function(){var u=new w;this._getExtent().then(A.hitch(this,function(t){b.projectToMapSpatialReference(this.map,
t).then(A.hitch(this,function(z){u.resolve(z)}),A.hitch(this,function(){u.resolve(null)}))}),A.hitch(this,function(){u.resolve(null)}));return u},_requerySelectdFeatures:function(){var u=new w;this.getLayerObject().then(A.hitch(this,function(t){var z=[];if(t&&t.isEditable&&!t.isEditable()){var x=t.objectIdField;z=t.getSelectedFeatures();var y=t.on("update-end",A.hitch(this,function(){var D=new h,H=[];q.forEach(z,function(I){H.push(I.attributes[x])},this);D.objectIds=H;D.maxAllowableOffset=0;t.queryFeatures(D,
A.hitch(this,function(I){q.forEach(I.features,function(N){q.some(z,function(S){return S.attributes[x]===N.attributes[x]?(S.setGeometry(N.geometry),!0):!1})},this);u.resolve()}),A.hitch(this,function(){u.resolve()}));y&&y.remove&&y.remove()}))}}));return u},zoomTo:function(u){this._requerySelectdFeatures();return u?b.projectToMapSpatialReference(this.map,u).then(A.hitch(this,function(t){return this._zoomTo(t)})):this.getExtent().then(A.hitch(this,function(t){return this._zoomTo(t)}))},_zoomTo:function(u){if(b.isValidExtent(u)){u=
A.clone(u);var t=this.getLayerScaleRange(),z=t.minScale;t=t.maxScale;if(u.isSinglePoint){if(z=b.getTargetScale(this.map,3,z,t))u=b.adjustHeightToAspectRatio(this.map,u),u=b.getExtentForScale(u,this.map.width,z),this.map.setExtent(u)}else{u=b.adjustExtentToAspectRatio(this.map,u);var x=b.getScaleForExtent(u,this.map.width);0<z&&x>z?(z=b.getScaleForNextTileLevel(this.map,z,!0),u=b.adjustHeightToAspectRatio(this.map,u),u=b.getExtentForScale(u,this.map.width,z),this.map.setExtent(u)):x<t?(t=b.getScaleForNextTileLevel(this.map,
t,!1),u=b.adjustHeightToAspectRatio(this.map,u),u=b.getExtentForScale(u,this.map.width,t),this.map.setExtent(u)):this.map.setExtent(u,!0)}}},mergeScale:function(u,t,z,x){var y=0,D=0;0===u&&0<z?y=z:0<u&&0===z?y=u:0<u&&0<z&&(y=Math.min(u,z));D=Math.max(t,x);return{minScale:y,maxScale:D}},unionScale:function(u,t,z,x){var y=0,D=0;y=0===u||0===z?0:Math.max(u,z);D=Math.min(t,x);return{minScale:y,maxScale:D}},getScaleRange:function(){return this.layerObject&&0<=this.layerObject.minScale&&0<=this.layerObject.maxScale?
{minScale:this.layerObject.minScale,maxScale:this.layerObject.maxScale}:{minScale:0,maxScale:0}},setScaleRange:function(u,t){this.layerObject&&this.layerObject.setScaleRange&&this.layerObject.setScaleRange(u,t)},getLayerScaleRange:function(){var u,t=this.getScaleRange();this.traversal(A.hitch(this,function(z){z.id!==this.id&&(z=z.getScaleRange(),u=u?this.unionScale(u.minScale,u.maxScale,z.minScale,z.maxScale):z)}));return u?this.mergeScale(t.minScale,t.maxScale,u.minScale,u.maxScale):t},isCurrentScaleInTheScaleRange:function(){var u=
this.getScaleRange(),t=this.map.getScale();return 0===u.minScale&&0===u.maxScale?!0:(0===u.minScale||u.minScale>=t)&&(0===u.maxScale||t>=u.maxScale)?!0:!1},isInScale:function(){for(var u=!0,t=this;t&&(u=t.isCurrentScaleInTheScaleRange(),t=t.parentLayerInfo,u););return u},enablePopup:function(){},disablePopup:function(){},isPopupEnabled:function(){return!1},enablePopupNested:function(){this.isLeaf()?this.enablePopup():this.traversal(A.hitch(this,function(u){u.isLeaf()&&u.enablePopup()}))},isSupportPopup:function(){var u=
new w;u.resolve(!1);return u},disablePopupNested:function(){this.isLeaf()?this.disablePopup():this.traversal(A.hitch(this,function(u){u.isLeaf()&&u.disablePopup()}))},isPopupNestedEnabled:function(){var u=!1;this.isLeaf()?u=this.isPopupEnabled():this.traversal(A.hitch(this,function(t){return t.isLeaf()&&t.isPopupEnabled()?u=!0:!1}));return u},isSupportPopupNested:function(){var u=new w,t=[];this.traversal(function(z){z.isLeaf()&&t.push(z.isSupportPopup())});m(t).then(function(z){q.some(z,function(x){if(x)return u.resolve(!0),
!0;u.resolve(!1);return!1})});return u},getCapabilitiesOfWebMap:function(){return this.originOperLayer.capabilities},isItemLayer:function(){return this._getBasicItemInfo()},isPublicService:function(){var u=new w,t=this.getUrl();(t=t&&t+"?f\x3djson")?("https"===d.getProtocol(window.location.href)&&(t=d.setHttpsProtocol(t)),n.get(t,{jsonp:"callback"}).then(A.hitch(this,function(z){z&&z.error?u.resolve(!1):u.resolve(!0)}),A.hitch(this,function(){u.resolve(!1)}))):u.resolve(!0);return u},_checkUserLicense:function(u){var t=
"";!window.isXT&&window.queryObject&&(window.queryObject.id&&!/^(stemapp|stemapp3d)$/gi.test(window.queryObject.id)?t=window.queryObject.id:window.queryObject.appid&&(t=window.queryObject.appid));return window.isXT||!t?(u=new w,u.resolve(!0),u):e.checkEssentialAppsLicense(t,u,!1).then(A.hitch(this,function(z){return!(z&&z.viewOnly)}),A.hitch(this,function(){return!1}))},isEditable:function(){var u=!1,t=!0,z=!0,x=getAppConfig().portalUrl,y=c.getPortal(x);x=this.isPublicService();var D=new w,H=new w;
y.getUser().then(A.hitch(this,function(I){H.resolve(I)}),A.hitch(this,function(){H.resolve(null)}));y=this._checkUserLicense(y);m({user:H,isPublicService:x,license:y}).then(A.hitch(this,function(I){var N=I.user&&I.user.privileges,S=I.isPublicService;I=I.license;N&&-1===q.indexOf(N,"features:user:edit")&&f.id&&!S&&(t=!1);S||I||(z=!1);u=this.layerObject&&this.layerObject.isEditable?this.layerObject.isEditable()&&t&&z?!0:!1:!1;D.resolve(u)}),A.hitch(this,function(){D.resolve(!1)}));return D},_getBasicItemInfo:function(){var u=
null,t=this.getRootLayerInfo(),z=window.appConfig||window.getAppConfig(),x=A.getObject("_wabProperties.itemLayerInfo",!1,t.layerObject);t.originOperLayer.itemId?(u={},u.itemId=t.originOperLayer.itemId,u.portalUrl=d.getStandardPortalUrl(z.map.portalUrl||z.portalUrl)):x&&x.portalUrl&&x.itemId&&(u={},u.itemId=x.itemId,u.portalUrl=d.getStandardPortalUrl(x.portalUrl));return u},getItemInfo:function(){var u=new w,t=this.getRootLayerInfo();t.isItemLayer()?(t._itemInfo||(t._itemInfo=new B.ItemInfo(this,t)),
t._itemInfo.onLoad().then(A.hitch(this,function(){u.resolve(t._itemInfo)}),A.hitch(this,function(){u.resolve(null)}))):u.resolve(null);return u},isHostedService:function(){var u=new w;this._getServiceDefinition().then(A.hitch(this,function(t){u.resolve(t&&t.serviceItemId?!0:!1)}));return u},isHostedLayer:function(){if(this.isItemLayer())var u=this.isHostedService();else u=new w,u.resolve(!1);return u},obtainLabelControl:function(){},restoreLabelControl:function(){},destroyRealtedLabelLayer:function(){},
destroyLabelLayer:function(){},canShowLabel:function(){},isShowLabels:function(){},showLabels:function(){},hideLabels:function(){},isBasemap:function(){return this.getRootLayerInfo().layerObject._basemapGalleryLayerType?!0:!1},emitEvent:function(){try{this.emit.apply(this,arguments),this._adaptor&&this._adaptor.emitEvent.apply(this._adaptor,arguments)}catch(u){console.error(u)}},_bindEvent:function(){if(this.layerObject&&!this.layerObject.empty){var u=this.layerObject.on("visibility-change",A.hitch(this,
this._onVisibilityChanged));this._eventHandles.push(u);u=l.after(this.layerObject,"setDefinitionExpression",A.hitch(this,this._onFilterChanged));this._eventHandles.push(u);u=l.after(this.layerObject,"setRenderer",A.hitch(this,this._onRendererChanged));this._eventHandles.push(u);this.isRootLayer()&&(u=this.layerObject.on("opacity-change",A.hitch(this,this._onOpacityChanged)),this._eventHandles.push(u));u=this.layerObject.on("scale-range-change",A.hitch(this,this._onScaleRangeChanged));this._eventHandles.push(u);
this.isRootLayer()&&(u=this.map.on("time-extent-change",A.hitch(this,function(){this.layerObject&&this.layerObject.useMapTime&&this._onTimeExtentChanged()})),this._eventHandles.push(u));this.isRootLayer()&&(u=l.after(this.layerObject,"setTimeDefinition",A.hitch(this,function(){this.layerObject&&this.layerObject.timeInfo&&this.layerObject.mode===esri.layers.FeatureLayer.MODE_SNAPSHOT&&this._onTimeExtentChanged()})),this._eventHandles.push(u))}},_onVisibilityChanged:function(){this._initVisible();this._visibleChanged();
this._isShowInMapChanged2()},_onFilterChanged:function(){var u=this._oldFilter?this._oldFilter:null,t=this.layerObject.getDefinitionExpression();t=t?t:null;u!==t&&(r.publish("layerInfos/layerInfo/filterChanged",[this],A.getObject("_wabProperties.objectPassWithFilterChangeEvent",!0,this.layerObject)),this._oldFilter=t,A.setObject("_wabProperties.objectPassWithFilterChangeEvent",{},this.layerObject))},_onRendererChanged:function(){r.publish("layerInfos/layerInfo/rendererChanged",[this])},_onOpacityChanged:function(){r.publish("layerInfos/layerInfo/opacityChanged",
[this])},_onScaleRangeChanged:function(){r.publish("layerInfos/layerInfo/scaleRangeChanged",[this])},_onTimeExtentChanged:function(){var u=[],t=[];this.traversal(function(z){var x=z.getServiceDefinition().then(function(y){y&&y.timeInfo&&u.push(z)});t.push(x)});m(t).then(A.hitch(this,function(){r.publish("layerInfos/layerInfo/timeExtentChanged",u)}))}});B.ItemInfo=E(null,{_currentLayerInfo:null,_rootLayerInfo:null,_portalUrl:null,_itemId:null,_item:null,_itemData:null,_serviceDefinition:null,_itemInfoLoadedDef:null,
constructor:function(u,t){this._currentLayerInfo=u;this._rootLayerInfo=t;this._loadResource()},_loadResource:function(){this._itemInfoLoadedDef=new w;var u=this._rootLayerInfo.isItemLayer();if(u){this._portalUrl=u.portalUrl;this._itemId=u.itemId;var t=c.getPortal(this._portalUrl);u=t.getItemById(this._itemId);t=t.getItemData(this._itemId);var z=this._currentLayerInfo._getServiceDefinition();m({item:u,itemData:t,serviceDefinition:z}).then(A.hitch(this,function(x){this._item=x.item;this._itemData=x.itemData;
this._serviceDefinition=x.serviceDefinition;this._itemInfoLoadedDef.resolve(this)}),A.hitch(this,function(x){x&&x.message&&console.log(x.message);this._itemInfoLoadedDef.reject()}))}else this._itemInfoLoadedDef.reject()},onLoad:function(){return this._itemInfoLoadedDef},getPortalUrl:function(){return this._portalUrl},getItemId:function(){return this._itemId},getItem:function(){return this._item},getItemData:function(){return this._itemData},isHostedLayer:function(){return this._serviceDefinition&&
this._serviceDefinition.serviceItemId?!0:!1}});return B})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json dojo/request/xhr esri/request ./Role ./utils ./portalUrlUtils ./tokenUtils ./ServiceDefinitionManager".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g,b){var e=E([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(B){this.portalUrl=
c.getStandardPortalUrl(B);this.selfUrl=c.getPortalSelfInfoUrl(B)},loadSelfInfo:function(){var B=this.selfUrl;this.isValidCredential()&&(B=-1<B.indexOf("?")?B+("\x26token\x3d"+this.credential.token):B+("?token\x3d"+this.credential.token));return b.getInstance().getServiceDefinition(B).then(q.hitch(this,function(u){var t=u.user;delete u.user;q.mixin(this,u);u.user=t;return u}))},_checkCredential:function(){var B=g.isValidCredential(this.credential);B||this.clearCredentialAndUser();return B},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=g.getPortalCredential(this.portalUrl))},signIn:function(){var B=new m;this.updateCredential();this.isValidCredential()?setTimeout(q.hitch(this,function(){B.resolve(this.credential)}),0):B=g.signInPortal(this.portalUrl);return B},haveSignIn:function(){return g.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getSigninSettingsOfSelfInfo:function(){this.updateCredential();
var B=new m,u=this.selfUrl+"/signinSettings";this.isValidCredential()?B=k({url:u,handleAs:"json",content:{f:"json",token:this.credential.token},callbackParamName:"callback"}):B.resolve({});return B},getUser:function(){this.updateCredential();var B=new m;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(q.hitch(this,function(){this.user.updateCredential();B.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(q.hitch(this,
function(u){this.user=u;B.resolve(this.user)}),q.hitch(this,function(u){console.error(u);B.reject(u)})):g.getUserIdByToken(this.credential.token,this.portalUrl).then(q.hitch(this,function(u){this.credential.userId=u;this._getUser(this.credential.userId).then(q.hitch(this,function(t){this.user=t;B.resolve(this.user)}),q.hitch(this,function(t){console.error(t);B.reject(t)}))}),q.hitch(this,function(u){console.error(u);B.reject(u)})):setTimeout(q.hitch(this,function(){B.reject("credential is null.")}),
0);return B},queryItems:function(B){this.updateCredential();var u=new m,t=c.getBaseSearchUrl(this.portalUrl),z={f:"json"};B&&(z=q.mixin(z,B));this.isValidCredential()&&(z.token=this.credential.token);z.sortField||z.sortOrder||(z.sortField="title",z.sortOrder="asc");k({url:t,handleAs:"json",content:z,callbackParamName:"callback"}).then(q.hitch(this,function(x){x.results=A.map(x.results,q.hitch(this,function(y){y.portalUrl=this.portalUrl;y.credential=this.credential;y.portal=this;return new h(y)}));
u.resolve(x)}),q.hitch(this,function(x){console.error(x);u.reject(x)}));return u},getItemData:function(B){this.updateCredential();B={url:c.getItemDataUrl(this.portalUrl,B),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};return k(B)},_getItemById:function(B,u){B={url:c.getItemUrl(this.portalUrl,B),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};u&&(B.content.token=u);return k(B).then(q.hitch(this,function(t){t.portalUrl=this.portalUrl;t.credential=this.credential;
t.portal=this;return new h(t)}))},getItemById:function(B,u){this.updateCredential();return this._getItemById(B).then(q.hitch(this,function(t){return u&&t.owner&&this.isValidCredential()&&this.credential&&this.credential.userId===t.owner?this._getItemById(B,this.credential.token):t}))},getAppById:function(B){var u=new m;this.updateCredential();this.isValidCredential()?(B=c.getAppIdUrl(this.portalUrl,B),u=k({url:B,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(q.hitch(this,
function(){u.reject("token is null.")}),0);return u},queryGroups:function(B){this.updateCredential();var u=new m,t=c.getBaseGroupUrl(this.portalUrl),z={f:"json"};B&&(z=q.mixin(z,B));this.isValidCredential()&&(z.token=this.credential.token);k({url:t,handleAs:"json",content:z,callbackParamName:"callback"}).then(q.hitch(this,function(x){x.results=A.map(x.results,q.hitch(this,function(y){y.portalUrl=this.portalUrl;y.credential=this.credential;y.portal=this;return new f(y)}));u.resolve(x)}),q.hitch(this,
function(x){console.error(x);u.reject(x)}));return u},registerApp:function(B,u,t){var z=new m;this.updateCredential();if(this.isValidCredential()){var x=this.credential&&this.credential.token,y=c.getOAuth2Url(this.portalUrl);z=k({url:y+"/registerApp",content:{itemId:B,appType:u,redirect_uris:r.stringify(t),token:x,f:"json"},handleAs:"json"},{usePost:!0})}else setTimeout(q.hitch(this,function(){z.reject("token is null.")}),0);return z},createAndRegisterApp:function(B){var u=new m;this.updateCredential();
this.isValidCredential()?this.getUser().then(q.hitch(this,function(t){t.addItem({title:"ArcGIS Web AppBuilder",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(q.hitch(this,function(z){z.success?this.registerApp(z.id,"browser",B).then(q.hitch(this,function(x){u.resolve(x)}),q.hitch(this,function(x){console.error(x);u.reject(x)})):u.reject("create app failed")}),q.hitch(this,function(z){console.error(z);u.reject(z)}))}),q.hitch(this,function(t){console.error(t);
u.reject(t)})):setTimeout(q.hitch(this,function(){u.reject("token is null.")}),0);return u},_getUser:function(B){this.updateCredential();var u=new m;B={url:c.getUserUrl(this.portalUrl,B),content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&(B.content.token=this.credential&&this.credential.token);k(B).then(q.hitch(this,function(t){t.portalUrl=this.portalUrl;t.credential=this.credential;t.portal=this;this.user=new a(t);u.resolve(this.user)}),q.hitch(this,function(t){console.error(t);
u.reject(t)}));return u},getHelpMap:function(){this.updateCredential();var B={url:c.getPortalHelpMapUrl(this.portalUrl),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};return k(B)}}),a=E([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(B){B&&q.mixin(this,B)},_checkCredential:function(){var B=g.isValidCredential(this.credential);B||(this.credential=null);return B},isValidCredential:function(){this.updateCredential();return this._checkCredential()},
updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},canCreateItem:function(){var B=new n({id:this.roleId?this.roleId:this.role,role:this.role});this.privileges&&B.setPrivileges(this.privileges);return B.canCreateItem()},canCreateNotebooks:function(){var B=new n({id:this.roleId?this.roleId:this.role,role:this.role});this.privileges&&B.setPrivileges(this.privileges);return B.canCreateNotebooks()},getGroups:function(){var B=[];
this.groups&&(B=A.map(this.groups,q.hitch(this,function(u){u.portalUrl=this.portalUrl;u.credential=this.credential;u.portal=this.portal;return new f(u)})));return B},getItemsByKeywords:function(B,u){return this.portal.queryItems({start:u||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+B+'"'})},getContent:function(){this.updateCredential();var B={url:c.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&
(B.content.token=this.credential.token);return k(B)},getTags:function(){this.updateCredential();var B={url:c.getUserTagsUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(B.content.token=this.credential.token);return k(B)},addItem:function(B,u){this.updateCredential();var t=new m;if(this.isValidCredential()){var z={f:"json",token:this.credential.token};B&&(z=q.mixin(z,B));k({url:c.getAddItemUrl(this.portalUrl,this.username,
u),handleAs:"json",callbackParamName:"callback",content:z},{usePost:!0}).then(q.hitch(this,function(x){t.resolve(x)}),q.hitch(this,function(x){console.error(x);t.reject(x)}))}else setTimeout(q.hitch(this,function(){t.reject("token is null.")}),0);return t},deleteItem:function(B){this.updateCredential();var u=new m;this.isValidCredential()?(B=c.getDeleteItemUrl(this.portalUrl,this.username,B),u=k({url:B,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(q.hitch(this,
function(){u.reject("token is null.")}),0);return u},getItemById:function(B,u){this.updateCredential();var t=new m;B={url:c.getUserItemsUrl(this.portalUrl,this.username,u)+"/"+B,handleAs:"json",content:{f:"json"},callbackParamName:"callback"};k(B).then(q.hitch(this,function(z){z.portalUrl=this.portalUrl;z.credential=this.credential;z.portal=this;z=new h(z);t.resolve(z)}),q.hitch(this,function(z){console.error(z);t.reject(z)}));return t},shareItem:function(B,u,t){this.updateCredential();var z=new m;
this.isValidCredential()?(u={url:c.shareItemUrl(this.portalUrl,this.username,u,t),handleAs:"json",callbackParamName:"callback",content:{f:"json",token:this.credential.token}},B&&(u.content=q.mixin(u.content,B)),k(u,{usePost:!0}).then(q.hitch(this,function(x){z.resolve(x)}),q.hitch(this,function(x){console.error(x);z.reject(x)}))):setTimeout(q.hitch(this,function(){z.reject("token is null.")}),0);return z},updateItem:function(B,u){this.updateCredential();var t=new m;this.isValidCredential()?this.portal.getItemById(B).then(q.hitch(this,
function(z){var x={f:"json",token:this.credential.token};u&&(x=q.mixin(x,u));k({url:c.getUpdateItemUrl(this.portalUrl,z.owner,B,z.ownerFolder),handleAs:"json",callbackParamName:"callback",timeout:1E5,content:x},{usePost:!0}).then(q.hitch(this,function(y){t.resolve(y)}),q.hitch(this,function(y){console.error(y);t.reject(y)}))}),q.hitch(this,function(z){console.error(z);t.reject(z)})):setTimeout(q.hitch(this,function(){t.reject("token is null.")}),0);return t},isAdminRole:function(){return"org_admin"===
this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role},getRegisteredAppInfo:function(B,u){var t=new m;this.updateCredential();u=c.getUserItemsUrl(this.portalUrl,this.username,u);return t=k({url:u+"/"+B+"/registeredAppInfo",content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})},getRegisteredAppInfoWithXhr:function(B,
u){var t=new m;this.updateCredential();u=c.getUserItemsUrl(this.portalUrl,this.username,u);return t=l(u+"/"+B+"/registeredAppInfo",{data:{token:this.credential.token,f:"json"},method:"POST",handleAs:"json"})}}),f=E([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(B){B&&q.mixin(this,B)},_checkCredential:function(){var B=g.isValidCredential(this.credential);B||(this.credential=null);return B},isValidCredential:function(){this.updateCredential();return this._checkCredential()},
updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(B){B.q="group:"+this.id+" AND "+B.q;return this.portal.queryItems(B)}}),h=E([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(B){B&&q.mixin(this,B);this.itemUrl=c.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&
(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=c.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=c.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var B=g.isValidCredential(this.credential);B||(this.credential=null);return B},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)},getItemGroups:function(){this.updateCredential();var B={url:c.getItemGroupsUrl(this.portalUrl,this.id),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(B.content.token=this.credential.token);return k(B)}}),p={portals:[],webMapQueryStr:" "+
d.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+d.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(B){for(var u=0;u<this.portals.length;u++){var t=this.portals[u];if(c.isSamePortalUrl(B,t.portalUrl))return t.updateCredential(),t}return null},getPortal:function(B){if(!B||"string"!==typeof B||!q.trim(B))return null;B=c.getStandardPortalUrl(B);var u=this._findPortal(B);u||(u=new e(B),u.credential=g.getPortalCredential(u.portalUrl),u.updateCredential(),this.portals.push(u));
return u},getPortalSelfInfo:function(B){return this.getPortal(B).loadSelfInfo()},getBasemapGalleryGroup:function(B){return this._getPortalSelfGroup(B,"basemapGalleryGroupQuery")},getTemplatesGroup:function(B){return this._getPortalSelfGroup(B,"templatesGroupQuery")},getUnits:function(B){var u="english",t="",z=new m;this.getPortal(B).getUser().then(q.hitch(this,function(x){x&&x.units?u=x.units:(t=w.locale,u=t.startWith("en")?"english":"metric");z.resolve(u)}),q.hitch(this,function(x){console.warn(x);
this.getPortalSelfInfo(B).then(q.hitch(this,function(y){var D=null;y&&y.units?D=y.units:(t=y&&y.culture||w.locale,D=t.startWith("en")?"english":"metric");z.resolve(D)}),q.hitch(this,function(y){console.warn(y);t=w.locale;u=t.startWith("en")?"english":"metric";z.resolve(u)}))}));return z.promise},_getPortalSelfGroup:function(B,u){var t=new m,z=this.getPortal(B);z||setTimeout(q.hitch(this,function(){t.reject()}),0);this.getPortalSelfInfo(B).then(q.hitch(this,function(x){z.queryGroups({f:"json",q:x[u]}).then(q.hitch(this,
function(y){0<y.results.length?(y=y.results[0],y.portalUrl=z.portalUrl,y.credential=z.credential,y.portal=z,y=new f(y),t.resolve(y)):t.reject("Can't find portal self group.")}),q.hitch(this,function(y){console.error(y);t.reject(y)}))}),q.hitch(this,function(x){console.error(x);t.reject(x)}));return t},getWebMapsFromBasemapGalleryGroup:function(B){var u=new m;this.getBasemapGalleryGroup(B).then(q.hitch(this,function(t){t?t.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(q.hitch(this,
function(z){u.resolve(z)}),q.hitch(this,function(z){console.error(z);u.reject(z)})):u.reject()}),q.hitch(this,function(t){console.error(t);u.reject(t)}));return u},getDefaultWebScene:function(B){var u=c.getStandardPortalUrl(B);return this._searchWABDefaultWebScene(u).then(q.hitch(this,function(t){return t?t:this._createWABDefaultWebScene(u).then(q.hitch(this,function(z){return this.getPortal(u).getUser().then(q.hitch(this,function(x){var y=!1;x&&x.privileges&&0<x.privileges.length&&(y=A.some(x.privileges,
function(D){return 0<=D.indexOf("shareToPublic")}));return y?x.shareItem({everyone:!0},z).then(q.hitch(this,function(){return z}),q.hitch(this,function(){return z})):z}),q.hitch(this,function(x){console.error(x);return z}))}))}))},_searchWABDefaultWebScene:function(B){var u=new m;B=c.getStandardPortalUrl(B);B=this.getPortal(B);B.queryItems({q:'typekeywords:"WABDefaultWebScene" orgid:'+B.user.orgId+" access:public "+this.webSceneQueryStr}).then(q.hitch(this,function(t){t&&t.results&&0<t.results.length?
u.resolve(t.results[0].id):u.resolve(null)}),q.hitch(this,function(t){console.error("_searchWABDefaultWebScene error:",t);u.reject(t)}));return u},_createWABDefaultWebScene:function(B){var u=new m;B=c.getStandardPortalUrl(B);this.getPortal(B).getUser().then(q.hitch(this,function(t){var z={title:"Default Web Scene",type:"Web Scene",typeKeywords:"WABDefaultWebScene",tags:"default",text:r.stringify({operationalLayers:[],baseMap:{baseMapLayers:[{id:"World_Hillshade_3805",opacity:1,title:"World Hillshade",
url:"https://services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",visibility:!0,layerType:"ArcGISTiledMapServiceLayer"},{id:"VectorTile_2333",opacity:1,title:"World Topographic Map",visibility:!0,layerType:"VectorTileLayer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json"}],id:"18411ea05c5-basemap-2",title:"Topographic",elevationLayers:[{id:"globalElevation",listMode:"hide",title:"Terrain3D",url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",
layerType:"ArcGISTiledElevationServiceLayer"}]},ground:{layers:[{id:"globalElevation",listMode:"hide",title:"Terrain3D",url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}],transparency:0,navigationConstraint:{type:"stayAbove"}},heightModelInfo:{heightModel:"gravity_related_height",heightUnit:"meter"},version:"1.29",initialState:{environment:{lighting:{type:"sun",datetime:1647343627E3,displayUTCOffset:1},atmosphereEnabled:!0,
starsEnabled:!0,weather:{type:"sunny",cloudCover:.5}},viewpoint:{camera:{position:{spatialReference:{latestWkid:3857,wkid:102100},x:915287.4999997217,y:5857832.062839295,z:1.3939488740801457E7},heading:0,tilt:.1569588913889209}}},spatialReference:{latestWkid:3857,wkid:102100},viewingMode:"global",authoringApp:"WebAppBuilder",authoringAppVersion:"2.26"}),snippet:""};t.addItem(z,"").then(q.hitch(this,function(x){x.success?u.resolve(x.id):(console.error("Can't create default web scene:",x),u.reject())}))}),
q.hitch(this,function(t){console.error("Can't create default web scene");u.reject(t)}));return u},getDefaultWebMap:function(B){var u=new m;this.getPortalSelfInfo(B).then(q.hitch(this,function(t){var z=t.defaultBasemap&&t.defaultBasemap.id;z?u.resolve(z):this._getDefaultWebMapByBasemapGallery(B,t).then(q.hitch(this,function(x){x?u.resolve(x):this._getMostNumViewsWebMap(B).then(q.hitch(this,function(y){y?u.resolve(y):u.reject()}),q.hitch(this,function(y){console.error(y);u.reject(y)}))}),q.hitch(this,
function(x){console.error(x);u.reject(x)}))}),q.hitch(this,function(t){console.error(t);u.reject(t)}));return u},_getDefaultWebMapByBasemapGallery:function(B,u){var t=new m,z=this.getPortal(B),x=u.defaultBasemap&&u.defaultBasemap.title;z.queryGroups({f:"json",q:u.basemapGalleryGroupQuery}).then(q.hitch(this,function(y){y=y.results;0<y.length?z.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+y[0].id+" AND title:"+x}).then(q.hitch(this,function(D){D=D.results;D=A.filter(D,q.hitch(this,
function(H){return H.type&&"web map"===H.type.toLowerCase()}));0<D.length?t.resolve(D[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),z.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+x}).then(q.hitch(this,function(H){H=H.results;H=A.filter(H,q.hitch(this,function(N){return N.type&&"web map"===N.type.toLowerCase()}));if(0<H.length){var I=H[0];z.getItemData(I.id).then(q.hitch(this,function(N){N&&(N.operationalLayers||N.baseMap||N.version)?t.resolve(I.id):
t.resolve(null)}),q.hitch(this,function(){t.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),t.resolve(null)}),q.hitch(this,function(H){console.error(H);t.reject(H)})))}),q.hitch(this,function(D){console.error(D);t.reject(D)})):(console.log("Can't find group by basemapGalleryGroupQuery."),t.resolve(null))}),q.hitch(this,function(y){console.error(y);t.reject(y)}));return t},_getMostNumViewsWebMap:function(B){var u=new m;this.getPortal(B).queryItems({start:1,num:1,f:"json",
q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(q.hitch(this,function(t){t=t.results;t=A.filter(t,q.hitch(this,function(z){return z.type&&"web map"===z.type.toLowerCase()}));0<t.length?u.resolve(t[0].id):u.reject("Can't find most-num-views web map.")}),q.hitch(this,function(t){console.error(t);u.reject(t)}));return u},comparePortalVersion:function(B,u){var t=B.split(".");B=parseInt(t[0],10);t=1<t.length?parseInt(t[1],10):0;var z=u.split(".");
u=parseInt(z[0],10);z=1<z.length?parseInt(z[1],10):0;return B>u?1:B<u?-1:t>z?1:t<z?-1:0},getItemResources:function(B,u,t){t||(t=100);B=c.getStandardPortalUrl(B);B=c.getItemResourceUrl(B,u);return k({url:B,content:{f:"json",num:t}}).then(function(z){if(z&&z.resources)return z.resources})},addResource:function(B,u,t,z,x){B=c.getStandardPortalUrl(B);var y=this.getPortal(B),D=new FormData;D.append("file",t,z);D.append("fileName",z);D.append("f","json");var H="";x?(D.append("resourcesPrefix",x),H=x+"/"+
z):H=z;return y.getItemById(u,!0).then(function(I){I=c.getUserContentItemUrl(B,I.owner,u);return k({url:I+"/addResources",form:D}).then(function(N){var S="";N&&N.success&&(S=c.getItemResourceUrl(B,"${itemId}",H));return S},function(N){console.error(N.message||N);return N})})},removeResources:function(B,u,t,z){var x={resource:z?z+"/"+t:t,f:"json"};B=c.getStandardPortalUrl(B);return this.getPortal(B).getItemById(u,!0).then(function(y){y=c.getUserContentItemUrl(B,y.owner,u);return k({url:y+"/removeResources",
content:x},{usePost:!0}).then(function(D){return D},function(D){console.error(D.message||D);return D})})}};v.subscribe("userSignOut",function(B){(B=p._findPortal(B))&&B.clearCredentialAndUser()});return p})},"jimu/Role":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/json","esri/lang"],function(E,q,A,w,m){return E(null,{id:null,baseRole:null,name:null,description:null,privileges:[],privilegeObj:null,constructor:function(v){v=v||{};this.id=v.id;this.baseRole=v.role;
this.name=v.name;this.description=v.description},_initPrivilegesObject:function(){this.privilegeObj={portal:{admin:{inviteUsers:!1,disableUsers:!1,viewUsers:!1,updateUsers:!1,deleteUsers:!1,changeUserRoles:!1,viewGroups:!1,updateGroups:!1,deleteGroups:!1,reassignGroups:!1,assignToGroups:!1,manageEnterpriseGroups:!1,viewItems:!1,updateItems:!1,deleteItems:!1,reassignItems:!1,manageLicenses:!1},publisher:{publishFeatures:!1,publishTiles:!1,publishScenes:!1},user:{createGroup:!1,joinGroup:!1,joinNonOrgGroup:!1,
createItem:!1,shareToGroup:!1,shareToOrg:!1,shareToPublic:!1,shareGroupToOrg:!1,shareGroupToPublic:!1}},features:{user:{edit:!1,fullEdit:!1}},opendata:{user:{openDataAdmin:!1,designateGroup:!1}},premium:{user:{geocode:!1,networkanalysis:!1,spatialanalysis:!1,geoenrichment:!1,demographics:!1,elevation:!1},publisher:{createNotebooks:!1}},marketplace:{admin:{manage:!1,purchase:!1,startTrial:!1}}}},_readPrivileges:function(v){m.isDefined(v)&&v instanceof Array&&A.forEach(v,q.hitch(this,function(r){this._readPrivilege(r)}))},
_readPrivilege:function(v){this._applyEffectToAction(!0,v)},_applyEffectToAction:function(v,r){switch(r){case "portal:admin:inviteUsers":this.privilegeObj.portal.admin.inviteUsers=v;break;case "portal:admin:disableUsers":this.privilegeObj.portal.admin.disableUsers=v;break;case "portal:admin:viewUsers":this.privilegeObj.portal.admin.viewUsers=v;break;case "portal:admin:updateUsers":this.privilegeObj.portal.admin.updateUsers=v;break;case "portal:admin:deleteUsers":this.privilegeObj.portal.admin.deleteUsers=
v;break;case "portal:admin:changeUserRoles":this.privilegeObj.portal.admin.changeUserRoles=v;break;case "portal:admin:viewGroups":this.privilegeObj.portal.admin.viewGroups=v;break;case "portal:admin:updateGroups":this.privilegeObj.portal.admin.updateGroups=v;break;case "portal:admin:deleteGroups":this.privilegeObj.portal.admin.deleteGroups=v;break;case "portal:admin:reassignGroups":this.privilegeObj.portal.admin.reassignGroups=v;break;case "portal:admin:assignToGroups":this.privilegeObj.portal.admin.assignToGroups=
v;break;case "portal:admin:manageEnterpriseGroups":this.privilegeObj.portal.admin.manageEnterpriseGroups=v;break;case "portal:admin:viewItems":this.privilegeObj.portal.admin.viewItems=v;break;case "portal:admin:updateItems":this.privilegeObj.portal.admin.updateItems=v;break;case "portal:admin:deleteItems":this.privilegeObj.portal.admin.deleteItems=v;break;case "portal:admin:reassignItems":this.privilegeObj.portal.admin.reassignItems=v;break;case "portal:admin:manageLicenses":this.privilegeObj.portal.admin.manageLicenses=
v;break;case "portal:publisher:publishFeatures":this.privilegeObj.portal.publisher.publishFeatures=v;break;case "portal:publisher:publishTiles":this.privilegeObj.portal.publisher.publishTiles=v;break;case "portal:publisher:publishScenes":this.privilegeObj.portal.publisher.publishScenes=v;break;case "portal:user:createGroup":this.privilegeObj.portal.user.createGroup=v;break;case "portal:user:joinGroup":this.privilegeObj.portal.user.joinGroup=v;break;case "portal:user:joinNonOrgGroup":this.privilegeObj.portal.user.joinNonOrgGroup=
v;break;case "portal:user:createItem":this.privilegeObj.portal.user.createItem=v;break;case "portal:user:shareToGroup":this.privilegeObj.portal.user.shareToGroup=v;break;case "portal:user:shareToOrg":this.privilegeObj.portal.user.shareToOrg=v;break;case "portal:user:shareToPublic":this.privilegeObj.portal.user.shareToPublic=v;break;case "portal:user:shareGroupToOrg":this.privilegeObj.portal.user.shareGroupToOrg=v;break;case "portal:user:shareGroupToPublic":this.privilegeObj.portal.user.shareGroupToPublic=
v;break;case "features:user:edit":this.privilegeObj.features.user.edit=v;break;case "features:user:fullEdit":this.privilegeObj.features.user.fullEdit=v;break;case "opendata:user:openDataAdmin":this.privilegeObj.opendata.user.openDataAdmin=v;break;case "opendata:user:designateGroup":this.privilegeObj.opendata.user.designateGroup=v;break;case "premium:user:geocode":this.privilegeObj.premium.user.geocode=v;break;case "premium:user:networkanalysis":this.privilegeObj.premium.user.networkanalysis=v;break;
case "premium:user:spatialanalysis":this.privilegeObj.premium.user.spatialanalysis=v;break;case "premium:user:geoenrichment":this.privilegeObj.premium.user.geoenrichment=v;break;case "premium:user:demographics":this.privilegeObj.premium.user.demographics=v;break;case "premium:user:elevation":this.privilegeObj.premium.user.elevation=v;break;case "premium:publisher:createNotebooks":this.privilegeObj.premium.publisher.createNotebooks=v;break;case "marketplace:admin:purchase":this.privilegeObj.marketplace.admin.purchase=
v;break;case "marketplace:admin:manage":this.privilegeObj.marketplace.admin.manage=v;break;case "marketplace:admin:startTrial":this.privilegeObj.marketplace.admin.startTrial=v}},_applyToAll:function(v){this.privilegeObj.portal.admin.inviteUsers=v;this.privilegeObj.portal.admin.disableUsers=v;this.privilegeObj.portal.admin.viewUsers=v;this.privilegeObj.portal.admin.updateUsers=v;this.privilegeObj.portal.admin.deleteUsers=v;this.privilegeObj.portal.admin.changeUserRoles=v;this.privilegeObj.portal.admin.viewGroups=
v;this.privilegeObj.portal.admin.updateGroups=v;this.privilegeObj.portal.admin.deleteGroups=v;this.privilegeObj.portal.admin.reassignGroups=v;this.privilegeObj.portal.admin.assignToGroups=v;this.privilegeObj.portal.admin.manageEnterpriseGroups=v;this.privilegeObj.portal.admin.viewItems=v;this.privilegeObj.portal.admin.updateItems=v;this.privilegeObj.portal.admin.deleteItems=v;this.privilegeObj.portal.admin.reassignItems=v;this.privilegeObj.portal.admin.manageLicenses=v;this.privilegeObj.portal.publisher.publishFeatures=
v;this.privilegeObj.portal.publisher.publishTiles=v;this.privilegeObj.portal.publisher.publishScenes=v;this.privilegeObj.portal.user.createGroup=v;this.privilegeObj.portal.user.joinGroup=v;this.privilegeObj.portal.user.joinNonOrgGroup=v;this.privilegeObj.portal.user.createItem=v;this.privilegeObj.portal.user.shareToGroup=v;this.privilegeObj.portal.user.shareToOrg=v;this.privilegeObj.portal.user.shareToPublic=v;this.privilegeObj.portal.user.shareGroupToOrg=v;this.privilegeObj.portal.user.shareGroupToPublic=
v;this.privilegeObj.features.user.edit=v;this.privilegeObj.opendata.user.openDataAdmin=v;this.privilegeObj.opendata.user.designateGroup=v;this.privilegeObj.premium.user.geocode=v;this.privilegeObj.premium.user.networkanalysis=v;this.privilegeObj.premium.user.spatialanalysis=v;this.privilegeObj.premium.user.geoenrichment=v;this.privilegeObj.premium.user.demographics=v;this.privilegeObj.premium.user.elevation=v;this.privilegeObj.premium.publisher.createNotebooks=v;this.privilegeObj.marketplace.admin.purchase=
v;this.privilegeObj.marketplace.admin.manage=v;this.privilegeObj.marketplace.admin.startTrial=v},_buildPrivilegesArray:function(){var v=[];!0===this.privilegeObj.portal.admin.inviteUsers&&v.push("portal:admin:inviteUsers");!0===this.privilegeObj.portal.admin.disableUsers&&v.push("portal:admin:disableUsers");!0===this.privilegeObj.portal.admin.viewUsers&&v.push("portal:admin:viewUsers");!0===this.privilegeObj.portal.admin.updateUsers&&v.push("portal:admin:updateUsers");!0===this.privilegeObj.portal.admin.deleteUsers&&
v.push("portal:admin:deleteUsers");!0===this.privilegeObj.portal.admin.changeUserRoles&&v.push("portal:admin:changeUserRoles");!0===this.privilegeObj.portal.admin.viewGroups&&v.push("portal:admin:viewGroups");!0===this.privilegeObj.portal.admin.updateGroups&&v.push("portal:admin:updateGroups");!0===this.privilegeObj.portal.admin.deleteGroups&&v.push("portal:admin:deleteGroups");!0===this.privilegeObj.portal.admin.reassignGroups&&v.push("portal:admin:reassignGroups");!0===this.privilegeObj.portal.admin.assignToGroups&&
v.push("portal:admin:assignToGroups");!0===this.privilegeObj.portal.admin.manageEnterpriseGroups&&v.push("portal:admin:manageEnterpriseGroups");!0===this.privilegeObj.portal.admin.viewItems&&v.push("portal:admin:viewItems");!0===this.privilegeObj.portal.admin.updateItems&&v.push("portal:admin:updateItems");!0===this.privilegeObj.portal.admin.deleteItems&&v.push("portal:admin:deleteItems");!0===this.privilegeObj.portal.admin.reassignItems&&v.push("portal:admin:reassignItems");!0===this.privilegeObj.portal.admin.manageLicenses&&
v.push("portal:admin:manageLicenses");!0===this.privilegeObj.portal.publisher.publishFeatures&&v.push("portal:publisher:publishFeatures");!0===this.privilegeObj.portal.publisher.publishTiles&&v.push("portal:publisher:publishTiles");!0===this.privilegeObj.portal.publisher.publishScenes&&v.push("portal:publisher:publishScenes");!0===this.privilegeObj.portal.user.createGroup&&v.push("portal:user:createGroup");!0===this.privilegeObj.portal.user.joinGroup&&v.push("portal:user:joinGroup");!0===this.privilegeObj.portal.user.joinNonOrgGroup&&
v.push("portal:user:joinNonOrgGroup");!0===this.privilegeObj.portal.user.createItem&&v.push("portal:user:createItem");!0===this.privilegeObj.portal.user.shareToGroup&&v.push("portal:user:shareToGroup");!0===this.privilegeObj.portal.user.shareToOrg&&v.push("portal:user:shareToOrg");!0===this.privilegeObj.portal.user.shareToPublic&&v.push("portal:user:shareToPublic");!0===this.privilegeObj.portal.user.shareGroupToOrg&&v.push("portal:user:shareGroupToOrg");!0===this.privilegeObj.portal.user.shareGroupToPublic&&
v.push("portal:user:shareGroupToPublic");!0===this.privilegeObj.features.user.edit&&v.push("features:user:edit");!0===this.privilegeObj.features.user.fullEdit&&v.push("features:user:fullEdit");!0===this.privilegeObj.opendata.user.openDataAdmin&&v.push("opendata:user:openDataAdmin");!0===this.privilegeObj.opendata.user.designateGroup&&v.push("opendata:user:designateGroup");!0===this.privilegeObj.premium.user.geocode&&v.push("premium:user:geocode");!0===this.privilegeObj.premium.user.networkanalysis&&
v.push("premium:user:networkanalysis");!0===this.privilegeObj.premium.user.spatialanalysis&&v.push("premium:user:spatialanalysis");!0===this.privilegeObj.premium.user.geoenrichment&&v.push("premium:user:geoenrichment");!0===this.privilegeObj.premium.user.demographics&&v.push("premium:user:demographics");!0===this.privilegeObj.premium.user.elevation&&v.push("premium:user:elevation");!0===this.privilegeObj.premium.publisher.createNotebooks&&v.push("premium:publisher:createNotebooks");!0===this.privilegeObj.marketplace.admin.purchase&&
v.push("marketplace:admin:purchase");!0===this.privilegeObj.marketplace.admin.manage&&v.push("marketplace:admin:manage");!0===this.privilegeObj.marketplace.admin.startTrial&&v.push("marketplace:admin:startTrial");return v},isUser:function(){return m.isDefined(this.id)&&("org_user"===this.id||"account_user"===this.id)},isPublisher:function(){return m.isDefined(this.id)&&("org_publisher"===this.id||"account_publisher"===this.id)},isAdmin:function(){return m.isDefined(this.id)&&("org_admin"===this.id||
"account_admin"===this.id)},isBasedOnUser:function(){return this.isUser()||m.isDefined(this.baseRole)&&("org_user"===this.baseRole||"account_user"===this.baseRole)},isBasedOnPublisher:function(){return this.isPublisher()||m.isDefined(this.baseRole)&&("org_publisher"===this.baseRole||"account_publisher"===this.baseRole)},isBasedOnAdmin:function(){return this.isAdmin()||m.isDefined(this.baseRole)&&("org_admin"===this.baseRole||"account_admin"===this.baseRole)},isCustom:function(){return!this.isUser()&&
!this.isPublisher()&&!this.isAdmin()&&m.isDefined(this.id)&&0<this.id.length},canInviteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.inviteUsers},canDisableUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.disableUsers},canViewUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewUsers},canUpdateUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateUsers},canDeleteUsers:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.deleteUsers},canChangeUserRoles:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.changeUserRoles},canViewOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewGroups},canUpdateOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateGroups},canDeleteOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteGroups},canReassignOrgGroups:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.reassignGroups},canAssignUsersToOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.assignToGroups},canManageEnterpriseGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageEnterpriseGroups},canViewOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewItems},canUpdateOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateItems},canDeleteOrgItems:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.deleteItems},canReassignOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignItems},canManageLicenses:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageLicenses},canCreateGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createGroup},canJoinOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinGroup},canJoinNonOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinNonOrgGroup},
canPublishFeatures:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishFeatures},canPublishTiles:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishTiles},canPublishScenes:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishScenes},canCreateItem:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createItem},canShareItemToGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToGroup},
canShareItemToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToOrg},canShareItemToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToPublic},canShareGroupToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToOrg},canShareGroupToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToPublic},canEditFeatures:function(){return this.privilegeObj&&this.privilegeObj.features.user.edit},
canEditFeaturesFullControl:function(){return this.privilegeObj&&this.privilegeObj.features.user.fullEdit},canManageOpenData:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.openDataAdmin},canDesignateOpenDataGroups:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.designateGroup},canUseGeocode:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geocode},canUseNetworkAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.networkanalysis},
canUseSpatialAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.spatialanalysis},canUseGeoenrichment:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geoenrichment},canUseDemographics:function(){return this.privilegeObj&&this.privilegeObj.premium.user.demographics},canCreateNotebooks:function(){return this.privilegeObj&&this.privilegeObj.premium.publisher.createNotebooks},canPurchaseMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.purchase},
canManageMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.manage},canTrialMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.startTrial},setPrivileges:function(v){this.privileges=v;this._initPrivilegesObject();m.isDefined(v)&&this._readPrivileges(v)},stringify:function(){return w.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()})},stringifyRole:function(){return w.stringify({id:this.id,
name:this.name,description:this.description})},stringifyPrivileges:function(){return w.stringify({privileges:this._buildPrivilegesArray()})},stringifyPretty:function(){return w.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()},null,"  ")}})})},"jimu/ServiceDefinitionManager":function(){define(["dojo/_base/declare","esri/request"],function(E,q){var A=null,w=E(null,{cache:{},getServiceDefinition:function(m,v){v||(v="json");var r=this.cache[m];
0>=this._getDefStatus(r)&&(r=q({url:m,handleAs:v,content:{f:v},callbackParamName:"callback"}),this.cache[m]=r);return r},_getDefStatus:function(m){return m?m.isFulfilled()?m.isResolved()?2:-1:1:0}});w.getInstance=function(){A||(A=new w,window._serviceDefinitionManager=A);return A};return w})},"jimu/LayerNode":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Deferred","dojo/Evented"],function(E,q,A,w,m){var v=E([m],{declaredClass:"jimu.LayerNode",_layerInfo:null,map:null,
title:null,id:null,subId:null,layerObject:null,constructor:function(r){this._layerInfo=r;this.map=r.map;this.title=r.title;this.id=r.id;this.subId=r.subId},isLeaf:function(){return this._layerInfo.isLeaf()},isRoot:function(){return this._layerInfo.isRootLayer()},toggle:function(){this._layerInfo.setTopLayerVisible(!this.isToggledOn())},isToggledOn:function(){return this._layerInfo.isVisible()},show:function(){this._layerInfo.show()},hide:function(){this._layerInfo.hide()},isVisible:function(){return this._layerInfo.isShowInMap()},
traversal:function(r){return this._layerInfo.traversal(function(l){return r(l._adaptor)})},getNodeById:function(r){var l=null;if(r=this._layerInfo.findLayerInfoById(r))l=r._adaptor;return l},getExtent:function(){return this._layerInfo.getExtent()},getOpacity:function(){return this._layerInfo.getOpacity()},setOpacity:function(r){this._layerInfo.setOpacity(r)},getServiceDefinition:function(){return this._layerInfo.getServiceDefinition()},getLayerObject:function(){return this._layerInfo.getLayerObject()},
getRootNode:function(){return this._layerInfo.getRootLayerInfo()._adaptor},getParentNode:function(){var r=this._layerInfo.parentLayerInfo;return r?r._adaptor:null},getSubNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfo.getSubLayers())},getNodeLevel:function(){return this._layerInfo.getLayerLevel()},getLayerType:function(){return this._layerInfo.getLayerType()},getPopupInfoFromWebmap:function(){return this._layerInfo.getPopupInfo()},getPopupInfo:function(){return this._layerInfo.getPopupInfoFromLayerObject()},
loadPopupInfo:function(){return this._layerInfo.loadPopupInfo()},getInfoTemplate:function(){return this._layerInfo.getInfoTemplate()},loadInfoTemplate:function(){return this._layerInfo.loadInfoTemplate()},getFilterFromWebmap:function(){return this._layerInfo.getFilterOfWebmap()},getFilter:function(){return this._layerInfo.getFilter()},setFilter:function(r){this._layerInfo.setFilter(r)},isShowLegend:function(){return this.isShowLegendFromWebmap()},isShowLegendFromWebmap:function(){return this._layerInfo.getShowLegendOfWebmap()},
isToggledOnLegendFromWebMap:function(){return this._layerInfo._getShowLegendOfWebmap()},getUrl:function(){return this._layerInfo.getUrl()},getRelatedNodes:function(){var r=new w;this._layerInfo.getRelatedTableInfoArray().then(A.hitch(this,function(l){r.resolve(this._getNodesArrayFromInfosArray(l))}));return r},isVisibleAtMapScale:function(){return this._layerInfo.isInScale()},enablePopup:function(){return this._layerInfo.enablePopup()},disablePopup:function(){return this._layerInfo.disablePopup()},
isPopupEnabled:function(){return this._layerInfo.isPopupEnabled()},isItemLayer:function(){return this._layerInfo.isItemLayer()},getItemInfo:function(){return this._layerInfo.getItemInfo()},isHostedService:function(){return this._layerInfo.isHostedService()},isHostedLayer:function(){return this._layerInfo.isHostedLayer()},canShowLabel:function(){return this._layerInfo.canShowLabel()},isLabelVisble:function(){return this._layerInfo.isShowLabels()},showLabel:function(){this._layerInfo.showLabels()},
hideLabel:function(){this._layerInfo.hideLabels()},isTable:function(){return!!this._layerInfo.isTable},isTiled:function(){return!!this._layerInfo.isTiled},isBasemap:function(){return this._layerInfo.isBasemap()},isEditable:function(r){return this._layerInfo.isEditable(r)},zoomTo:function(r){return this._layerInfo.zoomTo(r)},emitEvent:function(r){try{var l=null;switch(r){case "isVisibleChanged":l=v.EVENT_TOOGLE_CHANGE;break;case "isShowInMapChanged":l=v.EVENT_VISIBILITY_CHANGE;break;case "filterChanged":l=
v.EVENT_FILTER_CHANGE;break;case "rendererChanged":l=v.EVENT_RENDERER_CHANGE;break;case "opacityChanged":l=v.EVENT_OPACITY_CHANGE;break;case "timeExtentChanged":l=v.EVENT_TIME_EXTENT_CHANGE}l&&this.emit(l)}catch(k){console.error(k)}},destroy:function(){this.inherited(arguments)},_getNodesArrayFromInfosArray:function(r){var l=[];q.forEach(r,function(k){l.push(k._adaptor)},this);return l}});A.mixin(v,{EVENT_TOOGLE_CHANGE:"toggle-change",EVENT_VISIBILITY_CHANGE:"visibility-change",EVENT_FILTER_CHANGE:"filter-change",
EVENT_RENDERER_CHANGE:"renderer-change",EVENT_OPACITY_CHANGE:"opacity-change",EVENT_TIME_EXTENT_CHANGE:"time-extent-change"});return v})},"jimu/privilegeUtils":function(){define(["dojo/Deferred","esri/IdentityManager","esri/request","jimu/tokenUtils","jimu/portalUrlUtils"],function(E,q,A,w,m){return{checkEssentialAppsLicense:function(v,r,l){var k=m.getStandardPortalUrl(r.portalUrl),n=m.getSharingUrl(k),d=new E;(l?q.checkAppAccess(n,"arcgisWebApps"):r.getItemById(v).then(function(c){return"public"===
c.access?{isPublicApp:!0}:q.checkAppAccess(n,"arcgisWebApps")})).then(function(c){r.getSigninSettingsOfSelfInfo().then(function(g){g&&g.blockedApps&&g.blockedApps.indexOf&&-1<g.blockedApps.indexOf("webappbuilder")?d.reject({message:"wab is blocked by org admin",isBlockedByOrg:!0}):d.resolve(c)},function(g){d.reject({message:g&&g.message,isBlockedByOrg:!1})})},function(c){d.reject({message:c&&c.message,isBlockedByOrg:!1})});return d},checkIsSelfOrigin:function(v,r,l){var k=!0,n=m.getPortalUrlFromLocation();
n=m.getStandardPortalUrl(n);v=m.getItemUrl(n,v);var d=window.location.host;n=w.userHaveSignInPortal(n);d=0<=["www.arcgis.com","devext.arcgis.com","qaext.arcgis.com"].indexOf(d);var c=window.location!==window.parent.location;if(r.isPortal||l||d||n||c)r=new E,r.resolve(k);else return A({url:v,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(function(g){g.contentOrigin&&"self"!==g.contentOrigin&&(k=!1);return k});return r}}})},"jimu/LayerInfos/RequestBuffer":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/Deferred"],function(E,q,A){var w=E(null,{_realRequest:null,_buffer:null,constructor:function(m){this._buffer={};this._realRequest=m?m:function(){return new A}},getRequest:function(m){this._buffer[m]||(this._buffer[m]=new w.RequestProxy(this._realRequest,m));return this._buffer[m]},request:function(m){var v=Array.prototype.slice.apply(arguments);v.splice(0,1);var r=this.getRequest(m);return r.request.apply(r,v)},setResponse:function(m,v){this.getRequest(m).setResponse(v)},isResolved:function(m){return this.getRequest(m).isResolved()}});
w.RequestProxy=E(null,{_key:null,_deferred:null,_realRequest:null,constructor:function(m,v){this._realRequest=m;this._key=v},request:function(){this._deferred||(this._deferred=new A,this._realRequest.apply(null,arguments).then(q.hitch(this,function(m){this._deferred.resolve(m)}),q.hitch(this,function(m){m&&console.warn(m.message||m);m=this._deferred;this._deferred=null;m.resolve(null)})));return this._deferred},fakeRequest:function(){this._deferred||(this._deferred=new A);return this._deferred},setResponse:function(m,
v){this._deferred||(this._deferred=new A);null===m||void 0===m?(this._deferred.resolve(null),v&&(this._deferred=null)):this._deferred.resolve(m)},isResolved:function(){return this._deferred&&this._deferred.isResolved()}});return w})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect dojo/topic ./LayerInfo esri/request esri/layers/FeatureLayer esri/lang".split(" "),function(E,q,A,w,m,v,r,l,k,n,d){return E(l,
{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,_jsapiLayerInfos:null,_oldFilter:null,_subLayerVisible:null,constructor:function(){},init:function(){this._initJsapiLayerInfos();this._initSubLayerVisible();this._initSubLayerIdent();this._initControlPopup();this.inherited(arguments);this._initAfterRootLayerInfo();this._needToRefresh().then(A.hitch(this,function(c){c&&(this.update(),this._getLayerInfosObj()._onLayersUpdated(this,this))}))},_initAfterRootLayerInfo:function(){this.traversal(function(c){!c.isRootLayer()&&
c._initAfterRootLayerInfo&&c._initAfterRootLayerInfo()})},_needToRefresh:function(){var c=new w;this.layerObject.dynamicLayerInfos&&this.isRootLayer()&&this.isItemLayer()&&!this.originOperLayer.thematicGroup?this.getItemInfo().then(A.hitch(this,function(g){(g=(g=g.getItemData())&&g.thematicGroup)?(this.originOperLayer.thematicGroup=g,c.resolve(!0)):c.resolve(!1)})):c.resolve(!1);return c},_initOldFilter:function(){this._oldFilter=this.layerObject&&this.layerObject.layerDefinitions?this.layerObject.layerDefinitions:
[]},_initJsapiLayerInfos:function(){var c=q.filter(this.originOperLayer.layers,function(g){return d.isDefined(g.id)&&d.isDefined(g.name)&&d.isDefined(g.minScale)&&d.isDefined(g.maxScale)&&d.isDefined(g.parentLayerId)&&d.isDefined(g.defaultVisibility)});this._jsapiLayerInfos=this.layerObject.dynamicLayerInfos?this.originOperLayer.thematicGroup&&this.originOperLayer.thematicGroup.layerIds&&0<=this.originOperLayer.thematicGroup.layerIds.length?q.filter(this.layerObject.dynamicLayerInfos,function(g){return-1<
this.originOperLayer.thematicGroup.layerIds.indexOf(g.id)?!0:!1},this):this.layerObject.dynamicLayerInfos:0<c.length?c:this.layerObject.layerInfos},_cloneInfoTemplates:function(c){var g={},b;for(b in c)if(c.hasOwnProperty(b)&&"function"!==typeof c[b]){var e=c[b];e.infoTemplate&&e.infoTemplate.toJson&&(g[b]={infoTemplate:new e.infoTemplate.constructor(e.infoTemplate.toJson()),layerUrl:e.layerUrl,resourceInfo:e.resourceInfo})}return g},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,
infoTemplates:this._cloneInfoTemplates(this.layerObject.infoTemplates)};this.layerObject._infoTemplates=this._cloneInfoTemplates(this.layerObject.infoTemplates);v.after(this.layerObject,"setInfoTemplates",A.hitch(this,function(){this.layerObject._infoTemplates=this._cloneInfoTemplates(this.layerObject.infoTemplates);this.controlPopupInfo.infoTemplates=this._cloneInfoTemplates(this.layerObject.infoTemplates);this.traversal(function(c){c._afterSetInfoTemplates&&c._afterSetInfoTemplates()})}))},_initSubLayerIdent:function(){this._sublayerIdent=
{definitions:{},empty:!0,defLoad:new w}},_initSubLayerVisible:function(c){this._subLayerVisible={};for(var g=0;g<this._jsapiLayerInfos.length;g++)this._subLayerVisible[this._jsapiLayerInfos[g].id]=!1;c?q.forEach(c,function(b){this._subLayerVisible[b]=!0},this):this.originOperLayer.visibleLayers?q.forEach(this.originOperLayer.visibleLayers,function(b){this._subLayerVisible[b]=!0},this):q.forEach(this._jsapiLayerInfos,function(b){b.defaultVisibility&&(this._subLayerVisible[b.id]=!0)},this)},_initVisible:function(){this._visible=
this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(c){this.originOperLayer.layerObject.setVisibility(c);this._visible=c},_setSubLayerVisible:function(c){var g=[-1,-1,-1],b=[],e=q.filter(this.originOperLayer.layerObject.visibleLayers,function(p){return-1!==p});q.forEach(e,function(p){if(!this._isGroupLayerBySubId(p)){var B=this._subLayerInfoIndex[p];B&&B._isAllSubLayerVisibleOnPath()&&b.push(p)}},this);e=b;for(var a in c)if(c.hasOwnProperty(a)&&"function"!==typeof c[a]){var f=Number(a);
if(c[a]){var h=q.indexOf(e,f);0>h&&e.push(f)}else h=q.indexOf(e,f),0<=h&&e.splice(h,1)}g=g.concat(e);this.originOperLayer.layerObject.setVisibleLayers(g)},_resetLayerObjectVisiblity:function(c){var g=c?c[this.id]:null,b=!1;if(c&&(g&&this.layerObject.setVisibility(g.visible),"esri.layers.ArcGISDynamicMapServiceLayer"===this.layerObject.declaredClass)){g={};for(var e in c)c.hasOwnProperty(e)&&"function"!==typeof c[e]&&(b=!0,g[e]=c[e].visible);b&&this._setSubLayerVisibleByCheckedInfo(g)}},_setSubLayerVisibleByCheckedInfo:function(c){var g=
[];q.forEach(this._jsapiLayerInfos,function(e){var a=this.id+"_"+e.id;d.isDefined(c[a])?c[a]&&g.push(e.id):this._subLayerVisible[e.id]&&g.push(e.id)},this);this._initSubLayerVisible(g);this.traversal(function(e){e._initVisible()});var b={};this.traversal(function(e){0!==e.getSubLayers().length||e.isRootLayer()||(b[e.originOperLayer.mapService.subId]=e._isAllSubLayerVisibleOnPath())});this._setSubLayerVisible(b)},_subLayerVisibleChanged:function(){var c=[];this.traversal(function(g){c.push(g)});r.publish("layerInfos/layerInfo/visibleChanged",
c)},obtainNewSubLayers:function(){var c=[],g=this.originOperLayer.layerObject,b=null;b="esri.layers.ArcGISDynamicMapServiceLayer"===g.declaredClass?"dynamic":"tiled";q.forEach(this._jsapiLayerInfos,function(a){this._addNewSubLayer(c,g.url+"/"+a.id,g.id+"_"+a.id,a,a.subLayerIds&&0<a.subLayerIds.length?b+"_group":b)},this);var e=[];q.forEach(this._jsapiLayerInfos,function(a,f){a=a.parentLayerId;if(-1!==a){for(var h=null,p=0;p<c.length;p++)if(c[p].mapService.subId===a){h=c[p];break}(a=h)&&a.subLayers.push(c[f])}},
this);q.forEach(this._jsapiLayerInfos,function(a,f){-1===a.parentLayerId&&(a=this._layerInfoFactory.create(c[f]),e.push(a),a.init())},this);return e},_addNewSubLayer:function(c,g,b,e,a){var f=e.source&&e.source.mapLayerId;if(void 0===f||null===f)f=e.id;var h=this.getMSShipFeatureLayer(g,e.id);c.push({layerObject:{url:g,empty:!0},title:e.name||e.id||" ",id:b||"-",subId:e.id,subLayers:[],mapService:{layerInfo:this,subId:e.id,mapServiceSubId:f},selfType:h?"mapservice_"+a+"_ship_featurelayer":"mapservice_"+
a,msShipFLayerId:h&&h.id,parentLayerInfo:this})},_handleErrorSubLayer:function(c,g,b,e,a,f){c[g]={layerObject:null,title:f.name||f.id||" ",id:b||" ",subLayers:[],mapService:{layerInfo:this,subId:e}}},getMSShipFeatureLayer:function(c,g){var b=null,e=c.indexOf("/MapServer");if(-1<e){var a=this.map.graphicsLayerIds.map(A.hitch(this,function(h){return this.map.getLayer(h)})),f=c.substring(0,e+1);a.some(A.hitch(this,function(h){var p=h.url;return p&&-1<p.indexOf(f+"FeatureServer/"+g)&&h&&!h.empty&&h.mode===
n.MODE_SELECTION&&!A.getObject("_wabProperties.isMSOwnedFeatureLayer",!1,h)?(b=h,!0):!1}))}return b},getLegendInfo:function(c){var g=new w;this._legendInfo?g.resolve(this._legendInfo):this._legendRequest(c).then(A.hitch(this,function(b){this._legendInfo=b.layers;g.resolve(this._legendInfo)}),function(){g.reject()});return g},_legendRequest:function(c){return 10.01<=this.layerObject.version?this._legendRequestServer():this._legendRequestTools(c)},_legendRequestServer:function(){var c=this.layerObject.url+
"/legend",g={f:"json"};this.layerObject._params.dynamicLayers&&(g.dynamicLayers=m.stringify(this._createDynamicLayers(this.layerObject)),"[{}]"===g.dynamicLayers&&(g.dynamicLayers="[]"));return k({url:c,content:g,handleAs:"json",callbackParamName:"callback"})},_legendRequestTools:function(c){return k({url:c+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_createDynamicLayers:function(c){var g=[],b;q.forEach(c.dynamicLayerInfos||
c.layerInfos,function(e){b={id:e.id};b.source=e.source&&e.source.toJson();var a;c.layerDefinitions&&c.layerDefinitions[e.id]&&(a=c.layerDefinitions[e.id]);a&&(b.definitionExpression=a);var f;c.layerDrawingOptions&&c.layerDrawingOptions[e.id]&&(f=c.layerDrawingOptions[e.id]);f&&(b.drawingInfo=f.toJson());b.minScale=e.minScale||0;b.maxScale=e.maxScale||0;g.push(b)});return g},_getServiceDefinition:function(){var c=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(c)},
_getSubserviceDefinition:function(c){return 10.11<=this.layerObject.version?this._getAllLayerAndTable(c):this._getLayerAndTable(c)},_getAllLayerAndTable:function(c){var g=this.layerObject.url+"/layers",b=this._serviceDefinitionBuffer.getRequest("_all_layer_and_table_request");b.isResolved()||b.request(g).then(A.hitch(this,function(e){e||(e={layers:[]});this.traversal(A.hitch(this,function(a){if(!a.isRootLayer()){var f=a.originOperLayer.mapService.mapServiceSubId;a=this._serviceDefinitionBuffer.getRequest(f);
var h=null;q.some(e.layers,function(p){if(p.id===f)return h=p,!0},this);a.setResponse(h)}}))}));return this._serviceDefinitionBuffer.getRequest(c).fakeRequest()},_getLayerAndTable:function(c){var g=this.layerObject.url+"/"+c;return this._serviceDefinitionBuffer.getRequest(c).request(g)},_getSublayerSettingOfWebmap:function(c){var g=q.filter(this.originOperLayer.layers,function(b){return b.id===c});return 1===g.length?g[0]:null},_getSublayerShowLegendOfWebmap:function(c){return(c=this._getSublayerSettingOfWebmap(c))?
void 0!==c.showLegend?c.showLegend:!0:!0},_idIsInJsapiLayerInfos:function(c){return null===this._getJsapiLayerInfoById(c)?!1:!0},_getJsapiLayerInfoById:function(c){for(var g=null,b=0;b<this._jsapiLayerInfos.length;b++)if(this._jsapiLayerInfos[b].id===c){g=this._jsapiLayerInfos[b];break}return g},_isGroupLayerBySubId:function(c){return(c=this._getJsapiLayerInfoById(c))&&c.subLayerIds&&0<c.subLayerIds.length?!0:!1},_bindEvent:function(){this.inherited(arguments);if(this.layerObject&&!this.layerObject.empty){var c=
this.layerObject.on("visible-layers-change",A.hitch(this,this._onVisibleLayersChanged));this._eventHandles.push(c);c=v.after(this.layerObject,"setLayerDefinitions",A.hitch(this,this._onFilterChanged));this._eventHandles.push(c)}},_onVisibleLayersChanged:function(c){var g=c.visibleLayers;if(-1===g[0]&&-1===g[1]&&-1===g[2])this._subLayerVisibleChanged(),this._isShowInMapChanged2();else{c=[];var b=[-1,-1,-1];g=this._converVisibleLayers(g);c=g.visibleLayersForUpdateSubLayerVisible;b=b.concat(g.visibleLayersForSetVisibleLayers);
this._initSubLayerVisible(c);this.traversal(function(e){e._initVisible()});this.layerObject.setVisibleLayers(b)}},_converVisibleLayers:function(c){var g={visibleLayersForUpdateSubLayerVisible:[],visibleLayersForSetVisibleLayers:[]};q.forEach(c,function(b){var e=this.findLayerInfoById(this.id+"_"+b);if(this._isGroupLayerBySubId(b))e.traversal(function(a){c.push(a.originOperLayer.mapService.subId)});else for(;e&&e.originOperLayer.mapService;)c.push(e.originOperLayer.mapService.subId),e=e.parentLayerInfo},
this);q.forEach(c,function(b){0<=b&&0>g.visibleLayersForUpdateSubLayerVisible.indexOf(b)&&g.visibleLayersForUpdateSubLayerVisible.push(b)},this);q.forEach(g.visibleLayersForUpdateSubLayerVisible,function(b){this._isGroupLayerBySubId(b)||g.visibleLayersForSetVisibleLayers.push(b)},this);return g},_onFilterChanged:function(){for(var c,g=[],b=this.layerObject.layerDefinitions,e=b.length>this._oldFilter.length?b.length:this._oldFilter.length,a=0;a<e;a++)(b[a]?b[a]:null)!==(this._oldFilter[a]?this._oldFilter[a]:
null)&&(c=this.findLayerInfoById(this.id+"_"+a))&&c.isLeaf()&&g.push(c);0<g.length&&(r.publish("layerInfos/layerInfo/filterChanged",g,A.getObject("_wabProperties.objectPassWithFilterChangeEvent",!0,this.layerObject)),this._oldFilter=b,A.setObject("_wabProperties.objectPassWithFilterChangeEvent",{},this.layerObject))}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect dojo/topic ./LayerInfo ./LayerInfoForDefault jimu/utils dojo/Deferred esri/lang".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d){return E(r,{constructor:function(){},_getExtentAsync:function(){var c=this.layerObject.getLayers(),g=null,b=null;if(0<c.length&&"esri.layers.KMLLayer"===c[0].declaredClass){var e=[];this.traversal(A.hitch(this,function(a){a.id!==this.id&&"esri.layers.KMLLayer"===a.layerObject.declaredClass&&e.push(a)}));q.forEach(e,function(a){b=a._getExtentAsync();g=g?g.union(b):b},this)}else q.forEach(c,function(a){b=k.graphicsExtent(a.graphics);g=g?g.union(b):b},this);return g},
_getExtent:function(){var c=new n;c.resolve(this._getExtentAsync());return c},_resetLayerObjectVisiblity:function(c){var g=c?c[this.id]:null;if(g){var b={},e;for(e in c)c.hasOwnProperty(e)&&"function"!==typeof c[e]&&(b[e]=c[e].visible);this._setSubLayerVisibleByCheckedInfo(b);this._setTopLayerVisible(g.visible)}},_setSubLayerVisibleByCheckedInfo:function(c){this.traversal(A.hitch(this,function(g){d.isDefined(c[g.id])&&g._setTopLayerVisible(c[g.id])}))},_initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},
_setTopLayerVisible:function(c){c?this.layerObject.show():this.layerObject.hide()},obtainNewSubLayers:function(){var c=[];q.forEach(this._getOperLayerByParentFolderId(-1,this),function(g){g=this._layerInfoFactory.create(g);c.push(g);g.init()},this);return c},_getOperLayerByParentFolderId:function(c,g){var b=[],e=this.layerObject.getLayers()||[],a=q.filter(this.layerObject.folders||[],function(h){return h.parentFolderId===c?!0:!1}),f=[];f=0===a.length?q.filter(e,function(h){return this._flag.kmzSubLayersWereHandled?
!1:!0},this):a;q.forEach(f,function(h){if("esri.layers.KMLFolder"===h.declaredClass)var p={layerObject:h,title:h.label||h.title||h.name||"\x26lt;no name\x26gt;",id:this._getSubLayerInfoIdForSubFolder(h),subId:h.id,kml:{layerInfo:this,currentFolder:h},selfType:"kml",parentLayerInfo:g};else"esri.layers.KMLLayer"===h.declaredClass?(p=A.getObject("linkInfo.name",!1,h),p={layerObject:h,title:h.label||h.title||p||h.name||h.id||" ",id:h.id||"-",subId:h.id||"-",kml:{layerInfo:this,currentFolder:null},selfType:"kml",
parentLayerInfo:g},A.setObject("_wabProperties.kmllayerWasHandled",!0,h),this._flag.kmzSubLayersWereHandled=!0):(A.setObject("_wabProperties.kmllayerWasHandled",!0,h),A.setObject("_wabProperties.isTemporaryLayer",!0,h));p&&b.push(p)},this);return b},_getAllSubLayerObject:function(){var c=[];this.traversal(A.hitch(this,function(g){g.layerObject&&g.layerObject.getLayers&&(c=c.concat(g.layerObject.getLayers()))}));return c},_getSubLayerInfoIdForSubFolder:function(c){return this.id+"_folder_"+c.id},_needToRenew:function(){return q.some(this._getAllSubLayerObject(),
function(c){if(!A.getObject("_wabProperties.kmllayerWasHandled",!1,c))return!0},this)},_bindEvent:function(){this.inherited(arguments);if(this.layerObject&&!this.layerObject.empty){var c=m.after(this.layerObject,"setFolderVisibility",A.hitch(this,this._onSubFolderVisibleChanged),!0);this._eventHandles.push(c)}},_onSubFolderVisibleChanged:function(c){c=this._getSubLayerInfoIdForSubFolder(c);(c=this.findLayerInfoById(c))&&v.publish("layerInfos/layerInfo/visibleChanged",[c])}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all ./LayerInfo dojox/gfx dojo/dom-construct dojo/dom-attr dojo/dom-class dojo/aspect jimu/portalUrlUtils jimu/portalUtils jimu/utils esri/symbols/jsonUtils esri/layers/LabelLayer esri/layers/LabelClass esri/dijit/PopupTemplate esri/dijit/Legend esri/graphic esri/geometry/Point esri/tasks/query esri/tasks/RelationshipQuery esri/tasks/QueryTask".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u,t,z,x){return E(v,{_legendsNode:null,controlPopupInfo:null,constructor:function(){this._initControlPopup();this._updateLayerObjectName();try{this._initToShowLabels()}catch(y){console.warn(y.message)}},_updateLayerObjectName:function(){if(this.layerObject&&!this.layerObject.empty&&this.layerObject.name&&!A.getObject("_wabProperties.originalLayerName",!1,this.layerObject)){A.setObject("_wabProperties.originalLayerName",this.layerObject.name,this.layerObject);
this.layerObject.name=this.title;if(void 0===this.layerObject.arcgisProps||null===this.layerObject.arcgisProps)this.layerObject.arcgisProps={};A.setObject("arcgisProps.title",this.title,this.layerObject)}},_initToShowLabels:function(){var y=A.getObject("_wabProperties.itemLayerInfo",!1,this.layerObject);y&&!this.layerObject.empty&&g.getPortal(y.portalUrl).getItemData(y.itemId).then(A.hitch(this,function(D){var H;D&&D.layers&&(q.some(D.layers,function(I){return I.id===this.layerObject.layerId?(H=I,
!0):!1},this),H&&H.showLabels&&((D=A.getObject("layerDefinition.drawingInfo.labelingInfo",!1,H))&&!this.layerObject.labelingInfo&&this.layerObject.setLabelingInfo&&(D=q.map(D,function(I){return new f(I)},this),this.layerObject.setLabelingInfo(D)),this.showLabels()))}),A.hitch(this,function(D){D&&D.message&&console.log(D.message)}))},_initOldFilter:function(){this._oldFilter=this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():
null},_getLayerOptionsForCreateLayerObject:function(){var y={};y.id=this.id;var D=[],H=this.getInfoTemplate();H&&H.info&&H.info.fieldInfos?q.forEach(H.info.fieldInfos,function(I){I.visible&&D.push(I.fieldName)},this):D=["*"];y.outFields=D;return y},_getExtent:function(){var y=new w;var D=this.layerObject.graphics&&0<this.layerObject.graphics.length?b.graphicsExtent(this.layerObject.graphics):this.layerObject.fullExtent||this.layerObject.initialExtent;this.layerObject.url?this.getServiceDefinition().then(A.hitch(this,
function(H){var I=new x(this.layerObject.url),N=new t,S=this.getFilter();N.where=S?S:"1\x3d1";N.outSpatialReference=this.map.spatialReference;N.returnGeometry=!0;H&&H.advancedQueryCapabilities&&H.advancedQueryCapabilities.supportsReturningQueryExtent?I.executeForExtent(N,A.hitch(this,function(M){var Q=M.extent;1===M.count&&"esriGeometryPoint"===this.layerObject.geometryType&&(M=new u(M.extent.xmin,M.extent.ymin,M.extent.spatialReference),Q=b.graphicsExtent([new B(M)]));y.resolve(Q)}),A.hitch(this,
function(){y.resolve(D);console.log("executeForExtent failed.")})):this.getSupportTableInfo().then(A.hitch(this,function(M){M.isSupportQuery?I.execute(N).then(A.hitch(this,function(Q){Q=b.graphicsExtent(Q.features);y.resolve(Q)}),A.hitch(this,function(){y.resolve(D);console.log("query execute failed.")})):y.resolve(D)}))})):y.resolve(D);return y},_resetLayerObjectVisiblity:function(y){y=y?y[this.id]:null;!this.originOperLayer.collection&&y&&(this.layerObject.setVisibility(y.visible),this._visible=
this.layerObject.visible)},_initVisible:function(){var y=!1;if(this.originOperLayer.collection&&this._notFirstInitVisilbeFlag){y=this.originOperLayer.collection.layerInfo;var D=this.layerObject.visible;if(y._oldIsShowInMap!==y.isShowInMap())return;this._visible=D?!0:!1;y._onVisibilityChanged()}else this._visible=y=this.originOperLayer.layerObject.visible;this._notFirstInitVisilbeFlag=!0},_setTopLayerVisible:function(y){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?
y?(this.layerObject.show(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):y?(this.layerObject.hide(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):(y?this.layerObject.show():this.layerObject.hide(),this._visible=y)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?this._visible&&this.layerObject.show():this.layerObject.hide()},_prepareCheckedInfoForShowOrHide:function(y){for(var D={},H=this;H.parentLayerInfo;)D[H.id]=y,H=H.parentLayerInfo;
return D},show:function(){if(this.isRootLayer())this._setTopLayerVisible(!0);else{var y=this.getRootLayerInfo();if(y._setSubLayerVisibleByCheckedInfo){var D=this._prepareCheckedInfoForShowOrHide(!0);y._setSubLayerVisibleByCheckedInfo(D);y.show()}}},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;var y=d.after(this.layerObject,"setInfoTemplate",
A.hitch(this,function(){this.layerObject._infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||(this.layerObject.infoTemplate=null)}));this._eventHandles.push(y)},_getServiceDefinition:function(){var y;(y=this.getUrl())&&this.isRootLayer()&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass?y=this._serviceDefinitionBuffer.getRequest(this.subId).request(y):(y=new w,y.resolve(null));return y},createLegendsNode:function(){var y=
l.create("div",{"class":"legends-div jimu-legends-div-flag jimu-leading-margin1",legendsDivId:this.id},document.body);l.create("img",{"class":"legends-loading-img",src:require.toUrl("jimu")+"/images/loading.gif"},y);return y},drawLegends:function(y){this._initLegendsNodeByLegendDijit(y)},_initLegendsNodeByLegendDijit:function(y){if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&this.layerObject.loaded){l.empty(y);n.remove(y,
"jimu-legends-div-flag");var D=new p({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:p.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},l.create("div",{},y));D.startup();y._legendDijit=D}},_initLegendsNode:function(y){var D=[],H=this.layerObject;!this.layerObject||this.layerObject.empty||this.originOperLayer.subLayer&&0!==this.originOperLayer.subLayers.length||(l.empty(y),H.renderer&&(H.renderer.infos?D=A.clone(H.renderer.infos):D.push({label:H.renderer.label,symbol:H.renderer.symbol}),
H.renderer&&H.renderer.defaultSymbol&&0<D.length&&D.push({label:H.renderer.defaultLabel||"others",symbol:H.renderer.defaultSymbol}),q.forEach(D,function(I){I.legendDiv=l.create("div",{"class":"legend-div"},y);I.symbolDiv=l.create("div",{"class":"legend-symbol jimu-float-leading"},I.legendDiv);I.labelDiv=l.create("div",{"class":"legend-label jimu-float-leading",innerHTML:b.sanitizeHTML(I.label)||" "},I.legendDiv);if("textsymbol"===I.symbol.type)k.set(I.symbolDiv,"innerHTML",b.sanitizeHTML(I.symbol.text));
else{var N=r.createSurface(I.symbolDiv,50,50);I=e.getShapeDescriptors(I.symbol);N.createShape(I.defaultShape).setFill(I.fill).setStroke(I.stroke).setTransform(r.matrix.translate(25,25))}},this)))},obtainNewSubLayers:function(){var y=[];q.forEach(this.originOperLayer.subLayers,function(D){D.parentLayerInfo=this;D=this._layerInfoFactory.create(D);y.push(D);D.init()},this);return y},_isAllSubLayerVisibleOnPath:function(){for(var y=!0,D=this;!D.isRootLayer();)y=y&&D.isVisible(),D=D.parentLayerInfo;return y},
_getCustomPopupInfo:function(y,D){var H=null;y&&y.fields&&(H={title:y.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},q.forEach(y.fields,function(I){var N=!1;D?q.some(D,A.hitch(this,function(S){return S&&I.name.toLowerCase()===S.toLowerCase()}))&&(N=!0):N=!0;N&&(N=b.getDefaultPortalFieldInfo(I),N.visible=!0,N.isEditable=I.editable,H.fieldInfos.push(N))},this));return H},_getDefaultPopupInfo:function(y){if(y=this._getCustomPopupInfo(y))y.fieldInfos=q.filter(y.fieldInfos,A.hitch(this,
function(D){return(D=D.fieldName&&D.fieldName.toLowerCase())&&0>D.indexOf("object")&&0>D.indexOf("globalid")&&0>D.indexOf("shape")&&0>D.indexOf("perimeter")?!0:!1}));return y},_getDefaultPopupTemplate:function(y){var D=null;(y=this.getPopupInfo()||this._getDefaultPopupInfo(y))&&(D=new h(y));return D},enablePopup:function(){return this.loadInfoTemplate().then(A.hitch(this,function(){return this.controlPopupInfo.infoTemplate?(this.controlPopupInfo.enablePopup=!0,this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate,
!0):!1}))},disablePopup:function(){this.controlPopupInfo.enablePopup=!1;this.layerObject.infoTemplate=null},isPopupEnabled:function(){return this.controlPopupInfo&&this.controlPopupInfo.enablePopup?!0:!1},isSupportPopup:function(){var y=new w;this.loadInfoTemplate().then(A.hitch(this,function(D){D?y.resolve(!0):y.resolve(!1)}));return y},loadInfoTemplate:function(){var y=new w;this.controlPopupInfo.infoTemplate?y.resolve(this.controlPopupInfo.infoTemplate):this.getLayerObject().then(A.hitch(this,
function(){this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject);y.resolve(this.controlPopupInfo.infoTemplate)}),A.hitch(this,function(){y.resolve(null)}));return y},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate},_getRelatedUrls:function(y,D){var H=[];if(!y||!y.url||!y.relationships)return H;var I=y.url.lastIndexOf("/"),N=y.url.slice(0,I);q.forEach(y.relationships,function(S){D&&S.role&&"esriRelCardinalityManyToMany"!==S.cardinality&&D!==S.role||
H.push(N+"/"+S.relatedTableId.toString())},this);return H},getRelatedTableInfoArray:function(y){var D=[],H=new w;this.getLayerObject().then(A.hitch(this,function(I){var N=this._getRelatedUrls(I,y);0!==N.length&&this._getLayerInfosObj().traversalAll(A.hitch(this,function(S){if(0===N.length)return!0;q.forEach(N,function(M,Q){A.getObject("layerObject.url",!1,S)&&M&&c.removeProtocol(M.toString().toLowerCase()).replace(/\/+/g,"/")===c.removeProtocol(S.layerObject.url.toString().toLowerCase()).replace(/\/+/g,
"/")&&(D.push(S),N[Q]="")},this);return!1}));H.resolve(D)}),A.hitch(this,function(){H.resolve(D)}));return H},_getOrderByFields:function(y){var D=null;if(void 0===y||null===y)return D;var H=this.getPopupInfo();H&&H.relatedRecordsInfo&&H.relatedRecordsInfo.orderByFields&&q.some(H.relatedRecordsInfo.orderByFields,function(I){var N=I.field.split("/");if(N[1]===y.toString())return D=[N[2]+" "+I.order],!0},this);return D},getOriRelationshipByDestLayer:function(y,D,H){var I=null;y=q.filter(y.relationships,
function(N){if(N.relatedTableId===D.layerId)return!0},this);return I=y[H]?y[H]:y[0]},getRelatedRecords:function(y,D,H){var I=new w,N=new z,S=this.getLayerObject(),M=D.getLayerObject();m({originalLayerObject:S,relatedLayerObject:M}).then(A.hitch(this,function(Q){Q.originalLayerObject&&Q.relatedLayerObject||I.resolve([]);Q=this.getOriRelationshipByDestLayer(this.layerObject,Q.relatedLayerObject,H);N.outFields=["*"];N.relationshipId=Q&&Q.id;var da=y.attributes[this.layerObject.objectIdField];N.objectIds=
[da];N.definitionExpression=D.getFilter();N.orderByFields=this._getOrderByFields(Q&&Q.id);this.layerObject.queryRelatedFeatures(N,A.hitch(this,function(J){(J=J[da]&&J[da].features)?I.resolve(J):I.resolve([])}),A.hitch(this,function(){I.resolve([])}))}));return I},getFilter:function(){return this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},setFilter:function(y,D){this.layerObject&&!this.layerObject.empty&&this.layerObject.setDefinitionExpression&&
(D=A.mixin({},D),A.setObject("_wabProperties.objectPassWithFilterChangeEvent",D,this.layerObject),this.layerObject.setDefinitionExpression(y))},_isAlreadyInLabelLayerOfMap:function(y){var D=!1;y&&(D=q.some(y.getFeatureLayers(),function(H){return this.id===H.id},this));return D},_addToLabelLayerOfMap:function(){var y=this.getLabelLayerOfMap();y&&!this._isAlreadyInLabelLayerOfMap(y)&&(y.addFeatureLayer(this.layerObject),this.map.removeLayer(y),this.map.addLayer(y))},_removeFromLabelLayerOfMap:function(){this.getLabelLayerOfMap().removeFeatureLayer(this.id)},
_isSupportLabelControl:function(){return this.isRootLayer()&&!this.layerObject.empty&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass&&this.layerObject.labelingInfo&&0<this.layerObject.labelingInfo.length?!0:!1},getLabelLayerOfMap:function(){if(this.map._labels)var y=this.map._labels;else y=this.map.getLayer("labels"),y||(y=new a({id:"labels"}),this.map.addLayer(y));return y},obtainLabelControl:function(){var y=this.id+"_labelLayer",D=this.map.getLayer(y);if(!D&&this._isSupportLabelControl()){var H=
this.getLabelLayerOfMap();H&&this._isAlreadyInLabelLayerOfMap(H)&&(D=new a({id:y}),D.addFeatureLayer(this.layerObject),this.map.addLayer(D),this._removeFromLabelLayerOfMap())}return D?D:null},restoreLabelControl:function(){this._isSupportLabelControl()&&(this.destroyRealtedLabelLayer(),this._addToLabelLayerOfMap())},destroyRealtedLabelLayer:function(){var y=this.map.getLayer(this.id+"_labelLayer");y&&this.map.removeLayer(y)},destroyLabelLayer:function(){this.map.getLayer(this.id)||(this._removeFromLabelLayerOfMap(),
this.destroyRealtedLabelLayer())},canShowLabel:function(){return this._isSupportLabelControl()},isShowLabels:function(){var y=this.map.getLayer(this.id+"_labelLayer"),D=this.getLabelLayerOfMap();return this._isSupportLabelControl()&&(y||D&&this._isAlreadyInLabelLayerOfMap(D))?this.layerObject.showLabels:!1},showLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&(this.map.getLayer(this.id+"_labelLayer")||this._addToLabelLayerOfMap(),this.layerObject.setShowLabels(!0))},
hideLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&this.layerObject.setShowLabels(!1)}})})},"esri/layers/LabelLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/i18n!dojo/cldr/nls/number dojo/number dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ../ArcadeExpression ../core/timerUtils ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ../renderers/SimpleRenderer ../arcadeProfiles/labelingProfile ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ./GraphicsLayer ./LabelClass".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u,t,z,x,y){function D(H){return"sizeInfo"===H.type}E=E(x,{declaredClass:"esri.layers.LabelLayer",constructor:function(H){this._refreshLabels=q.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];H&&(H.id&&(this.id=H.id),H.mode&&(this._engineType="DYNAMIC"===H.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(H){this._mapEventHandlers.push(H.on("extent-change",
q.hitch(this,"_handleLevelChange")));var I=this.inherited(arguments);this.refresh();return I},_unsetMap:function(){var H;for(H=0;H<this._mapEventHandlers.length;H++)w.disconnect(this._mapEventHandlers[H]);this.refresh();b.clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(H){this._engineType=H&&"DYNAMIC"===H.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(H,I,N,S){if(!this.getFeatureLayer(H.layerId)){var M=[];M.push(H.on("update-end",
q.hitch(this,"refresh")));M.push(H.on("suspend",q.hitch(this,"refresh")));M.push(H.on("resume",q.hitch(this,"refresh")));M.push(H.on("edits-complete",q.hitch(this,"refresh")));M.push(H.on("labeling-info-change",q.hitch(this,"refresh")));M.push(H.on("time-extent-change",q.hitch(this,"refresh")));M.push(H.on("show-labels-change",q.hitch(this,"refresh")));M.push(H.on("feature-reduction-change",q.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:H,LabelExpressionInfo:N,LabelingOptions:S,
LabelRenderer:I,EventHandlers:M});this.featureLayers.push(H);this.refresh()}},getFeatureLayer:function(H){var I;for(I=0;I<this.featureLayers.length;I++){var N=this.featureLayers[I];if(void 0!==N&&N.id==H)return N}return null},removeFeatureLayer:function(H){H=this.getFeatureLayer(H);if(void 0!==H){var I=A.indexOf(this.featureLayers,H);if(-1<I){this.featureLayers.splice(I,1);for(H=0;H<this._featureLayerInfos[I].EventHandlers.length;H++)w.disconnect(this._featureLayerInfos[I].EventHandlers[H]);this._featureLayerInfos.splice(I,
1);this.refresh()}}},removeAllFeatureLayers:function(){var H;for(H=0;H<this.featureLayers.length;H++){for(var I=0;I<this._featureLayerInfos[H].EventHandlers.length;I++)w.disconnect(this._featureLayerInfos[H].EventHandlers[I]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(H){var I;for(I=0;I<this.featureLayers.length;I++){var N=this.featureLayers[I];if(void 0!==N&&N.id==H)return this._featureLayerInfos[I]}return null},
refresh:function(){null==this._refreshHandle&&(this._refreshHandle=b.setTimeout(this._refreshLabels,b.priority.LOW))},_handleLevelChange:function(H){H.levelChange&&this.clear();this.refresh()},_refreshLabels:function(H){this._refreshHandle=null;var I=[],N,S="DYNAMIC"===this._engineType?new t:new z;if(this._map){S.setMap(this._map,this);this._preparedLabels=[];for(H=0;H<this.featureLayers.length;H++){var M=this.featureLayers[H];if(M.visible&&M.showLabels&&M.visibleAtMapScale&&!M._suspended){var Q=
this._featureLayerInfos[H];var da=this._convertOptions(null);if(Q.LabelRenderer){if(I=M.labelingInfo)if(N=I[0]){var J=this._getLabelExpression(N);da=this._convertOptions(N)}var R=Q.LabelRenderer;Q.LabelExpressionInfo&&(J=Q.LabelExpressionInfo);Q.LabelingOptions&&(da=this._convertOptions(null),void 0!==Q.LabelingOptions.pointPriorities&&(I=Q.LabelingOptions.pointPriorities,da.pointPriorities="above-center"==I||"AboveCenter"==I||"esriServerPointLabelPlacementAboveCenter"==I?"AboveCenter":"above-left"==
I||"AboveLeft"==I||"esriServerPointLabelPlacementAboveLeft"==I?"AboveLeft":"above-right"==I||"AboveRight"==I||"esriServerPointLabelPlacementAboveRight"==I?"AboveRight":"below-center"==I||"BelowCenter"==I||"esriServerPointLabelPlacementBelowCenter"==I?"BelowCenter":"below-left"==I||"BelowLeft"==I||"esriServerPointLabelPlacementBelowLeft"==I?"BelowLeft":"below-right"==I||"BelowRight"==I||"esriServerPointLabelPlacementBelowRight"==I?"BelowRight":"center-center"==I||"CenterCenter"==I||"esriServerPointLabelPlacementCenterCenter"==
I?"CenterCenter":"center-left"==I||"CenterLeft"==I||"esriServerPointLabelPlacementCenterLeft"==I?"CenterLeft":"center-right"==I||"CenterRight"==I||"esriServerPointLabelPlacementCenterRight"==I?"CenterRight":"AboveRight"),void 0!==Q.LabelingOptions.lineLabelPlacement&&(da.lineLabelPlacement=Q.LabelingOptions.lineLabelPlacement),void 0!==Q.LabelingOptions.lineLabelPosition&&(da.lineLabelPosition=Q.LabelingOptions.lineLabelPosition),void 0!==Q.LabelingOptions.labelRotation&&(da.labelRotation=Q.LabelingOptions.labelRotation),
void 0!==Q.LabelingOptions.howManyLabels&&(da.howManyLabels=Q.LabelingOptions.howManyLabels));R instanceof y&&(J=this._getLabelExpression(R),R=new B(R.symbol),da=this._convertOptions(R));this._addLabels(M,R,J,da)}else if(I=M.labelingInfo)for(Q=I.length-1;0<=Q;Q--)if(N=I[Q])R=new y(N instanceof y?N.toJson():N),J=this._getLabelExpression(N),da=this._convertOptions(N),this._addLabels(M,R,J,da)}}J=S._process(this._preparedLabels);this.clear();this.drawLabels(this._map,J)}},drawLabels:function(H,I){this._scale=
(H.extent.xmax-H.extent.xmin)/H.width;var N;for(N=0;N<I.length;N++){var S=I[N],M=S.x,Q=S.y,da=S.text,J=S.angle,R=S.layer.labelSymbol;"polyline"==S.layer.geometry.type&&S.layer.options.labelRotation&&R.setAngle(180/Math.PI*J);R.setText(da);R instanceof e&&(da=R.getHeight(),M-=.25*da*this._scale*Math.sin(J),Q-=.33*da*this._scale);J=new d(new h(M,Q,H.extent.spatialReference));J.setParentGraphic(S.layer.graphic);J.setSymbol(R);this.add(J)}},_addLabels:function(H,I,N,S){var M;if(this._isWithinScaleRange(I.minScale,
I.maxScale)&&N&&""!==N){var Q=this._map,da=!H.url&&!Q.spatialReference.equals(H.spatialReference);for(M=0;M<H.graphics.length;M++){var J=H.graphics[M];if(!1!==J.visible&&!J._suspended){var R=J.geometry;if(da){if(!p.canProject(R,Q))continue;R=p.project(R,Q)}if(R&&this._isWhere(I.where,J.attributes)&&this._isWithinScreenArea(R)){var W=this._buildLabelText(N,J,H.fields,S);this._addLabel(W,I,H.renderer,J,S,R,Q)}}}}},_isWithinScreenArea:function(H){H="point"===H.type?new f(H.x,H.y,H.x,H.y,H.spatialReference):
H.getExtent();if(void 0===H)return!1;H=this._intersects(this._map,H);return null===H||0===H.length?!1:!0},_isWithinScaleRange:function(H,I){var N=this._map.getScale();return 0<H&&N>=H||0<I&&N<I?!1:!0},_isWhere:function(H,I){try{if(!H)return!0;if(H){var N=H.split(" ");if(3===N.length)return this._sqlEquation(I[this._removeQuotes(N[0])],N[1],this._removeQuotes(N[2]));if(7===N.length){var S=this._sqlEquation(I[this._removeQuotes(N[0])],N[1],this._removeQuotes(N[2])),M=N[3],Q=this._sqlEquation(I[this._removeQuotes(N[4])],
N[5],this._removeQuotes(N[6]));switch(M){case "AND":return S&&Q;case "OR":return S||Q}}}return!1}catch(da){console.log("Error.: can't parse \x3d "+H)}},_sqlEquation:function(H,I,N){switch(I){case "\x3d":return H==N?!0:!1;case "\x3c\x3e":return H!=N?!0:!1;case "\x3e":return H>N?!0:!1;case "\x3e\x3d":return H>=N?!0:!1;case "\x3c":return H<N?!0:!1;case "\x3c\x3d":return H<=N?!0:!1}return!1},_removeQuotes:function(H){var I=H.indexOf('"'),N=H.lastIndexOf('"');if(-1!=I&&-1!=N)return H.substr(1,H.length-
2);I=H.indexOf("'");N=H.lastIndexOf("'");return-1!=I&&-1!=N?H.substr(1,H.length-2):H},_getSizeInfo:function(H){return H?H.sizeInfo||A.filter(H.visualVariables,D)[0]:null},_addLabel:function(H,I,N,S,M,Q,da){var J;if(H&&""!==q.trim(H)&&I){H=H.replace(/[\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/g," ");var R=I.getSymbol(S);R instanceof e?(R=new e(R.toJson()),R.setVerticalAlignment("baseline"),R.setHorizontalAlignment("center")):R=R instanceof a?new a(R.toJson()):new e;
R.setText(H);I.symbol=R;if(J=this._getProportionalSize(I.sizeInfo,S.attributes))R instanceof e?R.setSize(J):R instanceof a&&(R.setWidth(J),R.setHeight(J));var W=J=0;if(N){var X=N.getSymbol(S);var ia=this._getSizeInfo(N);if((N=ia?N.getSize(S,{sizeInfo:ia,resolution:da.getResolutionInMeters()}):S.size)&&null!==N)J=W=N;else if(X)if("simplemarkersymbol"==X.type)W=J=X.size;else if("picturemarkersymbol"==X.type)J=X.width,W=X.height;else if("simplelinesymbol"==X.type||"cartographiclinesymbol"==X.type)J=
X.width}N={};N.graphic=S;N.options=M;N.geometry=Q;N.labelRenderer=I;N.labelSymbol=R;N.labelWidth=R.getWidth()/2;N.labelHeight=R.getHeight()/2;N.symbolWidth=l.normalizedLength(J)/2;N.symbolHeight=l.normalizedLength(W)/2;N.text=H;N.angle=R.angle;this._preparedLabels.push(N)}},_buildLabelText:function(H,I,N,S){if(S.hasExpression)return H=u.getEvalOptions({expression:S.arcadeExpr,feature:I,layer:I.getLayer(),spatialReference:this._map.spatialReference}),I=I.evaluateExpression(S.arcadeExpr,H),n.isDefined(I)?
""+I:"";var M=I.attributes;return H.replace(/{[^}]*}/g,function(Q){var da,J=Q;for(da=0;da<N.length;da++)if("{"+N[da].name+"}"==Q){J=M[N[da].name];var R=N[da].domain;if(R&&q.isObject(R)){if("codedValue"==R.type&&S.useCodedValues)for(da=J,Q=0;Q<R.codedValues.length;Q++)if(R.codedValues[Q].code==da){J=R.codedValues[Q].name;break}break}R=N[da].type;if(S.fieldInfos){var W=S.fieldInfos;for(da=0;da<W.length;da++)if("{"+W[da].fieldName+"}"==Q){Q=W[da].format;"esriFieldTypeDate"==R?J=n.substitute({myKey:J},
"${myKey}",{format:{myKey:q.mixin({formatType:"DateFormat"},c.prototype._dateFormatsJson[Q&&Q.dateFormat||"shortDate"])}}):"esriFieldTypeInteger"!=R&&"esriFieldTypeSingle"!=R&&"esriFieldTypeSmallInteger"!=R&&"esriFieldTypeLong"!=R&&"esriFieldTypeDouble"!=R||!Q||(J=v.format(J,{places:Q.places}),Q.digitSeparator||m.group&&(J=J.replace(new RegExp("\\"+m.group,"g"),"")));break}}break}else J="";return null==J?"":J})},_getLabelExpression:function(H){var I="";H.labelExpressionInfo?I=H.labelExpressionInfo.value||
H.labelExpressionInfo.expression:this._validSyntax(H.labelExpression)&&(I=this._convertLabelExpression(H.labelExpression));return I},_validSyntax:function(H){return/^(\s*\[[^\]]+\]\s*)+$/i.test(H)},_convertLabelExpression:function(H){return H.replace(RegExp("\\[","g"),"{").replace(RegExp("\\]","g"),"}")},_getProportionalSize:function(H,I){if(!H)return null;I=n.substitute(I,"${"+H.field+"}",{first:!0});return!(H.minSize&&H.maxSize&&H.minDataValue&&H.maxDataValue&&I)||0>=H.maxDataValue-H.minDataValue?
null:(H.maxSize-H.minSize)/(H.maxDataValue-H.minDataValue)*(I-H.minDataValue)+H.minSize},_convertOptions:function(H){var I=!0,N="shortDate",S=null,M=null,Q="",da=!0;if(H&&(H.format&&(N=H.format.dateFormat,S={places:H.format.places,digitSeparator:H.format.digitSeparator}),M=H.fieldInfos,Q=H.labelPlacement,null!=H.useCodedValues&&(I=H.useCodedValues),H=H.labelExpressionInfo)){var J=H.expression;if(J&&!H.value){var R=!0;var W=new g({expression:J,returnType:"string",profile:u})}}if("always-horizontal"==
Q||"esriServerPolygonPlacementAlwaysHorizontal"==Q)da=!1;return{useCodedValues:I,dateFormat:N,numberFormat:S,fieldInfos:M,pointPriorities:"above-center"==Q||"esriServerPointLabelPlacementAboveCenter"==Q?"AboveCenter":"above-left"==Q||"esriServerPointLabelPlacementAboveLeft"==Q?"AboveLeft":"above-right"==Q||"esriServerPointLabelPlacementAboveRight"==Q?"AboveRight":"below-center"==Q||"esriServerPointLabelPlacementBelowCenter"==Q?"BelowCenter":"below-left"==Q||"esriServerPointLabelPlacementBelowLeft"==
Q?"BelowLeft":"below-right"==Q||"esriServerPointLabelPlacementBelowRight"==Q?"BelowRight":"center-center"==Q||"esriServerPointLabelPlacementCenterCenter"==Q?"CenterCenter":"center-left"==Q||"esriServerPointLabelPlacementCenterLeft"==Q?"CenterLeft":"center-right"==Q||"esriServerPointLabelPlacementCenterRight"==Q?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==Q||"below-start"==Q||"center-start"==Q?"PlaceAtStart":"above-end"==Q||"below-end"==Q||"center-end"==Q?"PlaceAtEnd":"PlaceAtCenter",
lineLabelPosition:"above-after"==Q||"esriServerLinePlacementAboveAfter"==Q||"above-along"==Q||"esriServerLinePlacementAboveAlong"==Q||"above-before"==Q||"esriServerLinePlacementAboveBefore"==Q||"above-start"==Q||"esriServerLinePlacementAboveStart"==Q||"above-end"==Q||"esriServerLinePlacementAboveEnd"==Q?"Above":"below-after"==Q||"esriServerLinePlacementBelowAfter"==Q||"below-along"==Q||"esriServerLinePlacementBelowAlong"==Q||"below-before"==Q||"esriServerLinePlacementBelowBefore"==Q||"below-start"==
Q||"esriServerLinePlacementBelowStart"==Q||"below-end"==Q||"esriServerLinePlacementBelowEnd"==Q?"Below":"center-after"==Q||"esriServerLinePlacementCenterAfter"==Q||"center-along"==Q||"esriServerLinePlacementCenterAlong"==Q||"center-before"==Q||"esriServerLinePlacementCenterBefore"==Q||"center-start"==Q||"esriServerLinePlacementCenterStart"==Q||"center-end"==Q||"esriServerLinePlacementCenterEnd"==Q?"OnLine":"Above",labelRotation:da,howManyLabels:"OneLabel",hasExpression:R,arcadeExpr:W}}});r("extend-esri")&&
q.setObject("layers.LabelLayer",E,k);return E})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),function(E,q,A,w,m,v){E=E(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=
1},setMap:function(r,l){this._labelLayer=l;this._xmin=r.extent.xmin;this._xmax=r.extent.xmax;this._ymin=r.extent.ymin;this._ymax=r.extent.ymax;this._scale=(this._xmax-this._xmin)/r.width},_process:function(r){this._preparedLabels=r;this._placedLabels=[];var l;for(r=this._preparedLabels.length-1;0<=r;r--){var k=this._preparedLabels[r],n=Math.min(k.labelWidth,k.labelHeight),d=k.labelWidth+0*n;n=k.labelHeight+0*n;var c=(l=k.options)&&void 0!==l.lineLabelPlacement?l.lineLabelPlacement:"PlaceAtCenter",
g=l&&void 0!==l.lineLabelPosition?l.lineLabelPosition:"Above",b=l&&void 0!==l.pointPriorities?l.pointPriorities:"AboveRight",e=[2,2,1,3,0,2,3,3,2];"AboveLeft"==b?e=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==b?e=[2,1,2,2,0,2,3,3,3]:"AboveRight"==b?e=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==b?e=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==b?e=[0,0,0,0,1,0,0,0,0]:"CenterRight"==b?e=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==b?e=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==b?e=[3,3,3,2,0,2,2,1,2]:"BelowRight"==b&&(e=[3,3,2,3,0,2,2,2,1]);var a=
l&&void 0!==l.labelRotation?l.labelRotation:!0;b=Math.PI/180*k.angle;l=l&&void 0!==l.howManyLabels?l.howManyLabels:"OneLabel";if("point"==k.geometry.type)this._generatePointPositions(k,k.geometry.x,k.geometry.y,k.text,b,d,n,k.symbolWidth,k.symbolHeight,e);else if("multipoint"==k.geometry.type)for(c=k.geometry,g=0;g<c.points.length;g++)this._generatePointPositions(k,c.points[g][0],c.points[g][1],k.text,b,d,n,k.symbolWidth,k.symbolHeight,e);else"polyline"==k.geometry.type?this._generateLinePositions(k,
k.geometry,k.text,d,n,2*k.symbolHeight+n,c,g,a):"polygon"==k.geometry.type&&this._generatePolygonPositions(k,l,k.geometry,k.text,b,d,n)}return this._placedLabels},_generatePointPositions:function(r,l,k,n,d,c,g,b,e,a){b=(b+c)*this._scale;e=(e+g)*this._scale;var f,h;for(f=1;3>=f;f++)for(h=1;9>=h;h++)if(a[h-1]==f)switch(h){case 1:if(this._findPlace(r,n,l-b,k+e,d,c,g))return;break;case 2:if(this._findPlace(r,n,l,k+e,d,c,g))return;break;case 3:if(this._findPlace(r,n,l+b,k+e,d,c,g))return;break;case 4:if(this._findPlace(r,
n,l-b,k,d,c,g))return;break;case 5:if(this._findPlace(r,n,l,k,d,c,g))return;break;case 6:if(this._findPlace(r,n,l+b,k,d,c,g))return;break;case 7:if(this._findPlace(r,n,l-b,k-e,d,c,g))return;break;case 8:if(this._findPlace(r,n,l,k-e,d,c,g))return;break;case 9:if(this._findPlace(r,n,l+b,k-e,d,c,g))return}},_generateLinePositions:function(r,l,k,n,d,c,g,b,e){var a=n*this._scale*n*this._scale,f,h;for(f=0;f<l.paths.length;f++){var p=l.paths[f],B=p.length,u=Math.floor((B-1)/2),t=0!==(B-1)%2?1:-1;"PlaceAtStart"==
g&&(u=0,t=1);"PlaceAtEnd"==g&&(u=B-2,t=-1);for(;0<=u&&u<B-1;){for(h=u;h<B;h++){var z=p[u][0],x=p[u][1],y=p[h][0]-z,D=p[h][1]-x;if(y*y+D*D>a){for(var H=Math.atan2(D,y);H>Math.PI/2;)H-=Math.PI;for(;H<-(Math.PI/2);)H+=Math.PI;var I=Math.sin(H),N=Math.cos(H),S=0,M=0;"Above"==b&&(S=c*I*this._scale,M=c*N*this._scale);"Below"==b&&(S=-c*I*this._scale,M=-c*N*this._scale);if(1==h-u){if(this._clipLine(z,x,p[h][0],p[h][1])){z=this._x1-this._x0;var Q=this._y1-this._y0;if(z*z+Q*Q>a&&(h=Math.atan2(Q,z),y=n/2+2*
d,x=y*this._scale*Math.cos(h),y=y*this._scale*Math.sin(h),"PlaceAtStart"==g?(z=this._x0+x,Q=this._y0+y):"PlaceAtEnd"==g?(z=this._x1-x,Q=this._y1-y):(z=this._x0+z/2,Q=this._y0+Q/2),this._findPlace(r,k,z-S,Q+M,e?-h:0,n,d)))return}}else{var da=0;for(Q=u;Q<=h;Q++)da=Math.max(da,Math.abs((p[Q][1]-x)*N-(p[Q][0]-z)*I));if(da<d&&this._findPlace(r,k,z+y/2-S,x+D/2+M,e?-H:0,n,d))return}break}}u+=t}}},_generatePolygonPositions:function(r,l,k,n,d,c,g){if("ManyLabels"==l)for(l=0;l<k.rings.length;l++){var b=k.rings[l];
v.prototype.isClockwise(b)&&(b=this._findCentroid(b,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(r,n,b[0],b[1],d,c,g))}else{b=this._findCentroidForFeature(k,this._xmin,this._ymin,this._xmax,this._ymax);var e=b[1],a=0;for(l=0;10>l;l++){a+=g/4;b=this._findCentroidForFeature(k,this._xmin,e+(a-g/4),this._xmax,e+(a+g/4));if(this._findPlace(r,n,b[0],b[1],d,c,g))break;b=this._findCentroidForFeature(k,this._xmin,e-(a+g/4),this._xmax,e-(a-g/4));if(this._findPlace(r,n,b[0],b[1],d,c,g))break}}},
_findCentroid:function(r,l,k,n,d){var c=r.length,g=[0,0],b=0,e=r[0][0],a=r[0][1];e>n&&(e=n);e<l&&(e=l);a>d&&(a=d);a<k&&(a=k);for(var f=1;f<c-1;f++){var h=r[f][0],p=r[f][1],B=r[f+1][0],u=r[f+1][1];h>n&&(h=n);h<l&&(h=l);p>d&&(p=d);p<k&&(p=k);B>n&&(B=n);B<l&&(B=l);u>d&&(u=d);u<k&&(u=k);var t=(h-e)*(u-a)-(B-e)*(p-a);g[0]+=t*(e+h+B);g[1]+=t*(a+p+u);b+=t}g[0]/=3*b;g[1]/=3*b;if(isNaN(g[0])||isNaN(g[1]))return g;k=[];this._fillBuffer(r,k,g);g[0]=this._sortBuffer(k,g[0],l,n);return g},_findCentroidForFeature:function(r,
l,k,n,d){for(var c,g=0,b=[0,0],e=0;e<r.rings.length;e++){var a=r.rings[e],f=a.length,h=a[0][0],p=a[0][1];h>n&&(h=n);h<l&&(h=l);p>d&&(p=d);p<k&&(p=k);for(c=1;c<f-1;c++){var B=a[c][0],u=a[c][1],t=a[c+1][0],z=a[c+1][1];B>n&&(B=n);B<l&&(B=l);u>d&&(u=d);u<k&&(u=k);t>n&&(t=n);t<l&&(t=l);z>d&&(z=d);z<k&&(z=k);var x=(B-h)*(z-p)-(t-h)*(u-p);b[0]+=x*(h+B+t);b[1]+=x*(p+u+z);g+=x}}b[0]/=3*g;b[1]/=3*g;if(isNaN(b[0])||isNaN(b[1]))return b;k=[];for(c=0;c<r.rings.length;c++)this._fillBuffer(r.rings[c],k,b);b[0]=
this._sortBuffer(k,b[0],l,n);return b},_fillBuffer:function(r,l,k){for(var n=r.length-1,d=r[0][1]>=r[n][1]?1:-1,c=0;c<=n;c++){var g=c,b=c+1;c==n&&(b=0);var e=r[g][0];g=r[g][1];var a=r[b][0];b=r[b][1];var f=b>=g?1:-1;if(g<=k[1]&&k[1]<=b||b<=k[1]&&k[1]<=g)k[1]!=g&&k[1]!=b?(l.push((k[1]-g)*(a-e)/(b-g)+e),d=f):k[1]==g&&k[1]!=b?(d!=f&&l.push(e),d=f):k[1]!=g&&k[1]==b?(l.push(a),d=f):k[1]==g&&k[1]==b&&(1==d&&l.push(e),l.push(a),d=f)}},_sortBuffer:function(r,l,k,n){var d=r.length;r.sort();if(0<d){for(var c=
0,g=l=0;g<d-1;g+=2){var b=Math.abs(r[g+1]-r[g]);!(r[g]<=k&&r[g+1]<=k||r[g]>=n&&r[g+1]>=n)&&b>c&&(c=b,l=g)}d=r[l];r=r[l+1];d>n&&(d=n);d<k&&(d=k);r>n&&(r=n);r<k&&(r=k);l=(d+r)/2}return l},_findPlace:function(r,l,k,n,d,c,g){if(isNaN(k)||isNaN(n))return!1;for(var b=0;b<this._placedLabels.length;b++){var e=this._placedLabels[b].angle,a=this._placedLabels[b].width*this._scale,f=this._placedLabels[b].height*this._scale,h=this._placedLabels[b].x-k,p=this._placedLabels[b].y-n;if(0===d&&0===e){if(this._findPlace2(-c*
this._scale,-g*this._scale,c*this._scale,g*this._scale,h-a,p-f,h+a,p+f))return!1}else{var B=new m(-c*this._scale,-g*this._scale,c*this._scale,g*this._scale,null),u=0,t=1;0!==d&&(u=Math.sin(d),t=Math.cos(d));var z=h*t-p*u;h=h*u+p*t;e-=d;u=Math.sin(e);t=Math.cos(e);var x=-a*t- -f*u;p=-a*u+-f*t;e=+a*t- -f*u;var y=+a*u+-f*t;a=z+x;f=h-p;u=z+e;t=h-y;x=z-x;p=h+p;z-=e;h+=y;e=new v;e.addRing([[a,f],[u,t],[x,p],[z,h],[a,f]]);if(B.intersects(e))return!1}}for(;d>Math.PI/2;)d-=Math.PI;for(;d<-(Math.PI/2);)d+=
Math.PI;b={};b.layer=r;b.text=l;b.angle=d;b.x=k;b.y=n;b.width=c;b.height=g;this._placedLabels.push(b);return!0},_findPlace2:function(r,l,k,n,d,c,g,b){return(r>=d&&r<=g||k>=d&&k<=g||r<=d&&k>=g)&&(l>=c&&l<=b||n>=c&&n<=b||l<=c&&n>=b)?!0:!1},_clipLine:function(r,l,k,n){for(var d=this._code(r,l),c=this._code(k,n);0!==d||0!==c;){if(0!==(d&c))return!1;var g=k-r,b=n-l;0!==d?(r<this._xmin?(l+=b*(this._xmin-r)/g,r=this._xmin):r>this._xmax?(l+=b*(this._xmax-r)/g,r=this._xmax):l<this._ymin?(r+=g*(this._ymin-
l)/b,l=this._ymin):l>this._ymax&&(r+=g*(this._ymax-l)/b,l=this._ymax),d=this._code(r,l)):(k<this._xmin?(n+=b*(this._xmin-k)/g,k=this._xmin):k>this._xmax?(n+=b*(this._xmax-k)/g,k=this._xmax):n<this._ymin?(k+=g*(this._ymin-n)/b,n=this._ymin):n>this._ymax&&(k+=g*(this._ymax-n)/b,n=this._ymax),c=this._code(k,n))}this._x0=r;this._y0=l;this._x1=k;this._y1=n;return!0},_code:function(r,l){var k=0;r<this._xmin&&(k+=8);r>this._xmax&&(k+=4);l<this._ymin&&(k+=2);l>this._ymax&&(k+=1);return k}});A("extend-esri")&&
q.setObject("layers.labelLayerUtils.DynamicLabelClass",E,w);return E})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),function(E,q,A,w,m,v,r){return E(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;
this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(l,k){this._labelLayer=k;this._map=l;this._xmin=l.extent.xmin;this._xmax=l.extent.xmax;this._ymin=l.extent.ymin;this._ymax=l.extent.ymax;this._scale=(this._xmax-this._xmin)/l.width},_process:function(l){var k;this._preparedLabels=l;this._placedLabels=[];for(l=this._preparedLabels.length-1;0<=l;l--){var n=this._preparedLabels[l];var d=n.labelWidth;var c=n.labelHeight;
var g=(k=n.options)&&k.lineLabelPlacement?k.lineLabelPlacement:"PlaceAtCenter";var b=k&&k.lineLabelPosition?k.lineLabelPosition:"Above";var e=k&&k.labelRotation?k.labelRotation:!0;var a=Math.PI/180*n.angle;var f=k&&k.howManyLabels?k.howManyLabels:"OneLabel";var h=[];if("point"===n.geometry.type)this._generatePointPositions(n.geometry.x,n.geometry.y,n.text,a,d,c,n.symbolWidth,n.symbolHeight,k,h);else if("multipoint"===n.geometry.type)for(e=0;e<n.geometry.points.length;e++)this._generatePointPositions(n.geometry.points[e][0],
n.geometry.points[e][1],n.text,a,d,c,n.symbolWidth,n.symbolHeight,k,h);else if("polyline"===n.geometry.type)if("PlaceAtStart"===g)this._generateLinePositionsPlaceAtStart(n.geometry,!0,n.text,d,c,2*n.symbolHeight+c,g,b,e,h);else if("PlaceAtEnd"===g)this._generateLinePositionsPlaceAtEnd(n.geometry,!0,n.text,d,c,2*n.symbolHeight+c,g,b,e,h);else{k=[];var p=n.geometry.getExtent(),B=this._map.extent;if(p.getWidth()<d*this._scale/this._OVERRUN&&p.getHeight()<d*this._scale/this._OVERRUN)continue;else.5*p.getWidth()<
B.getWidth()&&.5*p.getHeight()<B.getHeight()?this._generateLinePositionsPlaceAtCenter(n.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,n.text,d,c,2*n.symbolHeight+c,g,b,e,k):this._generateLinePositionsPlaceAtCenter(n.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,n.text,d,c,2*n.symbolHeight+c,g,b,e,k);this._postSorting(B,k,h)}else if("polygon"===n.geometry.type){g=[];for(e=0;e<n.geometry.rings.length;e++)b=n.geometry.rings[e],1<n.geometry.rings.length&&
!r.prototype.isClockwise(b)||(k=this._calcRingExtent(b),k.xmax-k.xmin<4*d*this._scale/this._OVERRUN&&k.ymax-k.ymin<4*c*this._scale/this._OVERRUN||g.push(b));g.sort(function(u,t){return t.length-u.length});for(e=0;e<g.length;e++)this._generatePolygonPositionsForManyLabels(g[e],n.geometry.spatialReference,n.text,a,d,c,h)}for(e=0;e<h.length&&(g=h[e].x,b=h[e].y,void 0!==h[e].angle&&(a=h[e].angle),k=this._findPlace(n,n.text,g,b,a,d,c),"OneLabel"!==f||!k||!this._labelLayer._isWithinScreenArea(new v(g,b,
n.geometry.spatialReference)));e++);}return this._placedLabels},_generatePointPositions:function(l,k,n,d,c,g,b,e,a,f){n=a&&a.pointPriorities?a.pointPriorities:"AboveRight";c=(b+c)*this._scale;g=(e+g)*this._scale;switch(n.toLowerCase()){case "aboveleft":l-=c;k+=g;break;case "abovecenter":k+=g;break;case "aboveright":l+=c;k+=g;break;case "centerleft":l-=c;break;case "centercenter":break;case "centerright":l+=c;break;case "belowleft":l-=c;k-=g;break;case "belowcenter":k-=g;break;case "belowright":l+=
c;k-=g;break;default:return}f.push({x:l,y:k})},_generateLinePositionsPlaceAtStart:function(l,k,n,d,c,g,b,e,a,f){b=d*this._scale;var h=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,p,B;for(p=0;p<l.paths.length;p++){var u=l.paths[p],t=b,z=0;for(B=0;B<u.length-1;B++){var x=u[B][0];var y=u[B][1];var D=u[B+1][0];var H=u[B+1][1];var I=D-x;var N=H-y;I=Math.sqrt(I*I+N*N);z+I>t?(z=this._generatePositionsOnLine(l.spatialReference,k,t,h,z,x,y,D,H,n,d,c,g,e,a,f),t=h):z+=I}}},_generateLinePositionsPlaceAtEnd:function(l,
k,n,d,c,g,b,e,a,f){b=d*this._scale;var h=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,p,B;for(p=0;p<l.paths.length;p++){var u=l.paths[p],t=b,z=0;for(B=u.length-2;0<=B;B--){var x=u[B+1][0];var y=u[B+1][1];var D=u[B][0];var H=u[B][1];var I=D-x;var N=H-y;I=Math.sqrt(I*I+N*N);z+I>t?(z=this._generatePositionsOnLine(l.spatialReference,k,t,h,z,x,y,D,H,n,d,c,g,e,a,f),t=h):z+=I}}},_generateLinePositionsPlaceAtCenter:function(l,k,n,d,c,g,b,e,a,f,h){var p;for(e=0;e<l.paths.length;e++){var B=
l.paths[e];if(!(2>B.length)){if(2==B.length){var u=B[0];var t=B[1];var z=u[0];u=u[1];B=t[0];var x=t[1];var y=(B-z)*(B-z)+(x-u)*(x-u);var D=Math.atan2(x-u,B-z);x=Math.cos(D);D=Math.sin(D);B=[];var H=z;for(var I=u;(H-z)*(H-z)+(I-u)*(I-u)<y;)B.push([H,I]),H+=n/2*x,I+=n/2*D;B.push(t)}var N=0;for(t=0;t<B.length-1;t++)z=B[t][0],u=B[t][1],y=B[t+1][0],x=B[t+1][1],D=y-z,H=x-u,N+=Math.sqrt(D*D+H*H);for(t=I=0;t<B.length-1;t++){z=B[t][0];u=B[t][1];y=B[t+1][0];x=B[t+1][1];D=y-z;H=x-u;D=Math.sqrt(D*D+H*H);if(I+
D>N/2)break;I+=D}t==B.length-1&&t--;z=B[t][0];u=B[t][1];y=B[t+1][0];x=B[t+1][1];D=y-z;H=x-u;I=N/2-I;D=Math.atan2(H,D);H=z+I*Math.cos(D);D=u+I*Math.sin(D);z=this._angleAndShifts(z,u,y,x,b,a,f);h.push({x:H+z.shiftX,y:D+z.shiftY,angle:z.angle});N=H;var S=D;I=0;for(p=t;p<B.length-1;p++)p==t?(z=N,u=S):(z=B[p][0],u=B[p][1]),y=B[p+1][0],x=B[p+1][1],D=y-z,H=x-u,D=Math.sqrt(D*D+H*H),I=I+D>n?this._generatePositionsOnLine(l.spatialReference,k,n,n,I,z,u,y,x,d,c,g,b,a,f,h):I+D;I=0;for(p=t;0<=p;p--)p==t?(z=N,u=
S):(z=B[p+1][0],u=B[p+1][1]),y=B[p][0],x=B[p][1],D=y-z,H=x-u,D=Math.sqrt(D*D+H*H),I=I+D>n?this._generatePositionsOnLine(l.spatialReference,k,n,n,I,z,u,y,x,d,c,g,b,a,f,h):I+D}}},_generatePositionsOnLine:function(l,k,n,d,c,g,b,e,a,f,h,p,B,u,t,z){f=Math.atan2(a-b,e-g);h=g;p=b;var x=h,y=p;do if(c=n-c,h+=c*Math.cos(f),p+=c*Math.sin(f),this._belongs(h,p,g,b,e,a))c=this._angleAndShifts(g,b,e,a,B,u,t),n=h+c.shiftX,y=p+c.shiftY,k?this._labelLayer._isWithinScreenArea(new m(n,y,n,y,l))&&z.push({x:n,y:y,angle:c.angle}):
z.push({x:n,y:y,angle:c.angle}),x=h,y=p,c=0,n=d;else return l=e-x,a-=y,Math.sqrt(l*l+a*a);while(1)},_postSorting:function(l,k,n){if(l&&0<k.length){var d=.5*(l.xmin+l.xmax);l=.5*(l.ymin+l.ymax);for(var c=k[0].x,g=k[0].y,b=Math.sqrt((c-d)*(c-d)+(g-l)*(g-l)),e=k[0].angle,a=0;a<k.length;a++){var f=k[a].x,h=k[a].y,p=Math.sqrt((f-d)*(f-d)+(h-l)*(h-l));p<b&&(c=f,g=h,b=p,e=k[a].angle)}n.push({x:c,y:g,angle:e})}},_belongs:function(l,k,n,d,c,g){if(c==n&&g==d)return!1;if(c>n){if(l>c||l<n)return!1}else if(l<
c||l>n)return!1;if(g>d){if(k>g||k<d)return!1}else if(k<g||k>d)return!1;return!0},_angleAndShifts:function(l,k,n,d,c,g,b){for(l=Math.atan2(d-k,n-l);l>Math.PI/2;)l-=Math.PI;for(;l<-(Math.PI/2);)l+=Math.PI;d=Math.sin(l);var e=Math.cos(l);n=k=0;"Above"==g&&(k=c*d*this._scale,n=c*e*this._scale);"Below"==g&&(k=-c*d*this._scale,n=-c*e*this._scale);c=[];c.angle=b?-l:0;c.shiftX=-k;c.shiftY=n;return c},_generatePolygonPositionsForManyLabels:function(l,k,n,d,c,g,b){c=this._findCentroidForRing(l);d=c[0];var e=
c[1],a=this._calcRingExtent(l);c=a.xmin;g=a.ymin;var f=a.xmax;a=a.ymax;var h=(a-g)/(this._map.height*this._scale);if(!(10<(f-c)/(this._map.width*this._scale)&&10<h)){var p=!0;if(f-c>this._map.width*this._scale||a-g>this._map.height*this._scale)p=!1;h=this._map.width*this._scale*(p?.1875:.5);p=this._map.height*this._scale*(p?.1875:.5);var B=!0,u=!0,t=0;do{e+=(t%2?-1:1)*t*p;if(this._scanRingByX(n,k,l,d,e,c,f,h,b))break;e<g&&(B=!1);e>a&&(u=!1);t++}while(B||u)}},_scanRingByX:function(l,k,n,d,c,g,b,e,
a){var f=!0,h=!0,p=0,B=1E3;do{d+=(p%2?-1:1)*p*e;var u=this._movePointInsideRing(n,d,c),t=this._labelLayer._isWithinScreenArea(new m(u,c,u,c,k)),z=this._isPointWithinRing(l,n,u,c);if(t&&z)return a.push({x:u,y:c}),!0;d<g&&(f=!1);d>b&&(h=!1);p++;B--;if(0>=B)return!0}while(f||h);return!1},_movePointInsideRing:function(l,k,n){for(var d=[],c=l.length-1,g=l[0][1]>=l[c][1]?1:-1,b=0;b<=c;b++){var e=b,a=b+1;b==c&&(a=0);var f=l[e][0];e=l[e][1];var h=l[a][0];a=l[a][1];var p=a>=e?1:-1;if(e<=n&&n<=a||a<=n&&n<=
e)n!=e&&n!=a?(d.push((n-e)*(h-f)/(a-e)+f),g=p):n==e&&n!=a?(g!=p&&d.push(f),g=p):n!=e&&n==a?(d.push(h),g=p):n==e&&n==a&&(1==g&&d.push(f),d.push(h),g=p)}d.sort(function(B,u){return B-u});l=d.length;if(0<l){for(b=n=k=0;b<l-1;b+=2)c=Math.abs(d[b+1]-d[b]),c>k&&(k=c,n=b);k=(d[n]+d[n+1])/2}return k},_calcRingExtent:function(l){var k;var n=new m;for(k=0;k<l.length-1;k++){var d=l[k][0],c=l[k][1];if(void 0===n.xmin||d<n.xmin)n.xmin=d;if(void 0===n.ymin||c<n.ymin)n.ymin=c;if(void 0===n.xmax||d>n.xmax)n.xmax=
d;if(void 0===n.ymax||c>n.ymax)n.ymax=c}return n},_isPointWithinPolygon:function(l,k,n,d){var c;for(c=0;c<k.rings.length;c++)if(this._isPointWithinRing(l,k.rings[c],n,d))return!0;return!1},_isPointWithinRing:function(l,k,n,d){var c=[],g=k.length;for(l=0;l<g-1;l++){var b=k[l][0];var e=k[l][1];var a=k[l+1][0];var f=k[l+1][1];if(b!=a||e!=f){if(e==f)if(d==e)c.push(b);else continue;b==a?(e<f&&d>=e&&d<f&&c.push(b),e>f&&d<=e&&d>f&&c.push(b)):(e=(a-b)/(f-e)*(d-e)+b,b<a&&e>=b&&e<a&&c.push(e),b>a&&e<=b&&e>
a&&c.push(e))}}c.sort(function(h,p){return h-p});for(l=0;l<c.length-1;l++)if(b=c[l],a=c[l+1],n>=b&&n<a)if(l%2)break;else return!0;return!1},_findCentroidForRing:function(l){for(var k=l.length,n=[0,0],d=0,c=l[0][0],g=l[0][1],b=1;b<k-1;b++){var e=l[b][0],a=l[b][1],f=l[b+1][0],h=l[b+1][1],p=(e-c)*(h-g)-(f-c)*(a-g);n[0]+=p*(c+e+f);n[1]+=p*(g+a+h);d+=p}n[0]/=3*d;n[1]/=3*d;return n},_findCentroidForFeature:function(l){for(var k=0,n=[0,0],d=0;d<l.rings.length;d++)for(var c=l.rings[d],g=c.length,b=c[0][0],
e=c[0][1],a=1;a<g-1;a++){var f=c[a][0],h=c[a][1],p=c[a+1][0],B=c[a+1][1],u=(f-b)*(B-e)-(p-b)*(h-e);n[0]+=u*(b+f+p);n[1]+=u*(e+h+B);k+=u}n[0]/=3*k;n[1]/=3*k;return n},_findPlace:function(l,k,n,d,c,g,b){if(isNaN(n)||isNaN(d))return!1;for(var e=0;e<this._placedLabels.length;e++){var a=this._placedLabels[e].angle,f=this._placedLabels[e].width*this._scale,h=this._placedLabels[e].height*this._scale,p=this._placedLabels[e].x-n,B=this._placedLabels[e].y-d;if(0===c&&0===a){if(this._findPlace2(-g*this._scale,
-b*this._scale,g*this._scale,b*this._scale,p-f,B-h,p+f,B+h))return!1}else{var u=new m(-g*this._scale,-b*this._scale,g*this._scale,b*this._scale,null),t=0,z=1;0!==c&&(t=Math.sin(c),z=Math.cos(c));var x=p*z-B*t;p=p*t+B*z;a-=c;t=Math.sin(a);z=Math.cos(a);var y=-f*z- -h*t;B=-f*t+-h*z;a=+f*z- -h*t;var D=+f*t+-h*z;f=x+y;h=p-B;t=x+a;z=p-D;y=x-y;B=p+B;x-=a;p+=D;a=new r;a.addRing([[f,h],[t,z],[y,B],[x,p],[f,h]]);if(u.intersects(a))return!1}}for(;c>Math.PI/2;)c-=Math.PI;for(;c<-(Math.PI/2);)c+=Math.PI;e={};
e.layer=l;e.text=k;e.angle=c;e.x=n;e.y=d;e.width=g;e.height=b;this._placedLabels.push(e);return!0},_findPlace2:function(l,k,n,d,c,g,b,e){return(l>=c&&l<=b||n>=c&&n<=b||l<=c&&n>=b)&&(k>=g&&k<=e||d>=g&&d<=e||k<=g&&d>=e)?!0:!1}})})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/utils ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u,t,z,x,y,D,H,I,N,S,M,Q,da,J,R,W,X,ia,ma,ha,xa,ua,na,va){var ra=H.getClassValuesForRelationship(),wa={defaultShape:{type:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15"},stroke:{width:1,color:"#555555"}},Z={HH:315,HL:45,LL:135,LH:225},Da=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Ca=q([na,h],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new r([64,
64,64]),defaultText:"Aa",sizeRampLightColor:new r([255,255,255]),sizeRampDarkColor:new r([128,128,128]),gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,_preserveCacheOnDestroy:!1,_layerConnects:null,_mapConnects:null,constructor:function(O,C){A.mixin(this,va.widgets.legend);this._i18n=va.widgets.legend;O=O||{};O.map?C?(this.map=O.map,this.layerInfos=O.layerInfos,this._respectCurrentMapScale=!1===O.respectCurrentMapScale?
!1:!0,this._respectVisibility=!1===O.respectVisibility?!1:!0,this._preserveCacheOnDestroy=O.preserveCacheOnDestroy?!0:!1,this.arrangement=O.arrangement===Ca.ALIGN_RIGHT?Ca.ALIGN_RIGHT:Ca.ALIGN_LEFT,this.arrangement===Ca.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===O.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=l(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},
postMixInProperties:function(){this.inherited(arguments);var O=["ar","he"],C;for(C=0;C<O.length;C+=1){var G=O[C];E.locale&&-1!==E.locale.indexOf(G)&&(-1!==E.locale.indexOf("-")?-1!==E.locale.indexOf(G+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0)}this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},
startup:function(){this.inherited(arguments);this._surfaceItems=[];this._initialize();9>k("ie")&&(this._repaintItems=A.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||w.forEach(this.layers,function(O){delete O.legendResponse})},refresh:function(O){if(this.domNode){O?(this.layerInfos=
O,this.layers=[],w.forEach(this.layerInfos,function(C){this._isSupportedLayerType(C.layer)&&(C.title&&(C.layer._titleForLegend=C.title),C.layer._hideDefaultSymbol=!1===C.defaultSymbol?!0:!1,C.hideLayers?(this.hideLayersInLegend[C.layer.id]=C.hideLayers,this._addSubLayersToHide(C)):this.hideLayersInLegend[C.layer.id]=[],C.hoverLabel&&(C.layer._hoverLabel=C.hoverLabel),C.hoverLabels&&(C.layer._hoverLabels=C.hoverLabels),this.layers.push(C.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=
null);for(O=this.domNode.children.length-1;0<=O;O--)e.destroy(this.domNode.children[O]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],w.forEach(this.layerInfos,function(G){this._isSupportedLayerType(G.layer)&&(G.title&&(G.layer._titleForLegend=G.title),G.layer._hideDefaultSymbol=!1===G.defaultSymbol?!0:!1,G.hideLayers?(this.hideLayersInLegend[G.layer.id]=G.hideLayers,this._addSubLayersToHide(G)):
this.hideLayersInLegend[G.layer.id]=[],G.hoverLabel&&(G.layer._hoverLabel=G.hoverLabel),G.hoverLabels&&(G.layer._hoverLabels=G.hoverLabels),this.layers.push(G.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var O=[],C=[];w.forEach(this.map.layerIds,function(G){G=this.map.getLayer(G);this._isSupportedLayerType(G)&&(G.arcgisProps&&G.arcgisProps.title&&(G._titleForLegend=G.arcgisProps.title),this.layers.push(G));if("esri.layers.KMLLayer"===G.declaredClass){var L=
G.getLayers();w.forEach(L,function(P){O.push(P.id)},this)}"esri.layers.GeoRSSLayer"===G.declaredClass&&(L=G.getFeatureLayers(),w.forEach(L,function(P){C.push(P.id)},this))},this);w.forEach(this.map.graphicsLayerIds,function(G){var L=this.map.getLayer(G);-1===w.indexOf(O,G)&&-1===w.indexOf(C,G)&&this._isSupportedLayerType(L)&&this._isLayerDrawingEnabled(L)&&(L.arcgisProps&&L.arcgisProps.title&&(L._titleForLegend=L.arcgisProps.title),this.layers.push(L))},this)}this._createLegend()},_isLayerDrawingEnabled:function(O){return O&&
(O._params&&O._params.drawMode||O.isFeatureReductionActive&&O.isFeatureReductionActive())},_activate:function(){this._deactivate();if(this.autoUpdate){this._mapConnects=[];this._layerConnects={};var O=this._mapConnects;this._respectCurrentMapScale&&O.push(m.connect(this.map,"onZoomEnd",this,"_refreshLayers"));this.useAllMapLayers&&(O.push(m.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers")),O.push(m.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers")),O.push(m.connect(this.map,"onLayersReordered",
this,"_updateAllMapLayers")));w.forEach(this.layers,function(C){var G=[m.connect(C,"onFeatureReductionRendererChange",this,"_refreshLayers"),m.connect(C,"onFeatureReductionChange",this,"_refreshLayers"),m.connect(C,"onVisibilityChange",this,"_refreshLayers"),m.connect(C,"onOpacityChange",this,"_refreshLayers"),m.connect(C,"onScaleRangeChange",this,"_refreshLayers")];"esri.layers.ArcGISDynamicMapServiceLayer"===C.declaredClass&&C.supportsDynamicLayers&&G.push(m.connect(C,"_onDynamicLayersChange",A.hitch(this,
"_updateDynamicLayers",C)));if("esri.layers.ArcGISImageServiceLayer"===C.declaredClass||"esri.layers.RasterXLayer"===C.declaredClass)G.push(m.connect(C,"onRenderingChange",A.partial(this._updateImageServiceLayers,this,C))),G.push(m.connect(C,"onRendererChange",A.partial(this._updateImageServiceLayers,this,C)));("esri.layers.ArcGISImageServiceVectorLayer"===C.declaredClass||C.setWebGLEnabled)&&G.push(m.connect(C,"onRendererChange",A.hitch(this,"_refreshLayers")));this._layerConnects[C.id]=G},this)}},
_deactivate:function(){w.forEach(this._mapConnects,function(O){m.disconnect(O)});w.forEach(this.layers,function(O){var C=this._layerConnects;C&&w.forEach(C[O.id],function(G){m.disconnect(G)})},this);this._mapConnects=this._layerConnects=null},_updateDynamicLayers:function(O){delete O.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(O,C){delete C.legendResponse;O._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];w.forEach(this.map.layerIds,
function(O){O=this.map.getLayer(O);this._isSupportedLayerType(O)&&this.layers.push(O)},this);w.forEach(this.map.graphicsLayerIds,function(O){O=this.map.getLayer(O);this._isSupportedLayerType(O)&&this._isLayerDrawingEnabled(O)&&this.layers.push(O)},this);this.refresh()},_createLegend:function(){var O=!1,C=!1;a.set(this.domNode,"position","relative");e.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var G=[];w.forEach(this.layers,function(P){if("esri.layers.KMLLayer"===
P.declaredClass||"esri.layers.GeoRSSLayer"===P.declaredClass)if(P.loaded){if("esri.layers.KMLLayer"===P.declaredClass)var T=P.getLayers();else"esri.layers.GeoRSSLayer"===P.declaredClass&&(T=P.getFeatureLayers(),this.hideLayersInLegend[P.id]&&(T=w.filter(T,function(fa){return-1===w.indexOf(this.hideLayersInLegend[P.id],fa.id)},this)));w.forEach(T,function(fa){"esri.layers.FeatureLayer"===fa.declaredClass&&P._titleForLegend&&(fa._titleForLegend=P._titleForLegend+" - ","esriGeometryPoint"===fa.geometryType?
fa._titleForLegend+=this.NLS_points:"esriGeometryPolyline"===fa.geometryType?fa._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"===fa.geometryType&&(fa._titleForLegend+=this.NLS_areas),G.push(fa))},this)}else m.connect(P,"onLoad",A.hitch(this,function(){this.refresh(this.layerInfos)}));else if("esri.layers.WMSLayer"===P.declaredClass)if(!P.loaded)m.connect(P,"onLoad",A.hitch(this,function(){this.refresh(this.layerInfos)}));else{if((!this._respectVisibility||this._respectVisibility&&P.visible)&&
0<P.layerInfos.length&&w.some(P.layerInfos,function(fa){return fa.legendURL})){var Y=!1;w.forEach(P.layerInfos,function(fa){if(fa.legendURL&&-1<w.indexOf(P.visibleLayers,fa.name)){Y||(e.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(P._titleForLegend||P.name||P.id)+"\x3c/span\x3e"},this.domNode),Y=!0);var ja;fa=fa.legendURL;if(P.customParameters||P.customLayerParameters){var ka=A.clone(P.customParameters||{});A.mixin(ka,P.customLayerParameters||{});for(ja in ka)fa+=(-1===
fa.indexOf("?")?"?":"\x26")+ja+"\x3d"+ka[ja]}e.create("div",{innerHTML:"\x3cimg src\x3d'"+fa+"'/\x3e"},this.domNode);O=!0}},this)}}else"esri.layers.WFSLayer"!==P.declaredClass||P.renderer?G.push(P):(T=e.create("div",{id:this.id+"_"+P.id,"class":"esriLegendService"}),e.create("span",{innerHTML:this._getServiceTitle(P),"class":"esriLegendServiceLabel"},e.create("td",{align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},T))))),e.place(T,this.id,"first"),T=e.create("table",
{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},T),T=e.create("tbody",{},T),"esriGeometryComplex"===P.geometryType?(this._buildRow_Renderer(P,P._pointSymbol,null,this.NLS_points,null,T),this._buildRow_Renderer(P,P._lineSymbol,null,this.NLS_lines,null,T),this._buildRow_Renderer(P,P._polygonSymbol,null,this.NLS_areas,null,T)):"esriGeometryPoint"===P.geometryType?this._buildRow_Renderer(P,P._pointSymbol,null,"",null,T):"esriGeometryPolyline"===P.geometryType?this._buildRow_Renderer(P,
P._lineSymbol,null,"",null,T):"esriGeometryPolygon"===P.geometryType&&this._buildRow_Renderer(P,P._polygonSymbol,null,"",null,T),C=!0)},this);var L=[];w.forEach(G,function(P){if(!P.loaded)var T=m.connect(P,"onLoad",this,function(fa){m.disconnect(T);T=null;this.refresh()});else if((!this._respectVisibility||this._respectVisibility&&P.visible)&&(P.layerInfos||P.renderer||"esri.layers.ArcGISImageServiceLayer"===P.declaredClass||"esri.layers.RasterXLayer"===P.declaredClass)){var Y=e.create("div",{id:this.id+
"_"+P.id,style:{display:"none"},"class":"esriLegendService"});e.create("span",{innerHTML:this._getServiceTitle(P),"class":"esriLegendServiceLabel"},e.create("td",{align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},Y)))));e.place(Y,this.id,"first");P.legendResponse||P.renderer&&"esri.renderer.StretchRenderer"!==P.renderer.declaredClass||P.renderer&&"esri.renderer.StretchRenderer"===P.renderer.declaredClass&&1===P.bandCount?this._createLegendForLayer(P):this.isHostedTileService(P)?
this._getLayerInfos(P).then(A.hitch(this,function(fa){this._createLegendForLayer(fa)}),A.hitch(this,function(fa){L.push(this._legendRequest(fa))})):"esri.layers.RasterXLayer"===P.declaredClass&&-1<P.capabilities.toLowerCase().indexOf("tilesonly")?this._createLegendForTileOnlyService(P):L.push(this._legendRequest(P))}},this);0!==L.length||O||C?(new c(L)).addCallback(A.hitch(this,function(P){O||C?b.byId(this.id+"_msg").innerHTML="":b.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):
(b.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForTileOnlyService:function(O){function C(ka,ta){var pa=["red","green","blue"],V=[[255,0,0],[0,255,0],[0,0,255]];(ta&&ta.length>=T?G(ta):G()).forEach(function(ca,aa){var ea=new X(X.STYLE_SQUARE,20,new ia(ia.STYLE_SOLID,new r([0,0,0]),1),new r(V[aa]));ka._buildRow_Renderer(O,ea,null,pa[aa]+": "+ca,null,P)},ka)}function G(ka){var ta=(O.bandIds&&O.bandIds.length?O.bandIds:[0,1,2]).map(function(pa){return ka&&ka[pa]&&
ka[pa].BandName||"Band_"+(pa+1)});3>ta.length?ta.push(ta[1]):3<ta.length&&ta.splice(3);return ta}var L=e.create("div",{id:this.id+"_"+O.id+"_clientLegend","class":"esriLegendServiceLabel"},b.byId(this.id+"_"+O.id));e.create("td",{align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%","class":"esriLegendLayerLabel"},L))));L=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},L);var P=e.create("tbody",{},L),T=O.bandCount;if(1<T&&(!O.bandIds||
0===O.bandIds.length||1<O.bandIds.length))O.getKeyProperties().then(A.hitch(this,function(ka){C(this,ka.BandProperties)}),A.hitch(this,function(ka){C(this)}));else{L={colorRamp:{type:"algorithmic",fromColor:[0,0,0],toColor:[255,255,255]}};var Y=O.renderer;if(Y&&Y.statistics&&Y.statistics.length){var fa=null!=Y.statistics[0].min?Y.statistics[0].min:Y.statistics[0][0];var ja=null!=Y.statistics[0].max?Y.statistics[0].max:Y.statistics[0][1]}else fa=O.serviceInfo.minValues.length?O.serviceInfo.minValues[0]:
0,ja=O.serviceInfo.maxValues.length?O.serviceInfo.maxValues[0]:255;this._createStretchLegend(P,Y||L,fa,ja)}a.set(b.byId(this.id+"_"+O.id),"display","block");a.set(b.byId(this.id+"_msg"),"display","none")},_createLegendForLayer:function(O){if(O.legendResponse||O.renderer||this.isHostedTileService(O)){var C=!1;if(O.legendResponse||this.isHostedTileService(O)){var G=O.dynamicLayerInfos||O.layerInfos;if(G&&G.length)w.forEach(G,function(L,P){this.hideLayersInLegend[O.id]&&-1!==w.indexOf(this.hideLayersInLegend[O.id],
L.id)||(L=this._buildLegendItems(O,L,P),C=C||L)},this);else if("esri.layers.ArcGISImageServiceLayer"===O.declaredClass||"esri.layers.RasterXLayer"===O.declaredClass)C=this._buildLegendItems(O,{id:0,name:null,title:O.name,subLayerIds:null,parentLayerId:-1},0)}else O.renderer&&(G=O.url?O.url.substring(O.url.lastIndexOf("/")+1,O.url.length):"fc_"+O.id,C=this._buildLegendItems(O,{id:G,name:null,subLayerIds:null,parentLayerId:-1},0));C&&(a.set(b.byId(this.id+"_"+O.id),"display","block"),a.set(b.byId(this.id+
"_msg"),"display","none"))}},_legendRequest:function(O){if(O.loaded)return 10.01<=O.version?this._legendRequestServer(O):this._legendRequestTools(O);m.connect(O,"onLoad",A.hitch(this,"_legendRequest"))},_legendRequestServer:function(O){var C=O.url,G=C.indexOf("?");C=-1<G?C.substring(0,G)+"/legend"+C.substring(G):C+"/legend";(G=O._getToken())&&(C+="?token\x3d"+G);var L=A.hitch(this,"_processLegendResponse"),P={f:"json"};O._params.dynamicLayers&&(P.dynamicLayers=g.stringify(this._createDynamicLayers(O)),
"[{}]"===P.dynamicLayers&&(P.dynamicLayers="[]"));O._params.bandIds&&(P.bandIds=O._params.bandIds);O._params.renderingRule?P.renderingRule=O._params.renderingRule:O.rasterFunctionInfos&&0<O.rasterFunctionInfos.length&&w.forEach(O.rasterFunctionInfos,function(T){T&&T.name&&"none"===T.name.toLowerCase()&&(P.renderingRule=g.stringify({rasterFunction:T.name}))});(G=O._params.mosaicRule&&JSON.parse(O._params.mosaicRule))&&G.multidimensionalDefinition&&G.multidimensionalDefinition.length&&(P.variable=G.multidimensionalDefinition[0].variableName);
return x({url:C,content:P,callbackParamName:"callback",load:function(T,Y){L(O,T,Y)},error:z.defaults.io.errorHandler})},_legendRequestTools:function(O){var C=O.url.toLowerCase().indexOf("/rest/");C=O.url.substring(0,C)+O.url.substring(C+5,O.url.length);C=this._legendUrl+"?soapUrl\x3d"+window.escape(C);if(!k("ie")||8<k("ie"))C+="\x26returnbytes\x3dtrue";var G=A.hitch(this,"_processLegendResponse");return x({url:C,content:{f:"json"},callbackParamName:"callback",load:function(L,P){G(O,L,P)},error:z.defaults.io.errorHandler})},
_processLegendResponse:function(O,C){C&&C.layers?(O.legendResponse=C,b.byId(this.id+"_"+O.id)&&e.empty(b.byId(this.id+"_"+O.id)),e.create("span",{innerHTML:this._getServiceTitle(O),"class":"esriLegendServiceLabel"},e.create("td",{align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},b.byId(this.id+"_"+O.id)))))),this._createLegendForLayer(O)):console.log("Legend could not get generated for "+O.url+": "+v.toJson(C))},_buildLegendItems:function(O,C,G){var L=!1,P=b.byId(this.id+
"_"+O.id),T=C.parentLayerId;if(C.subLayerIds)O=e.create("div",{id:this.id+"_"+O.id+"_"+C.id+"_group",style:{display:"none"},"class":-1==T?0<G?"esriLegendGroupLayer":"":this._legendAlign},-1==T?P:b.byId(this.id+"_"+O.id+"_"+T+"_group")),e.create("td",{innerHTML:u.encode(C.name),align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%","class":"esriLegendLayerLabel"},O))));else{if(this._respectVisibility&&O.visibleLayers)if(G=O.dynamicLayerInfos||O.layerInfos)if(O._params&&
O._params.layers){if(-1===w.indexOf(O.visibleLayers,C.id))return L}else{if(G=this._getReallyVisibleLayers(G,O.visibleLayers),-1===w.indexOf(G,C.id))return L}else if(-1===w.indexOf(O.visibleLayers,C.id))return L;P=e.create("div",{id:this.id+"_"+O.id+"_"+C.id,style:{display:"none"},"class":-1<T?this._legendAlign:""},-1==T?P:b.byId(this.id+"_"+O.id+"_"+T+"_group"));e.create("td",{innerHTML:u.encode(C.name)||"",align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%","class":"esriLegendLayerLabel"},
P))));G=O.dynamicLayerInfos||O.layerInfos;T=!1;G&&G.length&&(T=w.some(G,function(Y){return!!Y.drawingInfo}));if(O.legendResponse)L=L||this._buildLegendItems_Tools(O,C,P);else if(O.renderer||T)L=L||this._buildLegendItems_Renderer(O,C,P)}return L},_getReallyVisibleLayers:function(O,C){if(!O||!C||!C.length)return[];var G=[],L=[],P;for(P=0;P<O.length;P++)if(O[P].subLayerIds){if(-1===w.indexOf(C,O[P].id)||-1<w.indexOf(L,O[P].id))L=L.concat(O[P].subLayerIds)}else-1<w.indexOf(C,O[P].id)&&-1===w.indexOf(L,
O[P].id)&&G.push(O[P].id);return G},_buildLegendItems_Tools:function(O,C,G){var L=C.parentLayerId,P=this.map.getScale(),T=!1,Y=function(aa,ea){var la,oa;for(la=0;la<aa.length;la++)if(ea.dynamicLayerInfos)for(oa=0;oa<ea.dynamicLayerInfos[oa].length;oa++){if(ea.dynamicLayerInfos[oa].mapLayerId==aa[la].layerId)return aa[la]}else if(ea.id==aa[la].layerId)return aa[la];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(O,C,P)){var fa=!0;if(this._respectCurrentMapScale&&
("esri.layers.ArcGISDynamicMapServiceLayer"===O.declaredClass||"esri.layers.ArcGISMapServiceLayer"===O.declaredClass)){var ja=this._getEffectiveScale(O,C);if(ja.minScale&&ja.minScale<P||ja.maxScale&&ja.maxScale>P)fa=!1}if(fa){Y=Y(O.legendResponse.layers,C);var ka=Y.legendType,ta=Y.legend;P=Y.legendGroups;if(ta){"esri.layers.ArcGISImageServiceLayer"===O.declaredClass&&"esri.layers.RasterXLayer"===O.declaredClass||this._sanitizeLegendResponse(O,Y,C);G=e.create("table",{cellpadding:0,cellspacing:0,width:"95%",
"class":"esriLegendLayer"},G);var pa=e.create("tbody",{},G),V={};P&&0<P.length&&(G.setAttribute("cellspacing","10"),P.forEach(function(aa){if(aa.heading){var ea=e.create("tr",{},pa);ea=e.create("td",{},ea);e.create("div",{innerHTML:u.encode(aa.heading)},ea)}ea=e.create("tr",{},pa);ea=e.create("td",{},ea);ea=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},ea);ea=e.create("tbody",{},ea);V[aa.id]=ea}));(O._hoverLabel||O._hoverLabels)&&this._createHoverAction(G,O,
C);var ca=[];w.forEach(ta,function(aa){if(!(10.1<=O.version&&!aa.values&&1<ta.length)||!O._hideDefaultSymbol&&"\x3call other values\x3e"!==aa.label){var ea=aa.label;if(aa.url&&0===aa.url.indexOf("http")||aa.imageData&&0<aa.imageData.length)T=!0,ea&&-1!==w.indexOf(ca,ea)||(ca.push(ea),this._buildRow_Tools(aa,V[aa.groupId]||pa,O,C.id,ka))}},this)}}}T&&(a.set(b.byId(this.id+"_"+O.id+"_"+C.id),"display","block"),-1<L&&(a.set(b.byId(this.id+"_"+O.id+"_"+L+"_group"),"display","block"),this._findParentGroup(O.id,
O,L)));return T},_getLayerInfos:function(O){var C=new d,G=O.dynamicLayerInfos||O.layerInfos;if(G&&G.length)if(w.some(G,function(T){return!!T.drawingInfo}))C.resolve(O);else{var L=O.url,P=L.indexOf("?");L=-1===P?L+"/layers":L.substring(0,P)+"/layers"+L.substring(P,L.length);x({url:L,content:{f:"json"},callbackParamName:"callback",load:function(T,Y){T.layers?(w.forEach(G,function(fa){var ja=w.filter(T.layers,function(ka){return fa.source?ka.id===fa.source.mapLayerId:ka.id===fa.id});ja&&ja[0]&&ja[0].drawingInfo&&
(fa.drawingInfo=ja[0].drawingInfo,fa.fields=ja[0].fields)}),C.resolve(O)):C.reject(O)},error:function(T){C.reject(O)}})}return C},_sanitizeLegendResponse:function(O,C,G){var L=C.legend;if(10.1<=O.version&&1<L.length&&!C._sanitized){O=A.getObject("layerDefinition.drawingInfo.renderer",!1,G);var P,T;O||(O=A.getObject("drawingInfo.renderer",!1,G));w.some(L,function(Y){if(Y.values)return!0})&&w.some(L,function(Y,fa){Y.values||(T=fa,P=Y);return!!P});O?"uniqueValue"===O.type?P&&(L.splice(T,1),L.push(P)):
"classBreaks"===O.type&&(P&&L.splice(T,1),L.reverse(),P&&L.push(P)):P&&(L.splice(T,1),L.push(P));C._sanitized=!0}},_buildRow_Tools:function(O,C,G,L,P){var T=e.create("tr",{},C);if(this.alignRight){C=e.create("td",{align:this._isRightToLeft?"left":"right"},T);var Y=e.create("td",{align:this._isRightToLeft?"left":"right",width:35},T)}else Y=e.create("td",{width:35,align:"center"},T),C=e.create("td",{},T);T=O.url;(!k("ie")||9<=k("ie")||9>k("ie")&&("esri.layers.ArcGISImageServiceLayer"===G.declaredClass||
"esri.layers.RasterXLayer"===G.declaredClass))&&O.imageData&&0<O.imageData.length?T="data:image/png;base64,"+O.imageData:0!==O.url.indexOf("http")&&(T=G.url+"/"+L+"/images/"+O.url,(L=G._getToken())&&(T+="?token\x3d"+L));L=e.create("img",{src:T,border:0,style:"opacity:"+G.opacity},Y);O=e.create("td",{innerHTML:u.encode(O.label),align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%",dir:"ltr"},C))));P&&"Stretched"===P&&10.3<=G.version&&("esri.layers.ArcGISImageServiceLayer"===
G.declaredClass||"esri.layers.RasterXLayer"===G.declaredClass)&&(O.style.verticalAlign="top",O.style.lineHeight="1",L.style.marginBottom="-1px",L.style.display="block",C.style.verticalAlign="top");9>k("ie")&&(L.style.filter="alpha(opacity\x3d"+100*G.opacity+")")},_getVariable:function(O,C,G){if(O)var L=(O=O.getVisualVariablesForType(C,G))&&O[0];return L},_getVariables:function(O,C,G){O=[this._getVariable(O,"colorInfo",!1),this._getVariable(O,"opacityInfo",!1),this._getVariable(O,"sizeInfo",!1)];return C?
w.filter(O,function(L){return!(!L||L.field!==C||L.normalizationField!=G)}):O},_getFieldAlias:function(O,C,G){var L=C.infoTemplate||(C.infoTemplates&&G&&C.infoTemplates[G.id]?C.infoTemplates[G.id].infoTemplate:null);L=L&&L.getFieldInfo&&L.getFieldInfo(O);O=A.isFunction(O)?null:this.getField(C,O,G);C=L||O;G="";C&&(G=L&&L.label||O&&O.alias||C.name||C.fieldName);return G},_getDomainName:function(O,C,G,L){if(O&&!A.isFunction(O))var P=(G=(O=this.getField(G,O,L))&&G.getDomain?G.getDomain(O.name):null)&&
G.codedValues?G.getName(C):null;return P},_getRampTitle:function(O,C,G){var L=O.field,P=O.normalizationField,T=!1,Y=!1,fa=!1;L=A.isFunction(L)?null:L;P=A.isFunction(P)?null:P;if(O.legendOptions&&O.legendOptions.title)var ja=O.legendOptions.title;else if(O.valueExpressionTitle)ja=O.valueExpressionTitle;else{if(C.renderer&&C.renderer.authoringInfo&&C.renderer.authoringInfo.visualVariables){var ka=C.renderer.authoringInfo.visualVariables;for(O=0;O<ka.length;O++){var ta=ka[O];if("colorInfo"===ta.type&&
"ratio"===ta.style){T=!0;break}else if("colorInfo"===ta.type&&"percent"===ta.style){Y=!0;break}else if("colorInfo"===ta.type&&"percentTotal"===ta.style){fa=!0;break}}}(T=fa&&"showRatioPercentTotal"||Y&&"showRatioPercent"||T&&"showRatio"||P&&"showNormField"||L&&"showField"||null)&&(ja=y.substitute({field:L&&this._getFieldAlias(L,C,G),normField:P&&this._getFieldAlias(P,C,G)},"showField"===T?"${field}":this._i18n[T]))}return ja},_getRendererTitle:function(O,C,G){if(O){if("esri.renderer.ClassBreaksRenderer"===
O.declaredClass){var L=O.attributeField;var P=O.normalizationField;var T="percent-of-total"===O.normalizationType}L=A.isFunction(L)?null:L;P=A.isFunction(P)?null:P;if(O.legendOptions&&O.legendOptions.title)var Y=O.legendOptions.title;else O.valueExpressionTitle?Y=O.valueExpressionTitle:(O=P&&"showNormField"||(T?"showNormPct":null)||L&&"showField"||null)&&(Y=y.substitute({field:L&&this._getFieldAlias(L,C,G),normField:P&&this._getFieldAlias(P,C,G)},"showField"===O?"${field}":this._i18n[O]))}return Y},
_buildLegendItems_Renderer:function(O,C,G){function L(){a.set(b.byId(Ma.id+"_"+O.id+"_"+C.id),"display","block");-1<P&&(a.set(b.byId(Ma.id+"_"+O.id+"_"+P+"_group"),"display","block"),this._findParentGroup(O.id,P))}var P=C.parentLayerId,T=this.map,Y=T.getScale(),fa=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(O,C,Y)){var ja,ka,ta;var pa="esri.layers.ArcGISImageServiceVectorLayer"===O.declaredClass?O.renderer.renderer:C&&C.drawingInfo?ua.fromJson(A.clone(C.drawingInfo.renderer)):O.isFeatureReductionActive&&
O.isFeatureReductionActive()?O.getFeatureReductionRenderer():O.renderer;if("esri.renderer.ScaleDependentRenderer"===pa.declaredClass&&(pa=(T="zoom"===pa.rangeType?pa.getRendererInfoByZoom(T.getZoom()):pa.getRendererInfoByScale(Y))&&T.renderer,!pa))return!1;T=pa&&pa.authoringInfo&&"relationship"===pa.authoringInfo.type;if("esri.renderer.StretchRenderer"!==pa.declaredClass&&"esri.renderer.ShadedReliefRenderer"!==pa.declaredClass){Y=this._getVariables(pa);var V=w.filter(Y,function(La){return!!La}).length,
ca=Y[0],aa=Y[1],ea=Y[2],la,oa=!1;if(ca){var za=this._getMedianColor(pa,ca);ca.field&&(ja=A.isFunction(ca.field)?null:this.getField(O,ca.field,C));var sa=!(ca.legendOptions&&!1===ca.legendOptions.showLegend)}if(aa){aa.field&&(ta=A.isFunction(aa.field)?null:this.getField(O,aa.field,C));var Ea=!(aa.legendOptions&&!1===aa.legendOptions.showLegend)}ea&&(ea.field&&(ka=A.isFunction(ea.field)?null:this.getField(O,ea.field,C)),oa=(la=!(ea.legendOptions&&!1===ea.legendOptions.showLegend))&&Da.test(ea.valueExpression))}if("esri.renderer.HeatmapRenderer"===
pa.declaredClass){var Ba=fa=!0;this._showHeatRamp(O,C,pa,G)}else if("esri.renderer.DotDensityRenderer"===pa.declaredClass)Ba=fa=!0,this._showDotDensityLegend(O,C,pa,G);else if("esri.renderer.TemporalRenderer"===pa.declaredClass){Ba=fa=!0;Y=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},G);var ya=e.create("tbody",{},Y);(O._hoverLabel||O._hoverLabels)&&this._createHoverAction(Y,O,C);pa.latestObservationRenderer&&"esri.renderer.SimpleRenderer"===pa.latestObservationRenderer.declaredClass&&
this._buildRow_Renderer(O,pa.latestObservationRenderer.symbol,za,u.encode(pa.latestObservationRenderer.label)||this.NLS_currentObservations,null,ya);pa.observationRenderer&&"esri.renderer.SimpleRenderer"===pa.observationRenderer.declaredClass&&this._buildRow_Renderer(O,pa.observationRenderer.symbol,za,u.encode(pa.observationRenderer.label)||this.NLS_previousObservations,null,ya)}else if("esri.renderer.UniqueValueRenderer"===pa.declaredClass){if(pa.infos&&0<pa.infos.length){Ba=fa=!0;if(pa.legendOptions&&
pa.legendOptions.title||pa.valueExpressionTitle)Y=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},G),ya=e.create("tbody",{},Y),V=pa.legendOptions&&pa.legendOptions.title?pa.legendOptions.title:pa.valueExpressionTitle,this._buildRow_Renderer(O,null,za,u.encode(V),null,ya);Y=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},G);ya=e.create("tbody",{},Y);(O._hoverLabel||O._hoverLabels)&&this._createHoverAction(Y,O,C);pa.attributeField&&
ea&&this._addSubHeader(ya,this._getFieldAlias(pa.attributeField,O,C));if(T){var Ha=pa.authoringInfo;var Na=Ha.focus;V=Ha.numClasses;var Qa=Ha.field1.field;Y=Ha.field2.field;if(V&&Qa&&Y){var Ra=Ha.field1.normalizationField;Ha=Ha.field2.normalizationField;var Ia=Ra&&this._i18n.showNormField||Qa&&"${field}",Xa=Ha&&this._i18n.showNormField||Y&&"${field}";Qa=y.substitute({field:this._getFieldAlias(Qa,O,C),normField:Ra&&this._getFieldAlias(Ra,O,C)},Ia);Y=y.substitute({field:this._getFieldAlias(Y,O,C),normField:Ha&&
this._getFieldAlias(Ha,O,C)},Xa);Ra={shapeDescriptor:wa,rotation:this._getRotationAngleForFocus(Na)||0};this._buildRow_Renderer(O,null,null,u.encode(Qa),null,ya,null,Ra);Ra.rotation+=90;this._buildRow_Renderer(O,null,null,u.encode(Y),null,ya,null,Ra);this._drawRelationshipLegend(G,{numClasses:V,focus:Na,uvInfos:pa.infos})}}else{var Va=[];w.forEach(pa.infos,function(La){var cb=null;this._isLayerEditable(O)&&O.types&&(cb=this._getTemplateFromTypes(O.types,La.value));var hb=La.label;null==hb&&(hb=this._getDomainName(pa.attributeField,
La.value,O,C)||La.value);-1===w.indexOf(Va,hb)&&(Va.push(hb),La=La.symbol,La=this._applyScaleDrivenSymbolSize(La,pa,ea,oa),this._buildRow_Renderer(O,La,za,u.encode(hb),cb,ya))},this)}}Na=!T&&this._displayDefaultSymbol(O,pa,G,ea,oa)}else if("esri.renderer.ClassBreaksRenderer"===pa.declaredClass){if(pa.infos&&0<pa.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===O.declaredClass){Ba=fa=!0;var gb=this._isUnclassedRenderer(pa);if(!ca&&1===pa.infos.length)var ab=(ab=pa.infos[0])&&ab.symbol;gb||
(Y=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},G),ya=e.create("tbody",{},Y),V=this._getRendererTitle(pa,O,C),this._buildRow_Renderer(O,null,za,u.encode(V),null,ya));Y=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},G);ya=e.create("tbody",{},Y);(O._hoverLabel||O._hoverLabels)&&this._createHoverAction(Y,O,C);gb&&ea&&la&&!oa||(T=pa.infos.slice(0).reverse(),w.forEach(T,function(La){var cb=La.label;null!=cb||gb||(cb=La.minValue+
" - "+La.maxValue);La=La.symbol;La=this._applyScaleDrivenSymbolSize(La,pa,ea,oa);this._buildRow_Renderer(O,La,za,u.encode(cb),null,ya)},this));"esri.layers.ArcGISImageServiceVectorLayer"!==O.declaredClass||O.renderer.style!==J.STYLE_SCALAR&&O.renderer.style!==J.STYLE_SINGLE_ARROW||(this._buildRow_Renderer(O,pa.defaultSymbol,null,"",null,ya),O._hideDefaultSymbol=!0)}gb||(Na=this._displayDefaultSymbol(O,pa,G,ea,oa))}else if("esri.renderer.StretchRenderer"===pa.declaredClass){Ba=fa=!0;Y=e.create("table",
{cellpadding:0,cellspacing:0,width:"95%",class:"esriLegendLayer"},G);ya=e.create("tbody",{},Y);var Ma=this,Ka,Wa,lb=function(){pa.statistics.length?(Ka=pa.statistics[0][1],Wa=pa.statistics[0][0]):(Wa=Ua?Ua.minValues[0]:O.minValues[0],Ka=Ua?Ua.maxValues[0]:O.maxValues[0]);"esri.layers.RasterXLayer"===O.declaredClass&&O.hasStdTime()&&(Wa=O.getStdTimeValue(Wa),Ka=O.getStdTimeValue(Ka));Ma._createStretchLegend(ya,pa,Wa,Ka)};if(O.renderingRule)O.getRenderingRuleServiceInfo(O.renderingRule).then(function(La){var cb=
La&&La.minValues&&0<La.minValues.length&&La.maxValues&&0<La.maxValues.length;La&&1<La.bandCount||!cb?Ma._legendRequest(O).then(function(hb){Ma._processLegendResponse(O,hb)}):lb()});else{var Ua=O.serviceInfo;if("esri.layers.RasterXLayer"===O.declaredClass&&(Ua=O.raster.serviceInfo,O.hasMultidimensions&&(!pa.statistics||!pa.statistics.length)))return G=O.mosaicRule&&O.mosaicRule.multidimensionalDefinition,O.getStatistics(G&&G.length?G[0].variableName:O._defaultMultidimensionalDefinition[0].variableName).then(A.hitch(this,
function(La){this._createStretchLegend(ya,pa,La[0][0],La[0][1]);L()})),fa;lb()}}else"esri.renderer.ShadedReliefRenderer"===pa.declaredClass?(Ba=fa=!0,Y=e.create("table",{cellpadding:0,cellspacing:0,width:"95%",class:"esriLegendLayer"},G),ya=e.create("tbody",{},Y),this._createStretchLegend(ya,pa,0,255)):"esri.renderer.SimpleRenderer"===pa.declaredClass?(Ba=fa=!0,Y=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},G),ya=e.create("tbody",{},Y),(O._hoverLabel||O._hoverLabels)&&
this._createHoverAction(Y,O,C),ab=null,this._isLayerEditable(O)&&O.templates&&0<O.templates.length&&(ab=O.templates[0]),T=1<V?null:ja&&sa||ta&&Ea||ka&&la,this._buildRow_Renderer(O,pa.symbol,za,u.encode(T?this._getRampTitle(1<V?null:ca||aa||ea,O,C):pa.label),ab,ya),ab=ca?null:pa.symbol,T&&(ja=ta=ka=null)):"esri.renderer.ColormapRenderer"===pa.declaredClass&&(pa.colormapInfos&&pa.colormapInfos.length&&(Ba=fa=!0),Y=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},
G),ya=e.create("tbody",{},Y),pa.colormapInfos.forEach(function(La){var cb=new ma(ma.STYLE_SOLID,null,new r(La.color));this._buildRow_Renderer(O,cb,null,La.label,null,ya)},this),O._hideDefaultSymbol=!0);Ba&&(ca&&sa&&(ca.field||ca.valueExpression)&&this._showGradientRamp(O,C,pa,null,G,ca,ja,null,ea&&la?!0:!1),ea&&la&&(ea.field||ea.valueExpression&&!oa)&&(Ba=ca&&sa||"esri.renderer.UniqueValueRenderer"===pa.declaredClass?!1:!0,this._showSizeLegend(O,C,pa,ea,za,G,ka,null,Ba)),aa&&Ea&&(aa.field||aa.valueExpression)&&
this._showGradientRamp(O,C,pa,ab&&!ab.url&&ab.color?ab.color:this.transparencyRampColor,G,aa,ta,null,!1));Na||gb&&!sa&&!la&&!Ea||(Na=this._displayDefaultSymbol(O,pa,G,ea,oa));fa=fa||Na}Ma=this;fa&&L();return fa},_createStretchLegend:function(O,C,G,L){var P=e.create("tr",{},O);var T=e.create("td",{rowspan:2,"class":"esriStretchLegend"},P);C=e.toDom(this._addColorRamp(C.colorRamp));e.place(C,T);e.create("td",{},P).innerHTML=this._i18n.high+": "+("string"===typeof L?L:Math.round(L*Math.pow(10,3))/Math.pow(10,
3));O=e.create("tr",{},O);e.create("td",{},O).innerHTML=this._i18n.low+": "+("string"===typeof G?G:Math.round(G*Math.pow(10,3))/Math.pow(10,3))},_addColorRamp:function(O){O||(O={algorithm:"hsv",fromColor:[0,0,0,1],toColor:[255,255,255,1]});var C=this._generateColorRampDivs(O);O.label="\x3cdiv class\x3d'esriStretchLegendGradientLabel'\x3e"+C+"\x3c/div\x3e";return O.label},_generateColorRampDivs:function(O){if(O){var C="";if("multipart"===O.type){var G=100/O.colorRamps.length;var L=O.colorRamps;Object.keys(L).reverse().forEach(function(P){C+=
this._generateSingleGradientDiv(L[P].fromColor,L[P].toColor,G)},this)}else C=this._generateSingleGradientDiv(O.fromColor,O.toColor,100);return C}},_generateSingleGradientDiv:function(O,C,G){if(O&&C){var L="";O=O.toRgb?O.toRgb():O;C=C.toRgb?C.toRgb():C;var P="(0deg, rgb("+O.slice(0,3).join()+"), rgb("+C.slice(0,3).join()+"));";w.forEach(["-webkit-linear-gradient","-o-linear-gradient","-moz-linear-gradient","linear-gradient"],function(T){L+="background: "+T+P});return"\x3cdiv class\x3d'esriStretchLegendSingleGradient' style\x3d'height:"+
G+"%;"+L+"'\x3e\x3c/div\x3e"}},_isLayerEditable:function(O){return"function"===typeof O.isEditable&&O.isEditable()},_isUnclassedRenderer:function(O,C){var G=O.infos;G=G?G.length:0;if("esri.renderer.ClassBreaksRenderer"===O.declaredClass&&1===G){G=O.attributeField;var L=O.normalizationField;O=C?G===C:!!this._getVariables(O,G,L).length}else O=O.authoringInfo&&O.authoringInfo.type,O=2===G&&"univariateColorSize"===O;return O},_displayDefaultSymbol:function(O,C,G,L,P){var T=C.defaultSymbol;if(!O._hideDefaultSymbol&&
T){var Y=!0;G=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},G);G=e.create("tbody",{},G);T=this._applyScaleDrivenSymbolSize(T,C,L,P);this._buildRow_Renderer(O,T,null,u.encode(C.defaultLabel)||"others",null,G)}return Y},_applyScaleDrivenSymbolSize:function(O,C,G,L){L&&(O=xa.fromJson(O.toJson()),this._applySize(O,C,G,null));return O},_showGradientRamp:function(O,C,G,L,P,T,Y,fa,ja){ja=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+
(ja?"":" esriLegendSubFragment")},P);P=e.create("tbody",{},ja);(O._hoverLabel||O._hoverLabels||fa)&&this._createHoverAction(ja,O,C,fa);(Y||T.valueExpression||T.legendOptions&&T.legendOptions.title)&&this._addSubHeader(P,this._getRampTitle(T,O,C));Y=T.field;var ka;Y&&(ka=A.isFunction(Y)?null:this.getField(O,Y,C));if(T=(C=this._getRampStops(G,T,L,ka&&"esriFieldTypeDate"===ka.type))?C.length:0)T=10<T,this._drawGradientRamp(P,C,!T,O,this._getRampBorderColor(G),!!L,T)},_getMedianColor:function(O,C){if(C.colors){var G=
C.minDataValue;var L=C.maxDataValue}else C.stops&&(G=C.stops[0].value,L=C.stops[C.stops.length-1].value);return O.getColor(G+(L-G)/2,{colorInfo:C})},_getRampStops:function(O,C,G,L){var P,T,Y=!1;if(C.colors||C.opacityValues){var fa=C.maxDataValue-C.minDataValue;var ja=w.map([0,.25,.5,.75,1],function(V){P=C.minDataValue+V*fa;return Number(P.toFixed(6))});this._checkPrecision(0,4,ja)}else C.stops&&(ja=w.map(C.stops,function(V){return V.value}),L||w.some(ja,function(V){return 2<D.getDigits(V).fractional})&&
(ja=D.round(ja)),(Y=w.some(C.stops,function(V){return!!V.label}))&&(T=w.map(C.stops,function(V){return V.label})));var ka=ja[0],ta,pa;fa=ja[ja.length-1]-ka;return w.map(ja,function(V,ca){G?(ta=new r(G.toRgba()),pa=O.getOpacity(V,{opacityInfo:C}),null!=pa&&(ta.a=pa)):ta=O.getColor(V,{colorInfo:C});var aa="";if(Y)aa=T[ca];else{aa=L?H.formatDate(V,H.timelineDateFormatOptions):D.format(V);var ea="";0===ca?ea=this._specialChars.lt+" ":ca===ja.length-1&&(ea=this._specialChars.gt+" ");aa=ea+aa}return{value:V,
color:ta,offset:1-(V-ka)/fa,label:aa}},this).reverse()},_checkPrecision:function(O,C,G){var L=O+(C-O)/2,P=G[O],T=G[L],Y=G[C],fa=Math.floor(P),ja=Math.floor(T),ka=Math.floor(Y);fa===P&&ka===Y&&ja!==T&&fa!==ja&&ka!==ja&&(G[L]=ja);O+1!==L&&this._checkPrecision(O,L,G);L+1!==C&&this._checkPrecision(L,C,G)},_getRampBorderColor:function(O){if("esri.renderer.SimpleRenderer"===O.declaredClass)var C=O.symbol;else if("esri.renderer.UniqueValueRenderer"===O.declaredClass||"esri.renderer.ClassBreaksRenderer"===
O.declaredClass)C=O.infos[0].symbol;return(O=C&&-1===C.type.indexOf("linesymbol")?C.getStroke():null)&&O.color},_drawGradientRamp:function(O,C,G,L,P,T,Y){var fa=e.create("tr",{},O),ja=C.length-1,ka;var ta=0;if(this.alignRight){O=e.create("td",{align:this._isRightToLeft?"left":"right"},fa);var pa=e.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},fa)}else pa=e.create("td",{width:this.gradientWidth,align:"center"},fa),O=e.create("td",{},fa);fa=P&&0<P.a&&!(240<=P.r&&240<=
P.g&&240<=P.b);var V=e.create("div",{"class":fa?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},pa);pa=e.create("div",{"class":"esriLegendColorRamp"+(T?" esriLegendTransparencyRamp":"")},V);T=a.get(pa,"width");fa&&(P=9>k("ie")?P.toHex():"rgba("+P.toRgba().join(",")+")",a.set(pa,"border",this.colorRampBorder+" "+P));G?(P=this.gradientHeight*ja,a.set(pa,"height",P+"px")):P=a.get(pa,"height");a.set(V,"height",P+"px");fa=p.createSurface(pa,T,P);9>k("ie")&&
(ta=fa.getEventSource(),a.set(ta,"position","relative"),a.set(ta.parentNode,"position","relative"),ta=1);try{G&&w.forEach(C,function(ea,la){ea.offset=la/ja});var ca=fa.createRect({x:-ta,y:-ta,width:T+ta,height:P+ta});ca.setFill({type:"linear",x1:0,y1:0,x2:0,y2:P,colors:C}).setStroke(null);fa.createRect({width:T,height:P}).setFill(new r([255,255,255,1-L.opacity])).setStroke(null);this._surfaceItems.push(fa)}catch(ea){fa.clear(),fa.destroy()}w.forEach(C,function(ea,la){ea.label&&(ka="top:"+100*ea.offset+
"%;",ea="",0===la&&(ea+=" esriLegendColorRampTickFirst"),la===C.length-1&&(ea+=" esriLegendColorRampTickLast"),e.create("div",{"class":"esriLegendColorRampTick"+ea,innerHTML:"\x26nbsp;",style:ka},V))});var aa=e.create("div",{"class":"esriLegendColorRampLabels",style:{height:P+this.gradientHeight+"px"}},O);G?w.forEach(C,function(ea){e.create("div",{"class":"esriLegendColorRampLabel",innerHTML:u.encode(ea.label)||"\x26nbsp;"},aa)}):(e.create("div",{"class":"esriLegendColorRampLabel",innerHTML:Y?u.encode(C[0].label)||
"\x26nbsp;":this._i18n.high},aa),e.create("div",{"class":"esriLegendColorRampLabel",innerHTML:Y?u.encode(C[C.length-1].label)||"\x26nbsp;":this._i18n.low,style:"top: "+(P+this.gradientHeight-2*this.gradientHeight)+"px;"},aa))},_showHeatRamp:function(O,C,G,L,P){var T=G.field;var Y=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},L);L=e.create("tbody",{},Y);(O._hoverLabel||O._hoverLabels||P)&&this._createHoverAction(Y,O,C,P);(T=T&&this.getField(O,T,C))&&this._addSubHeader(L,
this._getFieldAlias(T.name,O,C));C=this._getHeatmapStops(G);C.length&&this._drawGradientRamp(L,C,!1,O)},_getHeatmapStops:function(O){var C=O.colorStops;O=O.colors;if(C&&C[0]){var G=C.length-1;if(O=C[0]&&null!=C[0].ratio)(O=C[G])&&1!==O.ratio&&(C=C.slice(0),C.push({ratio:1,color:O.color}),G++);else{var L=C[0].value;var P=C[G].value-L;C=w.map(C,function(Y){return{color:Y.color,ratio:(Y.value-L)/P}})}}else if(O&&O[0]){G=O.length-1;var T=1/(O.length-1);C=w.map(O,function(Y,fa){return{color:Y,ratio:fa*
T}})}C=w.map(C,function(Y,fa){var ja="";0===fa?ja="Low":fa===G&&(ja="High");return{color:Y.color,label:ja,offset:1-Y.ratio}});return C.reverse()},_showDotDensityLegend:function(O,C,G,L){var P=G.legendOptions,T,Y=this.dotDensitySwatchSize,fa=Math.round(Y/2);if(P){var ja=P.backgroundColor;var ka=P.outline;var ta=P.valueUnit;var pa=P.dotCoverage}pa=(pa||this.dotCoverage)/100;var V=Math.round(Y*Y/Math.pow(G.dotSize,2)*pa);L=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},
L);var ca=e.create("tbody",{},L);(O._hoverLabel||O._hoverLabels)&&this._createHoverAction(L,O,C);this._addSubHeader(ca,y.substitute({value:G.dotValue,unit:ta||""},this.NLS_dotValue));w.forEach(G.fields,function(aa){aa=A.mixin({},aa);aa.numPoints=V;T=new W(G._generateImageSrc(Y,Y,[aa],{x:0,y:0},{x:Y,y:Y},ja),ka||G.outline,Y,Y);aa=this.getField(O,aa.name,C)||aa;this._buildRow_Renderer(O,T,null,u.encode(this._getFieldAlias(aa.name,O,C)),null,ca,{type:"path",path:"M "+-fa+","+-fa+" L "+fa+","+-fa+" L "+
fa+","+fa+" L "+-fa+","+fa+" L "+-fa+","+-fa+" E"})},this)},_showSizeLegend:function(O,C,G,L,P,T,Y,fa,ja){var ka=L.legendOptions;ka=ka&&ka.customValues;P=this._getSizeSymbol(G,P);if((!L.valueUnit||"unknown"===L.valueUnit)&&P&&(ka||null!=L.minSize&&null!=L.maxSize&&null!=L.minDataValue&&null!=L.maxDataValue||L.stops&&!(1>=L.stops.length))){ja=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(ja?"":" esriLegendSubFragment")},T);T=e.create("tbody",{},ja);(O._hoverLabel||
O._hoverLabels||fa)&&this._createHoverAction(ja,O,C,fa);(Y||L.valueExpression||L.legendOptions&&L.legendOptions.title)&&this._addSubHeader(T,this._getRampTitle(L,O,C));Y=(ja=(fa=L.field)&&!A.isFunction(fa))&&"cluster_count"===fa.toLowerCase();C=(C=ja?O.isFeatureReductionActive&&O.isFeatureReductionActive()?O.getFeatureReductionField(fa):this.getField(O,fa,C):null)&&"esriFieldTypeDate"===C.type;ka=ka||this._getDataValues(G,P,L,C,Y);var ta=ka.length-1;for(fa=ta;0<=fa;fa--){ja=ka[fa];P=xa.fromJson(P.toJson());
this._applySize(P,G,L,ja);ja=C?H.formatDate(ja,H.timelineDateFormatOptions):D.format(ja);var pa="";fa===ta?pa=this._specialChars.gt+" ":0===fa&&(pa=Y&&1===ka[fa]?"":this._specialChars.lt+" ");pa="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+u.encode(pa+ja)+"\x3c/span\x3e";this._buildRow_Renderer(O,P,null,pa,null,T)}}},_getSizeSymbol:function(O,C){if("esri.renderer.SimpleRenderer"===O.declaredClass)var G=O.symbol;else if("esri.renderer.VectorFieldRenderer"===O.declaredClass)G=O.defaultSymbol;else if("esri.renderer.UniqueValueRenderer"===
O.declaredClass||"esri.renderer.ClassBreaksRenderer"===O.declaredClass){G=O.infos[0].symbol;var L=1<O.infos.length}if(G=G&&-1!==G.type.indexOf("fillsymbol")?null:G)if(G=xa.fromJson(G.toJson()),C||L)-1!==G.type.indexOf("linesymbol")?G.setColor(new r(this.sizeRampDarkColor)):(G.setColor(new r(this.sizeRampLightColor)),G.setOutline&&(O=new ia,O.setColor(new r(this.sizeRampDarkColor)),O.setWidth(1.5),G.setOutline(O)));return G},_getDataValues:function(O,C,G,L,P){if(P){var T;w.some([5,3,2],function(Y){Y=
this._getDataValuesByCount(O,C,G,L,Y);this._hasFractionalValues(Y)||(T=Y);return!!T},this);return T}return(P=O.authoringInfo)&&"univariateColorSize"===P.type&&"above-and-below"===P.univariateTheme&&G.stops?this._getDataValuesFromStops(G,L):this._getDataValuesByCount(O,C,G,L,5)},_getDataValuesFromStops:function(O,C){O=w.map(O.stops,function(G){return G.value});return C?O:D.round(O)},_getDataValuesByCount:function(O,C,G,L,P,T){P=null==P?5:P;T=null==T?20:T;var Y=O.getSizeRangeAtScale(G,this.map.getScale());
P=this._interpolateSizeRange(Y,P);var fa=this._getDataRange(G),ja=w.map(P,function(ta){return this._getDataValueFromSize(ta,fa,Y)},this);if(!L){var ka;ja=D.round(ja);for(L=1;L<ja.length-1;L++)if(ka=this._roundDataValue(O,C,G,ja[L],ja[L-1],T))ja[L]=ka[0],P[L]=ka[1]}return ja},_hasFractionalValues:function(O){return w.some(O,function(C){return C!==Math.floor(C)})},_getDataRange:function(O){var C=O.stops;return C?{min:C[0].value,max:C[C.length-1].value}:{min:O.minDataValue,max:O.maxDataValue}},_interpolateSizeRange:function(O,
C){var G=O.minSize;O=(O.maxSize-G)/(C-1);var L,P=[];for(L=0;L<C;L++)P.push(G+O*L);return P},_getDataValueFromSize:function(O,C,G){var L=G.minSize;G=G.maxSize;var P=C.min;C=C.max;return O<=L?P:O>=G?C:(O-L)/(G-L)*(C-P)+P},_roundDataValue:function(O,C,G,L,P,T){var Y=this._getSize(C,O,G,L);P=this._getSize(C,O,G,P);var fa=D.getDigits(L),ja=fa.integer;fa=fa.fractional;var ka;if(0<L&&1>L){var ta=Math.pow(10,fa);L*=ta;ja=D.getDigits(L).integer}for(--ja;0<=ja;ja--){var pa=Math.pow(10,ja);fa=Math.floor(L/pa)*
pa;pa*=Math.ceil(L/pa);null!=ta&&(fa/=ta,pa/=ta);var V=(fa+pa)/2;V=D.round([fa,V,pa],{indexes:[1]})[1];var ca=this._getSize(C,O,G,fa);var aa=this._getSize(C,O,G,pa);var ea=this._getSize(C,O,G,V);var la=D.getPctChange(Y,ca,P,null);var oa=D.getPctChange(Y,aa,P,null);var za=D.getPctChange(Y,ea,P,null);var sa=la.prev<=T;var Ea=oa.prev<=T;sa&&Ea&&(la.prev<=oa.prev?(sa=!0,Ea=!1):(Ea=!0,sa=!1));sa?ka=[fa,ca]:Ea?ka=[pa,aa]:za.prev<=T&&(ka=[V,ea]);if(ka)break}return ka},_applySize:function(O,C,G,L){var P=
O.type;C=this._getSize(O,C,G,L);switch(P){case "simplemarkersymbol":O.setSize(C);break;case "picturemarkersymbol":P=O.width;G=O.height;O.setHeight(C);O.setWidth(P/G*C);break;case "simplelinesymbol":case "cartographiclinesymbol":O.setWidth(C);break;case "textsymbol":O.font&&O.font.setSize(C)}},_getSize:function(O,C,G,L){return C.getSize(L,{sizeInfo:G,scale:this.map.getScale(),shape:-1!==O.type.indexOf("markersymbol")?O.style:null})},_buildRow_Renderer:function(O,C,G,L,P,T,Y,fa){var ja=!!fa,ka=e.create("tr",
{},T);if(this.alignRight){if(T=e.create("td",{align:this._isRightToLeft?"left":"right"},ka),C||ja)var ta=e.create("td",{align:this._isRightToLeft?"left":"right",width:35},ka)}else{if(C||ja)ta=e.create("td",{width:35,align:"center"},ka);T=e.create("td",{},ka)}var pa=ka=30;if(C)if("simplemarkersymbol"===C.type)ka=Math.min(Math.max(ka,C.size+12),125),pa=Math.min(Math.max(pa,C.size+12),125);else if("picturemarkersymbol"===C.type)ka=Math.min(Math.max(ka,C.width),125),pa=Math.min(C.height||pa,125);else if("textsymbol"===
C.type){if(!C.text){var V=C.text;var ca=!0;C.setText(this.defaultText)}ka=Math.min(Math.max(ka,C.getWidth()+12),125);pa=Math.min(Math.max(pa,C.getHeight()+12),125);ca&&C.setText(V)}if(C||ja)var aa=e.create("div",{style:"width:"+ka+"px;height:"+pa+"px;"},ta);y.isDefined(L)&&"number"===typeof L&&(L=""+L);e.create("td",{innerHTML:L||"",align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},T))));if(C||ja)O=this._drawSymbol(aa,C,G,ka,pa,P,O,Y,fa),this._surfaceItems.push(O)},
_addSubHeader:function(O,C){O=e.create("tr",{},O);O=e.create("td",{align:this._align,colspan:2},O);e.create("td",{innerHTML:u.encode(C)||"",align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},O))))},_drawSymbol:function(O,C,G,L,P,T,Y,fa,ja){var ka=C&&xa.fromJson(C.toJson()),ta=Y.opacity;C=!!ja;if(ka)if(G&&ka.setColor(new r(G.toRgba())),"simplelinesymbol"===ka.type||"cartographiclinesymbol"===ka.type||"textsymbol"===ka.type){if(!ka.color)return;G=ka.color.toRgba();
G[3]*=ta;ka.color.setColor(G)}else"simplemarkersymbol"===ka.type||"simplefillsymbol"===ka.type?(ka.color&&(G=ka.color.toRgba(),G[3]*=ta,ka.color.setColor(G)),ka.outline&&ka.outline.color&&(G=ka.outline.color.toRgba(),G[3]*=ta,ka.outline.color.setColor(G))):"picturemarkersymbol"===ka.type&&(O.style.opacity=ta,O.style.filter="alpha(opacity\x3d("+100*ta+"))");O=p.createSurface(O,L,P);9>k("ie")&&(G=O.getEventSource(),a.set(G,"position","relative"),a.set(G.parentNode,"position","relative"));T=C?ja.shapeDescriptor:
this._getDrawingToolShape(ka,T)||xa.getShapeDescriptors(ka);ta=(G=T.defaultShape)&&"text"===G.type;try{ta&&!G.text&&(G.text=this.defaultText);var pa=O.createShape(fa||G).setFill(T.fill).setStroke(T.stroke);ta&&pa.setFont(T.font)}catch(aa){O.clear();O.destroy();return}var V=pa.getBoundingBox();fa=V.width;T=V.height;ta=-(V.x+fa/2);var ca=-(V.y+T/2);G=O.getDimensions();ta={dx:ta+G.width/2,dy:ca+G.height/2};if(ka&&"simplemarkersymbol"===ka.type&&"path"===ka.style)L=Y._getScaleMatrix(V,ka.size),pa.applyTransform(B.scaleAt(L.xx,
L.yy,{x:G.width/2,y:G.height/2}));else if(fa>L||T>P)Y=fa/L>T/P,L=((Y?L:P)-5)/(Y?fa:T),A.mixin(ta,{xx:L,yy:L});pa.applyTransform(ta);C&&pa.applyTransform(B.rotategAt(ja.rotation,fa/2,T/2));return O},_getDrawingToolShape:function(O,C){switch(C?C.drawingTool||null:null){case "esriFeatureEditToolArrow":C={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":C={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};break;case "esriFeatureEditToolRectangle":C=
{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};break;case "esriFeatureEditToolCircle":C={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":C={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:C,fill:O.getFill(),stroke:O.getStroke()}},_drawRelationshipLegend:function(O,C){var G=C.focus,L=C.numClasses,P=ra[L],T=!!G,Y=Math.sqrt(Math.pow(75,2)+Math.pow(75,2)),fa={};C.uvInfos.forEach(function(pa){fa[pa.value]={label:pa.label,fill:this._getSymbolColor(pa.symbol)}},
this);C=[];for(var ja=0;ja<L;ja++){for(var ka=[],ta=0;ta<L;ta++)ka.push(fa[P[ja][ta]].fill);C.push(ka)}P=this._getRelationshipCornerLabels(G,fa);O=this._drawRampLayout(O,P,Y,T);O=p.createSurface(O,Y,Y);T||(O.rawNode.style.margin="-15px -15px -18px -15px");C=ha.create2DColorRamp({surface:O,colors:C,numClasses:L,size:75});L=(Y-75)/2;Y=(Y-75)/2;C.applyTransform(B.translate(L,Y));T&&C.applyTransform(B.rotategAt(this._getRotationAngleForFocus(G),37.5,37.5));C=O.createGroup();P={width:1,color:"#555555"};
ja=O.defNode;this._createArrowMarker(ja,"start");this._createArrowMarker(ja,"end");ja=C.createLine({x1:-10,y1:60,x2:-10,y2:15}).setStroke(P);P=C.createLine({x1:15,y1:85,x2:60,y2:85}).setStroke(P);this._setLineArrow(ja.rawNode,"left",G);this._setLineArrow(P.rawNode,"right",G);C.applyTransform(B.translate(L,Y));T&&C.applyTransform(B.rotategAt(-45,37.5,37.5));this._surfaceItems.push(O)},_drawRampLayout:function(O,C,G,L){var P=e.create("div",{style:{padding:"10px"}},O);O=G+"px";var T=G+"px";G="rtl"===
document.dir;L?(L=e.create("div",{style:{display:"flex"}},P),e.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:O,textAlign:"right"},innerHTML:G?C.right:C.left},L),P=e.create("div",{style:{display:"flex",flexDirection:"column",textAlign:"center"}},L),e.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:O},innerHTML:G?C.left:C.right},L),L=e.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:O},innerHTML:C.top},
P),L=e.create("div",{style:{height:T,width:T}},P),P=e.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:O},innerHTML:C.bottom},P)):(P=e.create("div",{style:{display:"table",color:"#555555"}},P),L=e.create("div",{style:{display:"table-row"}},P),T=e.create("div",{style:{display:"table-row"}},P),P=e.create("div",{style:{display:"table-row"}},P),e.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:O,textAlign:"right",verticalAlign:"bottom"},
innerHTML:G?C.top:C.left},L),e.create("div",{style:{display:"table-cell"}},L),e.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:O,textAlign:"left",verticalAlign:"bottom"},innerHTML:G?C.left:C.top},L),e.create("div",{style:{display:"table-cell"}},T),L=e.create("div",{style:{display:"table-cell"}},T),e.create("div",{style:{display:"table-cell"}},T),e.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:O,textAlign:"right",verticalAlign:"top"},
innerHTML:G?C.right:C.bottom},P),e.create("div",{style:{display:"table-cell"}},P),e.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:O,textAlign:"left",verticalAlign:"top"},innerHTML:G?C.bottom:C.right},P));return L},_getSymbolColor:function(O){if(O)return"simplelinesymbol"===O.type||"simplemarkersymbol"===O.type&&(O.style===X.STYLE_X||O.style===X.STYLE_CROSS)?(O=O.getStroke())&&O.color:O.getFill()},_getRotationAngleForFocus:function(O){var C=Z[O];O&&null==C&&
(C=Z.HH);return C},_setLineArrow:function(O,C,G){var L=this.id+"_arrowStart",P=this.id+"_arrowEnd";C="left"===C;switch(G){case "HL":O.setAttribute(C?"marker-start":"marker-end","url(#"+(C?P:L)+")");break;case "LL":O.setAttribute("marker-start","url(#"+P+")");break;case "LH":O.setAttribute(C?"marker-end":"marker-start","url(#"+(C?L:P)+")");break;default:O.setAttribute("marker-end","url(#"+L+")")}},_createArrowMarker:function(O,C){var G="start"===C,L=this.id+(G?"_arrowStart":"_arrowEnd");C=G?"0,0 5,5 0,10":
"5,0 0,5 5,10";var P=G?5:0;G=document.createElementNS("http://www.w3.org/2000/svg","marker");G.setAttribute("id",L);G.setAttribute("markerWidth","10");G.setAttribute("markerHeight","10");G.setAttribute("refX",P);G.setAttribute("refY","5");G.setAttribute("markerUnits","strokeWidth");G.setAttribute("orient","auto");L=document.createElementNS("http://www.w3.org/2000/svg","polyline");L.setAttribute("points",C);L.setAttribute("fill","none");L.setAttribute("stroke","#555555");L.setAttribute("stroke-width",
"1");G.appendChild(L);O.appendChild(G)},_getRelationshipCornerLabels:function(O,C){var G=C.HH.label,L=C.LL.label,P=C.HL.label;C=C.LH.label;switch(O){case "HH":return{top:G,bottom:L,left:P,right:C};case "HL":return{top:P,bottom:C,left:L,right:G};case "LL":return{top:L,bottom:G,left:C,right:P};case "LH":return{top:C,bottom:P,left:G,right:L};default:return{top:G,bottom:L,left:P,right:C}}},_repaintItems:function(){w.forEach(this._surfaceItems,function(O){this._repaint(O)},this)},_repaint:function(O){if(O){O.getStroke&&
O.setStroke&&O.setStroke(O.getStroke());try{O.getFill&&O.setFill&&O.setFill(O.getFill())}catch(C){}O.children&&A.isArray(O.children)&&w.forEach(O.children,this._repaint,this)}},_createHoverAction:function(O,C,G,L){if(L=C._hoverLabel||C._hoverLabels&&C._hoverLabels[G.id]||L)L=u.encode(L),C.mouseMoveHandler=C.mouseMoveHandler||{},C.mouseMoveHandler[G.id]=m.connect(O,"onmousemove",A.hitch(this,function(P,T){this.mouseX=T.clientX;this.mouseY=T.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,
a.set(b.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(A.hitch(this,function(Y,fa,ja){if(Y==this.mouseX&&fa==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,b.byId(this.id+"_hoverLabel")){var ka=b.byId(this.id+"_hoverLabel");ka.innerHTML="\x3cspan\x3e"+ja+"\x3c/span\x3e";a.set(ka,"top",fa+"px");a.set(ka,"left",Y+15+"px");a.set(ka,"display","")}else e.create("div",{innerHTML:"\x3cspan\x3e"+ja+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:fa+
"px",left:Y+15+"px"}},document.body)},T.clientX,T.clientY,P),500)},L)),C.mouseOutHandler=C.mouseOutHandler||{},C.mouseOutHandler[G.id]=m.connect(O,"onmouseout",A.hitch(this,function(P){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,a.set(b.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var O;w.forEach(this.layers,function(C){if(C.mouseMoveHandler)for(O in C.mouseMoveHandler)m.disconnect(C.mouseMoveHandler[O]);if(C.mouseOutHandler)for(O in C.mouseOutHandler)m.disconnect(C.mouseOutHandler[O])})},
_createDynamicLayers:function(O){var C=[],G;w.forEach(O.dynamicLayerInfos||O.layerInfos,function(L){G={id:L.id};G.source=L.source&&L.source.toJson();var P;O.layerDefinitions&&O.layerDefinitions[L.id]&&(P=O.layerDefinitions[L.id]);P&&(G.definitionExpression=P);var T;O.layerDrawingOptions&&O.layerDrawingOptions[L.id]&&(T=O.layerDrawingOptions[L.id]);T&&(G.drawingInfo=T.toJson());G.minScale=L.minScale||0;G.maxScale=L.maxScale||0;C.push(G)});return C},_getTemplateFromTypes:function(O,C){var G;for(G=0;G<
O.length;G++)if(O[G].id==C&&O[G].templates&&0<O[G].templates.length)return O[G].templates[0];return null},_findParentGroup:function(O,C,G){var L,P=C.dynamicLayerInfos||C.layerInfos;for(L=0;L<P.length;L++)if(G==P[L].id){-1<P[L].parentLayerId&&(a.set(b.byId(this.id+"_"+O+"_"+P[L].parentLayerId+"_group"),"display","block"),this._findParentGroup(O,C,P[L].parentLayerId));break}},_addSubLayersToHide:function(O){function C(G,L){var P=O.layer.dynamicLayerInfos||O.layer.layerInfos,T,Y;for(T=0;T<P.length;T++)if(P[T].id===
G&&P[T].subLayerIds)for(Y=0;Y<P[T].subLayerIds.length;Y++){var fa=P[T].subLayerIds[Y];-1===w.indexOf(L,fa)&&(L.push(fa),C(fa,L))}}O.layer.layerInfos&&w.forEach(this.hideLayersInLegend[O.layer.id],function(G){C(G,this.hideLayersInLegend[O.layer.id])},this)},_isLayerInScale:function(O,C,G){var L,P=!0;if(O.legendResponse&&O.legendResponse.layers)for(L=0;L<O.legendResponse.layers.length;L++){var T=O.legendResponse.layers[L];if(C.id==T.layerId){if(!O.minScale&&0!==O.minScale||!O.maxScale&&0!==O.maxScale){if(0==
T.minScale&&O.tileInfo)var Y=O.tileInfo.lods[0].scale;if(0==T.maxScale&&O.tileInfo)var fa=O.tileInfo.lods[O.tileInfo.lods.length-1].scale}else Y=Math.min(O.minScale,T.minScale)||O.minScale||T.minScale,fa=Math.max(O.maxScale,T.maxScale);if(0<Y&&Y<G||fa>G)P=!1;break}}else if(O.minScale||O.maxScale)if(O.minScale&&O.minScale<G||O.maxScale&&O.maxScale>G)P=!1;return P},_getServiceTitle:function(O){var C=O._titleForLegend;C||(C=O.url,O.url?-1<O.url.indexOf("/MapServer")?(C=O.url.substring(0,O.url.indexOf("/MapServer")),
C=C.substring(C.lastIndexOf("/")+1,C.length)):-1<O.url.indexOf("/ImageServer")?(C=O.url.substring(0,O.url.indexOf("/ImageServer")),C=C.substring(C.lastIndexOf("/")+1,C.length)):-1<O.url.indexOf("/FeatureServer")&&(C=O.url.substring(0,O.url.indexOf("/FeatureServer")),C=C.substring(C.lastIndexOf("/")+1,C.length)):C="",O.name&&(C=0<C.length?C+(" - "+O.name):O.name));"esri.layers.ArcGISImageServiceVectorLayer"===O.declaredClass&&O.vectorFieldPixelFilter&&(O=O.vectorFieldPixelFilter.outputUnit?this["NLS_"+
O.vectorFieldPixelFilter.outputUnit]:this["NLS_"+O.vectorFieldPixelFilter.inputUnit],y.isDefined(O)&&(C+=" ("+O+")"));return u.encode(C)},_getEffectiveScale:function(O,C){var G=C.minScale,L=C.maxScale;if(y.isDefined(C.parentLayerId)){O=O.layerInfos;C=C.parentLayerId;var P;for(P=O.length-1;0<=P;P--)if(O[P].id==C)if(0==G&&0<O[P].minScale?G=O[P].minScale:0<G&&0==O[P].minScale||0<G&&0<O[P].minScale&&(G=Math.min(G,O[P].minScale)),L=Math.max(L||0,O[P].maxScale||0),-1<O[P].parentLayerId)C=O[P].parentLayerId;
else break}return{minScale:G,maxScale:L}},_isSupportedLayerType:function(O){return!(!O||!("esri.layers.ArcGISDynamicMapServiceLayer"===O.declaredClass||"esri.layers.ArcGISImageServiceLayer"===O.declaredClass&&10.2<=O.version||"esri.layers.RasterXLayer"===O.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===O.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===O.declaredClass||"esri.layers.FeatureLayer"===O.declaredClass||"esri.layers.StreamLayer"===O.declaredClass||"esri.layers.KMLLayer"===
O.declaredClass||"esri.layers.GeoRSSLayer"===O.declaredClass||"esri.layers.WMSLayer"===O.declaredClass||"esri.layers.WFSLayer"===O.declaredClass||"esri.layers.CSVLayer"===O.declaredClass))},isHostedTileService:function(O){var C=/(https?:)?\/\/services.*\.arcgis\.com/i;return!("esri.layers.ArcGISTiledMapServiceLayer"!==O.declaredClass||!C.test(O.url))},getField:function(O,C,G){if(O.getField)return O.getField(C);if(G&&G.fields){var L;w.forEach(G.fields,function(P){P.name===C&&(L=P)});return L}return null}});
A.mixin(Ca,{ALIGN_LEFT:0,ALIGN_RIGHT:1});k("extend-esri")&&A.setObject("dijit.Legend",Ca,t);return Ca})},"dojo/debounce":function(){define([],function(){return function(E,q){var A;return function(){A&&clearTimeout(A);var w=this,m=arguments;A=setTimeout(function(){E.apply(w,m)},q)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(E,q,A,w){var m=function(r,l){return r-l},v={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(r){var l=
String(r),k=l.match(v._reNumber);r={integer:0,fractional:0};k&&k[1]?(r.integer=k[1].split("").length,r.fractional=k[3]?k[3].split("").length:0):-1<l.toLowerCase().indexOf("e")&&(k=l.split("e"),l=k[0],k=k[1],l&&k&&(l=Number(l),k=Number(k),(r=0<k)||(k=Math.abs(k)),l=v.getDigits(l),r?(l.integer+=k,l.fractional=k>l.fractional?0:l.fractional-k):(l.fractional+=k,l.integer=k>l.integer?1:l.integer-k),r=l));return r},getFixedNumbers:function(r,l){var k=Number(r.toFixed(l));k<r?r=k+1/Math.pow(10,l):(r=k,k-=
1/Math.pow(10,l));k=Number(k.toFixed(l));r=Number(r.toFixed(l));return[k,r]},getPctChange:function(r,l,k,n){var d={prev:null,next:null};if(null!=k){var c=r-k;d.prev=Math.floor(Math.abs(100*(l-k-c)/c))}null!=n&&(c=n-r,d.next=Math.floor(Math.abs(100*(n-l-c)/c)));return d},round:function(r,l){r=r.slice(0);var k,n,d=l&&null!=l.tolerance?l.tolerance:2,c=l&&l.indexes,g=l&&null!=l.strictBounds?l.strictBounds:!1;if(c)c.sort(m);else for(c=[],k=0;k<r.length;k++)c.push(k);for(k=0;k<c.length;k++){var b=c[k];
l=r[b];var e=0===b?null:r[b-1];var a=b===r.length-1?null:r[b+1];var f=v.getDigits(l);if(f=f.fractional){var h=0;for(n=!1;h<=f&&!n;){var p=v.getFixedNumbers(l,h);p=g&&0===k?p[1]:p[0];n=v.hasMinimalChange(l,p,e,a,d);h++}n&&(r[b]=p)}}return r},hasMinimalChange:function(r,l,k,n,d){r=v.getPctChange(r,l,k,n);l=null==r.prev||r.prev<=d;k=null==r.next||r.next<=d;return l&&k||r.prev+r.next<=2*d},_reAllZeros:new RegExp("\\"+A.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$","g"),format:function(r,l){l=l||{places:20,
round:-1};(r=q.format(r,l))&&(r=r.replace(v._reSomeZeros,"$1").replace(v._reAllZeros,""));return r}};E("extend-esri")&&(w.numberUtils=v);return v})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(E,q,A,w,m,v,r,l){function k(f){return f&&q.map(f,function(h){return new r(h)})}function n(f,h,p){var B="";0===h?B=c.lt+" ":h===p&&(B=c.gt+" ");return B+f}var d={},
c={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},g={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},b={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},
month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},e={formatLength:"short",fullYear:!0},a={formatLength:"short"};E.mixin(d,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(f,h){var p=[];null==f||f instanceof Date||(f=new Date(f));h=h||{};h=E.mixin({},h);var B=h.selector?h.selector.toLowerCase():null,u=!B||-1<B.indexOf("time");B=!B||-1<B.indexOf("date");u&&(h.timeOptions=h.timeOptions||
a,h.timeOptions&&(h.timeOptions=E.mixin({},h.timeOptions),h.timeOptions.selector=h.timeOptions.selector||"time",p.push(h.timeOptions)));B&&(h.dateOptions=h.dateOptions||e,h.dateOptions&&(h.dateOptions=E.mixin({},h.dateOptions),h.dateOptions.selector=h.dateOptions.selector||"date",p.push(h.dateOptions)));p&&p.length?(p=q.map(p,function(t){return w.format(f,t)}),h=1==p.length?p[0]:l["dateTimeFormat-medium"].replace(/'/g,"").replace(/\{(\d+)\}/g,function(t,z){return p[z]})):h=w.format(f);return h},createColorStops:function(f){var h=
f.values,p=f.colors,B=f.labelIndexes,u=f.isDate,t=f.dateFormatOptions;f=[];return f=q.map(h,function(z,x){var y=null;if(!B||-1<q.indexOf(B,x)){var D;(D=u?d.formatDate(z,t):v.format(z))&&(y=n(D,x,h.length-1))}return{value:z,color:p[x],label:y}})},updateColorStops:function(f){var h=f.stops,p=f.changes,B=f.isDate,u=f.dateFormatOptions,t=[],z=q.map(h,function(y){return y.value});q.forEach(p,function(y){t.push(y.index);z[y.index]=y.value});var x=v.round(z,{indexes:t});q.forEach(h,function(y,D){y.value=
z[D];if(null!=y.label){var H,I=null;(H=B?d.formatDate(x[D],u):v.format(x[D]))&&(I=n(H,D,h.length-1));y.label=I}})},createClassBreakLabel:function(f){var h=f.minValue,p=f.maxValue,B=f.isFirstBreak?"":c.gt+" ";f="percent-of-total"===f.normalizationType?c.pct:"";h=null==h?"":v.format(h);p=null==p?"":v.format(p);return B+h+f+" \u2013 "+p+f},setLabelsForClassBreaks:function(f){var h=f.classBreaks,p=f.classificationMethod,B=f.normalizationType,u=[];h&&h.length&&("standard-deviation"===p?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):
f.round?(u.push(h[0].minValue),q.forEach(h,function(t){u.push(t.maxValue)}),u=v.round(u),q.forEach(h,function(t,z){t.label=d.createClassBreakLabel({minValue:0===z?u[0]:u[z],maxValue:u[z+1],isFirstBreak:0===z,normalizationType:B})})):q.forEach(h,function(t,z){t.label=d.createClassBreakLabel({minValue:t.minValue,maxValue:t.maxValue,isFirstBreak:0===z,normalizationType:B})}))},updateClassBreak:function(f){var h=f.classBreaks,p=f.normalizationType,B=f.change,u=B.index;B=B.value;var t=-1,z=-1,x=h.length;
"standard-deviation"===f.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===u?t=u:u===x?z=u-1:(z=u-1,t=u),-1<t&&t<x&&(f=h[t],f.minValue=B,f.label=d.createClassBreakLabel({minValue:f.minValue,maxValue:f.maxValue,isFirstBreak:0===t,normalizationType:p})),-1<z&&z<x&&(f=h[z],f.maxValue=B,f.label=d.createClassBreakLabel({minValue:f.minValue,maxValue:f.maxValue,isFirstBreak:0===z,normalizationType:p})))},calculateDateFormatInterval:function(f){var h,
p,B=f.length,u=Infinity;f=q.map(f,function(N){return new Date(N)});for(h=0;h<B-1;h++){var t=f[h];var z=[];var x=Infinity;var y="";for(p=h+1;p<B;p++){var D=f[p];D=t.getFullYear()!==D.getFullYear()&&"year"||t.getMonth()!==D.getMonth()&&"month"||t.getDate()!==D.getDate()&&"day"||t.getHours()!==D.getHours()&&"hour"||t.getMinutes()!==D.getMinutes()&&"minute"||t.getSeconds()!==D.getSeconds()&&"second"||"millisecond";var H=g[D];H<x&&(x=H,y=D);z.push(D)}if(x<u){u=x;var I=y}}return I},createUniqueValueLabel:function(f){var h=
f.value,p=f.fieldInfo,B=f.domain;f=f.dateFormatInterval;var u=String(h);(B=B&&B.codedValues?B.getName(h):null)?u=B:"number"===typeof h&&(u=p&&"esriFieldTypeDate"===p.type?d.formatDate(h,f&&b[f]):v.format(h));return u},cloneColorInfo:function(f){if(f){var h=E.mixin({},f);h.colors=k(h.colors);h.stops=h.stops&&q.map(h.stops,function(p){p=E.mixin({},p);p.color&&(p.color=new r(p.color));return p});h.legendOptions&&(h.legendOptions=E.mixin({},h.legendOptions))}return h},cloneOpacityInfo:function(f){if(f){var h=
E.mixin({},f);if(f=h.opacityValues)h.opacityValues=f.slice(0);if(f=h.stops)h.stops=q.map(f,function(p){return E.mixin({},p)});if(f=h.legendOptions)h.legendOptions=E.mixin({},f)}return h},cloneSizeInfo:function(f){if(f){var h=E.mixin({},f);h.stops&&(h.stops=q.map(h.stops,function(p){return E.mixin({},p)}));(f=h.minSize)&&"object"===typeof f&&(h.minSize=d.cloneSizeInfo(f));(f=h.maxSize)&&"object"===typeof f&&(h.maxSize=d.cloneSizeInfo(f));if(f=h.legendOptions)if(h.legendOptions=E.mixin({},f),f=f.customValues)h.legendOptions.customValues=
f.slice(0)}return h},getClassCodesForRelationship:function(){return E.clone({2:["L","H"],3:["L","M","H"],4:["L","M1","M2","H"]})},getClassValuesForRelationship:function(){return E.clone({2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]})}});A("extend-esri")&&E.setObject("renderer.utils",d,m);return d})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define("dojo/_base/declare dojo/_base/array dojo/Deferred esri/lang jimu/utils ./LayerInfo".split(" "),
function(E,q,A,w,m,v){return E(v,{constructor:function(){},_getExtent:function(){var r=new A,l=this.layerObject.items,k=this.layerObject.fullExtent||this.layerObject.initialExtent;0===l.length?r.resolve(k):r.resolve(m.graphicsExtent(l));return r},_resetLayerObjectVisiblity:function(r){var l=r?r[this.id]:null;if(l){var k={},n;for(n in r)r.hasOwnProperty(n)&&"function"!==typeof r[n]&&(k[n]=r[n].visible);this._setSubLayerVisibleByCheckedInfo(k);this._setTopLayerVisible(l.visible)}},_setSubLayerVisibleByCheckedInfo:function(r){q.forEach(this.newSubLayers,
function(l){w.isDefined(r[l.id])&&l.layerObject.setVisibility(r[l.id])},this)},_initVisible:function(){var r=!1,l;for(l=0;l<this.newSubLayers.length;l++)r=r||this.newSubLayers[l].layerObject.visible;r&&(this._visible=!0)},_setTopLayerVisible:function(r){this._visible=r?!0:!1;q.forEach(this.newSubLayers,function(l){l.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var r=[],l=this.layerObject.getFeatureLayers();q.forEach(l,function(k){k=this._layerInfoFactory.create({layerObject:k,
title:k.label||k.title||k.name||k.id||" ",id:k.id||" ",subId:k.id||" ",collection:{layerInfo:this},selfType:"geo_rss",parentLayerInfo:this});r.push(k);k.init()},this);this._markInvalidSubLayerInfoThatAsRootLayer(l);return r},_markInvalidSubLayerInfoThatAsRootLayer:function(r){var l;q.forEach(r,function(k){if(l=this._getLayerInfosObj()._findTopLayerInfoById(k.id))l._flag._invalid=!0},this)},_needToRenew:function(){var r=this.layerObject.getFeatureLayers();return(r?r.length:0)===this.newSubLayers.length?
!1:!0},_obtainLayerIndexesInMap:function(){var r=[],l,k;for(k=0;k<this.newSubLayers.length;k++)(l=this._getLayerIndexesInMapByLayerId(this.newSubLayers[k].layerObject.id))&&r.push(l);return r},moveLeftOfIndex:function(r){var l;for(l=this.newSubLayers.length-1;0<=l;l--)this.map.reorderLayer(this.newSubLayers[l].layerObject,r)},moveRightOfIndex:function(r){var l;for(l=0;l<this.newSubLayers.length;l++)this.map.reorderLayer(this.newSubLayers[l].layerObject,r)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/topic dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS esri/layers/FeatureLayer esri/lang".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d){return E(l,{constructor:function(c,g){},_getExtent:function(){var c=new m;c.resolve(this.layerObject.extent||this.layerObject.fullExtent);return c},_initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(c){this._visible=c;this.layerObject.setVisibility(c)},_setSubLayerVisible:function(c){var g=[];g=A.clone(this.originOperLayer.layerObject.visibleLayers);for(var b in c)if(c.hasOwnProperty(b)&&"function"!==typeof c[b]){var e=c[b],
a=b.toString();var f=q.indexOf(g,a);e?0>f&&g.push(a):0<=f&&g.splice(f,1)}this._setVisibleLayersBySelfFlag=!0;this.layerObject.setVisibleLayers(g)},_resetLayerObjectVisiblity:function(c){var g=c?c[this.id]:null,b=!1;if(c){g&&this.layerObject.setVisibility(g.visible);g={};for(var e in c)c.hasOwnProperty(e)&&"function"!==typeof c[e]&&(b=!0,g[e]=c[e].visible);b&&this._setSubLayerVisibleByCheckedInfo(g)}},_setSubLayerVisibleByCheckedInfo:function(c){var g={};this.traversal(function(b){b.isRootLayer()||
d.isDefined(c[b.id])&&b._setVisible(c[b.id])});this.traversal(function(b){0===b.getSubLayers().length&&(g[b.subId]=b._isAllSubLayerVisibleOnPath())});this._setSubLayerVisible(g)},_getServiceDefinition:function(){var c=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(c)},_serviceDefinitionRequest:function(c){return this._normalRequest(c,{SERVICE:"WMS",REQUEST:"GetCapabilities"},"xml")},obtainNewSubLayers:function(){var c=[];q.forEach(this.layerObject.layerInfos,function(g,
b){g=this._getOperLayerFromWMSLayerInfo(g,this);g=this._layerInfoFactory.create(g);c.push(g);g.init()},this);c.reverse();return c},_getOperLayerFromWMSLayerInfo:function(c,g){return{layerObject:this.layerObject,title:c.label||c.title||c.name||" ",id:this.id+"_"+(c.name||c.title+"-"+Math.random()),subId:c.name||"-",wms:{layerInfo:this,subId:c.name||"-",wmsLayerInfo:c},selfType:"wms",parentLayerInfo:g}},_bindEvent:function(){this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&r.after(this.layerObject,
"setVisibleLayers",A.hitch(this,this._onVisibleLayersChanged))},_onVisibleLayersChanged:function(){var c=[];this._setVisibleLayersBySelfFlag||(this.traversal(function(g){g.isRootLayer()||g._initVisible()}),this._setVisibleLayersBySelfFlag=!1);this.traversal(function(g){g.isRootLayer()||c.push(g)});this._setVisibleLayersBySelfFlag=!1;w.publish("layerInfos/layerInfo/visibleChanged",c);this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/Deferred dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),
function(E,q,A,w,m,v,r){return E(r,{constructor:function(l,k){this.layerObject=l.layerObject},_resetLayerObjectVisiblity:function(){},_initVisible:function(){var l=!1;this.traversal(function(k){if(0<=q.indexOf(k.layerObject.visibleLayers,k.subId))return l=!0});this._visible=l},_setVisible:function(l){this._visible=l?!0:!1},_setTopLayerVisible:function(l){var k=this.originOperLayer.wms;this._visible=l?!0:!1;var n={};this.traversal(function(d){0===d.getSubLayers().length&&(n[d.subId]=d._isAllSubLayerVisibleOnPath())});
k.layerInfo._setSubLayerVisible(n)},_getServiceDefinition:function(){var l=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(l)},_serviceDefinitionRequest:function(l){return this._normalRequest(l,{SERVICE:"WMS",REQUEST:"GetCapabilities"},"xml")},obtainNewSubLayers:function(){var l=[],k=this.originOperLayer.wms;q.forEach(k.wmsLayerInfo.subLayers,function(n){n=k.layerInfo._getOperLayerFromWMSLayerInfo(n,this);n=this._layerInfoFactory.create(n);l.push(n);n.init()},this);
return l},drawLegends:function(l){this._initLegendsNode(l)},_initLegendsNode:function(l){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var k=m.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});v(k,"load",function(){m.empty(l);var n=m.create("div",{"class":"legend-div"},l);A.place(k,n)})}else m.empty(l)},getOpacity:function(){},setOpacity:function(l){},enablePopup:function(){this.originOperLayer.wms.wmsLayerInfo.showPopup=!0},disablePopup:function(){this.originOperLayer.wms.wmsLayerInfo.showPopup=
!1},isPopupEnabled:function(){return this.originOperLayer.wms.wmsLayerInfo.showPopup},isSupportPopup:function(){var l=new w;this.originOperLayer.wms.wmsLayerInfo.queryable?l.resolve(!0):l.resolve(!1);return l},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.originOperLayer.wms.layerInfo.getScaleRange()}})})},"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(E,q){return E(q,
{constructor:function(A,w){},_initVisible:function(){var A=!1,w=this.originOperLayer.mapService;w&&w.layerInfo._subLayerVisible[w.subId]&&(A=!0);this._visible=A},_setTopLayerVisible:function(A){var w=this.originOperLayer.mapService;if(w){w.layerInfo._subLayerVisible[w.subId]=A?!0:!1;this._visible=A;var m={};this.traversal(function(v){0===v.getSubLayers().length&&(m[v.originOperLayer.mapService.subId]=v._isAllSubLayerVisibleOnPath())});w.layerInfo._setSubLayerVisible(m)}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/topic dojo/dom-construct ./LayerInfoForDefault ./LayerObjectFacory ../utils".split(" "),
function(E,q,A,w,m,v,r,l,k){return E(r,{_legendsNode:null,_layerObjectFacory:null,constructor:function(){this._layerObjectFacory=new l(this)},_resetLayerObjectVisiblity:function(){},_loadLegends:function(n){var d=new w;this.originOperLayer.mapService.layerInfo.getLegendInfo(n).then(A.hitch(this,function(c){d.resolve(c)}));return d},drawLegends:function(n,d){this._loadLegends(d).then(A.hitch(this,function(c){this._initLegendsNode(c,n)}))},_initLegendsNode:function(n,d){var c=this.originOperLayer.mapService;
if(n){v.empty(d);for(var g=null,b=0;b<n.length;b++)if(n[b].layerId===c.subId){g=n[b];break}if(g){var e=v.create("table",{"class":"legend-table",style:"font-size: 12px"},d);q.forEach(g.legend,function(a){if("\x3call other values\x3e"!==a.label){var f=v.create("tr",{"class":"legend-tr",style:"border: 1px solid"},e),h=v.create("td",{"class":"legend-symbol-td",style:""},f),p=null;p=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;v.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",
src:p},h);v.create("td",{"class":"legend-label-td",innerHTML:k.sanitizeHTML(a.label)||" ",style:"padding-left: 5px"},f)}},this)}}},_initControlPopup:function(){var n=this.originOperLayer.mapService.layerInfo.layerObject,d=this.originOperLayer.mapService.subId;this.controlPopupInfo={enablePopup:n.infoTemplates&&n.infoTemplates[d]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var n=this.originOperLayer.mapService.layerInfo.layerObject,d=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&
n.infoTemplates&&delete n.infoTemplates[d]},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},_getServiceDefinition:function(){return this.originOperLayer.mapService.layerInfo._getSubserviceDefinition(this.originOperLayer.mapService.mapServiceSubId)},_getLayerObject:function(n){var d=new w;(n?this._layerObjectFacory.getLayerObjectWithUrl(n):this._layerObjectFacory.getLayerObject()).then(A.hitch(this,
function(c){this.layerObject.empty&&c&&(this.layerObject=c);d.resolve(c)}));return d},getLayerObject:function(){return this._getLayerObject()},getLayerObjectTryUsingFeatureService:function(){var n;return this.isItemLayer()?this.getItemInfo().then(A.hitch(this,function(d){d&&d.getItemData()&&d.getItemData().layers&&q.some(d.getItemData().layers,function(c){if(c.id===this.subId)return n=c.layerUrl,!0},this);return n?this._getLayerObject(n):this._getLayerObject()})):this.getLayerObject()},getPopupInfo:function(){var n=
null,d=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(d)for(var c=0;c<d.length;c++)if(d[c].id===this.originOperLayer.mapService.subId){n=d[c].popupInfo;break}return n},getFilterOfWebmap:function(){var n=null,d=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(d)for(var c=0;c<d.length;c++)if(d[c].id===this.originOperLayer.mapService.subId){n=d[c].layerDefinition?d[c].layerDefinition.definitionExpression:null;break}return n},getFilter:function(){var n=this.originOperLayer.mapService;
return n.layerInfo.layerObject&&n.layerInfo.layerObject.layerDefinitions?n.layerInfo.layerObject.layerDefinitions[n.subId]:null},setFilter:function(n,d){var c=this.originOperLayer.mapService;if(c.layerInfo.layerObject&&c.layerInfo.layerObject.setLayerDefinitions){var g=c.layerInfo.layerObject.layerDefinitions?q.map(c.layerInfo.layerObject.layerDefinitions,function(b){return b}):[];d=A.mixin({},d);A.setObject("_wabProperties.objectPassWithFilterChangeEvent",d,c.layerInfo.layerObject);g[c.subId]=n;
c.layerInfo.layerObject.setLayerDefinitions(g)}},getLayerType:function(){var n=new w;0<this.getSubLayers().length?n.resolve("GroupLayer"):this._getServiceDefinition().then(A.hitch(this,function(d){d?n.resolve(d.type.replace(/ /g,"")):n.resolve(null)}),function(){n.resolve(null)});return n},getSupportTableInfo:function(){var n=new w,d={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(A.hitch(this,function(c){d.layerType=c;0<=this._getLayerTypesOfSupportTable().indexOf(c)&&
(d.isSupportedLayer=!0);this._getServiceDefinition().then(A.hitch(this,function(g){g&&g.capabilities&&0<=g.capabilities.indexOf("Data")&&(d.isSupportQuery=!0);n.resolve(d)}),function(){n.resolve(d)})}),function(){n.resolve(d)});return n},enablePopup:function(){var n=this.originOperLayer.mapService.layerInfo,d=n.layerObject,c=this.originOperLayer.mapService.subId;return this.loadInfoTemplate().then(A.hitch(this,function(){return n.controlPopupInfo.infoTemplates&&n.controlPopupInfo.infoTemplates[c]?
(this.controlPopupInfo.enablePopup=!0,d.infoTemplates||(d.infoTemplates={}),d.infoTemplates[c]=n.controlPopupInfo.infoTemplates[c],!0):!1}))},disablePopup:function(){var n=this.originOperLayer.mapService.layerInfo.layerObject,d=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!1;n.infoTemplates&&delete n.infoTemplates[d]},loadInfoTemplate:function(){var n=new w,d=this.originOperLayer.mapService.layerInfo,c=this.originOperLayer.mapService.subId;d.controlPopupInfo.infoTemplates&&
d.controlPopupInfo.infoTemplates[c]&&d.controlPopupInfo.infoTemplates[c].infoTemplate?n.resolve(d.controlPopupInfo.infoTemplates[c].infoTemplate):(d.controlPopupInfo.infoTemplates||(d.controlPopupInfo.infoTemplates={}),this.getLayerObject().then(A.hitch(this,function(g){g=this._getDefaultPopupTemplate(g);d.controlPopupInfo.infoTemplates[c]={infoTemplate:g,layerUrl:null};n.resolve(g)}),A.hitch(this,function(){n.resolve(null)})));return n},getInfoTemplate:function(){var n=this.originOperLayer.mapService.layerInfo,
d=this.originOperLayer.mapService.subId;return n.controlPopupInfo.infoTemplates&&n.controlPopupInfo.infoTemplates[d]&&n.controlPopupInfo.infoTemplates[d].infoTemplate?n.controlPopupInfo.infoTemplates[d].infoTemplate:null},getScaleRange:function(){var n=this.originOperLayer.mapService;return(n=n.layerInfo._getJsapiLayerInfoById(n.subId))&&0<=n.minScale&&0<=n.maxScale?{minScale:n.minScale,maxScale:n.maxScale}:{minScale:0,maxScale:0}},setScaleRange:function(n,d){var c=this.originOperLayer.mapService,
g=c.layerInfo._getJsapiLayerInfoById(c.subId);c.layerInfo.layerObject&&c.layerInfo.layerObject.supportsDynamicLayers&&c.layerInfo.layerObject.setDynamicLayerInfos&&g&&(g.minScale!==n||g.maxScale!==d)&&(g.minScale=n,g.maxScale=d,c.layerInfo.layerObject.setDynamicLayerInfos(c.layerInfo._jsapiLayerInfos),m.publish("layerInfos/layerInfo/scaleRangeChanged",[this]))},_onVisibilityChanged:function(){}})})},"jimu/LayerInfos/LayerObjectFacory":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred ./RequestBuffer esri/layers/FeatureLayer esri/layers/RasterLayer esri/layers/StreamLayer esri/layers/ArcGISImageServiceLayer esri/layers/ArcGISImageServiceVectorLayer".split(" "),
function(E,q,A,w,m,v,r,l,k,n){return E(null,{_layerInfo:null,_layerObjectBuffer:null,constructor:function(d){this._layerInfo=d;this._initLayerObjectBuffer()},_initLayerObjectBuffer:function(){this._layerObjectBuffer=new m(q.hitch(this,this._getLayerObject))},getLayerObject:function(){var d=this._layerInfo.getUrl();return this._layerObjectBuffer.getRequest(this._layerInfo.subId).request(d)},getLayerObjectWithUrl:function(d){return this._layerObjectBuffer.getRequest(this._layerInfo.subId+"_url").request(d)},
_getLayerObject:function(d){var c,g=new w;this._layerInfo.getLayerType().then(q.hitch(this,function(b){var e=q.mixin(this._getLayerOptionsForCreateLayerObject(),this._layerInfo.originOperLayer.options||{})||{};switch(b){case "FeatureLayer":c=new v(d,e);break;case "RasterLayer":c=new r(d);break;case "StreamLayer":c=new l(d);break;case "ArcGISImageServiceLayer":c=new k(d);break;case "ArcGISImageServiceVectorLayer":c=new n(d);break;case "Table":if(this._layerInfo.layerObject&&!this._layerInfo.layerObject.empty)return this._setLayerObjectProperties(this._layerInfo.layerObject),
g.resolve(this._layerInfo.layerObject),g;if(this._layerInfo.layerObject&&this._layerInfo.layerObject.url)c=new v(d,e);else return this._layerInfo.layerObject&&this._layerInfo.layerObject.featureCollectionData?(c=new v(this._layerInfo.layerObject.featureCollectionData,e),this._setLayerObjectProperties(c),g.resolve(c)):g.resolve(null),g;break;case "GroupLayer":return g=this._getGroupLayerObject();default:return g.resolve(null),g}var a=c.on("load",q.hitch(this,function(){this._setLayerObjectProperties(c);
g.resolve(c);a.remove&&a.remove()})),f=c.on("error",q.hitch(this,function(h){g.reject(h);f.remove&&f.remove()}))}),q.hitch(this,function(){g.reject()}));return g},_getGroupLayerObject:function(){var d=new w;this._layerInfo._getServiceDefinition().then(q.hitch(this,function(c){if(null===c)d.reject();else{var g=this._layerInfo.getUrl();c.url=g;c.id=this._layerInfo.id;d.resolve(c)}}));return d},_getLayerOptionsForCreateLayerObject:function(){var d={},c=[],g=this._layerInfo.getInfoTemplate();g&&g.info&&
g.info.fieldInfos?A.forEach(g.info.fieldInfos,function(b){b.visible&&c.push(b.fieldName)},this):c=["*"];d.outFields=c;return d},_setLayerObjectProperties:function(d){d.name&&!q.getObject("_wabProperties.originalLayerName",!1,d)&&(q.setObject("_wabProperties.originalLayerName",d.name,d),d.name=this._layerInfo.title);d.id=this._layerInfo.id;this._layerInfo.loadInfoTemplate().then(q.hitch(this,function(c){d.infoTemplate=c}))}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../kernel ../lang ../domUtils ./BaseRasterLayer ./ImageServiceLayerMixin ./pixelFilters/StretchFilter ../SpatialReference ../geometry/Point".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a){E=E([c,g],{declaredClass:"esri.layers.RasterLayer",constructor:function(f,h){this.pixelData=null;null!==this.format&&void 0!==this.format||this.setImageFormat("LERC",!0)},_setDefaultFilter:function(){if(this.loaded&&this.drawType&&!this._isVectorData()&&(!this.pixelFilter||this._isDefaultPixelFilter))if("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))this._isDefaultPixelFilter&&(this.pixelFilter=
null,this._isDefaultPixelFilter=!1);else{var f;if(this.minValues&&this.maxValues&&this.stdvValues&&this.meanValues){var h=[];for(f=0;f<this.minValues.length;f++)h.push([this.minValues[f],this.maxValues[f],this.meanValues[f],this.stdvValues[f]]);this.bandCount!==h.length&&(h=null)}f=0;var p=!1;"U8"===this.pixelType?(f=5,p=h?!1:!0):h?(f=5,p=!1):(f=6,p=!0);this.renderingRule&&(f=5,p=!0);this.pixelFilter=(new b({stretchType:f,min:0,max:255,dra:p,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,
statistics:h,numberOfStandardDeviations:2.5})).filter;this._isDefaultPixelFilter=!0}}});m("extend-esri")&&q.setObject("layers.RasterLayer",E,k);return E})},"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g,b){var e=n.defaults.map.zoomDuration;return E([b],
{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,opacity:1,constructor:function(a,f){this.drawMode=f&&void 0!==f.drawMode?f.drawMode:!0;this.drawType=f&&f.drawType?f.drawType:"2d";this.pixelData=null;this._initialize(a,f)},setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){this.opacity!==a&&(this.opacity=a,this.onOpacityChange(a))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>m("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));
else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(){this._canDraw()&&"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();if("css-transforms"===this._map.navigationMode){var a=this._map.__visibleDelta;this._left=this._tdx=a.x;this._top=this._tdy=a.y;r.set(this._div,k._css.names.transform,k._css.translate(this._left,this._top))}this._displayTimer=
this._displayTimer||setTimeout(q.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var a=this._map.extent;return new g((a.xmax-a.xmin)/this._map.width,(a.ymax-a.ymin)/this._map.height,a.spatialReference)},setPixelFilter:function(a,
f){this.pixelFilter=a;f||this.redraw()},_toggleTime:function(){},_setMap:function(a,f){this.inherited(arguments);this._dragOrigin={x:0,y:0};var h=this._div=v.create("div",null,f),p={width:a.width+"px",height:a.height+"px",position:"absolute"};"css-transforms"===a.navigationMode?(p[k._css.names.transform]=k._css.translate(a.__visibleDelta.x,a.__visibleDelta.y),this._left=a.__visibleDelta.x,this._top=a.__visibleDelta.y):this._left=this._top=0;r.set(h,p);this._canvas=v.create("canvas",{id:"canvas",width:a.width+
"px",height:a.height+"px",style:"position: absolute;"},h);d.isDefined(this.opacity)&&r.set(h,"opacity",this.opacity);(this._context=this._canvas.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(A.connect(a,"onPan",this,this._panHandler));this._connects.push(A.connect(a,"onPanEnd",this,this._panEndHandler));"css-transforms"===a.navigationMode?
this._connects.push(A.connect(a,"onScale",this,this._onScaleHandler)):(this._connects.push(A.connect(a,"onZoom",this,this._onZoomHandler)),this._connects.push(A.connect(a,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(A.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(A.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(A.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(A.connect(this,"onOpacityChange",
this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};this.evaluateSuspension();if(this.suspended&&!a.loaded)var B=A.connect(a,"onLoad",this,function(){A.disconnect(B);B=null;this.evaluateSuspension()});return h},_unsetMap:function(a,f){w.forEach(this._connects,A.disconnect,this);var h=this._div;h&&(f.removeChild(h),v.destroy(h));this.updating&&a._jobs&&a._jobs--;this._rasterReadPromise&&this._rasterReadPromise.cancel();this._map=this._canvas=this._context=
this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){if(this._map){this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};var a=this._useBrowserDecoding();!a&&this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=
this._left,this._tdy=this._top,this._multiply=null,r.set(this._div,k._css.names.transform,k._css.translate(this._left,this._top)),r.set(this._canvas,k._css.names.transform,k._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});if(this._canDraw&&this.drawMode)if(a)this._fireUpdateEnd();else if(this.drawMode)if(this.pixelData&&this.pixelData.pixelBlock){a=this.pixelData.pixelBlock;var f=this._context,h=f.createImageData(a.width,a.height);h.data.set(a.getAsRGBA());var p=this.pixelData.extent,
B=this._map.extent,u=this.getCurrentResolution(),t=0,z=0;Math.abs(p.xmin-B.xmin)>u.x&&(t=Math.round((p.xmin-B.xmin)/u.x));Math.abs(B.ymax-p.ymax)>u.y&&(z=Math.round((B.ymax-p.ymax)/u.y));this.clear();"css-transforms"===this._map.navigationMode?(this._tdx=this._left,this._tdy=this._top,this._multiply=null,r.set(this._div,k._css.names.transform,k._css.translate(this._left,this._top)),r.set(this._canvas,k._css.names.transform,k._css.translate(-this._left,-this._top))):(r.set(this._div,{left:"0px",top:"0px",
width:this._map.width+"px",height:this._map.height+"px"}),r.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};f.putImageData(h,t,z,0,0,a.width,a.height);this._fireUpdateEnd()}else this.clear()}},_panHandler:function(a,f){"css-transforms"===this._map.navigationMode?(this._left=this._map.__visibleDelta.x+f.x,this._top=this._map.__visibleDelta.y+f.y,r.set(this._div,k._css.names.transform,k._css.translate(this._left,this._top))):
r.set(this._div,{left:this._startRect.left+f.x+"px",top:this._startRect.top+f.y+"px"})},_panEndHandler:function(a,f){f&&(this._startRect.left+=f.x,this._startRect.top+=f.y)},_onScaleHandler:function(a,f){var h={},p=k._css.names;r.set(this._canvas,p.transition,f?"none":p.transformName+" "+e+"ms ease");this._matrix=a;a=this._multiply?l.multiply(a,this._multiply):a;if(this._tdx||this._tdy)a=l.multiply(a,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});h[p.transform]=k._css.matrix(a);r.set(this._canvas,
h)},_onZoomHandler:function(a,f,h){var p=this._startRect;a=p.width*f;f*=p.height;var B=p.left-(a-p.width)*(h.x-p.left)/p.width;h=p.top-(f-p.height)*(h.y-p.top)/p.height;r.set(this._canvas,{left:B+"px",top:h+"px",width:a+"px",height:f+"px"});this._endRect={left:B,top:h,width:a,height:f}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,f,h){r.set(this._div,{width:f+"px",height:h+"px"});r.set(this._canvas,{width:f+"px",height:h+"px"});this._startRect.width=
this._canvas.width=f;this._startRect.height=this._canvas.height=h},_extentChangeHandler:function(a,f,h,p){this.suspended||f&&0===f.x&&0===f.y&&!h||("css-transforms"===this._map.navigationMode&&(f&&(this._dragOrigin.x+=f.x,this._dragOrigin.y+=f.y),h||(this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,r.set(this._div,k._css.names.transform,k._css.translate(this._left,this._top))),h&&(r.set(this._canvas,k._css.names.transition,"none"),this._multiply=this._multiply?l.multiply(this._matrix,
this._multiply):this._matrix)),this._fireUpdateStart(),a=this._map,this._requestData(a.extent,a.width,a.height))},_visibilityChangeHandler:function(a){a?c.show(this._div):c.hide(this._div)},_opacityChangeHandler:function(a){r.set(this._div,"opacity",a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query dojo/DeferredList dojo/debounce ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ../renderers/colorRampUtils ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u,t,z,x,y,D,H,I,N,S,M,Q,da){E=E(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_rasterFunctionServiceInfoProps:"bandCount pixelType hasRasterAttributeTable hasColormap hasHistograms minValues maxValues meanValues stdvValues serviceDataType".split(" "),_pixelTypeRanges:{U1:[0,1],U2:[0,3],U4:[0,15],U8:[0,255],S8:[-128,127],U16:[0,65535],S16:[-32768,32767]},_eventMap:{"rendering-change":!0,
"mosaic-rule-change":!0,"spatial-reference-change":!0,"renderer-change":!0},_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(J,R){this.useMapTime=R&&R.hasOwnProperty("useMapTime")?!!R.useMapTime:!0},_initialize:function(J,R){this._url=f.urlToObject(J);this.raster=new y(this._url.path);this._rasterFunctionTemplateInfos={};this._rasterFunctionTemplatePromise={};this._customRenderingRuleId={};this.infoTemplate=R&&R.infoTemplate;this.format=(J=R&&R.imageServiceParameters)&&J.format;
this.compressionTolerance=J&&J.compressionTolerance?J.compressionTolerance:.01;this.interpolation=J?J.interpolation:null;this.compressionQuality=J?J.compressionQuality:null;this.bandIds=J?J.bandIds:null;this.mosaicRule=J?J.mosaicRule:null;this.renderingRule=J?J.renderingRule:null;this.renderer=J?J.renderer:null;this.useMapDimensionValue=R&&R.hasOwnProperty("useMapDimensionValue")?!!R.useMapDimensionValue:!0;this.hasImageFilter=R&&R.hasImageFilter;this.activeMapDimensions=R&&R.activeMapDimensions;
this._params=q.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},J?J.toJson():{});this.pixelFilter=R&&R.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=q.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=q.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=q.hitch(this,
this._initLayer);this._queryVisibleRastersHandler=q.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._renderingRuleColormap={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=R&&R.loadCallback;J&&J.renderer&&(J.renderer.outputUnit||J.renderer.inputUnit)&&(this.vectorFieldPixelFilter=new H,this.vectorFieldPixelFilter.setUnits(J.renderer.inputUnit,J.renderer.outputUnit));
(R=R&&R.resourceInfo)?this._initLayer(R):e({url:this._url.path,content:q.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(J,R){if(null!==J&&void 0!==J){this._findCredential();(this.credential&&this.credential.ssl||J&&J._ssl)&&this._useSSL();R=this.minScale;var W=this.maxScale;q.mixin(this,J);this.minScale=R;this.maxScale=W;this.initialExtent=this.fullExtent=this.extent=
new h(J.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);var X=this.minValues,ia=this.maxValues,ma=this.meanValues,ha=this.stdvValues,xa=this.bands=[];R=0;for(W=this.bandCount;R<W;R++)xa[R]={min:X[R],max:ia[R],mean:ma[R],stddev:ha[R]};this.timeInfo=(R=this.timeInfo)&&R.timeExtent?new N(R):null;W=this.fields=[];if(X=J.fields)for(R=0;R<X.length;R++)W.push(new S(X[R]));this._updateInfoTemplateFields(this.fields);
this.version=J.currentVersion;this.version||(this.version="fields"in J||"objectIdField"in J||"timeInfo"in J?10:9.3);b.isDefined(J.minScale)&&!this._hasMin&&"Raster"!==J.cacheType&&this.setMinScale(J.minScale);b.isDefined(J.maxScale)&&!this._hasMax&&"Raster"!==J.cacheType&&this.setMaxScale(J.maxScale);R={};J.defaultMosaicMethod?(R.method=J.defaultMosaicMethod,R.operation=J.mosaicOperator,R.sortField=J.sortField,R.sortValue=J.sortValue):R.method=t.METHOD_NONE;this.defaultMosaicRule=new t(R);this.defaultMosaicRule.ascending=
!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===this.serviceDataType;this._setDefaultRenderingRule(!0);this._getRenderingRuleAttributeTableAndColormap();this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(q.hitch(this,function(ua){ua&&(ua.features&&ua.fields&&(this.rasterAttributeTable=
q.clone(ua)),ua.features&&0<ua.features.length&&(this._rasterAttributeTableFeatures=q.clone(ua.features)),ua.fields&&0<ua.fields.length&&(this._rasterAttributeTableFields=q.clone(ua.fields)),this.renderingRule||!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh())}));this._initVectorPixelFilter();this.bandIds||2!==this.bandCount||this.renderingRule||"esri.layers.ArcGISImageServiceLayer"!==
this.declaredClass||this.setBandIds([0,0,0],!0);!(10.3<=this.version&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length)||this._url.query&&this._url.query.raster||this.getRasterFunctionInfos().then(q.hitch(this,function(ua){if(ua&&ua.length){this.rasterFunctionInfos=ua;var na=[],va;w.forEach(ua,function(ra){if(ra){var wa=ra.functionType;va=va||1===wa||2===wa;na.push(ra.name)}},this);this._hasItemLevelRFT=va;this._rasterFunctionNames=na;va&&(this._initVectorPixelFilter(),this.refresh())}}));
this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(J=this._loadCallback)delete this._loadCallback,J(this)}},_updateInfoTemplateFields:function(J){if(J&&!(1>J.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var R,W;var X=this.infoTemplate.info.fieldInfos;for(R=0;R<J.length;R++){var ia=J[R];for(W=0;W<X.length;W++)if(X[W].fieldName.toLowerCase()===ia.name.toLowerCase()&&X[W].fieldName!==ia.name){X[W].fieldName=
ia.name;break}}}},getKeyProperties:function(J){var R=this._url.path+"/keyProperties",W=new A(a._dfdCanceller),X={f:"json"};J&&J.renderingRule&&(X.renderingRule=m.toJson(J.renderingRule.toJson()));10<this.version?(W._pendingDfd=e({url:R,content:X,handleAs:"json",callbackParamName:"callback"}),W._pendingDfd.then(function(ia){W.callback(ia)},function(ia){W.errback(ia)})):(J=Error("Layer does not have key properties"),J.log=!!v.isDebug,W.errback(J));return W},getRasterAttributeTable:function(J){var R=
this._url.path+"/rasterAttributeTable",W=new A(a._dfdCanceller),X={f:"json"},ia=this.hasRasterAttributeTable;J&&J.renderingRule&&(X.renderingRule=m.toJson(J.renderingRule.toJson()),ia=!0);!this.loaded||10<this.version&&ia?(W._pendingDfd=e({url:R,content:X,handleAs:"json",callbackParamName:"callback"}),W._pendingDfd.then(function(ma){W.callback(ma)},function(ma){W.errback(ma)})):(J=Error("Layer does not support raster attribute table"),J.log=!!v.isDebug,W.errback(J));return W},getRenderingRuleAttributeTable:function(J){var R=
new A(a._dfdCanceller);if(!J||!J.renderingRule)return R.errback(Error("Rendering rule is not specified")),R;J=J.renderingRule;var W=this._getRenderingRuleId(J);this._renderingRuleAttributeTable&&W&&this._renderingRuleAttributeTable.hasOwnProperty(W)?R.resolve(this._renderingRuleAttributeTable[W]):R=this.getRasterAttributeTable({renderingRule:J}).then(q.hitch(this,function(X){if(X&&X.features&&X.features.length&&X.fields&&X.fields.length){var ia={features:q.clone(X.features),fields:q.clone(X.fields)};
W&&(this._renderingRuleAttributeTable[W]=ia)}return ia}));return R},_initVectorPixelFilter:function(){var J;this._hasItemLevelRFT&&this.renderingRule&&(J=this._getItemLevelRenderingRule(this.renderingRule));if(J=J||this.renderingRule)return this.getRenderingRuleServiceInfo(J).then(q.hitch(this,function(R){!R||!this._isVectorData(R)&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass||b.isDefined(this.pixelFilter)||(this.vectorFieldPixelFilter=this.vectorFieldPixelFilter||new H,this.vectorFieldPixelFilter.isDataUV=
"esriImageServiceDataTypeVector-UV"===R.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,this.getKeyProperties().then(q.hitch(this,this._setFlowRepresentation)),this._applyVectorResamplingType(R.serviceDataType))}))},_applyVectorResamplingType:function(J){if(J){var R=this.renderingRule;R&&"Resample"===R.functionName&&((R.functionArguments||{}).ResamplingType="esriImageServiceDataTypeVector-UV"===J?7:10,this.setRenderingRule(new z(R.toJson())))}},_getRasterAttributeTableFeatures:function(){var J=
new A;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return J.resolve(this._rasterAttributeTableFeatures),J;if(10<this.version&&this.hasRasterAttributeTable)return J=this.getRasterAttributeTable(),J.then(q.hitch(this,function(R){R&&R.features&&0<R.features.length&&(this._rasterAttributeTableFeatures=q.clone(R.features))})),J;J.resolve(this._rasterAttributeTableFeatures);return J},_getRenderingRuleAttributeTableFeatures:function(J){J=J&&J.renderingRule;return J?
this.getRenderingRuleAttributeTable({renderingRule:J}).then(function(R){return R&&R.features}):(J=new A,J.errback(Error("Rendering rule is not specified")),J)},_getRenderingRuleAttributeTableAndColormap:function(){this.renderingRule&&this.getRenderingRuleServiceInfo(this.renderingRule).then(q.hitch(this,function(J){J.hasRasterAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:this.renderingRule}).then(q.hitch(this,function(){!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&
"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh()}));J.hasColormap&&this.getRenderingRuleColormap({renderingRule:this.renderingRule}).then(q.hitch(this,function(){this.renderer&&"esri.renderer.ColormapRenderer"===this.renderer.declaredClass&&this.refresh()}))}))},getCustomRasterFields:function(J){var R=J?J.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;J=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var W={name:this._rasterFieldPrefix+"ItemPixelValue",
alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:J},X={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:J},ia={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},ma=this.fields?q.clone(this.fields):[];J=ma.length;ma[J]=X;10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||
!this.rasterFunctionInfos.length||this._isRenderingRuleAProcessingTemplate({functionName:"none"}))&&(J++,ma[J]=ia);if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)J++,ma[J]=W;!b.isDefined(this.pixelFilter)||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(W={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},
X={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},J++,ma[J]=W,J++,ma[J]=X);J=this._rasterAttributeTableFields;(W=this.renderingRule&&this._getRenderingRuleId(this.renderingRule))&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(W)&&(J=this._renderingRuleAttributeTable[W].fields);J&&0<J.length&&(J=w.filter(J,function(xa){return"esriFieldTypeOID"!==xa.type&&"value"!==xa.name.toLowerCase()}),J=w.map(J,
function(xa){var ua=q.clone(xa);ua.name=R+xa.name;return ua}),ma=ma.concat(J));var ha=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&w.forEach(this.rasterFunctionInfos,function(xa){xa&&xa.name&&"none"!==xa.name.toLowerCase()&&(xa={name:ha+xa.name.replace(/ /gi,"_"),alias:xa.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},ma.push(xa))});return ma},_applyTimeToMultidimensionalCRF:function(J,R){var W=this._isTimeSupportedOnCRF();if(W&&
(!J||!J.multidimensionalDefinition))return J;var X=this.timeInfo&&this.timeInfo.startTimeField;if((R=R||this._params.time)&&X&&this._isMultidimensionalCRF()){J=q.clone(J||this.defaultMosaicRule)||new t;J.multidimensionalDefinition=J.multidimensionalDefinition||[];var ia=J.multidimensionalDefinition.filter(function(ha){return ha.dimensionName===X}),ma=R.split(",").map(function(ha){return parseInt(ha,10)});2===ma.length&&ma[0]===ma[1]&&(ma.length=1);0<ia.length?W?J.multidimensionalDefinition.forEach(function(ha){ha.dimensionName===
X&&(ha.declaredClass?(ha.dimensionName=null,ha.isSlice=null,ha.values=null):(delete ha.dimensionName,delete ha.isSlice,delete ha.values))}):J.multidimensionalDefinition.forEach(function(ha){ha.dimensionName===X&&(ha.isSlice=1===ma.length,ha.values=1===ma.length?ma:[ma])}):W||(J.multidimensionalDefinition.some(function(ha){return null!=ha.variableName&&null==ha.dimensionName})?J.multidimensionalDefinition.forEach(function(ha){null!=ha.variableName&&null==ha.dimensionName&&(ha.dimensionName=X,ha.isSlice=
1===ma.length,ha.values=1===ma.length?ma:[ma])}):J.multidimensionalDefinition.push(new x({variableName:"",dimensionName:X,isSlice:1===ma.length,values:1===ma.length?ma:[ma]})));this._cleanupMultidimensionalDefinition(J)}return J},_prepareGetImageParameters:function(J,R,W,X){X=b.isDefined(X)?X:this._params;if(this.renderer||this._hasItemLevelRFT&&this.renderingRule){var ia=this.getExportImageRenderingRule();X.renderingRule=ia?m.toJson(ia.toJson()):null}ia=this.getExportImageMosaicRule(X);X.mosaicRule=
ia?m.toJson(ia.toJson()):null;ia=J.spatialReference.wkid||m.toJson(J.spatialReference.toJson(!1));delete X._ts;q.mixin(X,{bbox:J.xmin+","+J.ymin+","+J.xmax+","+J.ymax,imageSR:ia,bboxSR:ia,size:R+","+W},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete X.compressionTolerance;X.format&&"LERC"===X.format.toUpperCase()&&(X.compressionTolerance=this.compressionTolerance);X.token=this._getToken()},getImageUrl:function(J,R,W,X,ia){ia=b.isDefined(ia)?ia:this._params;this._prepareGetImageParameters(J,
R,W,ia);J=q.clone(ia);this._cleanupRequestParams(J);R=this._url.path+"/exportImage?";W=f.addProxy(R+k.objectToQuery(q.mixin(J,{f:"image"})));var ma=J.token;W.length>g.defaults.io.postLength||this.useMapImage?this._jsonRequest=e({url:R,content:q.mixin(J,{f:"json"}),callbackParamName:"callback",load:function(ha,xa){ha=ha.href;ma&&(ha+=-1===ha.indexOf("?")?"?token\x3d"+ma:"\x26token\x3d"+ma);X(f.addProxy(ha))},error:this._errorHandler}):X(W)},onRenderingChange:function(){},onMosaicRuleChange:function(){},
onRendererChange:function(){},setInterpolation:function(J,R){this.interpolation=this._params.interpolation=J;R||this.refresh(!0)},setCompressionQuality:function(J,R){this.compressionQuality=this._params.compressionQuality=J;R||this.refresh(!0)},setCompressionTolerance:function(J,R){this.compressionTolerance=J;R||this.refresh(!0)},setBandIds:function(J,R){var W=!1;this.bandIds!==J&&(W=!0);this.bandIds=J;this._params.bandIds=J?J.join(","):null;if(W&&!R)this.onRenderingChange();R||this.refresh(!0)},
setDefaultBandIds:function(J){this.bandIds=this._params.bandIds=null;J||this.refresh(!0)},setDisableClientCaching:function(J){this.disableClientCaching=J},setMosaicRule:function(J,R){var W=!1;this.mosaicRule!==J&&(W=!0);this.mosaicRule=J;this._params.mosaicRule=m.toJson(J.toJson());if(W&&!R)this.onMosaicRuleChange();R||this.refresh(!0)},getRasterFunctionInfos:function(){if(10.3>this.version||!this.rasterFunctionInfos||!this.rasterFunctionInfos.length)console.log("Layer doesn't support /rasterFunctionInfos resource.");
else return e({url:this._url.path+"/rasterFunctionInfos",content:{f:"json"},handleAs:"json",load:function(J){return J&&J.rasterFunctionInfos}})},setRenderingRule:function(J,R){var W=!1;this.renderingRule!==J&&(W=!0);this.renderingRule=J;this._params.renderingRule=J?m.toJson(J.toJson()):null;this._useRenderingRuleAttributeTable?this.getRenderingRuleAttributeTable({renderingRule:J}):"esri.layers.RasterXLayer"!==this.declaredClass&&this._getRenderingRuleAttributeTableAndColormap();if(W)this.onRenderingChange();
this._setDefaultFilter();R||this.refresh(!0)},setImageFormat:function(J,R){this.format=this._params.format=J;this._setDefaultFilter();R||this.refresh(!0)},setInfoTemplate:function(J){this.infoTemplate=J;this._updateInfoTemplateFields(this.fields)},setDefinitionExpression:function(J,R){var W=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?W=this.defaultMosaicRule.toJson():W.method=t.METHOD_NONE);W.where=J;J=new t(W);this.setMosaicRule(J,R);return this},getDefinitionExpression:function(){return this.mosaicRule?
this.mosaicRule.where:null},setPixelFilter:function(J){this.pixelFilter=J;this._isDefaultPixelFilter=!1},getPixelData:function(J){return J?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},getExportImageRenderingRule:function(){var J;this._hasItemLevelRFT&&this.renderingRule&&(J=this._getServiceLevelRenderingRule(this.renderingRule));J=J||this.renderingRule;
this._isItemLevelRasterFunction(this.renderingRule)&&(J=void 0);return this._combineRenderingRule(this._convertRendererToRenderingRule(this.renderer),J)},getExportImageMosaicRule:function(){var J=this.mosaicRule,R;this._hasItemLevelRFT&&this.renderingRule&&(R=this._getItemLevelRenderingRule(this.renderingRule));R&&(J=J||this.defaultMosaicRule||new t,J.itemRenderingRule=R);return J=this._applyTimeToMultidimensionalCRF(J)},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},
getHistograms:function(J){var R=J.variableName,W=(J=(J=J.renderingRule||this.renderingRule||this.defaultRenderingRule)&&"none"!==J.functionName.toLowerCase()?J.toJson():null)?J.functionName:"",X=new A(a._dfdCanceller);if((R||""===R)&&this._cachedVariableHistogram[R]&&this._cachedVariableHistogram[R][W])return X.resolve(this._cachedVariableHistogram[R][W]),X;if(this.hasHistograms){var ia={f:"json"};R&&(ia.variable=R);J&&10.9<this.version&&(ia.renderingRule=JSON.stringify(J));X._pendingDfd=e({url:this._url.path+
"/histograms",content:ia,handleAs:"json",callbackParamName:"callback"});X._pendingDfd.then(q.hitch(this,function(ma){if(R||""===R)this._cachedVariableHistogram[R]=this._cachedVariableHistogram[R]||{},this._cachedVariableHistogram[R][W]=ma;X.callback(ma)}),function(ma){X.errback(ma)})}else J=Error("Layer does not have histograms."),J.log=!!v.isDebug,X.errback(J);return X},computeHistograms:function(J){var R=new A(a._dfdCanceller);if(10.1<=this.currentVersion){J=J||{};var W=J.geometry||this.fullExtent,
X=(J.geometry||this.fullExtent).toJson();W="extent"===W.type?"esriGeometryEnvelope":"esriGeometryPolygon";var ia=J.renderingRule||this.renderingRule||this.defaultRenderingRule;ia=ia?ia.toJson():null;var ma=J.mosaicRule||this.mosaicRule||this.defaultMosaicRule;ma=ma?ma.toJson():null;J=J.pixelSize||{x:this.pixelSizeX,y:this.pixelSizeY};R._pendingDfd=e({url:this._url.path+"/computeHistograms",content:q.mixin({f:"json",geometry:JSON.stringify(X),geometryType:W,renderingRule:JSON.stringify(ia),mosaicRule:JSON.stringify(ma),
pixelSize:JSON.stringify(J),callbackParamName:"callback"}),handleAs:"json"});R._pendingDfd.then(function(ha){R.callback(ha)},function(ha){R.errback(ha)})}else X=Error("Layer doesn't support computeHistograms."),X.log=!!v.isDebug,R.errback(X);return R},getRenderingRuleServiceInfo:function(J,R){function W(ma){return ma.name&&ma.arguments&&ma.function&&ma.hasOwnProperty("functionType")}var X=new a._fixDfd(new A(a._dfdCanceller));if(!J)return X.errback(Error("Rendering rule is not specified")),X;if(W(J))"ClipFunction"===
J.function.type&&(J=this._handleClipFunctionInRenderingRule(J));else{var ia=this._getRenderingRuleId(J);if(ia){if(this._rasterFunctionTemplateInfos[ia])return X.resolve(this._rasterFunctionTemplateInfos[ia]),X;if(this._rasterFunctionTemplatePromise[ia])return X=this._rasterFunctionTemplatePromise[ia]}}X=e({url:this._url.path,content:q.mixin(q.mixin({f:"json",renderingRule:JSON.stringify(J.toJson())},this._url.query)),callbackParamName:"callback",load:q.hitch(this,function(ma){var ha={};w.forEach(this._rasterFunctionServiceInfoProps,
function(xa){ha[xa]=ma[xa]});W(J)||(this._rasterFunctionTemplateInfos[ia]=ha);return ha}),error:R||this._errorHandler});ia&&!this._rasterFunctionTemplatePromise[ia]&&(this._rasterFunctionTemplatePromise[ia]=X);return X},queryVisibleRasters:function(J,R,W,X){var ia=this._map,ma=a._fixDfd(new A(a._dfdCanceller));this._visibleRasters=[];var ha,xa,ua=!0,na=!0,va=null,ra=this.infoTemplate?this.infoTemplate.info:null,wa=ra?q.clone(this.infoTemplate.info.fieldInfos):null;R=R||{};if(ra&&this.infoTemplate.info.mediaInfos&&
this.infoTemplate.info.mediaInfos.length){var Z=[];w.forEach(this.infoTemplate.info.mediaInfos,function(P){Z=Z.concat(P&&P.value&&P.value.fields||[])});Z.length&&w.forEach(wa,function(P){P&&-1<Z.indexOf(P.fieldName)&&(P.visible=!0)})}var Da=function(P){var T=ra&&ra.title&&-1<ra.title.toLowerCase().indexOf(P.toLowerCase());P=ra&&ra.description&&-1<ra.description.toLowerCase().indexOf(P.toLowerCase());return T||P};if(wa&&0<wa.length)for(ua=!1,ha=0;ha<wa.length;ha++)if((xa=wa[ha])&&xa.fieldName.toLowerCase()!==
this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(xa.visible||Da(xa.fieldName))){ua=!0;break}this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("returnTopmostRaster")&&(va=this.infoTemplate.info.layerOptions.returnTopmostRaster?1:null);wa&&0<wa.length&&(na=!1,w.some(wa,function(P){if(P&&P.fieldName.toLowerCase()===this._rasterFieldPrefix.toLowerCase()+"itempixelvalue"&&P.visible)return na=!0},this),Da(this._rasterFieldPrefix.toLowerCase()+
"itempixelvalue")&&(na=!0));var Ca=(xa=this._removeVisualizationStretchFunction(this.renderingRule))&&xa.functionName,O=[];if(10.4<=this.version){var C=!1;if(this.rasterFunctionInfos&&wa){var G=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;w.forEach(this.rasterFunctionInfos,function(P){var T=G+P.name.replace(/ /gi,"_");w.some(wa,function(Y){return Y.visible&&Y.fieldName===T})&&(C=C||Ca&&Ca===P.name,O.push(new z({rasterFunction:P.name})))})}xa&&!C&&O.push(xa)}ha=new da;ha.geometry=J.geometry;
ha.returnGeometry=this._map.spatialReference.equals(this.spatialReference);ha.returnCatalogItems=ua;ha.timeExtent=this.timeInfo?J.timeExtent:null;ha.returnPixelValues=na;ha.maxItemCount=va||J.maxItemCount;this._params.time&&this.mosaicRule?(J=q.clone(this.mosaicRule),J=this._filterOutTimeDimension(J),ha.mosaicRule=J):ha.mosaicRule=this.mosaicRule||null;this._isMultidimensionalCRF()&&ha.timeExtent&&(ha.mosaicRule=this._applyTimeToMultidimensionalCRF(ha.mosaicRule,ha.timeExtent.toJson().join(",")),
this._isTimeSupportedOnCRF()||delete ha.timeExtent);ha.renderingRule=10.4>this.version&&xa||null;ha.renderingRules=O||null;10.8>this.version&&(ha.returnPixelValues=void 0,ha.maxItemCount=void 0);ia&&(ia=new p((ia.extent.xmax-ia.extent.xmin)/ia.width,(ia.extent.ymax-ia.extent.ymin)/ia.height,ia.extent.spatialReference),ha.pixelSize=ia);R.requestParams=ha;var L=this;ia=new Q(this.url);(ma._pendingDfd=ia.execute(ha)).addCallbacks(function(P){L._queryVisibleRastersHandler(P,R,W,X,ma)},function(P){L._resolve([P],
null,X,ma,!0)});return ma},_queryVisibleRastersHandler:function(J,R,W,X,ia){function ma(){var ta=this.getCustomRasterFields(R),pa=this._getDomainFields(ta),V=R?R.returnDomainValues:!1,ca=R&&R.rasterAttributeTableFieldPrefix,aa,ea,la,oa,za,sa,Ea,Ba,ya,Ha;ta=(ta=this._getRenderingRuleId(this.renderingRule))&&this._rasterFunctionTemplateInfos[ta];this.renderingRule&&(this._useRenderingRuleAttributeTable||ta)?(ta=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),this.hasRasterAttributeTable||
(Ha=ha)):ta=this._getRasterAttributeTableFeatures();ta.then(q.hitch(this,function(Na){for(aa=0;aa<L.length;aa++){ja=L[aa];ja.setInfoTemplate(this.infoTemplate);ja._layer=this;if(ha){ya=ha.replace(/ /gi,"").split(",");ea=ha;la=ya;P&&P.length>=aa&&(ea=P[aa].replace(/ /gi,", "),la=P[aa].split(" "));ja.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=la;ja.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=ya;xa&&(ja.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=xa.replace(/ /gi,
"").split(","));if(this.pixelFilter){var Qa=new D({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});w.forEach(la,function(Ia){Qa.addData({pixels:[Ia],statistics:{minValue:Ia,maxValue:Ia,noDataValue:null}})});this.pixelFilter({pixelBlock:Qa,extent:new h(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)ja.attributes[this._rasterFieldPrefix+"Magnitude"]=Qa.pixels[0][0],ja.attributes[this._rasterFieldPrefix+
"Direction"]=Qa.pixels[1][0]}w.forEach(wa,function(Ia){ja.attributes[Ia.name]=Ia.value});var Ra=0<this.fields.length?Ha||ea:Ha||xa;if(Na&&0<Na.length&&(oa=w.filter(Na,function(Ia){if(Ia&&Ia.attributes)return Ia.attributes.hasOwnProperty("Value")?Ia.attributes.Value==Ra:Ia.attributes.VALUE==Ra}),0<oa.length&&(za=q.clone(oa[0]),ca&&za))){Ba={};for(sa in za.attributes)za.attributes.hasOwnProperty(sa)&&(Ea=ca+sa,Ba[Ea]=za.attributes[sa]);za.attributes=Ba;ja.attributes=q.mixin(ja.attributes,za.attributes)}}V&&
pa&&0<pa.length&&w.forEach(pa,function(Ia){if(Ia){var Xa=ja.attributes[Ia.name];b.isDefined(Xa)&&(Xa=this._getDomainValue(Ia.domain,Xa),b.isDefined(Xa)&&(ja.attributes[Ia.name]=Xa))}},this);ka.push(ja);this._visibleRasters.push(ja)}this._resolve([ka,null,!0],null,W,ia)}))}var ha=J.value,xa=J.value,ua=0,na=0,va=this,ra=this.objectIdField,wa=[];X=R.requestParams.renderingRules;var Z=J.processedValues,Da=this.renderingRule&&m.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());
if(X&&Z&&X.length===Z.length){var Ca=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;w.forEach(X,function(ta,pa){if(ta.functionName){var V={name:Ca+ta.functionName.replace(/ /gi,"_"),value:Z[pa].replace(/ /gi,"").split(",")};wa.push(V);Da&&Da===m.toJson(ta.toJson())&&(ha=Z[pa])}})}X=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;
if(J.catalogItems){var O=0,C=J.catalogItems.features.length;var G=0;var L=Array(C);var P=Array(C);var T=Array(C);if(J.properties&&J.properties.Values){C=J.properties.Values.length;for(ua=0;ua<C;ua++)-1<J.properties.Values[ua].toLowerCase().indexOf("nodata")&&G++;var Y=C-G;for(ua=0;ua<C;ua++){G=!0;if(-1<J.properties.Values[ua].toLowerCase().indexOf("nodata")){var fa=Y++;X||(G=!1,L.length--,P.length--,T.length--)}else fa=O++;G&&(L[fa]=J.catalogItems.features[ua],P[fa]=J.properties.Values[ua],T[fa]=
L[fa].attributes[ra])}}else{for(ua=0;ua<C;ua++)L[ua]=J.catalogItems.features[ua],T[ua]=L[ua].attributes[ra];P=null}}this._visibleRasters=[];(J=-1<ha.toLowerCase().indexOf("nodata"))&&!X&&(L=[],P=[],T=[]);if(ha&&!L&&!J){ra="ObjectId";L=[];var ja=new M(new h(this.fullExtent),null,{ObjectId:0});L.push(ja)}var ka=[];L?!this._map.spatialReference.equals(this.spatialReference)&&T&&0<T.length?e({url:this._url.path+"/query",content:{f:"json",objectIds:T.join(","),returnGeometry:!0,outSR:m.toJson(va._map.spatialReference.toJson()),
outFields:ra},handleAs:"json",callbackParamName:"callback",load:function(ta){if(0===ta.features.length)va._resolve([ka,null,null],null,W,ia);else{for(ua=0;ua<ta.features.length;ua++)for(na=0;na<L.length;na++)L[na].attributes[ra]==ta.features[ua].attributes[ra]&&(L[na].geometry=new B(ta.features[ua].geometry),L[na].geometry.setSpatialReference(va._map.spatialReference));ma.call(va)}},error:function(ta){va._resolve([ka,null,null],null,W,ia)}}):ma.call(this):this._resolve([ka,null,null],null,W,ia)},
getVisibleRasters:function(){var J=this._visibleRasters,R=[],W;for(W in J)J.hasOwnProperty(W)&&R.push(J[W]);return R},_getDomainFields:function(J){if(J){var R=[];w.forEach(J,function(W){if(W.domain){var X={};X.name=W.name;X.domain=W.domain;R.push(X)}});return R}},_getDomainValue:function(J,R){if(J&&J.codedValues){var W;w.some(J.codedValues,function(X){return X.code===R?(W=X.name,!0):!1});return W}},_requestData:function(J,R,W){this._rasterReadPromise&&this._rasterReadPromise.cancel();J=q.clone(J);
var X=J._normalize(!0);this._prepareGetImageParameters(X,R,W);R=q.clone(this._params);this._cleanupRequestParams(R);R.extent=J;R.format=R.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===R.format.toLowerCase()&&!R.lercVersion&&10.5<=this.version&&(R.lercVersion=2);this._params.time&&this._isMultidimensionalCRF()&&!this._isTimeSupportedOnCRF()&&delete R.time;W=null;this._useBrowserDecoding()&&(W=new I({ctx:this._context}));R={imageServiceParameters:R,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,
decodeFunc:W?q.hitch(W,"decode"):null};this._rasterReadPromise=this.raster.read(R,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(J){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=J,this.hasDataChanged=!0,this._setPixelData(J))},_setPixelData:function(J){J=this._clonePixelData(J);this.pixelFilter&&this.pixelFilter(J);this.pixelData=J;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=
null)},_clonePixelData:function(J){if(null===J||void 0===J)return J;var R={};J.extent&&(R.extent=q.clone(J.extent));J=J.pixelBlock;if(null===J||void 0===J)return R;R.pixelBlock=J.clone();return R},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(J,R,W){J=J.getImageData(0,0,R,W).data;var X=R*W,ia=0,ma=0,ha=new Uint8Array(X),xa=new Uint8Array(X),ua=new Uint8Array(X),na=new Uint8Array(X),va=Infinity,ra=Infinity,wa=Infinity,Z=-Infinity,Da=-Infinity,Ca=-Infinity;for(ia=0;ia<X;ia++){var O=
J[ma++];var C=J[ma++];var G=J[ma++];va=va<O?va:O;Z=Z>O?Z:O;ra=ra<C?ra:C;Da=Da>C?Da:C;wa=wa<G?wa:G;Ca=Ca>G?Ca:G;ha[ia]=O;xa[ia]=C;ua[ia]=G;na[ia]=J[ma++]&1}return new D({width:R,height:W,pixels:[ha,xa,ua],pixelType:"U8",mask:na,statistics:[{minValue:va,maxValue:Z},{minValue:ra,maxValue:Da},{minValue:wa,maxValue:Ca}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},
getMultidimensionalInfo:function(){var J=this._url.path+"/multiDimensionalInfo",R=new A(a._dfdCanceller);if(this._multidimensionalInfo)return R.resolve(this._multidimensionalInfo),R;!this.loaded||10.3<=this.version&&this.hasMultidimensions?(R._pendingDfd=e({url:J,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),R._pendingDfd.then(q.hitch(this,function(W){this._multidimensionalInfo=W.multidimensionalInfo;R.callback(W.multidimensionalInfo)}),function(W){R.errback(W)})):(J=Error("Layer does not support multidimensional info"),
J.log=!!v.isDebug,R.errback(J));return R},getStatistics:function(J){var R=new A(a._dfdCanceller);if(J&&this._cachedVariableStats[J])R.resolve(this._cachedVariableStats[J]);else{var W={f:"json"};J&&(W.variable=J);R._pendingDfd=e({url:this._url.path+"/statistics",content:W,handleAs:"json",callbackParamName:"callback"});R._pendingDfd.then(q.hitch(this,function(X){X=X.statistics||X.statitsics;var ia=[];X&&X[0]&&null!=X[0].min?X.forEach(function(ma){ia.push([ma.min,ma.max,ma.mean,ma.standardDeviation])}):
ia=this.minValues&&this.minValues.length?this.minValues.map(function(ma,ha){return[ma,this.maxValues[ha],this.meanValues[ha],this.stdvValues[ha]]}.bind(this)):X;J&&(this._cachedVariableStats[J]=ia);R.callback(ia)}),function(X){R.errback(X)})}return R},getDefaultMultidimensionalDefinition:function(){var J=new A(a._dfdCanceller);if(this._defaultMultidimensionalDefinition)return J.resolve(q.clone(this._defaultMultidimensionalDefinition)),J;J._pendingDfd=this.getMultidimensionalInfo();J._pendingDfd.then(q.hitch(this,
function(R){R=this._getDefaultMultidimensionalDefinition(R);J.callback(R)}),function(R){J.errback(R)});return J},_getDefaultMultidimensionalDefinition:function(J,R,W){var X,ia=[],ma=this.defaultVariable||this.raster&&this.raster.defaultVariable;variableName=ma||"";dimensions=variableName.length?J.variables.filter(function(ha){return ha.name===variableName})[0].dimensions:J.variables[0].dimensions;W&&(variableName=ma||J.variables[0].name);for(X in dimensions)dimensions.hasOwnProperty(X)&&(R||"StdTime"!==
dimensions[X].name)&&(J=dimensions[X],ia.push(new x({variableName:variableName,dimensionName:J.name,isSlice:!J.hasRanges,values:[this._getDefaultDimensionValue(J)]})));this._defaultMultidimensionalDefinition=ia;return q.clone(ia)},_getDefaultDimensionValue:function(J){if(J&&J.values&&J.values.length){var R=Infinity,W;if(J.hasRanges)return J.values[0];if(J.name&&"stdz"===J.name.toLowerCase()){for(W=0;W<J.values.length;W++){var X=J.values[W];var ia=Math.abs(X-0);if(ia<R){R=ia;var ma=X}if(0===ia)break}return ma}return J.extent[0]}},
_setDefaultMultidimensionalDefinition:function(J){var R,W={};this.getDefaultMultidimensionalDefinition().then(q.hitch(this,function(X){R=X;0<R.length&&(this.mosaicRule?(W=q.clone(this.mosaicRule),W.multidimensionalDefinition=R):this.defaultMosaicRule?(W=q.clone(this.defaultMosaicRule),W.multidimensionalDefinition=R):W=new t({multidimensionalDefinition:R}),this.setMosaicRule(W,J))}))},_setDefaultRenderingRule:function(J){var R={},W=this.renderingRule;if(!W&&"esri.layers.ArcGISImageServiceVectorLayer"!==
this.declaredClass&&!this.bandIds&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())R.rasterFunction=this.rasterFunctionInfos[0].name;else if("esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version&&(!W||"Resample"!==W.functionName)){var X="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;R.rasterFunction="Resample";R.rasterFunctionArguments={ResamplingType:X,InputCellSize:{x:this.pixelSizeX,
y:this.pixelSizeY}};W&&(R.rasterFunctionArguments.Raster=W.toJson())}R.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new z(R),this.setRenderingRule(this.defaultRenderingRule,J))},_cleanupRequestParams:function(J){if(!J)return J;if(J.time&&J.mosaicRule){var R=new t(m.fromJson(J.mosaicRule));R=this._filterOutTimeDimension(R);J.mosaicRule=m.toJson(R.toJson())}R="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent renderer".split(" ");for(var W in R)J.hasOwnProperty(R[W])&&
delete J[R[W]];return J},_filterOutTimeDimension:function(J){if(this._isMultidimensionalCRF())return J;if(J&&J.multidimensionalDefinition&&0<J.multidimensionalDefinition.length){var R=w.filter(J.multidimensionalDefinition,function(W){return"StdTime"!==W.dimensionName});J.multidimensionalDefinition=R}return J},_removeVisualizationStretchFunction:function(J){var R=J&&J.functionName;if(!R||"stretch"!==R.toLowerCase())return J;var W=J.functionArguments.Raster;return W&&W.functionName&&w.some(this.rasterFunctionInfos,
function(X){return W.functionName===X.name})?W:J},_isMultidimensionalCRF:function(){return 10.71<=this.version&&this.hasMultidimensions&&this.timeInfo&&!(this.objectIdField&&this.fields&&1<this.fields.length)},_isTimeSupportedOnCRF:function(){return 10.8<=this.version},_cleanupMultidimensionalDefinition:function(J){J&&J.multidimensionalDefinition&&(J.multidimensionalDefinition=J.multidimensionalDefinition.filter(function(R){return!(!R.variableName&&!R.dimensionName)}),0===J.multidimensionalDefinition.length&&
(J.multidimensionalDefinition=null))},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType||this.hasMultidimensions},_isVectorData:function(J){J=(J=J||this)&&J.serviceDataType;return"esriImageServiceDataTypeVector-UV"===J||"esriImageServiceDataTypeVector-MagDir"===J},_isRenderingRuleAProcessingTemplate:function(J){var R=J&&J.functionName;
return!R||J.functionArguments?!1:w.some(R&&(this.rasterFunctionInfos||[]),function(W){return W&&W.name&&W.name.toLowerCase()===R.toLowerCase()})},_getRenderingRuleId:function(J){var R=J&&J.functionName;if(R){if(this._isRenderingRuleAProcessingTemplate(J))return R;var W=this._customRenderingRuleId[R];if(W){if(W!==J){for(var X in this._customRenderingRuleId)if(this._customRenderingRuleId[X]===J)return X;for(W=0;this._customRenderingRuleId[ia];)W+=1;var ia;this._customRenderingRuleId[R+W]=J}}else this._customRenderingRuleId[R]=
J;return R}},_createPixelData:function(J){J=new D({width:2,height:2,pixels:J,pixelType:this.pixelType,statistics:J});var R=this.fullExtent.getCenter();R=new h(R.x,R.y,R.x+this.pixelSizeX,R.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:J,extent:R}},_convertRendererToRenderingRule:function(J){var R=J&&J.declaredClass;if(!R||"esri.renderer.UniqueValueRenderer"!==R&&"esri.renderer.ClassBreaksRenderer"!==R&&"esri.renderer.StretchRenderer"!==R&&"esri.renderer.ShadedReliefRenderer"!==R&&"esri.renderer.ColormapRenderer"!==
R)return null;var W=null;"esri.renderer.StretchRenderer"===R?W=J.toRenderingRule({convertToColormap:10.6>this.version}):"esri.renderer.ClassBreaksRenderer"===R?W=this._convertClassifyRenderer(J):"esri.renderer.UniqueValueRenderer"===R?W=this._convertUniqueValueRenderer(J):"esri.renderer.ShadedReliefRenderer"===R?W=this._convertShadedReliefRenderer(J):"esri.renderer.ColormapRenderer"===R&&(W=this._convertColormapRenderer(J));return W},_getValueField:function(J){if(J&&J.length){var R,W;w.some(J,function(X){if((W=
X.name)&&"value"===W.toLowerCase())return R=W,!0});return R}},_convertColormapRenderer:function(J){var R=new z;R.functionName="Colormap";R.functionArguments={};J=J.colormapInfos.map(function(W){return[W.value].concat(W.color)});R.functionArguments.Colormap=J;return R},_convertShadedReliefRenderer:function(J){var R=new z;R.functionName="Hillshade";var W="traditional"===J.hillshadeType?0:1,X="none"===J.scalingType?1:3,ia={HillshadeType:W,SlopeType:X,ZFactor:J.zFactor};0===W&&(ia.Azimuth=J.azimuth,ia.Altitude=
J.altitude);3===X&&(ia.PSPower=J.pixelSizePower,ia.PSZFactor=J.pixelSizeFactor);R.functionArguments=ia;R.variableName="Raster";J.colorRamp&&(R.functionName="ShadedRelief",ia.Colormap=u.convertColorRampToColormap(J.colorRamp,256));return R},_convertClassifyRenderer:function(J){var R=[],W=[],X=[],ia=[],ma;var ha=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);var xa=this.hasRasterAttributeTable;if(ha){xa=this._rasterFunctionTemplateInfos[ha]?this._rasterFunctionTemplateInfos[ha].hasRasterAttributeTable:
this.hasRasterAttributeTable;var ua=this._renderingRuleAttributeTable[ha];var na=this._rasterFunctionTemplateInfos[ha]}var va=ua&&ua.features?ua.features:this._rasterAttributeTableFeatures;var ra=this._getValueField(ua&&ua.fields?ua.fields:this._rasterAttributeTableFields);xa&&va?(w.forEach(J.infos,function(wa,Z){var Da,Ca=wa.symbol.color;Ca.a&&w.forEach(va,function(O){Da=O.attributes[J.attributeField];(Da>=wa.minValue&&Da<wa.maxValue||Z===J.infos.length-1&&Da>=wa.minValue)&&ia.push([O.attributes[ra],
Ca.r,Ca.g,Ca.b])},this)},this),ha=na&&na.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(ia,ha),ha=new z,ha.functionName="Colormap",ha.functionArguments={},ha.functionArguments.Colormap=ia,ha.variableName="Raster"):(w.forEach(J.infos,function(wa,Z){ma=wa.symbol&&wa.symbol.color;ma.a?(0===Z?R.push.call(R,wa.minValue,wa.maxValue+1E-4):R.push.call(R,wa.minValue+1E-4,wa.maxValue+1E-4),W.push(Z),ia.push([Z,ma.r,ma.g,ma.b])):X.push(wa.minValue,wa.maxValue)}),ha=na&&na.pixelType||this.pixelType,
this._adjustColormapToPixelTypeRange(ia,ha),ha=new z,ha.functionName="Remap",ha.functionArguments={InputRanges:R,OutputValues:W,NoDataRanges:X},ha.variableName="Raster",ua=new z,ua.functionName="Colormap",ua.functionArguments={Colormap:ia,Raster:ha},ha=ua);return ha},_convertUniqueValueRenderer:function(J){var R=[],W=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);if(W){var X=this._renderingRuleAttributeTable[W];var ia=this._rasterFunctionTemplateInfos[W]}var ma=X&&X.features?X.features:
this._rasterAttributeTableFeatures;var ha=(W=X&&X.fields?X.fields:this._rasterAttributeTableFields)&&W.length?this._getValueField(W):"Value";w.forEach(J.infos,function(xa){var ua=xa.symbol.color;ua.a&&(J.attributeField.toLowerCase()!==ha.toLowerCase()&&ma.length?w.forEach(ma,function(na){na.attributes[J.attributeField]==xa.value&&R.push([na.attributes[ha],ua.r,ua.g,ua.b])},this):R.push([xa.value,ua.r,ua.g,ua.b]))},this);this._adjustColormapToPixelTypeRange(R,ia&&ia.pixelType||this.pixelType);ia=new z;
ia.functionName="Colormap";ia.functionArguments={};ia.functionArguments.Colormap=R;ia.variableName="Raster";return ia},_adjustColormapToPixelTypeRange:function(J,R){(R=this._pixelTypeRanges[R])&&J.push([Math.floor(R[0]-1),0,0,0],[Math.ceil(R[1]+1),0,0,0]);return J},_combineRenderingRule:function(J,R){if(!J||!R)return J||R;var W=function(X){var ia=X.Raster;return ia=ia&&"esri.layers.RasterFunction"===ia.declaredClass?W(ia.functionArguments):X};J=q.clone(J);"none"!==R.functionName.toLocaleLowerCase()&&
(W(J.functionArguments).Raster=R);return J},_isItemLevelRasterFunction:function(J){var R=J&&J.functionName;if(!R||!this._hasItemLevelRFT)return!1;var W=!1;w.some(this.rasterFunctionInfos,function(X){if(X&&X.name===R){if(1===X.functionType||2===X.functionType)W=!0;return!0}});return W},_getServiceLevelRenderingRule:function(J){if(!this._hasItemLevelRFT||!J)return J;J=new z(J.toJson());var R=J.functionArguments;for(var W;;)if((W=R&&R.Raster)&&W.functionArguments&&W.functionArguments.Raster)R=W,R=R.functionArguments;
else{this._isItemLevelRasterFunction(W)&&delete R.Raster;break}return J},_getItemLevelRenderingRule:function(J){if(!this._hasItemLevelRFT||!J)return null;if(this._isItemLevelRasterFunction(J))return J;J=new z(J.toJson());for(J=J.functionArguments;;)if((J=J&&J.Raster)&&J.functionArguments&&J.functionArguments.Raster)J=J.functionArguments;else{if(this._isItemLevelRasterFunction(J))return J;break}},_resolve:function(J,R,W,X,ia){R&&this[R].apply(this,J);W&&W.apply(null,J);X&&a._resDfd(X,J,ia)},_toggleTime:function(){var J=
this._map;this.timeInfo&&this.useMapTime&&J&&!this.suspended?(this._timeConnect||(this._timeConnect=r.connect(J,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(J.timeExtent)):(r.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(J,R){this.useMapTime=J;this._toggleTime();!R&&this._map&&this.refresh(!0)},_setTime:function(J){this._params&&(this._params.time=J?J.toJson().join(","):null)},onResume:function(){if(this._isScientificData()||
this.timeInfo)this._originalGetImageUrl=this._originalGetImageUrl||this.getImageUrl.bind(this),this.getImageUrl=d(this._originalGetImageUrl,200),this._debounceGetImageTimer&&clearTimeout(this._debounceGetImageTimer),this._debounceGetImageTimer=setTimeout(function(){this.getImageUrl=this._originalGetImageUrl}.bind(this),5E3);this.inherited(arguments)},_onTimeExtentChangeHandler:function(J){this.suspended||(this._setTime(J),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()},
getColormap:function(J){var R=this._url.path+"/colormap",W=new A(a._dfdCanceller),X={f:"json"};J&&J.renderingRule&&(X.renderingRule=m.toJson(J.renderingRule.toJson()));this.hasColormap?(W._pendingDfd=e({url:R,content:X,handleAs:"json",callbackParamName:"callback"}),W._pendingDfd.then(function(ia){W.callback(ia)},function(ia){W.errback(ia)})):(J=Error("Layer does not support colormap"),J.log=!!v.isDebug,W.errback(J));return W},getRenderingRuleColormap:function(J){var R=new A(a._dfdCanceller);if(!J||
!J.renderingRule)return R.errback(Error("Rendering rule is not specified")),R;J=J.renderingRule;var W=this._getRenderingRuleId(J);this._renderingRuleColormap&&W&&this._renderingRuleColormap.hasOwnProperty(W)?R.resolve(this._renderingRuleColormap[W]):R=this.getColormap({renderingRule:J}).then(q.hitch(this,function(X){X=X&&X.colormap;W&&(this._renderingRuleColormap[W]=X);return X}));return R},_handleClipFunctionInRenderingRule:function(J){J=q.clone(J);var R=J.arguments,W=R.ClippingGeometry&&R.ClippingGeometry.value,
X=R.Extent&&R.Extent.value;R.ClippingRaster&&R.ClippingRaster.value||W||X||(R=this._map.extent.toJson(),J.arguments.Extent.value=R,J.functionArguments.Extent.value=R,J._isTemplate&&(J._templateJson.arguments.Extent.value=R));return J}});l("extend-esri")&&q.setObject("layers.ImageServiceLayerMixin",E,c);return E})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point ./RasterFunction".split(" "),function(E,q,A,w,m,v,r){var l=E(null,
{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],itemRenderingRule:null,constructor:function(k){q.isObject(k)&&(q.mixin(this,k),k.mosaicMethod&&(this.method=k.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),k.mosaicOperation&&(this.operation=k.mosaicOperation),this.operation&&
"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),k.fids&&(this.objectIds=k.fids),k.viewpoint&&(this.viewpoint=new v(k.viewpoint)),k.itemRenderingRule&&(this.itemRenderingRule=new r(k.itemRenderingRule)),this.multidimensionalDefinition=k.multidimensionalDefinition||[])},toJson:function(){var k=null,n=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(n){k=[];for(var d=0;d<n;d++)k.push("esri.layers.DimensionalDefinition"===
this.multidimensionalDefinition[d].declaredClass?this.multidimensionalDefinition[d].toJson():this.multidimensionalDefinition[d])}k={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:q.clone(this.lockRasterIds),viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:q.clone(this.objectIds),mosaicOperation:this.operation,multidimensionalDefinition:k,itemRenderingRule:this.itemRenderingRule?this.itemRenderingRule.toJson():
null};return m.filter(k,function(c){if(null!==c)return!0})},_getMethodEnum:function(k){if(k){var n=l.METHOD_NONE;switch(k.toLowerCase()){case "byattribute":n=l.METHOD_ATTRIBUTE;break;case "center":n=l.METHOD_CENTER;break;case "lockraster":n=l.METHOD_LOCKRASTER;break;case "nadir":n=l.METHOD_NADIR;break;case "northwest":n=l.METHOD_NORTHWEST;break;case "seamline":n=l.METHOD_SEAMLINE;break;case "viewpoint":n=l.METHOD_VIEWPOINT}return n}},_getOperatorEnum:function(k){if(k)switch(k.toLowerCase()){case "first":return l.OPERATION_FIRST;
case "last":return l.OPERATION_LAST;case "max":return l.OPERATION_MAX;case "min":return l.OPERATION_MIN;case "blend":return l.OPERATION_BLEND;case "mean":return l.OPERATION_MEAN;case "sum":return l.OPERATION_SUM}}});q.mixin(l,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",
OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});A("extend-esri")&&q.setObject("layers.MosaicRule",l,w);return l})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(E,q,A,w,m){E=E(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,
constructor:function(v){q.isObject(v)&&q.mixin(this,v)},toJson:function(){var v={variableName:this.variableName,dimensionName:this.dimensionName,values:q.clone(this.values),isSlice:this.isSlice};return m.filter(v,function(r){return null!==r})}});A("extend-esri")&&q.setObject("layers.DimensionalDefinition",E,w);return E})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f){var h,p,B,u,t,z;q=q(n,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(I){this.imageServiceUrl=I;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(I,N,S){var M=this,Q=new w(b._dfdCanceller);if(10>l("ie"))throw"This browser is not supported.";
if(!I.imageServiceParameters)throw"Insufficient parameters to read data";var da=A.clone(I.imageServiceParameters),J=I.pixelType;m.some(this.validPixelTypes,function(ha){return ha===J})||(da.pixelType="F32");m.some(this.validFormats,function(ha){return ha.toLowerCase()===da.format.toLowerCase()})||(da.format="lerc");var R=I.decodeFunc,W;this._prepareGetImageParameters(da);var X=da.width,ia=da.height,ma=da.extent;delete da.width;delete da.height;delete da.extent;Q._pendingDfd=d({url:this.imageServiceUrl+
"/exportImage",handleAs:"arraybuffer",content:A.mixin(da,{f:"image"}),load:function(ha){M.decode(ha,{width:X,height:ia,planes:null,pixelType:J,noDataValue:da.noData,format:da.format,decodeFunc:R}).then(function(xa){W={pixelBlock:xa,extent:ma};M._resolve([W,da],"onRasterReadComplete",N,Q)},function(xa){M._resolve([xa],null,S,Q,!0)})},error:function(ha){M._resolve([ha],null,S,Q,!0)}});return Q.promise},decode:function(I,N){if(void 0===N||null===N)throw"missing decode options";var S;N.format&&(S=N.format.toUpperCase());
"BSQ"!==S&&"BIP"!==S&&(S=this._getFormat(I));var M=N.decodeFunc;if(void 0===M||null===M)M=this._getFormatDecoderDfd(S);return M(I,N)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(I){if(I.size&&I.bbox){var N=I.size.split(",");I.width=parseFloat(N[0]);I.height=parseFloat(N[1]);I.extent||(N=I.bbox.split(","),I.extent=new c(parseFloat(N[0]),parseFloat(N[1]),parseFloat(N[2]),parseFloat(N[3]),new g(I.bboxSR)))}else{if(!I.width||Math.floor(I.width)!==I.width||!I.height||Math.floor(I.height)!==
I.height)throw"Incorrect Image Dimensions";if(!I.extent||"esri.geometry.Extent"!==I.extent.declaredClass)throw"Incorrect extent";N=I.extent;var S=N.spatialReference.wkid||r.toJson(N.spatialReference.toJson());delete I._ts;A.mixin(I,{bbox:N.xmin+","+N.ymin+","+N.xmax+","+N.ymax,imageSR:S,bboxSR:S,size:I.width+","+I.height},I.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(I,N,S){var M=I.ymax-I.ymin,Q=I.xmax-I.xmin;S>=N?I.ymax=I.ymin+Q*N/S:I.xmax=I.xmin+M*S/N;return I},
_resolve:function(I,N,S,M,Q){N&&this[N].apply(this,I);S&&S.apply(null,I);M&&b._resDfd(M,I,Q)},_getFormatDecoderDfd:function(I){var N=null;switch(I){case "LERC":N=this._decodeLerc;break;case "LERC2":N=this._decodeLerc2;break;case "JPEG":N=this._decodeJpeg;break;case "PNG":N=this._decodePng;break;case "BSQ":N=this._decodeBsq;break;case "BIP":N=this._decodeBip;break;case "TIFF":N=this._decodeTiff;break;default:N=function(S,M){throw"The raster format is not supported";}}N=A.hitch(this,N);return function(S,
M){var Q=new w;try{if("LERC"===I||!0===t){var da=N(S,M);Q.resolve(da)}else z.then(function(){da=N(S,M);Q.resolve(da)})}catch(J){Q.reject(J)}return Q}},_getFormat:function(I){I=new Uint8Array(I,0,10);var N="";if(255===I[0]&&216===I[1])N="JPEG";else if(137===I[0]&&80===I[1]&&78===I[2]&&71===I[3])N="PNG";else if(67===I[0]&&110===I[1]&&116===I[2]&&90===I[3]&&73===I[4]&&109===I[5]&&97===I[6]&&103===I[7]&&101===I[8]&&32===I[9])N="LERC";else if(76===I[0]&&101===I[1]&&114===I[2]&&99===I[3]&&50===I[4]&&32===
I[5])N="LERC2";else if(-1<String.fromCharCode.apply(null,I).toLowerCase().indexOf("error"))N="ERROR";else if(73===I[0]&&73===I[1]&&42===I[2]&&0===I[3]||77===I[0]&&77===I[1]&&0===I[2]&&42===I[3])N="TIFF";return N},_validateDecodeParams:function(I){if(!I.height||Math.floor(I.height)!==I.height)throw"Height not provided.";if(!I.width||Math.floor(I.width)!==I.width)throw"Width not provided.";},_decodeJpeg:function(I,N){if(!h)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(N);
I=(new h).decode(I);if(!H(I,N))throw"The decoded image dimensions are incorrect.";N=[];var S;for(S=0;S<I.pixels.length;S++){var M=I.pixels[S];N.push(this._calculateBandStatistics(M))}return new e({width:I.width,height:I.height,pixels:I.pixels,pixelType:"U8",mask:I.mask,statistics:N})},_decodePng:function(I,N){if(!p)throw"The png decoder module is not loaded.";this._validateDecodeParams(N);I=new Uint8Array(I);var S=new p(I);I=new Uint8Array(N.width*N.height*4);S.copyToImageData(I,S.decodePixels());
var M=S=0;M=new Uint8Array(N.width*N.height);for(S=0;S<N.width*N.height;S++)M[S]=I[4*S+3];var Q=new e({width:N.width,height:N.height,pixels:[],pixelType:"U8",mask:M,statistics:[]});for(S=0;3>S;S++){var da=new Uint8Array(N.width*N.height);for(M=0;M<N.width*N.height;M++)da[M]=I[4*M+S];Q.addData({pixels:da,statistics:this._calculateBandStatistics(da)})}return Q},_decodeBsq:function(I,N){if(!B)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(N);y=N.noDataValue;N.pixelType=D(N.pixelType);
I=B.decodeBSQ(I,{bandCount:N.planes,width:N.width,height:N.height,pixelType:x,noDataValue:y});var S=[],M,Q=null;for(M=0;M<I.pixels.length;M++)Q=I.pixels[M],S.push(this._calculateBandStatistics(Q));return new e({width:N.width,height:N.height,pixels:I.pixels,pixelType:N.pixelType,mask:I.maskData,statistics:S})},_decodeBip:function(I,N){this._validateDecodeParams(N);y=N.noDataValue;N.pixelType=D(N.pixelType);I=B.decodeBIP(I,{bandCount:N.planes,width:N.width,height:N.height,pixelType:x,noDataValue:y});
var S=[],M,Q=null;for(M=0;M<I.pixels.length;M++)Q=I.pixels[M],S.push(this._calculateBandStatistics(Q));return new e({width:N.width,height:N.height,pixels:I.pixels,pixelType:N.pixelType,mask:I.maskData,statistics:S})},_decodeTiff:function(I,N){this._validateDecodeParams(N);y=N.noDataValue;N.pixelType=D(N.pixelType);I=u.decode(I);N=[];var S,M=null;for(S=0;S<I.pixels.length;S++)M=I.pixels[S],N.push(this._calculateBandStatistics(M,I.maskData));return new e({width:I.width,height:I.height,pixels:I.pixels,
pixelType:I.pixelType,mask:I.maskData,statistics:N})},_decodeLerc:function(I,N){this._validateDecodeParams(N);y=N.noDataValue;N.pixelType=D(N.pixelType);for(var S=0,M,Q=0,da,J=I.byteLength-10;Q<J;){var R=a.decode(I,{inputOffset:Q,encodedMaskData:M,returnMask:0===S?!0:!1,returnEncodedMask:0===S?!0:!1,returnFileInfo:!0,pixelType:x,noDataValue:y});Q=R.fileInfo.eofOffset;0===S&&(M=R.encodedMaskData,da=new e({width:N.width,height:N.height,pixels:[],pixelType:N.pixelType,mask:R.maskData,statistics:[]}));
S++;if(!H(R,N))throw"The decoded image dimensions are incorrect";da.addData({pixels:R.pixelData,statistics:{minValue:R.minValue,maxValue:R.maxValue,noDataValue:R.noDataValue}})}return da},_decodeLerc2:function(I,N){this._validateDecodeParams(N);y=N.noDataValue;N.pixelType=D(N.pixelType);for(var S=0,M,Q,da=0,J,R=I.byteLength-10,W=[];da<R;){Q=f.decode(I,{inputOffset:da,maskData:M,returnFileInfo:!0});da=Q.fileInfo.eofOffset;0===S&&(M=Q.maskData,J=new e({width:N.width,height:N.height,pixels:[],pixelType:Q.fileInfo.pixelType,
mask:Q.maskData,statistics:[]}));Q.fileInfo.mask&&0<Q.fileInfo.mask.numBytes&&W.push(Q.maskData);S++;if(!H(Q,N))throw"The decoded image dimensions are incorrect";if(1<Q.dimCount&&Q.pixelData&&Q.pixelData.length===Q.width*Q.height*Q.dimCount){Q.pixelData=Q.pixelData.slice(-Q.width*Q.height);var X=Q.dimStats&&Q.dimStats.minValues&&Q.dimStats.minValues[Q.dimCount-1],ia=Q.dimStats&&Q.dimStats.maxValues&&Q.dimStats.maxValues[Q.dimCount-1];null!=X&&null!=ia&&(Q.minValue=X,Q.maxValue=ia)}J.addData({pixels:Q.pixelData,
statistics:{minValue:Q.minValue,maxValue:Q.maxValue,noDataValue:Q.noDataValue}})}if(1<W.length){Q=J.width*J.height;J.bandMasks=W;M=new Uint8Array(Q);M.set(W[0]);for(N=1;N<W.length;N++)for(I=W[N],S=0;S<Q;S++)M[S]&=I[S];J.maskData=M}return J},_calculateBandStatistics:function(I,N){var S=Infinity,M=-Infinity,Q=I.length,da,J=0;if(N)for(da=0;da<Q;da++)N[da]&&(J=I[da],S=J<S?J:S,M=J>M?J:M);else for(da=0;da<Q;da++)J=I[da],S=J<S?J:S,M=J>M?J:M;return{minValue:S,maxValue:M}},_loadRasterFormatModules:function(){t||
(z||(z=new w),10>l("ie")?z.isRejected()||z.reject("unsupported browser version"):E(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(I,N,S,M){h=I;p=N;B=S;u=M;t=!0;z.isResolved()||z.resolve(!0)}))}});var x=null,y=null,D=function(I){if("U1"===I||"U2"===I||"U4"===I||"U8"===I)return y=Math.pow(2,8)-1,x=Uint8Array,"U8";"U16"===I?(y=y||Math.pow(2,16)-1,x=Uint16Array):"U32"===I?(y=y||Math.pow(2,32)-1,x=Uint32Array):"S8"===
I?(y=y||0-Math.pow(2,7),x=Int8Array):"S16"===I?(y=y||0-Math.pow(2,15),x=Int16Array):"S32"===I?(y=y||0-Math.pow(2,31),x=Int32Array):x=Float32Array;return I},H=function(I,N){return I.height!==N.height||I.width!==N.width?!1:!0};l("extend-esri")&&A.setObject("layers.Raster",q,k);return q})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(E,q,A,w){E=E([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,
pixels:[],statistics:[],maskIsAlpha:!1,validPixelCount:null,constructor:function(m){if(m){if(!m.width||Math.floor(m.width)!==m.width)throw"PixelBlock: incorrect width";if(!m.height||Math.floor(m.height)!==m.height)throw"PixelBlock: incorrect height";if(!m.pixels)throw"PixelBlock: pixel data not present";this.width=m.width;this.height=m.height;this.pixels=m.pixels;this.pixelType=m.pixelType||null;this.statistics=m.statistics;this.mask=m.mask||null;this.maskIsAlpha=m.maskIsAlpha||!1;m=m.validPixelCount;
null==m&&(m=this.mask?this._getValidPixelCount(this.mask):this.width*this.height);this.validPixelCount=m}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(m){if(!m.pixels||!m.statistics)throw"Pixel data or statistics are not present";if(m.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(m.statistics);this.pixels.push(m.pixels)},
getAsRGBA:function(){var m=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(m);break;default:this._fillFrom8Bit(m)}return new Uint8ClampedArray(m)},getAsRGBAFloat:function(){var m=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(m);return m},clone:function(m){m=m||this;var v=new this.constructor;v.width=m.width;v.height=m.height;v.pixelType=m.pixelType;v.maskIsAlpha=m.maskIsAlpha;
m.mask&&(v.mask=new Uint8Array(m.mask));var r,l;if(m.pixels){v.pixels=[];var k=(l=m.pixels.length)&&m.pixels[0].slice;for(r=0;r<l;r++)v.pixels[r]=k?m.pixels[r].slice(0,m.pixels[r].length):new m.pixels[r].constructor(m.pixels[r])}if(m.statistics)for(v.statistics=[],l=m.statistics.length,r=0;r<l;r++)v.statistics[r]=q.clone(m.statistics[r]);m=m.validPixelCount;null==m&&(m=v.mask?this._getValidPixelCount(v.mask):v.width*v.height);return v},clamp:function(m){if("F64"!==m&&"F32"!==m){switch(m){case "U8":var v=
[0,255];break;case "U16":v=[0,65535];break;case "U32":v=[0,4294967295];break;case "S8":v=[-128,127];break;case "S16":v=[-32768,32767];break;case "S32":v=[-2147483648,2147483647];break;default:v=[-3.4*1E39,3.4*1E39]}var r=v[0];v=v[1];var l=this.pixels,k=this.width*this.height,n=l.length,d,c,g=[];for(d=0;d<n;d++){var b=this._createEmptyBand(m,k);var e=l[d];for(c=0;c<k;c++){var a=e[c];b[c]=a>v?v:a<r?r:a}g.push(b)}this.pixels=g;this.pixelType=m}},calculateStatistics:function(){var m,v=[],r=this.mask;
for(m=0;m<this.pixels.length;m++){var l=this.pixels[m];v.push(this._calculateBandStatistics(l,r))}this.statistics=v},_getValidPixelCount:function(m){var v,r=0;for(v=0;v<m.length;v++)m[v]&&r++;return r},_createEmptyBand:function(m,v){switch(m){case "U8":m=new Uint8Array(v);break;case "U16":m=new Uint16Array(v);break;case "U32":m=new Uint32Array(v);break;case "S8":m=new Int8Array(v);break;case "S16":m=new Int16Array(v);break;case "S32":m=new Int32Array(v);break;case "U32":m=new Uint32Array(v);break;
case "F32":m=new Float32Array(v);break;case "F64":m=new Float64Array(v);break;default:m=new Float32Array(v)}return m},_fillFrom8Bit:function(m){var v=this.pixels,r=this.mask;if(!m||!v||!v.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var l,k;var n=l=k=v[0];3<=v.length&&(l=v[1],k=v[2]);v=new Uint32Array(m);var d=this.width*this.height;if(n.length!==d)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(r&&r.length===d)if(this.maskIsAlpha)for(m=
0;m<d;m++)r[m]&&(v[m]=r[m]<<24|k[m]<<16|l[m]<<8|n[m]);else for(m=0;m<d;m++)r[m]&&(v[m]=-16777216|k[m]<<16|l[m]<<8|n[m]);else for(m=0;m<d;m++)v[m]=-16777216|k[m]<<16|l[m]<<8|n[m]},_fillFromNon8Bit:function(m){var v=this.pixels,r=this.mask,l=this.statistics;if(!m||!v||!v.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var k=1,n=0;k=1;l&&0<l.length?(n=l.map(function(b){return b.minValue}).reduce(function(b,e){return Math.min(b,e)}),k=l.map(function(b){return b.maxValue-
b.minValue}).reduce(function(b,e){return Math.max(b,e)}),k=255/k):(k=255,"S8"===this.pixelType?(n=-128,k=127):"U16"===this.pixelType?k=65535:"S16"===this.pixelType?(n=-32768,k=32767):"U32"===this.pixelType?k=4294967295:"S32"===this.pixelType?(n=-2147483648,k=2147483647):"F32"===this.pixelType?(n=-3.4*1E39,k=3.4*1E39):"F64"===this.pixelType&&(n=-Number.MAX_VALUE,k=Number.MAX_VALUE),k=255/(k-n));m=new Uint32Array(m);l=this.width*this.height;var d=v[0];if(d.length!==l)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");
if(3<=v.length){var c=v[1];var g=v[2];if(r&&r.length===l)for(v=0;v<l;v++)r[v]&&(m[v]=-16777216|(g[v]-n)*k<<16|(c[v]-n)*k<<8|(d[v]-n)*k);else for(v=0;v<l;v++)m[v]=-16777216|(g[v]-n)*k<<16|(c[v]-n)*k<<8|(d[v]-n)*k}else if(r&&r.length===l)for(v=0;v<l;v++)c=(d[v]-n)*k,r[v]&&(m[v]=-16777216|c<<16|c<<8|c);else for(v=0;v<l;v++)c=(d[v]-n)*k,m[v]=-16777216|c<<16|c<<8|c},_fillFrom32Bit:function(m){var v=this.pixels,r=this.mask;if(!m||!v||!v.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var l,k;var n=l=k=v[0];3<=v.length&&(l=v[1],k=v[2]);var d=this.width*this.height;if(n.length!==d)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var c=0;if(r&&r.length===d)for(v=0;v<d;v++)m[c++]=n[v],m[c++]=l[v],m[c++]=k[v],m[c++]=r[v]&1;else for(v=0;v<d;v++)m[c++]=n[v],m[c++]=l[v],m[c++]=k[v],m[c++]=1},_calculateBandStatistics:function(m,v){var r=Infinity,l=-Infinity,k=m.length,n,d=0;if(v)for(n=0;n<k;n++)v[n]&&(d=m[n],r=d<r?d:r,l=d>l?d:l);else for(n=0;n<k;n++)d=m[n],
r=d<r?d:r,l=d>l?d:l;return{minValue:r,maxValue:l}}});A("extend-esri")&&q.setObject("layers.PixelBlock",E,w);return E})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var E={defaultNoDataValue:-3.4027999387901484E38,decode:function(A,w){w=w||{};var m=w.inputOffset||0,v=w.encodedMaskData||null===w.encodedMaskData,r={},l=new Uint8Array(A,m,10);r.fileIdentifierString=String.fromCharCode.apply(null,l);if("CntZImage"!=r.fileIdentifierString.trim())throw"Unexpected file identifier string: "+
r.fileIdentifierString;m+=10;l=new DataView(A,m,24);r.fileVersion=l.getInt32(0,!0);r.imageType=l.getInt32(4,!0);r.height=l.getUint32(8,!0);r.width=l.getUint32(12,!0);r.maxZError=l.getFloat64(16,!0);m+=24;if(!v)if(l=new DataView(A,m,16),r.mask={},r.mask.numBlocksY=l.getUint32(0,!0),r.mask.numBlocksX=l.getUint32(4,!0),r.mask.numBytes=l.getUint32(8,!0),r.mask.maxValue=l.getFloat32(12,!0),m+=16,0<r.mask.numBytes){v=new Uint8Array(Math.ceil(r.width*r.height/8));l=new DataView(A,m,r.mask.numBytes);var k=
l.getInt16(0,!0),n=2,d=0;do{if(0<k)for(;k--;)v[d++]=l.getUint8(n++);else{var c=l.getUint8(n++);for(k=-k;k--;)v[d++]=c}k=l.getInt16(n,!0);n+=2}while(n<r.mask.numBytes);if(-32768!==k||d<v.length)throw"Unexpected end of mask RLE encoding";r.mask.bitset=v;m+=r.mask.numBytes}else 0===(r.mask.numBytes|r.mask.numBlocksY|r.mask.maxValue)&&(v=new Uint8Array(Math.ceil(r.width*r.height/8)),r.mask.bitset=v);l=new DataView(A,m,16);r.pixels={};r.pixels.numBlocksY=l.getUint32(0,!0);r.pixels.numBlocksX=l.getUint32(4,
!0);r.pixels.numBytes=l.getUint32(8,!0);r.pixels.maxValue=l.getFloat32(12,!0);m+=16;v=r.pixels.numBlocksX;l=r.pixels.numBlocksY;v+=0<r.width%v?1:0;k=l+(0<r.height%l?1:0);r.pixels.blocks=Array(v*k);for(d=n=0;d<k;d++)for(c=0;c<v;c++){var g=0;l=new DataView(A,m,Math.min(10,A.byteLength-m));var b={};r.pixels.blocks[n++]=b;var e=l.getUint8(0);g++;b.encoding=e&63;if(3<b.encoding)throw"Invalid block encoding ("+b.encoding+")";if(2===b.encoding)m++;else{if(0!==e&&2!==e){e>>=6;b.offsetType=e;if(2===e)b.offset=
l.getInt8(1),g++;else if(1===e)b.offset=l.getInt16(1,!0),g+=2;else if(0===e)b.offset=l.getFloat32(1,!0),g+=4;else throw"Invalid block offset type";if(1===b.encoding)if(e=l.getUint8(g),g++,b.bitsPerPixel=e&63,e>>=6,b.numValidPixelsType=e,2===e)b.numValidPixels=l.getUint8(g),g++;else if(1===e)b.numValidPixels=l.getUint16(g,!0),g+=2;else if(0===e)b.numValidPixels=l.getUint32(g,!0),g+=4;else throw"Invalid valid pixel count type";}m+=g;if(3!=b.encoding)if(0===b.encoding){e=(r.pixels.numBytes-1)/4;if(e!==
Math.floor(e))throw"uncompressed block has invalid length";l=new ArrayBuffer(4*e);g=new Uint8Array(l);g.set(new Uint8Array(A,m,4*e));l=new Float32Array(l);b.rawData=l;m+=4*e}else 1===b.encoding&&(e=Math.ceil(b.numValidPixels*b.bitsPerPixel/8),l=new ArrayBuffer(4*Math.ceil(e/4)),g=new Uint8Array(l),g.set(new Uint8Array(A,m,e)),b.stuffedData=new Uint32Array(l),m+=e)}}r.eofOffset=m;A=null!=w.noDataValue?w.noDataValue:E.defaultNoDataValue;v=w.encodedMaskData;e=w.returnMask;k=0;n=r.pixels.numBlocksX;d=
r.pixels.numBlocksY;c=Math.floor(r.width/n);b=Math.floor(r.height/d);g=2*r.maxZError;m=Number.MAX_VALUE;v=v||(r.mask?r.mask.bitset:null);var a;l=new (w.pixelType||Float32Array)(r.width*r.height);e&&v&&(a=new Uint8Array(r.width*r.height));e=new Float32Array(c*b);for(var f,h,p=0;p<=d;p++){var B=p!==d?b:r.height%d;if(0!==B)for(var u=0;u<=n;u++){var t=u!==n?c:r.width%n;if(0!==t){var z=p*r.width*b+u*c,x=r.width-t,y=r.pixels.blocks[k],D;if(2>y.encoding){if(0===y.encoding)var H=y.rawData;else{var I=D=H=
void 0;f=y.stuffedData;h=y.bitsPerPixel;var N=y.numValidPixels,S=y.offset,M=g,Q=e,da=r.pixels.maxValue,J=(1<<h)-1,R=0,W=0,X=Math.ceil((da-S)/M);f[f.length-1]<<=8*(4*f.length-Math.ceil(h*N/8));for(I=0;I<N;I++)0===W&&(H=f[R++],W=32),W>=h?(D=H>>>W-h&J,W-=h):(W=h-W,D=(H&J)<<W&J,H=f[R++],W=32-W,D+=H>>>W),Q[I]=D<X?S+D*M:da;H=e}D=0}else var ia=2===y.encoding?0:y.offset;if(v)for(h=0;h<B;h++){if(z&7){var ma=v[z>>3];ma<<=z&7}for(f=0;f<t;f++)z&7||(ma=v[z>>3]),ma&128?(a&&(a[z]=1),I=2>y.encoding?H[D++]:ia,m=m>
I?I:m,l[z++]=I):(a&&(a[z]=0),l[z++]=A),ma<<=1;z+=x}else if(2>y.encoding)for(h=0;h<B;h++){for(f=0;f<t;f++)I=H[D++],m=m>I?I:m,l[z++]=I;z+=x}else for(m=m>ia?ia:m,h=0;h<B;h++){for(f=0;f<t;f++)l[z++]=ia;z+=x}if(1===y.encoding&&D!==y.numValidPixels)throw"Block and Mask do not match";k++}}}ia=a;a={width:r.width,height:r.height,pixelData:l,minValue:m,maxValue:r.pixels.maxValue,noDataValue:A};ia&&(a.maskData=ia);w.returnEncodedMask&&r.mask&&(a.encodedMaskData=r.mask.bitset?r.mask.bitset:null);if(w.returnFileInfo&&
(a.fileInfo=q(r),w.computeUsedBitDepths)){w=a.fileInfo;ia=r.pixels.numBlocksX*r.pixels.numBlocksY;ma={};for(H=0;H<ia;H++)D=r.pixels.blocks[H],0===D.encoding?ma.float32=!0:1===D.encoding?ma[D.bitsPerPixel]=!0:ma[0]=!0;r=Object.keys(ma);w.bitDepths=r}return a}},q=function(A){return{fileIdentifierString:A.fileIdentifierString,fileVersion:A.fileVersion,imageType:A.imageType,height:A.height,width:A.width,maxZError:A.maxZError,eofOffset:A.eofOffset,mask:A.mask?{numBlocksX:A.mask.numBlocksX,numBlocksY:A.mask.numBlocksY,
numBytes:A.mask.numBytes,maxValue:A.mask.maxValue}:null,pixels:{numBlocksX:A.pixels.numBlocksX,numBlocksY:A.pixels.numBlocksY,numBytes:A.pixels.numBytes,maxValue:A.pixels.maxValue,noDataValue:this.noDataValue}}};return E})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var E={unstuff:function(w,m,v,r,l,k,n,d){var c=(1<<v)-1,g=0,b,e=0;w[w.length-1]<<=8*(4*w.length-Math.ceil(v*r/8));if(l)for(b=0;b<r;b++){if(0===e){var a=w[g++];e=32}if(e>=v){var f=a>>>e-v&c;e-=v}else e=v-e,f=
(a&c)<<e&c,a=w[g++],e=32-e,f+=a>>>e;m[b]=l[f]}else for(l=Math.ceil((d-k)/n),b=0;b<r;b++)0===e&&(a=w[g++],e=32),e>=v?(f=a>>>e-v&c,e-=v):(e=v-e,f=(a&c)<<e&c,a=w[g++],e=32-e,f+=a>>>e),m[b]=f<l?k+f*n:d},unstuffLUT:function(w,m,v,r,l,k){var n=(1<<m)-1,d=0,c=0,g=0,b=g=0,e=[];w[w.length-1]<<=8*(4*w.length-Math.ceil(m*v/8));var a=Math.ceil((k-r)/l);for(c=0;c<v;c++){if(0===g){var f=w[d++];g=32}g>=m?(b=f>>>g-m&n,g-=m):(g=m-g,b=(f&n)<<g&n,f=w[d++],g=32-g,b+=f>>>g);e[c]=b<a?r+b*l:k}e.unshift(r);return e},unstuff2:function(w,
m,v,r,l,k,n,d){var c=(1<<v)-1,g=0,b,e=0,a=0;if(l)for(b=0;b<r;b++){if(0===e){var f=w[g++];e=32;a=0}if(e>=v){var h=f>>>a&c;e-=v;a+=v}else{var p=v-e;h=f>>>a&c;f=w[g++];e=32-p;h|=(f&(1<<p)-1)<<v-p;a=p}m[b]=l[h]}else for(l=Math.ceil((d-k)/n),b=0;b<r;b++)0===e&&(f=w[g++],e=32,a=0),e>=v?(h=f>>>a&c,e-=v,a+=v):(p=v-e,h=f>>>a&c,f=w[g++],e=32-p,h|=(f&(1<<p)-1)<<v-p,a=p),m[b]=h<l?k+h*n:d;return m},unstuffLUT2:function(w,m,v,r,l,k){var n=(1<<m)-1,d=0,c=0,g=0,b=0,e=0,a=0,f=[],h=Math.ceil((k-r)/l);for(c=0;c<v;c++){if(0===
b){var p=w[d++];b=32;a=0}b>=m?(e=p>>>a&n,b-=m,a+=m):(g=m-b,e=p>>>a&n,p=w[d++],b=32-g,e|=(p&(1<<g)-1)<<m-g,a=g);f[c]=e<h?r+e*l:k}f.unshift(r);return f},originalUnstuff:function(w,m,v,r){var l=(1<<v)-1,k=0,n,d=0;w[w.length-1]<<=8*(4*w.length-Math.ceil(v*r/8));for(n=0;n<r;n++){if(0===d){var c=w[k++];d=32}if(d>=v){var g=c>>>d-v&l;d-=v}else d=v-d,g=(c&l)<<d&l,c=w[k++],d=32-d,g+=c>>>d;m[n]=g}return m},originalUnstuff2:function(w,m,v,r){var l=(1<<v)-1,k=0,n,d=0,c=0;for(n=0;n<r;n++){if(0===d){var g=w[k++];
d=32;c=0}if(d>=v){var b=g>>>c&l;d-=v;c+=v}else{var e=v-d;b=g>>>c&l;g=w[k++];d=32-e;b|=(g&(1<<e)-1)<<v-e;c=e}m[n]=b}return m}},q={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(w){for(var m=65535,v=65535,r=w.length,l=Math.floor(r/2),k=0;l;){var n=359<=l?359:l;l-=n;do m+=w[k++]<<8,v+=m+=w[k++];while(--n);m=(m&65535)+(m>>>16);v=(v&65535)+(v>>>16)}r&1&&(v+=m+=w[k]<<8);return((v&65535)+(v>>>16)<<16|(m&65535)+(m>>>16))>>>0},readHeaderInfo:function(w,m){var v=m.ptr,r=new Uint8Array(w,v,6),l=
{};l.fileIdentifierString=String.fromCharCode.apply(null,r);if(0!==l.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+l.fileIdentifierString;v+=6;r=new DataView(w,v,8);var k=r.getInt32(0,!0);l.fileVersion=k;v+=4;3<=k&&(l.checksum=r.getUint32(4,!0),v+=4);r=new DataView(w,v,12);l.height=r.getUint32(0,!0);l.width=r.getUint32(4,!0);v+=8;4<=k?(l.numDims=r.getUint32(8,!0),v+=4):l.numDims=1;r=new DataView(w,v,40);l.numValidPixel=r.getUint32(0,!0);l.microBlockSize=
r.getInt32(4,!0);l.blobSize=r.getInt32(8,!0);l.imageType=r.getInt32(12,!0);l.maxZError=r.getFloat64(16,!0);l.zMin=r.getFloat64(24,!0);l.zMax=r.getFloat64(32,!0);v+=40;m.headerInfo=l;m.ptr=v;if(3<=k&&(w=this.computeChecksumFletcher32(new Uint8Array(w,v-(4<=k?52:48),l.blobSize-14)),w!==l.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(w,m){var v=m.headerInfo,r=this.getDataTypeArray(v.imageType),l=v.numDims*this.getDataTypeSize(v.imageType),k=this.readSubArray(w,m.ptr,r,l);w=this.readSubArray(w,
m.ptr+l,r,l);m.ptr+=2*l;l=!0;for(m=0;m<v.numDims;m++)if(k[m]!==w[m]){l=!1;break}v.minValues=k;v.maxValues=w;return l},readSubArray:function(w,m,v,r){if(v===Uint8Array)w=new Uint8Array(w,m,r);else{var l=new ArrayBuffer(r);(new Uint8Array(l)).set(new Uint8Array(w,m,r));w=new v(l)}return w},readMask:function(w,m){var v=m.ptr,r=m.headerInfo,l=r.width*r.height,k=r.numValidPixel,n=new DataView(w,v,4);r={};r.numBytes=n.getUint32(0,!0);v+=4;if((0===k||l===k)&&0!==r.numBytes)throw"invalid mask";if(0===k)k=
new Uint8Array(Math.ceil(l/8)),r.bitset=k,n=new Uint8Array(l),m.pixels.resultMask=n,v+=r.numBytes;else if(0<r.numBytes){k=new Uint8Array(Math.ceil(l/8));n=new DataView(w,v,r.numBytes);w=n.getInt16(0,!0);var d=2,c=0,g=0;do{if(0<w)for(;w--;)k[c++]=n.getUint8(d++);else for(g=n.getUint8(d++),w=-w;w--;)k[c++]=g;w=n.getInt16(d,!0);d+=2}while(d<r.numBytes);if(-32768!==w||c<k.length)throw"Unexpected end of mask RLE encoding";n=new Uint8Array(l);for(d=d=w=0;d<l;d++)d&7?(w=k[d>>3],w<<=d&7):w=k[d>>3],w&128&&
(n[d]=1);m.pixels.resultMask=n;r.bitset=k;v+=r.numBytes}m.ptr=v;m.mask=r;return!0},readDataOneSweep:function(w,m,v,r){var l=m.ptr,k=m.headerInfo,n=k.numDims,d=k.width*k.height;k=k.numValidPixel*q.getDataTypeSize(k.imageType)*n;var c=m.pixels.resultMask;if(v===Uint8Array)w=new Uint8Array(w,l,k);else{var g=new ArrayBuffer(k);(new Uint8Array(g)).set(new Uint8Array(w,l,k));w=new v(g)}if(w.length===d*n)m.pixels.resultPixels=r?q.swapDimensionOrder(w,d,n,v,!0):w;else{m.pixels.resultPixels=new v(d*n);var b=
g=v=0,e=0;if(1<n)if(r)for(g=0;g<d;g++){if(c[g])for(e=g,b=0;b<n;b++,e+=d)m.pixels.resultPixels[e]=w[v++]}else for(g=0;g<d;g++){if(c[g])for(e=g*n,b=0;b<n;b++)m.pixels.resultPixels[e+b]=w[v++]}else for(g=0;g<d;g++)c[g]&&(m.pixels.resultPixels[g]=w[v++])}m.ptr=l+k;return!0},readHuffmanTree:function(w,m){var v=this.HUFFMAN_LUT_BITS_MAX,r=new DataView(w,m.ptr,16);m.ptr+=16;if(2>r.getInt32(0,!0))throw"unsupported Huffman version";var l=r.getInt32(4,!0),k=r.getInt32(8,!0);r=r.getInt32(12,!0);if(k>=r)return!1;
var n=new Uint32Array(r-k);q.decodeBits(w,m,n);var d=[],c;for(c=k;c<r;c++){var g=c-(c<l?0:l);d[g]={first:n[c-k],second:null}}c=w.byteLength-m.ptr;n=new ArrayBuffer(4*Math.ceil(c/4));(new Uint8Array(n)).set(new Uint8Array(w,m.ptr,c));w=new Uint32Array(n);m=0;n=0;var b=w[0];for(c=k;c<r;c++){g=c-(c<l?0:l);var e=d[g].first;0<e&&(d[g].second=b<<m>>>32-e,32-m>=e?(m+=e,32===m&&(m=0,n++,b=w[n])):(m+=e-32,n++,b=w[n],d[g].second|=b>>>32-m))}var a=b=0,f=new A;for(c=0;c<d.length;c++)void 0!==d[c]&&(b=Math.max(b,
d[c].first));a=b>=v?v:b;v=[];var h;for(c=k;c<r;c++)if(g=c-(c<l?0:l),e=d[g].first,0<e)if(k=[e,g],e<=a){g=d[g].second<<a-e;var p=1<<a-e;for(e=0;e<p;e++)v[g|e]=k}else for(g=d[g].second,p=f,--e;0<=e;e--)(h=g>>>e&1)?(p.right||(p.right=new A),p=p.right):(p.left||(p.left=new A),p=p.left),0!==e||p.val||(p.val=k[1]);return{decodeLut:v,numBitsLUTQick:a,numBitsLUT:b,tree:f,stuffedData:w,srcPtr:n,bitPos:m}},readHuffman:function(w,m,v,r){var l=m.headerInfo.numDims,k=m.headerInfo.height,n=m.headerInfo.width,d=
n*k,c=this.readHuffmanTree(w,m);w=c.decodeLut;var g=c.tree,b=c.stuffedData,e=c.srcPtr,a=c.bitPos,f=c.numBitsLUTQick;c=c.numBitsLUT;var h=0===m.headerInfo.imageType?128:0,p=m.pixels.resultMask,B,u,t,z,x,y,D=0;0<a&&(e++,a=0);var H=b[e],I=1===m.encodeMode,N=new v(d*l),S=N,M;if(2>l||I)for(M=0;M<l;M++)if(1<l&&(S=new v(N.buffer,d*M,d),D=0),m.headerInfo.numValidPixel===n*k)for(t=x=0;t<k;t++)for(z=0;z<n;z++,x++){var Q=0;var da=B=H<<a>>>32-f;32-a<f&&(da=B|=b[e+1]>>>64-a-f);if(w[da])Q=w[da][1],a+=w[da][0];
else for(da=B=H<<a>>>32-c,32-a<c&&(da=B|=b[e+1]>>>64-a-c),da=g,y=0;y<c;y++)if(da=(u=B>>>c-y-1&1)?da.right:da.left,!da.left&&!da.right){Q=da.val;a=a+y+1;break}32<=a&&(a-=32,e++,H=b[e]);Q-=h;I?(Q=0<z?Q+D:0<t?Q+S[x-n]:Q+D,Q&=255,D=S[x]=Q):S[x]=Q}else for(t=x=0;t<k;t++)for(z=0;z<n;z++,x++){if(p[x]){Q=0;da=B=H<<a>>>32-f;32-a<f&&(da=B|=b[e+1]>>>64-a-f);if(w[da])Q=w[da][1],a+=w[da][0];else for(da=B=H<<a>>>32-c,32-a<c&&(da=B|=b[e+1]>>>64-a-c),da=g,y=0;y<c;y++)if(da=(u=B>>>c-y-1&1)?da.right:da.left,!da.left&&
!da.right){Q=da.val;a=a+y+1;break}32<=a&&(a-=32,e++,H=b[e]);Q-=h;I?(Q=0<z&&p[x-1]?Q+D:0<t&&p[x-n]?Q+S[x-n]:Q+D,Q&=255,D=S[x]=Q):S[x]=Q}}else for(t=x=0;t<k;t++)for(z=0;z<n;z++)if(x=t*n+z,!p||p[x])for(M=0;M<l;M++,x+=d){Q=0;da=B=H<<a>>>32-f;32-a<f&&(da=B|=b[e+1]>>>64-a-f);if(w[da])Q=w[da][1],a+=w[da][0];else for(da=B=H<<a>>>32-c,32-a<c&&(da=B|=b[e+1]>>>64-a-c),da=g,y=0;y<c;y++)if(da=(u=B>>>c-y-1&1)?da.right:da.left,!da.left&&!da.right){Q=da.val;a=a+y+1;break}32<=a&&(a-=32,e++,H=b[e]);Q-=h;S[x]=Q}m.ptr=
m.ptr+4*(e+1)+(0<a?4:0);m.pixels.resultPixels=N;1<l&&!r&&(m.pixels.resultPixels=q.swapDimensionOrder(N,d,l,v))},decodeBits:function(w,m,v,r,l){var k=m.headerInfo,n=k.fileVersion,d=0,c=new DataView(w,m.ptr,5<=w.byteLength-m.ptr?5:w.byteLength-m.ptr),g=c.getUint8(0);d++;var b=g>>6,e=0===b?4:3-b,a=0<(g&32)?!0:!1;b=g&31;g=0;if(1===e)g=c.getUint8(d),d++;else if(2===e)g=c.getUint16(d,!0),d+=2;else if(4===e)g=c.getUint32(d,!0),d+=4;else throw"Invalid valid pixel count type";e=2*k.maxZError;l=1<k.numDims?
k.maxValues[l]:k.zMax;if(a){m.counter.lut++;a=c.getUint8(d);d++;k=Math.ceil((a-1)*b/8);var f=Math.ceil(k/4);f=new ArrayBuffer(4*f);var h=new Uint8Array(f);m.ptr+=d;h.set(new Uint8Array(w,m.ptr,k));d=new Uint32Array(f);m.ptr+=k;for(c=0;a-1>>>c;)c++;k=Math.ceil(g*c/8);f=Math.ceil(k/4);f=new ArrayBuffer(4*f);h=new Uint8Array(f);h.set(new Uint8Array(w,m.ptr,k));w=new Uint32Array(f);m.ptr+=k;m=3<=n?E.unstuffLUT2(d,b,a-1,r,e,l):E.unstuffLUT(d,b,a-1,r,e,l);3<=n?E.unstuff2(w,v,c,g,m):E.unstuff(w,v,c,g,m)}else m.counter.bitstuffer++,
c=b,m.ptr+=d,0<c&&(k=Math.ceil(g*c/8),f=Math.ceil(k/4),f=new ArrayBuffer(4*f),h=new Uint8Array(f),h.set(new Uint8Array(w,m.ptr,k)),w=new Uint32Array(f),m.ptr+=k,3<=n?null==r?E.originalUnstuff2(w,v,c,g):E.unstuff2(w,v,c,g,!1,r,e,l):null==r?E.originalUnstuff(w,v,c,g):E.unstuff(w,v,c,g,!1,r,e,l))},readTiles:function(w,m,v,r){var l=m.headerInfo,k=l.width,n=l.height,d=k*n,c=l.microBlockSize,g=l.imageType,b=q.getDataTypeSize(g),e=Math.ceil(k/c),a=Math.ceil(n/c);m.pixels.numBlocksY=a;m.pixels.numBlocksX=
e;var f=m.pixels.ptr=0,h=0,p=0,B=0,u=0,t=0,z=0,x=0,y=f=0,D=0,H=0,I=z=0;z=z=0;var N=new v(c*c);n=n%c||c;var S=k%c||c,M=l.numDims,Q,da=m.pixels.resultMask,J=m.pixels.resultPixels,R=5<=l.fileVersion?14:15,W=l.zMax;for(p=0;p<a;p++)for(u=p!==a-1?c:n,B=0;B<e;B++)for(t=B!==e-1?c:S,D=p*k*c+B*c,H=k-t,Q=0;Q<M;Q++){1<M?(I=J,D=p*k*c+B*c,J=new v(m.pixels.resultPixels.buffer,d*Q*b,d),W=l.maxValues[Q]):I=null;z=w.byteLength-m.ptr;h=new DataView(w,m.ptr,Math.min(10,z));var X={};z=0;x=h.getUint8(0);z++;var ia=5<=
l.fileVersion?x&4:0;f=x>>6&255;y=x>>2&R;if(y!==(B*c>>3&R))throw"integrity issue";if(ia&&0===Q)throw"integrity issue";x&=3;if(3<x)throw m.ptr+=z,"Invalid block encoding ("+x+")";if(2===x){if(ia)if(da)for(f=0;f<u;f++)for(h=0;h<t;h++)da[D]&&(J[D]=I[D]),D++;else for(f=0;f<u;f++)for(h=0;h<t;h++)J[D]=I[D],D++;m.counter.constant++;m.ptr+=z}else if(0===x){if(ia)throw"integrity issue";m.counter.uncompressed++;m.ptr+=z;z=u*t*b;I=w.byteLength-m.ptr;z=z<I?z:I;I=new ArrayBuffer(0===z%b?z:z+b-z%b);ia=new Uint8Array(I);
ia.set(new Uint8Array(w,m.ptr,z));I=new v(I);z=0;if(da)for(f=0;f<u;f++){for(h=0;h<t;h++)da[D]&&(J[D]=I[z++]),D++;D+=H}else for(f=0;f<u;f++){for(h=0;h<t;h++)J[D++]=I[z++];D+=H}m.ptr+=z*b}else if(f=q.getDataTypeUsed(ia&&6>g?4:g,f),X=q.getOnePixel(X,z,f,h),z+=q.getDataTypeSize(f),3===x)if(m.ptr+=z,m.counter.constantoffset++,da)for(f=0;f<u;f++){for(h=0;h<t;h++)da[D]&&(J[D]=ia?Math.min(W,I[D]+X):X),D++;D+=H}else for(f=0;f<u;f++){for(h=0;h<t;h++)J[D]=ia?Math.min(W,I[D]+X):X,D++;D+=H}else if(m.ptr+=z,q.decodeBits(w,
m,N,X,Q),z=0,ia)if(da)for(f=0;f<u;f++){for(h=0;h<t;h++)da[D]&&(J[D]=N[z++]+I[D]),D++;D+=H}else for(f=0;f<u;f++){for(h=0;h<t;h++)J[D]=N[z++]+I[D],D++;D+=H}else if(da)for(f=0;f<u;f++){for(h=0;h<t;h++)da[D]&&(J[D]=N[z++]),D++;D+=H}else for(f=0;f<u;f++){for(h=0;h<t;h++)J[D++]=N[z++];D+=H}}1<M&&!r&&(m.pixels.resultPixels=q.swapDimensionOrder(m.pixels.resultPixels,d,M,v))},formatFileInfo:function(w){return{fileIdentifierString:w.headerInfo.fileIdentifierString,fileVersion:w.headerInfo.fileVersion,imageType:w.headerInfo.imageType,
height:w.headerInfo.height,width:w.headerInfo.width,numValidPixel:w.headerInfo.numValidPixel,microBlockSize:w.headerInfo.microBlockSize,blobSize:w.headerInfo.blobSize,maxZError:w.headerInfo.maxZError,pixelType:q.getPixelType(w.headerInfo.imageType),eofOffset:w.eofOffset,mask:w.mask?{numBytes:w.mask.numBytes}:null,pixels:{numBlocksX:w.pixels.numBlocksX,numBlocksY:w.pixels.numBlocksY,maxValue:w.headerInfo.zMax,minValue:w.headerInfo.zMin,noDataValue:w.noDataValue}}},constructConstantSurface:function(w,
m){var v=w.headerInfo.zMax,r=w.headerInfo.zMin,l=w.headerInfo.maxValues,k=w.headerInfo.numDims,n=w.headerInfo.height*w.headerInfo.width,d=0,c=0,g=0,b=w.pixels.resultMask;w=w.pixels.resultPixels;if(b)if(1<k)if(m)for(d=0;d<k;d++)for(g=d*n,v=l[d],c=0;c<n;c++)b[c]&&(w[g+c]=v);else for(c=0;c<n;c++){if(b[c])for(g=c*k,d=0;d<k;d++)w[g+k]=l[d]}else for(c=0;c<n;c++)b[c]&&(w[c]=v);else if(1<k&&r!==v)if(m)for(d=0;d<k;d++)for(g=d*n,v=l[d],c=0;c<n;c++)w[g+c]=v;else for(c=0;c<n;c++)for(g=c*k,d=0;d<k;d++)w[g+d]=
l[d];else for(c=0;c<n*k;c++)w[c]=v},getDataTypeArray:function(w){switch(w){case 0:w=Int8Array;break;case 1:w=Uint8Array;break;case 2:w=Int16Array;break;case 3:w=Uint16Array;break;case 4:w=Int32Array;break;case 5:w=Uint32Array;break;case 6:w=Float32Array;break;case 7:w=Float64Array;break;default:w=Float32Array}return w},getPixelType:function(w){switch(w){case 0:w="S8";break;case 1:w="U8";break;case 2:w="S16";break;case 3:w="U16";break;case 4:w="S32";break;case 5:w="U32";break;case 6:w="F32";break;
case 7:w="F64";break;default:w="F32"}return w},isValidPixelValue:function(w,m){if(null==m)return!1;switch(w){case 0:w=-128<=m&&127>=m;break;case 1:w=0<=m&&255>=m;break;case 2:w=-32768<=m&&32767>=m;break;case 3:w=0<=m&&65536>=m;break;case 4:w=-2147483648<=m&&2147483647>=m;break;case 5:w=0<=m&&4294967296>=m;break;case 6:w=-3.4027999387901484E38<=m&&3.4027999387901484E38>=m;break;case 7:w=4.9E-324<=m&&1.7976931348623157E308>=m;break;default:w=!1}return w},getDataTypeSize:function(w){var m=0;switch(w){case 0:case 1:m=
1;break;case 2:case 3:m=2;break;case 4:case 5:case 6:m=4;break;case 7:m=8;break;default:m=w}return m},getDataTypeUsed:function(w,m){var v=w;switch(w){case 2:case 4:v=w-m;break;case 3:case 5:v=w-2*m;break;case 6:v=0===m?w:1===m?2:1;break;case 7:v=0===m?w:w-2*m+1;break;default:v=w}return v},getOnePixel:function(w,m,v,r){w=0;switch(v){case 0:w=r.getInt8(m);break;case 1:w=r.getUint8(m);break;case 2:w=r.getInt16(m,!0);break;case 3:w=r.getUint16(m,!0);break;case 4:w=r.getInt32(m,!0);break;case 5:w=r.getUInt32(m,
!0);break;case 6:w=r.getFloat32(m,!0);break;case 7:w=r.getFloat64(m,!0);break;default:throw"the decoder does not understand this pixel type";}return w},swapDimensionOrder:function(w,m,v,r,l){var k=0,n=0,d=0,c=0,g=w;if(1<v)if(g=new r(m*v),l)for(k=0;k<m;k++)for(c=k,d=0;d<v;d++,c+=m)g[c]=w[n++];else for(k=0;k<m;k++)for(c=k,d=0;d<v;d++,c+=m)g[n++]=w[c];return g}},A=function(w,m,v){this.val=w;this.left=m;this.right=v};return{decode:function(w,m){m=m||{};var v=m.noDataValue,r=0,l={};l.ptr=m.inputOffset||
0;l.pixels={};if(q.readHeaderInfo(w,l)){r=l.headerInfo;var k=r.fileVersion,n=q.getDataTypeArray(r.imageType);if(5<k)throw"unsupported lerc version 2."+k;q.readMask(w,l);r.numValidPixel===r.width*r.height||l.pixels.resultMask||(l.pixels.resultMask=m.maskData);var d=r.width*r.height;l.pixels.resultPixels=new n(d*r.numDims);l.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var c=!m.returnPixelInterleavedDims;if(0!==r.numValidPixel)if(r.zMax===r.zMin)q.constructConstantSurface(l,
c);else if(4<=k&&q.checkMinMaxRanges(w,l))q.constructConstantSurface(l,c);else{var g=new DataView(w,l.ptr,2),b=g.getUint8(0);l.ptr++;if(b)q.readDataOneSweep(w,l,n,c);else if(1<k&&1>=r.imageType&&1E-5>Math.abs(r.maxZError-.5)){g=g.getUint8(1);l.ptr++;l.encodeMode=g;if(2<g||4>k&&1<g)throw"Invalid Huffman flag "+g;g?q.readHuffman(w,l,n,c):q.readTiles(w,l,n,c)}else q.readTiles(w,l,n,c)}l.eofOffset=l.ptr;m.inputOffset?(w=l.headerInfo.blobSize+m.inputOffset-l.ptr,1<=Math.abs(w)&&(l.eofOffset=m.inputOffset+
l.headerInfo.blobSize)):(w=l.headerInfo.blobSize-l.ptr,1<=Math.abs(w)&&(l.eofOffset=l.headerInfo.blobSize));w={width:r.width,height:r.height,pixelData:l.pixels.resultPixels,minValue:r.zMin,maxValue:r.zMax,validPixelCount:r.numValidPixel,dimCount:r.numDims,dimStats:{minValues:r.minValues,maxValues:r.maxValues},maskData:l.pixels.resultMask};if(l.pixels.resultMask&&q.isValidPixelValue(r.imageType,v)){k=l.pixels.resultMask;for(r=0;r<d;r++)k[r]||(w.pixelData[r]=v);w.noDataValue=v}l.noDataValue=v;m.returnFileInfo&&
(w.fileInfo=q.formatFileInfo(l));return w}},getBandCount:function(w){for(var m=0,v=0,r={ptr:0,pixels:{}};v<w.byteLength-58;)q.readHeaderInfo(w,r),v+=r.headerInfo.blobSize,m++,r.ptr=v;return m}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),function(E,q,A,w,m,v){E=E(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour",
"esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(r){q.mixin(this,r);this.isDataUV=r&&r.isDataUV?r.isDataUV:!1;this.computeMagnitudeAndDirection=q.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(r,l){this.inputUnit=r;this.outputUnit=l;this.unitConversionFactor=1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var r=v.indexOf(this.speedUnits,this.inputUnit),l=v.indexOf(this.speedUnits,this.outputUnit);
if(this.inputUnit&&this.outputUnit&&0<=r&&0<=l){var k=[1,.277778,.514444,.3048,.44704,0];this.unitConversionFactor=k[r]/k[l]}},computeMagnitudeAndDirection:function(r){if(!m.isDefined(r))throw"Could not compute magnitude and direction. No pixel data is available.";var l=r.pixelBlock;if(!m.isDefined(l)||2!==l.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";var k=r.extent,n=(k.xmax-k.xmin)/l.width,d=(k.ymax-k.ymin)/l.height,c=k.xmin+n/2;k=k.ymax-
d/2;l.statistics[0].minValue=0;l.statistics[0].maxValue=0;var g=180/Math.PI,b=[],e=0,a=0,f=0,h=!m.isDefined(l.mask),p,B,u,t;var z=u=Infinity;var x=t=-Infinity;for(e=0;e<l.height;e++)for(a=0;a<l.width;a++,f++)if(b.push([c+n*a,k-d*e]),h||l.mask[f]){var y=p=l.pixels[0][f];var D=B=l.pixels[1][f];this.isDataUV&&(y=Math.sqrt(p*p+B*B),D=90-g*Math.atan2(B,p));l.pixels[0][f]=y*this.unitConversionFactor;l.pixels[1][f]=D;y>x&&(x=y);y<z&&(z=y);D>t&&(t=D);D<u&&(u=D)}l.statistics[0].maxValue=x;l.statistics[0].minValue=
z;l.statistics[1].maxValue=t;l.statistics[1].minValue=u;r.locations=b;return r}});A("extend-esri")&&q.setObject("layers.pixelFilters.VectorFieldPixelFilter",E,w);return E})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(E,q,A,w){var m;return q(null,{constructor:function(v){this.ctx=v.ctx;this._loadRasterFormatModule()},decode:function(v,r){if(!r.width||!r.height)throw"Native decoding requires the image format, width and height";
var l=new A,k,n=new Uint8Array(v);v=this._getFormat(v);if("error"===v)throw"invalid format";"jpeg"===v&&(k=this._getMask(n,r));var d="",c;for(c=0;c<n.length;c+=65535){var g=n.subarray(c,c+65535>n.length-1?n.length-1:c+65535);d+=String.fromCharCode.apply(null,g)}n="data:image/"+v+";base64,"+window.btoa(d);var b=new Image,e;b.src=n;var a=this;b.onload=function(){a.ctx.clearRect(0,0,r.width,r.height);a.ctx.drawImage(b,0,0);var f=a.ctx.getImageData(0,0,b.width,b.height);e=f.data;if(k)for(c=0;c<k.length;c++)e[4*
c+3]=k[c]?255:0;a.ctx.putImageData(f,0,0);l.resolve(null)};b.onerror=function(){l.reject("cannot load image")};return l},_getFormat:function(v){v=new Uint8Array(v,0,10);var r="error";255===v[0]&&216===v[1]?r="jpeg":137===v[0]&&80===v[1]&&78===v[2]&&71===v[3]&&(r="png");return r},_getMask:function(v,r){try{if(!m)throw"The zlib decoder module is not loaded.";var l=0,k=0,n=Math.round(v.length/2);1===n%2&&(n+=1);var d=v.length-2;for(l=n;l<d&&(255!==v[l]||217!==v[l+1]);l++);n=l+=2;if(n<v.length-1){var c=
(new m(v.subarray(n))).getBytes();var g=new Uint8Array(r.width*r.height);for(l=v=0;l<c.length;l++)for(k=7;0<=k;k--)g[v++]=c[l]>>k&1}}catch(b){}return g},_loadRasterFormatModule:function(){10>w("ie")||E(["./Zlib"],function(v){m=v})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(E,q,A,w,m,v,r,l){E=E(r,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",
constructor:function(k){this._url.path+="/identify";this._handler=q.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(k,n,d,c,g){try{var b=new l(k);this._successHandler([b],"onComplete",d,g)}catch(e){this._errorHandler(e,c,g)}},execute:function(k,n,d,c){var g=c.assembly;k=this._encode(q.mixin({},this._url.query,{f:"json"},k.toJson(g&&g[0])));var b=this._handler,e=this._errorHandler;return m({url:this._url.path,content:k,callbackParamName:"callback",
load:function(a,f){b(a,f,n,d,c.dfd)},error:function(a){e(a,d,c.dfd)}})},onComplete:function(){}});v._createWrappers(E);A("extend-esri")&&q.setObject("tasks.ImageServiceIdentifyTask",E,w);return E})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(E,q,A,w,m,v){E=E(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(r){r.catalogItems&&(this.catalogItems=
new v(r.catalogItems));r.location&&(this.location=m.fromJson(r.location));this.catalogItemVisibilities=r.catalogItemVisibilities;this.name=r.name;this.objectId=r.objectId;this.value=r.value;this.processedValues=r.processedValues;this.properties=r.properties}});A("extend-esri")&&q.setObject("tasks.ImageServiceIdentifyResult",E,w);return E})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(E,q,A,w,m,v,r,l){E=E(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,maxItemCount:null,returnPixelValues:!0,toJson:function(k){var n=k&&k.geometry||this.geometry;k={geometry:n,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?A.toJson(this.mosaicRule.toJson()):
null,renderingRule:this.renderingRule?A.toJson(this.renderingRule.toJson()):null};n&&(k.geometryType=l.getJsonType(n));n=this.timeExtent;k.time=n?n.toJson().join(","):null;r.isDefined(this.pixelSizeX)&&r.isDefined(this.pixelSizeY)?k.pixelSize=A.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(k.pixelSize=this.pixelSize?A.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(k.renderingRules=A.toJson(w.map(this.renderingRules,function(d){return d.toJson()})));
r.isDefined(this.returnPixelValues)&&(k.returnPixelValues=this.returnPixelValues);r.isDefined(this.maxItemCount)&&(k.maxItemCount=this.maxItemCount);return k}});m("extend-esri")&&q.setObject("tasks.ImageServiceIdentifyParameters",E,v);return E})},"esri/layers/pixelFilters/StretchFilter":function(){define(["dojo/_base/declare","dojo/_base/lang","../PixelBlock"],function(E,q,A){var w;return E(null,{stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,
maxPercent:.5,useGamma:!1,gamma:null,raster:null,outputPixelType:"U8",computeGamma:!1,constructor:function(m){this.stretchType=m.stretchType||m.StretchType||this.stretchType;this.min=m.min||m.Min||this.min;this.max=m.max||m.Max||this.max;this.numberOfStandardDeviations=m.numberOfStandardDeviations||m.NumberOfStandardDeviations||this.numberOfStandardDeviations;this.statistics=m.statistics||m.Statistics||this.statistics;this.dra=m.dra||m.DRA||m.dRA||this.dra;this.minPercent=m.minPercent||m.MinPercent||
this.minPercent;this.maxPercent=m.maxPercent||m.MaxPercent||this.maxPercent;this.useGamma=m.useGamma||m.UseGamma||this.useGamma;this.gamma=m.gamma||m.Gamma||this.gamma;this.computeGamma=m.computeGamma||m.ComputeGamma||this.computeGamma;this.raster=m.raster||m.Raster||this.raster;this.outputPixelType=m.outputPixelType||m.OutputPixelType||this.outputPixelType;this.raster=m.raster||m.Raster||this.raster;w=this},filter:function(m){if(void 0!==m&&null!==m&&null!==m.pixelBlock&&null!==m.pixelBlock.pixels){var v=
m.pixelBlock,r=v.pixels,l=v.width*v.height,k=r.length,n;(n=6===w.stretchType||3===w.stretchType&&w.dra)&&w._calculateStatisticsHistograms(m);if(w.dra)if(n)w._statistics=v.statistics,w._histograms=v.histograms;else{var d=v.statistics;w._statistics=[];for(n=0;n<k;n++)w._statistics[n]=[d[n].minValue,d[n].maxValue,0,0]}else w._statistics=w.statistics,w._histograms=w.histograms;w.computeGamma&&(w.gamma=w._computeGammaValues(v.pixelType),w.useGamma=!0);w._createLUT(m);if(void 0===w.LUT||null===w.LUT)return w._filterNoLUT(m);
d=w.LUT;var c=w.LUTOffset;for(n=0;n<k;n++){var g=d[n];for(v=0;v<l;v++){var b=r[n][v];r[n][v]=g[b-c]}}m.pixelBlock.pixelType="U8";return m}},_calculateStatisticsHistograms:function(m){m=m.pixelBlock;var v=m.pixelType,r=m.pixels,l=m.mask,k=r.length,n,d,c=function(t){this.min=-.5;this.max=255.5;this.size=256;q.mixin(this,t);this.counts=this.counts||new Uint32Array(this.size)},g=[],b,e;for(n=0;n<k;n++){var a=new c;var f=a.counts;var h=r[n];if("U8"===v)if(l)for(d=0;d<m.width*m.height;d++)l[d]&&f[h[d]]++;
else for(d=0;d<m.width*m.height;d++)f[h[d]]++;else{var p=m.statistics[n].minValue;var B=m.statistics[n].maxValue;a.min=p;a.max=B;B=(B-p)/256;var u=new Uint32Array(257);if(l)for(d=0;d<m.width*m.height;d++)l[d]&&u[Math.floor((h[d]-p)/B)]++;else for(d=0;d<m.width*m.height;d++)u[Math.floor((h[d]-p)/B)]++;for(d=0;255>d;d++)f[d]=u[d];f[255]=u[255]+u[256]}g.push(a);h=[];p=m.statistics[n].minValue;B=m.statistics[n].maxValue;for(d=e=b=u=0;d<a.size;d++)u+=f[d],b+=d*f[d];b/=u;for(d=0;d<a.size;d++)e+=f[d]*Math.pow(d-
b,2);f=Math.sqrt(e/(u-1));d=(b+.5)*(a.max-a.min)/a.size+a.min;a=f*(a.max-a.min)/a.size;h.push(p);h.push(B);h.push(d);h.push(a);m.statistics[n]=h}m.histograms=g},_getCutOffPoints:function(m){m=m.pixelBlock.pixels.length;var v=[],r=[],l,k,n;switch(w.stretchType){case 5:for(k=0;k<m;k++)v[k]=w._statistics[k][0],r[k]=w._statistics[k][1];break;case 3:for(k=0;k<m;k++)v[k]=w._statistics[k][2]-w.numberOfStandardDeviations*w._statistics[k][3],r[k]=w._statistics[k][2]+w.numberOfStandardDeviations*w._statistics[k][3],
v[k]<w._statistics[k][0]&&(v[k]=w._statistics[k][0]),r[k]>w._statistics[k][1]&&(r[k]=w._statistics[k][1]);break;case 6:for(k=0;k<m;k++){var d=w._histograms[k];var c=new Uint32Array(d.size);var g=d.counts;for(n=l=0;n<d.size;n++)l+=g[n],c[n]=l;g=w.minPercent*l/100;for(n=1;n<d.size;n++)if(c[n]>g){v[k]=d.min+(d.max-d.min)/d.size*(n-.5);break}g=(1-w.maxPercent/100)*l;for(n=d.size-2;0<=n;n--)if(c[n]<g){r[k]=d.min+(d.max-d.min)/d.size*(n+.5);break}}break;default:for(k=0;k<m;k++)v[k]=0,r[k]=255}return{minCutOff:v,
maxCutOff:r}},_createLUT:function(m){var v=m.pixelBlock,r=v.pixelType;if("U8"===r||"U16"===r||"S8"===r||"S16"===r){if(w._LUTSignature&&(r=w._computeLutSignature(),r.length===w._LUTSignature.length&&!r.some(function(z,x){return z!==w._LUTSignature[x]})))return;r=v.pixels.length;var l=[],k=[],n=[],d,c=w.max,g=w.min,b=w.gamma,e=c-g,a=w._getCutOffPoints(m);m=a.minCutOff;a=a.maxCutOff;var f=0,h=256;"S8"===v.pixelType?f=-127:"S16"===v.pixelType&&(f=-32767);if("U16"===v.pixelType||"S16"===v.pixelType)h=
65536;for(v=0;v<r;v++)l[v]=a[v]-m[v];if(w.useGamma&&null!==b&&b.length===r)for(v=0;v<r;v++)n[v]=1<b[v]?2<b[v]?6.5+Math.pow(b[v]-2,2.5):6.5+100*Math.pow(2-b[v],4):1;if(w.useGamma)for(v=0;v<r;v++){var p=[];for(d=0;d<h;d++){var B=d+f;var u=(B-m[v])/l[v];var t=1;1<b[v]&&(t-=Math.pow(1/e,u*n[v]));B<a[v]&&B>m[v]?p[d]=Math.floor(t*e*Math.pow(u,1/b[v]))+g:B>a[v]?p[d]=c:B<m[v]&&(p[d]=g)}k[v]=p}else for(v=0;v<r;v++){p=[];for(d=0;d<h;d++)B=d+f,p[d]=B<m[v]?g:B>a[v]?c:Math.floor((B-m[v])/l[v]*e)+g;k[v]=p}w.LUT=
k;w.LUTOffset=f;w._LUTSignature=w._computeLutSignature()}},_computeLutSignature:function(){var m=[],v,r;m.push(w.stretchType);m.push(w.min);m.push(w.max);m.push(w.numberOfStandardDeviations);if(w._statistics)for(v=0;v<w._statistics.length;v++)for(r=0;r<w._statistics[v].length;r++)m.push(w._statistics[v][r]);m.push(w.dra?1:0);m.push(w.minPercent);m.push(w.maxPercent);if(w.gamma)for(v=0;v<w._statistics.length;v++)m.push(w.gamma[v]);m.push(w.useGamma?1:0);return m},_filterNoLUT:function(m){if(null!==
m&&null!==m.pixelBlock&&null!==m.pixelBlock.pixels){var v=m.pixelBlock,r=v.pixels,l=v.mask;v=v.width*v.height;var k=r.length,n=[],d=[],c,g=w.max,b=w.min,e=w.gamma,a=g-b;var f=w._getCutOffPoints(m);var h=f.minCutOff,p=f.maxCutOff;for(f=0;f<k;f++)n[f]=p[f]-h[f];if(w.useGamma&&null!==e&&e.length===k)for(f=0;f<k;f++)d[f]=1<e[f]?2<e[f]?6.5+Math.pow(e[f]-2,2.5):6.5+100*Math.pow(2-e[f],4):1;if(w.useGamma)if(void 0!==l&&null!==l)for(c=0;c<v;c++){if(l[c])for(f=0;f<k;f++){var B=r[f][c];var u=(B-h[f])/n[f];
var t=1;1<e[f]&&(t-=Math.pow(1/a,u*d[f]));B<p[f]&&B>h[f]?r[f][c]=Math.floor(t*a*Math.pow(u,1/e[f]))+b:B>p[f]?r[f][c]=g:B<h[f]&&(r[f][c]=b)}}else for(c=0;c<v;c++)for(f=0;f<k;f++)B=r[f][c],u=(B-h[f])/n[f],t=1,1<e[f]&&(t-=Math.pow(1/a,u*d[f])),B<p[f]&&B>h[f]?r[f][c]=Math.floor(t*a*Math.pow(u,1/e[f]))+b:B>p[f]?r[f][c]=g:B<h[f]&&(r[f][c]=b);else if(void 0!==l&&null!==l)for(c=0;c<v;c++){if(l[c])for(f=0;f<k;f++)B=r[f][c],B<p[f]&&B>h[f]?r[f][c]=Math.floor((B-h[f])/n[f]*a)+b:B>p[f]?r[f][c]=g:B<h[f]&&(r[f][c]=
b)}else for(c=0;c<v;c++)for(f=0;f<k;f++)B=r[f][c],B<p[f]&&B>h[f]?r[f][c]=Math.floor((B-h[f])/n[f]*a)+b:B>p[f]?r[f][c]=g:B<h[f]&&(r[f][c]=b);m.pixelBlock.pixelType="U8";return m}},_computeGammaValues:function(m){var v=this._statistics.length,r,l=[];for(r=0;r<v;r++){var k=this._statistics[r][2];"U8"!==m&&(k=255*(k-this._statistics[r][0])/(this._statistics[r][1]-this._statistics[r][0]));l.push(this._computeGammaValue(k))}return l},_computeGammaValue:function(m){if(0!==m&&!(255<m||0>m)){var v=0;0<m&&
150!=m&&255>m&&(v=150>=m?45*Math.cos(.01047*m):17*Math.sin(.021*m));v=Math.log((m+v)/255);if(0!==v&&(m=Math.log(m/255)/v,!isNaN(m)))return Math.min(9.9,Math.max(.01,m))}}})})},"esri/layers/StreamLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/_base/lang dojo/Deferred dojo/has dojo/io-query dojo/on dojo/aspect ../kernel ../request ../graphic ./FeatureLayer ./StreamMode ./StreamTrackManager ../geometry/jsonUtils ../symbols/SimpleFillSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../renderers/SimpleRenderer ./PurgeOptions".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u,t){E=E([b],{declaredClass:"esri.layers.StreamLayer",_preventInit:!0,constructor:function(z,x){x=x||{};x.mode&&x.mode!==b.MODE_STREAM||(this._isStream=!0,this.currentMode=this.mode=b.MODE_STREAM,this._mode=new e(this));this.purgeOptions=new t(this,x.purgeOptions||{});this.purgeInterval=x.purgeInterval||0;this._reconnectAttempts=0;this.maxReconnectAttempts=10;this.socket=this._reconnectTimeoutId=null;this._keepLatestQueried=!1;this._keepLatestUrl=null;
this._relatedQueried=!1;this._joinField=this._relatedUrl=null;this._refreshing=!1;this._attemptReconnect=m.hitch(this,this._attemptReconnect);this._purge=m.hitch(this,this._purge);this._processServiceJson=m.hitch(this,this._processServiceJson);if(m.isObject(z)&&z.layerDefinition)this._initFeatureLayer(z,x);else{var y=this;c({url:z,content:m.mixin({f:"json"}),callbackParamName:"callback"}).then(function(D){y._processServiceJson(D,x)},function(D){y._errorHandler(D)})}},_processServiceJson:function(z,
x){var y=this;z.relatedFeatures&&z.relatedFeatures.featuresUrl&&z.relatedFeatures.joinField?(this._relatedUrl=z.relatedFeatures.featuresUrl,this.objectIdField=this._joinField=z.relatedFeatures.joinField,c({url:this._relatedUrl,content:{f:"json"},callbackParamName:"callback"}).then(function(D){D=D.fields||[];var H=A.map(z.fields,function(I){return I.name.toLowerCase()});A.forEach(D,function(I){-1===A.indexOf(H,I.name.toLowerCase())&&z.fields.push(I)});x.resourceInfo=z;y._initFeatureLayer(y._url,x)},
function(D){y.onError({error:D})})):(x.resourceInfo=z,this._initFeatureLayer(this._url,x))},_initLayer:function(z,x){this.inherited(arguments);if(z){var y;if(z.layerDefinition)this.purgeOptions=new t(this,this._params.purgeOptions||{}),this.socketUrl=this._params.socketUrl||z.layerDefinition.socketUrl||void 0;else{if(this._params.socketUrl)this.socketUrl=this._params.socketUrl;else{var D=this._getWebsocketConnectionInfo(z),H=D.urls;H&&H.length?(this._socketUrls=H,this.socketUrl=H[0],this.socketDirection=
"broadcast"===this._params.socketDirection?"broadcast":"subscribe",this.socketUrl+="/"+this.socketDirection,this._websocketToken=D.token,H.length>this.maxReconnectAttempts&&(this.maxReconnectAttempts=H.length)):(this.socketUrl=void 0,D="No web socket urls were retrieved from the Stream Service. Layer will not attempt to connect.","https:"===location.protocol&&(D+=" An insecure web socket connection cannot be made from a secure web page."),this.onError(Error(D)))}if(this._params.filter)try{this._filter=
y=this._makeFilter(this._params.filter)}catch(I){this.onError(Error("Error trying to create filter object: "+I+". Layer will not have filter applied")),this._filter=null}if(this._params.geometryDefinition||this._outFields||this._defnExpr){y=y||{};y.geometry=this._params.geometryDefinition;y.outFields=this._outFields;y.where=this._defnExpr;try{this._filter=y=this._makeFilter(y)}catch(I){this.onError(Error("Error trying to create filter object: "+I+". Layer will not have filter applied")),this._filter=
null}}}this.maximumTrackPoints=this._params.maximumTrackPoints||0===this._params.maximumTrackPoints?this._params.maximumTrackPoints:1;(this._params.refreshRate||0===this._params.refreshRate)&&this._mode&&this._mode._setRefreshRate&&this._mode._setRefreshRate(this._params.refreshRate);this._keepLatestUrl=z.keepLatestArchive?z.keepLatestArchive.featuresUrl:null;z.relatedFeatures&&z.relatedFeatures.featuresUrl&&z.relatedFeatures.joinField&&(this._relatedUrl=z.relatedFeatures.featuresUrl,this.objectIdField=
this._joinField=z.relatedFeatures.joinField);this.objectIdField||this._makeObjectIdField();this._map&&this.socketUrl&&!this._connected&&this.connect()}},_isWebGLCompatible:function(){return!1},_setMap:function(z){var x=this.inherited(arguments),y=this._getRenderer();this.timeInfo&&(this._trackIdField||y&&(y.latestObservationRenderer||y.trackRenderer))&&(this._trackManager=new a(this),this._trackManager.initialize(z));this.socketUrl&&!this._connected&&this._map&&this.connect();return x},_unsetMap:function(z,
x){A.forEach(this._connects,q.disconnect);(this._connected||this._reconnecting||this.socket)&&this.disconnect();this._togglePurgeT();this.inherited(arguments);this._map=null},_suspend:function(){this._togglePurgeT();this.inherited(arguments)},_resume:function(){this.inherited(arguments);this._togglePurgeT(!0)},clear:function(){try{this._mode&&this._mode._clearDrawBuffer&&this._mode._clearDrawBuffer(),this._mode&&this._mode._clearTimeBin&&this._mode._clearTimeBin(),this._mode&&this._mode._clearFeatureMap&&
this._mode._clearFeatureMap(),this._trackManager&&this._trackManager.clearTracks()}catch(z){}this.inherited(arguments);this._trackManager&&this._trackManager.createTracklineContainer()},redraw:function(){this._mode&&this._mode._flushDrawBuffer&&this._mode._flushDrawBuffer();this.inherited(arguments)},setDefinitionExpression:function(z){this.setFilter({where:z})},getDefinitionExpression:function(){if(this._filter)var z=this._filter.where;return z},destroy:function(){this.disconnect();this.inherited(arguments)},
onResume:function(z){this.inherited(arguments)},setGeometryDefinition:function(z){this.setFilter({geometry:z})},getGeometryDefinition:function(){if(this._filter)var z=this._filter.geometry;return z},connect:function(z){var x=new v,y={},D=this._filter,H,I,N=this.socketUrl,S;try{this._connected||this._connecting?x.reject(Error("Cannot start new connection process. Layer is connecting.")):(this._connecting=!0,this._getRelatedFeatures().then(function(){return this._getKeepLatestFeatures()}.bind(this)).then(function(){this._websocketToken&&
(y.token=this._websocketToken);this._map&&this._map.spatialReference&&this.spatialReference&&this._map.spatialReference.wkid!==this.spatialReference.wkid&&(y.outSR=this._map.spatialReference.wkid);if(D)for(I in D)null!==D[I]&&(H="geometry"===I?JSON.stringify(D[I]):D[I],y[I]=H);N+="?"+l.objectToQuery(y);S=this._createConnection(N,z);x.resolve(S)}.bind(this)).otherwise(function(M){x.reject(M)}))}catch(M){z&&(z(M,!1),x.reject(M)),this.onConnectionError({error:M})}return x.promise},disconnect:function(z){var x=
this._refreshing?"Disconnecting as part of layer refresh cycle":"Connection closed from client",y=this._refreshing?!0:!1;this._reconnectTimeoutId&&clearTimeout(this._reconnectTimeoutId);this._refreshing=this._reconnecting=this._connecting=this._connected=!1;this.socket&&this.socket.close();this.onDisconnect({willReconnect:y,message:x});z&&z(null,!0)},setFilter:function(z){if(this._collection)return this.onError("Filter can only be set when the source of the layer is a Stream Service"),!1;try{if(void 0!==
z.outFields){var x=Error("Outfields property cannot be changed after layer is created");this.onFilterChange({filter:this.getFilter(),error:x});return!1}var y=this._makeFilter(z)}catch(D){return x=Error(D),this.onFilterChange({filter:this.getFilter(),error:x}),!1}if(this.socket)z={filter:y},this.socket.send(JSON.stringify(z));else k.once(this,"connect",function(D){this.setFilter(y)});return!0},getFilter:function(){var z=this._filter,x={},y=["geometry","outFields","where"];z&&A.forEach(y,function(D){var H=
z[D];H&&("geometry"===D?H=f.fromJson(H):"outFields"===D&&(H=H.split(",")),x[D]=H)});return x},setMaximumTrackPoints:function(z){if(!z&&0!==z)return!1;this.maximumTrackPoints=z;this._mode.propertyChangeHandler(3)},getUniqueValues:function(z){var x={},y=[];var D=this._getField(z,!0);if(!D)return y;z=D.name;A.forEach(this.graphics||[],function(H){H=(H.attributes||{})[z];void 0===H||x[H]||(x[H]=1,y.push(H))});y.sort(function(H,I){return H<I?-1:H>I?1:0});return y},getLatestObservations:function(){var z=
[];return z=this._trackManager?this._trackManager.getLatestObservations():this.graphics},setPurgeInterval:function(z){var x=this.purgeInterval;this.purgeInterval=z;this._togglePurgeT();z&&this._togglePurgeT(!0);if(x!==z)this.onPurgeIntervalChange();return this},_togglePurgeT:function(z){if(z&&this.purgeInterval){var x=this;clearTimeout(this._purgeT);this._mode&&this._mode._flushDrawBuffer&&(this._purgeT=setTimeout(function(){x.updating||x.suspended||(x._mode._flushDrawBuffer(),x._togglePurgeT(!0))},
6E4*this.purgeInterval))}else this._purgeT&&(clearTimeout(this._purgeT),this._purgeT=null)},onMessage:function(){},onConnect:function(){},onDisconnect:function(){},onFilterChange:function(){},onAttemptReconnect:function(){},onConnectionError:function(){},onPurgeIntervalChange:function(){},_createConnection:function(z,x){var y=this,D=new WebSocket(z);D.onopen=function(){y.socket=D;y._connected=!0;y._connecting=!1;y._reconnecting=!1;y._reconnectAttempts=0;y._bind();y.onConnect();x&&x(null,!0)};D.onclose=
function(H){var I=!0,N=y._connected,S=null;if(y._connected||y._reconnecting){if(H.code){var M="Connection failed: ";if(1001===H.code)M+=H.reason||"Service is going away.",I=!1;else if(4400===H.code)M+=H.reason||"Invalid url parameters. Check filter properties.",I=!1;else if(4404===H.code)M+="Service not found",I=!1;else if(4401===H.code||4403===H.code)M+="Not authorized",I=!1}I&&(y._reconnectAttempts+=1,y._reconnectAttempts>y.maxReconnectAttempts&&(M="Maximum reconnect attempts exceeded",I=!1,N=!0));
y._connected=!1;N&&(M&&(S=Error(M)),y.onDisconnect({error:S,willReconnect:I}));I?y._attemptReconnect():y.socket=null}else y.socket||(S=Error("Could not make connection to service"),y.onConnectionError({error:S})),y.socket=null,y._connected=!1};D.onerror=function(H){console.log("Socket error")};return D},_getKeepLatestFeatures:function(){var z=new v;this._map&&this._keepLatestUrl&&!this._keepLatestQueried&&this._mode._fetchArchive?this._mode._fetchArchive(this._keepLatestUrl).then(function(){z.resolve()}.bind(this)).otherwise(function(x){z.reject(x)}).always(function(){this._keepLatestQueried=
!0}.bind(this)):z.resolve();return z.promise},_getRelatedFeatures:function(){var z=new v;this._map&&this._relatedUrl&&!this._relatedQueried&&this._mode._fetchArchive?this._mode._fetchArchive(this._relatedUrl).then(function(){z.resolve()}.bind(this)).otherwise(function(x){z.reject(x)}).always(function(){this._relatedQueried=!0}.bind(this)):z.resolve();return z.promise},_purge:function(){var z,x=[];if(this.purgeOptions.displayCount&&this.graphics.length>this.purgeOptions.displayCount)for(z=0;z<this.graphics.length-
this.purgeOptions.displayCount;z++){var y=this.graphics[z];x.push(y)}0<x.length&&(this._mode._removeFeatures(x),this._trackManager&&this._trackManager.removeFeatures(x))},_bind:function(){var z=this;this.socket.onmessage=function(x){z._onMessage(JSON.parse(x.data))}},_onMessage:function(z){var x=this;this.onMessage(z);var y={create:function(D){x._create(D)},update:function(D){x._update(D)},"delete":function(D){x._delete(D)}};if(z.type)y[z.type](z.feature);else z.hasOwnProperty("filter")?x._handleFilterMessage(z):
this._create(z)},_create:function(z){function x(H){if(!y._featureHasOID(H,D)){if(!H.geometry)return!1;H.attributes=H.attributes||{};H.attributes[D]=y._nextId++}H=H.declaredClass?H:new g(H);y._mode.drawFeature(H)}var y=this,D=y.objectIdField;z.length?z.forEach(function(H){H&&x(H)}):z&&x(z)},_delete:function(z){var x=this,y=z[x.objectIdField]||z.attributes[x.objectIdField],D=!1;this.graphics.forEach(function(H){H.attributes[x.objectIdField]==y&&(D=H)});D&&this.remove(D)},_update:function(z){var x=this,
y=!1;this.graphics.forEach(function(D){D.attributes[x.objectIdField]==z.attributes[x.objectIdField]&&(y=D)});y&&(z.attributes&&y.setAttributes(z.attributes),z.geometry&&y.setGeometry(f.fromJson(z.geometry)))},_makeFilter:function(z){var x=null;z=z||{};if(void 0!==z.geometry)if(x=x||{},null===z.geometry)x.geometry=null;else{var y="string"===typeof z.geometry?f.fromJson(JSON.parse(z.geometry)):z.geometry.declaredClass?z.geometry:f.fromJson(z.geometry);if(!y||"point"===y.type)throw"Query object contains invalid geometry";
"extent"!==y.type&&(y=y.getExtent());if(!y||0===y.getHeight()&&0===y.getWidth())throw"Invalid filter geometry: Extent cannot have a height and width of 0";x.spatialRel="esriSpatialRelIntersects";x.geometryType="esriGeometryEnvelope";x.geometry=y.toJson()}void 0!==z.where&&(x=x||{},x.where=z.where);if(void 0!==z.outFields&&(x=x||{},z="string"===typeof z.outFields?"*"===z.outFields?null:z.outFields.replace(/,\s+/g,",").split(","):null===z.outFields?null:z.outFields,z=this._makeOutFields(z))){if(z.errors&&
0<z.errors.length)throw"Invalid filter outFields. "+z.errors.join(",");x.outFields=z.fields?z.fields.join(","):null}return x},_makeOutFields:function(z){var x=this,y=[],D=[],H={fields:null};if(!z||0===z.length)return H;A.forEach(z,function(I){if("*"===I)return H;var N=x._getField(I,!0);N?y.push(N.name):D.push("Field named "+I+" not found in schema.")});z=x._getOutFields();A.forEach(z,function(I){x._getField(I)&&-1===A.indexOf(y,I)&&y.push(I)});H.fields=y;H.errors=D;return H},_handleFilterMessage:function(z){z.error?
(z=Error(z.error.join(",")),this.onFilterChange({filter:this.getFilter(),error:z})):(z=z.filter,z.geometry&&"string"===typeof z.geometry&&(z.geometry=JSON.parse(z.geometry)),this._filter=z,this.onFilterChange({filter:this.getFilter()}))},_getWebsocketConnectionInfo:function(z){var x={urls:[]},y,D=[],H=[],I;z.streamUrls&&A.forEach(z.streamUrls,function(M){"ws"===M.transport&&(y=M.urls,x.token=M.token)});if(!y)return x;A.forEach(y,function(M){0===M.lastIndexOf("wss",0)?H.push(M):D.push(M)});z="https:"===
location.protocol||0===this.url.lastIndexOf("https:",0)?H:0===D.length?H:D;if(1<z.length)for(I=0;I<z.length-1;I++){var N=I+Math.floor(Math.random()*(z.length-I));var S=z[N];z[N]=z[I];z[I]=S}x.urls=z;return x},_attemptReconnect:function(){var z=this;this._reconnectTimeoutId=null;z._connected=!1;if(!z._socketUrls)return!1;if(!z._collection&&!z._reconnecting&&z.socket&&z.credential)return z._reconnecting=!0,z._getServiceConnectionMetadata(z._attemptReconnect),!1;z._reconnecting=!0;z.socket=null;if(z._reconnectAttempts>
z.maxReconnectAttempts)return z._reconnecting=!1;z.socketUrl=z._socketUrls[z._reconnectAttempts>z._socketUrls.length-1?z._reconnectAttempts%z._socketUrls.length:z._reconnectAttempts];z.socketUrl+="/"+z.socketDirection;var x=z._randomIntFromInterval(0,1E3);this._reconnectTimeoutId=setTimeout(function(){z.onAttemptReconnect({count:z._reconnectAttempts,url:z.socketUrl});z.connect()},1E3*z._reconnectAttempts+x)},_getServiceConnectionMetadata:function(z){var x=this,y=x._url.path;z="function"===typeof z?
z:null;c({url:y,content:m.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(function(D){D=x._getWebsocketConnectionInfo(D);x._websocketToken=D.token;z&&z()},function(D){x.onError(Error(D))})},_setDefaultRenderer:function(){var z=this.geometryType,x=new w([5,112,176,.8]),y=new w([255,255,255]);y=new p(p.STYLE_SOLID,y,1);if("esriGeometryPoint"===z||"esriGeometryMultipoint"===z)var D=new B(B.STYLE_CIRCLE,10,y,x);else if("esriGeometryPolyline"===z)D=new p(p.STYLE_SOLID,x,2);else if("esriGeometryPolygon"===
z||"esriGeometryEnvelope"===z)x=new w([5,112,176,.2]),y=new w([5,112,176,.8]),y=new p(p.STYLE_SOLID,y,1),D=new h(h.STYLE_SOLID,y,x);D&&this.setRenderer(new u(D))},_makeObjectIdField:function(){var z=1,x,y=[];if(!this.objectIdField){var D=this.fields.length;for(x=0;x<D;x++)y.push(this.fields[x].name.toLowerCase());for(;-1!==A.indexOf(y,"objectid_"+z);)z+=1;this.objectIdField="objectid_"+z;this.fields.push({name:"objectid_"+z,type:"esriFieldTypeOID",alias:"objectid_"+z,nullable:!1})}},_featureHasOID:function(z,
x){return z.attributes&&(z.attributes[x]||0===z.attributes[x])},_randomIntFromInterval:function(z,x){return Math.floor(Math.random()*(x-z+1)+z)}});r("extend-esri")&&m.setObject("layers.StreamLayer",E,d);return E})},"esri/layers/StreamTrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Point ../geometry/Polyline ./TrackManager".split(" "),function(E,q,A,w,m,v,r,l,k){E=E([k],{declaredClass:"esri.layers._StreamTrackManager",constructor:function(n){this.inherited(arguments);
var d=n.getMap().spatialReference;this.isWebMercator=d.isWebMercator();this.canWrap=d._isWrappable();this.wrapThreshold=this.isWebMercator?2.0037508342788905E7:180},initialize:function(n){this.inherited(arguments)},addFeatures:function(n,d){function c(B,u){var t,z;a[B]||(a[B]=[]);B=a[B];if(0<p){u.length>p&&u.splice(0,u.length-p);var x=u.length+B.length;x>p&&(t=B.splice(0,x-p))}x=u.length;for(z=0;z<x;z+=1)B.push(u[z]);return{deletes:t,adds:u}}var g={},b={},e;if(d)return this.inherited(arguments),g;
var a=this.trackMap;var f=this.layer;var h=f._trackIdField;var p=f.maximumTrackPoints||0;A.forEach(n,function(B){var u=B.attributes[h];B.visible&&(b[u]||(b[u]=[]),b[u].push(B))});for(e in b)b.hasOwnProperty(e)&&(f=c(e,b[e]),g[e]=f);return g},removeFeatures:function(n){var d=[],c=this.layer.objectIdField,g=this.layer._trackIdField;n&&(A.forEach(n,function(b){var e;var a=b.attributes[g];var f=b.attributes[c];if(e=this.trackMap[a])for(b=0;b<e.length;b+=1){var h=e[b];if(h.attributes[c]===f){this.trackMap[a].splice(b,
1);-1===A.indexOf(a)&&d.push(a);break}}},this),0<n.length&&this.refreshTracks(d))},drawTracks:function(n){function d(h){var p=e[h],B=p&&1<p.length,u=c.trackLineMap[h];u&&!B&&(g.remove(u),delete c.trackLineMap[h],u=null);if(!B)return!1;B=[];for(var t=[],z,x=p.length,y=0;y<x;y++)if(z=p[y].geometry){z=z.normalize();var D=z.x,H=0,I=!1;N&&c.canWrap&&(H=D-N.x,Math.abs(H)>c.wrapThreshold&&(I=!0));I?(t.push([c.getWrappedX(D),z.y]),B.push(t.slice(0)),t=[[D,z.y]]):t.push([D,z.y]);var N=new r(D,z.y,a)}1<t.length&&
B.push(t);p={};p[f]=h;if(B.length)if(u){for(var S=u.geometry;S.paths.length;)S.removePath(S.paths.length-1);B.forEach(function(M){S.addPath(M)});u.setGeometry(S)}else u=new v(new l({paths:B,spatialReference:a}),null,p),g.add(u),c.trackLineMap[h]=u}var c=this,g=this.container,b;if(g){var e=this.trackMap;var a=this.map.spatialReference;var f=this.layer._trackIdField;if(n)A.forEach(n,function(h){d(h)});else for(b in e)e.hasOwnProperty(b)&&d(b)}},refreshTracks:function(n){function d(e){var a;e=c[e]||
[];var f=e.length;for(a=0;a<f;a++)g._repaint(e[a],null,!0)}var c=this.trackMap,g=this.layer,b;this.drawTracks(n);if(n)A.forEach(n,function(e){d(e)});else for(b in c)c.hasOwnProperty(b)&&d(b)},getLatestObservations:function(){var n,d=this.trackMap,c=[];for(n in d)if(d.hasOwnProperty(n)){var g=d[n];c.push(g[g.length-1])}return c},destroy:function(){this.inherited(arguments);this.trackLineMap=null},getWrappedX:function(n){var d=this.isWebMercator,c=d?2.0037508342788905E7:180;d=d?-2.0037508342788905E7:
-180;return(0<n?d:c)-((0<n?c:d)-n)}});w("extend-esri")&&q.setObject("layers._StreamTrackManager",E,m);return E})},"esri/layers/PurgeOptions":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/has","../kernel"],function(E,q,A,w,m){E=E([A],{declaredClass:"esri.layers.PurgeOptions",constructor:function(v,r){this.parent=v;for(var l in r)this[l]=r[l]},_displayCountSetter:function(v){this.displayCount=v;this.parent.refresh()}});w("extend-esri")&&q.setObject("layers.PurgeOptions",
E,m);return E})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),function(E,q,A,w,m,v,r){E=E([v,r],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(l,k){this._initialize(l,k);this.useMapImage=k&&k.useMapImage||!1},refresh:function(l){if(!0===l)this.inherited(arguments);else{var k=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);
this.disableClientCaching=k}},setRenderer:function(l,k){this.renderer=l;this.onRendererChange();k||this.refresh(!0)},exportMapImage:function(l,k){var n=m.defaults.map;l=q.mixin({size:n.width+","+n.height},this._params,l?l.toJson(this.normalization):{},{f:"json"});delete l._ts;this._exportMapImage(this._url.path+"/exportImage",l,k)}});A("extend-esri")&&q.setObject("layers.ArcGISImageServiceLayer",E,w);return E})},"esri/layers/ArcGISImageServiceVectorLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/sniff ../kernel ../lang ./GraphicsLayer ./ImageServiceLayerMixin ./pixelFilters/VectorFieldPixelFilter ../renderers/VectorFieldRenderer ../geometry/Point ../geometry/Extent ../graphic dojox/gfx".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e){E=E([l,k],{declaredClass:"esri.layers.ArcGISImageServiceVectorLayer",constructor:function(a,f){this.symbolTileSize=f&&f.symbolTileSize?f.symbolTileSize:50;this._maxMag=this._minMag=null;var h=q.clone(this._params);delete h.imageServiceParameters;delete h.pixelFilter;delete h.rendererStyle;delete h.symbolTileSize;this._initialize(a,f);this.renderer||this.setVectorRendererStyle(f&&f.rendererStyle?f.rendererStyle:d.STYLE_SINGLE_ARROW);this.geometryType="esriGeometryPoint";
this.symbolTileSizeUnits="Pixels";q.mixin(this._params,h)},getField:function(a){return this._getField(a,!0)},setVectorRendererStyle:function(a){this.rendererStyle=a;this._updateVectorFieldRenderer();this.useDefaultRenderer=!0},setRenderer:function(a){a&&(this.vectorFieldPixelFilter=this.vectorFieldPixelFilter||new n,this.vectorFieldPixelFilter.setUnits(a.inputUnit,a.outputUnit));this.useDefaultRenderer=!1;this.inherited(arguments)},getFlowRepresentation:function(){return this.renderer&&this.renderer.flowRepresentation||
this._vectorFlowRepresentation},onResume:function(){this.inherited(arguments);this._toggleTime()},onSuspend:function(){this.inherited(arguments);this._toggleTime()},_fixSymbolTileSize:function(){this.renderer&&(this.renderer.symbolTileSize?this.symbolTileSize=this.renderer.symbolTileSize:this.renderer.symbolTileSize=this.symbolTileSize)},_refresh:function(a){if(10>m("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else if(this._map){this._fixSymbolTileSize();
this.setImageFormat("LERC",!0);a=this.fullExtent&&this.fullExtent.xmin;var f=this.fullExtent&&this.fullExtent.ymax,h=q.clone(this._map.extent),p=1/this.symbolTileSize*this._map.width;p=p?Math.ceil(p):50;var B=1/this.symbolTileSize*this._map.height;B=B?Math.ceil(B):Math.ceil((h.ymax-h.ymin)/(h.xmax-h.xmin)*p);var u=(h.xmax-h.xmin)/p,t=(h.ymax-h.ymin)/B;h.xmin=a+Math.floor((h.xmin-a)/u)*u;h.xmax=a+Math.ceil((h.xmax-a)/u)*u;h.ymin=f+Math.floor((h.ymin-f)/t)*t;h.ymax=f+Math.ceil((h.ymax-f)/t)*t;this._requestData(h,
p,B)}},_drawPixelData:function(){this.clear();if(this.pixelData){var a=this.pixelData.pixelBlock,f=this.pixelData.extent,h=this.pixelData.locations,p=r.isDefined(a.mask)&&0<a.mask.length;if(a&&f&&h){if(this.useDefaultRenderer&&this.renderer&&(!r.isDefined(this._minMag)||!r.isDefined(this._maxMag))){var B=this._getServiceMinMaxStats();B?(this._minMag=B.min,this._maxMag=B.max):(this._minMag=a.statistics[0].minValue,this._maxMag=a.statistics[0].maxValue);B={type:"sizeInfo",minSize:e.px2pt(.2*this.symbolTileSize),
maxSize:e.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag};var u=[];u.push(B);u.push({type:"colorInfo"});this.renderer.setVisualVariables(u)}var t=u=B=0,z=f.spatialReference?f.spatialReference._getInfo():null;for(B=0;B<a.height;B++)for(u=0;u<a.width;u++,t++){var x=h[t];if((!p||a.mask[t])&&x&&2===x.length){x=new c(x[0],x[1],f.spatialReference);z&&(x.x=g.prototype._normalizeX(x.x,z).x);var y={Magnitude:a.pixels[0][t],Direction:a.pixels[1][t],Location:w.toJson(x.toJson())};
x=new b(x,null,y);this.add(x)}}}}},_getServiceMinMaxStats:function(){if(!r.isDefined(this.minValues)||!r.isDefined(this.maxValues)||2>this.minValues.length||2>this.maxValues.length)return null;var a=this.minValues[0],f=this.maxValues[0],h=this.minValues[1],p=this.maxValues[1];if(this.pixelFilter&&a&&f&&h&&p){var B=[];B.push([a,f]);B.push([h,p]);h=this._createPixelData(B);this.pixelFilter(h);h&&h.pixelBlock&&h.pixelBlock.pixels&&0<h.pixelBlock.pixels.length&&(a=h.pixelBlock.pixels[0][0],f=h.pixelBlock.pixels[0][1])}return a&&
f?{min:a,max:f}:null},_updateVectorFieldRenderer:function(){var a={type:"sizeInfo",minSize:e.px2pt(.2*this.symbolTileSize),maxSize:e.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},f=[];f.push(a);a=new d({style:this.rendererStyle,visualVariables:f,flowRepresentation:this._vectorFlowRepresentation});this.setRenderer(a)},_getField:function(a,f){if(r.isDefined(a))return f&&(a=a.toLowerCase()),"magnitude"!==a&&"direction"!==a?null:{name:a,alias:a,domain:null,editable:!1,
length:50,type:"esriFieldTypeDouble"}},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_setFlowRepresentation:function(a){this.renderer&&this.renderer.flowRepresentation?this._vectorFlowRepresentation=this.renderer.flowRepresentation:a&&this.renderer&&r.isDefined(a.FlowDirection)&&a.FlowDirection&&(this._vectorFlowRepresentation="oceanographic"===a.FlowDirection.toLowerCase()?this.renderer.FLOW_TO:this.renderer.FLOW_FROM);this.renderer&&(this.renderer.flowRepresentation=
this._vectorFlowRepresentation)}});m("extend-esri")&&q.setObject("layers.ArcGISImageServiceVectorLayer",E,v);return E})},"jimu/LayerInfos/LayerInfoForDefaultDynamicShipFeatureLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred esri/layers/FeatureLayer esri/tasks/query ./LayerInfoForDefaultDynamic".split(" "),function(E,q,A,w,m,v){return E(v,{_msShipFeatureLayerId:null,_msOwnedFeatureLayerDef:null,_msOwnedLayerInfo:null,constructor:function(r,l){this._msShipFeatureLayerId=r.msShipFLayerId},
_initAfterRootLayerInfo:function(){var r=this.map.getLayer(this._msShipFeatureLayerId);r&&this._initPopupInfo(r)},_initPopupInfo:function(r){var l=this.originOperLayer.mapService.layerInfo,k=this.originOperLayer.mapService.subId;r&&(r.infoTemplate?(l.controlPopupInfo.infoTemplates[k]={infoTemplate:r.infoTemplate,layerUrl:this.getUrl()},this.enablePopup()):(l.controlPopupInfo.infoTemplates[k]={infoTemplate:null,layerUrl:this.getUrl()},this.disablePopup()))},_initMSOwnedFeatureLayer:function(){var r=
this.map.getLayer(this.id),l=this.map.getLayer(this._msShipFeatureLayerId);if(l&&!r){this._msOwnedFeatureLayerDef=new A;r=new w(l.url,q.mixin({},l));r.id=this.id;r.visible=this.isShowInMap();q.setObject("_wabProperties.isMSOwnedFeatureLayer",!0,r);this.map.addLayer(r);this._initMsOwnedLayerInfo(r);var k=r.on("load",q.hitch(this,function(){this.layerObject=r;this._msOwnedFeatureLayerDef.resolve(r);k.remove&&k.remove()}))}},_initMsOwnedLayerInfo:function(r){this._msOwnedLayerInfo=this._layerInfoFactory.create({layerObject:r,
title:this.title+"_owned_",id:r.id},this.map)},_msShipIsValid:function(){var r=this.map.getLayer(this._msShipFeatureLayerId),l=this.map.getLayer(this.id);return r&&l},getMSShipFeatures:function(r){var l=new A,k=this.map.getLayer(this._msShipFeatureLayerId);if(r&&k){var n=new m;n.objectIds=r.map(q.hitch(this,function(d){return d.attributes[k.objectIdField]}));k.queryFeatures(n,q.hitch(this,function(d){l.resolve(d.features)}),q.hitch(this,function(){l.resolve(null)}))}else l.resolve(null);return l}})})},
"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(E,q){return E(q,{constructor:function(A,w){this.isTiled=!0},_initVisible:function(){},_setTopLayerVisible:function(A){},setLayerVisiblefromTopLayer:function(){},getOpacity:function(){},setOpacity:function(A){},isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred dojo/aspect ./LayerInfoForDefault ./LayerObjectFacory esri/dijit/PopupTemplate".split(" "),
function(E,q,A,w,m,v,r,l){return E(v,{_layerObjectFacory:null,constructor:function(){this.newSubLayers=[];this.isTable=!0;this._layerObjectFacory=new r(this)},init:function(){},_getLayerObject:function(){var k=new w;this._layerObjectFacory.getLayerObject().then(q.hitch(this,function(n){this.layerObject.empty&&n&&(this.layerObject=n,this._bindEventAfterLayerObjectLoaded());k.resolve(n)}));return k},getLayerObject:function(){return this._getLayerObject()},getPopupInfoFromLayerObject:function(){var k=
this.getPopupInfo();k||!this.layerObject||this.layerObject.empty||(k=this._getDefaultPopupInfo(this.layerObject));return k},loadPopupInfo:function(){var k=new w,n=this.getPopupInfo();n?k.resolve(n):this.getLayerObject().then(q.hitch(this,function(){n=this._getDefaultPopupInfo(this.layerObject);k.resolve(n)}));return k},getLayerType:function(){var k=new w;k.resolve("Table");return k},isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return A.create("div",
{"class":"legends-div"})},_initControlPopup:function(){this.inherited(arguments);this.controlPopupInfo={enablePopup:this.originOperLayer.popupInfo?!0:!1,infoTemplate:this.originOperLayer.popupInfo?new l(this.originOperLayer.popupInfo):null}},_bindEventAfterLayerObjectLoaded:function(){var k=m.after(this.layerObject,"setDefinitionExpression",q.hitch(this,this._onFilterChanged));this._eventHandles.push(k)},getFilter:function(){if(this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression){var k=
this.layerObject.getDefinitionExpression();void 0===k&&(k=this.getFilterOfWebmap())}else k=this.getFilterOfWebmap();return k}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/aspect esri/request ./LayerInfoForDefault ../utils".split(" "),function(E,q,A,w,m,v,r,l,k,n){return E(k,{constructor:function(){this._addImageServiceLayerType()},_addImageServiceLayerType:function(){this.layerObject.type=
!this.layerObject.serviceDataType||"esriImageServiceDataTypeVector-UV"!==this.layerObject.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.layerObject.serviceDataType?"ArcGISImageServiceLayer":"ArcGISImageServiceVectorLayer"},_initLegendsNode:function(d){10.2<=this.layerObject.version?this._legendRequestServer().then(w.hitch(this,function(c){q.empty(d);A.forEach(c.layers,function(g){A.forEach(g.legend,function(b){if("\x3call other values\x3e"!==b.label){var e=q.create("div",{"class":"legend-div"},
d),a=q.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},e),f=null;f=b.imageData?"data:"+b.contentType+";base64,"+b.imageData:b.url;q.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:f},a);q.create("div",{"class":"legend-label jimu-float-leading",innerHTML:n.sanitizeHTML(b.label)||" "},e)}},this)},this)}),w.hitch(this,function(){q.empty(d)})):q.empty(d)},_legendRequestServer:function(){var d=
this.layerObject.url+"/legend",c={f:"json"};this.layerObject._params.bandIds&&(c.bandIds=this.layerObject._params.bandIds);this.layerObject._params.renderingRule&&(c.renderingRule=this.layerObject._params.renderingRule);return l({url:d,content:c,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var d=new m,c={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},g=this.getLayerType(),b=this.getLayerObject();v({type:g,layerObject:b}).then(w.hitch(this,function(e){var a=
e.type;e=e.layerObject;c.layerType=a;0<=this._getLayerTypesOfSupportTable().indexOf(a)&&(c.isSupportedLayer=!0);e.capabilities&&0<=e.capabilities.indexOf("Catalog")?c.isSupportQuery=!0:c.isSupportedLayer=!1;d.resolve(c)}),function(){d.resolve(c)});return d},_getServiceDefinition:function(){var d=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(d)},_bindEvent:function(){this.inherited(arguments);if(this.layerObject&&!this.layerObject.empty){var d=r.after(this.layerObject,
"setRenderingRule",w.hitch(this,this._onRendererChanged));this._eventHandles.push(d)}}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","./LayerInfoForDefault"],function(E,q,A,w,m){return E(m,{getSupportTableInfo:function(){var v=new A,r={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,otherReasonCanNotSupport:!0},l=this.getLayerType(),k=this.getLayerObject();w({type:l,layerObject:k}).then(q.hitch(this,
function(n){var d=n.type;n=n.layerObject;r.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(r.isSupportedLayer=!0);(d=n.getLatestObservations())&&0<d.length&&(r.otherReasonCanNotSupport=!1);v.resolve(r)}),function(){v.resolve(r)});return v}})})},"jimu/LayerInfos/LayerInfoForDefaultKML":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/dom-construct","./LayerInfoForDefault"],function(E,q,A,w){return E(w,{constructor:function(m,v){this.layerObject=m.layerObject},_resetLayerObjectVisiblity:function(){},
_initVisible:function(){var m=this.originOperLayer.kml,v=m.layerInfo.originOperLayer.visibleFolders;m.layerInfo.isRootLayer()&&v?-1<v.indexOf(this.subId)?this._visible=!0:this._visible=!1:this._visible=this.originOperLayer.kml.currentFolder.visible},_setTopLayerVisible:function(m){var v=this.originOperLayer.kml.currentFolder;this._visible=m;this.originOperLayer.kml.layerInfo.layerObject.setFolderVisibility(v,m)},obtainNewSubLayers:function(){var m=[],v=this.originOperLayer.kml;v.currentFolder&&q.forEach(v.layerInfo._getOperLayerByParentFolderId(v.currentFolder.id,
this),function(r){r=this._layerInfoFactory.create(r);m.push(r);r.init()},this);return m},getOpacity:function(){},setOpacity:function(m){},drawLegends:function(m){A.empty(m)},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.getRootLayerInfo().getScaleRange()}})})},"libs/crc":function(){(function(){var E="object"===typeof window?window:{};!E.JS_CRC_NO_NODE_JS&&"object"===typeof process&&process.versions&&process.versions.node&&(E=global);var q=!E.JS_CRC_NO_COMMON_JS&&
"object"===typeof module&&module.exports,A="function"===typeof define&&define.amd,w=!E.JS_CRC_NO_ARRAY_BUFFER&&"undefined"!==typeof ArrayBuffer,m="0123456789abcdef".split(""),v=[{name:"crc32",polynom:3988292384,initValue:-1,bytes:4},{name:"crc16",polynom:40961,initValue:0,bytes:2},{name:"crc24",polynom:720895,initValue:1,bytes:3}],r,l,k;for(r=0;r<v.length;++r){var n=v[r];n.method=function(g){return function(b){var e=b,a="string"!==typeof e;a&&w&&e instanceof ArrayBuffer&&(e=new Uint8Array(e));b=g.initValue;
var f,h=e.length,p=g.table;if(a)for(f=0;f<h;++f)b=p[(b^e[f])&255]^b>>>8;else for(f=0;f<h;++f)a=e.charCodeAt(f),128>a?b=p[(b^a)&255]^b>>>8:(2048>a?b=p[(b^(192|a>>6))&255]^b>>>8:(55296>a||57344<=a?b=p[(b^(224|a>>12))&255]^b>>>8:(a=65536+((a&1023)<<10|e.charCodeAt(++f)&1023),b=p[(b^(240|a>>18))&255]^b>>>8,b=p[(b^(128|a>>12&63))&255]^b>>>8),b=p[(b^(128|a>>6&63))&255]^b>>>8),b=p[(b^(128|a&63))&255]^b>>>8);b^=g.initValue;e="";3<g.bytes?e+=m[b>>28&15]+m[b>>24&15]+m[b>>20&15]+m[b>>16&15]:2<g.bytes&&(e+=m[b>>
20&15]+m[b>>16&15]);return e+=m[b>>12&15]+m[b>>8&15]+m[b>>4&15]+m[b&15]}}(n);n.table=[];for(l=0;256>l;++l){var d=l;for(k=0;8>k;++k)d=d&1?n.polynom^d>>>1:d>>>1;n.table[l]=d>>>0}}var c={};for(r=0;r<v.length;++r)n=v[r],c[n.name]=n.method;if(q)module.exports=c;else{for(r=0;r<v.length;++r)n=v[r],E[n.name]=n.method;A&&define(function(){return c})}})()},"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale dojo/number esri/lang dojo/data/ItemFileWriteStore jimu/utils moment/moment".split(" "),
function(E,q,A,w,m,v,r,l,k){var n=E([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:864E5,HourInMS:36E5,MinuteInMS:6E4,SecInMS:1E3,fieldsStore:null,isHosted:!1,constructor:function(){String.prototype.startsWith=function(d){return 0===this.indexOf(d)};String.prototype.endsWith=function(d){return this.substring(this.length-
d.length)===d};String.prototype.count=function(d){return this.split(d).length-1};String.prototype.trim||(String.prototype.trim=q.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes);this.filterBuilderNls=window.jimuNls.filterBuilder},OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",
stringOperatorEndsWith:"stringOperatorEndsWith",stringOperatorContains:"stringOperatorContains",stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsAnyOf:"stringOperatorIsAnyOf",stringOperatorIsNoneOf:"stringOperatorIsNoneOf",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",numberOperatorIsLessThan:"numberOperatorIsLessThan",
numberOperatorIsAtMost:"numberOperatorIsAtMost",numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",numberOperatorIsNotBetween:"numberOperatorIsNotBetween",numberOperatorIsAnyOf:"numberOperatorIsAnyOf",numberOperatorIsNoneOf:"numberOperatorIsNoneOf",numberOperatorIsBlank:"numberOperatorIsBlank",numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",
dateOperatorIsAfter:"dateOperatorIsAfter",dateOperatorIsOnOrBefore:"dateOperatorIsOnOrBefore",dateOperatorIsOnOrAfter:"dateOperatorIsOnOrAfter",dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast",dateOperatorIsIn:"dateOperatorIsIn",dateOperatorIsNotIn:"dateOperatorIsNotIn",
dateOperatorMinutes:"dateOperatorMinutes",dateOperatorHours:"dateOperatorHours",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",dateOperatorMonths:"dateOperatorMonths",dateOperatorYears:"dateOperatorYears"},prepare:function(d,c){this.isHosted=l.isHostedService(d);c=c||[];this.setFieldsStoreByFieldInfos(c)},isPartsObjHasError:function(d){var c=!1;d&&(c=d.parts&&0<=d.parts.length?A.every(d.parts,q.hitch(this,function(g){return g.parts?0<g.parts.length?A.every(g.parts,q.hitch(this,
function(b){return!b.error})):!1:!g.error})):!1);return!c},isAskForValues:function(d){return n.isAskForValues(d)},hasVirtualDate:function(d){return n.hasVirtualDate(d)},setFieldsStoreByFieldInfos:function(d){d=A.filter(d,q.hitch(this,function(c){return 0<=this._supportFieldTypes.indexOf(c.type)}));d=A.map(d,function(c,g){switch(c.type){case "esriFieldTypeString":var b="string";break;case "esriFieldTypeDate":b="date";break;default:b="number"}return{id:g,label:c.name,shortType:b,alias:c.alias,editable:c.editable,
name:c.name,nullable:c.nullable,type:c.type}},this);this.fieldsStore=new r({data:{identifier:"id",label:"label",items:d}});return d.length},_validatePartsObj:function(d){return d&&"object"===typeof d},_isObject:function(d){return d&&"object"===typeof d},_isString:function(d){return d&&"string"===typeof d},containsNonLatinCharacter:function(d){for(var c=0;c<d.length;c++)if(255<d.charCodeAt(c))return!0;return!1},isBigDataLayer:function(d){return!!d.url&&-1!==d.url.indexOf("BigDataCatalogServer")&&("featureClass"===
d.type||"table"===d.type)},useStandardizedQueries:function(d){return d?10.2<=d.version&&(d.useStandardizedQueries||this.isBigDataLayer(d)):!this.isHosted},getLayerTimezoneOffset:function(d){var c=0;d&&d.dateFieldsTimeReference&&"UTC"!==d.dateFieldsTimeReference.timeZone&&(c=36E5*n.TIMEZONE_DATA[d.dateFieldsTimeReference.timeZone].offset);return c},getExprByFilterObj:function(d){if(!A.every(d.parts,function(h){return!!h}))return null;if(!this.isPartsObjReadyToBuild(d))return d.expr="",d.displaySQL=
"",d.expr;this._handleVirtualDate(d);var c="",g="",b;if(0===d.parts.length)g=c="1\x3d1";else if(1===d.parts.length){var e=d.parts[0];e.valueObj&&q.isArray(e.valueObj.value)&&"multiple"!==e.valueObj.type?(b=this._checkIfValObjArrayAndChecked(e.valueObj.value))?(c=this.builtFilterString(e),g=e.displaySQL):g=c="1\x3d1":(c=this.builtFilterString(e),g=e.displaySQL)}else for(var a="",f=0;f<d.parts.length;f++){e=d.parts[f];e.valueObj&&q.isArray(e.valueObj.value)&&"multiple"!==e.valueObj.type?(b=this._checkIfValObjArrayAndChecked(e.valueObj.value))?
(b=this.builtFilterString(e),e=e.displaySQL):e=b="1\x3d1":(b=this.builtFilterString(e),e=e.displaySQL);if(!v.isDefined(b))return null;c+=a+"("+b+")";g+=a+"("+e+")";a=a||" "+d.logicalOperator+" "}d.expr=c;d.displaySQL=g;return c},_checkIfValObjArrayAndChecked:function(d){var c=!1,g;for(g in d)if(d[g].isChecked){c=!0;break}return c},_handleVirtualDate:function(d){this.hasVirtualDate(d)&&A.forEach(d.parts,q.hitch(this,function(c){c.parts?A.forEach(c.parts,q.hitch(this,function(g){this._updateRealDateByVirtualDate(g)})):
this._updateRealDateByVirtualDate(c)}))},_updateRealDateByVirtualDate:function(d){var c=[this.OPERATORS.dateOperatorIsOn,this.OPERATORS.dateOperatorIsNotOn,this.OPERATORS.dateOperatorIsBefore,this.OPERATORS.dateOperatorIsAfter,this.OPERATORS.dateOperatorIsOnOrBefore,this.OPERATORS.dateOperatorIsOnOrAfter];d.valueObj.virtualDate?d.operator===this.OPERATORS.dateOperatorIsIn||d.operator===this.OPERATORS.dateOperatorIsNotIn?(c=n.getRealDateByVirtualDate(d.valueObj.virtualDate),d.value1=c[0],d.value2=
c[1],d.valueObj.value1=l.getDateTimeStr(c[0]),d.valueObj.value2=l.getDateTimeStr(c[1])):-1<c.indexOf(d.operator)&&(c=n.getRealDateByVirtualDate(d.valueObj.virtualDate),d.value=c,d.valueObj.value=l.getDateTimeStr(c)):(d.valueObj.virtualDate1&&(c=n.getRealDateByVirtualDate(d.valueObj.virtualDate1),d.value1=c,d.valueObj.value1=l.getDateTimeStr(c)),d.valueObj.virtualDate2&&(c=n.getRealDateByVirtualDate(d.valueObj.virtualDate2),d.value2=c,d.valueObj.value2=l.getDateTimeStr(c)))},isPartsObjReadyToBuild:function(d){return A.every(d.parts,
q.hitch(this,function(c){return c.parts?A.every(c.parts,q.hitch(this,function(g){return this._isPartReadyToBuild(g)})):this._isPartReadyToBuild(c)}))},_isPartReadyToBuild:function(d){var c=d.fieldObj.shortType,g=d.operator,b=d.valueObj;d=b.type||"value";var e=b.value,a=b.value1;b=b.value2;if("value"===d){if("string"===c)return g===this.OPERATORS.stringOperatorIsBlank||g===this.OPERATORS.stringOperatorIsNotBlank?!0:l.isNotEmptyString(e);if("number"===c)return g===this.OPERATORS.numberOperatorIsBlank||
g===this.OPERATORS.numberOperatorIsNotBlank?!0:g===this.OPERATORS.numberOperatorIsBetween||g===this.OPERATORS.numberOperatorIsNotBetween?l.isValidNumber(a)&&l.isValidNumber(b):l.isValidNumber(e);if("date"===c)return g===this.OPERATORS.dateOperatorIsBlank||g===this.OPERATORS.dateOperatorIsNotBlank?!0:g===this.OPERATORS.dateOperatorIsBetween||g===this.OPERATORS.dateOperatorIsNotBetween||g===this.OPERATORS.dateOperatorIsIn||g===this.OPERATORS.dateOperatorIsNotIn?l.isNotEmptyString(a)&&l.isNotEmptyString(b):
g===this.OPERATORS.dateOperatorInTheLast||g===this.OPERATORS.dateOperatorNotInTheLast?void 0!==e&&null!==e:l.isNotEmptyString(e)}else{if("field"===d)return l.isNotEmptyString(e);if("unique"===d){if("string"===c)return l.isNotEmptyString(e);if("number"===c)return l.isValidNumber(e);if("date"===c)return l.isValidDate(e)}else if("multiple"===d){if("string"===c)return l.isNotEmptyStringArray(e);if("number"===c)return l.isValidNumberArray(e)}else if("values"!==d&&("uniquePredefined"===d||"multiplePredefined"===
d)){if("string"===c)return l.isNotEmptyStringArray(e);if("number"===c)return l.isValidNumberArray(e)}}return!1},builtFilterString:function(d){var c="",g="";if(d.parts)for(var b="",e=0;e<d.parts.length;e++){var a=d.parts[e],f=this.builtSingleFilterString(a);a.expr=f.whereClause;if(!v.isDefined(f.whereClause))return null;c+=b+f.whereClause;g+=b+a.displaySQL;b=" "+d.logicalOperator+" "}else d&&d.valueObj&&"multiple"===d.valueObj.type&&0===d.valueObj.value.length?c=g="1\x3d1":(c=this.builtSingleFilterString(d).whereClause,
g=d.displaySQL);d.expr=c;d.displaySQL=g;return c},_preBuiltSingleFilterString:function(d){if("string"===d.fieldObj.shortType&&"\x3cNull\x3e"===d.valueObj.value){if(d.operator===this.OPERATORS.stringOperatorIs)return{whereClause:d.fieldObj.name+" IS NULL"};if(d.operator===this.OPERATORS.stringOperatorIsNot)return{whereClause:d.fieldObj.name+" IS NOT NULL"}}if("number"===d.fieldObj.shortType&&"\x3cNull\x3e"===d.valueObj.value){if(d.operator===this.OPERATORS.numberOperatorIs)return{whereClause:d.fieldObj.name+
" IS NULL"};if(d.operator===this.OPERATORS.numberOperatorIsNot)return{whereClause:d.fieldObj.name+" IS NOT NULL"}}return null},_handlePrefixStringsForIn:function(d,c){for(var g=[],b=0;b<d.length;b++){var e=d[b];e=e.replace(/'/g,"''");var a=this.isHosted&&this.containsNonLatinCharacter(e)?"N":"";e=c||this.isHosted?e:e.toLowerCase();e=""+a+"'"+e+"'";g.push(e)}return g.join(",")},getDateValueByLayerTimeOffset:function(d,c){return 0===c?d:new Date(d.getTime()+c)},builtSingleFilterString:function(d){this.isHosted&&
(d.caseSensitive=!1);if(v.isDefined(d.valueObj.isValid)&&!d.valueObj.isValid)return{whereClause:null};var c=this._preBuiltSingleFilterString(d);if(c)return c;var g=d.valueObj.value,b=d.valueObj.value1,e=d.valueObj.value2,a=c="",f=[];if("string"===d.fieldObj.shortType){var h="";g&&"field"!==d.valueObj.type&&this.isHosted&&!q.isArray(g)&&this.containsNonLatinCharacter(g)&&(h="N");!g||"multiplePredefined"!==d.valueObj.type&&"uniquePredefined"!==d.valueObj.type||(f=[],A.forEach(g,q.hitch(this,function(t){t.isChecked&&
f.push(t.value)})),d.operator===this.OPERATORS.stringOperatorIs||d.operator===this.OPERATORS.stringOperatorIsNot?(g=f[0],this.isHosted&&this.containsNonLatinCharacter(g)&&(h="N")):g=f);var p=[];switch(d.operator){case this.OPERATORS.stringOperatorIs:c="field"===d.valueObj.type?d.fieldObj.name+" \x3d "+g:d.caseSensitive||this.isHosted?d.fieldObj.name+" \x3d "+h+"'"+g.replace(/'/g,"''")+"'":"LOWER("+d.fieldObj.name+") \x3d "+h+"'"+g.replace(/'/g,"''").toLowerCase()+"'";break;case this.OPERATORS.stringOperatorIsNot:c=
"field"===d.valueObj.type?d.fieldObj.name+" \x3c\x3e "+g:d.caseSensitive||this.isHosted?d.fieldObj.name+" \x3c\x3e "+h+"'"+g.replace(/'/g,"''")+"'":"LOWER("+d.fieldObj.name+") \x3c\x3e "+h+"'"+g.replace(/'/g,"''").toLowerCase()+"'";break;case this.OPERATORS.stringOperatorStartsWith:p=[];"multiplePredefined"===d.valueObj.type||"uniquePredefined"===d.valueObj.type?(A.forEach(g,q.hitch(this,function(t){var z=this.isHosted&&this.containsNonLatinCharacter(t)?"N":"";d.caseSensitive||this.isHosted?p.push(d.fieldObj.name+
" LIKE "+z+"'"+t.replace(/'/g,"''")+"%'"):p.push("LOWER("+d.fieldObj.name+") LIKE "+z+"'"+t.replace(/'/g,"''").toLowerCase()+"%'")})),c="(("+p.join(") OR (")+"))"):c=d.caseSensitive||this.isHosted?d.fieldObj.name+" LIKE "+h+"'"+g.replace(/'/g,"''")+"%'":"LOWER("+d.fieldObj.name+") LIKE "+h+"'"+g.replace(/'/g,"''").toLowerCase()+"%'";break;case this.OPERATORS.stringOperatorEndsWith:p=[];"multiplePredefined"===d.valueObj.type||"uniquePredefined"===d.valueObj.type?(A.forEach(g,q.hitch(this,function(t){var z=
this.isHosted&&this.containsNonLatinCharacter(t)?"N":"";d.caseSensitive||this.isHosted?p.push(d.fieldObj.name+" LIKE "+z+"'%"+t.replace(/'/g,"''")+"'"):p.push("LOWER("+d.fieldObj.name+") LIKE "+z+"'%"+t.replace(/'/g,"''").toLowerCase()+"'")})),c="(("+p.join(") OR (")+"))"):c=d.caseSensitive||this.isHosted?d.fieldObj.name+" LIKE "+h+"'%"+g.replace(/'/g,"''")+"'":"LOWER("+d.fieldObj.name+") LIKE "+h+"'%"+g.replace(/'/g,"''").toLowerCase()+"'";break;case this.OPERATORS.stringOperatorContains:p=[];"multiplePredefined"===
d.valueObj.type||"uniquePredefined"===d.valueObj.type?(A.forEach(g,q.hitch(this,function(t){var z=this.isHosted&&this.containsNonLatinCharacter(t)?"N":"";d.caseSensitive||this.isHosted?p.push(d.fieldObj.name+" LIKE "+z+"'%"+t.replace(/'/g,"''")+"%'"):p.push("LOWER("+d.fieldObj.name+") LIKE "+z+"'%"+t.replace(/'/g,"''").toLowerCase()+"%'")})),c="(("+p.join(") OR (")+"))"):c=d.caseSensitive||this.isHosted?d.fieldObj.name+" LIKE "+h+"'%"+g.replace(/'/g,"''")+"%'":"LOWER("+d.fieldObj.name+") LIKE "+h+
"'%"+g.replace(/'/g,"''").toLowerCase()+"%'";break;case this.OPERATORS.stringOperatorDoesNotContain:p=[];"multiplePredefined"===d.valueObj.type||"uniquePredefined"===d.valueObj.type?(A.forEach(g,q.hitch(this,function(t){var z=this.isHosted&&this.containsNonLatinCharacter(t)?"N":"";d.caseSensitive||this.isHosted?p.push(d.fieldObj.name+" NOT LIKE "+z+"'%"+t.replace(/'/g,"''")+"%'"):p.push("LOWER("+d.fieldObj.name+") NOT LIKE "+z+"'%"+t.replace(/'/g,"''").toLowerCase()+"%'")})),c="(("+p.join(") AND (")+
"))"):c=d.caseSensitive||this.isHosted?d.fieldObj.name+" NOT LIKE "+h+"'%"+g.replace(/'/g,"''")+"%'":"LOWER("+d.fieldObj.name+") NOT LIKE "+h+"'%"+g.replace(/'/g,"''").toLowerCase()+"%'";break;case this.OPERATORS.stringOperatorIsAnyOf:g=this._handlePrefixStringsForIn(g,d.caseSensitive);c=d.caseSensitive||this.isHosted?d.fieldObj.name+" IN ("+g+")":"LOWER("+d.fieldObj.name+") IN ("+g+")";break;case this.OPERATORS.stringOperatorIsNoneOf:g=this._handlePrefixStringsForIn(g,d.caseSensitive);c=d.caseSensitive||
this.isHosted?d.fieldObj.name+" NOT IN ("+g+")":"LOWER("+d.fieldObj.name+") NOT IN ("+g+")";break;case this.OPERATORS.stringOperatorIsBlank:c=d.fieldObj.name+" IS NULL";break;case this.OPERATORS.stringOperatorIsNotBlank:c=d.fieldObj.name+" IS NOT NULL"}}else if("number"===d.fieldObj.shortType)switch(!g||"uniquePredefined"!==d.valueObj.type&&"multiplePredefined"!==d.valueObj.type?g&&"multiple"===d.valueObj.type&&(g=g.join(",")):(f=[],A.forEach(g,q.hitch(this,function(t){t.isChecked&&f.push(t.value)})),
g=f.join(",")),d.operator){case this.OPERATORS.numberOperatorIs:c=d.fieldObj.name+" \x3d "+g;break;case this.OPERATORS.numberOperatorIsNot:c=d.fieldObj.name+" \x3c\x3e "+g;break;case this.OPERATORS.numberOperatorIsAtLeast:c=d.fieldObj.name+" \x3e\x3d "+g;break;case this.OPERATORS.numberOperatorIsLessThan:c=d.fieldObj.name+" \x3c "+g;break;case this.OPERATORS.numberOperatorIsAtMost:c=d.fieldObj.name+" \x3c\x3d "+g;break;case this.OPERATORS.numberOperatorIsGreaterThan:c=d.fieldObj.name+" \x3e "+g;break;
case this.OPERATORS.numberOperatorIsAnyOf:c=d.fieldObj.name+" IN ("+g+")";break;case this.OPERATORS.numberOperatorIsNoneOf:c=d.fieldObj.name+" NOT IN ("+g+")";break;case this.OPERATORS.numberOperatorIsBetween:c=d.fieldObj.name+" BETWEEN "+b+" AND "+e;break;case this.OPERATORS.numberOperatorIsNotBetween:c=d.fieldObj.name+" NOT BETWEEN "+b+" AND "+e;break;case this.OPERATORS.numberOperatorIsBlank:c=d.fieldObj.name+" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:c=d.fieldObj.name+" IS NOT NULL"}else{a=
d._useStandardizedQueries;if("field"!==d.valueObj.type){g&&(g=l.getDateByDateTimeStr(g),h=this.getDateValueByLayerTimeOffset(g,d._layerTimeZoneOffset));if(b){b=l.getDateByDateTimeStr(b);var B=this.getDateValueByLayerTimeOffset(b,d._layerTimeZoneOffset)}if(e){e=l.getDateByDateTimeStr(e);var u=this.getDateValueByLayerTimeOffset(e,d._layerTimeZoneOffset)}}b=d.valueObj.enableTime;e=d.valueObj.timeAccuracy;switch(d.operator){case this.OPERATORS.dateOperatorIsOn:"field"===d.valueObj.type?c=d.fieldObj.name+
" \x3d "+g:(c="unique"===d.valueObj.type?this._getEndDateByTimeForUnique(h,d.fieldObj.dateFormat):this._getEndDateByTime(h,b,e),c="("+d.fieldObj.name+" BETWEEN "+(a?"timestamp ":"")+"'"+this.formatDate(h)+"' AND "+(a?"timestamp ":"")+"'"+c+"') AND ("+d.fieldObj.name+" \x3c\x3e "+(a?"timestamp ":"")+"'"+c+"')");break;case this.OPERATORS.dateOperatorIsNotOn:"field"===d.valueObj.type?c=d.fieldObj.name+" \x3c\x3e "+g:(c="unique"===d.valueObj.type?this._getEndDateByTimeForUnique(h,d.fieldObj.dateFormat):
this._getEndDateByTime(h,b,e),c="("+d.fieldObj.name+" \x3c "+(a?"timestamp ":"")+"'"+this.formatDate(h)+"') OR ("+d.fieldObj.name+" \x3e\x3d "+(a?"timestamp ":"")+"'"+c+"')");break;case this.OPERATORS.dateOperatorIsBefore:c="field"===d.valueObj.type?d.fieldObj.name+" \x3c "+g:d.fieldObj.name+" \x3c "+(a?"timestamp ":"")+"'"+this.formatDate(h)+"'";break;case this.OPERATORS.dateOperatorIsAfter:"field"===d.valueObj.type?c=d.fieldObj.name+" \x3e "+g:(c="unique"===d.valueObj.type?this._getEndDateByTimeForUnique(h,
d.fieldObj.dateFormat):this._getEndDateByTime(h,b,e),c=d.fieldObj.name+" \x3e\x3d "+(a?"timestamp ":"")+"'"+c+"'");break;case this.OPERATORS.dateOperatorIsOnOrBefore:"field"===d.valueObj.type?c=d.fieldObj.name+" \x3c\x3d "+g:(c="unique"===d.valueObj.type?this._getEndDateByTimeForUnique(h,d.fieldObj.dateFormat):this._getEndDateByTime(h,b,e),c=d.fieldObj.name+" \x3c "+(a?"timestamp ":"")+"'"+c+"'");break;case this.OPERATORS.dateOperatorIsOnOrAfter:c="field"===d.valueObj.type?d.fieldObj.name+" \x3e\x3d "+
g:d.fieldObj.name+" \x3e\x3d "+(a?"timestamp ":"")+"'"+this.formatDate(h)+"'";break;case this.OPERATORS.dateOperatorInTheLast:c=d.fieldObj.name+" BETWEEN CURRENT_TIMESTAMP - "+this._convertRangeToDays(d.valueObj.value,d.valueObj.range)+" AND CURRENT_TIMESTAMP";break;case this.OPERATORS.dateOperatorNotInTheLast:c=d.fieldObj.name+" NOT BETWEEN CURRENT_TIMESTAMP - "+this._convertRangeToDays(d.valueObj.value,d.valueObj.range)+" AND CURRENT_TIMESTAMP";break;case this.OPERATORS.dateOperatorIsBetween:case this.OPERATORS.dateOperatorIsIn:c=
this._getEndDateByTime(u,d.valueObj.enableTime2,d.valueObj.timeAccuracy2);c="("+d.fieldObj.name+" BETWEEN "+(a?"timestamp ":"")+"'"+this.formatDate(B)+"' AND "+(a?"timestamp ":"")+"'"+c+"') AND ("+d.fieldObj.name+" \x3c\x3e "+(a?"timestamp ":"")+"'"+c+"')";break;case this.OPERATORS.dateOperatorIsNotBetween:case this.OPERATORS.dateOperatorIsNotIn:c=this._getEndDateByTime(u,d.valueObj.enableTime2,d.valueObj.timeAccuracy2);c="("+d.fieldObj.name+" \x3c "+(a?"timestamp ":"")+"'"+this.formatDate(B)+"') OR ("+
d.fieldObj.name+" \x3e\x3d "+(a?"timestamp ":"")+"'"+c+"')";break;case this.OPERATORS.dateOperatorIsBlank:c=d.fieldObj.name+" IS NULL";break;case this.OPERATORS.dateOperatorIsNotBlank:c=d.fieldObj.name+" IS NOT NULL"}}"date"===d.fieldObj.shortType?(h=q.clone(d.valueObj),h.dateFormat=d.fieldObj.dateFormat,a=this.getDisplaySQL(d.fieldObj.name,h,d.operator)):a=c;d.displaySQL=a;return{whereClause:c}},_getEndDateByTime:function(d,c,g){d=c?"s"===g?this.addSec(d):"m"===g?this.addMinute(d):this.addHour(d):
this.addDay(d);return this.formatDate(d)},_getEndDateByTimeForUnique:function(d,c){d=c&&0<=c.indexOf("ShortTime")?this.addMinute(d):c&&0<=c.indexOf("LongTime")?this.addSec(d):this.addDay(d);return this.formatDate(d)},_getDisplayDates:function(d){var c={value:d.virtualDate,value1:d.virtualDate1,value2:d.virtualDate2},g=""===d.dateFormat?{}:{format:{dateFormat:d.dateFormat}};c.value=""===d.virtualDate||void 0===d.virtualDate?"field"===d.type?d.value:"unique"===d.type?l.localizeDateByFieldInfo(l.getDateByDateTimeStr(d.value),
g):l.localizeDateTimeByFieldInfo(l.getDateByDateTimeStr(d.value),g,d.enableTime,d.timeAccuracy):this.filterBuilderNls[d.virtualDate];c.value1=""===d.virtualDate1?l.localizeDateTimeByFieldInfo(l.getDateByDateTimeStr(d.value1),g,d.enableTime1,d.timeAccuracy1):this.filterBuilderNls[d.virtualDate1];c.value2=""===d.virtualDate2?l.localizeDateTimeByFieldInfo(l.getDateByDateTimeStr(d.value2),g,d.enableTime2,d.timeAccuracy2):this.filterBuilderNls[d.virtualDate2];return c},getDisplaySQL:function(d,c,g){var b=
"";0<g.indexOf("InTheLast")?b=this.filterBuilderNls[g]+" "+c.value+" "+this._getDateRangeEnum(c.value,c.range):(c=this._getDisplayDates(c,g),b=0<g.indexOf("Between")?this.filterBuilderNls[g]+" "+c.value1+" "+this.filterBuilderNls.and+" "+c.value2:0<g.indexOf("Blank")?this.filterBuilderNls[g]:this.filterBuilderNls[g]+" "+c.value);return d+" "+b},_getDateRangeEnum:function(d,c){c={dateOperatorYears:"year",dateOperatorDays:"day",dateOperatorMonths:"month",dateOperatorWeeks:"week",dateOperatorHours:"hour",
dateOperatorMinutes:"minute"}[c];return window.jimuNls.timeUnit[1<d?c+"s":c].toLowerCase()},_convertRangeToDays:function(d,c){var g=d;c===this.OPERATORS.dateOperatorYears?g=365*d:c===this.OPERATORS.dateOperatorMonths?g=30*d:c===this.OPERATORS.dateOperatorWeeks?g=7*d:c===this.OPERATORS.dateOperatorHours?g=d/24:c===this.OPERATORS.dateOperatorMinutes&&(g=d/1440);return g=Math.round(1E6*g)/1E6},formatDate:function(d){d=new Date(d);return""+d.getUTCFullYear()+"-"+m.format(d.getUTCMonth()+1,{pattern:"00"})+
"-"+m.format(d.getUTCDate(),{pattern:"00"})+" "+m.format(d.getUTCHours(),{pattern:"00"})+":"+m.format(d.getUTCMinutes(),{pattern:"00"})+":"+m.format(d.getUTCSeconds(),{pattern:"00"})},addDay:function(d){return new Date(d.getTime()+this.dayInMS)},addHour:function(d){return new Date(d.getTime()+this.HourInMS)},addMinute:function(d){return new Date(d.getTime()+this.MinuteInMS)},addSec:function(d){return new Date(d.getTime()+this.SecInMS)},getFilterObjByExpr:function(d){if(d&&this.fieldsStore){var c=
this.replaceStrings(d);d=c.defExpr;var g=this.findParts(d,"AND");1===g.parts.length&&(g=this.findParts(d,"OR"),1===g.parts.length&&(g.logicalOperator="AND"));A.forEach(g.parts,function(b){b.expr=b.expr.trim();if(b.expr.startsWith("(")&&-1<b.expr.search(/\)$/)){var e=b.expr.substring(1,b.expr.length-1),a=e.indexOf("("),f=e.indexOf(")");if(-1===a&&-1===f||a<f)b.expr=e}e=this.findParts(b.expr,"AND");1===e.parts.length&&(e=this.findParts(b.expr,"OR"));1<e.parts.length&&(b.parts=e.parts,b.logicalOperator=
e.logicalOperator)},this);this.parseExpr(g);this.reReplaceStrings(c,g,q.hitch(this,function(){g&&g.parts&&A.forEach(g.parts,q.hitch(this,function(b){b&&(b.parts?A.forEach(b.parts,q.hitch(this,function(e){this._handleParsedValuesForSinglePart(e);this._addDefalutValueTypeForSinglePart(e)})):(this._handleParsedValuesForSinglePart(b),this._addDefalutValueTypeForSinglePart(b)))}))}));this.isPartsObjHasError(g)&&(g=null);return g}},_handleParsedValuesForSinglePart:function(d){d&&d.fieldObj&&"number"===
d.fieldObj.shortType&&d.valueObj&&(d.valueObj.hasOwnProperty("value")&&(d.valueObj.value=parseFloat(d.valueObj.value)),d.valueObj.hasOwnProperty("value1")&&(d.valueObj.value1=parseFloat(d.valueObj.value1)),d.valueObj.hasOwnProperty("value2")&&(d.valueObj.value2=parseFloat(d.valueObj.value2)))},_addDefalutValueTypeForSinglePart:function(d){d&&d.valueObj&&!d.valueObj.type&&(d.valueObj.type="value")},replaceStrings:function(d){for(var c=d,g=function(p,B,u){var t=-1;t=p.indexOf("'",u+1);return t===u+
1?(t=p.indexOf("'",t+1),g(p,B,t)):u},b=[],e=d.indexOf("'");-1<e;){var a=e;e=d.indexOf("'",e+1);var f=0;e=g(d,a,e);"%"===d[a+1]&&a++;"%"===d[e-1]&&(--e,f++);var h=d.substring(a+1,e);"N"===d[a-1]&&(d=d.substring(0,a-1)+d.substring(a),--a,--e);this.isDateString(h)||-1!==h.indexOf("{")?e=d.indexOf("'",e+1+f):(b.push(h),d=d.substring(0,a+1)+"#"+(b.length-1)+"#"+d.substring(e),e=d.indexOf("'",d.lastIndexOf("#")+2+f))}return{origDefExpr:c,defExpr:d,savedStrings:b}},reReplaceStrings:function(d,c,g){var b=
d.savedStrings;if(!b.length)g&&"function"===typeof g&&g();else if(b.length){var e=function(f,h){if(void 0===f.valueObj||null===f.valueObj||void 0===f.valueObj.value||null===f.valueObj.value||"string"!==f.fieldObj.shortType)return!1;var p=f.valueObj.value.indexOf("#"),B=f.valueObj.value.lastIndexOf("#");return v.isDefined(f.valueObj.value)&&-1<p?(f.valueObj.value=h[parseInt(f.valueObj.value.substring(p+1,B),10)].replace(/''/g,"'"),this.builtSingleFilterString(f),!0):!1};e=q.hitch(this,e);var a=!1;
A.forEach(c.parts,function(f){if(f.parts){var h=!1;A.forEach(f.parts,function(p){h=e(p,b)||h});h&&(a=h,f.expr=this.builtFilterString(f))}else(a=e(f,b)||a)&&this.builtFilterString(f)},this);g&&"function"===typeof g&&g();a&&(c.expr=null,this.getExprByFilterObj(c))}},isDateString:function(d){return 19===d.length&&"-"===d.charAt(4)&&"-"===d.charAt(7)&&" "===d.charAt(10)&&":"===d.charAt(13)&&":"===d.charAt(16)?!0:!1},findParts:function(d,c){for(var g=d.toLowerCase(),b=" "+c.toLowerCase()+" ",e=[],a=0,
f=g.indexOf(b);0<f;){var h=d.substring(a,f),p=h.toLowerCase(),B=h.count("("),u=h.count(")"),t=h.count("'");B!==u||1===t%2?f=g.indexOf(b,f+1):-1<p.indexOf(" between ")&&-1===p.indexOf(" and ")?f=g.indexOf(b,f+1):(e.push({expr:h}),a=f+b.length,f=g.indexOf(b,a))}e.push({expr:d.substring(a)});for(g=e.length-1;0<=g;g--)!this.hasOperator(e[g].expr)&&0<g&&(e[g-1].expr+=" "+c+" "+e[g].expr,e.splice(g,1));return{expr:d,parts:e,logicalOperator:c}},hasOperator:function(d){d=d.toLowerCase();return-1<d.indexOf("{")&&
-1<d.indexOf("}")||-1<d.indexOf(" \x3d ")||-1<d.indexOf(" \x3c ")||-1<d.indexOf(" \x3e ")||-1<d.indexOf(" \x3c\x3e ")||-1<d.indexOf(" \x3c\x3d ")||-1<d.indexOf(" \x3e\x3d ")||-1<d.indexOf(" like ")||-1<d.indexOf(" between ")||-1<d.indexOf(" date")||-1<d.indexOf(" is null")||-1<d.indexOf(" is not null")?!0:!1},parseExpr:function(d){A.forEach(d.parts,function(c){c.parts?this.parseExpr(c):this.parseSingleExpr(c)},this)},_preParseSingleExpr:function(d){var c=null;try{if(c=q.clone(d),c.expr=c.expr.trim(),
/^LOWER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+LOWER\(N?'(.*)'\)$/i.test(c.expr)){var g=d="",b=c.expr.match(/^LOWER\((.*)\)\s+/i);if(b&&2<=b.length)d=b[1];else return null;var e=c.expr.match(/LOWER\(N?'(.*)'\)$/i);if(e&&2<=e.length)g="'"+e[1]+"'";else return null;c.expr=c.expr.replace(/^LOWER\((.*)\)\s+/i,d+" ");c.expr=c.expr.replace(/LOWER\(N?'(.*)'\)$/i,g);c.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(c.expr)&&(c.caseSensitive=!0)}catch(a){return console.log(a),null}c&&this.isHosted&&
(c.caseSensitive=!1);return c},_removeOperator:function(d,c,g){c=c.substring(g).trim();"date"===d&&!this.isHosted&&c.toLowerCase().startsWith("timestamp ")&&(c=c.substring(10).trim());return c},parseSingleExpr:function(d){var c=this._preParseSingleExpr(d);c&&(d=q.mixin(d,c));c=d.expr.trim();var g=c.indexOf(" "),b=c.substring(0,g);d.fieldObj={name:b};d.valueObj={};this.getFieldItemByName({name:b},function(e){d.fieldObj.shortType=e.shortType[0];d.fieldObj.label=e.label[0]},function(){d.error={msg:"unknown field name ("+
b+")",code:1}});c=c.substring(g+1).trim();g=c.toLowerCase();g.startsWith("\x3d ")?(c=this._removeOperator(d.fieldObj.shortType,c,2),this.storeValue(c,d),d.operator="date"===d.fieldObj.shortType?this.OPERATORS.dateOperatorIsOn:"string"===d.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):g.startsWith("\x3c ")?(c=this._removeOperator(d.fieldObj.shortType,c,2),this.storeValue(c,d),"date"===d.fieldObj.shortType?d.operator=this.OPERATORS.dateOperatorIsBefore:"number"===
d.fieldObj.shortType?d.operator=this.OPERATORS.numberOperatorIsLessThan:d.error={msg:"operator ("+g+") not supported for string",code:3}):g.startsWith("\x3e ")?(c=this._removeOperator(d.fieldObj.shortType,c,2),this.storeValue(c,d),"date"===d.fieldObj.shortType?d.operator=this.OPERATORS.dateOperatorIsAfter:"number"===d.fieldObj.shortType?d.operator=this.OPERATORS.numberOperatorIsGreaterThan:d.error={msg:"operator ("+g+") not supported for string",code:3}):g.startsWith("\x3c\x3e ")?(c=this._removeOperator(d.fieldObj.shortType,
c,3),this.storeValue(c,d),d.operator="date"===d.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:"string"===d.fieldObj.shortType?this.OPERATORS.stringOperatorIsNot:this.OPERATORS.numberOperatorIsNot):g.startsWith("\x3c\x3d ")?(c=this._removeOperator(d.fieldObj.shortType,c,3),this.storeValue(c,d),"date"===d.fieldObj.shortType?d.operator=this.OPERATORS.dateOperatorIsOnOrBefore:"number"===d.fieldObj.shortType?d.operator=this.OPERATORS.numberOperatorIsAtMost:d.error={msg:"operator ("+g+") not supported for string",
code:3}):g.startsWith("\x3e\x3d ")?(c=this._removeOperator(d.fieldObj.shortType,c,3),this.storeValue(c,d),"date"===d.fieldObj.shortType?d.operator=this.OPERATORS.dateOperatorIsOnOrAfter:"number"===d.fieldObj.shortType?d.operator=this.OPERATORS.numberOperatorIsAtLeast:d.error={msg:"operator ("+g+") not supported for string",code:3}):g.startsWith("like ")?(c=c.substring(5).trim(),c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&c.endsWith("%'")?(this.storeValue(c.substring(2,c.length-
2),d),d.operator=this.OPERATORS.stringOperatorContains):c.startsWith("'%")&&c.endsWith("'")?(this.storeValue(c.substring(2,c.length-1),d),d.operator=this.OPERATORS.stringOperatorEndsWith):c.startsWith("'")&&c.endsWith("%'")?(this.storeValue(c.substring(1,c.length-2),d),d.operator=this.OPERATORS.stringOperatorStartsWith):d.error={msg:"value ("+g+") not supported for LIKE",code:3}):g.startsWith("not like ")?(c=c.substring(9).trim(),c.startsWith("N'")&&(c=c.substring(1,c.length)),c.startsWith("'%")&&
c.endsWith("%'")?(this.storeValue(c.substring(2,c.length-2),d),d.operator=this.OPERATORS.stringOperatorDoesNotContain):d.error={msg:"value ("+g+") not supported for NOT LIKE",code:3}):g.startsWith("between ")?this._updatePartForBetween(c,!0,d):g.startsWith("not between ")?this._updatePartForBetween(c,!1,d):"is null"===g?(d.valueObj.value=null,d.operator="date"===d.fieldObj.shortType?this.OPERATORS.dateOperatorIsBlank:"string"===d.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):
"is not null"===g?(d.valueObj.value=null,d.operator="date"===d.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:"string"===d.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:this.OPERATORS.numberOperatorIsNotBlank):d.error={msg:"unknown operator ("+g+")",code:2};if(v.isDefined(d.valueObj.value)&&"string"===typeof d.valueObj.value&&d.valueObj.value.startsWith("{")&&d.valueObj.value.endsWith("}")||v.isDefined(d.valueObj.value1)&&"string"===typeof d.valueObj.value1&&d.valueObj.value1.startsWith("{")&&
d.valueObj.value1.endsWith("}"))d.isInteractive=!0},getFieldItemByName:function(d,c,g){this.fieldsStore.fetch({query:d,onComplete:q.hitch(this,function(b){b&&b.length?c(b[0]):g()})})},subtractDay:function(d){return new Date(d.getTime()-this.dayInMS)},_updatePartForBetween:function(d,c,g){d=this._removeOperator(g.fieldObj.shortType,d,(c?"between ":"not between ").length);var b=d.toLowerCase().indexOf(" and ");if(-1<b){var e=d.substring(0,b).trim();if(e.startsWith("CURRENT_TIMESTAMP "))if(e=e.substring(18).trim(),
e.startsWith("-")){g.operator=c?this.OPERATORS.dateOperatorInTheLast:this.OPERATORS.dateOperatorNotInTheLast;try{var a=parseFloat(e.substring(1).trim());if(1<=a){var f=this.OPERATORS.dateOperatorDays;var h=a/365;1E-4>Math.abs(h-Math.round(h))?(a=Math.round(h),f=this.OPERATORS.dateOperatorYears):(h=a/30,1E-4>Math.abs(h-Math.round(h))?(a=Math.round(h),f=this.OPERATORS.dateOperatorMonths):(h=a/7,1E-4>Math.abs(h-Math.round(h))&&(a=Math.round(h),f=this.OPERATORS.dateOperatorWeeks)))}else f=this.OPERATORS.dateOperatorMinutes,
a*=24,1E-4>Math.abs(a-Math.round(a))?f=this.OPERATORS.dateOperatorHours:a*=60;g.valueObj.value=a;g.valueObj.range=f}catch(p){g.error={msg:"missing count for '"+(c?"":"not ")+"in the last'",code:3}}}else g.error={msg:"'"+(c?"":"not ")+"in the next' not supported",code:3};else if(d=this._removeOperator(g.fieldObj.shortType,d.substring(b),5),this.storeValue1(e,g),this.storeValue2(d,g),"date"===g.fieldObj.shortType){if(g.operator=c?this.OPERATORS.dateOperatorIsBetween:this.OPERATORS.dateOperatorIsNotBetween,
"object"===typeof g.valueObj.value1&&"object"===typeof g.valueObj.value2)try{1E3>Math.abs(this.subtractDay(g.valueObj.value2).getTime()-g.valueObj.value1.getTime())&&(g.valueObj.value=g.valueObj.value1,delete g.valueObj.value1,delete g.valueObj.value2,g.operator=c?this.OPERATORS.dateOperatorIsOn:this.OPERATORS.dateOperatorIsNotOn)}catch(p){}}else"number"===g.fieldObj.shortType||"oid"===g.fieldObj.shortType?g.operator=c?this.OPERATORS.numberOperatorIsBetween:this.OPERATORS.numberOperatorIsNotBetween:
g.error={msg:g.fieldObj.shortType+" field not supported for "+(c?"":"NOT ")+"BETWEEN",code:3}}else g.error={msg:"missing AND operator for "+(c?"":"NOT ")+"BETWEEN",code:3}},storeValue:function(d,c){if(d.startsWith("{")&&d.endsWith("}"))c.valueObj.value=d;else if(d.startsWith("'{")&&d.endsWith("}'"))c.valueObj.value=d.substring(1,d.length-1);else if("date"===c.fieldObj.shortType)if(d.startsWith("'")&&d.endsWith("'")){var g=d.substring(1,d.length-1);c.valueObj.value=this.parseDate(g)}else c.valueObj.value=
d,c.valueObj.type="field";else"string"===c.fieldObj.shortType?(d.startsWith("#")||d.startsWith("%#"))&&(d.endsWith("#")||d.endsWith("#%"))?c.valueObj.value=d:d.startsWith("'")&&d.endsWith("'")?c.valueObj.value=d.substring(1,d.length-1).replace(/''/g,"'"):(c.valueObj.value=d,c.valueObj.type="field",this.getFieldItemByName({name:d},function(b){c.valueObj.label=b.label[0]},function(){c.error={msg:"unknown field name ("+d+")",code:1}})):(c.valueObj.value=d,isNaN(d)&&(c.valueObj.type="field",this.getFieldItemByName({name:d},
function(b){c.valueObj.label=b.label[0]},function(){c.error={msg:"unknown field name ("+d+")",code:1}})))},storeValue1:function(d,c){d.startsWith("{")&&d.endsWith("}")?c.valueObj.value1=d:d.startsWith("'{")&&d.endsWith("}'")?c.valueObj.value1=d.substring(1,d.length-1):"date"===c.fieldObj.shortType?d.startsWith("'")&&d.endsWith("'")?(d=d.substring(1,d.length-1),c.valueObj.value1=this.parseDate(d)):(c.valueObj.value1=d,c.valueObj.type="field"):(c.valueObj.value1=d,isNaN(d)&&(c.valueObj.type="field"))},
storeValue2:function(d,c){d.startsWith("{")&&d.endsWith("}")?c.valueObj.value2=d:d.startsWith("'{")&&d.endsWith("}'")?c.valueObj.value2=d.substring(1,d.length-1):"date"===c.fieldObj.shortType?d.startsWith("'")&&d.endsWith("'")?(d=d.substring(1,d.length-1),c.valueObj.value2=this.parseDate(d)):(c.valueObj.value2=d,c.valueObj.type="field"):(c.valueObj.value2=d,isNaN(d)&&(c.valueObj.type="field"))},parseDate:function(d){var c=w.parse(d,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});c||(c=w.parse(d.replace(" ",
", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(c=w.parse(d.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return c}});n.VIRTUAL_DATE_CUSTOM="custom";n.VIRTUAL_DATE_TODAY="today";n.VIRTUAL_DATE_YESTERDAY="yesterday";n.VIRTUAL_DATE_TOMORROW="tomorrow";n.VIRTUAL_DATE_THIS_WEEK="thisWeek";n.VIRTUAL_DATE_THIS_MONTH="thisMonth";n.VIRTUAL_DATE_THIS_QUARTER="thisQuarter";n.VIRTUAL_DATE_THIS_YEAR="thisYear";n.isAskForValues=function(d){var c=!1;return c=A.some(d.parts,
function(g){return g.parts?A.some(g.parts,function(b){return!!b.interactiveObj}):!!g.interactiveObj})};n.hasVirtualDate=function(d){var c=!1;return c=A.some(d.parts,function(g){return g.parts?A.some(g.parts,function(b){return!!b.valueObj.virtualDate||!!b.valueObj.virtualDate1||!!b.valueObj.virtualDate2}):!!g.valueObj.virtualDate||!!g.valueObj.virtualDate1||!!g.valueObj.virtualDate2})};n.getRealDateByVirtualDate=function(d){var c=null,g=new Date,b=g.getTime();switch(d){case n.VIRTUAL_DATE_TODAY:c=
g;break;case n.VIRTUAL_DATE_YESTERDAY:c=new Date(b-864E5);break;case n.VIRTUAL_DATE_TOMORROW:c=new Date(b+864E5);break;case n.VIRTUAL_DATE_THIS_WEEK:c=[k().startOf("week").toDate(),k().endOf("week").toDate()];break;case n.VIRTUAL_DATE_THIS_MONTH:c=[k().startOf("month").toDate(),k().endOf("month").toDate()];break;case n.VIRTUAL_DATE_THIS_QUARTER:c=[k().startOf("quarter").toDate(),k().endOf("quarter").toDate()];break;case n.VIRTUAL_DATE_THIS_YEAR:c=[k().startOf("year").toDate(),k().endOf("year").toDate()]}return c};
n.TIMEZONE_DATA={"Dateline Standard Time":{id:0,offset:-12,displayName:"(UTC-12:00) International Date Line West"},"UTC-11":{id:110,offset:-11,displayName:"(UTC-11:00) Coordinated Universal Time -11"},"Hawaiian Standard Time":{id:200,offset:-10,displayName:"(UTC-10:00) Hawaii"},"Alaskan Standard Time":{id:300,offset:-9,displayName:"(UTC-09:00) Alaska"},"Pacific Standard Time":{id:400,offset:-8,displayName:"(UTC-08:00) Pacific Time (US and Canada)"},"Pacific Standard Time (Mexico)":{id:410,offset:-8,
displayName:"(UTC-08:00)Baja California"},"Mountain Standard Time":{id:500,offset:-7,displayName:"(UTC-07:00) Mountain Time (US and Canada)"},"Mountain Standard Time (Mexico)":{id:510,offset:-7,displayName:"(UTC-07:00) Chihuahua, La Paz, Mazatlan"},"US Mountain Standard Time":{id:520,offset:-7,displayName:"(UTC-07:00) Arizona"},"Canada Central Standard Time":{id:600,offset:-6,displayName:"(UTC-06:00) Saskatchewan"},"Central America Standard Time":{id:610,offset:-6,displayName:"(UTC-06:00) Central America"},
"Central Standard Time":{id:620,offset:-6,displayName:"(UTC-06:00) Central Time (US and Canada)"},"Central Standard Time (Mexico)":{id:630,offset:-6,displayName:"((UTC-06:00) Guadalajara, Mexico City, Monterrey"},"Eastern Standard Time":{id:700,offset:-5,displayName:"(UTC-05:00) Eastern Time (US and Canada)"},"SA Pacific Standard Time":{id:710,offset:-5,displayName:"(UTC-05:00) Bogota, Lima, Quito"},"US Eastern Standard Time":{id:720,offset:-5,displayName:"(UTC-05:00) Indiana (East)"},"Venezuela Standard Time":{id:840,
offset:-3.5,displayName:"(UTC-04:30) Caracas"},"Atlantic Standard Time":{id:800,offset:-4,displayName:"(UTC-04:00) Atlantic Time (Canada)"},"Central Brazilian Standard Time":{id:810,offset:-4,displayName:"(UTC-04:00) Cuiaba"},"Pacific SA Standard Time":{id:820,offset:-4,displayName:"(UTC-04:00) Santiago"},"SA Western Standard Time":{id:830,offset:-4,displayName:"(UTC-04:00) Georgetown, La Paz, Manaus, San Juan"},"Paraguay Standard Time":{id:850,offset:-4,displayName:"(UTC-04:00) Asuncion"},"Newfoundland Standard Time":{id:900,
offset:-2.5,displayName:"(UTC-03:30) Newfoundland"},"E. South America Standard Time":{id:910,offset:-3,displayName:"(UTC-03:00) Brasilia"},"Greenland Standard Time":{id:920,offset:-3,displayName:"(UTC-03:00) Greenland"},"Montevideo Standard Time":{id:930,offset:-3,displayName:"(UTC-03:00) Montevideo"},"SA Eastern Standard Time":{id:940,offset:-3,displayName:"(UTC-03:00) Cayenne, Fortaleza"},"Argentina Standard Time":{id:950,offset:-3,displayName:"(UTC-03:00) Buenos Aires"},"Mid-Atlantic Standard Time":{id:1E3,
offset:-2,displayName:"(UTC-02:00) Mid-Atlantic"},"UTC-2":{id:1010,offset:-2,displayName:"(UTC-02:00) Coordinated Universal Time -02"},"Azores Standard Time":{id:1100,offset:-1,displayName:"(UTC-01:00) Azores"},"Cabo Verde Standard Time":{id:1110,offset:-1,displayName:"(UTC-01:00) Cabo Verde Is."},"GMT Standard Time":{id:1200,offset:0,displayName:"(UTC) Dublin, Edinburgh, Lisbon, London"},"Greenwich Standard Time":{id:1210,offset:0,displayName:"(UTC) Monrovia, Reykjavik"},"Morocco Standard Time":{id:1220,
offset:0,displayName:"(UTC) Casablanca"},UTC:{id:1230,offset:0,displayName:"(UTC) Coordinated Universal Time"},"Central Europe Standard Time":{id:1300,offset:1,displayName:"(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague"},"Central European Standard Time":{id:1310,offset:1,displayName:"(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb"},"Romance Standard Time":{id:1320,offset:1,displayName:"(UTC+01:00) Brussels, Copenhagen, Madrid, Paris"},"W. Central Africa Standard Time":{id:1330,offset:1,
displayName:"(UTC+01:00) West Central Africa"},"W. Europe Standard Time":{id:1340,offset:1,displayName:"(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna"},"Namibia Standard Time":{id:1350,offset:1,displayName:"(UTC+01:00) Windhoek"},"E. Europe Standard Time":{id:1400,offset:2,displayName:"(UTC+02:00) Minsk"},"Egypt Standard Time":{id:1410,offset:2,displayName:"(UTC+02:00) Cairo"},"FLE Standard Time":{id:1420,offset:2,displayName:"(UTC+02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius"},
"GTB Standard Time":{id:1430,offset:2,displayName:"(UTC+02:00) Athens, Bucharest"},"Israel Standard Time":{id:1440,offset:2,displayName:"(UTC+02:00) Jerusalem"},"Jordan Standard Time":{id:1450,offset:2,displayName:"(UTC+02:00) Amman"},"Middle East Standard Time":{id:1460,offset:2,displayName:"(UTC+02:00) Beirut"},"South Africa Standard Time":{id:1470,offset:2,displayName:"(UTC+02:00) Harare, Pretoria"},"Syria Standard Time":{id:1480,offset:2,displayName:"(UTC+02:00) Damascus"},"Turkey Standard Time":{id:1490,
offset:2,displayName:"(UTC+02:00) Istanbul"},"Arab Standard Time":{id:1500,offset:3,displayName:"(UTC+03:00) Kuwait, Riyadh"},"Arabic Standard Time":{id:1510,offset:3,displayName:"(UTC+03:00) Baghdad"},"E. Africa Standard Time":{id:1520,offset:3,displayName:"(UTC+03:00) Nairobi"},"Kaliningrad Standard Time":{id:1530,offset:3,displayName:"(UTC+03:00) Kaliningrad"},"Iran Standard Time":{id:1550,offset:3.5,displayName:"(UTC+03:30) Tehran"},"Russian Standard Time":{id:1540,offset:4,displayName:"(UTC+04:00) Moscow, St. Petersburg, Volgograd"},
"Arabian Standard Time":{id:1600,offset:4,displayName:"(UTC+04:00) Abu Dhabi, Muscat"},"Azerbaijan Standard Time":{id:1610,offset:4,displayName:"(UTC+04:00) Baku"},"Caucasus Standard Time":{id:1620,offset:4,displayName:"(UTC+04:00) Yerevan"},"Georgian Standard Time":{id:1640,offset:4,displayName:"(UTC+04:00) Tbilisi"},"Mauritius Standard Time":{id:1650,offset:4,displayName:"(UTC+04:00) Port Louis"},"Afghanistan Standard Time":{id:1630,offset:4.5,displayName:"(UTC+04:30) Kabul"},"West Asia Standard Time":{id:1710,
offset:5,displayName:"(UTC+05:00) Tashkent"},"Pakistan Standard Time":{id:1750,offset:5,displayName:"(UTC+05:00) Islamabad, Karachi"},"India Standard Time":{id:1720,offset:5.5,displayName:"(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi"},"Sri Lanka Standard Time":{id:1730,offset:5.5,displayName:"(UTC+05:30) Sri Jayawardenepura"},"Nepal Standard Time":{id:1740,offset:5,displayName:"(UTC+05:45) Kathmandu"},"Ekaterinburg Standard Time":{id:1700,offset:6,displayName:"(UTC+06:00) Ekaterinburg"},"Central Asia Standard Time":{id:1800,
offset:6,displayName:"(UTC+06:00) Astana"},"Bangladesh Standard Time":{id:1830,offset:6,displayName:"(UTC+06:00) Dhaka"},"Myanmar Standard Time":{id:1820,offset:6.5,displayName:"(UTC+06:30) Yangon (Rangoon)"},"N. Central Asia Standard Time":{id:1810,offset:7,displayName:"(UTC+07:00) Novosibirsk"},"SE Asia Standard Time":{id:1910,offset:7,displayName:"(UTC+07:00) Bangkok, Hanoi, Jakarta"},"North Asia Standard Time":{id:1900,offset:8,displayName:"(UTC+08:00) Krasnoyarsk"},"China Standard Time":{id:2E3,
offset:8,displayName:"(UTC+08:00) Beijing, Chongqing, Hong Kong, Urumqi"},"Singapore Standard Time":{id:2020,offset:8,displayName:"(UTC+08:00) Kuala Lumpur, Singapore"},"Taipei Standard Time":{id:2030,offset:8,displayName:"(UTC+08:00) Taipei"},"W. Australia Standard Time":{id:2040,offset:8,displayName:"(UTC+08:00) Perth"},"Ulaanbaatar Standard Time":{id:2050,offset:8,displayName:"(UTC+08:00) Ulaanbaatar"},"North Asia East Standard Time":{id:2010,offset:9,displayName:"(UTC+09:00) Irkutsk"},"Korea Standard Time":{id:2100,
offset:9,displayName:"(UTC+09:00) Seoul"},"Tokyo Standard Time":{id:2110,offset:9,displayName:"(UTC+09:00) Osaka, Sapporo, Tokyo"},"AUS Central Standard Time":{id:2130,offset:9.5,displayName:"(UTC+09:30) Darwin"},"Cen. Australia Standard Time":{id:2140,offset:9.5,displayName:"(UTC+09:30) Adelaide"},"Yakutsk Standard Time":{id:2120,offset:10,displayName:"(UTC+10:00) Yakutsk"},"AUS Eastern Standard Time":{id:2200,offset:10,displayName:"(UTC+10:00) Canberra, Melbourne, Sydney"},"E. Australia Standard Time":{id:2210,
offset:10,displayName:"(UTC+10:00) Brisbane"},"Tasmania Standard Time":{id:2220,offset:10,displayName:"(UTC+10:00) Hobart"},"West Pacific Standard Time":{id:2240,offset:10,displayName:"(UTC+10:00) Guam, Port Moresby"},"Vladivostok Standard Time":{id:2230,offset:11,displayName:"(UTC+11:00) Vladivostok"},"Central Pacific Standard Time":{id:2300,offset:11,displayName:"(UTC+11:00) Solomon Is., New Caledonia"},"Magadan Standard Time":{id:2310,offset:12,displayName:"(UTC+12:00) Magadan"},"Fiji Standard Time":{id:2400,
offset:12,displayName:"(UTC+12:00) Fiji"},"New Zealand Standard Time":{id:2410,offset:12,displayName:"(UTC+12:00) Auckland, Wellington"},"UTC+12":{id:2430,offset:12,displayName:"(UTC+12:00) Coordinated Universal Time +12"},"Tonga Standard Time":{id:2500,offset:13,displayName:"(UTC+13:00) Nuku'alofa"},"Samoa Standard Time":{id:2510,offset:-11,displayName:"(UTC-11:00)Samoa"}};return n})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),
function(E,q,A,w,m,v,r){return q("dojo.data.ItemFileWriteStore",v,{constructor:function(l){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};this._datatypeMap.Date.serialize||(this._datatypeMap.Date.serialize=function(k){return r.toISOString(k,{zulu:!0})});l&&!1===l.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(l){if(!l)throw Error("assertion failed in ItemFileWriteStore");
},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},newItem:function(l,k){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=typeof l&&"undefined"!=typeof l)throw Error("newItem() was passed something other than an object");var n=null,d=this._getIdentifierAttribute();if(d===Number)n=this._arrayOfAllItems.length;else{n=l[d];if("undefined"===typeof n)throw Error("newItem() was not passed an identity for the new item");if(E.isArray(n))throw Error("newItem() was not passed an single-valued identity");
}this._itemsByIdentity&&this._assert("undefined"===typeof this._itemsByIdentity[n]);this._assert("undefined"===typeof this._pending._newItems[n]);this._assert("undefined"===typeof this._pending._deletedItems[n]);var c={};c[this._storeRefPropName]=this;c[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[n]=c,c[d]=[n]);this._arrayOfAllItems.push(c);d=null;if(k&&k.parent&&k.attribute){d={item:k.parent,attribute:k.attribute,oldValue:void 0};var g=this.getValues(k.parent,
k.attribute);if(g&&0<g.length){var b=g.slice(0,g.length);d.oldValue=1===g.length?g[0]:g.slice(0,g.length);b.push(c);this._setValueOrValues(k.parent,k.attribute,b,!1);d.newValue=this.getValues(k.parent,k.attribute)}else this._setValueOrValues(k.parent,k.attribute,c,!1),d.newValue=c}else c[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(c);this._pending._newItems[n]=c;for(var e in l){if(e===this._storeRefPropName||e===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");
k=l[e];E.isArray(k)||(k=[k]);c[e]=k;if(this.referenceIntegrity)for(n=0;n<k.length;n++)g=k[n],this.isItem(g)&&this._addReferenceToMap(g,c,e)}this.onNew(c,d);return c},_removeArrayElement:function(l,k){k=A.indexOf(l,k);return-1!=k?(l.splice(k,1),!0):!1},deleteItem:function(l){this._assert(!this._saveInProgress);this._assertIsItem(l);var k=l[this._itemNumPropName],n=this.getIdentity(l);if(this.referenceIntegrity){var d=this.getAttributes(l);l[this._reverseRefMap]&&(l["backup_"+this._reverseRefMap]=E.clone(l[this._reverseRefMap]));
A.forEach(d,function(f){A.forEach(this.getValues(l,f),function(h){this.isItem(h)&&(l["backupRefs_"+this._reverseRefMap]||(l["backupRefs_"+this._reverseRefMap]=[]),l["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(h),attr:f}),this._removeReferenceFromMap(h,l,f))},this)},this);if(d=l[this._reverseRefMap])for(var c in d){var g=null;if(g=this._itemsByIdentity?this._itemsByIdentity[c]:this._arrayOfAllItems[c])for(var b in d[c]){var e=this.getValues(g,b)||[],a=A.filter(e,function(f){return!(this.isItem(f)&&
this.getIdentity(f)==n)},this);this._removeReferenceFromMap(l,g,b);a.length<e.length&&this._setValueOrValues(g,b,a,!0)}}}this._arrayOfAllItems[k]=null;l[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[n];this._pending._deletedItems[n]=l;l[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,l);this.onDelete(l);return!0},setValue:function(l,k,n){return this._setValueOrValues(l,k,n,!0)},setValues:function(l,k,n){return this._setValueOrValues(l,
k,n,!0)},unsetAttribute:function(l,k){return this._setValueOrValues(l,k,[],!0)},_setValueOrValues:function(l,k,n,d){this._assert(!this._saveInProgress);this._assertIsItem(l);this._assert(E.isString(k));this._assert("undefined"!==typeof n);var c=this._getIdentifierAttribute();if(k==c)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");c=this._getValueOrValues(l,k);var g=this.getIdentity(l);if(!this._pending._modifiedItems[g]){var b={};for(e in l)b[e]=
e===this._storeRefPropName||e===this._itemNumPropName||e===this._rootItemPropName?l[e]:e===this._reverseRefMap?E.clone(l[e]):l[e].slice(0,l[e].length);this._pending._modifiedItems[g]=b}g=!1;if(E.isArray(n)&&0===n.length){if(g=delete l[k],n=void 0,this.referenceIntegrity&&c){var e=c;E.isArray(e)||(e=[e]);for(var a=0;a<e.length;a++)b=e[a],this.isItem(b)&&this._removeReferenceFromMap(b,l,k)}}else{g=E.isArray(n)?n.slice(0,n.length):[n];if(this.referenceIntegrity)if(c){e=c;E.isArray(e)||(e=[e]);var f=
{};A.forEach(e,function(h){this.isItem(h)&&(h=this.getIdentity(h),f[h.toString()]=!0)},this);A.forEach(g,function(h){if(this.isItem(h)){var p=this.getIdentity(h);f[p.toString()]?delete f[p.toString()]:this._addReferenceToMap(h,l,k)}},this);for(a in f)this._removeReferenceFromMap(this._itemsByIdentity?this._itemsByIdentity[a]:this._arrayOfAllItems[a],l,k)}else for(a=0;a<g.length;a++)b=g[a],this.isItem(b)&&this._addReferenceToMap(b,l,k);l[k]=g;g=!0}if(d)this.onSet(l,k,c,n);return g},_addReferenceToMap:function(l,
k,n){k=this.getIdentity(k);var d=l[this._reverseRefMap];d||(d=l[this._reverseRefMap]={});(l=d[k])||(l=d[k]={});l[n]=!0},_removeReferenceFromMap:function(l,k,n){k=this.getIdentity(k);var d=l[this._reverseRefMap],c;if(d){for(c in d)c==k&&(delete d[c][n],this._isEmpty(d[c])&&delete d[c]);this._isEmpty(d)&&delete l[this._reverseRefMap]}},_dumpReferenceMap:function(){var l;for(l=0;l<this._arrayOfAllItems.length;l++){var k=this._arrayOfAllItems[l];k&&k[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(k)+
"] is referenced by: "+w.toJson(k[this._reverseRefMap]))}},_getValueOrValues:function(l,k){var n=void 0;this.hasAttribute(l,k)&&(l=this.getValues(l,k),n=1==l.length?l[0]:l);return n},_flatten:function(l){if(this.isItem(l))return{_reference:this.getIdentity(l)};if("object"===typeof l)for(var k in this._datatypeMap){var n=this._datatypeMap[k];if(E.isObject(n)&&!E.isFunction(n)){if(l instanceof n.type){if(!n.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+k+"]");
return{_type:k,_value:n.serialize(l)}}}else if(l instanceof n)return{_type:k,_value:l.toString()}}return l},_getNewFileContentString:function(){var l={},k=this._getIdentifierAttribute();k!==Number&&(l.identifier=k);this._labelAttr&&(l.label=this._labelAttr);l.items=[];for(k=0;k<this._arrayOfAllItems.length;++k){var n=this._arrayOfAllItems[k];if(null!==n){var d={},c;for(c in n)if(c!==this._storeRefPropName&&c!==this._itemNumPropName&&c!==this._reverseRefMap&&c!==this._rootItemPropName){var g=this.getValues(n,
c);if(1==g.length)d[c]=this._flatten(g[0]);else for(var b=[],e=0;e<g.length;++e)b.push(this._flatten(g[e])),d[c]=b}l.items.push(d)}}return w.toJson(l,!0)},_isEmpty:function(l){var k=!0;if(E.isObject(l))for(var n in l){k=!1;break}else E.isArray(l)&&0<l.length&&(k=!1);return k},save:function(l){this._assert(!this._saveInProgress);this._saveInProgress=!0;var k=this,n=function(){k._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};k._saveInProgress=!1;l&&l.onComplete&&l.onComplete.call(l.scope||
m.global)},d=function(g){k._saveInProgress=!1;l&&l.onError&&l.onError.call(l.scope||m.global,g)};if(this._saveEverything){var c=this._getNewFileContentString();this._saveEverything(n,d,c)}this._saveCustom&&this._saveCustom(n,d);this._saveEverything||this._saveCustom||n()},revert:function(){this._assert(!this._saveInProgress);for(var l in this._pending._modifiedItems){var k=this._pending._modifiedItems[l],n=null;n=this._itemsByIdentity?this._itemsByIdentity[l]:this._arrayOfAllItems[l];k[this._storeRefPropName]=
this;for(var d in n)delete n[d];E.mixin(n,k)}for(l in this._pending._deletedItems){var c=this._pending._deletedItems[l];c[this._storeRefPropName]=this;k=c[this._itemNumPropName];c["backup_"+this._reverseRefMap]&&(c[this._reverseRefMap]=c["backup_"+this._reverseRefMap],delete c["backup_"+this._reverseRefMap]);this._arrayOfAllItems[k]=c;this._itemsByIdentity&&(this._itemsByIdentity[l]=c);c[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(c)}for(l in this._pending._deletedItems)c=this._pending._deletedItems[l],
c["backupRefs_"+this._reverseRefMap]&&(A.forEach(c["backupRefs_"+this._reverseRefMap],function(g){this._addReferenceToMap(this._itemsByIdentity?this._itemsByIdentity[g.id]:this._arrayOfAllItems[g.id],c,g.attr)},this),delete c["backupRefs_"+this._reverseRefMap]);for(l in this._pending._newItems)k=this._pending._newItems[l],k[this._storeRefPropName]=null,this._arrayOfAllItems[k[this._itemNumPropName]]=null,k[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,k),this._itemsByIdentity&&
delete this._itemsByIdentity[l];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(l){return l?(l=this.getIdentity(l),(new Boolean(this._pending._newItems[l]||this._pending._modifiedItems[l]||this._pending._deletedItems[l])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},onSet:function(l,k,n,d){},onNew:function(l,k){},onDelete:function(l){},close:function(l){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");
this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),function(E,q,A,w,m,v,r,l,k){A=A("dojo.data.ItemFileReadStore",[v],{constructor:function(n){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=n.url;this._jsonData=n.data;this.data=null;this._datatypeMap=n.typeMap||
{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(d){return k.fromISOString(d)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName="_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==n.urlPreventCache&&(this.urlPreventCache=n.urlPreventCache?!0:!1);void 0!==n.hierarchical&&(this.hierarchical=n.hierarchical?
!0:!1);n.clearOnClose&&(this.clearOnClose=!0);"failOk"in n&&(this.failOk=n.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(n){if(!this.isItem(n))throw Error(this.declaredClass+": Invalid item argument.");},_assertIsAttribute:function(n){if("string"!==typeof n)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(n,d,c){n=this.getValues(n,d);return 0<n.length?n[0]:c},getValues:function(n,
d){this._assertIsItem(n);this._assertIsAttribute(d);return(n[d]||[]).slice(0)},getAttributes:function(n){this._assertIsItem(n);var d=[],c;for(c in n)c!==this._storeRefPropName&&c!==this._itemNumPropName&&c!==this._rootItemPropName&&c!==this._reverseRefMap&&d.push(c);return d},hasAttribute:function(n,d){this._assertIsItem(n);this._assertIsAttribute(d);return d in n},containsValue:function(n,d,c){var g=void 0;"string"===typeof c&&(g=r.patternToRegExp(c,!1));return this._containsValue(n,d,c,g)},_containsValue:function(n,
d,c,g){return w.some(this.getValues(n,d),function(b){if(null!==b&&!q.isObject(b)&&g){if(b.toString().match(g))return!0}else if(c===b)return!0})},isItem:function(n){return n&&n[this._storeRefPropName]===this&&this._arrayOfAllItems[n[this._itemNumPropName]]===n?!0:!1},isItemLoaded:function(n){return this.isItem(n)},loadItem:function(n){this._assertIsItem(n.item)},getFeatures:function(){return this._features},getLabel:function(n){if(this._labelAttr&&this.isItem(n))return this.getValue(n,this._labelAttr)},
getLabelAttributes:function(n){return this._labelAttr?[this._labelAttr]:null},filter:function(n,d,c){var g=[];if(n.query){var b=n.queryOptions?n.queryOptions.ignoreCase:!1;var e={};for(p in n.query){var a=n.query[p];"string"===typeof a?e[p]=r.patternToRegExp(a,b):a instanceof RegExp&&(e[p]=a)}for(b=0;b<d.length;++b){var f=!0,h=d[b];if(null===h)f=!1;else for(p in n.query)a=n.query[p],this._containsValue(h,p,a,e[p])||(f=!1);f&&g.push(h)}}else for(b=0;b<d.length;++b){var p=d[b];null!==p&&g.push(p)}c(g,
n)},_fetchItems:function(n,d,c){var g=this;if(this._loadFinished)this.filter(n,this._getItemsArray(n.queryOptions),d);else if(this._jsonFileUrl!==this._ccUrl?(E.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:n,
filter:q.hitch(g,"filter"),findCallback:q.hitch(g,d)});else{this._loadInProgress=!0;var b=m.get({url:g._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});b.addCallback(function(a){try{g._getItemsFromLoadedData(a),g._loadFinished=!0,g._loadInProgress=!1,g.filter(n,g._getItemsArray(n.queryOptions),d),g._handleQueuedFetches()}catch(f){g._loadFinished=!0,g._loadInProgress=!1,c(f,n)}});b.addErrback(function(a){g._loadInProgress=!1;c(a,n)});var e=null;n.abort&&
(e=n.abort);n.abort=function(){var a=b;a&&-1===a.fired&&(a.cancel(),a=null);e&&e.call(n)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,g.filter(n,this._getItemsArray(n.queryOptions),d)}catch(a){c(a,n)}else c(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),n)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var n=0;n<this._queuedFetches.length;n++){var d=
this._queuedFetches[n],c=d.args,g=d.filter;d=d.findCallback;g?g(c,this._getItemsArray(c.queryOptions),d):this.fetchItemByIdentity(c)}this._queuedFetches=[]}},_getItemsArray:function(n){return n&&n.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(n){this.clearOnClose&&this._loadFinished&&!this._loadInProgress&&(""!=this._jsonFileUrl&&null!=this._jsonFileUrl||""!=this.url&&null!=this.url||null!=this.data||console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),
this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(n){function d(x){return null!==x&&"object"===typeof x&&(!q.isArray(x)||g)&&!q.isFunction(x)&&(x.constructor==Object||q.isArray(x))&&"undefined"===typeof x._reference&&"undefined"===typeof x._type&&"undefined"===typeof x._value&&b.hierarchical}function c(x){b._arrayOfAllItems.push(x);for(var y in x){var D=x[y];if(D)if(q.isArray(D))for(var H=
0;H<D.length;++H){var I=D[H];d(I)&&c(I)}else d(D)&&c(D)}}var g=!1,b=this;this._labelAttr=n.label;var e;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=n.items;for(e=0;e<this._arrayOfTopLevelItems.length;++e){var a=this._arrayOfTopLevelItems[e];q.isArray(a)&&(g=!0);c(a);a[this._rootItemPropName]=!0}var f={},h;for(e=0;e<this._arrayOfAllItems.length;++e)for(h in a=this._arrayOfAllItems[e],a){if(h!==this._rootItemPropName){var p=a[h];null!==p?q.isArray(p)||(a[h]=[p]):a[h]=[null]}f[h]=h}for(;f[this._storeRefPropName];)this._storeRefPropName+=
"_";for(;f[this._itemNumPropName];)this._itemNumPropName+="_";for(;f[this._reverseRefMap];)this._reverseRefMap+="_";if(f=n.identifier)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=f,e=0;e<this._arrayOfAllItems.length;++e)if(a=this._arrayOfAllItems[e],n=a[f],n=n[0],Object.hasOwnProperty.call(this._itemsByIdentity,n)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+
f+"].  Value collided: ["+n+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+f+"].  Value collided: ["+n+"]");}else this._itemsByIdentity[n]=a;else this._features["dojo.data.api.Identity"]=Number;for(e=0;e<this._arrayOfAllItems.length;++e)a=this._arrayOfAllItems[e],a[this._storeRefPropName]=this,a[this._itemNumPropName]=e;for(e=0;e<this._arrayOfAllItems.length;++e)for(h in a=this._arrayOfAllItems[e],
a)for(n=a[h],f=0;f<n.length;++f)if(p=n[f],null!==p&&"object"==typeof p){if("_type"in p&&"_value"in p){var B=p._type,u=this._datatypeMap[B];if(u)if(q.isFunction(u))n[f]=new u(p._value);else if(q.isFunction(u.deserialize))n[f]=u.deserialize(p._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+
B+"'");}if(p._reference){p=p._reference;if(q.isObject(p))for(B=0;B<this._arrayOfAllItems.length;++B){u=this._arrayOfAllItems[B];var t=!0,z;for(z in p)u[z]!=p[z]&&(t=!1);t&&(n[f]=u)}else n[f]=this._getItemByIdentity(p);this.referenceIntegrity&&(p=n[f],this.isItem(p)&&this._addReferenceToMap(p,a,h))}else this.isItem(p)&&this.referenceIntegrity&&this._addReferenceToMap(p,a,h)}},_addReferenceToMap:function(n,d,c){},getIdentity:function(n){var d=this._features["dojo.data.api.Identity"];return d===Number?
n[this._itemNumPropName]:(n=n[d])?n[0]:null},fetchItemByIdentity:function(n){if(this._loadFinished){var d=this._getItemByIdentity(n.identity);if(n.onItem){var c=n.scope?n.scope:E.global;n.onItem.call(c,d)}}else{var g=this;this._jsonFileUrl!==this._ccUrl?(E.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=
this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:n}):(this._loadInProgress=!0,c=m.get({url:g._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),c.addCallback(function(b){var e=n.scope?n.scope:E.global;try{g._getItemsFromLoadedData(b),g._loadFinished=!0,g._loadInProgress=!1,d=g._getItemByIdentity(n.identity),n.onItem&&n.onItem.call(e,d),g._handleQueuedFetches()}catch(a){g._loadInProgress=
!1,n.onError&&n.onError.call(e,a)}}),c.addErrback(function(b){g._loadInProgress=!1;n.onError&&n.onError.call(n.scope?n.scope:E.global,b)})):this._jsonData&&(g._getItemsFromLoadedData(g._jsonData),g._jsonData=null,g._loadFinished=!0,d=g._getItemByIdentity(n.identity),n.onItem&&(c=n.scope?n.scope:E.global,n.onItem.call(c,d)))}},_getItemByIdentity:function(n){var d=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,n)&&(d=this._itemsByIdentity[n]):Object.hasOwnProperty.call(this._arrayOfAllItems,
n)&&(d=this._arrayOfAllItems[n]);void 0===d&&(d=null);return d},getIdentityAttributes:function(n){n=this._features["dojo.data.api.Identity"];return n===Number?null:[n]},_forceLoad:function(){var n=this;this._jsonFileUrl!==this._ccUrl?(E.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=
this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var d=m.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:!0});d.addCallback(function(c){try{if(!0!==n._loadInProgress&&!n._loadFinished)n._getItemsFromLoadedData(c),n._loadFinished=!0;else if(n._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(g){throw console.log(g),g;}});d.addErrback(function(c){throw c;
})}else this._jsonData&&(n._getItemsFromLoadedData(n._jsonData),n._jsonData=null,n._loadFinished=!0)}});q.extend(A,l);return A})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(E){var q={};E.setObject("dojo.data.util.filter",q);q.patternToRegExp=function(A,w){for(var m="^",v=null,r=0;r<A.length;r++)switch(v=A.charAt(r),v){case "\\":m+=v;r++;m+=A.charAt(r);break;case "*":m+=".*";break;case "?":m+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":m+=
"\\";default:m+=v}m+="$";return w?new RegExp(m,"mi"):new RegExp(m,"m")};return q})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(E,q,A){var w={};E.setObject("dojo.data.util.simpleFetch",w);w.errorHandler=function(m,v){v.onError&&v.onError.call(v.scope||q.global,m,v)};w.fetchHandler=function(m,v){var r=v.abort||null,l=!1,k=v.start?v.start:0,n=v.count&&Infinity!==v.count?k+v.count:m.length;v.abort=function(){l=!0;r&&r.call(v)};var d=v.scope||
q.global;v.store||(v.store=this);v.onBegin&&v.onBegin.call(d,m.length,v);v.sort&&m.sort(A.createSortFunction(v.sort,this));if(v.onItem)for(var c=k;c<m.length&&c<n;++c){var g=m[c];l||v.onItem.call(d,g,v)}v.onComplete&&!l&&(c=null,v.onItem||(c=m.slice(k,n)),v.onComplete.call(d,c,v))};w.fetch=function(m){m=m||{};m.store||(m.store=this);this._fetchItems(m,E.hitch(this,"fetchHandler"),E.hitch(this,"errorHandler"));return m};return w})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(E){var q=
{};E.setObject("dojo.data.util.sorter",q);q.basicComparator=function(A,w){var m=-1;null===A&&(A=void 0);null===w&&(w=void 0);if(A==w)m=0;else if(A>w||null==A)m=1;return m};q.createSortFunction=function(A,w){function m(g,b,e,a){return function(f,h){f=a.getValue(f,g);h=a.getValue(h,g);return b*e(f,h)}}for(var v=[],r,l=w.comparatorMap,k=q.basicComparator,n=0;n<A.length;n++){r=A[n];var d=r.attribute;if(d){r=r.descending?-1:1;var c=k;l&&("string"!==typeof d&&"toString"in d&&(d=d.toString()),c=l[d]||k);
v.push(m(d,r,c,w))}}return function(g,b){for(var e=0;e<v.length;){var a=v[e++](g,b);if(0!==a)return a}return 0}};return q})},"jimu/Query":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/Deferred jimu/utils jimu/ServiceDefinitionManager esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet".split(" "),function(E,q,A,w,m,v,r,l,k,n){var d=E(null,{queryType:0,nextPageIndex:1,pageSizeOption:null,layerDefinition:null,layerDefinitionDef:null,type1CountDef:null,
type2ObjectIdsDef:null,type3QueryDef:null,sdf:null,url:null,query:null,pageSize:1E3,constructor:function(c){this.sdf=r.getInstance();this.url=c.url;this.query=c.query;this.pageSizeOption=c.pageSize;this.query.outFields&&0!==this.query.outFields.length||(this.query.outFields=["*"]);this.pageSize=0<c.pageSize?c.pageSize:1E3;this.getFeatureCount()},getFeatureCount:function(){return this._getQueryType().then(q.hitch(this,function(c){return 1===c?this._getCountForQueryType1():2===c?this._getCountForQueryType2():
this._getCountForQueryType3()}))},getPageCount:function(){return this.getFeatureCount().then(q.hitch(this,function(c){return 0===c?0:Math.ceil(c/this.pageSize)}))},getAllFeatures:function(){return this.getPageCount().then(q.hitch(this,function(c){if(0<c){for(var g=[],b=1;b<=c;b++)g.push(this.queryByPage(b));return w(g).then(q.hitch(this,function(e){for(var a=[],f=0;f<e.length;f++)e[f].features&&0<e[f].features.length&&(a=a.concat(e[f].features));a=this._setOrderByFieldValue(a);e=e[0];e.features=a;
return e}))}this._getEmptyFeatureSet().then(q.hitch(this,function(e){return e}))}))},_setOrderByFieldValue:function(c){if(2===this.queryType||3===this.queryType){var g=this.query.outFields;c.sort(function(b,e){b=b.attributes[g];e=e.attributes[g];return"string"===typeof b&&"string"===typeof e?b.localeCompare(e):b<e?-1:b===e?0:1})}return c},_getEmptyFeatureSet:function(){var c=new m;this.layerDefinition&&this.layerDefinition.geometryType?c.resolve(this._getEmptyFeatureSetHandler()):this._getLayerDefinition().then(q.hitch(this,
function(){c.resolve(this._getEmptyFeatureSetHandler())}));return c},_getEmptyFeatureSetHandler:function(){var c=new n;c.features=[];c.geometryType=this.layerDefinition.geometryType;c.fields=[];var g=q.clone(this.layerDefinition.fields);0<=this.query.outFields.indexOf("*")?c.fields=g:c.fields=A.filter(g,q.hitch(this,function(b){return 0<=this.query.outFields.indexOf(b.name)}));return c},getCurrentPageIndex:function(){return this.nextPageIndex},queryNextPage:function(){var c=this.nextPageIndex;this.nextPageIndex++;
return this.queryByPage(c)},queryByPage:function(c){var g=null;0>=c?(g=new m,this._getEmptyFeatureSet().then(q.hitch(this,function(b){g.resolve(b)}))):g=this.getPageCount().then(q.hitch(this,function(b){c>b&&this._getEmptyFeatureSet().then(q.hitch(this,function(e){return e}));return 1===this.queryType?this._queryPageForType1(c):2===this.queryType?this._queryPageForType2(c):this._queryPageForType3(c)}));return g},_getQueryType:function(){var c=new m;if(0<this.queryType)c.resolve(this.queryType);else return this._getLayerDefinition().then(q.hitch(this,
function(g){return this.queryType=d.getQueryType(g)}));return c},_getDefStatus:function(c){return c?c.isFulfilled()?c.isResolved()?2:-1:1:0},_getLayerDefinition:function(){0>=this._getDefStatus(this.layerDefinitionDef)&&(this.layerDefinitionDef=this.sdf.getServiceDefinition(this.url).then(q.hitch(this,function(c){this.layerDefinition=c;var g=c.maxRecordCount;0<g&&(!(0<this.pageSizeOption)||this.pageSize>c.maxRecordCount)&&(this.pageSize=g);return this.layerDefinition})));return this.layerDefinitionDef},
_getCountForQueryType1:function(){0>=this._getDefStatus(this.type1CountDef)&&(this.type1CountDef=this._queryCount());return this.type1CountDef},_getCountForQueryType2:function(){return this._getObjectIdsForQueryType2().then(q.hitch(this,function(c){return c.length}))},_getObjectIdsForQueryType2:function(){0>=this._getDefStatus(this.type2ObjectIdsDef)&&(this.type2ObjectIdsDef=this._queryIds());return this.type2ObjectIdsDef},_getCountForQueryType3:function(){return this._doQueryForQueryType3().then(q.hitch(this,
function(c){return(c.features||[]).length}))},_doQueryForQueryType3:function(){0>=this._getDefStatus(this.type3QueryDef)&&(this.type3QueryDef=this._query());return this.type3QueryDef},_queryPageForType1:function(c){return this._queryWithPaginationAndOrder((c-1)*this.pageSize)},_queryPageForType2:function(c){return this._getObjectIdsForQueryType2().then(q.hitch(this,function(g){var b=(c-1)*this.pageSize;g=g.slice(b,b+this.pageSize);return this._queryByObjectIds(g)}))},_queryPageForType3:function(c){return this._doQueryForQueryType3().then(q.hitch(this,
function(g){var b=q.mixin({},g);b.features=[];var e=(c-1)*this.pageSize;b.features=(g.features||[]).slice(e,e+this.pageSize);return b}))},_tryLocaleNumber:function(c){var g=v.localizeNumber(c);if(null===g||void 0===g)g=c;return g},_tryLocaleDate:function(c){var g=v.localizeDate(c);g||(g=c.toLocaleDateString());return g},_getLayerIndexByLayerUrl:function(c){var g=c.lastIndexOf("/");c=c.slice(g+1,c.length);return parseInt(c,10)},_getServiceUrlByLayerUrl:function(c){var g=c.lastIndexOf("/");return c.slice(0,
g)},_isImageServiceLayer:function(c){return-1<c.indexOf("/ImageServer")},_isTable:function(c){return"Table"===c.type},_getObjectIdField:function(){return this.layerDefinition.objectIdField},_query:function(c){var g=new l;g.where=c||this.query.where;g.geometry=this.query.geometry;g.outSpatialReference=this.query.outSpatialReference;g.returnGeometry=this.query.returnGeometry;g.spatialRelationship=this.query.spatialRelationship;g.outFields=this.query.outFields;g.returnDistinctValues=this.query.returnDistinctValues;
return(new k(this.url)).execute(g)},_queryIds:function(){var c=new l;c.where=this.query.where;c.geometry=this.query.geometry;c.returnGeometry=!1;c.spatialRelationship=this.query.spatialRelationship;c.outSpatialReference=this.query.outSpatialReference;return(new k(this.url)).executeForIds(c).then(q.hitch(this,function(g){g||(g=[]);return g}))},_queryByObjectIds:function(c){var g=new m,b=new l;b.returnGeometry=this.query.returnGeometry;b.outSpatialReference=this.query.outSpatialReference;b.spatialRelationship=
this.query.spatialRelationship;b.outFields=this.query.outFields;b.objectIds=c;(new k(this.url)).execute(b).then(q.hitch(this,function(e){g.resolve(e)}),q.hitch(this,function(e){if(400===e.code){var a=this._getObjectIdField(),f="",h=c.length;A.forEach(c,q.hitch(this,function(p,B){f+=a+" \x3d "+p;B!==h-1&&(f+=" OR ")}));this._query(f).then(q.hitch(this,function(p){g.resolve(p)}),q.hitch(this,function(p){g.reject(p)}))}else g.reject(e)}));return g},_queryCount:function(){var c=new l;c.where=this.query.where;
c.geometry=this.query.geometry;c.outSpatialReference=this.query.outSpatialReference;c.spatialRelationship=this.query.spatialRelationship;c.returnGeometry=!1;return(new k(this.url)).executeForCount(c)},_queryWithPaginationAndOrder:function(c){var g=new l;g.where=this.query.where;g.geometry=this.query.geometry;g.outSpatialReference=this.query.outSpatialReference;g.returnGeometry=this.query.returnGeometry;g.spatialRelationship=this.query.spatialRelationship;g.outFields=this.query.outFields;g.returnDistinctValues=
this.query.returnDistinctValues;g.start=c;g.num=this.pageSize;(c=this.query.orderByFields)&&0<c.length&&(g.orderByFields=c,c=A.map(c,q.hitch(this,function(b){return b.split(" ")[0]})),A.forEach(c,q.hitch(this,function(b){0>g.outFields.indexOf(b)&&g.outFields.push(b)})));return(new k(this.url)).execute(g)}});d._isServiceSupportsOrderBy=function(c){var g=!1;c.advancedQueryCapabilities&&c.advancedQueryCapabilities.supportsOrderBy&&(g=!0);return g};d._isServiceSupportsPagination=function(c){var g=!1;
c.advancedQueryCapabilities&&c.advancedQueryCapabilities.supportsPagination&&(g=!0);return g};d._isSupportObjectIds=function(c){var g=0;c=c.currentVersion?c:c.toJson().layerDefinition;c.currentVersion&&(g=parseFloat(c.currentVersion));return 10<=g||c.hasOwnProperty("typeIdField")};d.getQueryType=function(c){var g=-1;return g=d._isServiceSupportsOrderBy(c)&&d._isServiceSupportsPagination(c)?1:d._isSupportObjectIds(c)?2:3};return d})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager",
"./utils"],function(E,q){function A(){this.versions=[{version:"1.0",description:"The version embedded in portal 10.3 final.",upgrader:function(w){return w},compatible:!0},{version:"1.1",description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(w){w.widgetOnScreen&&w.widgetOnScreen.panel&&("themes/FoldableTheme/panels/TitlePanel/Panel"===w.widgetOnScreen.panel.uri||"jimu/BaseWidgetPanel"===w.widgetOnScreen.panel.uri)&&(w.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel");
return w},compatible:!0},{version:"1.2",description:"The version embedded in online3.7.",upgrader:function(w){var m=0;if(w.widgetOnScreen&&w.widgetOnScreen.widgets){var v=!1;for(m=0;m<w.widgetOnScreen.widgets.length;m++)"widgets/Splash/Widget"===w.widgetOnScreen.widgets[m].uri&&(v=!0);v||w.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",version:"1.2"});v=!1;for(m=0;m<w.widgetOnScreen.widgets.length;m++)"widgets/TimeSlider/Widget"===w.widgetOnScreen.widgets[m].uri&&
(v=!0);v||w.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",visible:!1,position:{bottom:55,left:7},version:"1.2"});v=!1;for(m=0;m<w.widgetOnScreen.widgets.length;m++)"widgets/Swipe/Widget"===w.widgetOnScreen.widgets[m].uri&&(v=!0);v||w.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",visible:!1,position:{top:145,left:7},version:"1.2"})}return w},compatible:!0},{version:"1.3",description:"The version embedded in online3.8 \x26 online3.9.",upgrader:function(w){(function(m){q.visitElement(m,
function(r){r.positionRelativeTo&&(r.position?r.position.relativeTo=r.positionRelativeTo:r.position={relativeTo:r.positionRelativeTo},r.panel&&(r.panel.position?r.panel.position.relativeTo=r.panel.positionRelativeTo:r.panel.position={relativeTo:r.panel.positionRelativeTo}))});var v=m.widgetOnScreen;v&&v.panel&&v.panel.positionRelativeTo&&(v.panel.position?v.panel.position.relativeTo=v.panel.positionRelativeTo:v.panel.position={relativeTo:v.panel.positionRelativeTo});(v=m.widgetPool)&&v.panel&&v.panel.positionRelativeTo&&
(v.panel.position?v.panel.position.relativeTo=v.panel.positionRelativeTo:v.panel.position={relativeTo:v.panel.positionRelativeTo})})(w);w.widgetOnScreen&&w.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===w.widgetOnScreen.panel.uri&&(w.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");(function(m){if(m.widgetOnScreen&&m.widgetOnScreen.widgets&&m.theme&&"FoldableTheme"===m.theme.name){var v=null,r=null;if(v=m.widgetOnScreen.widgets[4])void 0!==v.position.top?(v={position:{left:205,top:45}},
r={position:{left:255,top:45}}):(v={position:{left:205,bottom:55}},r={position:{left:255,bottom:55}}),m.widgetOnScreen.widgets.splice(7,0,v,r)}})(w);(function(){var m=0,v=0,r=!1;for(m=0;m<w.widgetOnScreen.widgets.length;m++)if("widgets/Geocoder/Widget"===w.widgetOnScreen.widgets[m].uri){r=!0;break}var l=!1;for(v=0;v<w.widgetOnScreen.widgets.length;v++)if("widgets/Search/Widget"===w.widgetOnScreen.widgets[v].uri){l=!0;break}!l&&r&&(m=w.widgetOnScreen.widgets[m],m.uri="widgets/Search/Widget",m.name=
"Search")})(w);(function(m){var v=0;for(v=m.widgetOnScreen.widgets.length-1;0<=v;v--){var r=m.widgetOnScreen.widgets[v];if("widgets/Swipe/Widget"===r.uri&&!r.closeable&&(m.widgetOnScreen.widgets.splice(v,1),!1!==r.visible)){r.closeable=!0;var l;a:{for(l=l=0;l<m.widgetOnScreen.widgets.length;l++)if(!m.widgetOnScreen.widgets[l].uri)break a;l=-1}0<=l&&(r.position=m.widgetOnScreen.widgets[l].position,m.widgetOnScreen.widgets[l]=r)}"widgets/TimeSlider/Widget"===r.uri&&(!1===r.visible?m.widgetOnScreen.widgets.splice(v,
1):r.closeable=!0)}})(w);w.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",position:{top:5,left:7},version:"1.3"});w.loadingPage||(w.loadingPage={backgroundColor:"#508dca",backgroundImage:{visible:!1},loadingGif:{visible:!0,uri:"configs/loading/images/predefined_loading_1.gif",width:58,height:58}});return w},compatible:!0},{version:"1.4",description:"The version embedded in online3.10.",upgrader:function(w){if(w.theme){var m=w.theme.name;if(("FoldableTheme"===m||"JewelryBoxTheme"===m)&&
w.widgetOnScreen){var v=w.widgetOnScreen.widgets;if(v&&0<v.length){m="themes/"+m+"/widgets/HeaderController/Widget";for(var r=null,l=0;l<v.length;l++)(r=v[l])&&r.uri===m&&r.position&&310===r.position.paddingRight&&(r.position.paddingRight=275)}}}return w},compatible:!0},{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(w){w.keepAppState=!0;return w},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(w){return w},compatible:!0},
{version:"2.0.1",description:"The version for Developer Edition 2.0.",upgrader:function(w){return w},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(w){return w},compatible:!0},{version:"2.2",description:"The version for Online 4.3.",upgrader:function(w){return w},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(w){function m(l,k){if(!l||!k)return!1;for(var n in k)if(k.hasOwnProperty(n))if("object"===typeof k[n]){if(!m(l[n],
k[n]))return!1}else if(l[n]!==k[n])return!1;return!0}function v(l){function k(){var c=m(l[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),g=m(l[12],{position:{top:10,right:195}});return c&&g}function n(){var c=m(l[3],{uri:"widgets/MyLocation/Widget",position:{left:15,bottom:45}}),g=m(l[12],{position:{left:15,top:233}});return c&&g}function d(){var c=m(l[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),g=m(l[12],{position:{right:15,top:195}});return c&&g}(function(){var c=
m(l[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),g=m(l[12],{position:{left:240,top:53}});return c&&g})()?l.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):k()?l.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):n()?l.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,bottom:195},version:"2.3"}):d()&&l.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,
top:159},version:"2.3"})}function r(l){function k(){var d=m(l[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),c=m(l[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),g=m(l[4],{position:{left:7,bottom:70}});return d&&c&&g}function n(){var d=m(l[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),c=m(l[2],{uri:"widgets/Search/Widget",position:{right:2,top:2,relativeTo:"browser"}}),g=m(l[4],{position:{left:7,bottom:70}});return d&&c&&g}(function(){var d=m(l[9],{uri:"widgets/MyLocation/Widget",
position:{left:7,top:110}}),c=m(l[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),g=m(l[4],{position:{left:55,top:45}});return d&&c&&g}()||k()||n())&&l.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:148,left:7},version:"2.3"})}(function(l,k,n){l=l.theme&&l.theme.name;if("FoldableTheme"===l)if(m(k[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}))k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:150,left:7},version:"2.3"});else if(m(k[11],
{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}}))k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:203},version:"2.3"}),n&&n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:12,top:211},version:"2.3"});else{if(m(k[11],{uri:"widgets/MyLocation/Widget",position:{left:164,bottom:14}})){k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:203,bottom:14,height:30},version:"2.3"});for(l=0;l<k.length;l++){var d=k[l];m(d,{uri:"widgets/Scalebar/Widget",
position:{left:220,bottom:5}})&&(d.position.left=288);m(d,{uri:"widgets/Coordinate/Widget",position:{left:395,bottom:5}})&&(d.position.left=463)}n&&n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:209,left:12},version:"2.3"})}}else if("BillboardTheme"===l)v(k);else if("BoxTheme"===l)k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:10,top:131},version:"2.3"});else if("JewelryBoxTheme"===l)r(k);else if("LaunchpadTheme"===l){if(m(k[6],{uri:"widgets/MyLocation/Widget",
position:{left:25,top:215}})||m(k[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}}))k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:255,left:25},version:"2.3"}),n&&n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:10,bottom:238},version:"2.3"})}else"PlateauTheme"===l?(m(k[6],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:2.3}),m(k[6],{uri:"widgets/MyLocation/Widget",
position:{left:12,bottom:164}})&&k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:201},version:2.3})):"TabTheme"===l&&m(k[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&k.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:"2.3"})})(w,w.widgetOnScreen.widgets,w.mobileLayout&&w.mobileLayout.widgetOnScreen&&w.mobileLayout.widgetOnScreen.widgets);return w},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",
upgrader:function(w){return w},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(w){function m(v,r){if(!v||!r)return!1;for(var l in r)if(r.hasOwnProperty(l))if("object"===typeof r[l]){if(!m(v[l],r[l]))return!1}else if(v[l]!==r[l])return!1;return!0}(function(v,r){v=v.theme&&v.theme.name;if("BillboardTheme"===v){v=m(r[8],{position:{left:60,top:53}});var l=m(r[8],{position:{left:15,top:53}});v||l?r.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,
top:8},version:"2.5"}):r.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:55},version:"2.5"})}else if("BoxTheme"===v){a:{v=0;for(l=r.length;v<l;v++){var k=r[v];if(k&&k.uri&&"themes/BoxTheme/widgets/BoxController/Widget"===k.uri){v=k;break a}}v=null}m(v,{position:{right:0,bottom:0}})?r.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):r.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:8},version:"2.5"})}else"DartTheme"===
v?r.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"FoldableTheme"===v?r.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"DashboardTheme"===v?r.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"JewelryBoxTheme"===v?r.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"LaunchpadTheme"===v?r.push({uri:"widgets/FullScreen/Widget",visible:!1,
position:{right:70,top:20},version:"2.5"}):"PlateauTheme"===v?r.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"TabTheme"===v&&(m(r[7],{position:{left:45,top:45}})?r.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):r.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:55},version:"2.5"}))})(w,w.widgetOnScreen.widgets);return w},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",
upgrader:function(w){return w},compatible:!0},{version:"2.7",description:"The version for Online 5.4.",upgrader:function(w){return w},compatible:!0},{version:"2.8",description:"The version for Online 6.1.",upgrader:function(w){function m(v){var r=[];if("object"===typeof v)for(var l in v){var k=v[l];"FeatureStatistics"===k.type&&r.push(k)}return r}(function(v){(v=v.dataSource&&v.dataSource.dataSources)&&(v=m(v))&&v.length&&v.forEach(function(r){(r=r.dataSchema&&r.dataSchema.statistics)&&r.length&&
r.forEach(function(l){if(l&&"count"===l.statisticType&&"count"===l.outStatisticFieldName)l.outStatisticFieldName="STAT_COUNT";else{var k=(k=l.outStatisticFieldName)&&k.toUpperCase();l.outStatisticFieldName=k}})})})(w);return w},compatible:!0},{version:"2.9",description:"The version for Online 6.2.",upgrader:function(w){return w},compatible:!0},{version:"2.10",description:"The version for Online 6.3.",upgrader:function(w){return w},compatible:!0},{version:"2.11",description:"The version for Online 6.4.",
upgrader:function(w){return w},compatible:!0},{version:"2.12",description:"The version for Online 7.1",upgrader:function(w){return w},compatible:!0},{version:"2.13",description:"The version for Online 7.2",upgrader:function(w){if(w.theme&&"PlateauTheme"===w.theme.name&&w.widgetOnScreen&&w.widgetOnScreen.widgets)for(var m=w.widgetOnScreen.widgets,v=0;v<m.length;v++)if("widgets/AttributeTable/Widget"===m[v].uri&&m[v].position){m[v].position.relativeTo="browser";break}return w},compatible:!0},{version:"2.14",
description:"The version for Online 7.3",upgrader:function(w){return w},compatible:!0},{version:"2.15",description:"The version for Online 7.4",upgrader:function(w){return w},compatible:!0},{version:"2.16",description:"The version for Online 8.1",upgrader:function(w){return w},compatible:!0},{version:"2.17",description:"The version for Online 8.2",upgrader:function(w){return w},compatible:!0},{version:"2.18",description:"The version for Online 8.3",upgrader:function(w){return w},compatible:!0},{version:"2.19",
description:"The version for Online 8.4",upgrader:function(w){return w},compatible:!0},{version:"2.20",description:"The version for Online 9.1",upgrader:function(w){return w},compatible:!0},{version:"2.21",description:"The version for Online 9.2",upgrader:function(w){return w},compatible:!0},{version:"2.22",description:"The version for Online 9.3",upgrader:function(w){return w},compatible:!0},{version:"2.23",description:"The version for Online 9.4",upgrader:function(w){return w},compatible:!0},{version:"2.24",
description:"The version for Online 10.1",upgrader:function(w){return w},compatible:!0},{version:"2.25",description:"The version for Online 10.2",upgrader:function(w){return w},compatible:!0},{version:"2.26",description:"The version for Online 10.3",upgrader:function(w){return w},compatible:!0}];this.isCompatible=function(w,m){w=this.getVersionIndex(w);m=this.getVersionIndex(m);for(w+=1;w<=m;w++)if(!1===this.versions[w].compatible)return!1;return!0}}A.prototype=new E;return A.prototype.constructor=
A})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(E,q,A){q=this.getVersionIndex(q);A=this.getVersionIndex(A);if(q>A)throw Error("New version should be higher than the old version.");for(q+=1;q<=A;q++)this.versions[q].upgrader&&(E=this.versions[q].upgrader(E));return E};this.getVersionIndex=function(E){E=this.fixVersion(E);var q,A;for(A=0;A<this.versions.length;A++)this.versions[A].version===E&&(q=A);null===E&&(q=-1);void 0===
q&&(q=this.versions.length-1);return q};this.fixVersion=function(E){return E?E:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr dojo/request/script ./utils ./privilegeUtils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/IdentityManager esri/config esri/urlUtils esri/arcgis/utils".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u,t,z){var x=null;var y=E(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(D,H){this._removeHash(D);this.urlParams=D||{};this.widgetManager=g.getInstance();q.mixin(this,H)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(q.hitch(this,function(D){var H=this.checkConfig(D);if(H)throw Error(H);this.rawAppConfig=q.clone(D);p.getInstance().setRawAppConfig(this.rawAppConfig);
D=this._upgradeAppConfig(D);this._processAfterTryLoad(D);this.appConfig=D;if(this.urlParams.id)return this.loadWidgetsManifest(D).then(q.hitch(this,function(){return this.loadAndUpgradeAllWidgetsConfig(D)})).then(q.hitch(this,function(I){return this.updateNecessaryAttrOfResourceUrlInAppConfig(I,this.urlParams.id)})).then(q.hitch(this,function(){this._configLoaded=!0;this._setDocumentTitle(D);this._readAndSetSharedTheme(D);return this.getAppConfig()}));e.setPortalUrl(D.portalUrl);z.arcgisUrl=h.getBaseItemUrl(D.portalUrl);
return this._proesssWebTierAndSignin(D).then(q.hitch(this,function(){if(this.urlParams.appid){if(window.appInfo.isRunInPortal){var I=h.getStandardPortalUrl(D.portalUrl),N=a.getPortal(I);return c.checkIsSelfOrigin(this.urlParams.appid,N,e.isInBuilderWindow()).then(q.hitch(this,function(S){if(!S)throw S=Error(window.jimuNls.orgUrlMessage),S.isSelfOrigin=!1,S;})).then(q.hitch(this,function(){return c.checkEssentialAppsLicense(this.urlParams.appid,N,e.isInBuilderWindow()).then(q.hitch(this,function(){return this._getAppConfigFromTemplateAppId(D.portalUrl,
this.urlParams.appid).then(q.hitch(this,function(S){this._tryUpdateAppConfigByLocationUrl(S);return this._processInPortalAppProtocol(S)}))}),q.hitch(this,function(S){console.error(S);if(S.isBlockedByOrg)throw Error(window.jimuNls.blockedByAdminErrorForApp);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))}))}return this._processNotInPortalAppProtocol(D).then(q.hitch(this,function(S){return this._getAppDataAddTemplateDataFromTemplateAppId(S.portalUrl,this.urlParams.appid).then(q.hitch(this,
function(M){M.appData.appConfig&&(S=M.appData.appConfig);S._appData=M.appData;S.templateConfig=M.templateData;S.isTemplateApp=!0;return S}))}))}return this._processNotInPortalAppProtocol(D)})).then(q.hitch(this,function(I){this._processAfterTryLoad(I);this.appConfig=I;return I.map.itemId?I:(I.map["3D"]?a.getDefaultWebScene(I.portalUrl):a.getDefaultWebMap(I.portalUrl)).then(function(N){I.map.itemId=N;return I})})).then(q.hitch(this,function(I){return this.loadWidgetsManifest(I)})).then(q.hitch(this,
function(I){return I._appData?I._appData.values&&I._appData.values.webmap?a.getPortal(I.portalUrl).getItemById(I._appData.values.webmap).then(q.hitch(this,function(N){return d.template.mergeTemplateAppConfigToAppConfig(I,I._appData,N)})):d.template.mergeTemplateAppConfigToAppConfig(I,I._appData):I})).then(q.hitch(this,function(I){return this.loadAndUpgradeAllWidgetsConfig(I)})).then(q.hitch(this,function(I){return I._wabAppId?this.processResourceInAppConfigForConfigLoader(I,this.urlParams):I.appItemId&&
-1<window.JSON.stringify(I).indexOf("${itemId}")?this.updateNecessaryAttrOfResourceUrlInAppConfig(I,I.appItemId):I})).then(q.hitch(this,function(I){this.appConfig=I;this._configLoaded=!0;this._setDocumentTitle(I);this._readAndSetSharedTheme(I);return this.getAppConfig()}))}),q.hitch(this,function(D){var H=new r;H.reject(D);return H}))},processResourceInAppConfigForConfigLoader:function(D,H){var I=D.portalUrl,N=D.appItemId,S=H.appid,M=new r,Q=q.clone(D);this.updateNecessaryAttrOfResourceUrlInAppConfig(Q,
S).then(function(){if("config"===H.mode){var da=this.getResourceUrlsOfAppConfig(D).result;0!==da.length?a.getItemResources(I,S).then(function(J){if(0===J.length)return da=da.map(function(R){return{resUrl:R}}),f.AddResourcesToItemForAppSave(I,da,N,S).then(function(){M.resolve(Q)},function(R){console.warn("Add resource to template based app error:"+R.message||R);M.resolve(Q)});M.resolve(Q)},function(J){console.warn("Get resource of template based item error:"+J.message||J);M.resolve(Q)}):M.resolve(Q)}else M.resolve(Q)}.bind(this),
function(da){console.warn("Insert appId to resource url of appConfig error:"+da.message||da);M.resolve(Q)});return M},getResourceUrlsOfAppConfig:function(D){var H={test:function(I){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items\/(.)+\/resources\/inConfig\//.test(I)},func:q.hitch(this,function(I){return I.value})};return d.processItemResourceOfAppConfig(D,H)},updateNecessaryAttrOfResourceUrlInAppConfig:function(D,H){function I(Q){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items\/(.)+\/resources\/inConfig\//.test(Q)}
function N(Q,da){Q=M.processItemIDAndTokenOfResources(da.value,Q);Q=M.setResouceProtocolForHttps(Q);var J=da.obj,R=da.key;"number"===typeof da.i?J[R][da.i]=Q:J[R]=Q;return!0}var S=D.portalUrl,M=this;return a.getPortal(S).getItemById(H).then(q.hitch(this,function(Q){Q={test:I,func:q.hitch(this,N,{appId:H,isPublic:"public"===Q.access,portalUrl:S})};return d.processItemResourceOfAppConfig(D,Q).appConfig}))},setResouceProtocolForHttps:function(D){var H=D;"https:"===window.location.protocol&&(H=D.replace(/^http(s?):\/\//i,
"https://"));return H},processItemIDAndTokenOfResources:function(D,H){0<D.indexOf("${itemId}")&&(D=D.replace("${itemId}",H.appId));/(\?|&)token=.+/.test(D)&&(D=D.replace(/(\?|&)token=.+/,""));H.isPublic||(H=e.getPortalCredential(H.portalUrl))&&(D+="?token\x3d"+H.token);return D},_setDocumentTitle:function(D){!window.isBuilder&&D&&D.title&&(document.title=d.stripHTML(D.title))},getAppConfig:function(){var D=q.clone(this.appConfig);D.getConfigElementById=function(H){return d.getConfigElementById(this,
H)};D.getConfigElementsByName=function(H){return d.getConfigElementsByName(this,H)};D.visitElement=function(H){d.visitElement(this,H)};this._addAuthorizedCrossOriginDomains(this.portalSelf,D);return D},_addAuthorizedCrossOriginDomains:function(D,H){D&&D.authorizedCrossOriginDomains&&e.addAuthorizedCrossOriginDomains(D.authorizedCrossOriginDomains);H&&H.authorizedCrossOriginDomains&&e.addAuthorizedCrossOriginDomains(H.authorizedCrossOriginDomains)},checkConfig:function(){return!1},processProxy:function(D){u.defaults.io.alwaysUseProxy=
D.httpProxy&&D.httpProxy.useProxy&&D.httpProxy.alwaysUseProxy;u.defaults.io.proxyUrl="";u.defaults.io.proxyRules=[];D.httpProxy&&D.httpProxy.useProxy&&D.httpProxy.url&&(u.defaults.io.proxyUrl=D.httpProxy.url);D.httpProxy&&D.httpProxy.useProxy&&D.httpProxy.rules&&A.forEach(D.httpProxy.rules,function(H){t.addProxyRule(H)})},addNeedValues:function(D){this._processNoUriWidgets(D);this._processEmptyGroups(D);this._addElementId(D);this._fixRepeatedId(D)},showError:function(D){D&&D.message&&(w.create("div",
{"class":"app-error",innerHTML:d.sanitizeHTML(D.message)},document.body),w.setStyle(jimuConfig.loadingId,"display","none"))},_tryLoadConfig:function(){"stemapp"===this.urlParams.id&&(this.urlParams.config=window.appInfo.appPath+"config.json",delete this.urlParams.id);if(this.urlParams.config)return this.configFile=this.urlParams.config,k(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(q.hitch(this,function(N){e.setPortalUrl(N.portalUrl);N.portalUrl&&(window.portalUrl=N.portalUrl);
return this.urlParams.token?e.registerToken(this.urlParams.token).then(function(){return N}):N}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var D=h.getPortalUrlFromLocation(),H=new r;e.setPortalUrl(D);window.portalUrl=D;z.arcgisUrl=h.getBaseItemUrl(D);if(this.urlParams.token)var I=e.registerToken(this.urlParams.token);else I=new r,I.resolve();I.then(q.hitch(this,function(){var N=a.getPortal(D);N.loadSelfInfo().then(q.hitch(this,function(S){this.portalSelf=S;S.allSSL&&"http:"===window.location.protocol?
(console.log("redirect from http to https"),window.location.href=h.setHttpsProtocol(window.location.href),H.reject()):this._processSignIn(D).then(q.hitch(this,function(){this._getAppConfigFromAppId(D,this.urlParams.id).then(q.hitch(this,function(M){return c.checkIsSelfOrigin(this.urlParams.id,N,e.isInBuilderWindow()).then(q.hitch(this,function(Q){if(Q)return M;Q=Error(window.jimuNls.orgUrlMessage);Q.isSelfOrigin=!1;throw Q;}))})).then(q.hitch(this,function(M){return c.checkEssentialAppsLicense(this.urlParams.id,
N,e.isInBuilderWindow()).then(q.hitch(this,function(){this._tryUpdateAppConfigByLocationUrl(M);return this._processInPortalAppProtocol(M)}),q.hitch(this,function(Q){console.error(Q);if(Q.isBlockedByOrg)throw Error(window.jimuNls.blockedByAdminErrorForApp);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))})).then(function(M){H.resolve(M)},function(M){H.reject(M)})}))}))}),q.hitch(this,function(N){this.showError(N)}));return H}this.configFile="config.json";return k(this.configFile,{handleAs:"json"}).then(q.hitch(this,
function(N){e.setPortalUrl(N.portalUrl);N.portalUrl&&(window.portalUrl=N.portalUrl);return this.urlParams.token?e.registerToken(this.urlParams.token).then(function(){return N}):N}))},_upgradeAppConfig:function(D){var H=window.wabVersion,I=D.wabVersion;D.configWabVersion=D.wabVersion;if(H===I)return D;var N=this.versionManager.getVersionIndex(I),S=this.versionManager.getVersionIndex(H);if(N>S)throw Error("Bad version number, "+I);D=this.versionManager.upgrade(D,I,H);D.wabVersion=H;return D},loadAndUpgradeAllWidgetsConfig:function(D){var H=
new r,I=[];b.visitElement(D,q.hitch(this,function(N){N.uri&&(N=this.widgetManager.tryLoadWidgetConfig(N),I.push(N))}));l(I).then(q.hitch(this,function(){H.resolve(D)}),function(N){H.reject(N)});return H},_processAfterTryLoad:function(D){this._setPortalUrl(D);this._tryUpdateAppConfigByLocationUrl(D);this._processUrlParams(D);this.addNeedValues(D);this.processProxy(D);B.tokenValidity=10080;return D},_readAndSetSharedTheme:function(D){D.theme.sharedTheme?this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme||
(D.theme.sharedTheme.isPortalSupport=!1):(D.theme.sharedTheme={useHeader:!1,useLogo:!1},D.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?!0:!1);D.theme.sharedTheme.useHeader&&(D.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(D.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},D.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):console.error("Portal does not support sharedTheme."));
D.theme.sharedTheme.useLogo&&(D.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(D.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!D.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(D.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),D.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(D){if(!(this.urlParams.config&&
-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var H=h.getPortalUrlFromLocation();H=h.getStandardPortalUrl(H);h.isOnline(H)&&(H=h.updateUrlProtocolByOtherUrl(H,D.portalUrl),D.map.portalUrl&&h.isSamePortalUrl(D.portalUrl,D.map.portalUrl)&&(D.map.portalUrl=H),D.portalUrl=H,D.httpProxy&&D.httpProxy.url&&(D.httpProxy.url=h.getPortalProxyUrl(H)))}},_processWidgetJsons:function(D){b.visitElement(D,function(H,I){I.isWidget&&H.uri&&d.widgetJson.processWidgetJson(H)})},_processNoUriWidgets:function(D){var H=
0;b.visitElement(D,function(I,N){N.isWidget&&!I.uri&&(H++,I.placeholderIndex=H)})},_processEmptyGroups:function(D){var H=0;D.widgetOnScreen.groups&&A.forEach(D.widgetOnScreen.groups,function(I){if(!I.widgets||I.widgets&&0===I.widgets.length)H++,I.placeholderIndex=H})},_addElementId:function(D){var H=0,I;b.visitElement(D,function(N){if(N.id){N.id=N.id.replace(/\//g,"_");var S=N.id.lastIndexOf("_");-1<S&&(I=N.id.substr(S+1),H=Math.max(H,I))}});b.visitElement(D,function(N){N.id||(H++,N.id=N.itemId?N.itemId+
"_"+H:N.uri?N.uri.replace(/\//g,"_")+"_"+H:"_"+H)})},_setPortalUrl:function(D){if(D.portalUrl){var H=h.getPortalUrlFromLocation(),I=h.isOnline(H);h.isSamePortalUrl(D.portalUrl,H)||I||(window.appInfo.isRunInPortal=!1)}else window.isXT&&v("wab_portalurl")?D.portalUrl=v("wab_portalurl"):(window.appInfo.isRunInPortal=!0,D.portalUrl=h.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(D,H){D.portalUrl=h.setProtocol(D.portalUrl,H);D.map.portalUrl&&(D.map.portalUrl=h.setProtocol(D.map.portalUrl,
H));D.httpProxy&&(D.httpProxy.url=h.setProtocol(D.httpProxy.url,H),D.httpProxy&&D.httpProxy.rules&&A.forEach(D.httpProxy.rules,q.hitch(this,function(I){I.proxyUrl=h.setProtocol(I.proxyUrl,H)})))},_processInPortalAppProtocol:function(D){var H=new r,I=a.getPortal(D.portalUrl),N=q.hitch(this,function(S){if("https:"===window.location.protocol)this._changePortalUrlProtocol(D,"https");else{if(S){console.log("redirect from http to https");window.location.href=h.setHttpsProtocol(window.location.href);H.reject();
return}this._changePortalUrlProtocol(D,"http")}this._checkLocale();H.resolve(D)});I.loadSelfInfo().then(q.hitch(this,function(S){this.portalSelf=S;"private"===S.access?(S=0===D.portalUrl.toLowerCase().indexOf("https://"),N(S)):N(S.allSSL)}),q.hitch(this,function(S){H.reject(S)}));return H},_processNotInPortalAppProtocol:function(D){var H=new r;D.portalUrl?a.getPortal(D.portalUrl).loadSelfInfo().then(q.hitch(this,function(I){this.portalSelf=I;var N="https:"===window.location.protocol;(I.allSSL||N)&&
this._changePortalUrlProtocol(D,"https");0!==D.portalUrl.toLowerCase().indexOf("https://")||N||e.isInConfigOrPreviewWindow()?H.resolve(D):(console.log("redirect from http to https"),window.location.href=h.setHttpsProtocol(window.location.href),H.reject())}),q.hitch(this,function(I){H.reject(I)})):H.resolve(D);return H},_proesssWebTierAndSignin:function(D){var H=new r,I=!1,N=D.portalUrl;this._processWebTier(D).then(q.hitch(this,function(S){I=S;return a.getPortal(N).loadSelfInfo()})).then(q.hitch(this,
function(S){this.portalSelf=S;return this._processSignIn(N,I)})).then(q.hitch(this,function(){H.resolve()}),function(S){H.reject(S)});return H},_processWebTier:function(D){var H=new r,I=D.portalUrl;D.isWebTier?(e.addAuthorizedCrossOriginDomains([I]),e.isWebTierPortal(I).then(q.hitch(this,function(){var N=e.getPortalCredential(I);N&&N.ssl&&"http:"===window.location.protocol&&!e.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=h.setHttpsProtocol(window.location.href)):
H.resolve(D.isWebTier)}),q.hitch(this,function(N){H.reject(N)}))):H.resolve(!1);return H},_processSignIn:function(D,H){var I=new r,N=a.getPortal(D),S=h.getSharingUrl(D),M=h.setHttpsProtocol(D+"/sharing/generateToken?f\x3djson");window.appInfo.isRunInPortal?(H=B.checkSignInStatus(S),H.promise.then(q.hitch(this,function(Q){Q.token?(window.postMessageToSw({type:"to_sw_credential",credential:Q.toJson()}),I.resolve()):n.get(M,{jsonp:"callback"}).then(q.hitch(this,function(da){da&&da.token&&(Q.token=da.token,
Q.expires||(Q.expires=da.expires));I.resolve()}),q.hitch(this,function(da){console.error(da);I.resolve()}))}),q.hitch(this,function(){window.postMessageToSw({type:"to_sw_no_credential"});window.isCredentialSettled=!0;I.resolve()}))):(window.postMessageToSw({type:"to_sw_no_credential"}),window.isCredentialSettled=!0,!e.isInBuilderWindow()&&!e.isInConfigOrPreviewWindow()&&this.portalSelf.supportsOAuth&&this.rawAppConfig&&this.rawAppConfig.appId&&!H&&e.registerOAuthInfo(D,this.rawAppConfig.appId,this.portalSelf.currentVersion),
H=B.checkSignInStatus(S),H.promise.always(q.hitch(this,function(){e.xtGetCredentialFromCookie(D);N.loadSelfInfo().then(q.hitch(this,function(Q){this.portalSelf=Q;this._checkLocale();I.resolve()}))})));return I},_checkLocale:function(){if(!e.isInConfigOrPreviewWindow()){var D=this.portalSelf.user&&this.portalSelf.user.culture||m.locale;D="hi"===D?"en":D.toLowerCase();!this.urlParams.locale&&d.isLocaleChanged(m.locale,D)&&(v("wab_app_locale",D),window.location.reload())}},_getAppConfigFromTemplateAppId:function(D,
H){var I=a.getPortal(D);return this._getWabAppIdAndDataFromTemplateAppId(D,H).then(q.hitch(this,function(N){var S=N.appId,M=N.appData;return l([this._getAppConfigFromAppId(D,S),I.getItemData(M.source)]).then(q.hitch(this,function(Q){if(M.appConfig){var da=M.appConfig;delete M.appConfig}else da=Q[0];da=this._upgradeAppConfig(da);Q=Q[1];da._appData=M;da._wabAppId=S;da.templateConfig=Q;da.isTemplateApp=!0;return da}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(D,H){var I=a.getPortal(D);
return I.getItemData(H).then(function(N){return I.getItemData(N.source).then(function(S){return{appData:N,templateData:S}})})},_getWabAppIdAndDataFromTemplateAppId:function(D,H){var I=new r,N=a.getPortal(D);N.getItemData(H).then(q.hitch(this,function(S){N.getItemById(S.source).then(q.hitch(this,function(M){M=t.urlToObject(M.url);I.resolve({appId:M.query.id,appData:S})}))}),function(S){I.reject(S)});return I},_getAppConfigFromAppId:function(D,H){return a.getPortal(D).getItemData(H)},_removeHash:function(D){for(var H in D)D[H]&&
(D[H]=D[H].replace("#",""))},loadWidgetsManifest:function(D){function H(M,Q){return M.loadWidgetManifest(Q).then(function(da){return da},function(da){console.log("Widget failed to load, it is removed.",Q.name);da.stack?console.error(da.stack):console.log(da);I(D,Q)})}function I(M,Q){function da(J){M[J]&&M[J].widgets&&(M[J].widgets=M[J].widgets.filter(function(R){if(Q)return R.id!==Q.id;R.uri&&!R.manifest&&console.error("Widget is removed because it is not loaded successfully.",R.uri);return R.manifest}));
M[J]&&M[J].groups&&M[J].groups.forEach(function(R){R.widgets&&(R.widgets=R.widgets.filter(function(W){if(Q)return W.id!==Q.id;W.uri&&!W.manifest&&console.error("Widget is removed because it is not loaded successfully.",W.uri);return W.manifest}))})}da("widgetOnScreen");da("widgetPool")}var N=[],S=new r;this.urlParams.manifest&&D._buildInfo&&D._buildInfo.widgetManifestsMerged&&delete D._buildInfo.widgetManifestsMerged;D._buildInfo&&D._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(q.hitch(this,
function(M){b.visitElement(D,q.hitch(this,function(Q){Q.widgets||!Q.uri&&!Q.itemId||(Q.uri&&M[Q.uri]?(this._addNeedValuesForManifest(M[Q.uri],Q.uri),d.widgetJson.addManifest2WidgetJson(Q,M[Q.uri])):N.push(H(this.widgetManager,Q)))}));l(N).then(function(){S.resolve(D)})})):(b.visitElement(D,q.hitch(this,function(M){M.widgets||!M.uri&&!M.itemId||N.push(H(this.widgetManager,M))})),l(N).then(function(){S.resolve(D)}));setTimeout(function(){S.isResolved()||(I(D),S.resolve(D))},6E4);return S},_addNeedValuesForManifest:function(D,
H){q.mixin(D,d.getUriInfo(H));d.manifest.addManifestProperies(D);d.manifest.processManifestLabel(D,m.locale)},_loadMergedWidgetManifests:function(){return k(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_fixRepeatedId:function(D){var H=[];b.visitElement(D,function(I){0<=H.indexOf(I.id)&&(I.id+="_");H.push(I.id)})},_processUrlParams:function(D){var H=this.urlParams.itemid||this.urlParams.webmap;H&&D.map.itemId!==H&&(D.map.mapOptions&&d.deleteMapOptions(D.map.mapOptions),
D.map.itemId=H);this.urlParams.mode&&(D.mode=this.urlParams.mode);D.map.mapOptions||(D.map.mapOptions={});this.urlParams.scale&&(D.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)D.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});y.getInstance=function(D,H){null===x?x=new y(D,H):(x.urlParams=D||{},x.options=H);return x};return y})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all","jimu/portalUtils","jimu/utils"],
function(E,q,A,w){return{AddResourcesToItemForAppSave:function(m,v,r,l){v=v||[];if(0===v.length){var k=new E;k.resolve(v);return k}v=v.map(function(n){var d=n.resUrl.split("resources/")[1],c=new E;n.b64?(n=w.b64toBlob(n.b64),c.resolve({blob:n,fileName:d.split("/")[1],prefixName:d.split("/")[0]})):(n=n.resUrl,0<n.indexOf("${itemId}")&&(n=n.replace("${itemId}",r)),w.resourcesUrlToBlob(n).then(function(g){c.resolve({blob:g,fileName:d.split("/")[1],prefixName:d.split("/")[0]},function(b){console.error(b.message||
b);c.reject(b)})}));return c});return q(v).then(function(n){if(n instanceof Array&&0<n.length)return n=n.map(function(d){var c=r;l&&(c=l);return A.addResource(m,c,d.blob,d.fileName,d.prefixName)}.bind(this)),q(n).then(function(d){return d})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(E,q,A,w,m,v,r,l,k){var n=null,
d=E(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(c){this.rawAppConfig=c},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var c=w.stringify(this.rawAppConfig.map);this.mapMd5=l(c)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var c=new A,g={};if(k.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return c.resolve(g),
c;var b=this._getAppStateKey(),e=r.get(b);e&&e.appStateMd5===this._getAppStateMd5()?(b=e.map&&e.map.extent,e=e.map&&e.map.layers,b&&(g.extent=new m(b.xmin,b.ymin,b.xmax,b.ymax,new v(b.spatialReference))),e&&(g.layers=e)):r.remove(b);c.resolve(g);return c},saveWabAppState:function(c,g){if(c&&!k.isInConfigOrPreviewWindow()){var b=this._getAppStateKey(),e={extent:{xmin:c.extent.xmin,xmax:c.extent.xmax,ymin:c.extent.ymin,ymax:c.extent.ymax,spatialReference:{wkid:c.extent.spatialReference.wkid,wkt:c.extent.spatialReference.wkt}},
layers:{}};g&&g.traversal&&g.traversal(q.hitch(this,function(a){e.layers[a.id]={visible:a.isVisible()}}));r.set(b,{map:e,appStateMd5:this._getAppStateMd5()})}}});d.getInstance=function(c){null===n&&(n=new d);n.urlParams=c;return n};return d})},"libs/storejs/store":function(){!function(E){"object"==typeof exports&&"undefined"!=typeof module?module.exports=E():"function"==typeof define&&define.amd?define([],E):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?
self:this).store=E()}(function(){return function m(q,A,w){function v(k,n){if(!A[k]){if(!q[k]){var d="function"==typeof require&&require;if(!n&&d)return d(k,!0);if(r)return r(k,!0);n=Error("Cannot find module '"+k+"'");throw n.code="MODULE_NOT_FOUND",n;}n=A[k]={exports:{}};q[k][0].call(n.exports,function(c){var g=q[k][1][c];return v(g?g:c)},n,n.exports,m,q,A,w)}return A[k].exports}for(var r="function"==typeof require&&require,l=0;l<w.length;l++)v(w[l]);return v}({1:[function(q,A,w){w=q("../src/store-engine");
var m=q("../storages/all");q=q("../plugins/all");A.exports=w.createStore(m,q)},{"../plugins/all":2,"../src/store-engine":15,"../storages/all":17}],2:[function(q,A,w){A.exports=[q("./defaults"),q("./dump"),q("./events"),q("./observe"),q("./expire"),q("./json2"),q("./operations"),q("./update"),q("./v1-backcompat")]},{"./compression":3,"./defaults":4,"./dump":5,"./events":6,"./expire":7,"./json2":8,"./observe":11,"./operations":12,"./update":13,"./v1-backcompat":14}],3:[function(q,A,w){var m=q("./lib/lz-string");
A.exports=function(){return{get:function(v,r){v=v(r);if(!v)return v;r=m.decompress(v);return null==r?v:this._deserialize(r)},set:function(v,r,l){l=m.compress(this._serialize(l));v(r,l)}}}},{"./lib/lz-string":10}],4:[function(q,A,w){A.exports=function(){var m={};return{defaults:function(v,r){m=r},get:function(v,r){v=v();return void 0!==v?v:m[r]}}}},{}],5:[function(q,A,w){A.exports=function(){return{dump:function(m){var v={};return this.each(function(r,l){v[l]=r}),v}}}},{}],6:[function(q,A,w){q=q("../src/util");
var m=q.bind,v=q.each,r=q.create,l=q.slice;A.exports=function(){var n=r(k,{_id:0,_subSignals:{},_subCallbacks:{}});return{watch:function(d,c,g){return n.on(c,m(this,g))},unwatch:function(d,c){n.off(c)},once:function(d,c,g){n.once(c,m(this,g))},set:function(d,c,g){var b=this.get(c);d();n.fire(c,g,b)},remove:function(d,c){var g=this.get(c);d();n.fire(c,void 0,g)},clearAll:function(d){var c={};this.each(function(g,b){c[b]=g});d();v(c,function(g,b){n.fire(b,void 0,g)})}}};var k={_id:null,_subCallbacks:null,
_subSignals:null,on:function(n,d){return this._subCallbacks[n]||(this._subCallbacks[n]={}),this._id+=1,this._subCallbacks[n][this._id]=d,this._subSignals[this._id]=n,this._id},off:function(n){delete this._subCallbacks[this._subSignals[n]][n];delete this._subSignals[n]},once:function(n,d){var c=this.on(n,m(this,function(){d.apply(this,arguments);this.off(c)}))},fire:function(n){var d=l(arguments,1);v(this._subCallbacks[n],function(c){c.apply(this,d)})}}},{"../src/util":16}],7:[function(q,A,w){A.exports=
function(){function m(r){v.get(r,Number.MAX_VALUE)<=(new Date).getTime()&&(this.raw.remove(r),v.remove(r))}var v=this.createStore(this.storage,null,this._namespacePrefix+"expire_mixin");return{set:function(r,l,k,n){return this.hasNamespace("expire_mixin")||v.set(l,n),r()},get:function(r,l){return this.hasNamespace("expire_mixin")||m.call(this,l),r()},remove:function(r,l){return this.hasNamespace("expire_mixin")||v.remove(l),r()},getExpiration:function(r,l){return v.get(l)},removeExpiredKeys:function(r){var l=
[];this.each(function(k,n){l.push(n)});for(r=0;r<l.length;r++)m.call(this,l[r])}}}},{}],8:[function(q,A,w){A.exports=function(){return q("./lib/json2"),{}}},{"./lib/json2":9}],9:[function(q,A,w){var m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(v){return typeof v}:function(v){return v&&"function"==typeof Symbol&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v};"object"!==("undefined"==typeof JSON?"undefined":m(JSON))&&(JSON={});(function(){function v(B){return 10>
B?"0"+B:B}function r(){return this.valueOf()}function l(B){return b.lastIndex=0,b.test(B)?'"'+B.replace(b,function(u){var t=h[u];return"string"==typeof t?t:"\\u"+("0000"+u.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+B+'"'}function k(B,u){var t,z,x,y=a,D=u[B];switch(D&&"object"===("undefined"==typeof D?"undefined":m(D))&&"function"==typeof D.toJSON&&(D=D.toJSON(B)),"function"==typeof p&&(D=p.call(u,B,D)),"undefined"==typeof D?"undefined":m(D)){case "string":return l(D);case "number":return isFinite(D)?
String(D):"null";case "boolean":case "null":return String(D);case "object":if(!D)return"null";if(a+=f,x=[],"[object Array]"===Object.prototype.toString.apply(D)){u=D.length;for(B=0;B<u;B+=1)x[B]=k(B,D)||"null";return z=0===x.length?"[]":a?"[\n"+a+x.join(",\n"+a)+"\n"+y+"]":"["+x.join(",")+"]",a=y,z}if(p&&"object"===("undefined"==typeof p?"undefined":m(p)))for(u=p.length,B=0;B<u;B+=1)"string"==typeof p[B]&&(t=p[B],z=k(t,D),z&&x.push(l(t)+(a?": ":":")+z));else for(t in D)Object.prototype.hasOwnProperty.call(D,
t)&&(z=k(t,D),z&&x.push(l(t)+(a?": ":":")+z));return z=0===x.length?"{}":a?"{\n"+a+x.join(",\n"+a)+"\n"+y+"}":"{"+x.join(",")+"}",a=y,z}}var n=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,c=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,g=/(?:^|:|,)(?:\s*\[)+/g,b=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+v(this.getUTCMonth()+1)+"-"+v(this.getUTCDate())+"T"+v(this.getUTCHours())+":"+v(this.getUTCMinutes())+":"+v(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=r,Number.prototype.toJSON=r,String.prototype.toJSON=r);var a,f,h,p;"function"!=typeof JSON.stringify&&(h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(B,
u,t){var z;if(a="",f="","number"==typeof t)for(z=0;z<t;z+=1)f+=" ";else"string"==typeof t&&(f=t);if(p=u,u&&"function"!=typeof u&&("object"!==("undefined"==typeof u?"undefined":m(u))||"number"!=typeof u.length))throw Error("JSON.stringify");return k("",{"":B})});"function"!=typeof JSON.parse&&(JSON.parse=function(B,u){function t(x,y){var D,H,I=x[y];if(I&&"object"===("undefined"==typeof I?"undefined":m(I)))for(D in I)Object.prototype.hasOwnProperty.call(I,D)&&(H=t(I,D),void 0!==H?I[D]=H:delete I[D]);
return u.call(x,y,I)}var z;if(B=String(B),e.lastIndex=0,e.test(B)&&(B=B.replace(e,function(x){return"\\u"+("0000"+x.charCodeAt(0).toString(16)).slice(-4)})),n.test(B.replace(d,"@").replace(c,"]").replace(g,"")))return z=eval("("+B+")"),"function"==typeof u?t({"":z},""):z;throw new SyntaxError("JSON.parse");})})()},{}],10:[function(q,A,w){q=function(){function m(k,n){if(!r[k]){r[k]={};for(var d=0;d<k.length;d++)r[k][k.charAt(d)]=d}return r[k][n]}var v=String.fromCharCode,r={},l={compressToBase64:function(k){if(null==
k)return"";k=l._compress(k,6,function(n){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(n)});switch(k.length%4){default:case 0:return k;case 1:return k+"\x3d\x3d\x3d";case 2:return k+"\x3d\x3d";case 3:return k+"\x3d"}},decompressFromBase64:function(k){return null==k?"":""==k?null:l._decompress(k.length,32,function(n){return m("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d",k.charAt(n))})},compressToUTF16:function(k){return null==k?"":l._compress(k,
15,function(n){return v(n+32)})+" "},decompressFromUTF16:function(k){return null==k?"":""==k?null:l._decompress(k.length,16384,function(n){return k.charCodeAt(n)-32})},compressToUint8Array:function(k){k=l.compress(k);for(var n=new Uint8Array(2*k.length),d=0,c=k.length;d<c;d++){var g=k.charCodeAt(d);n[2*d]=g>>>8;n[2*d+1]=g%256}return n},decompressFromUint8Array:function(k){if(null===k||void 0===k)return l.decompress(k);for(var n=Array(k.length/2),d=0,c=n.length;d<c;d++)n[d]=256*k[2*d]+k[2*d+1];var g=
[];return n.forEach(function(b){g.push(v(b))}),l.decompress(g.join(""))},compressToEncodedURIComponent:function(k){return null==k?"":l._compress(k,6,function(n){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(n)})},decompressFromEncodedURIComponent:function(k){return null==k?"":""==k?null:(k=k.replace(/ /g,"+"),l._decompress(k.length,32,function(n){return m("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",k.charAt(n))}))},compress:function(k){return l._compress(k,
16,function(n){return v(n)})},_compress:function(k,n,d){if(null==k)return"";var c,g,b={},e={},a="",f="",h="",p=2,B=3,u=2,t=[],z=0,x=0;for(g=0;g<k.length;g+=1)if(a=k.charAt(g),Object.prototype.hasOwnProperty.call(b,a)||(b[a]=B++,e[a]=!0),f=h+a,Object.prototype.hasOwnProperty.call(b,f))h=f;else{if(Object.prototype.hasOwnProperty.call(e,h)){if(256>h.charCodeAt(0)){for(c=0;c<u;c++)z<<=1,x==n-1?(x=0,t.push(d(z)),z=0):x++;var y=h.charCodeAt(0);for(c=0;8>c;c++)z=z<<1|1&y,x==n-1?(x=0,t.push(d(z)),z=0):x++,
y>>=1}else{y=1;for(c=0;c<u;c++)z=z<<1|y,x==n-1?(x=0,t.push(d(z)),z=0):x++,y=0;y=h.charCodeAt(0);for(c=0;16>c;c++)z=z<<1|1&y,x==n-1?(x=0,t.push(d(z)),z=0):x++,y>>=1}p--;0==p&&(p=Math.pow(2,u),u++);delete e[h]}else for(y=b[h],c=0;c<u;c++)z=z<<1|1&y,x==n-1?(x=0,t.push(d(z)),z=0):x++,y>>=1;p--;0==p&&(p=Math.pow(2,u),u++);b[f]=B++;h=String(a)}if(""!==h){if(Object.prototype.hasOwnProperty.call(e,h)){if(256>h.charCodeAt(0)){for(c=0;c<u;c++)z<<=1,x==n-1?(x=0,t.push(d(z)),z=0):x++;y=h.charCodeAt(0);for(c=
0;8>c;c++)z=z<<1|1&y,x==n-1?(x=0,t.push(d(z)),z=0):x++,y>>=1}else{y=1;for(c=0;c<u;c++)z=z<<1|y,x==n-1?(x=0,t.push(d(z)),z=0):x++,y=0;y=h.charCodeAt(0);for(c=0;16>c;c++)z=z<<1|1&y,x==n-1?(x=0,t.push(d(z)),z=0):x++,y>>=1}p--;0==p&&(p=Math.pow(2,u),u++);delete e[h]}else for(y=b[h],c=0;c<u;c++)z=z<<1|1&y,x==n-1?(x=0,t.push(d(z)),z=0):x++,y>>=1;p--;0==p&&(p=Math.pow(2,u),u++)}y=2;for(c=0;c<u;c++)z=z<<1|1&y,x==n-1?(x=0,t.push(d(z)),z=0):x++,y>>=1;for(;;){if(z<<=1,x==n-1){t.push(d(z));break}x++}return t.join("")},
decompress:function(k){return null==k?"":""==k?null:l._decompress(k.length,32768,function(n){return k.charCodeAt(n)})},_decompress:function(k,n,d){var c,g,b=[],e=4,a=4,f=3;var h="";var p=[],B=d(0),u=n,t=1;for(c=0;3>c;c+=1)b[c]=c;h=0;var z=Math.pow(2,2);for(g=1;g!=z;){var x=B&u;u>>=1;0==u&&(u=n,B=d(t++));h|=(0<x?1:0)*g;g<<=1}switch(h){case 0:h=0;z=Math.pow(2,8);for(g=1;g!=z;)x=B&u,u>>=1,0==u&&(u=n,B=d(t++)),h|=(0<x?1:0)*g,g<<=1;var y=v(h);break;case 1:h=0;z=Math.pow(2,16);for(g=1;g!=z;)x=B&u,u>>=1,
0==u&&(u=n,B=d(t++)),h|=(0<x?1:0)*g,g<<=1;y=v(h);break;case 2:return""}c=b[3]=y;for(p.push(y);;){if(t>k)return"";h=0;z=Math.pow(2,f);for(g=1;g!=z;)x=B&u,u>>=1,0==u&&(u=n,B=d(t++)),h|=(0<x?1:0)*g,g<<=1;switch(y=h){case 0:h=0;z=Math.pow(2,8);for(g=1;g!=z;)x=B&u,u>>=1,0==u&&(u=n,B=d(t++)),h|=(0<x?1:0)*g,g<<=1;b[a++]=v(h);y=a-1;e--;break;case 1:h=0;z=Math.pow(2,16);for(g=1;g!=z;)x=B&u,u>>=1,0==u&&(u=n,B=d(t++)),h|=(0<x?1:0)*g,g<<=1;b[a++]=v(h);y=a-1;e--;break;case 2:return p.join("")}if(0==e&&(e=Math.pow(2,
f),f++),b[y])h=b[y];else{if(y!==a)return null;h=c+c.charAt(0)}p.push(h);b[a++]=c+h.charAt(0);e--;c=h;0==e&&(e=Math.pow(2,f),f++)}}};return l}();"undefined"!=typeof A&&null!=A&&(A.exports=q)},{}],11:[function(q,A,w){q=q("./events");A.exports=[q,function(){return{observe:function(m,v,r){m=this.watch(v,r);return r(this.get(v)),m},unobserve:function(m,v){this.unwatch(v)}}}]},{"./events":6}],12:[function(q,A,w){var m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(l){return typeof l}:
function(l){return l&&"function"==typeof Symbol&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l};w=q("../src/util");var v=w.slice,r=w.assign;q=q("./update");A.exports=[q,function(){function l(k,n){var d,c=n[1],g=v(n,2);return this.update(c,[],function(b){d=Array.prototype[k].apply(b,g)}),d}return{push:function(k,n,d,c,g,b){return l.call(this,"push",arguments)},pop:function(k,n){return l.call(this,"pop",arguments)},shift:function(k,n){return l.call(this,"shift",arguments)},unshift:function(k,
n,d,c,g,b){return l.call(this,"unshift",arguments)},assign:function(k,n,d,c,g,b){var e=v(arguments,2);return this.update(n,{},function(a){if("object"!=("undefined"==typeof a?"undefined":m(a)))throw Error('store.assign called for non-object value with key "'+n+'"');return e.unshift(a),r.apply(Object,e)})}}}]},{"../src/util":16,"./update":13}],13:[function(q,A,w){A.exports=function(){return{update:function(m,v,r,l){3==arguments.length&&(l=r,r=void 0);var k=this.get(v,r),n=l(k);this.set(v,void 0!=n?
n:k)}}}},{}],14:[function(q,A,w){function m(c,g){return void 0!==this.get(g)}function v(c,g,b,e){null==e&&(e=b,b=null);null==b&&(b={});c=this.get(g,b);e=e(c);this.set(g,void 0===e?c:e)}function r(c){return this.clearAll.call(this)}function l(c,g){return this.each.call(this,function(b,e){g(e,b)})}function k(c){return this.dump.call(this)}function n(c,g){return JSON.stringify(g)}function d(c,g){if("string"==typeof g)try{return JSON.parse(g)}catch(b){return g||void 0}}w=q("./dump");q=q("./json2");A.exports=
[w,q,function(){return this.disabled=!this.enabled,{has:m,transact:v,clear:r,forEach:l,getAll:k,serialize:n,deserialize:d}}]},{"./dump":5,"./json2":8}],15:[function(q,A,w){function m(){var a="undefined"==typeof console?null:console;a&&(a.warn?a.warn:a.log).apply(a,arguments)}function v(a,f,h){h||(h="");a&&!c(a)&&(a=[a]);f&&!c(f)&&(f=[f]);var p=h?"__storejs_"+h+"_":"",B=h?new RegExp("^"+p):null;if(!/^[a-zA-Z0-9_\-]*$/.test(h))throw Error("store.js namespaces can only have alphanumerics + underscores and dashes");
var u=d({_namespacePrefix:p,_namespaceRegexp:B,_testStorage:function(t){try{t.write("__storejs__test__","__storejs__test__");var z="__storejs__test__"===t.read("__storejs__test__");return t.remove("__storejs__test__"),z}catch(x){return!1}},_assignPluginFnProp:function(t,z){var x=this[z];this[z]=function(){var y=r(arguments,0),D=this,H=[function(){if(x)return k(arguments,function(I,N){y[N]=I}),x.apply(D,y)}].concat(y);return t.apply(D,H)}},_serialize:function(t){return JSON.stringify(t)},_deserialize:function(t,
z){if(!t)return z;var x="";try{x=JSON.parse(t)}catch(y){x=t}return void 0!==x?x:z},_addStorage:function(t){this.enabled||this._testStorage(t)&&(this.storage=t,this.enabled=!0)},_addPlugin:function(t){var z=this;if(c(t))return void k(t,function(y){z._addPlugin(y)});if(!l(this.plugins,function(y){return t===y})){if(this.plugins.push(t),!g(t))throw Error("Plugins must be function values that return objects");var x=t.call(this);if(!b(x))throw Error("Plugins must return an object of function properties");
k(x,function(y,D){if(!g(y))throw Error("Bad plugin property: "+D+" from plugin "+t.name+". Plugins should only return functions.");z._assignPluginFnProp(y,D)})}},addStorage:function(t){m("store.addStorage(storage) is deprecated. Use createStore([storages])");this._addStorage(t)}},e,{plugins:[]});return u.raw={},k(u,function(t,z){g(t)&&(u.raw[z]=n(u,t))}),k(a,function(t){u._addStorage(t)}),k(f,function(t){u._addPlugin(t)}),u}q=q("./util");var r=q.slice,l=q.pluck,k=q.each,n=q.bind,d=q.create,c=q.isList,
g=q.isFunction,b=q.isObject;A.exports={createStore:v};var e={version:"2.0.12",enabled:!1,get:function(a,f){a=this.storage.read(this._namespacePrefix+a);return this._deserialize(a,f)},set:function(a,f){return void 0===f?this.remove(a):(this.storage.write(this._namespacePrefix+a,this._serialize(f)),f)},remove:function(a){this.storage.remove(this._namespacePrefix+a)},each:function(a){var f=this;this.storage.each(function(h,p){a.call(f,f._deserialize(h),(p||"").replace(f._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},
hasNamespace:function(a){return this._namespacePrefix=="__storejs_"+a+"_"},createStore:function(){return v.apply(this,arguments)},addPlugin:function(a){this._addPlugin(a)},namespace:function(a){return v(this.storage,this.plugins,a)}}},{"./util":16}],16:[function(q,A,w){(function(m){function v(g,b){return Array.prototype.slice.call(g,b||0)}function r(g,b){l(g,function(e,a){return b(e,a),!1})}function l(g,b){if(k(g))for(var e=0;e<g.length;e++){if(b(g[e],e))return g[e]}else for(e in g)if(g.hasOwnProperty(e)&&
b(g[e],e))return g[e]}function k(g){return null!=g&&"function"!=typeof g&&"number"==typeof g.length}var n=function(){return Object.assign?Object.assign:function(g,b,e,a){for(var f=1;f<arguments.length;f++)r(Object(arguments[f]),function(h,p){g[p]=h});return g}}(),d=function(){if(Object.create)return function(b,e,a,f){var h=v(arguments,1);return n.apply(this,[Object.create(b)].concat(h))};var g=function(){};return function(b,e,a,f){var h=v(arguments,1);return g.prototype=b,n.apply(this,[new g].concat(h))}}(),
c=function(){return String.prototype.trim?function(g){return String.prototype.trim.call(g)}:function(g){return g.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}();A.exports={assign:n,create:d,trim:c,bind:function(g,b){return function(){return b.apply(g,Array.prototype.slice.call(arguments,0))}},slice:v,each:r,map:function(g,b){var e=k(g)?[]:{};return l(g,function(a,f){return e[f]=b(a,f),!1}),e},pluck:l,isList:k,isFunction:function(g){return g&&"[object Function]"==={}.toString.call(g)},isObject:function(g){return g&&
"[object Object]"==={}.toString.call(g)},Global:"undefined"!=typeof window?window:m}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],17:[function(q,A,w){A.exports=[q("./localStorage"),q("./oldFF-globalStorage"),q("./oldIE-userDataStorage"),q("./cookieStorage"),q("./sessionStorage"),q("./memoryStorage")]},{"./cookieStorage":18,"./localStorage":19,"./memoryStorage":20,"./oldFF-globalStorage":21,"./oldIE-userDataStorage":22,"./sessionStorage":23}],
18:[function(q,A,w){function m(n){for(var d=k.cookie.split(/; ?/g),c=d.length-1;0<=c;c--)if(l(d[c])){var g=d[c].split("\x3d"),b=unescape(g[0]);g=unescape(g[1]);n(g,b)}}function v(n){n&&r(n)&&(k.cookie=escape(n)+"\x3d; expires\x3dThu, 01 Jan 1970 00:00:00 GMT; path\x3d/")}function r(n){return(new RegExp("(?:^|;\\s*)"+escape(n).replace(/[\-\.\+\*]/g,"\\$\x26")+"\\s*\\\x3d")).test(k.cookie)}q=q("../src/util");w=q.Global;var l=q.trim;A.exports={name:"cookieStorage",read:function(n){if(!n||!r(n))return null;
n="(?:^|.*;\\s*)"+escape(n).replace(/[\-\.\+\*]/g,"\\$\x26")+"\\s*\\\x3d\\s*((?:[^;](?!;))*[^;]?).*";return unescape(k.cookie.replace(new RegExp(n),"$1"))},write:function(n,d){n&&(k.cookie=escape(n)+"\x3d"+escape(d)+"; expires\x3dTue, 19 Jan 2038 03:14:07 GMT; path\x3d/")},each:m,remove:v,clearAll:function(){m(function(n,d){v(d)})}};var k=w.document},{"../src/util":16}],19:[function(q,A,w){function m(r){return v.localStorage.getItem(r)}var v=q("../src/util").Global;A.exports={name:"localStorage",
read:m,write:function(r,l){return v.localStorage.setItem(r,l)},each:function(r){for(var l=v.localStorage.length-1;0<=l;l--){var k=v.localStorage.key(l);r(m(k),k)}},remove:function(r){return v.localStorage.removeItem(r)},clearAll:function(){return v.localStorage.clear()}}},{"../src/util":16}],20:[function(q,A,w){A.exports={name:"memoryStorage",read:function(v){return m[v]},write:function(v,r){m[v]=r},each:function(v){for(var r in m)m.hasOwnProperty(r)&&v(m[r],r)},remove:function(v){delete m[v]},clearAll:function(v){m=
{}}};var m={}},{}],21:[function(q,A,w){function m(r){for(var l=v.length-1;0<=l;l--){var k=v.key(l);r(v[k],k)}}q=q("../src/util").Global;A.exports={name:"oldFF-globalStorage",read:function(r){return v[r]},write:function(r,l){v[r]=l},each:m,remove:function(r){return v.removeItem(r)},clearAll:function(){m(function(r,l){delete v[r]})}};var v=q.globalStorage},{"../src/util":16}],22:[function(q,A,w){function m(d){return d.replace(/^\d/,"___$\x26").replace(n,"___")}q=q("../src/util").Global;A.exports={name:"oldIE-userDataStorage",
write:function(d,c){if(!k){var g=m(d);l(function(b){b.setAttribute(g,c);b.save(v)})}},read:function(d){if(!k){var c=m(d),g=null;return l(function(b){g=b.getAttribute(c)}),g}},each:function(d){l(function(c){for(var g=c.XMLDocument.documentElement.attributes,b=g.length-1;0<=b;b--){var e=g[b];d(c.getAttribute(e.name),e.name)}})},remove:function(d){var c=m(d);l(function(g){g.removeAttribute(c);g.save(v)})},clearAll:function(){l(function(d){var c=d.XMLDocument.documentElement.attributes;d.load(v);for(var g=
c.length-1;0<=g;g--)d.removeAttribute(c[g].name);d.save(v)})}};var v="storejs",r=q.document,l=function(){if(!r||!r.documentElement||!r.documentElement.addBehavior)return null;try{var d=new ActiveXObject("htmlfile");d.open();d.write('\x3cscript\x3edocument.w\x3dwindow\x3c/script\x3e\x3ciframe src\x3d"/favicon.ico"\x3e\x3c/iframe\x3e');d.close();var c=d.w.frames[0].document;var g=c.createElement("div")}catch(b){g=r.createElement("div"),c=r.body}return function(b){var e=[].slice.call(arguments,0);e.unshift(g);
c.appendChild(g);g.addBehavior("#default#userData");g.load(v);b.apply(this,e);c.removeChild(g)}}(),k=(q.navigator?q.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./),n=RegExp("[!\"#$%\x26'()*+,/\\\\:;\x3c\x3d\x3e?@[\\]^`{|}~]","g")},{"../src/util":16}],23:[function(q,A,w){function m(r){return v.sessionStorage.getItem(r)}var v=q("../src/util").Global;A.exports={name:"sessionStorage",read:m,write:function(r,l){return v.sessionStorage.setItem(r,l)},each:function(r){for(var l=v.sessionStorage.length-
1;0<=l;l--){var k=v.sessionStorage.key(l);r(m(k),k)}},remove:function(r){return v.sessionStorage.removeItem(r)},clearAll:function(){return v.sessionStorage.clear()}}},{"../src/util":16}]},{},[1])(1)})},"libs/md5/md5":function(){(function(E){function q(b,e){var a=(b&65535)+(e&65535);return(b>>16)+(e>>16)+(a>>16)<<16|a&65535}function A(b,e,a,f,h,p){b=q(q(e,b),q(f,p));return q(b<<h|b>>>32-h,a)}function w(b,e,a,f,h,p,B){return A(e&a|~e&f,b,e,h,p,B)}function m(b,e,a,f,h,p,B){return A(e&f|a&~f,b,e,h,p,
B)}function v(b,e,a,f,h,p,B){return A(a^(e|~f),b,e,h,p,B)}function r(b,e){b[e>>5]|=128<<e%32;b[(e+64>>>9<<4)+14]=e;var a=1732584193,f=-271733879,h=-1732584194,p=271733878;for(e=0;e<b.length;e+=16){var B=a;var u=f;var t=h;var z=p;a=w(a,f,h,p,b[e],7,-680876936);p=w(p,a,f,h,b[e+1],12,-389564586);h=w(h,p,a,f,b[e+2],17,606105819);f=w(f,h,p,a,b[e+3],22,-1044525330);a=w(a,f,h,p,b[e+4],7,-176418897);p=w(p,a,f,h,b[e+5],12,1200080426);h=w(h,p,a,f,b[e+6],17,-1473231341);f=w(f,h,p,a,b[e+7],22,-45705983);a=w(a,
f,h,p,b[e+8],7,1770035416);p=w(p,a,f,h,b[e+9],12,-1958414417);h=w(h,p,a,f,b[e+10],17,-42063);f=w(f,h,p,a,b[e+11],22,-1990404162);a=w(a,f,h,p,b[e+12],7,1804603682);p=w(p,a,f,h,b[e+13],12,-40341101);h=w(h,p,a,f,b[e+14],17,-1502002290);f=w(f,h,p,a,b[e+15],22,1236535329);a=m(a,f,h,p,b[e+1],5,-165796510);p=m(p,a,f,h,b[e+6],9,-1069501632);h=m(h,p,a,f,b[e+11],14,643717713);f=m(f,h,p,a,b[e],20,-373897302);a=m(a,f,h,p,b[e+5],5,-701558691);p=m(p,a,f,h,b[e+10],9,38016083);h=m(h,p,a,f,b[e+15],14,-660478335);
f=m(f,h,p,a,b[e+4],20,-405537848);a=m(a,f,h,p,b[e+9],5,568446438);p=m(p,a,f,h,b[e+14],9,-1019803690);h=m(h,p,a,f,b[e+3],14,-187363961);f=m(f,h,p,a,b[e+8],20,1163531501);a=m(a,f,h,p,b[e+13],5,-1444681467);p=m(p,a,f,h,b[e+2],9,-51403784);h=m(h,p,a,f,b[e+7],14,1735328473);f=m(f,h,p,a,b[e+12],20,-1926607734);a=A(f^h^p,a,f,b[e+5],4,-378558);p=A(a^f^h,p,a,b[e+8],11,-2022574463);h=A(p^a^f,h,p,b[e+11],16,1839030562);f=A(h^p^a,f,h,b[e+14],23,-35309556);a=A(f^h^p,a,f,b[e+1],4,-1530992060);p=A(a^f^h,p,a,b[e+
4],11,1272893353);h=A(p^a^f,h,p,b[e+7],16,-155497632);f=A(h^p^a,f,h,b[e+10],23,-1094730640);a=A(f^h^p,a,f,b[e+13],4,681279174);p=A(a^f^h,p,a,b[e],11,-358537222);h=A(p^a^f,h,p,b[e+3],16,-722521979);f=A(h^p^a,f,h,b[e+6],23,76029189);a=A(f^h^p,a,f,b[e+9],4,-640364487);p=A(a^f^h,p,a,b[e+12],11,-421815835);h=A(p^a^f,h,p,b[e+15],16,530742520);f=A(h^p^a,f,h,b[e+2],23,-995338651);a=v(a,f,h,p,b[e],6,-198630844);p=v(p,a,f,h,b[e+7],10,1126891415);h=v(h,p,a,f,b[e+14],15,-1416354905);f=v(f,h,p,a,b[e+5],21,-57434055);
a=v(a,f,h,p,b[e+12],6,1700485571);p=v(p,a,f,h,b[e+3],10,-1894986606);h=v(h,p,a,f,b[e+10],15,-1051523);f=v(f,h,p,a,b[e+1],21,-2054922799);a=v(a,f,h,p,b[e+8],6,1873313359);p=v(p,a,f,h,b[e+15],10,-30611744);h=v(h,p,a,f,b[e+6],15,-1560198380);f=v(f,h,p,a,b[e+13],21,1309151649);a=v(a,f,h,p,b[e+4],6,-145523070);p=v(p,a,f,h,b[e+11],10,-1120210379);h=v(h,p,a,f,b[e+2],15,718787259);f=v(f,h,p,a,b[e+9],21,-343485551);a=q(a,B);f=q(f,u);h=q(h,t);p=q(p,z)}return[a,f,h,p]}function l(b){var e,a="";for(e=0;e<32*b.length;e+=
8)a+=String.fromCharCode(b[e>>5]>>>e%32&255);return a}function k(b){var e,a=[];a[(b.length>>2)-1]=void 0;for(e=0;e<a.length;e+=1)a[e]=0;for(e=0;e<8*b.length;e+=8)a[e>>5]|=(b.charCodeAt(e/8)&255)<<e%32;return a}function n(b){return l(r(k(b),8*b.length))}function d(b,e){var a=k(b),f=[],h=[];f[15]=h[15]=void 0;16<a.length&&(a=r(a,8*b.length));for(b=0;16>b;b+=1)f[b]=a[b]^909522486,h[b]=a[b]^1549556828;e=r(f.concat(k(e)),512+8*e.length);return l(r(h.concat(e),640))}function c(b){var e="",a;for(a=0;a<b.length;a+=
1){var f=b.charCodeAt(a);e+="0123456789abcdef".charAt(f>>>4&15)+"0123456789abcdef".charAt(f&15)}return e}function g(b,e,a){e?a?b=d(unescape(encodeURIComponent(e)),unescape(encodeURIComponent(b))):(b=d(unescape(encodeURIComponent(e)),unescape(encodeURIComponent(b))),b=c(b)):b=a?n(unescape(encodeURIComponent(b))):c(n(unescape(encodeURIComponent(b))));return b}"function"===typeof define&&define.amd?define(function(){return g}):E.md5=g})(this)},"jimu/dijit/AGOLLoading":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/AGOLLoading.html dojo/_base/html ../utils".split(" "),
function(E,q,A,w,m,v){return E([q,A],{baseClass:"jimu-agol-loading",declaredClass:"jimu.dijit.AGOLLoading",templateString:w,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&m.setStyle(this.domNode,"display","none");m.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||m.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=
v.sanitizeHTML(this.loadingText))},show:function(r){this.domNode&&this.hidden&&("string"===typeof r&&(this.textNode.innerHTML=r),m.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(m.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g){var b=null;var e=E([w],{constructor:function(a,f){this.own(m.subscribe("appConfigLoaded",q.hitch(this,this._onAppConfigLoaded)));this.own(m.subscribe("appConfigChanged",q.hitch(this,this._onAppConfigChanged)));this.own(m.subscribe("mapLoaded",q.hitch(this,this._onMapLoaded)));this.own(m.subscribe("mapChanged",q.hitch(this,this._onMapChanged)));this.own(m.subscribe("beforeMapDestory",q.hitch(this,this._onBeforeMapDestory)));this.own(m.subscribe("preloadModulesLoaded",
q.hitch(this,this._onPreloadModulesLoaded)));this.own(m.subscribe("openWidget",q.hitch(this,this._onOpenWidgetRequest)));this.own(m.subscribe("builder/actionTriggered",q.hitch(this,this._onActionTriggered)));g.isMobileUa()||this.own(v(window,"resize",n(q.hitch(this,this.resize),200)));this.id=f;this.preloadModulesLoadDef=new l},postCreate:function(){this.containerNode=this.domNode},map:null,mapId:"map",mapDiv:null,hlDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},
_onAppConfigLoaded:function(a){this.appConfig=q.clone(a);this.preloadModulesLoadDef.then(q.hitch(this,function(){this._loadLayoutManager(this.appConfig).then(q.hitch(this,function(f){this.layoutManager=f;this.layoutManager.onEnter(this.appConfig,this.mapId).then(q.hitch(this,function(){this.mapDiv=this.layoutManager.getMapDiv();this._loadingAnim();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))}))},_loadLayoutManager:function(a){a=a.layoutDefinition?a.layoutDefinition.manager:
"jimu/layoutManagers/AbsolutePositionLayoutManager";var f=new l;d([a],q.hitch(this,function(h){h=h.getInstance();this.map&&h.setMap(this.map);f.resolve(h)}));return f},_loadingAnim:function(){window.isXT&&"config"===this.appConfig.mode||(A.addClass(jimuConfig.loadingId,"loading-fadeOut"),this.own(v(document.getElementById(jimuConfig.loadingId),"animationend",q.hitch(this,function(){A.setStyle(jimuConfig.loadingId,"display","none")}))))},_loadMap:function(a){this.mapManager=c.getInstance({appConfig:this.appConfig,
urlParams:this.urlParams},a);this.mapManager.showMap();this._lazyLoadResources()},_lazyLoadResources:function(){jimuConfig.lazyLoadCss&&d(jimuConfig.lazyLoadCss);d(["dynamic-modules/commonResources"])},_onMapLoaded:function(a){this.map=a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onPreloadModulesLoaded:function(){this.preloadModulesLoadDef.resolve()},_loadTheme:function(a){var f=new l;d(["themes/"+a.name+"/main"],q.hitch(this,function(){k([this._loadThemeCommonStyle(a),
this._loadThemeCurrentStyle(a)]).then(q.hitch(this,function(){this._addCustomStyle(a);this.layoutManager.onThemeLoad();f.resolve()}))}));return f},_loadThemeCommonStyle:function(a){A.addClass(this.domNode,a.name);return g.loadStyleLink(this._getThemeCommonStyleId(a),"themes/"+a.name+"/common.css")},_loadThemeCurrentStyle:function(a){A.addClass(this.domNode,a.styles[0]);return g.loadStyleLink(this._getThemeCurrentStyleId(a),"themes/"+a.name+"/styles/"+a.styles[0]+"/style.css")},_addCustomStyle:function(a){var f=
q.getObject("customStyles",!1,a);if(f){var h=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(a=this._getFixedThemeStyles(a))&&(h+=a);h=q.replace(h,f,/\$\{([^\}]+)\}/g);f=A.create("style",{type:"text/css"});try{f.appendChild(document.createTextNode(h))}catch(p){f.styleSheet.cssText=h}f.setAttribute("source","custom");document.head.appendChild(f)}},_getFixedThemeStyles:function(a){var f=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";if(a.customStyles.mainBackgroundColor&&
g.isLightColor(a.customStyles.mainBackgroundColor)){var h=d.toUrl("jimu")+"/css/images/api_popup_light.png";f+=".esriPopup .titleButton {background: url("+h+") no-repeat}.esriPopup .titlePane {color: black}"}"PlateauTheme"===a.name?f+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important} .popup-links .title, .popup-links a, .popup-links, .popup-links .line { color: ${mainBackgroundColor} ; border-color: ${mainBackgroundColor};}":
"BillboardTheme"===a.name?f+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen, .jimu-widget-mylocation .place-holder.nohttps:hover, .jimu-widget-extent-navigate .operation.jimu-state-disabled:hover{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-widget-homebutton .HomeButton .home:hover, .jimu-widget-mylocation .place-holder:not(.nohttps):hover, .jimu-widget-zoomslider.vertical .zoom-in:hover, .jimu-widget-zoomslider.vertical .zoom-out:hover, .jimu-widget-extent-navigate .operation:not(.jimu-state-disabled):hover, .jimu-widget-fullScreen .fullScreen:hover, .jimu-widget-onscreen-icon:hover, .jimu-widget-onscreen-icon.jimu-state-selected{opacity: 1;}":
"BoxTheme"===a.name?f+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-main-background.jimu-widget-zoomslider{background-color: transparent !important}.jimu-widget-homebutton .HomeButton .home:hover, .jimu-widget-mylocation .place-holder:not(.nohttps):hover, .jimu-widget-zoomslider.vertical .zoom-in:hover, .jimu-widget-zoomslider.vertical .zoom-out:hover, .jimu-widget-zoomslider .zoom:hover, .jimu-widget-extent-navigate .operation:not(.jimu-state-disabled):hover, .jimu-widget-fullScreen .fullScreen:hover{background-color: ${mainBackgroundColor} !important; opacity: 1;}":
"TabTheme"===a.name?f+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":"DartTheme"===a.name?f+=".jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation.jimu-state-disabled,.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation.jimu-state-disabled:hover{color: ${mainBackgroundColor} !important; opacity: 0.6;}.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation,.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation:hover{color: ${mainBackgroundColor} !important; opacity: 1;}":
"PocketTheme"===a.name&&(f+=".jimu-main-background, .jimu-widget-homebutton, .jimu-widget-mylocation, .jimu-widget-onscreen-icon, .jimu-widget-onscreen-icon.jimu-state-selected, .jimu-widget-zoomslider .zoom, .jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen, .esriPopup .titlePane, .esriPopupMobile .titlePane, .esriPopup .pointer.top{background-color: ${mainBackgroundColor} !important;}.esriMobileNavigationBar{background-color: ${mainBackgroundColor} !important; background-image: none !important;}");
return f},_onAppConfigChanged:function(a,f,h){a=q.clone(a);switch(f){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);break;case "widgetChange":this._onWidgetChange(a,h);break;case "groupChange":this._onGroupChange(a,h);break;case "widgetPoolChange":this._onWidgetPoolChange(a,h);break;case "resetConfig":this._onResetConfig(a);break;case "loadingPageChange":this._onLoadingPageChange(a,h);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(a,
h);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(a,h);break;case "onScreenOrderChange":this._onOnScreenOrderChange(a,h)}this.appConfig=a},_onMapChanged:function(a){this.map=a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onBeforeMapDestory:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},_onThemeChange:function(a){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);
this._removeCustomStyle();k([this._loadLayoutManager(a),this._loadTheme(a.theme)]).then(q.hitch(this,function(f){var h=f[0];this.layoutManager.name!==h.name?(this.layoutManager.onLeave(),h.onEnter(a,this.mapId).then(q.hitch(this,function(){this.layoutManager=h;this.layoutManager.loadAndLayout(a)}))):this.layoutManager.loadAndLayout(a)}))},_onResetConfig:function(a){var f=this.appConfig;m.publish("appConfigChanged",a,"mapChange",a);this.appConfig=f;this._loadLayoutManager(a).then(q.hitch(this,function(h){this.layoutManager=
h;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();this._loadTheme(this.appConfig.theme)}))},_onLoadingPageChange:function(a,f){"backgroundColor"in f?A.setStyle(jimuConfig.loadingId,"background-color",a.loadingPage.backgroundColor):"backgroundImage"in f?(a=a.loadingPage.backgroundImage,a.visible&&a.uri?(A.setStyle(jimuConfig.loadingImageId,"background-image","url('"+a.uri+"')"),A.setStyle(jimuConfig.loadingImageId,"width",
a.width+"px"),A.setStyle(jimuConfig.loadingImageId,"height",a.height+"px")):(A.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),A.setStyle(jimuConfig.loadingImageId,"width","0px"),A.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in f&&(a=a.loadingPage.loadingGif,a.visible&&a.uri?(A.setStyle(jimuConfig.loadingGifId,"background-image","url('"+a.uri+"')"),A.setStyle(jimuConfig.loadingGifId,"width",a.width+"px"),A.setStyle(jimuConfig.loadingGifId,"height",a.height+"px")):
(A.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),A.setStyle(jimuConfig.loadingGifId,"width","0px"),A.setStyle(jimuConfig.loadingGifId,"height","0px")))},_onStyleChange:function(a){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(a.theme);this._removeCustomStyle();this._addCustomStyle(a.theme)},_onLayoutChange:function(a){this.layoutManager.onLayoutChange(a)},_onWidgetChange:function(a,f){this.layoutManager.onWidgetChange(a,f)},_onGroupChange:function(a,
f){this.layoutManager.onGroupChange(a,f)},_onWidgetPoolChange:function(a,f){this.layoutManager.onWidgetPoolChange(a,f)},_onActionTriggered:function(a){this.layoutManager.onActionTriggered(a)},_onLayoutDefinitionChange:function(a,f){this.layoutManager.onLayoutDefinitionChange(a,f)},_onOnScreenGroupsChange:function(a,f){this.layoutManager.onOnScreenGroupsChange(a,f)},_onOnScreenOrderChange:function(a,f){this.layoutManager.onOnScreenOrderChange(a,f)},_removeThemeCommonStyle:function(a){A.removeClass(this.domNode,
a.name);A.destroy(this._getThemeCommonStyleId(a))},_removeThemeCurrentStyle:function(a){A.removeClass(this.domNode,a.styles[0]);A.destroy(this._getThemeCurrentStyleId(a))},_removeCustomStyle:function(){r('style[source\x3d"custom"]',document.head).forEach(function(a){A.destroy(a)})},_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_onOpenWidgetRequest:function(a){this.layoutManager.openWidget(a)}});
e.getInstance=function(a,f){null===b&&(b=new e(a,f),window._layoutManager=b);return b};return e})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/topic dojo/on dojo/aspect dojo/keys dojo/i18n dojo/_base/config esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/arcgis/utils esri/geometry/Extent esri/geometry/Point esri/layers/FeatureLayer require ./utils jimu/LayerInfos/LayerInfos jimu/dijit/Message jimu/dijit/AppStatePopup ./MapUrlParamsHandler ./AppStateManager ./PopupManager ./FilterManager".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u,t,z,x,y,D,H,I){var N=null,S=E(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(M,Q){this.appConfig=M.appConfig;this.urlParams=M.urlParams;this.id=this.mapDivId=Q;this.appStateManager=D.getInstance(this.urlParams);this.popupManager=H.getInstance(this);this.filterManager=I.getInstance();this.nls=window.jimuNls;v.subscribe("appConfigChanged",q.hitch(this,
this.onAppConfigChanged));v.subscribe("syncExtent",q.hitch(this,this.onSyncExtent));v.subscribe("mapContentModified",q.hitch(this,this.onMapContentModified));r(window,"resize",q.hitch(this,this.onWindowResize));r(window,"unload",q.hitch(this,this.onUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(M){console.time("Load Map");M.map["3D"]?M.map.itemId?this._show3DWebScene(M):this._show3DLayersMap(M):M.map.itemId?this._show2DWebMap(M):console.log("No webmap found. Please set map.itemId in config.json.")},
onUnload:function(){this.appConfig.keepAppState&&this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(M){M&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&(this._mapMobileInfoWindow.destroy(),m("div.esriMobileInfoView.esriMobilePopupInfoView").forEach(function(Q){w.destroy(Q)}),
m("div.esriMobileNavigationBar").forEach(function(Q){w.destroy(Q)})),this._mapMobileInfoWindow=new g(null,w.create("div",null,null,this.map.root)),this.isMobileInfoWindow=!1);u.inMobileSize()&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!u.inMobileSize()&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=!1)},onSyncExtent:function(M){this.map&&
(M=new f(M.extent),this.map.setExtent(M))},_visitConfigMapLayers:function(M,Q){A.forEach(M.map.basemaps,function(da,J){da.isOperationalLayer=!1;Q(da,J)},this);A.forEach(M.map.operationallayers,function(da,J){da.isOperationalLayer=!0;Q(da,J)},this)},_show3DLayersMap:function(M){B(["esri3d/Map"],q.hitch(this,function(Q){var da=new Q(this.mapDivId,{camera:M.map.mapOptions.camera});this._visitConfigMapLayers(M,q.hitch(this,function(J){this.createLayer(da,"3D",J)}));da.usePlugin=Q.usePlugin;this._publishMapEvent(da)}))},
_show3DWebScene:function(M){this._getWebsceneData(M.map.itemId).then(q.hitch(this,function(Q){B(["esri3d/Map"],q.hitch(this,function(da){var J=new da(this.mapDivId,M.map.mapOptions);A.forEach(Q.itemData.operationalLayers,function(R){this.createLayer(J,"3D",R)},this);A.forEach(Q.itemData.baseMap.baseMapLayers,function(R){R.type="tile";this.createLayer(J,"3D",R)},this);A.forEach(Q.itemData.baseMap.elevationLayers,function(R){R.type="elevation";this.createLayer(J,"3D",R)},this);J.toc=Q.itemData.toc;
J.bookmarks=Q.itemData.bookmarks;J.tours=Q.itemData.tours}))}))},_publishMapEvent:function(M){window._viewerMap=M;y.postProcessUrlParams(this.urlParams,M);console.timeEnd("Load Map");this.map?(this.map=M,this.resetInfoWindow(!0),console.log("map changed."),v.publish("mapChanged",this.map,this.layerInfosObj)):(this.map=M,this.resetInfoWindow(!0),v.publish("mapLoaded",this.map,this.layerInfosObj))},_getWebsceneData:function(M){return e({url:"http://184.169.133.166/sharing/rest/content/items/"+M+"/data",
handleAs:"json"})},_show2DWebMap:function(M){this._increasePointCount(M);M.map.mapOptions||(M.map.mapOptions={});var Q=this._processMapOptions(M.map.mapOptions)||{};Q.slider=!1;if("1"===window.queryObject.mapUseClassicNavMode||"true"===window.queryObject.mapUseClassicNavMode)Q.navigationMode="classic";var da=M.map.portalUrl,J=M.map.itemId;Q={mapOptions:Q,bingMapsKey:M.bingMapsKey,usePopupManager:!0};if(!window.isBuilder&&!M.mode&&M.map.appProxy&&M.map.appProxy.mapItemId===M.map.itemId){var R=[];A.forEach(M.map.appProxy.proxyItems,
function(W){W.useProxy&&W.proxyUrl&&R.push({url:W.sourceUrl,mixin:{url:W.proxyUrl}})});0<R.length&&(Q.layerMixins=R)}this._createWebMapRaw(da,J,this.mapDivId,Q).then(q.hitch(this,function(W){var X=W.map;X.hideZoomSlider();X.infoWindow.resize(270,316);X.itemId=M.map.itemId;X.itemInfo=W.itemInfo;X.webMapResponse=W;X.enableSnapping({snapKey:k.copyKey});w.setStyle(X.root,"zIndex",0);X._initialExtent=X.extent;this.layerInfosObj=t.getInstanceSyncForInit(X,X.itemInfo);this.layerInfosObj.getLayerInfoArrayOfWebmap().forEach(function(ia){ia.getLayerObject().then(q.hitch(this,
function(ma){ma&&q.setObject("_wabProperties.originalRefreshinterval",ma.refreshInterval,ma)}),q.hitch(this,function(ma){console.error("can't get layerObject",ma)}))},this);M.map.mapRefreshInterval&&!M.map.mapRefreshInterval.useWebMapRefreshInterval&&this._updateRefreshInterval(M.map.mapRefreshInterval);this._showUnreachableLayersTitleMessage();this._publishMapEvent(X);setTimeout(q.hitch(this,this._checkAppState),500);this._addDataLoadingOnMapUpdate(X);this._hideError()}),q.hitch(this,function(W){console.error(W);
this._showError(W);v.publish("mapCreatedFailed")}))},_increasePointCount:function(M){if("1"!==window.queryObject.disableLargePointCountForTimeSlider&&"true"!==window.queryObject.disableLargePointCountForTimeSlider){var Q=!1;u.visitElement(M,function(da){"widgets/TimeSlider/Widget"===da.uri&&(Q=!0)});Q&&(p.prototype.maxPointCountForAuto=35E3)}},_handleRefreshLayer:function(M){var Q=M._mode._drawFeatures,da=M._mode._clearIIf,J=null;M._mode._drawFeatures=function(R,W){W&&"number"===typeof W.row&&"number"===
typeof W.col&&M._mode._removeCell(W.row,W.col);Q.apply(M._mode,arguments)};l.before(M,"refresh",function(){J=M._mode._cellMap;M._mode._clearIIf=function(){}});l.after(M,"refresh",function(){M._mode._cellMap=J;M._mode._clearIIf=da});r(M,"update-start",function(){M.isUpdating=!0});r(M,"update-end",function(){M.isUpdating=!1})},_showError:function(M){M&&M.message&&w.create("div",{"class":"app-error load-map-error",innerHTML:M.message},document.body)},_hideError:function(){m("div.load-map-error",document.body).forEach(function(M){document.body.removeChild(M)})},
_createWebMapRaw:function(M,Q,da,J){return u.createWebMap(M,Q,da,J).then(q.hitch(this,function(R){return R}),q.hitch(this,function(R){console.error(R);if(R&&R instanceof Error&&R.message){var W=q.getObject("arcgis.utils.baseLayerError",!1,n.cache["esri/nls/jsapi/"+d.locale]);if(W&&0<=R.message.indexOf(W))return new z({message:window.jimuNls.map.basemapNotAvailable+window.jimuNls.map.displayDefaultBasemap}),a.getItem(Q).then(q.hitch(this,function(X){X.itemData.spatialReference={wkid:102100,latestWkid:3857};
X.itemData.baseMap={baseMapLayers:[{url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",opacity:1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,id:"defaultBasemap_0"}],title:"Topographic"};return u.createWebMap(M,X,da,J)}))}throw R;}))},_showUnreachableLayersTitleMessage:function(){var M=this.layerInfosObj.getUnreachableLayersTitle(),Q="",da=window.jimuNls.map.layerLoadedError||"The layer, ${layers} cannot be added to the map.";da&&M&&0<M.length&&(A.forEach(M,
q.hitch(this,function(J){Q=Q+J+", "})),new z({message:da.replace("${layers}",Q)}))},_addDataLoadingOnMapUpdate:function(M){var Q=w.toDom('\x3cdiv class\x3d"map-loading"\x3eLoading...\x3c/div\x3e');w.place(Q,M.root);M.updating&&w.addClass(Q,"loading");r(M,"update-start",q.hitch(this,function(){w.addClass(Q,"loading")}));r(M,"update-end",q.hitch(this,function(){w.removeClass(Q,"loading")}));r(M,"unload",q.hitch(this,function(){w.destroy(Q);Q=null}))},_checkAppState:function(){var M="extent center marker find query scale level".split(" "),
Q=this.appConfig.keepAppState;Q&&A.forEach(M,function(da){da in this.urlParams&&(Q=!1)},this);Q&&this.appStateManager.getWabAppState().then(q.hitch(this,function(da){if(da.extent||da.layers){var J=new x({nls:{title:this.nls.appState.title,restoreMap:this.nls.appState.restoreMap}});J.placeAt("main-page");r(J,"applyAppState",q.hitch(this,function(){this._applyAppState(da,this.map)}));J.startup();J.show()}}))},_applyAppState:function(M,Q){this.layerInfosObj.restoreState({layerOptions:M.layers||null});
M.extent&&Q.setExtent(M.extent)},_processMapOptions:function(M){if(M)return M.lods||delete M.lods,M.lods&&0===M.lods.length&&delete M.lods,M=q.clone(M),M.extent&&(M.extent=new f(M.extent)),M.center&&!q.isArrayLike(M.center)&&(M.center=new h(M.center)),M.infoWindow&&(M.infoWindow=new c(M.infoWindow,w.create("div",{},this.mapDivId))),M},createLayer:function(M,Q,da){B([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer","2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer","2D_image":"esri/layers/ArcGISImageServiceLayer",
"2D_feature":"esri/layers/FeatureLayer","2D_rss":"esri/layers/GeoRSSLayer","2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer","2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer","3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer","3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer","3D_3dmodle":"esri3d/layers/SceneLayer"}[Q+
"_"+da.type]],q.hitch(this,function(J){var R={};var W="label url type icon infoTemplate isOperationalLayer".split(" ");for(var X in da)0>W.indexOf(X)&&(R[X]=da[X]);da.infoTemplate?(W=new b(da.infoTemplate.title,da.infoTemplate.content),R.infoTemplate=W,J=new J(da.url,R),da.infoTemplate.width&&da.infoTemplate.height&&l.after(J,"onClick",q.hitch(this,function(){M.infoWindow.resize(da.infoTemplate.width,da.infoTemplate.height)}),!0)):J=new J(da.url,R);J.isOperationalLayer=da.isOperationalLayer;J.label=
da.label;J.icon=da.icon;M.addLayer(J)}))},onAppConfigChanged:function(M,Q,da){this.appConfig=M;"mapChange"===Q?this._recreateMap(M):"mapOptionsChange"===Q?da.lods&&this._recreateMap(M):"mapRefreshIntervalChange"===Q&&this.map&&this.map.itemInfo.itemData&&this.layerInfosObj&&this._updateRefreshInterval(da)},onMapContentModified:function(){this._recreateMap(this.appConfig)},_updateRefreshInterval:function(M){var Q=-1;Q=M.useWebMapRefreshInterval?-1:M.minutes;this.layerInfosObj.getLayerInfoArrayOfWebmap().forEach(function(da){da.getLayerObject().then(q.hitch(this,
function(J){if(J){var R=q.getObject("_wabProperties.originalRefreshinterval",!1,J);0<R&&"function"===typeof J.setRefreshInterval&&(0>Q?J.setRefreshInterval(R):J.setRefreshInterval(Q))}}),q.hitch(this,function(J){console.error("can't get layerObject",J)}))},this)},_recreateMap:function(M){this.map&&(v.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(M)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});
S.getInstance=function(M,Q){null===N&&(N=new S(M,Q));return N};return S})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p){var B=E([h,c,
g,b,f],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:p,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(u){this.inherited(arguments);n.place(this.domNode,u.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[B.ANCHOR_UPPERRIGHT,B.ANCHOR_LOWERRIGHT,B.ANCHOR_LOWERLEFT,B.ANCHOR_UPPERLEFT];if(7>v("ie")){var u="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+
d.getComputedStyle(this._sprite).backgroundImage.replace(/url\("/i,"").replace(/"\)/,"")+"')",t=n.create("div",null,w.body());d.set(t,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:u});var z=setTimeout(function(){n.destroy(t);clearTimeout(z);z=t=null},100);m.query(".sprite",this.domNode).forEach(function(x){x.style.backgroundImage="none";x.style.filter=u})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),
this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(u,t){if(u&&t){var z=d.set;z(this._topleft,{height:t+"px",marginLeft:u+"px"});z(this._topright,{width:u+"px",height:t+"px"});z(this._user,"width",u-8+"px");z(this._hide,"marginLeft",u-22+"px");z(this._title,"width",u-25+"px");z(this._content,"height",t-37+"px");z(this._bottomleft,{marginLeft:u+"px",marginTop:t+"px"});z(this._bottomright,{width:u-
5+"px",marginTop:t+"px"});this.width=u;this.height=t;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(u,t)}},_adjustPosition:function(u,t){var z=d.set;z(this._infowindow,{left:Math.round(u.x)+"px",top:Math.round(u.y)+"px"});t===B.ANCHOR_UPPERLEFT?z(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):t===B.ANCHOR_UPPERRIGHT?z(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):t===B.ANCHOR_LOWERRIGHT?z(this._window,{left:"6px",
right:null,top:"43px",bottom:null}):t===B.ANCHOR_LOWERLEFT&&z(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(u){var t=this.map;return t&&u?(u.y<t.height/2?"lower":"upper")+(u.x<t.width/2?"right":"left"):"upperright"},show:function(u,t,z){if(u){u.spatialReference?(this.mapCoords=u,u=this.coords=this.map.toScreen(u,!0)):(this.mapCoords=null,this.coords=u);var x=this.map._getFrameWidth();if(-1!==x&&(u.x%=x,0>u.x&&(u.x+=x),this.map.width>x))for(var y=(this.map.width-
x)/2;u.x<y;)u.x+=x;t&&-1!==A.indexOf(this._ANCHORS,t)||(t=this._getAnchor(u));k.remove(this._pointer,this.anchor);t=this.anchor=this.fixedAnchor||t;this._adjustPosition(u,t);k.add(this._pointer,t);a.show(this.domNode);this.isShowing=!0;if(!z)this.onShow()}},hide:function(u,t){a.hide(this.domNode);this.isShowing=!1;if(!t)this.onHide()},showTitleBar:function(){a.show(this._titlebar);a.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){a.hide(this._titlebar);a.hide(this._border);this.isTitleBarShowing=
!1},showContent:function(){a.show(this._content);a.show(this._border);this.isContentShowing=!0},hideContent:function(){a.hide(this._content);a.hide(this._border);this.isContentShowing=!1},move:function(u,t){t?u=this.coords.offset(u.x,u.y):(this.coords=u,this.mapCoords&&(this.mapCoords=this.map.toMap(u)));d.set(this._infowindow,{left:Math.round(u.x)+"px",top:Math.round(u.y)+"px"})},setFixedAnchor:function(u){u&&-1===A.indexOf(this._ANCHORS,u)||(this.fixedAnchor=u,this.isShowing&&this.show(this.mapCoords||
this.coords,u),this.onAnchorChange(u))},setTitle:function(u){this.destroyDijits(this._title);this.__setValue("_title",u);return this},setContent:function(u){this.destroyDijits(this._content);this.__setValue("_content",u);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},onResize:function(){},onAnchorChange:function(){}});q.mixin(B,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",
ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});v("extend-esri")&&q.setObject("dijit.InfoWindow",B,e);return B})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../lang ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u,t,z){E=q([a,f],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:E.toUrl("./images/whitex.png"),dArrowIcon:E.toUrl("./images/whitedown.png"),lArrowIcon:E.toUrl("./images/whitel.png"),rArrowIcon:E.toUrl("./images/whiter.png"),constructor:function(x,y){this.initialize();A.mixin(this,x);this.domNode=n.byId(y);this._nls=A.mixin({},
z.widgets.popup);x=this.domNode;c.add(x,"esriPopupMobile");(this._isRTL=!b.isBodyLtr())&&e.set(x,"direction","rtl");d.set(x,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
y=r.query(".titlePane",x)[0];this._arrowButton=r.query(".arrow",y)[0];this._pointerTop=r.query(".top",x)[0];this._pointerBottom=r.query(".bottom",x)[0];this._title=r.query(".title",y)[0];this._footer=r.query(".footer",y)[0];this._prev=r.query(".prev",y)[0];this._next=r.query(".next",y)[0];this._spinner=r.query(".spinner",y)[0];this._eventConnections=[w.connect(r.query(".close",y)[0],"onclick",this,this.hide),w.connect(this._arrowButton,"onclick",this,this._toggleView),w.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),w.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();t.hide(x);this.isShowing=!1},setMap:function(x){this.inherited(arguments);g.place(this.domNode,x.root);this.highlight&&this.enableHighlight(x)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(x,y){this.destroyDijits(this._title);this.place(x,this._title);
this.destroyDijits(this._footer);this.place(y,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(x){this.destroyDijits(this._contentPane);this.place(x,this._contentPane);this.startupDijits(this._contentPane)},show:function(x){if(x){var y=this.map;x.spatialReference?(this.location=x,x=y.toScreen(x)):this.location=y.toMap(x);this._maximized?this.restore():this._setPosition(x);this.isShowing||(t.show(this.domNode),this.isShowing=!0,this.onShow())}else t.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(t.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);m.forEach(this._eventConnections,w.disconnect);g.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");c.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var x=this.selectedIndex;this._updateUI();0<=x&&(this.setContent(this.features[x].getContent()),this.updateHighlight(this.map,this.features[x]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var x=this.map;this._handles=[w.connect(x,"onPanStart",this,this._onPanStart),w.connect(x,"onPan",this,this._onPan),w.connect(x,"onZoomStart",this,this._onZoomStart),w.connect(x,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var x=this._handles;x&&(m.forEach(x,w.disconnect),this._handles=null)},_onPanStart:function(){var x=this.domNode.style;this._panOrigin={left:x.left,top:x.top,right:x.right,
bottom:x.bottom}},_onPan:function(x,y){var D=this._panOrigin;x=y.x;y=y.y;var H=D.left,I=D.top,N=D.right;D=D.bottom;H&&(H=parseFloat(H)+x+"px");I&&(I=parseFloat(I)+y+"px");N&&(N=parseFloat(N)-x+"px");D&&(D=parseFloat(D)-y+"px");e.set(this.domNode,{left:H,top:I,right:N,bottom:D})},_onZoomStart:function(){t.hide(this.domNode)},_onExtentChange:function(x,y,D){D&&(t.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(x){var y=x.x;x=x.y;var D=
b.getContentBox(this.map.container),H=D.w;D=D.h;var I=0,N=x+10,S=118,M=H-18;18<y&&y<M?(I=y-130,0>I?I=0:I>H-260&&(I=H-260)):18>=y?I=y-18:y>=M&&(I=H-260+(y-M));118<y&&y<H-130?S=118:118>=y?18<y?S=y-12:18>=y&&(S=6):y>=H-130&&(y<M?S=118+y-(H-130):y>=M&&(S=118+M-(H-130)));x<=D/2?(e.set(this.domNode,{left:I+"px",top:N+"px",bottom:null}),e.set(this._pointerTop,{left:S+"px"}),c.add(this._pointerBottom,"hidden"),c.remove(this._pointerTop,"hidden")):(e.set(this.domNode,{left:I+"px",top:N-64+"px",bottom:null}),
e.set(this._pointerBottom,{left:S+"px"}),c.add(this._pointerTop,"hidden"),c.remove(this._pointerBottom,"hidden"))},_showPointer:function(x){m.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(y){y===x?r.query(".pointer."+y,this.domNode).removeClass("hidden"):r.query(".pointer."+y,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();t.show(this.popupNavigationBar.container);
t.show(this.popupInfoView.container);0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(x){this.popupInfoView.animateTo(0);switch(x.name){case "CloseButton":t.hide(this.popupNavigationBar.container);t.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":t.hide(this.popupNavigationBar.container);t.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();
break;case "NextButton":this.selectNext(),this._updateUI()}},_initPopupNavigationBar:function(){var x={},y=this._isRTL?this.rArrowIcon:this.lArrowIcon,D=this._isRTL?this.lArrowIcon:this.rArrowIcon;x.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:y,srcAlt:y,
position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:D,srcAlt:D,position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new p(x,g.create("div",{},v.body()));w.connect(this.popupNavigationBar,"onCreate",this,function(H){this._prevFeatureButton=H[3]._node;this._nextFeatureButton=H[4]._node});w.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);w.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();
t.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=new h({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},g.create("div",{},v.body()));c.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();w.connect(this.popupInfoView,"onCreate",this,function(x){this._contentPane=x[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});
w.connect(this.popupInfoView,"onSwipeLeft",this,function(){});w.connect(this.popupInfoView,"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var x="\x26nbsp;",y="\x26nbsp;",D=this.selectedIndex,H=this.features,I=this.deferreds,N=this._prevFeatureButton.parentNode,S=this._nextFeatureButton.parentNode,M=this._spinner,Q=this._nls;H&&1<=H.length?(x=H[D].getTitle(),y=u.substitute({index:D+1,total:H.length},Q.NLS_pagingInfo),c.remove(this._arrowButton,"hidden"),0===D?
(c.add(N,"hidden"),c.add(this._prev,"hidden")):(c.remove(N,"hidden"),c.remove(this._prev,"hidden")),D===H.length-1?(c.add(S,"hidden"),c.add(this._next,"hidden")):(c.remove(S,"hidden"),c.remove(this._next,"hidden"))):(c.add(this._arrowButton,"hidden"),c.add(N,"hidden"),c.add(S,"hidden"),c.add(this._prev,"hidden"),c.add(this._next,"hidden"));this.setTitle(x,y);this.popupNavigationBar.getItems()[1]._node.innerHTML=y;I&&I.length?(c.remove(M,"hidden"),this.setTitle(Q.NLS_searching+"...","\x26nbsp;")):
(c.add(M,"hidden"),H&&H.length||this.setTitle("No Information","\x26nbsp;"))}});l("extend-esri")&&A.setObject("dijit.PopupMobile",E,B);return E})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g){E=E(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],
_isDecelerate:!1,constructor:function(b,e){this.container=l.byId(e);this._touchBase=g(this.container,null);this._slideDiv=n.create("div",null,this.container,"first");this.events=[];this._items=b.items;b.sections&&(this._sections=b.sections);k.add(this.container,"esriMobileInfoView");if(0===this._sections.length)n.create("div",{},this._slideDiv);else for(b=0;b<this._sections.length;b++)e=n.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv),n.create("div",{innerHTML:this._sections[b].title},
e);for(b=0;b<this._items.length;b++){e=0;this._items[b].section&&(e=this._items[b].section);switch(this._items[b].type){case "div":var a=n.create("div",{"class":"esriMobileInfoViewItem",style:this._items[b].style},this._slideDiv.childNodes[e]);a=n.create("div",{innerHTML:this._items[b].text},a)}this._items[b].className&&k.add(a,this._items[b].className);a._index=b;a._item=this._items[b];this._items[b]._node=a}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){A.forEach(this.events,
w.disconnect);this._touchBase=null;m.query("img",this.container).forEach(function(b){b._index=null;b._item=null;n.destroy(b);b=null});this._items=null;n.destroy(this._slideDiv);n.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(b){this._touchBase.setPreventDefault(b)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);this.events.push(w.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));
this.events.push(w.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(w.connect(this._touchBase,"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){w.disconnect(this.events.pop());w.disconnect(this.events.pop());w.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration=
"0s";this._animateTo(0)},onSelect:function(b){},onUnSelect:function(b){},onCreate:function(b){},onClick:function(b){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(b){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=b.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},_onTouchMoveHandler:function(b){this._moveDirection||(this._moveDirection=Math.abs(b.curY)>Math.abs(b.curX)?"vertical":
"horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(b.touches[0].clientY-this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(b){this._endTime=new Date;this._deltaMovement=b.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===this._moveDirection)if("left"===b.swipeDirection)this.onSwipeLeft();else if("right"===b.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=
this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return.2<Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var b=d.getContentBox(this.container);var e=0>this._velocity?.001:-.001;var a=-(this._velocity*this._velocity)/(2*e);var f=-this._velocity/e;e=3*.6;var h=1-e,p=0,B=0;if(b.h>this._slideDiv.scrollHeight)this.contentOffsetY=0,B=300;else if(0<this.contentOffsetY+a){b=0;for(a=Math.floor(f/20);b<a;b++)if(p=(20*h*b^3)+(20*e*b^2)+0*b,p=0>this._velocity?
-p:p,0<this.contentOffsetY+p){B=20*b;break}0===B&&(B=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+a)+b.h>this._slideDiv.scrollHeight)for(this.contentOffsetY=b.h-this._slideDiv.scrollHeight,b=0,a=Math.floor(f/20);b<a;b++){if(p=(20*h*b^3)+(20*e*b^2)+0*b,p=0>this._velocity?-p:p,Math.abs(this.contentOffsetY+p)>this._slideDiv.scrollHeight){B=20*b;break}}else B=f,this.contentOffsetY+=a;this._slideDiv.style.webkitTransition="-webkit-transform "+B+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},
_snapToBounds:function(){var b=d.getContentBox(this.container);b.h>this._slideDiv.scrollHeight?this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+b.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=b.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration="0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(b){this.contentOffsetY=b;this._slideDiv.style.webkitTransform="translate3d(0, "+b+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var b=
document.defaultView.getComputedStyle(this._slideDiv,null);b=new WebKitCSSMatrix(b.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(b.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(b,e){"ON"===e.toggleState?(e.toggleState="OFF",e.src&&(b.src=e.src.toString()),this.onUnSelect(e)):(e.toggleState="ON",e.srcAlt&&(b.src=e.srcAlt),this.onSelect(e))}});v("extend-esri")&&q.setObject("dijit.InfoView",E,c);return E})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),
function(E,q,A,w,m,v){E=E(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(r,l){this.domNode=w.byId(r);this.events=[A.connect(this.domNode,"touchstart",this,this._touchStartHandler),A.connect(this.domNode,"touchmove",this,this._touchMoveHandler),A.connect(this.domNode,"touchend",this,this._touchEndHandler),A.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(r){this._preventDefault=r},disableOnClick:function(){A.disconnect(this.events.pop())},
_clickHandler:function(r){if(this._moved)r.preventDefault();else this.onclick(r)},_touchStartHandler:function(r){this._moved=!1;this.client_x=r.targetTouches[0].clientX;this.client_y=r.targetTouches[0].clientY;this.down_x=r.targetTouches[0].pageX;this.down_y=r.targetTouches[0].pageY;r.downX=this.down_x;r.downY=this.down_y;this.onTouchStart(r)},_touchMoveHandler:function(r){this._preventDefault&&r.preventDefault();this._moved=!0;this.up_x=r.targetTouches[0].pageX;this.cur_x=r.targetTouches[0].pageX-
this.down_x;this.cur_y=r.targetTouches[0].pageY-this.down_y;r.curX=this.cur_x;r.curY=this.cur_y;this.onTouchMove(r)},_touchEndHandler:function(r){this._moved?(r.curX=this.cur_x,r.curY=this.cur_y,this.down_x-this.up_x>this._swipeThreshold?r.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(r.swipeDirection="right")):(r.clientX=this.client_x,r.clientY=this.client_y);this.onTouchEnd(r)},onTouchStart:function(r){},onTouchMove:function(r){},onTouchEnd:function(r){},onclick:function(r){}});
m("extend-esri")&&q.setObject("dijit._TouchBase",E,v);return E})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c){E=E(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(g,b){this.container=l.byId(b);this._touchBase=d(this.container,null);this._slideDiv=n.create("div",
{},this.container,"first");this.events=[A.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=g.items;k.add(this.container,"esriMobileNavigationBar");b=n.create("div",{},this._slideDiv);for(g=0;g<this._items.length;g++){switch(this._items[g].type){case "img":var e=n.create("div",{"class":"esriMobileNavigationItem"},b);var a=n.create("img",{src:this._items[g].src.toString(),style:{width:"100%",height:"100%"}},e);break;case "span":e=n.create("div",{"class":"esriMobileNavigationItem"},
b);a=n.create("span",{innerHTML:this._items[g].text},e);break;case "div":e=n.create("div",{"class":"esriMobileNavigationInfoPanel"},b),a=n.create("div",{innerHTML:this._items[g].text},e)}k.add(e,this._items[g].position);this._items[g].className&&k.add(a,this._items[g].className);a._index=g;a._item=this._items[g];this._items[g]._node=a}},startup:function(){this.onCreate(this._items)},destroy:function(){w.forEach(this.events,A.disconnect);this._touchBase=null;m.query("img",this.container).forEach(function(g){g._index=
null;g._item=null;n.destroy(g);g=null});this._items=null;n.destroy(this._slideDiv);n.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(g){this._markSelected(g._node,g)},onSelect:function(g){},onUnSelect:function(g){},onCreate:function(g){},_onClickHandler:function(g){if("img"===g.target.tagName.toLowerCase()){var b=g.target,e=b._item;m.query("img",this.container).forEach(function(a){a!==b&&a._item.toggleGroup===e.toggleGroup&&this._markUnSelected(a,
a._item)},this);this._toggleNode(b,e)}},_toggleNode:function(g,b){"ON"===b.toggleState?(b.toggleState="OFF",b.src&&(g.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(g.src=b.srcAlt),this.onSelect(b))},_markSelected:function(g,b){b.toggleState="ON";b.srcAlt&&(g.src=b.srcAlt);this.onSelect(b)},_markUnSelected:function(g,b){"ON"===b.toggleState&&(b.toggleState="OFF",b.src&&(g.src=b.src.toString()),this.onUnSelect(b))}});v("extend-esri")&&q.setObject("dijit.NavigationBar",E,c);
return E})},"jimu/dijit/AppStatePopup":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/mouse dojo/_base/fx dojo/topic dojo/Evented".split(" "),function(E,q,A,w,m,v,r,l,k){var n=1E3,d=1E4;return E([q,k],{baseClass:"jimu-appstate-popup",declaredClass:"jimu.dijit.AppStatePopup",currentState:0,timeoutHandler:void 0,constructor:function(c){this.inherited(arguments);"animationDuration"in c&&(n=c.animationDuration);"autoCloseInterval"in c&&(d=c.autoCloseInterval)},
postCreate:function(){window.appInfo.isRunInMobile&&w.addClass(this.domNode,"mobile");var c=w.create("div",{"class":"appstate-header"});w.create("div",{"class":"appstate-title",innerHTML:this.nls.title},c);var g=w.create("div",{"class":"appstate-close"},c);w.place(c,this.domNode);c=w.create("div",{"class":"appstate-tips",innerHTML:this.nls.restoreMap});w.place(c,this.domNode);this.own(m(c,"click",A.hitch(this,function(){this.emit("applyAppState");this.hide()})));this.own(m(g,"click",A.hitch(this,
function(){this.hide()})));this.own(m(this.domNode,v.enter,A.hitch(this,function(){this._timerStop()})));this.own(m(this.domNode,v.leave,A.hitch(this,function(){this._timerStart()})))},show:function(){r.animateProperty({node:this.domNode,duration:n,properties:window.appInfo.isRunInMobile?{top:{start:-120,end:0}}:{bottom:{start:-100,end:10}},onEnd:A.hitch(this,function(){this.currentState=1})}).play();l.subscribe("splashPopupShow",A.hitch(this,function(){this._timerStop()}));l.subscribe("splashPopupHide",
A.hitch(this,function(){this._timerStart()}));this.timeoutHandler=setTimeout(A.hitch(this,this.hide),d)},hide:function(){0!==this.currentState&&r.animateProperty({node:this.domNode,duration:n,properties:window.appInfo.isRunInMobile?{top:{start:0,end:-120}}:{bottom:{start:10,end:-100}},onEnd:A.hitch(this,function(){this.currentState=0;w.setStyle(this.domNode,"display","none")})}).play()},_timerStart:function(){1!==this.currentState||this.timeoutHandler||(this.timeoutHandler=setTimeout(A.hitch(this,
this.hide),d))},_timerStop:function(){this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)}})})},"jimu/MapUrlParamsHandler":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred dojo/topic dojo/promise/all esri/geometry/Point esri/geometry/Extent esri/geometry/scaleUtils esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/graphic esri/layers/GraphicsLayer esri/InfoTemplate esri/tasks/query ./utils ./LayerInfos/LayerInfos ./shareUtils".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B){function u(J,R){var W=J.center.split(";");1===W.length&&(W=J.center.split(","));if(2===W.length||3===W.length){J=parseFloat(W[0]);var X=parseFloat(W[1]);if(isNaN(J)||isNaN(X))J=parseFloat(W[0]),X=parseFloat(W[1]);if(!isNaN(J)&&!isNaN(X)){var ia=4326;3!==W.length||isNaN(W[2])||(ia=parseInt(W[2],10));W=new v(J,X,new k(ia));M(W.spatialReference,R.spatialReference)?R.centerAt(W):S(W,R.spatialReference,function(ma){R.centerAt(ma[0])},function(){console.error("Project center point error.")})}}}
function t(J,R){var W=J.extent.split("wkt\x3d"),X=null;2===W.length?(X=W[1],W=W[0],W=W.split(",")):(W=J.extent.split(";"),1===W.length&&(W=J.extent.split(",")));if(4===W.length||5===W.length){J=parseFloat(W[0]);var ia=parseFloat(W[1]),ma=parseFloat(W[2]),ha=parseFloat(W[3]);if(isNaN(J)||isNaN(J)||isNaN(J)||isNaN(J))J=parseFloat(W[0]),ia=parseFloat(W[1]),ma=parseFloat(W[2]),ha=parseFloat(W[3]);if(isNaN(J)||isNaN(ia)||isNaN(ma)||isNaN(ha))console.error("Wrong extent parameters.");else{var xa=4326;5!==
W.length||isNaN(W[4])||(xa=parseInt(W[4],10));W=null;W=X?new r(J,ia,ma,ha,new k({wkt:X})):new r(J,ia,ma,ha,new k({wkid:xa}));M(R.spatialReference,W.spatialReference)?R.setExtent(W):S(W,R.spatialReference,function(ua){R.setExtent(ua[0])},function(){console.error("Project extent error.")})}}else console.error("Wrong extent parameters.")}function z(J,R){var W=null;if(J.markertemplate){W={title:"",content:"",isIncludeShareUrl:!1};try{var X=JSON.parse(decodeURIComponent(J.markertemplate));E.mixin(W,X)}catch(ra){console.error("urlParams: \x26markertemplate JSON.parse error."+
ra.stack)}}X=J.marker.split(";");1===X.length&&(X=J.marker.split(","));if(2<=X.length&&6>=X.length&&X[0].length&&!isNaN(X[0])&&X[1].length&&!isNaN(X[1])){var ia=parseFloat(X[0]),ma=parseFloat(X[1]),ha=4326;3<=X.length&&X[2].length&&!isNaN(X[2])&&(ha=parseInt(X[2],10));var xa="";4<=X.length&&(xa=X[3]);J=null;5<=X.length&&0===X[4].indexOf("http")&&(J=X[4]);var ua=null;6===X.length&&(ua=X[5]);var na=g.fromJson({type:"esriPMS",url:J,contentType:"image/png"}),va=null;ua&&(va=g.fromJson({color:[0,0,0,255],
type:"esriTS",verticalAlignment:"baseline",horizontalAlignment:"left",angle:0,xoffset:0,yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:ua}));y(na).then(function(){var ra=new v(ia,ma,new k({wkid:ha}));M(ra.spatialReference,R.spatialReference)?x(ra,na,va,xa,W,R):S(ra,R.spatialReference,function(wa){x(wa[0],na,va,xa,W,R)},function(){console.error("Project center point error.")})})}}function x(J,R,W,X,ia,ma){X=new a("",X);if(ia){var ha=B.getXyContent(ia);
ia.isIncludeShareUrl&&(ia=B.getShareUrl(ma,ia,!0),ia=B.getShareUrlContent(ia),ha+=ia);X.setContent(ha)}ha=new e({id:"marker-feature-action-layer"});ma.addLayer(ha);X=new b(J,R,null,X);ha.add(X);W&&(W.xoffset=R.width/2,W.yoffset=R.height/2+R.yoffset,R=new b(new v(J.toJson()),W),ha.add(R),X._textSymbol=R);ma.centerAt(J)}function y(J){var R=new A;J.url?h.getImagesSize(J.url).then(function(W){J.width=W[0];J.height=W[1];R.resolve(J)},function(){J.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png";
J.width=26;J.height=26;J.setOffset(0,J.height/2);R.resolve(J)}):(J.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png",J.width=26,J.height=26,J.setOffset(0,J.height/2),R.resolve(J));return R}function D(J,R){var W=J.query.split(";");1===W.length&&(W=J.query.split(","));if(2!==W.length&&3!==W.length)console.error("query URL parameter is not correct.");else{var X=W[0];N("name",X,R).then(function(ia){null===ia?N("id",X,R).then(function(ma){null===ma?console.error("Invalid layer name or id."):
H(R,ma,W)}):H(R,ia,W)})}}function H(J,R,W){var X=new f,ia="";X.outSpatialReference=J.spatialReference;if(2===W.length)X.where=W[1];else if(3===W.length&&(R.layerObject.url&&h.isHostedService(R.layerObject.url)&&h.containsNonLatinCharacter(W[2])&&(ia="N"),q.forEach(R.layerObject.fields,function(ma){if(ma.alias.toLowerCase()===W[1].toLowerCase()||ma.name.toLowerCase()===W[1].toLowerCase())-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeOID"].indexOf(ma.type)?
X.where=ma.name+"\x3d"+W[2]:-1<["esriFieldTypeString"].indexOf(ma.type)&&(X.where=W[1]+"\x3d"+ia+"'"+W[2].replace(/'/g,"''")+"'")},this),!X.where)){console.error("Invalid field name or type in query URL parameter.");return}X.maxAllowableOffset=1E-5;R.layerObject.queryFeatures(X).then(function(ma){ma=ma.features;if(0===ma.length)console.log("No result from query URL parameter.");else{if("esriGeometryPoint"===R.layerObject.geometryType&&1===ma.length)J.setExtent(l.getExtentForScale(J,1E3)),J.centerAt(ma[0].geometry);
else{var ha=h.graphicsExtent(ma);J.setExtent(ha)}I(J,R,ma)}},function(ma){console.error(ma)})}function I(J,R,W){function X(ha){q.forEach(W,function(xa){xa.setInfoTemplate(ha)})}function ia(){J.infoWindow.setFeatures(W);var ha=J.infoWindow,xa=ha.show;var ua=W[0].geometry;"point"!==ua.type&&("multipoint"===ua.type?ua=ua.getPoint(0):"polyline"===ua.type?ua=ua.getExtent().getCenter():"polygon"===ua.type?ua=ua.getExtent().getCenter():"extent"===ua.type?ua=ua.getCenter():(console.error("Can not get layer geometry type, unknow error."),
ua=null));xa.call(ha,ua)}if(J.getLayer(R.layerInfo.id))ia();else{var ma=R.layerInfo.getInfoTemplate();ma?(X(ma),ia()):R.layerInfo.loadInfoTemplate().then(function(ha){X(ha);ia()})}}function N(J,R,W){var X=new A,ia=[];p.getInstance(W,W.itemInfo).then(function(ma){ma.traversal(function(ha){if(X.isResolved())return!0;("id"===J&&ha.id.toLowerCase()===R.toLowerCase()||"name"===J&&ha.title.toLowerCase()===R.toLowerCase())&&ia.push(m({layerType:ha.getLayerType(),layerObject:ha.getLayerObject()}).then(function(xa){"FeatureLayer"===
xa.layerType&&X.resolve({layerInfo:ha,layerObject:xa.layerObject})},function(xa){console.error("Find layer error from query URL parameter",xa);X.resolve(null)}))});m(ia).then(function(){X.isResolved()||X.resolve(null)})});return X}function S(J,R,W,X){var ia=[102113,102100,3857];if(4326===J.spatialReference.wkid&&Q(ia,R.wkid)){J.ymin=Math.max(J.ymin,-89.99);J.ymax=Math.min(J.ymax,89.99);J=c.geographicToWebMercator(J);if((X=J.spatialReference._getInfo())&&J.xmin>J.xmax){ia=X.valid[1]-J.xmin;var ma=
J.xmax-X.valid[0];ia>ma?J.xmax=X.valid[1]+ma:J.xmin=X.valid[0]-ia}J.spatialReference.wkid=R.wkid;W([J],null)}else Q(ia,J.spatialReference.wkid)&&4326===R.wkid?(J=c.webMercatorToGeographic(J),(X=J.spatialReference._getInfo())&&J.xmin>J.xmax&&(ia=X.valid[1]-J.xmin,ma=J.xmax-X.valid[0],ia>ma?J.xmax=X.valid[1]+ma:J.xmin=X.valid[0]-ia),W([J],null)):(ia=new n,ia.geometries=[J],ia.outSR=R,d.defaults.geometryService.project(ia,function(ha){!(ha&&0<ha.length&&ha[0]&&"extent"===ha[0].type)||isNaN(ha[0].xmin)||
isNaN(ha[0].ymin)||isNaN(ha[0].xmax)||isNaN(ha[0].ymax)?ha&&0<ha.length&&ha[0]&&"point"===ha[0].type&&!isNaN(ha[0].x)&&!isNaN(ha[0].y)&&W(ha,null):W(ha,null)},X))}function M(J,R){var W=[102113,102100,3857];return J&&R&&J.wkt===R.wkt&&(J.wkid===R.wkid||J.latestWkid&&J.latestWkid===R.wkid||R.latestWkid&&J.wkid===R.latestWkid||J.latestWkid&&J.latestWkid===R.latestWkid)||J&&R&&J.wkid&&R.wkid&&Q(W,J.wkid)&&Q(W,R.wkid)?!0:!1}function Q(J,R){for(var W=J.length;W--;)if(J[W]===R)return!0;return!1}function da(J,
R,W,X){var ia=[];J&&J[R]&&J[R].split&&(ia=J[R].split(";"));if(ia&&0<=ia.length){var ma={};ma[W]=ia;p.getInstance(X,X.itemInfo).then(function(ha){ha.setSimplificationState(ma)})}}return{postProcessUrlParams:function(J,R){a:for(var W=["showLayers","hideLayers","showLayersEncoded","hideLayersEncoded"],X=0,ia=W.length;X<ia;X++){var ma=W[X],ha=ma.toLowerCase(),xa;for(xa in J){var ua=xa.toLowerCase();if(ha===ua){da(J,xa,ma,R);break a}}}if("extent"in J)return t(J,R);if("center"in J)return u(J,R);if("marker"in
J)return z(J,R);if("find"in J)w.publish("publishData","framework","framework",{searchString:J.find},!0);else if("query"in J)return D(J,R)}}})},"jimu/shareUtils":function(){define("dojo/_base/lang esri/request dojo/promise/all jimu/shared/basePortalUrlUtils dojo/Deferred esri/lang jimu/portalUtils jimu/Role jimu/utils esri/urlUtils".split(" "),function(E,q,A,w,m,v,r,l,k,n){var d={getBaseHrefUrl:function(c){var g="HTML3D"===window.appInfo.appType?"webappviewer3d":"webappviewer",b="";window.isXT?b=window.location.protocol+
"//"+window.location.host+window.appInfo.appPath:(b=k.urlToObject(window.location.href).query||{},b=b.appid?c+"apps/"+g+"/index.html?appid\x3d"+b.appid:b.id?c+"apps/"+g+"/index.html?id\x3d"+b.id:k.getAppHref());return b},addQueryParamToUrl:function(c,g,b,e){c=n.urlToObject(c);c.query||(c.query={});c.query[g]=b;g=c.path;for(var a in c.query)b=c.query[a],!0===e&&(b=encodeURIComponent(b)),g=g===c.path?g+"?"+a+"\x3d"+b:g+"\x26"+a+"\x3d"+b;return g},getQueryParamFromUrl:function(c,g){c=n.urlToObject(c);
c.query||(c.query={});return c.query[g]},removeQueryParamFromUrl:function(c,g,b){c=n.urlToObject(c);c.query&&delete c.query[g];g=c.path;for(var e in c.query){var a=c.query[e];!0===b&&(a=encodeURIComponent(a));g=g===c.path?g+"?"+e+"\x3d"+a:g+"\x26"+e+"\x3d"+a}return g},getShareUrlContent:function(c){return"\x3cdiv class\x3d'marker-feature-action-popup'\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title jimu-float-leading'\x3e"+window.jimuNls.common.url+"\x3c/span\x3e\x3cinput type\x3d'text' class\x3d'jimu-float-leading' readonly\x3d'readonly' value\x3d"+
c+"\x3e\x3c/input\x3e\x3c/div\x3e\x3c/div\x3e"},getShareUrl:function(c,g,b){var e=d.getBaseHrefUrl(window.portalUrl),a="";if(g)if(g.longitude&&g.latitude){var f=g.longitude;var h=g.latitude;a=g.longitude+","+g.latitude+","}else if(g.x&&g.y&&g.spatialReference&&g.spatialReference.wkid){var p=g.x;var B=g.y;var u=g.spatialReference.wkid;a=g.x+","+g.y+","+g.spatialReference.wkid}e=d.addQueryParamToUrl(e,"marker",a,!0);e=d.addQueryParamToUrl(e+",,,","markertemplate",encodeURIComponent(JSON.stringify({title:g.title,
x:p,y:B,wkid:u,longitude:f,latitude:h,isIncludeShareUrl:b})));g=c.getLevel();return e="number"===typeof g&&-1!==g?d.addQueryParamToUrl(e,"level",c.getLevel(),!0):d.addQueryParamToUrl(e,"scale",c.getScale(),!0)},getXyContent:function(c){var g="\x3cdiv class\x3d'marker-feature-action-popup'\x3e";c.longitude&&c.latitude?g+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+window.jimuNls.common.longitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+k.localizeNumber(parseFloat(c.longitude).toFixed(4))+
"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+window.jimuNls.common.latitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+k.localizeNumber(parseFloat(c.latitude).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e":c.x&&c.y&&(g+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3ex\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+k.localizeNumber(parseFloat(c.x).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title'\x3ey\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+
k.localizeNumber(parseFloat(c.y).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e");return g+"\x3c/div\x3e"},_isUserOwnTheApp:function(c){return c&&c.username&&c.username===window.appInfo.appOwner?!0:!1},getItemByUserAndItemId:function(c,g,b,e){var a=new m;e=w.getStandardPortalUrl(e);e=e+"/sharing/rest/content/users/"+(g?g.username?g.username:g.email:b.email);if(v.isDefined(c.folderId)&&"/"!==c.folderId||v.isDefined(c.ownerFolder)&&"/"!==c.ownerFolder)e+="/"+(c.folderId||c.ownerFolder);e+="/items/"+c.id;q({url:e,
handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(E.hitch(this,function(f){a.resolve(f)}),E.hitch(this,function(f){console.error(f);a.reject(f)}));return a},_getProfile:function(c,g){var b=new m;c=w.getUserUrl(g,c.owner);q({url:c,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(E.hitch(this,function(e){b.resolve(e)}),E.hitch(this,function(e){console.error(e);b.reject(e)}));return b},_unshareItemById:function(c,g,b){var e=new m;b=w.getStandardPortalUrl(b);
b+="/sharing/rest/content/items/"+g+"/unshare";g={f:"json"};g=E.mixin(g,c);q({url:b,handleAs:"json",content:g,callbackParamName:"callback"},{usePost:!0}).then(E.hitch(this,function(a){e.resolve(a)}),E.hitch(this,function(a){console.error(a);e.reject(a)}));return e},canSharePublic:function(c){return!c.selfUrl||!0!==c.canSharePublic&&!1!==c.canSharePublic?!0:c.canSharePublic},unshareItemsByUser:function(c,g,b){var e=new m;b=w.getStandardPortalUrl(b);b+="/sharing/rest/content/users/"+c+"/unshareItems";
c={f:"json"};c=E.mixin(c,g);q({url:b,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(E.hitch(this,function(a){e.resolve(a)}),E.hitch(this,function(a){console.error(a);e.reject(a)}));return e},unshareItems:function(c,g,b){var e=new m;b=w.getStandardPortalUrl(b);b+="/sharing/rest/content/users/"+(g.owner||c.email)+"/unshareItems";c={f:"json"};c=E.mixin(c,g);q({url:b,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(E.hitch(this,function(a){e.resolve(a)}),
E.hitch(this,function(a){console.error(a);e.reject(a)}));return e},shareItemsByUser:function(c,g,b){var e=new m;b=w.getStandardPortalUrl(b);b+="/sharing/rest/content/users/"+c+"/shareItems";c={f:"json"};c=E.mixin(c,g);q({url:b,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(E.hitch(this,function(a){e.resolve(a)}),E.hitch(this,function(a){console.error(a);e.reject(a)}));return e},shareItems:function(c,g,b){var e=new m;b=w.getStandardPortalUrl(b);b+="/sharing/rest/content/users/"+
(g.owner||c.email)+"/shareItems";c={f:"json"};c=E.mixin(c,g);q({url:b,handleAs:"json",content:c,callbackParamName:"callback"},{usePost:!0}).then(E.hitch(this,function(a){e.resolve(a)}),E.hitch(this,function(a){console.error(a);e.reject(a)}));return e},getItemsGroups:function(c,g){var b=new m;g=w.getStandardPortalUrl(g);g+="/sharing/rest/content/items/"+c.id+"/groups";q({url:g,handleAs:"json",content:{f:"json"},callbackParamName:"callback"},{usePost:!0}).then(E.hitch(this,function(e){b.resolve(e)}),
E.hitch(this,function(e){console.error(e);b.reject(e)}));return b},isSharedToPublic:function(c){return window.isXT?!1:null===c?!0:"undefined"!==typeof c&&"undefined"!==typeof c.item&&"undefined"!==typeof c.item.access&&"public"===c.item.access?!0:!1},isShowSocialMediaLinks:function(c){return window.isXT?!0:null===c?!0:"undefined"!==typeof c&&"undefined"!==typeof c.item&&"undefined"!==typeof c.item.access&&"private"===c.item.access?!1:!0},getItemShareInfo:function(c){var g=new m,b="";if(window.isXT)return g.resolve(null);
b=k.urlToObject(k.getAppHref()).query||{};b=b.id||b.appid;if("undefined"===typeof b||""===b)return g.resolve(null);r.getPortal(c).getItemById(b).then(E.hitch(this,function(e){var a={};a.item=e;a.item&&"undefined"===typeof a.item.sharing&&a.item.access&&(a.item.sharing={access:a.item.access});g.resolve(a)}),E.hitch(this,function(e){console.log(e);g.resolve(null)}));return g},getShareInfo:function(c){var g=r.getPortal(c),b=new m,e="";if(window.isXT)return b.resolve(null);e=k.urlToObject(k.getAppHref()).query||
{};e=e.id||e.appid;if("undefined"===typeof e||""===e)return b.resolve(null);A({getUser:g.getUser(),loadSelfInfo:g.loadSelfInfo(),getItem:g.getItemById(e)}).then(E.hitch(this,function(a){var f={};f.item=a.getItem;f.item&&f.item.ownerFolder&&f.item.ownerFolder.length&&"/"!==f.item.ownerFolder&&(f.item.folderId=f.item.ownerFolder);"undefined"===typeof f.item.sharing&&f.item.access&&(f.item.sharing={access:f.item.access});f.user=a.getUser;d._setUserRole(a.loadSelfInfo,f);f.currentUser=f.user;f.isAdmin=
!1;f.userRole&&(f.userRole.isAdmin()||f.userRole.isCustom()&&f.userRole.canUpdateOrgItems())?(f.isAdmin=!0,f.item.owner!==f.currentUser.name?d._getProfile(f.item,c).then(E.hitch(this,function(h){f.itemUser=h;f.itemUser.orgId!==f.currentUser.orgId&&(f.isAdmin=!1);b.resolve(f)})):(f.itemUser=f.currentUser,b.resolve(f))):(f.currentUser&&(f.itemUser=f.currentUser),b.resolve(f))}),E.hitch(this,function(a){console.log(a);b.resolve(null)}));return b},_setUserRole:function(c,g){g.userPortalUrl=c.urlKey?c.urlKey+
"."+c.customBaseUrl:this.portalUrl;!c||c.code||c.message||(g.organization=c);if(c&&c.user)g.userRole=new l({id:c.user.roleId?c.user.roleId:c.user.role,role:c.user.role}),g._isCustomRole=g.userRole.isCustom(),g._roleCanShareToGroup=g._isCustomRole&&g.userRole.canShareItemToGroup(),g._roleCanShareToOrg=g._isCustomRole&&g.userRole.canShareItemToOrg(),g._roleCanSharePublic=g._isCustomRole&&g.userRole.canShareItemToPublic(),g._roleCanShare=g._roleCanShareToGroup||g._roleCanShareToOrg||g._roleCanShareToPublic,
g._roleCanUpdateItems=g._isCustomRole&&g.userRole.canUpdateOrgItems(),g._roleCanShareOthersItemsToGroup=g._isCustomRole&&g.userRole.canShareOthersItemsToGroup(),g._roleCanShareOthersItemsToOrg=g._isCustomRole&&g.userRole.canShareOthersItemsToOrg(),g._roleCanShareOthersItemsToPublic=g._isCustomRole&&g.userRole.canShareOthersItemsToPublic(),g._roleCanShareOthersItems=g._isCustomRole&&(g.userRole.canShareOthersItemsToGroup()||g.userRole.canShareOthersItemsToOrg()||g._roleCanShareOthersItemsToPublic),
g._orgUserCanSharePublicOrOverride=g.organization&&(!0===g.organization.canSharePublic&&(!g._isCustomRole||g._roleCanSharePublic||g._roleCanShareOthersItemsToPublic)||g.userRole.isAdmin());else return!1},getItemById:function(c,g){var b=new m;g=w.getStandardPortalUrl(g);g+="/sharing/rest/content/items/"+c.id;q({url:g,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(E.hitch(this,function(e){b.resolve(e)}),E.hitch(this,function(e){console.error(e);b.reject(e)}));return b},disableWebMapPopup:function(c){c&&
c.setInfoWindowOnClick&&c.setInfoWindowOnClick(!1)},enableWebMapPopup:function(c){c&&c.setInfoWindowOnClick&&c.setInfoWindowOnClick(!0)}};return d})},"jimu/PopupManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred dojo/topic dojo/on dojo/query ./FeatureActionManager ./utils ./dijit/FeatureActionPopupMenu ./RelatedRecordsPopupProjector ./LayerInfos/LayerInfos".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c){var g=null,b=E(null,{mapManager:null,popupUnion:null,_relatedRecordsPopupProjector:null,
constructor:function(e){q.mixin(this,e);this.popupMenu=n.getInstance();this.isInited=!1;this.featureActionManager=l.getInstance();m.subscribe("mapLoaded",q.hitch(this,this.onMapLoadedOrChanged));m.subscribe("mapChanged",q.hitch(this,this.onMapLoadedOrChanged));m.subscribe("appConfigChanged",q.hitch(this,this._onAppConfigChanged));m.subscribe("widgetsActionsRegistered",q.hitch(this,this._onWidgetsActionsRegistered))},init:function(){this.popupUnion=this.mapManager.getMapInfoWindow();this.popupUnion.bigScreen&&
this.popupUnion.mobile&&this.popupUnion.bigScreen.domNode&&this.popupUnion.mobile.domNode&&!this.isInited&&(this._createPopupMenuButton(),this._bindSelectionChangeEvent(),this.isInited=!0)},_createPopupMenuButton:function(){this.popupMenuButtonDesktop&&A.destroy(this.popupMenuButtonDesktop);this.popupMenuButtonMobile&&A.destroy(this.popupMenuButtonMobile);this.popupMenuButtonDesktop=A.create("span",{"class":"popup-menu-button"},r(".actionList",this.popupUnion.bigScreen.domNode)[0]);var e=r("div.esriMobileInfoView.esriMobilePopupInfoView .esriMobileInfoViewItem").parent()[0];
e=A.create("div",{"class":"esriMobileInfoViewItem"},e);this.popupMenuButtonMobile=A.create("span",{"class":"popup-menu-button"},e);v(this.popupMenuButtonMobile,"click",q.hitch(this,this._onPopupMenuButtonClick));v(this.popupMenuButtonDesktop,"click",q.hitch(this,this._onPopupMenuButtonClick))},_onPopupMenuButtonClick:function(e){e=A.position(e.target);this.menuActionsOfSelectedFeature&&this.popupMenu.setActions(this.menuActionsOfSelectedFeature);this.popupMenu.show(e)},_bindSelectionChangeEvent:function(){v(this.popupUnion.bigScreen,
"selection-change",q.hitch(this,this._onSelectionChange));v(this.popupUnion.mobile,"selection-change",q.hitch(this,this._onSelectionChange))},_onSelectionChange:function(e){(this.selectedFeature=e.target.getSelectedFeature())?(this.initPopupMenu([this.selectedFeature]),e=this.selectedFeature.getLayer(),(this.selectedFeature.infoTemplate||e&&e.infoTemplate)&&this._createRelatedRecordsPopupProjector(this.selectedFeature)):this._disablePopupMenu()},_disablePopupMenu:function(){A.addClass(this.popupMenuButtonDesktop,
"disabled");A.addClass(this.popupMenuButtonMobile,"disabled")},_enablePopupMenu:function(){A.removeClass(this.popupMenuButtonDesktop,"disabled");A.removeClass(this.popupMenuButtonMobile,"disabled")},convertFeatures:function(e){var a=new w,f=c.getInstanceSync(),h=e&&e[0]&&e[0].getLayer();(f=f.getLayerInfoById(h&&h.id))?a=f.getMSShipFeatures(e):a.resolve(null);return a},initPopupMenu:function(e){e?this.convertFeatures(e).then(q.hitch(this,function(a){var f=k.toFeatureSet(a||e);this.featureActionManager.getSupportedActions(f).then(q.hitch(this,
function(h){var p="ZoomTo ShowPopup Flash ExportToCSV ExportToFeatureCollection ExportToGeoJSON ShowRelatedRecords SaveToMyContent CreateLayer".split(" ");h=h.filter(q.hitch(this,function(B){return 0>p.indexOf(B.name)}));0===h.length?this._disablePopupMenu():this._enablePopupMenu();this.menuActionsOfSelectedFeature=h=h.map(q.hitch(this,function(B){B.data=f;return B}));this.popupMenu.setActions(h)}))})):(this._disablePopupMenu(),this.popupMenu.setActions([]))},onMapLoadedOrChanged:function(){this.isInited=
!1;this.init()},_onAppConfigChanged:function(){this.popupUnion&&(this.popupUnion.bigScreen&&this.popupUnion.bigScreen.hide&&(this.popupUnion.bigScreen.hide(),this.popupMenu.hide()),this.popupUnion.mobile&&this.popupUnion.mobile.hide&&(this.popupUnion.mobile.hide(),this.popupMenu.hide()))},_onWidgetsActionsRegistered:function(){this.init()},_createRelatedRecordsPopupProjector:function(e){try{this._relatedRecordsPopupProjector&&this._relatedRecordsPopupProjector.domNode&&(this._relatedRecordsPopupProjector.destroy(),
this._relatedRecordsPopupProjector=null),this._relatedRecordsPopupProjector=new d({originalFeature:e,popup:this.mapManager.map.infoWindow,popupManager:this})}catch(a){console.warn(a.message)}}});b.getInstance=function(e){null===g&&(g=new b({mapManager:e}));return g};return b})},"jimu/FeatureActionManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Deferred dojo/promise/all ./featureActions/main ./utils".split(" "),function(E,q,A,w,m,v,r,l){var k=null,n=
E(null,{constructor:function(){this._actions=[];window.isBuilder?(w.subscribe("app/mapLoaded",q.hitch(this,this._onMapLoaded)),w.subscribe("app/mapChanged",q.hitch(this,this._onMapChanged))):(w.subscribe("mapLoaded",q.hitch(this,this._onMapLoaded)),w.subscribe("mapChanged",q.hitch(this,this._onMapChanged)));window.isBuilder?(w.subscribe("app/appConfigLoaded",q.hitch(this,this._onAppConfigLoaded)),w.subscribe("app/appConfigChanged",q.hitch(this,this._onAppConfigChanged))):(w.subscribe("appConfigLoaded",
q.hitch(this,this._onAppConfigLoaded)),w.subscribe("appConfigChanged",q.hitch(this,this._onAppConfigChanged)));this._registerFrameworkActions()},getAllActions:function(){return this._actions},getSupportedActions:function(d){d=this._getFeatureSet(d);var c=[];A.forEach(this._actions,function(g){var b=this.testActionSupportFeature(g,d);b.action=g;c.push(b)},this);return v(c).then(q.hitch(this,function(g){return g.map(q.hitch(this,function(b,e){return{result:b,action:this._actions[e]}})).filter(function(b){return b.result}).map(function(b){return b.action})}))},
testActionSupportFeature:function(d,c){c=this._getFeatureSet(c);var g;c.features&&0<c.features.length&&(g=c.features[0].getLayer());d=d.isFeatureSupported(c,g);var b=new m;d&&"function"===typeof d.then?d.then(function(e){b.resolve(e)},function(e){console.error(e);b.resolve(!1)}):b.resolve(d);return b},registerAction:function(d){var c=new m;require([d.uri],q.hitch(this,function(g){var b=new g({map:this.map,appConfig:this.appConfig,label:d.label,name:d.name,widgetId:d.widgetId});A.some(this._actions,
function(e){return b.name===e.name&&b.widgetId===e.widgetId})?(console.warn("Feature/FeatureSet action has been registered.",b.name),c.reject("Feature/FeatureSet action has been registered.",b.name)):(this._actions.push(b),c.resolve(b))}));return c},removeActionsByWidgetId:function(d){this._actions=A.filter(this._actions,function(c){return c.widgetId!==d},this)},getActionsByWidgetId:function(d){return A.filter(this._actions,function(c){return c.widgetId===d},this)},getActionsByActionName:function(d){return A.filter(this._actions,
function(c){return c.name===d},this)},registerWidgetFeatureActions:function(d){var c=new m;if(!d.featureActions||!d.uri)return c.resolve(),c;var g=[];A.forEach(d.featureActions,function(b){var e=d.manifest["i18nLabels_featureAction_"+b.name];g.push(this.registerAction({uri:d.isRemote?d.amdFolder+b.uri+".js":d.amdFolder+b.uri,widgetId:d.id,name:b.name,label:e[window.dojoConfig.locale]||e[window.dojoConfig.locale.split("-")[0]]||e.defaultLabel}))},this);return v(g)},registerAllWidgetFeatureActions:function(d){var c=
[];d.visitElement(q.hitch(this,function(g){g.uri&&g.visible&&c.push(this.registerWidgetFeatureActions(g))}));return v(c).then(function(){w.publish("widgetsActionsRegistered")})},_reRegisterWidgetActions:function(d){var c=[];A.forEach(this.getAllActions(),function(g){var b=d.getConfigElementById(g.widgetId);"framework"===g.widgetId||b&&b.uri&&!1!==b.visible||this.removeActionsByWidgetId(g.widgetId)},this);d.visitElement(q.hitch(this,function(g){g.uri&&g.visible&&0===this.getActionsByWidgetId(g.id).length&&
c.push(this.registerWidgetFeatureActions(g))}));0<c.length&&v(c).then(function(){w.publish("widgetsActionsRegistered")})},_registerFrameworkActions:function(){A.forEach(r,function(d){this.registerAction({uri:d.uri,widgetId:"framework",label:window.jimuNls.featureActions[d.name],name:d.name})},this)},_getFeatureSet:function(d){return"[object Object]"===Object.prototype.toString.call(d)?d.features?d:l.toFeatureSet([d]):l.toFeatureSet(d)},_onAppConfigLoaded:function(d){this.appConfig=d=q.clone(d);this._setActionsAppConfig(d);
this.registerAllWidgetFeatureActions(this.appConfig)},_onAppConfigChanged:function(d){this.appConfig=d=q.clone(d);this._reRegisterWidgetActions(this.appConfig);this._setActionsAppConfig(d)},_onMapLoaded:function(d){this.map=d;this._setActionsMap(d)},_onMapChanged:function(d){this.map=d;this._setActionsMap(d)},_setActionsMap:function(d){A.forEach(this._actions,function(c){c.setMap(d)},this)},_setActionsAppConfig:function(d){A.forEach(this._actions,function(c){c.setAppConfig(d)},this)}});n.getInstance=
function(){null===k&&(k=new n,window._featureActionManager=k);return k};return n})},"jimu/featureActions/main":function(){define("./ZoomTo ./PanTo ./Flash ./ShowPopup ./ExportToCSV ./ExportToFeatureCollection ./ExportToGeoJSON ./ShowStatistics ./CreateLayer ./AddMarker ./RemoveMarker ./SaveToMyContent".split(" "),function(){return[{name:"ZoomTo",uri:"jimu/featureActions/ZoomTo"},{name:"PanTo",uri:"jimu/featureActions/PanTo"},{name:"Flash",uri:"jimu/featureActions/Flash"},{name:"ShowPopup",uri:"jimu/featureActions/ShowPopup"},
{name:"ExportToCSV",uri:"jimu/featureActions/ExportToCSV"},{name:"ExportToFeatureCollection",uri:"jimu/featureActions/ExportToFeatureCollection"},{name:"ExportToGeoJSON",uri:"jimu/featureActions/ExportToGeoJSON"},{name:"ShowStatistics",uri:"jimu/featureActions/ShowStatistics"},{name:"CreateLayer",uri:"jimu/featureActions/CreateLayer"},{name:"AddMarker",uri:"jimu/featureActions/AddMarker"},{name:"RemoveMarker",uri:"jimu/featureActions/RemoveMarker"},{name:"SaveToMyContent",uri:"jimu/featureActions/SaveToMyContent"}]})},
"jimu/featureActions/ZoomTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(E,q,A){return E(q,{name:"ZoomTo",iconClass:"icon-zoomto",isFeatureSupported:function(w){return 0<w.features.length&&w.features[0].geometry},onExecute:function(w){A.featureAction.zoomTo(this.map,w.features)}})})},"jimu/BaseFeatureAction":function(){define(["dojo/_base/declare","dojo/_base/lang"],function(E,q){return E(null,{name:void 0,label:void 0,iconFormat:"svg",iconClass:"",map:null,
appConfig:{},widgetId:null,constructor:function(A){q.mixin(this,A)},isFeatureSupported:function(A,w){return!0},onExecute:function(A,w){},setMap:function(A){this.map=A},setAppConfig:function(A){this.appConfig=A},getIcon:function(A){return"framework"===this.widgetId?require.toUrl("jimu")+"/images/feature_actions/"+this.name+"_"+A+"."+this.iconFormat:this.appConfig.getConfigElementById(this.widgetId).folderUrl+"images/"+this.name+"_"+A+"."+this.iconFormat}})})},"jimu/featureActions/PanTo":function(){define(["dojo/_base/declare",
"../BaseFeatureAction","jimu/utils"],function(E,q,A){return E(q,{name:"PanTo",iconClass:"icon-panto",isFeatureSupported:function(w){return 0<w.features.length&&w.geometryType},onExecute:function(w){A.featureAction.panTo(this.map,w.features)}})})},"jimu/featureActions/Flash":function(){define(["dojo/_base/declare","dojo/_base/lang","../BaseFeatureAction","jimu/utils"],function(E,q,A,w){return E([A],{name:"Flash",iconClass:"icon-flash",isFeatureSupported:function(m,v){if(1>m.features.length||!v)return!1;
m=m.features[0];var r=q.getObject("renderer.symbol",!1,v);return m&&m.geometry&&(m.symbol||r)&&this.map.getLayer(v.id)},onExecute:function(m,v){w.featureAction.flash(m&&m.features,v)}})})},"jimu/featureActions/ShowPopup":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(E,q,A){return E([q],{name:"ShowPopup",iconClass:"icon-show-popup",isFeatureSupported:function(w,m){return w&&w.features&&1===w.features.length&&m&&m.infoTemplate},onExecute:function(w){A.featureAction.showPopup(this.map,
w.features)}})})},"jimu/featureActions/ExportToCSV":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(E,q,A){return E(q,{name:"ExportToCSV",iconClass:"icon-export",isFeatureSupported:function(w){return 0<w.features.length},onExecute:function(w){w=A.createDataSource({type:A.TYPE_FEATURESET,filename:"features",data:w});w.setFormat(A.FORMAT_CSV);w.download()}})})},"jimu/exportUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/graphic esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils jimu/LayerInfos/LayerInfos ./utils ./CSVUtils ./GeojsonConverters libs/polyfills/FileSaver".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f){function h(u,t){10>dojo.isIE?saveTextAs(t,u,"utf-8"):(t=new Blob([t],{type:"text/plain;charset\x3dutf-8"}),saveAs(t,u,!0))}var p={createDataSource:function(u){return new B(u)},TYPE_TABLE:"table",TYPE_FEATURESET:"FeatureSet",FORMAT_CSV:"CSV",FORMAT_FEATURESET:"FeatureSet",FORMAT_GEOJSON:"GeoJSON"},B=E(null,{filename:void 0,format:void 0,nls:void 0,data:null,url:null,constructor:function(u){this.nls=window.jimuNls.exportTo;this.data=u.data;this.url=u.url;
this.filename=u.filename},setFormat:function(u){this.format=u},download:function(){if(this.format===p.FORMAT_CSV)return this.exportCSV();if(this.format===p.FORMAT_FEATURESET)return this.exportFeatureCollection();if(this.format===p.FORMAT_GEOJSON)return this.exportGeoJSON()},getFeatureSet:function(){var u=new m;if(this.data)u.resolve(this.data);else if(this.url){var t=new v;t.returnGeometry=!0;t.outFields=["*"];this.queryTask=new r(this.url);this.queryTask.execute(t,q.hitch(this,function(z){u.resolve(z)}),
q.hitch(this,function(){u.resolve(null)}))}else u.resolve(null);return u},findPopupInfo:function(u){if(!u||!u.features||0===u.features.length)return null;u=u.features[0];if(u._layer&&(u=u._layer.id,u=b.getInstanceSync().getLayerInfoById(u))){var t=u.getPopupInfo();t||(t=u.layerObject.infoTemplate&&u.layerObject.infoTemplate.info);return t}return null},findLayerDefinition:function(u){if(!u||!u.features||0===u.features.length)return null;var t=u.features[0];if(t._layer)return{drawingInfo:t._layer.drawingInfo,
geometryType:u.geometryType,fields:t._layer.fields,objectIdField:t._layer.objectIdField,typeIdField:t._layer.typeIdField,types:t._layer.types};var z=[];t=t.attributes;for(var x in t)t.hasOwnProperty(x)&&z.push({name:x});return{geometryType:u.geometryType,fields:z}},_getOutFields:function(u,t){return q.clone(u.fields&&0<u.fields.length?u.fields:t.fields)},formatAttributes:function(u){var t=new m,z=this.findPopupInfo(u),x=this.findLayerDefinition(u);if(z&&x){var y=A.map(u.features,function(D){return D.attributes});
a._formattedData(u.features[0]._layer,{data:y,outFields:this._getOutFields(u,x)},{formatNumber:!0,formatDate:!0,formatCodedValue:!0,popupInfo:z,richText:{}}).then(q.hitch(this,function(D){var H=D.datas;D=new l;var I=[];A.forEach(u.features,function(N,S){N=new k(N.toJson());N.attributes=H[S];I.push(N)});D.features=I;D.geometryType=u.geometryType;D.fieldAliases=u.fieldAliases;D.fields=u.fields;t.resolve(D)}))}else t.resolve(u);return t},exportCSV:function(){return this.getFeatureSet().then(q.hitch(this,
function(u){var t=this.findPopupInfo(u),z=this.findLayerDefinition(u),x=u.features;if(z&&z.fields){var y=this._getOutFields(u,z);this._addXYAttribute(y,"x");this._addXYAttribute(y,"y");z.fields=y;x=[];A.forEach(u.features,q.hitch(this,function(D){D=new k(D.toJson());D.attributes=this._getAttrsWithXY(D);x.push(D)}))}else for(y in z.fields=[],x[0].attributes)z.fields.push({name:y,alias:y});return a.exportCSVByGraphics(this.filename,z,x,{formatNumber:!0,formatDate:!0,formatCodedValue:!0,popupInfo:t})}))},
exportGeoJSON:function(){return this.getFeatureSet().then(q.hitch(this,function(u){return this.formatAttributes(u)})).then(q.hitch(this,function(u){return this._projectToWGS84(u)})).then(q.hitch(this,function(u){var t="";if(u&&u.features&&0<u.features.length){var z={type:"FeatureCollection",features:[]};A.forEach(u.features,function(x){z.features.push(f.arcgisToGeoJSON(x))});t=w.stringify(z)}return t})).then(q.hitch(this,function(u){h(this.filename+".geojson",u)}))},exportFeatureCollection:function(){return this.getFeatureSet().then(q.hitch(this,
function(u){return this.formatAttributes(u)})).then(q.hitch(this,function(u){var t="";u&&(u=u.toJson())&&(t=w.stringify(u));return t})).then(q.hitch(this,function(u){h(this.filename+".json",u)}))},exportToPortal:function(u,t){},_projectToWGS84:function(u){var t=new m,z=this._getSpatialReference(u);if(z)if(4326===parseInt(z.wkid,10))t.resolve(u);else if(z.isWebMercator()){z=new l;var x=[];A.forEach(u.features,function(D){var H=new k(D.toJson());H.geometry=g.webMercatorToGeographic(D.geometry);x.push(H)});
z.features=x;z.geometryType=u.geometryType;z.fieldAliases=u.fieldAliases;z.fields=u.fields;t.resolve(z)}else{z=new d;z.geometries=A.map(u.features,function(D){return D.geometry});z.outSR=new n(4326);var y=c&&c.defaults&&c.defaults.geometryService;y&&"esri.tasks.GeometryService"===y.declaredClass||(y=e.getArcGISDefaultGeometryService());y.project(z).then(function(D){var H=new l,I=[];A.forEach(u.features,function(N,S){N=new k(N.toJson());N.geometry=D[S];I.push(N)});H.features=I;H.geometryType=u.geometryType;
H.fieldAliases=u.fieldAliases;H.fields=u.fields;t.resolve(H)},function(D){console.error(D);t.resolve([])})}else t.resolve([]);return t},_getSpatialReference:function(u){if(u.spatialReference)return u.spatialReference;var t;A.some(u.features,function(z){if(z.geometry&&z.geometry.spatialReference)return t=z.geometry.spatialReference,!0});return t},_getAttrsWithXY:function(u){var t=u.geometry;return t&&"point"===t.type?(u=q.clone(u.attributes),"x"in u?u._x=t.x:u.x=t.x,"y"in u?u._y=t.y:u.y=t.y,u):u.attributes},
_addXYAttribute:function(u,t){var z=A.some(u,function(x){return x.name===t})?"_"+t:t;u.push({name:z,alias:z,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});return u}});return p})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/kernel dojo/has dojo/number dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query esri/graphic jimu/ArcadeUtils".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g,b){function e(a){var f=
q.clone(a.attributes);(a=a.geometry)&&"point"===a.type&&("x"in f?f._x=a.x:f.x=a.x,"y"in f?f._y=a.y:f.y=a.y);return f}E.exportCSV=function(a,f,h){return E._createCSVStr(f,h).then(function(p){return E._download(a+".csv",p)})};E.exportCSVFromFeatureLayer=function(a,f,h){h=h||{};return E._getExportData(f,{datas:h.datas,objectIds:h.objectIds,fromClient:h.fromClient,withGeometry:h.withGeometry,outFields:h.outFields,filterExpression:h.filterExpression,outSpatialReference:h.outSpatialReference,arcadeExpressions:h.arcadeExpressions,
geometry:h.geometry,orderByFields:h.orderByFields,start:h.start,num:h.num}).then(function(p){return E._formattedData(f,p,{formatNumber:h.formatNumber,formatDate:h.formatDate,formatCodedValue:h.formatCodedValue,richText:{clearFormat:h.richTextFieldsToClear&&!!h.richTextFieldsToClear.length,fieldsToClear:h.richTextFieldsToClear||[]},popupInfo:h.popupInfo}).then(function(B){return E.exportCSV(a,B.datas,B.columns)})})};E.exportCSVByAttributes=function(a,f,h,p){p=q.mixin({},p);p.datas=h;return E.exportCSVFromFeatureLayer(a,
f,p)};E.exportCSVByGraphics=function(a,f,h,p){h=A.map(h,function(B){return B.attributes});return E.exportCSVByAttributes(a,f,h,p)};E._createCSVStr=function(a,f){var h=new l,p="",B=0,u=0,t="",z="",x=","===r.format(1.1,{locale:m.locale}).substring(1,2)?";":",",y=";"===x;try{f=A.map(f,function(N){return"string"===typeof N?{name:N}:N});A.forEach(f,function(N){N=N.alias||N.name;-1<N.toString().indexOf(x)&&(N='"'+N+'"');p=p+t+N;t=x});p+="\r\n";B=a.length;u=f.length;for(var D=0;D<B;D++){t="";for(var H=0;H<
u;H++){(z=a[D][f[H].name])||"number"===typeof z||(z="");if("string"===typeof z){var I=!1;(I=";"===x?/[";\r\n]/g.test(z):/[",\r\n]/g.test(z))&&(z='"'+z.replace(/(")/g,'""')+'"')}else y&&"number"===typeof z&&(z='"'+z.toLocaleString(m.locale)+'"');p=p+t+z;t=x}p+="\r\n"}h.resolve(p)}catch(N){console.error(N),h.resolve("")}return h};E._isIE11=function(){return 11===k.has("ie")};E._isEdge=function(){return k.has("edge")};E._getDownloadUrl=function(a){return window.Blob&&window.URL&&window.URL.createObjectURL?
(a=new Blob(["\ufeff"+a],{type:"text/csv"}),URL.createObjectURL(a)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(a)};E._download=function(a,f){var h=new l;try{if(v("ie")&&10>v("ie")){var p=window.top.open("about:blank","_blank");p.document.write("sep\x3d,\r\n"+f);p.document.close();p.document.execCommand("SaveAs",!0,a);p.close()}else if(10===v("ie")||E._isIE11()||E._isEdge()){var B=new Blob(["\ufeff"+f],{type:"text/csv"});navigator.msSaveBlob(B,a)}else{var u=w.create("a",{href:E._getDownloadUrl(f),
target:"_blank",download:a},document.body);if(v("safari")){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0);u.dispatchEvent(t)}else u.click();w.destroy(u)}h.resolve()}catch(z){h.reject(z)}return h};E._getExportData=function(a,f){var h=new l,p=null,B=[],u=f.datas,t=f.withGeometry,z=!!f.arcadeExpressions;p=f.outFields;p&&p.length||(p=a.fields);p=q.clone(p);if(t&&!(u&&0<u.length)){z?(B=A.filter(a.fields,function(y){return-1===y.name.indexOf("expression/")}),B=q.clone(B)):B=q.clone(p);
var x="";x=-1!==p.indexOf("x")?"_x":"x";p.push({name:x,alias:x,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});x=-1!==p.indexOf("y")?"_y":"y";p.push({name:x,alias:x,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}u&&0<u.length?(z&&(u=E._getAttrsWithExpressionsBatch(u,f.arcadeExpressions)),h.resolve({data:u||[],outFields:p})):f.fromClient?(u=A.map(a.graphics,function(y){y=t?e(y):q.clone(y);return y=z?E._getAttrsWithExpressions(y,f.arcadeExpressions):
y}),h.resolve({data:u||[],outFields:p})):E._getExportDataFromServer(a,B,f).then(function(y){z&&(y=E._getAttrsWithExpressionsBatch(y,f.arcadeExpressions));h.resolve({data:y||[],outFields:p})});return h};E._getExportDataFromServer=function(a,f,h){var p=new l;if("esri.layers.FeatureLayer"!==a.declaredClass)return p.resolve([]),p;var B=new d(a.url),u=new c;u.where=h.filterExpression||a.getDefinitionExpression&&a.getDefinitionExpression()||"1\x3d1";0<f.length?(a=A.map(f,function(t){return t.name}),u.outFields=
a):u.outFields=["*"];u.objectIds=h.objectIds;u.returnGeometry=h.withGeometry;u.outSR=h.spatialReference;u.geometry=h.geometry;u.orderByFields=h.orderByFields;u.start=h.start;u.num=h.num;u.outSpatialReference=h.outSpatialReference;B.execute(u,function(t){t=A.map(t.features,function(z){return e(z)});p.resolve(t)},function(t){console.error(t);p.resolve([])});return p};E._formattedData=function(a,f,h){var p=new l,B=[],u=f.data;f=f.outFields;a=E._getDomainValuesMap(a,f,u);for(var t=0,z=u.length;t<z;t++){for(var x=
{},y=0;y<f.length;y++){var D=f[y];x[D.name]=a[D.name]?a[D.name][t].displayValue:E._getExportValue(u[t],D,h)}B.push(x)}h=A.map(f,function(H){return{alias:H.alias,name:H.name}});p.resolve({datas:B,columns:h});return p};E._getDomainValuesMap=function(a,f,h){var p={};A.forEach(f,function(B){var u=k.getDisplayValueForCodedValueOrSubtype(a,B.name,h[0]);p[B.name]=u.isCodedValueOrSubtype?k.getDisplayValueForCodedValueOrSubtypeBatch(a,B.name,h):!1});return p};E._getExportValue=function(a,f,h){function p(y){if(t&&
n.isDefined(t.fieldInfos))for(var D=0,H=t.fieldInfos.length;D<H;D++){var I=t.fieldInfos[D];if(I.fieldName===y)return I.format}return null}function B(y){for(var D=0,H=z.length;D<H;D++)if(z[D].fieldName===y)return!0;return!1}var u=a[f.name],t=h.popupInfo,z=h.richText.fieldsToClear,x="esriFieldTypeDate"===f.type&&h.formatDate;B="esriFieldTypeString"===f.type&&h.richText.clearFormat&&B(f.name);return x?k.fieldFormatter.getFormattedDate(u,p(f.name)):B?u?(a=document.createElement("span"),a.innerHTML=u,
a.textContent||a.innerText||""):u:a[f.name]};E._getAttrsWithExpressions=function(a,f){var h=q.getObject("expressionInfos",!1,f);f=q.getObject("layerDefinition",!1,f);var p=new g(null,null,a);return b.customExpr.getAttributesFromCustomArcadeExpr(h,p,f)||a};E._getAttrsWithExpressionsBatch=function(a,f){var h=[];return h=A.map(a,function(p){return E._getAttrsWithExpressions(p,f)})}})},"jimu/ArcadeUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/string esri/arcade/arcade esri/arcade/Feature esri/ArcadeExpression esri/arcadeProfiles/popupProfile esri/tasks/RelationshipQuery jimu/utils jimu/LayerStructure".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c){var g={readExprInfo:{}};g.readExprInfo.getArcadeProfilesByType=function(b,e,a){b={map:b,layer:e};return"render"===a?g.readExprInfo._getArcadeRender(b):"label"===a?g.readExprInfo._getArcadeLabel(b):"infoTemplate"===a?g.readExprInfo._getArcadeInfoTemplate(b):g.readExprInfo._getAllArcade(b)};g.readExprInfo._getArcadeRender=function(b){return g.readExprInfo._lookupArcadeRender({layers:g.readExprInfo._checkPassInLayer(b)})};g.readExprInfo._getArcadeInfoTemplate=function(b){return g.readExprInfo._lookupArcadeInfoTemplate({layers:g.readExprInfo._checkPassInLayer(b)})};
g.readExprInfo._getArcadeLabel=function(b){return g.readExprInfo._lookupArcadeLabel({layers:g.readExprInfo._checkPassInLayer(b)})};g.readExprInfo._getAllArcade=function(b){var e=g.readExprInfo._getArcadeRender(b),a=g.readExprInfo._getArcadeInfoTemplate(b);b=g.readExprInfo._getArcadeLabel(b);return{render:e,infoTemplate:a,label:b}};g.readExprInfo._checkPassInLayer=function(b){var e=[];return e="undefined"!==typeof b?"undefined"!==typeof b.layer?null!==b.layer&&""!==b.layer?g.readExprInfo._getAllMapLayers(b):
g.readExprInfo._getAllMapLayers():g.readExprInfo._getAllMapLayers():g.readExprInfo._getAllMapLayers()};g.readExprInfo._getAllMapLayers=function(b){var e="",a=[],f=c.getInstance();b&&b.layer&&(e=b.layer.id);""!==e?(b=f.getNodeById(e))&&a.push(b._layerInfo.layerObject):f.traversal(function(h){"undefined"!==typeof h._layerInfo.layerObject.type?-1===h._layerInfo.layerObject.type.indexOf("tile")&&a.push(h._layerInfo.layerObject):a.push(h._layerInfo.layerObject)});return a};g.readExprInfo._lookupArcadeRender=
function(b){var e=[];0<b.layers.length&&E.forEach(b.layers,q.hitch(this,function(a){var f={};if("undefined"!==typeof a.renderer){var h=a.renderer;"undefined"!==typeof h.valueExpression&&(f.layer=a.id,f.valueExpression=h.valueExpression,f.valueExpressionTitle=h.valueExpressionTitle,"undefined"!==typeof h.values&&(f.values=h.values),"undefined"!==typeof h.visualVariables&&(f.visualVariables=h.visualVariables));1<Object.keys(f).length&&f.constructor===Object?e.push(f):e.push({layer:a.id,valueExpression:null,
valueExpressionTitle:null,values:null,visualVariables:null})}}));return e};g.readExprInfo._lookupArcadeInfoTemplate=function(b){var e=[];0<b.layers.length&&E.forEach(b.layers,q.hitch(this,function(a){var f={};if("undefined"!==typeof a.infoTemplate)"undefined"!==typeof a.infoTemplate.info.expressionInfos&&0<a.infoTemplate.info.expressionInfos.length&&(f.layer=a.id,f.expressionInfos=a.infoTemplate.info.expressionInfos);else if("undefined"!==typeof a.infoTemplates)for(var h in a.infoTemplates)if(a.infoTemplates.hasOwnProperty(h)&&
"undefined"!==typeof a.infoTemplates[h].infoTemplate.info.expressionInfos){var p=a.infoTemplates[h].infoTemplate;0<p.info.expressionInfos.length&&(f.layer=a.id,f.expressionInfos=p.info.expressionInfos)}1<Object.keys(f).length&&f.constructor===Object?e.push(f):e.push({layer:a.id,expressionInfos:null})}));return e};g.readExprInfo._lookupArcadeLabel=function(b){var e=[];0<b.layers.length&&E.forEach(b.layers,q.hitch(this,function(a){var f={};"undefined"!==typeof a.labelingInfo&&E.forEach(a.labelingInfo,
q.hitch(this,function(h){"undefined"!==typeof h.name&&(f.layer=a.id,f.name=h.name,f.labelingInfo=h,f.expression=h.labelExpressionInfo.expression)}));1<Object.keys(f).length&&f.constructor===Object?e.push(f):e.push({layer:a.id,name:null,labelingInfo:null,expression:null})}));return e};g.compileExpressions=function(b){var e={};E.forEach(b,function(a){a.returnType&&a.returnType.toLowerCase();e[a.name]=new l({expression:a.expression,returnType:"number"===a.returnType?"number":"string",profile:k})});return e};
g.isAsync=function(b,e,a){var f="",h;for(h in e)if(0<=b.indexOf("expression/")&&h===b.split("expression/")[1]){f=h;break}return(b=(e?e:g.compileExpressions(a))[f])&&k.isAsync(b)};g.customExpr={};g.customExpr.getAttributesFromCustomArcadeExpr=function(b,e,a){b=g.InfoTemplate._parseArcadeExpressions(b);return g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(e,b,a)};g.customExpr.getAsynAttributesFromCustomArcadeExpr=function(b,e,a,f){var h=q.mixin({},e.attributes);if(b)for(var p in b)h["expression/"+
p]=e.evaluateExpression(b[p],k.getEvalOptions({expression:b[p],feature:e,layer:a,map:f,spatialReference:f&&f.spatialReference}));return h};g.customExpr.getAttributesValueFromCustomArcadeExprBatch=function(b,e,a){var f=[],h;for(h in e)f.push(e[h]);e=g.InfoTemplate._parseArcadeExpressions(b);b=g.InfoTemplate._getExprNamesArrayFromPopupExprInfos(b);b.relationships=null;b.parsedExpressions=e;var p=new A;g.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(f,b,a).then(function(B){p.resolve(B)});return p};
g.InfoTemplate={};g.InfoTemplate.getAttributesFromInfoTemplate=function(b,e,a){var f={fields:[]};e.layerObject&&e.layerObject.fields&&(f.fields=e.layerObject.fields);b=g.readExprInfo.getArcadeProfilesByType(b,e,"infoTemplate")[0].expressionInfos;if(!b)return a.attributes;b=g.InfoTemplate._parseArcadeExpressions(b);return g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(a,b,f)};g.InfoTemplate.getAttributesValueFromInfoTemplateBatch=function(b,e,a){var f={fields:[]};e.layerObject&&e.layerObject.fields&&
(f.fields=e.layerObject.fields);var h=[];for(B in a)h.push(a[B]);b=g.readExprInfo.getArcadeProfilesByType(b,e,"infoTemplate")[0].expressionInfos;var p=new A;if(!b)return p.resolve([]),p;a=g.InfoTemplate._parseArcadeExpressions(b);var B=null;B=e.getPopupInfo().description;null!==B?(B=g.InfoTemplate._convertPopupDescToFieldNamesArray(B),B.relationships=g.InfoTemplate._getRelationshipQueries(e)):(B=g.InfoTemplate._getExprNamesArrayFromPopupExprInfos(b),B.relationships=null);B.parsedExpressions=a;g.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(h,
B,f).then(function(u){p.resolve(u)});return p};g.InfoTemplate._getRelationshipQueries=function(b){var e=!1,a={},f=/\d+/,h;if(h=b.getPopupInfo().description.match(/\{relationships\/\d+\//gm))e=!0,E.forEach(h,function(p){var B=p.match(f)[0];a.hasOwnProperty(B)||(p=new n,p.outFields=["*"],p.relationshipId=B,p.returnGeometry=!1,a[B]={operLayer:b,relatedQuery:p})});return e?a:null};g.InfoTemplate._getExprNamesArrayFromPopupExprInfos=function(b){var e=[],a;for(a in b)e.push("${expression/"+b[a].name+"}");
return e};g.InfoTemplate._convertPopupDescToFieldNamesArray=function(b){b=g.InfoTemplate._convertEndParasToEOLs(b);b=g.InfoTemplate._convertBreaksToEOLs(b);b=g.InfoTemplate._sanitizeNoTags(b).trim();b=b.replace(/\{/gi,"${");b=b.replace(/\u00a0/gi," ");b=b.split("\n");return b=E.map(b,function(e){return e.trim()})};g.InfoTemplate._sanitizeNoTags=function(b){var e=d.sanitizeHTML(b);b=RegExp("\x3c(?:!--(?:(?:-*[^-\x3e])*--+|-?)|script\\b(?:[^\"'\x3e]|\"[^\"]*\"|'[^']*')*\x3e[\\s\\S]*?\x3c/script\\s*|style\\b(?:[^\"'\x3e]|\"[^\"]*\"|'[^']*')*\x3e[\\s\\S]*?\x3c/style\\s*|/?[a-z](?:[^\"'\x3e]|\"[^\"]*\"|'[^']*')*)\x3e",
"gi");do{var a=e;e=e.replace(b,"")}while(e!==a);return e=e.replace(/</g,"\x26lt;")};g.InfoTemplate._getPopupFieldsValueFromArcadeFeatures=function(b,e,a){var f=new A,h=[],p=[],B=0;e.relationships?(E.forEach(b,function(u){g.InfoTemplate._objEach(e.relationships,function(t,z){var x=new A,y=t.relatedQuery;p.push(x);var D=u.attributes[t.operLayer.layerObject.objectIdField];y.objectIds=[D];t.operLayer.layerObject.queryRelatedFeatures(y,function(H){var I=[];H[D]&&H[D].features&&(H=H[D].features,E.forEach(H,
function(N){var S=[],M;var Q=u.attributes;var da="relationships/"+z+"/";g.InfoTemplate._objEach(N.attributes,function(J,R){M=da+R;Q[M]=J});E.forEach(e,function(J){S.push(m.substitute(J,g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(u,e.parsedExpressions,a),g.InfoTemplate._useEmptyStringForNull))});I.push(S)}));x.resolve(I)})})}),w(p).then(function(u){E.forEach(u,function(t){E.forEach(t,function(z){++B;h.push(z)})});console.log(B+" related address features found");f.resolve(h)})):
(E.forEach(b,function(u){var t=[];E.forEach(e,function(z){t.push(m.substitute(z,g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(u,e.parsedExpressions,a),g.InfoTemplate._useEmptyStringForNull))});h.push(t)}),f.resolve(h));return f};g.InfoTemplate._parseArcadeExpressions=function(b){if(Array.isArray(b)&&0<b.length){var e={};E.forEach(b,function(a){e[a.name]=v.parseScript(a.expression)})}return e};g.InfoTemplate._initArcadeContext=function(b,e){var a={vars:{}};a.vars.$feature=r.createFromGraphicLikeObject(b.geometry,
b.attributes,e);return a};g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions=function(b,e,a){var f;var h=q.mixin({},b.attributes);if(e)for(f in b=g.InfoTemplate._initArcadeContext(b,a),e)a=v.executeScript(e[f],b),h["expression/"+f]=a?a.toString():"";return h};g.InfoTemplate._convertEndParasToEOLs=function(b){var e=b;b=b.match(/<\/p>/gi);E.forEach(b,function(a){e=e.replace(a,"\n")});return e};g.InfoTemplate._convertBreaksToEOLs=function(b){var e=b;b=b.match(/<br\s*\/?>/gi);E.forEach(b,
function(a){e=e.replace(a,"\n")});return e};g.InfoTemplate._useEmptyStringForNull=function(b){return b?b:""};g.InfoTemplate._objEach=function(b,e,a){for(var f in b)b.hasOwnProperty(f)&&e.call(a,b[f],f)};return g})},"jimu/LayerStructure":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/on dojo/Evented ./LayerInfos/LayerInfos".split(" "),function(E,q,A,w,m,v){var r=E([m],{declaredClass:"jimu.LayerStructure",map:null,_layerInfos:null,_eventHandles:null,constructor:function(k){this._layerInfos=
k;this.map=this._layerInfos.map;this._eventHandles=[];this._bindEvents()},getLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArray())},getTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArray())},getBasemapLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getBasemapLayerInfoArray())},getWebmapLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArrayOfWebmap())},
getWebmapTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArrayOfWebmap())},addTable:function(k){var n=null;if(k=this._layerInfos.addTable(k))n=k._adaptor;return n},removeTable:function(k){(k=this.getNodeById(k))&&this._layerInfos.removeTable(k._layerInfo)},_traversal:function(k,n){for(var d=0;d<n.length;d++)if(n[d].traversal(k))return!0;return!1},traversal:function(k){return this._traversal(k,this.getLayerNodes().concat(this.getBasemapLayerNodes().concat(this.getTableNodes())))},
traversalWithNodes:function(k,n){return this._traversal(k,n)},getNodeById:function(k){var n=null;this.traversal(function(d){if(d.id===k)return n=d,!0});return n},getBasemapLayerObjects:function(){return this._layerInfos.getBasemapLayers()},restoreState:function(k){this._layerInfos.restoreState(k)},destroy:function(){q.forEach(this._eventHandles,function(k){k.remove()});this.inherited(arguments)},_getNodesArrayFromInfosArray:function(k){var n=[];q.forEach(k,function(d){n.push(d._adaptor)},this);return n},
_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(k){console.warn(k)}},_bindEvents:function(){var k=w(this._layerInfos,"layerInfosChanged",A.hitch(this,this._onLayerNodesStructureChanged));this._eventHandles.push(k);k=w(this._layerInfos,"basemapLayerInfosChanged",A.hitch(this,this._onLayerNodesStructureChanged));this._eventHandles.push(k);k=w(this._layerInfos,"tableInfosChanged",A.hitch(this,this._onTableNdoesStructureChanged));this._eventHandles.push(k);k=w(this._layerInfos,"layerInfosReorder",
A.hitch(this,this._onLayerReordered));this._eventHandles.push(k);k=w(this._layerInfos,"layerInfosIsShowInMapChanged",A.hitch(this,this._onVisibilityChanged));this._eventHandles.push(k);k=w(this._layerInfos,"layerInfosIsVisibleChanged",A.hitch(this,this._onToggleChanged));this._eventHandles.push(k);k=w(this._layerInfos,"layerInfosFilterChanged",A.hitch(this,this._onFilterChanged));this._eventHandles.push(k);k=w(this._layerInfos,"layerInfosRendererChanged",A.hitch(this,this._onRendererChanged));this._eventHandles.push(k);
k=w(this._layerInfos,"layerInfosOpacityChanged",A.hitch(this,this._onOpacityChanged));this._eventHandles.push(k);k=w(this._layerInfos,"layerInfosTimeExtentChanged",A.hitch(this,this._onTimeExtentChanged));this._eventHandles.push(k)},_onLayerNodesStructureChanged:function(k,n,d){this._emitEvent(r.EVENT_STRUCTURE_CHANGE,{type:n,layerNodes:[d._adaptor],rootLayerNodes:[k._adaptor]})},_onTableNdoesStructureChanged:function(k,n){k=this._getNodesArrayFromInfosArray(k);this._emitEvent(r.EVENT_STRUCTURE_CHANGE,
{type:n,layerNodes:k,rootLayerNodes:k})},_onLayerReordered:function(k,n){k=k?[k._adaptor]:[];this._emitEvent(r.EVENT_STRUCTURE_CHANGE,{type:n,layerNodes:k,rootLayerNodes:k})},_onVisibilityChanged:function(k){k={layerNodes:this._getNodesArrayFromInfosArray(k)};this._emitEvent(r.EVENT_VISIBILITY_CHANGE,k)},_onToggleChanged:function(k){k={layerNodes:this._getNodesArrayFromInfosArray(k)};this._emitEvent(r.EVENT_TOOGLE_CHANGE,k)},_onFilterChanged:function(k){k={layerNodes:this._getNodesArrayFromInfosArray(k)};
this._emitEvent(r.EVENT_FILTER_CHANGE,k)},_onRendererChanged:function(k){k={layerNodes:this._getNodesArrayFromInfosArray(k)};this._emitEvent(r.EVENT_RENDERER_CHANGE,k)},_onOpacityChanged:function(k){k={layerNodes:this._getNodesArrayFromInfosArray(k)};this._emitEvent(r.EVENT_OPACITY_CHANGE,k)},_onTimeExtentChanged:function(k){k={layerNodes:this._getNodesArrayFromInfosArray(k)};this._emitEvent(r.EVENT_TIME_EXTENT_CHANGE,k)}}),l=null;r.getInstance=function(){l&&l._layerInfos._objectId===v.getInstanceSync()._objectId||
(l&&l.destroy(),l=new r(v.getInstanceSync()));return l};r.createInstance=function(k){return new r(v.createInstance(k))};A.mixin(r,{STRUCTURE_CHANGE_ADD:v.ADDED,STRUCTURE_CHANGE_REMOVE:v.REMOVED,STRUCTURE_CHANGE_SUBNODE_ADD:v.SUBLAYER_ADDED,STRUCTURE_CHANGE_SUBNODE_REMOVE:v.SUBLAYER_REMOVED,STRUCTURE_CHANGE_NODE_UPDATE:v.UPDATED,STRUCTURE_CHANGE_REORDER:v.REORDERED,EVENT_STRUCTURE_CHANGE:"structure-change",EVENT_TOOGLE_CHANGE:"toggle-change",EVENT_VISIBILITY_CHANGE:"visibility-change",EVENT_FILTER_CHANGE:"filter-change",
EVENT_RENDERER_CHANGE:"renderer-change",EVENT_OPACITY_CHANGE:"opacity-change",EVENT_TIME_EXTENT_CHANGE:"time-extent-change"});return r})},"jimu/GeojsonConverters":function(){define([],function(){function E(r){a:{var l=r[0];for(var k=0;k<l.length;k++)if(l[k]!==r[r.length-1][k]){l=!1;break a}l=!0}l||r.push(r[0]);return r}function q(r){var l=0,k=0,n=r.length,d=r[k];for(k;k<n-1;k++){var c=r[k+1];l+=(c[0]-d[0])*(c[1]+d[1]);d=c}return 0<=l}function A(r,l){for(var k=0;k<r.length-1;k++)for(var n=0;n<l.length-
1;n++){a:{var d=r[k],c=r[k+1],g=l[n],b=l[n+1],e=(b[0]-g[0])*(d[1]-g[1])-(b[1]-g[1])*(d[0]-g[0]);var a=(c[0]-d[0])*(d[1]-g[1])-(c[1]-d[1])*(d[0]-g[0]);d=(b[1]-g[1])*(c[0]-d[0])-(b[0]-g[0])*(c[1]-d[1]);if(0!==d&&(e/=d,a/=d,0<=e&&1>=e&&0<=a&&1>=a)){a=!0;break a}a=!1}if(a)return!0}return!1}function w(r){var l=[];r=r.slice(0);var k=E(r.shift().slice(0));if(4<=k.length)for(q(k)||k.reverse(),l.push(k),k=0;k<r.length;k++){var n=E(r[k].slice(0));4<=n.length&&(q(n)&&n.reverse(),l.push(n))}return l}function m(r){var l=
{},k;for(k in r)r.hasOwnProperty(k)&&(l[k]=r[k]);return l}var v={arcgisToGeoJSON:function(r,l){var k={};"number"===typeof r.x&&"number"===typeof r.y&&(k.type="Point",k.coordinates=[r.x,r.y]);r.points&&(k.type="MultiPoint",k.coordinates=r.points.slice(0));r.paths&&(1===r.paths.length?(k.type="LineString",k.coordinates=r.paths[0].slice(0)):(k.type="MultiLineString",k.coordinates=r.paths.slice(0)));if(r.rings){var n=r.rings.slice(0);k=[];var d=[],c,g;for(g=0;g<n.length;g++){var b=E(n[g].slice(0));4>
b.length||(q(b)?k.push([b]):d.push(b))}for(b=[];d.length;){g=d.pop();var e=!1;for(n=k.length-1;0<=n;n--){var a=c=k[n][0],f=g;c=A(a,f);f=f[0];for(var h=!1,p=-1,B=a.length,u=B-1;++p<B;u=p)(a[p][1]<=f[1]&&f[1]<a[u][1]||a[u][1]<=f[1]&&f[1]<a[p][1])&&f[0]<(a[u][0]-a[p][0])*(f[1]-a[p][1])/(a[u][1]-a[p][1])+a[p][0]&&(h=!h);a=h;if(!c&&a){k[n].push(g);e=!0;break}}e||b.push(g)}for(;b.length;){g=b.pop();d=!1;for(n=k.length-1;0<=n;n--)if(c=k[n][0],A(c,g)){k[n].push(g);d=!0;break}d||k.push([g.reverse()])}k=1===
k.length?{type:"Polygon",coordinates:k[0]}:{type:"MultiPolygon",coordinates:k}}if(r.geometry||r.attributes)k.type="Feature",k.geometry=r.geometry?v.arcgisToGeoJSON(r.geometry):null,k.properties=r.attributes?m(r.attributes):null,r.attributes&&(k.id=r.attributes[l]||r.attributes.OBJECTID||r.attributes.FID);return k},geojsonToArcGIS:function(r,l){l=l||"OBJECTID";var k={wkid:4326},n={};switch(r.type){case "Point":n.x=r.coordinates[0];n.y=r.coordinates[1];n.spatialReference=k;break;case "MultiPoint":n.points=
r.coordinates.slice(0);n.spatialReference=k;break;case "LineString":n.paths=[r.coordinates.slice(0)];n.spatialReference=k;break;case "MultiLineString":n.paths=r.coordinates.slice(0);n.spatialReference=k;break;case "Polygon":n.rings=w(r.coordinates.slice(0));n.spatialReference=k;break;case "MultiPolygon":l=n;r=r.coordinates.slice(0);for(var d=[],c=0;c<r.length;c++)for(var g=w(r[c]),b=g.length-1;0<=b;b--){var e=g[b].slice(0);d.push(e)}l.rings=d;n.spatialReference=k;break;case "Feature":r.geometry&&
(n.geometry=v.geojsonToArcGIS(r.geometry,l));n.attributes=r.properties?m(r.properties):{};r.id&&(n.attributes[l]=r.id);break;case "FeatureCollection":n=[];for(k=0;k<r.features.length;k++)n.push(v.geojsonToArcGIS(r.features[k],l));break;case "GeometryCollection":for(n=[],k=0;k<r.geometries.length;k++)n.push(v.geojsonToArcGIS(r.geometries[k],l))}return n}};return v})},"libs/polyfills/FileSaver":function(){(function(E,q){"function"==typeof define&&define.amd?define([],q):"undefined"!=typeof exports?
q():(q(),E.FileSaver={})})(this,function(){function E(r,l){return"undefined"==typeof l?l={autoBom:!1}:"object"!=typeof l&&(console.warn("Depricated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(r.type)?new Blob(["\ufeff",r],{type:r.type}):r}function q(r,l,k){var n=new XMLHttpRequest;n.open("GET",r);n.responseType="blob";n.onload=function(){v(n.response,l,k)};n.onerror=function(){console.error("could not download file")};
n.send()}function A(r){var l=new XMLHttpRequest;return l.open("HEAD",r,!1),l.send(),200<=l.status&&299>=l.status}function w(r){try{r.dispatchEvent(new MouseEvent("click"))}catch(k){var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null);r.dispatchEvent(l)}}var m="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,v=m.saveAs||("object"!=
typeof window||window!==m?function(){}:"download"in HTMLAnchorElement.prototype?function(r,l,k){var n=m.URL||m.webkitURL,d=document.createElement("a");l=l||r.name||"download";d.download=l;d.rel="noopener";"string"==typeof r?(d.href=r,d.origin===location.origin?w(d):A(d.href)?q(r,l,k):w(d,d.target="_blank")):(d.href=n.createObjectURL(r),setTimeout(function(){n.revokeObjectURL(d.href)},4E4),setTimeout(function(){w(d)},0))}:"msSaveOrOpenBlob"in navigator?function(r,l,k){if(l=l||r.name||"download","string"!=
typeof r)navigator.msSaveOrOpenBlob(E(r,k),l);else if(A(r))q(r,l,k);else{var n=document.createElement("a");n.href=r;n.target="_blank";setTimeout(function(){w(n)})}}:function(r,l,k,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof r)return q(r,l,k);l="application/octet-stream"===r.type;k=/constructor/i.test(m.HTMLElement)||m.safari;var d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||l&&k)&&"object"==typeof FileReader){var c=new FileReader;
c.onloadend=function(){var e=c.result;e=d?e:e.replace(/^data:[^;]*;/,"data:attachment/file;");n?n.location.href=e:location=e;n=null};c.readAsDataURL(r)}else{var g=m.URL||m.webkitURL,b=g.createObjectURL(r);n?n.location=b:location.href=b;n=null;setTimeout(function(){g.revokeObjectURL(b)},4E4)}});m.saveAs=v.saveAs=v;"undefined"!=typeof module&&(module.exports=v)})},"jimu/featureActions/ExportToFeatureCollection":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(E,
q,A){return E(q,{name:"ExportToFeatureCollection",iconClass:"icon-export",isFeatureSupported:function(w){return 0<w.features.length&&w.features[0].geometry},onExecute:function(w){w=A.createDataSource({type:A.TYPE_FEATURESET,filename:"features",data:w});w.setFormat(A.FORMAT_FEATURESET);w.download()}})})},"jimu/featureActions/ExportToGeoJSON":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(E,q,A){return E(q,{name:"ExportToGeoJSON",iconClass:"icon-export",isFeatureSupported:function(w){return 0<
w.features.length&&w.features[0].geometry},onExecute:function(w){w=A.createDataSource({type:A.TYPE_FEATURESET,filename:"features",data:w});w.setFormat(A.FORMAT_GEOJSON);w.download()}})})},"jimu/featureActions/ShowStatistics":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/dijit/FieldStatistics"],function(E,q,A){return E(q,{iconClass:"icon-statistics",isFeatureSupported:function(w,m){return 1<w.features.length&&m&&"esri.layers.GraphicsLayer"!==m.declaredClass&&0<this.getNumbericFields(m).length},
onExecute:function(w,m){var v=new A;w={featureSet:w,layer:m,fieldNames:this.getNumbericFields(m).map(function(r){return r.name})};v.showContentAsPopup(w)},getNumbericFields:function(w){return w.fields.filter(function(m){return-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(m.type)})}})})},"jimu/dijit/FieldStatistics":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/NodeList-manipulate dojo/when jimu/dijit/formSelect esri/lang jimu/dijit/Popup jimu/dijit/LoadingIndicator jimu/utils jimu/statisticsUtils".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e){return E([q],{statInfo:null,postMixInProperties:function(){this.nls=window.jimuNls.fieldStatistics;A.mixin(this.nls,window.jimuNls.common)},showContent:function(a){this.statInfo=a;0!==this.statInfo.fieldNames.length&&(a=w.create("div",{className:"stat-container"},this.domNode),this._createFieldDom(a),1===this.statInfo.fieldNames.length&&(this.statInfo.fieldName=this.statInfo.fieldNames[0],this._showOneFieldStatContent(this.statInfo,a)))},showContentAsPopup:function(a){this.statInfo=
a;this._statisticsPopup&&this._statisticsPopup.domNode&&this._statisticsPopup.close();this._statisticsPopup=null;this._statisticsPopup=new c({titleLabel:this.nls.statistics,content:this.domNode,width:270,height:265,buttons:[{label:this.nls.ok}]});this.showContent(a)},_showOneFieldStatContent:function(a,f){if(e.isStatFromServer(this.statInfo)){var h=new g;h.placeAt(f);h.show()}e.getStatisticsResult(this.statInfo).then(A.hitch(this,function(p){h&&h.destroy();r(".esriAGOTableStatistics",f).remove();
p=this._createStatContent(p);w.place(p,f)}))},_getFieldAliaseFromStatInfo:function(a){var f=this.statInfo.featureSet;(f=f&&f.fieldAliases)&&"undefined"!==typeof f[a]?f=f[a]:this.statInfo.layer?(f=m.filter(this.statInfo.layer.fields,function(h){return h.name===a}),f=f[0]?f[0].alias:""):f=a;return f},_createFieldDom:function(a){if(1<this.statInfo.fieldNames.length){var f=w.create("div",{className:"header"},a);w.create("span",{innerHTML:this.nls.field+": "},f);var h=new n({options:this.statInfo.fieldNames.map(A.hitch(this,
function(p){return{value:p,label:this._getFieldAliaseFromStatInfo(p)}})),style:{width:"150px"},"aria-label":this.nls.field});this.own(v(h,"change",A.hitch(this,function(p){this.statInfo.fieldName=p;this._showOneFieldStatContent(this.statInfo,a)})));h.placeAt(f);this.statInfo.fieldName=this.statInfo.fieldNames[0];this._showOneFieldStatContent(this.statInfo,a)}else f=w.create("div",{className:"header",innerHTML:"\x3cspan\x3e"+this.nls.field+"\x3c/span\x3e: "+this._getFieldAliaseFromStatInfo(this.statInfo.fieldNames[0])},
a);return f},_createStatContent:function(a){var f={},h="count sum min max ave stddev".split(" "),p;var B=w.create("div",{className:"esriAGOTableStatistics",innerHTML:""});w.create("div",{className:"hzLine",innerHTML:""},B);var u=w.create("table",{className:"attrTable",tabindex:"0",innerHTML:"",style:{cellpadding:0,cellspacing:0}},B);for(t in a)a.hasOwnProperty(t)&&(f[t.toLowerCase()]=a[t]);var t=f.countfield;var z=f.sumfield||"";var x=f.minfield||"";var y=f.maxfield||"";a=f.avgfield||"";f=f.stddevfield||
"";var D=w.create("tbody",{},u);var H=this;m.forEach([t,z,x,y,a,f],function(I,N){""!==I&&(p=w.create("tr",{valign:"top"},D),w.create("td",{"class":"attrName",innerHTML:H.nls[h[N]]},p),w.create("td",{"class":"attrValue",innerHTML:I},p))});w.create("div",{className:"break",innerHTML:""},B);return B}})})},"jimu/dijit/formSelect":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/query dojo/_base/array dojo/dom-construct dijit/form/Select".split(" "),function(E,q,A,w,m,
v,r,l){return E([l],{postCreate:function(){this.inherited(arguments);var k=this["aria-label"],n=this["aria-labelledby"];if(k&&"focusNode"!==k){var d='\x3ccaption class\x3d"screen-readers-only-no-position"\x3e'+k+"\x3c/caption\x3e";k=q.toDom(d);r.place(k,this.domNode,"first")}else n?setTimeout(A.hitch(this,function(){var c=n.split(" "),g=[];v.forEach(c,function(b){(b=m("#"+b)[0])&&""!==b&&b.innerHTML&&g.push(b.innerHTML)});0<g.length&&(d='\x3ccaption class\x3d"screen-readers-only-no-position"\x3e'+
g.join(" ")+"\x3c/caption\x3e",c=q.toDom(d),r.place(c,this.domNode,"first"))}),1E3):(this.setAttrs=function(){this.domNode.title="";var c=this.get("value");c&&(c=this.getOptions(c),this.domNode.title=c.label,q.setAttr(this.domNode,"aria-label",c.label))},this.setAttrs(),w(this,"change",A.hitch(this,this.setAttrs)))}})})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p){function B(t){return function(z){this._isLoaded?this.inherited(t,arguments):this.loadDropDown(l.hitch(this,t,z))}}var u=q("dijit.form._SelectMenu",g,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(k(this.domNode,"selectstart",function(t){t.preventDefault();t.stopPropagation()}))},focus:function(){var t=!1,z=this.parentWidget.value;
l.isArray(z)&&(z=z[z.length-1]);z&&E.forEach(this.parentWidget._getChildren(),function(x){x.option&&z===x.option.value&&(t=!0,this.focusChild(x,!1))},this);t||this.inherited(arguments)}});m=q("dijit.form.Select"+(n("dojo-bidi")?"_NoBidi":""),[d,c,f],{baseClass:"dijitSelect dijitValidationTextBox",templateString:p,_buttonInputDisabled:n("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var t=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=t?t:0].value)}this.dropDown=new u({id:this.id+"_menu",parentWidget:this});w.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(t){if(t.value||t.label){var z=l.hitch(this,"_setValueAttr",t);t=new b({option:t,label:("text"===this.labelType?(t.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):t.label)||this.emptyLabel,
onClick:z,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:t.disabled||!1});t.focusNode.setAttribute("role","option");return t}return new e({ownerDocument:this.ownerDocument})},_addOptionItem:function(t){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(t))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(t){}},focusChild:function(t){t&&this.set("value",
t.option)},_getFirst:function(){var t=this._getChildren();return t.length?t[0]:null},_getLast:function(){var t=this._getChildren();return t.length?t[t.length-1]:null},childSelector:function(t){return(t=h.byNode(t))&&t.getParent()==this.dropDown},onKeyboardSearch:function(t,z,x,y){t&&this.focusChild(t)},_loadChildren:function(t){if(!0===t)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{E.forEach(this._getChildren(),function(x){x.destroyRecursive()});
var z=new b({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(z)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(t){this.inherited(arguments);A.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(t){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(t){this._set("required",t);this.focusNode.setAttribute("aria-required",t);this._refreshState()},_setOptionsAttr:function(t){this._isLoaded=!1;this._set("options",t)},_setDisplay:function(t){t=("text"===this.labelType?(t||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):t)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+t+"\x3c/span\x3e"},validate:function(t){t=this.disabled||this.isValid(t);this._set("state",t?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",t?"false":"true");var z=t?"":this._missingMsg;z&&this.focused&&this._hasBeenBlurred?a.show(z,this.domNode,this.tooltipPosition,!this.isLeftToRight()):a.hide(this.domNode);this._set("message",z);return t},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);a.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=v.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(k(this.domNode,"selectstart",function(z){z.preventDefault();z.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var t=this._keyNavCodes;delete t[r.LEFT_ARROW];delete t[r.RIGHT_ARROW]},_setStyleAttr:function(t){this.inherited(arguments);
w.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(t){this._loadChildren(!0);this._isLoaded=!0;t()},destroy:function(t){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(t),delete this.dropDown);a.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){a.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
n("dojo-bidi")&&(m=q("dijit.form.Select",m,{_setDisplay:function(t){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));m._Menu=u;m.prototype._onContainerKeydown=B("_onContainerKeydown");m.prototype._onContainerKeypress=B("_onContainerKeypress");return m})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g){return m("dijit.form._FormSelectWidget",g,{multiple:!1,options:null,store:null,_setStoreAttr:function(b){this._created&&this._deprecatedSetStore(b)},query:null,_setQueryAttr:function(b){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:b})},queryOptions:null,_setQueryOptionsAttr:function(b){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:b})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(b){var e=this.options||[];if(null==b)return e;if(k.isArrayLike(b))return E.map(b,function(a){return this.getOptions(a)},this);k.isString(b)&&(b={value:b});k.isObject(b)&&(E.some(e,function(a,f){for(var h in b)if(!(h in a)||a[h]!=b[h])return!1;b=f;return!0})||(b=-1));return 0<=b&&b<e.length?e[b]:null},addOption:function(b){E.forEach(k.isArrayLike(b)?b:[b],function(e){e&&k.isObject(e)&&this.options.push(e)},this);this._loadChildren()},removeOption:function(b){b=
this.getOptions(k.isArrayLike(b)?b:[b]);E.forEach(b,function(e){e&&(this.options=E.filter(this.options,function(a){return a.value!==e.value||a.label!==e.label}),this._removeOptionItem(e))},this);this._loadChildren()},updateOption:function(b){E.forEach(k.isArrayLike(b)?b:[b],function(e){var a=this.getOptions({value:e.value}),f;if(a)for(f in e)a[f]=e[f]},this);this._loadChildren()},setStore:function(b,e,a){l.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(b,e,a)},_deprecatedSetStore:function(b,e,a){var f=this.store;a=a||{};if(f!==b){for(var h;h=this._notifyConnections.pop();)h.remove();b.get||(k.mixin(b,{_oldAPI:!0,get:function(p){var B=new q;this.fetchItemByIdentity({identity:p,onItem:function(u){B.resolve(u)},onError:function(u){B.reject(u)}});return B.promise},query:function(p,B){var u=new q(function(){t.abort&&t.abort()});u.total=new q;var t=this.fetch(k.mixin({query:p,onBegin:function(z){u.total.resolve(z)},
onComplete:function(z){u.resolve(z)},onError:function(z){u.reject(z)}},B));return new c(u)}}),b.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[A.after(b,"onNew",k.hitch(this,"_onNewItem"),!0),A.after(b,"onDelete",k.hitch(this,"_onDeleteItem"),!0),A.after(b,"onSet",k.hitch(this,"_onSetItem"),!0)]));this._set("store",b)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);a.query&&this._set("query",a.query);a.queryOptions&&this._set("queryOptions",a.queryOptions);b&&b.query&&(this._loadingStore=!0,this.onLoadDeferred=new q,this._queryRes=b.query(this.query,this.queryOptions),d(this._queryRes,k.hitch(this,function(p){if(this.sortByLabel&&!a.sort&&p.length)if(b.getValue)p.sort(w.createSortFunction([{attribute:b.getLabelAttributes(p[0])[0]}],b));else{var B=this.labelAttr;p.sort(function(u,t){return u[B]>t[B]?1:t[B]>
u[B]?-1:0})}a.onFetch&&(p=a.onFetch.call(this,p,a));E.forEach(p,function(u){this._addOptionForItem(u)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(k.hitch(this,function(u,t,z){t==z?this._onSetItem(u):(-1!=t&&this._onDeleteItem(u),-1!=z&&this._onNewItem(u))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:e);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(p):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),k.hitch(this,function(p){console.error("dijit.form.Select: "+p.toString());this.onLoadDeferred.reject(p)})));return f},_setValueAttr:function(b,e){this._onChangeActive||(e=null);if(this._loadingStore)this._pendingValue=b;else if(null!=b){b=k.isArrayLike(b)?E.map(b,function(h){return k.isObject(h)?h:{value:h}}):k.isObject(b)?[b]:[{value:b}];b=E.filter(this.getOptions(b),function(h){return h&&h.value});var a=this.getOptions()||[];this.multiple||b[0]&&b[0].value||!a.length||(b[0]=
a[0]);E.forEach(a,function(h){h.selected=E.some(b,function(p){return p.value===h.value})});a=E.map(b,function(h){return h.value});if("undefined"!=typeof a&&"undefined"!=typeof a[0]){var f=E.map(b,function(h){return h.label});this._setDisplay(this.multiple?f:f[0]);this.inherited(arguments,[this.multiple?a:a[0],e]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var b=E.map([].concat(this.get("selectedOptions")),function(e){return e&&"label"in e?e.label:e?e.value:null},this);return this.multiple?
b:b[0]},_setDisplayedValueAttr:function(b){this.set("value",this.getOptions("string"==typeof b?{label:b}:b))},_loadChildren:function(){this._loadingStore||(E.forEach(this._getChildren(),function(b){b.destroyRecursive()}),E.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var b=[].concat(this.value);if(b&&b[0]){var e=this;E.forEach(this._getChildren(),function(a){var f=E.some(b,function(h){return a.option&&
h===a.option.value});f&&!e.multiple&&(e.focusedChild=a);r.toggle(a.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),f);a.domNode.setAttribute("aria-selected",f?"true":"false")},this)}},_getValueFromOpts:function(){var b=this.getOptions()||[];if(!this.multiple&&b.length){var e=E.filter(b,function(a){return a.selected})[0];if(e&&e.value)return e.value;b[0].selected=!0;return b[0].value}return this.multiple?E.map(E.filter(b,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(b,e){e&&e.parent||this._addOptionForItem(b)},_onDeleteItem:function(b){this.removeOption({value:this.store.getIdentity(b)})},_onSetItem:function(b){this.updateOption(this._getOptionObjForItem(b))},_getOptionObjForItem:function(b){var e=this.store,a=this.labelAttr&&this.labelAttr in b?b[this.labelAttr]:e.getLabel(b);return{value:a?e.getIdentity(b):null,label:a,item:b}},_addOptionForItem:function(b){var e=this.store;e.isItemLoaded&&!e.isItemLoaded(b)?e.loadItem({item:b,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(b=this._getOptionObjForItem(b),this.addOption(b))},constructor:function(b){this._oValue=(b||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);v.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?n("\x3e *",this.srcNodeRef).map(function(b){return"separator"===b.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:b.getAttribute("data-"+l._scopeName+"-value")||b.getAttribute("value"),
label:String(b.innerHTML),selected:b.getAttribute("selected")||!1,disabled:b.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);A.after(this,"onChange",k.hitch(this,"_updateSelection"));var b=this.store;b&&(b.getIdentity||b.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(b,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var b;b=this._notifyConnections.pop();)b.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(E,q,A,w){return E("dijit.DropDownMenu",w,{templateString:A,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(m){this._moveToPopup(m);m.stopPropagation();m.preventDefault()},
_onLeftArrow:function(m){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else m.stopPropagation(),m.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e){return q("dijit._MenuBase",[c,
e,b,g],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){m.toggle(this.domNode,"dijitMenuActive",a);m.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var f=d.byNode(a);return a.parentNode==this.containerNode&&
f&&f.focus},postCreate:function(){var a=this,f="string"==typeof this.childSelector?this.childSelector:v.hitch(this,"childSelector");this.own(l(this.containerNode,l.selector(f,r.enter),function(){a.onItemHover(d.byNode(this))}),l(this.containerNode,l.selector(f,r.leave),function(){a.onItemUnhover(d.byNode(this))}),l(this.containerNode,l.selector(f,n),function(h){a.onItemClick(d.byNode(this),h);h.stopPropagation()}),l(this.containerNode,l.selector(f,"focusin"),function(){a._onItemFocus(d.byNode(this))}));
this.inherited(arguments)},onKeyboardSearch:function(a,f,h,p){this.inherited(arguments);if(a&&(-1==p||a.popup&&1==p))this.onItemClick(a,f)},_keyboardSearchCompare:function(a,f){return a.shortcutKey?f==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},
_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=
a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&
(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,f){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),f=/^key/.test(f._origType||f.type)||0==f.clientX&&0==f.clientY,this._openItemPopup(a,
f)):(this.onExecute(),a._onClick?a._onClick(f):a.onClick(f))},_openItemPopup:function(a,f){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var h=a.popup;h.parentMenu=this;this.own(this._mouseoverHandle=l.once(h.domNode,"mouseover",v.hitch(this,"_onPopupHover")));var p=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){f&&p.focusChild(a);p._cleanUp()},onExecute:v.hitch(this,
"_cleanUp",!0),onClose:function(){p._mouseoverHandle&&(p._mouseoverHandle.remove(),delete p._mouseoverHandle)}},f);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(w.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),
this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(E,q,A,w,m,v,r,l,k,n){return q("dijit._KeyNavContainer",[k,n,l],{connectKeyNavHandlers:function(d,c){var g=this._keyNavCodes={},b=v.hitch(this,"focusPrev"),e=v.hitch(this,"focusNext");E.forEach(d,function(a){g[a]=b});E.forEach(c,function(a){g[a]=e});g[m.HOME]=v.hitch(this,"focusFirstChild");g[m.END]=v.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){w.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);E.forEach(this.getChildren(),
v.hitch(this,"_startupChild"))},addChild:function(d,c){this.inherited(arguments);this._startupChild(d)},_startupChild:function(d){d.set("tabIndex","-1")},_getFirst:function(){var d=this.getChildren();return d.length?d[0]:null},_getLast:function(){var d=this.getChildren();return d.length?d[d.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(d){return(d=
r.byNode(d))&&d.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(E,q,A,w,m,v,r,l){return q("dijit._KeyNavMixin",l,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);A.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var k=this._keyNavCodes={};k[w.HOME]=m.hitch(this,"focusFirstChild");k[w.END]=m.hitch(this,
"focusLastChild");k[this.isLeftToRight()?w.LEFT_ARROW:w.RIGHT_ARROW]=m.hitch(this,"_onLeftArrow");k[this.isLeftToRight()?w.RIGHT_ARROW:w.LEFT_ARROW]=m.hitch(this,"_onRightArrow");k[w.UP_ARROW]=m.hitch(this,"_onUpArrow");k[w.DOWN_ARROW]=m.hitch(this,"_onDownArrow")}var n=this;k="string"==typeof this.childSelector?this.childSelector:m.hitch(this,"childSelector");this.own(v(this.domNode,"keypress",m.hitch(this,"_onContainerKeypress")),v(this.domNode,"keydown",m.hitch(this,"_onContainerKeydown")),v(this.domNode,
"focus",m.hitch(this,"_onContainerFocus")),v(this.containerNode,v.selector(k,"focusin"),function(d){n._onChildFocus(r.getEnclosingWidget(this),d)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(k,n){k&&(this.focusedChild&&k!==this.focusedChild&&this._onChildBlur(this.focusedChild),k.set("tabIndex",this.tabIndex),k.focus(n?"end":"start"))},_onContainerFocus:function(k){k.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){A.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(k){A.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(k){k&&k!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),k.set("tabIndex",this.tabIndex),this.lastFocused=k,this._set("focusedChild",k))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(k,n,d,c){k&&this.focusChild(k)},_keyboardSearchCompare:function(k,n){var d=k.domNode;k=(k.label||(d.focusNode?
d.focusNode.label:"")||d.innerText||d.textContent||"").replace(/^\s+/,"").substr(0,n.length).toLowerCase();return n.length&&k==n?-1:0},_isFormElement:function(k){return"INPUT"===k.tagName||"TEXTAREA"===k.tagName||"SELECT"===k.tagName||"BUTTON"===k.tagName},_onContainerKeydown:function(k){if(!this._isFormElement(document.activeElement)){var n=this._keyNavCodes[k.keyCode];n?(n(k,this.focusedChild),k.stopPropagation(),k.preventDefault(),this._searchString=""):k.keyCode!=w.SPACE||!this._searchTimer||
k.ctrlKey||k.altKey||k.metaKey||(k.stopImmediatePropagation(),k.preventDefault(),this._keyboardSearch(k," "))}},_onContainerKeypress:function(k){this._isFormElement(document.activeElement)||k.charCode<=w.SPACE||k.ctrlKey||k.altKey||k.metaKey||(k.preventDefault(),k.stopPropagation(),this._keyboardSearch(k,String.fromCharCode(k.charCode).toLowerCase()))},_keyboardSearch:function(k,n){var d=null,c,g=0;m.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=n;var b=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;c=this._searchString.substr(0,b);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var e=this.focusedChild||null;if(1==b||!e)if(e=this._getNextFocusableChild(e,1),!e)return;b=e;do{var a=this._keyboardSearchCompare(e,c);a&&0==g++&&(d=e);if(-1==a){g=-1;break}e=this._getNextFocusableChild(e,1)}while(e&&e!=b)})();this.onKeyboardSearch(d,k,c,g)},_onChildBlur:function(){},_getNextFocusableChild:function(k,n){var d=
k;do{if(k)k=this._getNext(k,n);else if(k=this[0<n?"_getFirst":"_getLast"](),!k)break;if(null!=k&&k!=d&&k.isFocusable())return k}while(k!=d);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(k,n){if(k)for(k=k.domNode;k;)if((k=k[0>n?"previousSibling":"nextSibling"])&&"getAttribute"in k){var d=r.byNode(k);if(d)return d}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c){r=E("dijit.MenuItem"+(v("dojo-bidi")?"_NoBidi":""),[l,k,n,d],{templateString:c,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(g){this._set("label",g);var b="";var e=g.search(/{\S}/);if(0<=e){b=g.charAt(e+1);var a=g.substr(0,e);g=g.substr(e+3);e=a+b+g;g=a+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+g}else e=g;this.domNode.setAttribute("aria-label",e+" "+this.accelKey);this.containerNode.innerHTML=g;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(g){!g||"label"in this.params||this._set("label",g.innerHTML)},buildRendering:function(){this.inherited(arguments);A.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&A.set(this.accelKeyNode,"id",this.id+"_accel");q.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==v("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(g){}},_setSelected:function(g){w.toggle(this.domNode,
"dijitMenuItemSelected",g)},setLabel:function(g){m.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",g)},setDisabled:function(g){m.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",g)},_setDisabledAttr:function(g){this.focusNode.setAttribute("aria-disabled",g?"true":"false");this._set("disabled",g)},_setAccelKeyAttr:function(g){this.accelKeyNode&&(this.accelKeyNode.style.display=
g?"":"none",this.accelKeyNode.innerHTML=g,A.set(this.containerNode,"colSpan",g?"1":"2"));this._set("accelKey",g)}});v("dojo-bidi")&&(r=E("dijit.MenuItem",r,{_setLabelAttr:function(g){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return r})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(E,q){return E("dijit._Contained",null,{_getSibling:function(A){var w=this.getParent();return w&&w._getSiblingOfChild&&w._getSiblingOfChild(this,
"previous"==A?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var A=this.getParent();return A&&A.getIndexOfChild?A.getIndexOfChild(this):-1}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(E,q,A,w,m,v){return E("dijit.MenuSeparator",[A,w,m],{templateString:v,
buildRendering:function(){this.inherited(arguments);q.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(E,q,A,w){return E(q,{baseClass:"jimu-loading-indicator jimu-agol-loading",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&A.set(this.domNode,{display:"none"});
A.set(this.domNode,{width:"100%",height:"100%"});w.place(' \x3cdiv class\x3d"loading-container"\x3e\x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\x3c/div\x3e\x3c/div\x3e',this.domNode)},show:function(){this.domNode&&this.hidden&&(A.set(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(A.set(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/statisticsUtils":function(){define("dojo/_base/array dojo/when esri/tasks/StatisticDefinition esri/tasks/QueryTask esri/tasks/query esri/lang jimu/utils jimu/LayerInfos/LayerInfos exports".split(" "),
function(E,q,A,w,m,v,r,l,k){function n(h){var p=new m;p.outFields=[h.fieldName];p.outStatistics=[];p.geometry=h.geometry;var B=c(h);E.forEach(B,function(u){var t=new A;t.statisticType=u;t.displayFeildName=h.fieldName;t.onStatisticField=h.fieldName;t.outStatisticFieldName=f[u];p.outStatistics.push(t)});p.where=h.filterExpression?h.filterExpression:h.layer.getDefinitionExpression()?h.layer.getDefinitionExpression():"1\x3d1";h.geometry&&(p.geometry=h.geometry);return(new w(h.layer.url)).execute(p).then(function(u){return u&&
u.features&&0<u.features.length?(u=u.features[0].attributes,e(h,u),u):[]})}function d(h){var p={countField:0,sumField:0},B=c(h),u=0,t=0;h.featureSet.features.forEach(function(x){var y=x.attributes[h.fieldName];null!==y&&"undefined"!==typeof y&&B.forEach(function(D){switch(D){case "count":p.countField++;break;case "sum":p.sumField+=y;break;case "min":p.minField="undefined"===typeof p.minField?y:Math.min(p.minField,y);break;case "max":p.maxField="undefined"===typeof p.maxField?y:Math.max(p.maxField,
y);break;case "avg":u++,t+=y}})});p.avgField=0===u?0:0===u?"":t/u;var z=h.featureSet.features.filter(function(x){x=x.attributes[h.fieldName];return null===x||"undefined"===typeof x?!1:!0}).map(function(x){return x.attributes[h.fieldName]});p.stddevField=g(z);e(h,p);return p}function c(h){return h.statisticTypes&&0<h.statisticTypes.length?a.filter(function(p){return-1<h.statisticTypes.indexOf(p)}):a}function g(h){var p=h.length;if(1>=p)return 0;var B=0;h.forEach(function(z){B+=z});var u=B/p,t=0;h.forEach(function(z){t+=
Math.pow(z-u,2)});return Math.sqrt(1/(p-1)*t)}function b(h){var p=l.getInstanceSync();return h.layer?p.getLayerOrTableInfoById(h.layer.id).loadInfoTemplate().then(function(B){var u={};B.info&&B.info.fieldInfos&&B.info.fieldInfos.forEach(function(t){u[t.fieldName]=t});return u}):q({})}function e(h,p){if(h.fieldInfos&&h.fieldInfos[h.fieldName])for(var B in p)"countField"!==B&&v.isDefined(p[B])&&(p[B]=null===p[B]||"undefined"===typeof p[B]?"":r.localizeNumberByFieldInfo(p[B],h.fieldInfos[h.fieldName]))}
var a="count sum min max avg stddev".split(" "),f={count:"countField",sum:"sumField",min:"minField",max:"maxField",avg:"avgField",stddev:"stddevField"};k.getStatisticsResult=function(h){return b(h).then(function(p){h.fieldInfos=p;if(h.featureSet)return q(d(h));if(h.layer){if(h.layer.url)return n(h);h.featureSet=r.toFeatureSet(h.layer.graphics);return q(d(h))}})};k.isStatFromServer=function(h){return h.layer&&h.layer.url};k.getStddevVal=g;k.getStatisticsResultFromClientSync=d})},"jimu/featureActions/CreateLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/json dojo/on esri/layers/FeatureLayer esri/renderers/jsonUtils esri/symbols/jsonUtils ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/Search jimu/LayerInfos/LayerInfos jimu/utils".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b){return E(n,{name:"CreateLayer",iconClass:"icon-create-layer",isFeatureSupported:function(e,a){return 0<e.features.length&&e.features[0].geometry&&a&&a.geometryType&&a.fields&&a.objectIdField},onExecute:function(e,a){var f;e={layerDefinition:{geometryType:a.geometryType,fields:A.map(a.fields,function(h){return h.toJSON()}),objectIdField:a.objectIdField},featureSet:e.toJson()};e=new r(e);(f=a._json?m.parse(a._json):null)&&f.drawingInfo&&f.drawingInfo.renderer?(f=
f.drawingInfo.renderer,f=l.fromJson(f)):f=l.fromJson(a.renderer.toJson());e.setRenderer(f);(a=a.getSelectionSymbol())&&e.setSelectionSymbol(k.fromJson(a.toJson()));this._popupAddLayer(e)},_popupAddLayer:function(e){var a=w.create("div",{style:"padding: 0 10px 0 10px;"}),f=(new c({placeholder:window.jimuNls.layerInfosMenu.labelLayer})).placeAt(a);w.setStyle(f.searchBtn,"display","none");var h=new d({content:a,titleLabel:window.jimuNls.featureActions.CreateLayer,width:525,height:180,buttons:[{label:window.jimuNls.common.ok,
onClick:q.hitch(this,function(){e.name=b.stripHTML(f.getValue());this._addLayerToMap(e);h.close();p&&p.remove&&p.remove()})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:q.hitch(this,function(){h.close();p&&p.remove&&p.remove()})}]});f.inputSearch.focus();h.disableButton(0);var p=v(f.inputSearch,"keyup",function(){f.getValue()?h.enableButton(0):h.disableButton(0)})},_addLayerToMap:function(e){var a=g.getInstanceSync(),f=v(a,"layerInfosChanged",q.hitch(this,function(h){e.id===
h.id&&(h.enablePopup(),f.remove())}));this.map.addLayer(e)}})})},"jimu/dijit/Search":function(){define("dojo/_base/declare dojo/_base/html dojo/string dojo/keys dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),function(E,q,A,w,m,v){return E([m,v],{baseClass:"jimu-search",declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',
placeholder:"",onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&q.setAttr(this.inputSearch,"placeholder",this.placeholder)},getValue:function(){return A.trim(this.inputSearch.value)},doSearch:function(){if(this.onSearch)this.onSearch(this.getValue())},_onKeyDown:function(r){this.doChange();(void 0!==r.keyCode?r.keyCode:r.which)===w.ENTER&&this.doSearch();r.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()},
doChange:function(){if(this.onChange)this.onChange(this.getValue())}})})},"jimu/featureActions/AddMarker":function(){define("dojo/_base/declare ../BaseFeatureAction esri/graphic esri/layers/GraphicsLayer esri/symbols/PictureMarkerSymbol esri/InfoTemplate jimu/shareUtils".split(" "),function(E,q,A,w,m,v,r){return E(q,{name:"AddMarker",iconClass:"icon-add",_markerLayer:null,isFeatureSupported:function(l){this._getMarkerLayer();return this._isSupportType(l)&&0<l.features.length&&l.features[0]&&l.features[0].geometry&&
!1===this._isFeatureInMarkerFeatureActionLayer(l)},onExecute:function(l,k){this._addMarker(l,k)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new w({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var l=this.map.snappingManager.layerInfos;l.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(l)}},_addMarker:function(l,
k){var n=l.features[0].geometry,d={};k=k.displayField||l.displayFieldName||k.objectIdField;d.title="";l.features[0].attributes&&k&&(d.title=l.features[0].attributes[k],d.title||(d.title=""));k={};if("point"===n.type)k=n;else if("polygon"===n.type||"polyline"===n.type||"multipoint"===n.type)k=this.map.infoWindow&&this.map.infoWindow.isShowing?this.map.infoWindow.location:n.getExtent().getCenter();k.getLongitude()&&k.getLatitude()?(d.longitude=k.getLongitude(),d.latitude=k.getLatitude()):k.x&&k.y&&
(d.x=k.x,d.y=k.y);var c="";n&&n.spatialReference&&n.spatialReference.wkid&&(c=n.spatialReference.wkid);d.spatialReference={wkid:c};n=r.getXyContent(d);d=r.getShareUrl(this.map,d,!0);d=r.getShareUrlContent(d);d=n+d;n=new m(require.toUrl("jimu")+"/images/EsriBluePinCircle26.png");n.width=26;n.height=26;n.setOffset(0,n.height/2);k=new A(k,n,null,null);k._markerFeatureactionGraphic=l.features[0];k.infoTemplate=this._setInfoTemplate(d);this._markerLayer.add(k);this._closePopupWindow()},_setInfoTemplate:function(l){var k=
new v;k.setContent(l);return k},_closePopupWindow:function(){this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(l){return l.features[0]&&l.features[0]._graphicsLayer&&l.features[0]._graphicsLayer.id&&"marker-feature-action-layer"===l.features[0]._graphicsLayer.id?!0:!1},_isSupportType:function(l){if(l&&l.geometryType){if(l.features&&l.features.length&&1<l.features.length)return!1;l=l.geometryType;return"point"===l||"polygon"===l||"polyline"===
l||"multipoint"===l}return!1}})})},"jimu/featureActions/RemoveMarker":function(){define(["dojo/_base/declare","../BaseFeatureAction","esri/layers/GraphicsLayer"],function(E,q,A){return E(q,{name:"RemoveMarker",iconClass:"icon-close",_markerLayer:null,isFeatureSupported:function(w){this._getMarkerLayer();return 0<w.features.length&&w.geometryType&&w.features[0]&&w.features[0].geometry&&!0===this._isFeatureInMarkerFeatureActionLayer(w)},onExecute:function(w){this._removeMarker(w)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=
this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new A({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var w=this.map.snappingManager.layerInfos;w.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(w)}},_removeMarker:function(w){w=w.features[0];w._textSymbol&&this._markerLayer.remove(w._textSymbol);this._markerLayer.remove(w);this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(w){return w.features[0]&&
w.features[0]._graphicsLayer&&w.features[0]._graphicsLayer.id?"marker-feature-action-layer"===w.features[0]._graphicsLayer.id:!1}})})},"jimu/featureActions/SaveToMyContent":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/graphicsUtils esri/IdentityManager jimu/portalUtils jimu/portalUrlUtils jimu/Role jimu/dijit/Message ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/AddItemForm".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g,b){return E(c,{name:"SaveToMyContent",
iconClass:"icon-save",isFeatureSupported:function(e){return 0>=e.features.length||!e.features[0].geometry?!1:!0},onExecute:function(e,a){this.checkPrivilege().then(q.hitch(this,function(f){if(f)var h=new b({appConfig:this.appConfig}),p=new g({content:h,titleLabel:window.jimuNls.featureActions.SaveToMyContent,width:525,height:220,buttons:[{label:window.jimuNls.common.ok,onClick:q.hitch(this,function(){h.showBusy();p.disableButton(0);h.validate().then(q.hitch(this,function(B){B.valid?this._addItem(e,
a,h):(h.hideBusy(),p.enableButton(0))}))})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:q.hitch(this,function(){p.close()})}]});else new d({message:window.jimuNls.noEditPrivileges})}))},checkPrivilege:function(){var e=k.getStandardPortalUrl(this.appConfig.portalUrl),a=l.getPortal(e);if(a){if(a.haveSignIn())return this._hasPrivilege(a);r.useSignInPage=!1;return a.signIn().then(q.hitch(this,function(){r.useSignInPage=!0;return this._hasPrivilege(a)}),q.hitch(this,function(){r.useSignInPage=
!0}))}e=new m;e.resolve(!1);return e},_hasPrivilege:function(e){return e.loadSelfInfo().then(q.hitch(this,function(a){if(a&&a.user){var f=new n({id:a.user.roleId?a.user.roleId:a.user.role,role:a.user.role});a.user.privileges&&f.setPrivileges(a.user.privileges);return f.canCreateItem()&&f.canPublishFeatures()}return!1}),function(){return!1})},_addItem:function(e,a,f){var h=f.getName(),p=f.getFolderId(),B=f.popup;a=a||{};var u={name:a.name||a.id,type:a.type||"Feature Layer",displayField:a.displayField,
description:a.description,copyrightText:a.copyright,geometryType:a.geometryType||e.geometryType,fields:a.fields||e.fields,objectIdField:a.objectIdField};e.features[0].geometry&&(a=v.graphicsExtent(e.features),u.initialExtent=a,u.fullExtent=a,u.extent=a);!u.objectIdField&&u.fields&&A.some(u.fields,function(t){if("esriFieldTypeOID"===t.type)return u.objectIdField=t.name,!0});e={layers:[{layerDefinition:u,featureSet:e.toJson()}]};f.addItem({name:h,title:h,type:"Feature Collection",typeKeywords:"WAB_created",
text:w.stringify(e)},p).then(q.hitch(this,function(t){!0===t.success?B.close():(f.hideBusy(),B.enableButton(0),new d({message:t.error?t.error.message:""}))}),function(t){f.hideBusy();B.enableButton(0);new d({message:t.message})})}})})},"jimu/dijit/AddItemForm":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/AddItemForm.html jimu/portalUtils jimu/portalUrlUtils dojo/data/ItemFileWriteStore dijit/form/ValidationTextBox dijit/form/FilteringSelect jimu/dijit/LoadingShelter".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d){return E([m,v,r],{baseClass:"jimu-item-form",templateString:l,appConfig:null,folderStore:null,portalUser:null,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);var c=n.getStandardPortalUrl(this.appConfig.portalUrl);k.getPortal(c).getUser().then(q.hitch(this,function(g){this.portalUser=g;return g.getContent()})).then(q.hitch(this,function(g){this.folderStore=this._createFolderStore(g.folders,this.portalUser.username);
this.itemFolder.set("store",this.folderStore);this.itemFolder.set("required",!0);this.itemFolder.set("searchAttr","name");this.itemFolder.set("displayedValue",this.portalUser.username)}))},getName:function(){return this.itemName.get("value")},getFolderId:function(){return this.itemFolder.item?this.folderStore.getValue(this.itemFolder.item,"id"):""},showBusy:function(){this.shelter.show()},hideBusy:function(){this.shelter.hide()},validate:function(){var c=new w;this.itemForm.validate()?c.resolve({valid:!0}):
c.resolve({valid:!1,message:"param requried"});return c},addItem:function(c,g){if(this.portalUser)return this.portalUser.addItem(c,g);c=new w;c.resolve({error:{message:"portalUser is null"}});return c},_createFolderStore:function(c,g){var b=new d({data:{identifier:"id",label:"name",items:[]}});b.newItem({name:g,id:""});A.forEach(c,function(e){b.newItem({name:e.title,id:e.id})});return b}})})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox",
"./ComboBoxMixin"],function(E,q,A,w,m){return E("dijit.form.FilteringSelect",[w,m],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(v,r,l,k){r&&r[this.searchAttr]!==this._lastQuery||!r&&v.length&&this.store.getIdentity(v[0])!=this._lastQuery||(v.length?this.set("item",v[0],k):this.set("value",
"",k||void 0===k&&!this.focused,this.textbox.value,null))},_openResultList:function(v,r,l){r[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(v,r,l,k){this._onChangeActive||(r=null);if(void 0===k){if(null===v||""===v)if(v="",!q.isString(l)){this._setDisplayedValueAttr(l||"",r);return}var n=this;this._lastQuery=v;A(this.store.get(v),
function(d){n._callbackSetLabel(d?[d]:[],void 0,void 0,r)})}else this.valueNode.value=v,this.inherited(arguments,[v,r,l,k])},_setItemAttr:function(v,r,l){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(v){return v.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(v,r){null==v&&(v="");if(!this._created){if(!("displayedValue"in this.params))return;r=!1}if(this.store){this.closeDropDown();var l=q.clone(this.query),k=this._getDisplayQueryString(v);
if(this.store._oldAPI)var n=k;else n=this._patternToRegExp(k),n.toString=function(){return k};this._lastQuery=l[this.searchAttr]=n;this._lastDisplayedValue=this.textbox.value=v;this._set("displayedValue",v);var d=this,c={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};q.mixin(c,this.fetchProperties);this._fetchHandle=this.store.query(l,c);A(this._fetchHandle,function(g){d._fetchHandle=null;d._callbackSetLabel(g||[],l,c,r)},function(g){d._fetchHandle=null;d._cancelingQuery||console.error("dijit.form.FilteringSelect: "+
g.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(E,q,A,w){return E("dijit.form.MappedTextBox",w,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(m){return m.toString?m.toString():""},toString:function(){var m=this.filter(this.get("value"));return null!=
m?"string"==typeof m?m:this.serialize(m,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=A.place("\x3cinput type\x3d'hidden'"+(this.name&&!q("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(E,q,A,w,m,v,r,l,k){return E("dijit.form.ComboBoxMixin",[l,v],{dropDownClass:r,hasDownArrow:!0,templateString:k,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(n){this._set("hasDownArrow",n);this._buttonNode.style.display=n?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(n){n.get||w.mixin(n,{_oldAPI:!0,get:function(d){var c=new q;this.fetchItemByIdentity({identity:d,
onItem:function(g){c.resolve(g)},onError:function(g){c.reject(g)}});return c.promise},query:function(d,c){var g=new q(function(){b.abort&&b.abort()});g.total=new q;var b=this.fetch(w.mixin({query:d,onBegin:function(e){g.total.resolve(e)},onComplete:function(e){g.resolve(e)},onError:function(e){g.reject(e)}},c));return m(g)}});this._set("store",n)},postMixInProperties:function(){var n=this.params.store||this.store;n&&this._setStoreAttr(n);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var d=this.declaredClass;w.mixin(this.store,{getValue:function(c,g){A.deprecated(d+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return c[g]},getLabel:function(c){A.deprecated(d+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return c.name},fetch:function(c){A.deprecated(d+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
w.hitch(this,function(g){(new g({objectStore:this})).fetch(c)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(E,q,A,w,m,v,r,l,k,n,d){q=q("dijit.form._AutoCompleterMixin",d,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(c){var g=0;if("number"==typeof c.selectionStart)g=c.selectionStart;else if(l("ie")){var b=c.ownerDocument.selection.createRange().duplicate();c=c.createTextRange();b.move("character",0);c.move("character",0);try{c.setEndPoint("EndToEnd",b),g=String(c.text).replace(/\r/g,"").length}catch(e){}}return g},_setCaretPos:function(c,g){g=parseInt(g);n.selectInputText(c,g,g)},_setDisabledAttr:function(c){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",c?"true":"false")},_onKey:function(c){if(!(32<=c.charCode)){var g=c.charCode||c.keyCode;if(g!=w.ALT&&g!=w.CTRL&&g!=w.META&&g!=w.SHIFT){var b=this.dropDown,e=null;this._abortQuery();this.inherited(arguments);if(!(c.altKey||c.ctrlKey||c.metaKey))switch(this._opened&&(e=b.getHighlightedOption()),g){case w.PAGE_DOWN:case w.DOWN_ARROW:case w.PAGE_UP:case w.UP_ARROW:this._opened&&this._announceOption(e);c.stopPropagation();c.preventDefault();break;case w.ENTER:if(e){if(e==
b.nextButton){this._nextSearch(1);c.stopPropagation();c.preventDefault();break}else if(e==b.previousButton){this._nextSearch(-1);c.stopPropagation();c.preventDefault();break}c.stopPropagation();c.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case w.TAB:g=this.get("displayedValue");if(b&&(g==b._messages.previousMessage||g==b._messages.nextMessage))break;e&&this._selectOption(e);case w.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(c){var g=this.focusNode;n.selectInputText(g,g.value.length);var b=this.ignoreCase?"toLowerCase":"substr";0==c[b](0).indexOf(this.focusNode.value[b](0))?(b=this.autoComplete?this._getCaretPos(g):g.value.length,b+1>g.value.length&&(g.value=c,n.selectInputText(g,b))):(g.value=c,n.selectInputText(g))},_openResultList:function(c,g,b){var e=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();c.length||0!=b.start?(this._nextSearch=this.dropDown.onPage=m.hitch(this,
function(a){c.nextPage(-1!==a);this.focus()}),this.dropDown.createOptions(c,b,m.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in b?(b.direction?this.dropDown.highlightFirstOption():b.direction||this.dropDown.highlightLastOption(),e&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(g[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var c=this.get("displayedValue"),g=this.dropDown;!g||c!=g._messages.previousMessage&&c!=g._messages.nextMessage?"undefined"==typeof this.item?
(this.item=null,this.set("displayedValue",c)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(c,g,b){var e="";c&&(b||(b=this.store._oldAPI?this.store.getValue(c,this.searchAttr):c[this.searchAttr]),e=this._getValueField()!=this.searchAttr?this.store.getIdentity(c):b);this.set("value",e,g,b,c)},_announceOption:function(c){if(c){if(c==
this.dropDown.nextButton||c==this.dropDown.previousButton){var g=c.innerHTML;this.item=void 0;this.value=""}else{var b=this.dropDown.items[c.getAttribute("item")];g=(this.store._oldAPI?this.store.getValue(b,this.searchAttr):b[this.searchAttr]).toString();this.set("item",b,!1,g)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",A.get(c,"id"));this._autoCompleteText(g)}},_selectOption:function(c){this.closeDropDown();c&&
this._announceOption(c);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(c){if(!this.dropDown){var g=this.id+"_popup";this.dropDown=new (m.isString(this.dropDownClass)?m.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:m.hitch(this,
this._selectOption),id:g,dir:this.dir,textDir:this.textDir})}this._lastInput=c;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new k({},this.srcNodeRef),!("value"in this.params))){var c=this.item=this.store.fetchSelectedItem();if(c){var g=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(c,g):c[g]}}},postCreate:function(){var c=v('label[for\x3d"'+
this.id+'"]');c.length&&(c[0].id||(c[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",c[0].id));this.inherited(arguments);E.after(this,"onSearch",m.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(c){c=this.labelFunc(c,this.store);var g=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(c=this.doHighlight(c,this._lastInput),g="html");return{html:"html"==g,label:c}},doHighlight:function(c,g){var b=(this.ignoreCase?"i":"")+("all"==
this.highlightMatch?"g":""),e=this.queryExpr.indexOf("${0}");g=r.escapeString(g);return this._escapeHtml(c.replace(new RegExp((0==e?"^":"")+"("+g+")"+(e==this.queryExpr.length-4?"$":""),b),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(c){return c=String(c).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},
labelFunc:function(c,g){return(g._oldAPI?g.getValue(c,this.labelAttr||this.searchAttr):c[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(c,g,b,e){this._set("item",e||null);null==c&&(c="");this.inherited(arguments)}});l("dojo-bidi")&&q.extend({_setTextDirAttr:function(c){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",c)}});return q})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),
function(E,q,A,w,m,v){function r(l){return{id:l.value,value:l.value,name:A.trim(l.innerText||l.textContent||"")}}return E("dijit.form.DataList",m,{constructor:function(l,k){this.domNode=q.byId(k);A.mixin(this,l);this.id&&v.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:w("option",this.domNode).map(r)}])},destroy:function(){v.remove(this.id)},fetchSelectedItem:function(){var l=w("\x3e option[selected]",this.domNode)[0]||w("\x3e option",this.domNode)[0];return l&&r(l)}})})},
"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(E,q,A,w,m,v,r){return E("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(l){this._set("list",l)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(l){return new RegExp("^"+l.replace(/(\\.)|(\*)|(\?)|\W/g,function(k,n,d,c){return d?".*":
c?".":n?n:"\\"+k})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(l){if(!this.disabled&&
!this.readOnly){l=l.charOrCode;this._prev_key_backspace=!1;if(l===q.DELETE||l===q.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(l){this._abortQuery();var k=this,n=A.clone(this.query),d={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},c=m.substitute(this.queryExpr,
[l.replace(/([\\\*\?])/g,"\\$1")]),g=function(){var e=k._fetchHandle=k.store.query(n,d);k.disabled||k.readOnly||b!==k._lastQuery||v(e,function(a){k._fetchHandle=null;k.disabled||k.readOnly||b!==k._lastQuery||v(e.total,function(f){a.total=f;var h=k.pageSize;if(isNaN(h)||h>a.total)h=a.total;a.nextPage=function(p){d.direction=p=!1!==p;d.count=h;p?(d.start+=a.length,d.start>=a.total&&(d.count=0)):(d.start-=h,0>d.start&&(d.count=Math.max(h+d.start,0),d.start=0));0>=d.count?(a.length=0,k.onSearch(a,n,d)):
g()};k.onSearch(a,n,d)})},function(a){k._fetchHandle=null;k._cancelingQuery||console.error(k.declaredClass+" "+a.toString())})};A.mixin(d,this.fetchProperties);if(this.store._oldAPI)var b=c;else b=this._patternToRegExp(c),b.toString=function(){return c};this._lastQuery=n[this.searchAttr]=b;this._queryDeferHandle=this.defer(g,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var l=this.list;l&&(this.store=r.byId(l))}this.inherited(arguments)}})})},
"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(E,q,A,w,m,v,r,l){return E("dijit.form._ComboBoxMenu",[m,v,l,r],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(q.add(this.previousButton,"dijitMenuItemRtl"),q.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var k=this.ownerDocument.createElement("div");k.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");k.setAttribute("role","option");return k},onHover:function(k){q.add(k,"dijitMenuItemHover")},onUnhover:function(k){q.remove(k,
"dijitMenuItemHover")},onSelect:function(k){q.add(k,"dijitMenuItemSelected")},onDeselect:function(k){q.remove(k,"dijitMenuItemSelected")},_page:function(k){var n=0,d=this.domNode.scrollTop,c=A.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();n<c;){var g=this.getHighlightedOption();if(k){if(!g.previousSibling||"none"==g.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!g.nextSibling||"none"==g.nextSibling.style.display)break;this.selectNextNode()}g=
this.domNode.scrollTop;n+=(g-d)*(k?-1:1);d=g}},handleKey:function(k){switch(k.keyCode){case w.DOWN_ARROW:return this.selectNextNode(),!1;case w.PAGE_DOWN:return this._page(!1),!1;case w.UP_ARROW:return this.selectPreviousNode(),!1;case w.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(E,q,A,w,m){var v=q("dijit.form._ComboBoxMenuMixin"+
(w("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=m.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(r){this._set("value",r);this.onChange(r)},onClick:function(r){if(r==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(r==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(r)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(r,l){var k=this._createMenuItem();r=l(r);r.html?k.innerHTML=r.label:k.appendChild(k.ownerDocument.createTextNode(r.label));""==k.innerHTML&&(k.innerHTML="\x26#160;");return k},createOptions:function(r,l,k){this.items=r;this.previousButton.style.display=0==l.start?"none":"";A.set(this.previousButton,"id",this.id+
"_prev");E.forEach(r,function(d,c){d=this._createOption(d,k);d.setAttribute("item",c);A.set(d,"id",this.id+c);this.nextButton.parentNode.insertBefore(d,this.nextButton)},this);var n=!1;r.total&&!r.total.then&&-1!=r.total?l.start+l.count<r.total?n=!0:l.start+l.count>r.total&&l.count==r.length&&(n=!0):l.count==r.length&&(n=!0);this.nextButton.style.display=n?"":"none";A.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var r=this.containerNode;2<r.childNodes.length;)r.removeChild(r.childNodes[r.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});w("dojo-bidi")&&(v=q("dijit.form._ComboBoxMenuMixin",
v,{_createOption:function(){var r=this.inherited(arguments);this.applyTextDir(r);return r}}));return v})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(E,q,A,w){return E("dijit.form._ListMouseMixin",w,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(m,v){this._setSelectedAttr(v,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(v)})},_onMouseDown:function(m,v){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(v,!1)},_onMouseUp:function(m,v){this._isDragging=!1;var r=this.selected,l=this._hoveredNode;r&&v==r?this.defer(function(){this._onClick(m,
r)}):l&&this.defer(function(){this._onClick(m,l)})},_onMouseOut:function(m,v){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(m,v){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=v;this.onHover(v);this._isDragging&&this._setSelectedAttr(v,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(E,q,A){return E("dijit.form._ListBase",null,{selected:null,_listConnect:function(w,m){var v=this;return v.own(q(v.containerNode,q.selector(function(r,l,k){return r.parentNode==k},w),function(r){v[m](r,this)}))},selectFirstNode:function(){for(var w=this.containerNode.firstChild;w&&"none"==w.style.display;)w=w.nextSibling;this._setSelectedAttr(w,!0)},selectLastNode:function(){for(var w=this.containerNode.lastChild;w&&"none"==w.style.display;)w=w.previousSibling;this._setSelectedAttr(w,
!0)},selectNextNode:function(){var w=this.selected;if(w){for(w=w.nextSibling;w&&"none"==w.style.display;)w=w.nextSibling;w?this._setSelectedAttr(w,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var w=this.selected;if(w){for(w=w.previousSibling;w&&"none"==w.style.display;)w=w.previousSibling;w?this._setSelectedAttr(w,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(w,m){if(this.selected!=w){var v=this.selected;if(v)this.onDeselect(v);
w&&(m&&A.scrollIntoView(w),this.onSelect(w));this._set("selected",w)}else if(w)this.onSelect(w)}})})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(E,q,A,w,m){return E([q,A],{baseClass:"jimu-loading-shelter jimu-agol-loading",declaredClass:"jimu.dijit.LoadingShelter",templateString:w,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=
window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&m.setStyle(this.domNode,"display","none");m.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||m.setStyle(this.loadingNode,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(v){this.domNode&&this.hidden&&("string"===typeof v&&(this.textNode.innerHTML=v),m.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&
!this.hidden&&(m.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/dijit/FeatureActionPopupMenu":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array jimu/accessibleUtils dojo/on dojo/keys dijit/a11yclick dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin jimu/FeatureActionManager ./FeatureActionPopupMenuItem".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g){var b=null,e=E([n,d],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv role\x3d"title" class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode" tabindex\x3d"0"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent" tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._setFocusedNodeBeforeOpen();this.inherited(arguments);this.hide();this.menuItems=[];this.own(v(this.domNode,"click",A.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||q.isDescendant(a,this.menuNode)||this.hide()})));this._a11y_addEvents()},_setFocusedNodeBeforeOpen:function(){this.focusedNodeBeforeOpen=document.activeElement},_a11y_addEvents:function(){this.own(v(this.labelNode,"keydown",A.hitch(this,function(a){a.shiftKey&&a.keyCode===r.TAB&&(a.preventDefault(),
this.hide())})));this.own(v(this.closeBtn,l,A.hitch(this,this.hide)));this.own(v(this.menuContent,"focus",A.hitch(this,function(){this.currentMenuItem=this.menuItems[0].domNode;w.forEach(this.menuItems,function(a){q.hasClass(a.domNode,"selected")&&(this.currentMenuItem=a.domNode)});this.currentMenuItem.focus()})));this.own(v(this.menuContent,"keydown",A.hitch(this,function(a){a.keyCode===r.ESCAPE&&(a.stopPropagation(),this.hide());if(q.hasClass(a.target,"popup-menu-item"))if(a.keyCode!==r.TAB||(!a.shiftKey||
this.hasTitle)&&a.shiftKey){if(a.keyCode===r.DOWN_ARROW)var f=this.currentMenuItem.nextSibling?this.currentMenuItem.nextSibling:this.currentMenuItem;else a.keyCode===r.UP_ARROW?f=this.currentMenuItem.previousSibling?this.currentMenuItem.previousSibling:this.currentMenuItem:a.keyCode===r.HOME?f=this.menuItems[0].domNode:a.keyCode===r.END&&(f=this.menuItems[this.menuItems.length-1].domNode);f&&(this.currentMenuItem=f,f.focus())}else a.preventDefault(),this.hide()})))},setActions:function(a){this.clearActions();
w.forEach(a,A.hitch(this,this._addMenuItem))},appendAction:function(a){this._addMenuItem(a)},clearActions:function(){this.menuItems=[];q.empty(this.menuContent)},_addMenuItem:function(a){var f=new g({action:a});q.place(f.domNode,this.menuContent);f.startup();this.menuItems.push(f);this.own(v(f,"click",A.hitch(this,function(h){h?(h=0<=["ShowStatistics","SaveToMyContent","ChangeSymbol"].indexOf(f.action.name),m.isInNavMode()&&h||this.hide()):this.hide()})))},markAsSelected:function(a){w.forEach(this.menuItems,
function(f){f.action.label===a.label?f.setSelected(!0):f.setSelected(!1)})},prepareActions:function(a,f){return c.getInstance().getSupportedActions(a).then(A.hitch(this,function(h){!1===f&&(h=w.filter(h,function(p){return 0!==p.name.indexOf("Export")&&"SaveToMyContent"!==p.name}));w.forEach(h,function(p){p.data=a},this);this.setActions(h)}))},hide:function(){q.setStyle(this.domNode,"display","none");this.focusedNodeBeforeOpen&&this.focusedNodeBeforeOpen.focus()},show:function(a,f){if(0===this.menuItems.length)q.setStyle(this.domNode,
"display","none");else{"string"===typeof f&&""!==f?(this.labelNode.innerHTML=f,q.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",q.setStyle(this.titleNode,"display","none"));var h=a.y+a.h;a=window.isRTL?a.x:a.x+a.w;q.setStyle(this.domNode,"display","");q.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});var p=k.getMarginSize(this.menuNode);q.setStyle(this.menuNode,{left:(window.isRTL?a+p.w>window.innerWidth?window.innerWidth-p.w:0>a?0:a:0>a-p.w?0:a>window.innerWidth?
window.innerWidth-p.w:a-p.w)+"px",top:(p.h>window.innerHeight?0:h+p.h>window.innerHeight?window.innerHeight-p.h:h+p.h+5<window.innerHeight?h+5:h)+"px"});"string"===typeof f&&""!==f?(this.labelNode.focus(),this.hasTitle=!0):(this.menuContent.focus(),this.hasTitle=!1)}}});e.getInstance=function(){null===b&&(b=new e,q.place(b.domNode,document.body),b.startup());b.setActions([]);return b};return e})},"jimu/dijit/FeatureActionPopupMenuItem":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/event dojo/on dojo/keys dojo/mouse dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),
function(E,q,A,w,m,v,r,l,k,n){return E([k,n,l],{baseClass:"popup-menu-item",templateString:'\x3cdiv role\x3d"option" tabindex\x3d"-1"\x3e\x3cdiv class\x3d"icon jimu-float-leading" data-dojo-attach-point\x3d"iconContainer"\x3e\x3cdiv class\x3d"feature-action" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"label" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3c/div\x3e',action:null,postCreate:function(){this.inherited(arguments);this.action&&(this.labelNode.innerHTML=
this.action.label,this.labelNode.title=this.action.label,this.action.iconClass?("no-icon"===this.action.iconClass&&q.addClass(this.iconContainer,"no-icon"),q.addClass(this.iconNode,this.action.iconClass)):q.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")"),this.own(m(this.domNode,r.enter,A.hitch(this,this._useHoverIcon))),this.own(m(this.domNode,r.leave,A.hitch(this,this._useNormalIcon))));this.own(m(this.domNode,"click",A.hitch(this,this._clickHandler)));this.own(m(this.domNode,
"keydown",A.hitch(this,function(d){d.keyCode===v.ENTER&&this._clickHandler(d,!0)})))},setSelected:function(d){d?q.addClass(this.domNode,"selected"):q.removeClass(this.domNode,"selected")},_useNormalIcon:function(){this.action.iconClass?q.removeClass(this.iconNode,"highlight"):q.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")")},_useHoverIcon:function(){this.action.iconClass?q.addClass(this.iconNode,"highlight"):q.setStyle(this.iconNode,"background-image","url("+
this.action.getIcon("hover")+")")},_clickHandler:function(d,c){w.stop(d);if(this.action){var g;this.action.data.features&&0<this.action.data.features.length&&(g=this.action.data.features[0].getLayer());this.action.onExecute(this.action.data,g)}this.emit("click",{isEnter:c})}})})},"jimu/RelatedRecordsPopupProjector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/has dojo/query dojo/Deferred dojo/promise/all dijit/_WidgetBase dijit/_TemplatedMixin esri/undoManager esri/OperationBase esri/tasks/RelationshipQuery esri/dijit/Popup esri/dijit/PopupMobile esri/graphicsUtils esri/dijit/PopupTemplate jimu/utils jimu/ConfigManager jimu/dijit/DropdownMenu jimu/LayerInfos/LayerInfos".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u,t){var z=E([n,d],{baseClass:"related-records-popup-projector",templateString:"\x3cdiv\x3e\x3cdiv class\x3d'operation-box' data-dojo-attach-point\x3d'operationBox' style\x3d'display: none'\x3e\x3cdiv class\x3d'previos-btn feature-action' data-dojo-attach-point\x3d'previouBtn'data-dojo-attach-event\x3d'click:_onPreviouBtnClick'\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-title' data-dojo-attach-point\x3d'operationTitle'\x3eabc\x3c/div\x3e\x3cdiv class\x3d'add-new-btn' data-dojo-attach-point\x3d'addNewBtn'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'content-box' data-dojo-attach-point\x3d'contentBox'\x3e\x3c/div\x3e\x3c/div\x3e",
popup:null,popupManager:null,undoManager:null,originalFeature:null,originalJimuLayerInfo:null,_temporaryData:null,postCreate:function(){this.undoManager=new c;this.layerInfosObj=t.getInstanceSync();var x=q.getObject("_wabProperties.referToFeatureLayerId",!1,this.originalFeature)||this.originalFeature.getLayer().id;this.originalJimuLayerInfo=this.layerInfosObj.getLayerInfoById(x);this._temporaryData={eventHandles:[],dijits:[]};window.isRTL?w.addClass(this.previouBtn,"icon-arrow-forward"):w.addClass(this.previouBtn,
"icon-arrow-back");x=this._createOperation({feature:this.originalFeature,oriJimuLayerInfo:this.originalJimuLayerInfo});this.showRelatedTables(x);this.popupUIController="esri.dijit.Popup"===this.popup.declaredClass?new z.PopupUIController(this):new z.PopupMobileUIController(this);this.popupUIController.addDomNode(this.domNode)},destroy:function(){this._clearPage();this.undoManager.destroy();this.popupUIController.destroy();this.inherited(arguments)},_getRelatedTableInfoArray:function(x){x=x.data.oriJimuLayerInfo;
var y=new l;x.getRelatedTableInfoArray().then(q.hitch(this,function(D){y.resolve(D)}));return y},_getRelatedRecordsByRelatedQuery:function(x){return x.oriJimuLayerInfo.getRelatedRecords(x.feature,x.destJimuLayerInfo,x.relationshipIndex)},_ignoreCaseToGetFieldObject:function(x,y){var D=null;y&&x&&x.fields&&A.some(x.fields,function(H){if(H.name.toLowerCase()===y.toLowerCase())return D=H,!0});return D},getLocaleDateTime:function(x){return p.localizeDate(new Date(x),{fullYear:!0,formatLength:"medium"})},
_getDisplayTitleOfRelatedRecord:function(x,y,D){var H=x.getInfoTemplate();return(x="popupTitle"===D&&H?"function"===typeof H.title?H.title(y):H.title:this._getDisplayTitleFromPopup(x,y,D))?x:" "},_getDisplayTitleFromPopup:function(x,y,D){(x=this._getPopupTemplateWithOnlyDisplayField(x,D))?(y.setInfoTemplate(x),D=this.popupUIController.getDisplayTitle(y),y.setInfoTemplate(null)):D=y.attributes[D];return D},_getPopupTemplateWithOnlyDisplayField:function(x,y){x=x.getPopupInfo()||x._getDefaultPopupInfo(x.layerObject);
var D={title:"",fieldInfos:[],description:"",showAttachments:!1,mediaInfos:[]};try{x&&x.fieldInfos&&y&&A.some(x.fieldInfos,function(H){return H.fieldName.toLowerCase()===y.toLowerCase()?(H=q.clone(H),H.visible=!0,D.fieldInfos.push(H),!0):!1},this)}catch(H){console.error(H)}return new h(D)},_canShowRelatedData:function(x){var y=!0;(x=x.getPopupInfo())&&x.relatedRecordsInfo&&(y=!1!==x.relatedRecordsInfo.showRelatedRecords);return y},setPopupContent:function(x){this._clearPage();x.data.destJimuLayerInfo?
x.data.relatedFeature||this.showRelatedRecords(x):this.showFeature(x);this.undoManager.peekUndo()?this.popupUIController.changeRefDomNode():this.popupUIController.revertRefDomNode()},showFeature:function(x){var y=x.data,D=y.oriJimuLayerInfo.layerObject,H=q.getObject("_wabProperties.originalLayerName",!1,D)||y.oriJimuLayerInfo.title;D=q.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,D);var I=this._getDisplayTitleOfRelatedRecord(y.oriJimuLayerInfo,y.feature,D);"popupTitle"!==
D&&(I=H+": "+I);this._setOperationTitle(I);q.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",null,y.oriJimuLayerInfo.layerObject);y.oriJimuLayerInfo.loadInfoTemplate().then(q.hitch(this,function(N){y.oriJimuLayerInfo.layerObject.infoTemplate||x.data.feature.setInfoTemplate(N);this.popupUIController.setFeature(x.data.feature);y.oriJimuLayerInfo.layerObject.infoTemplate||x.data.feature.setInfoTemplate(null)}));this.showRelatedTables(x);this.popupManager.initPopupMenu([x.data.feature]);
this.popupUIController.updateZoomToBtn([x.data.feature])},showRelatedRecords:function(x){var y=x.data,D=q.getObject("_wabProperties.originalLayerName",!1,y.destJimuLayerInfo.layerObject)||y.destJimuLayerInfo.title;this._setOperationTitle(D);this._clearPage();q.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",y,y.destJimuLayerInfo.layerObject);q.setObject("_wabProperties.popupInfo.originalFeature",this.originalFeature,y.destJimuLayerInfo.layerObject);q.setObject("_wabProperties.popupInfo.layerForActionWithEmptyFeatures",
y.destJimuLayerInfo.layerObject,this.popup);this._getRelatedRecordsByRelatedQuery(y).then(q.hitch(this,function(H){0<H.length?this._setTitle(window.jimuNls.popup.relatedRecords):this._setTitle(window.jimuNls.popup.noRelatedRecotds,"font-normal");var I=this._showFieldSelector(y.destJimuLayerInfo);A.forEach(H,function(N,S){N._layer=y.destJimuLayerInfo.layerObject;var M=this._getDisplayTitleOfRelatedRecord(y.destJimuLayerInfo,N,I);S=w.create("div",{"class":"item record-item "+(0===S%2?"oddLine":"evenLine"),
innerHTML:M},this.contentBox);S.relatedRecord=N;S=m(S,"click",q.hitch(this,function(){this._addOperation(x);var Q=this._createOperation({feature:N,oriJimuLayerInfo:y.destJimuLayerInfo,relationshipIndex:y.relationshipIndex});this.setPopupContent(Q)}));this._temporaryData.eventHandles.push(S)},this);this.popupManager.initPopupMenu(H);this.popupUIController.updateZoomToBtn(H)}));this.popupUIController.setContent(this.domNode)},showRelatedTables:function(x){this._canShowRelatedData(x.data.oriJimuLayerInfo)&&
this._getRelatedTableInfoArray(x).then(q.hitch(this,function(y){0<y.length&&this._setTitle(window.jimuNls.popup.relatedTables);var D={};A.forEach(y,function(I){void 0===D[I.id]?D[I.id]=0:D[I.id]++},this);var H={};A.forEach(y,function(I,N){void 0===H[I.id]?H[I.id]=0:H[I.id]++;var S='\x3cdiv title\x3d"'+I.title+'"\x3e'+I.title+"\x3c/div\x3e",M=w.create("div",{"class":"item table-item "+(0===N%2?"oddLine":"evenLine"),innerHTML:S},this.contentBox),Q=H[I.id];if(0<D[I.id]){N=x.data.oriJimuLayerInfo.getLayerObject();
var da=I.getLayerObject();k({oriLayerObject:N,relatedLayerObject:da}).then(q.hitch(this,function(J){J=x.data.oriJimuLayerInfo.getOriRelationshipByDestLayer(J.oriLayerObject,J.relatedLayerObject,Q);J=J.name||J.id;M.innerHTML=S+('\x3cdiv class\x3d"relationshipName" title\x3d"'+J+'"\x3e('+J+")\x3c/div\x3e")}))}N=m(M,"click",q.hitch(this,function(){I.getLayerObject().then(q.hitch(this,function(){this._addOperation(x);var J=this._createOperation({feature:x.data.feature,oriJimuLayerInfo:x.data.oriJimuLayerInfo,
destJimuLayerInfo:I,relationshipIndex:Q});this.setPopupContent(J)}))}));this._temporaryData.eventHandles.push(N)},this)}))},_createOperation:function(x){return new z.Operation({feature:x.feature||null,oriJimuLayerInfo:x.oriJimuLayerInfo||null,destJimuLayerInfo:x.destJimuLayerInfo||null,relatedFeature:x.relatedFeature||null,relationshipIndex:x.relationshipIndex||0},this)},_addOperation:function(x){this.undoManager.add(x)},_onPreviouBtnClick:function(){this.undoManager.undo()},_clearPage:function(){w.empty(this.contentBox);
A.forEach(this._temporaryData.eventHandles,function(x){x&&x.remove&&x.remove()},this);this._temporaryData.eventHandles=[];A.forEach(this._temporaryData.dijits,function(x){x&&x.destroy&&x.destroy()},this);this._temporaryData.dijits=[]},_setTitle:function(x,y){x&&w.create("div",{"class":"title-box "+(y?y:""),innerHTML:x},this.contentBox)},_setOperationTitle:function(x){w.setAttr(this.operationTitle,"innerHTML",x);w.setAttr(this.operationTitle,"title",x)},_showFieldSelector:function(x){var y="objecid",
D=r(".title-box",this.contentBox)[0],H=x.layerObject,I=[];if(!D||!x)return y;var N=x.getPopupInfo();N&&N.title&&I.push({label:window.jimuNls.popup.saveAsPopupTitle,value:"popupTitle"});var S=[];N&&N.fieldInfos?A.forEach(N.fieldInfos,function(J){var R={};J.visible&&(R.name=J.fieldName,R.alias=J.label,S.push(R))}):S=H.fields;A.forEach(S,function(J){"globalid"!==J.name.toLowerCase()&&"shape"!==J.name.toLowerCase()&&I.push({label:J.alias||J.name,value:J.name})});D=(new u({items:I})).placeAt(D);D.domNode.title=
window.jimuNls.popup.chooseFieldTip;var M=q.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,H),Q=this._ignoreCaseToGetFieldObject(x.layerObject,x.layerObject.displayField||x.layerObject.objectIdField),da=B.getInstance().getAppConfig();M?y=M:"2.3"===da.configWabVersion&&Q&&Q.name?y=Q.name:N&&N.title?y="popupTitle":Q&&Q.name?y=Q.name:0<I.length&&(y=I[0].value);y&&(D.setHighlightValue(y),q.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",y,H));this._temporaryData.dijits.push(D);
x=m(D,"click-item",q.hitch(this,function(J,R){r(".item.record-item",this.contentBox).forEach(q.hitch(this,function(W){q.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",R,H);var X=this._getDisplayTitleOfRelatedRecord(J,W.relatedRecord,R);W.innerHTML=X}))},x));this._temporaryData.eventHandles.push(x);return y}});z.Operation=E([g],{constructor:function(x,y){this.data=x;this.relatedRecordsPopupProjector=y},performUndo:function(){this.relatedRecordsPopupProjector.setPopupContent(this)}});
z.PopupUIController=E([],{constructor:function(x){this.rrPopupProjector=x;this.popup=x.popup;this.initTempPopup();this._initTempPopupForDisplayTitle();this._initZoomToBtn();this._setScrollable()},initTempPopup:function(){this._tempPopup=new e({},w.create("div"))},_initTempPopupForDisplayTitle:function(){this._tempPopupForDisplayTitle=new e({},w.create("div"));this._tempPopupForDisplayTitle.show()},destroy:function(){this._tempPopup.destroy();this._tempPopupForDisplayTitle.destroy();this._zoomToBtnClickHandle&&
this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove();this._zoomToBtnANode&&w.destroy(this._zoomToBtnANode);this.toucemoveScrollHandle&&this.toucemoveScrollHandle.remove&&this.toucemoveScrollHandle.remove()},addDomNode:function(x){setTimeout(q.hitch(this,function(){var y=this._getRefDomNode();y&&w.place(x,y,"after")}),1)},setFeature:function(x){this._tempPopup.setFeatures([x]);if(x=r(".esriViewPopup",this._tempPopup.domNode)[0])this.setContent(x),w.place(this.rrPopupProjector.domNode,
x,"after"),this._unsetScrollable()},setContent:function(x){var y=r(".related-records-popup-projector").parent()[0];y&&y.removeChild(this.rrPopupProjector.domNode);this.popup.setContent(x);this._unsetScrollable()},_setScrollable:function(){var x=r(".contentPane",this.popup.domNode)[0];v("esri-touch")&&x&&(this.toucemoveScrollHandle=m(x,"touchmove",q.hitch(this,function(y){y.preventDefault();r(".esriViewPopup",this.popup.domNode)[0]&&(y=x.firstChild,y instanceof Text&&(y=x.childNodes[1]),this.rrPopupProjector.domNode&&
w.setStyle(this.rrPopupProjector.contentBox,{"-webkit-transition-property":"-webkit-transform","-webkit-transform":"translate("+y._currentX+"px, "+y._currentY+"px)"}))})))},_unsetScrollable:function(){w.setStyle(this.rrPopupProjector.contentBox,{"-webkit-transition-property":"none","-webkit-transform":"none"});w.setStyle(this.rrPopupProjector.domNode,{"-webkit-transition-property":"none","-webkit-transform":"none"})},getDisplayTitle:function(x){this._tempPopupForDisplayTitle.setFeatures([x]);return(x=
r("td.attrValue",this._tempPopupForDisplayTitle.domNode)[0])&&x.innerHTML},_getRefDomNode:function(){return this._getViewPopupDomNode()},_getViewPopupDomNode:function(){return r(".esriViewPopup",this.popup.domNode)[0]},_setPopupTitleInBody:function(){this.rrPopupProjector.undoManager.peekUndo()?this._tempPopup.set("titleInBody",!1):this._tempPopup.set("titleInBody",!0)},_initZoomToBtn:function(){var x=r(".actionList",this.popup.domNode)[0];this._oldZoomToBtnANdoe=r(".action",x)[0];this._zoomToBtnANode=
w.create("a",{"class":"action",style:"display: none",href:"javascript:void(0)"},x);this._zoomToBtn=w.create("span",{innerHTML:window.jimuNls.common.zoomTo},this._zoomToBtnANode);this._showOldZoomToBtn()},_hideZoomToBtn:function(){this._zoomToBtnANode&&w.setStyle(this._zoomToBtnANode,"display","none")},_showZoomToBtn:function(){this._zoomToBtnANode&&w.setStyle(this._zoomToBtnANode,"display","inline-block")},_hideOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&w.setStyle(this._oldZoomToBtnANdoe,"display",
"none")},_showOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&w.setStyle(this._oldZoomToBtnANdoe,"display","inline-block")},updateZoomToBtn:function(x){this._hideOldZoomToBtn();!x||1>x.length||!x[0].geometry?this._hideZoomToBtn():(this._showZoomToBtn(),this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove(),this._zoomToBtnClickHandle=m(this._zoomToBtn,"click",q.hitch(this,function(){var y=null;try{y=f.graphicsExtent(x)}catch(D){console.error(D)}y&&(this.rrPopupProjector.popupManager.mapManager.map.setExtent(y),
this.popup.hide())})))},changeRefDomNode:function(){w.setStyle(this.rrPopupProjector.operationBox,"display","block");w.addClass(this.rrPopupProjector.domNode,"second-page-mode");var x=this._getViewPopupDomNode();x&&w.addClass(x,"second-page-mode")},revertRefDomNode:function(){w.setStyle(this.rrPopupProjector.operationBox,"display","none");w.removeClass(this.rrPopupProjector.domNode,"second-page-mode");this._hideZoomToBtn();this._showOldZoomToBtn()}});z.PopupMobileUIController=E([z.PopupUIController],
{initTempPopup:function(){this._tempPopup=new a({},w.create("div"))},setFeature:function(x){this._tempPopup.setFeatures([x]);x=r(".esriMobileInfoView.esriMobilePopupInfoView",this._tempPopup.domNode)[0];if(x=r(".esriViewPopup",x)[0])this.setContent(x),w.place(this.rrPopupProjector.domNode,x,"after")},updateZoomToBtn:function(){},_initZoomToBtn:function(){},_getRefDomNode:function(){return r(".esriMobilePopupInfoView .esriMobileInfoViewItem")[1]},_getViewPopupDomNode:function(){var x=r(".esriMobileInfoView.esriMobilePopupInfoView")[0];
return r(".esriViewPopup",x)[0]}});return z})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented dojo/has!extend-esri?./OperationBase".split(" "),function(E,q,A,w,m,v){E=E([v],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(r){r=r||{};r.maxOperations&&
(this.maxOperations=r.maxOperations);this._historyStack=[]},add:function(r){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,0,r);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var r=this.peekUndo();this.position--;r?(r=r.performUndo(),this.onUndo(),this._checkAvailability(),w(r).then(q.hitch(this,this.onUndoComplete))):(this.onUndo(),
this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var r=this.peekRedo();this.position++;r?(r=r.performRedo(),this.onRedo(),this._checkAvailability(),w(r).then(q.hitch(this,this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=
!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},
get:function(r){return this._historyStack[r]},remove:function(r){0<this._historyStack.length&&(this._historyStack.splice(r,1),0<this.position&&r<this.position&&this.position--,this._checkAvailability())},destroy:function(){this._historyStack=null}});A("extend-esri")&&(m.UndoManager=E);return E})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(E,q,A){E=E(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(w){w=
w||{};w.label&&(this.label=w.label)},performUndo:function(){console.log("performUndo has not been implemented")},performRedo:function(){console.log("performRedo has not been implemented")}});q("extend-esri")&&(A.OperationBase=E);return E})},"jimu/dijit/DropdownMenu":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/query dojo/Evented".split(" "),function(E,q,A,w,m,v,r,l,k){return E([q,A,k],{baseClass:"jimu-dijit-dropdownmenu",
declaredClass:"jimu.dijit.DropdownMenu",templateString:"\x3cdiv\x3e\x3c/div\x3e",itemHeight:24,iconSize:16,offsetY:5,shelter:null,paddingOffsetY:8,dropdownMenuClass:"",dropdownMenuItemClass:"dropdown-menu-item",items:null,highlightValue:"",highlightSelectedItemAfterClick:!0,menuLeadingIcon:!0,maxDisplayItems:10,postCreate:function(){this.inherited(arguments);this.items||(this.items=[]);this.shelter=v.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-shelter"\x3e\x3c/div\x3e');this.itemsContainer=v.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-items-container '+
this.dropdownMenuClass+'"\x3e\x3c/div\x3e');0>=this.maxDisplayItems&&(this.maxDisplayItems=20);this.itemsContainer.style.maxHeight=this.itemHeight*this.maxDisplayItems+2*this.paddingOffsetY+"px";m.forEach(this.items,w.hitch(this,function(n){var d=v.toDom('\x3cdiv class\x3d"'+this.dropdownMenuItemClass+' jimu-ellipsis"\x3e'+n.label+"\x3c/div\x3e");d.itemInfo=n;d.title=n.label;v.place(d,this.itemsContainer)}));this.own(r(this.domNode,"click",w.hitch(this,this._onIconClick)));this.own(r(this.shelter,
"click",w.hitch(this,this._onShelterClick)));this.own(r(this.itemsContainer,"click",w.hitch(this,this._onItemsContainerClick)));this.highlightValue&&this.setHighlightValue(this.highlightValue)},_onIconClick:function(n,d){n.stopPropagation();this.isShowing()?this.hideMenu():(n=v.position(d||n.target||n.srcElement),this.showMenu(n))},_onShelterClick:function(){this.hideMenu()},_onItemsContainerClick:function(n){n.stopPropagation();n=n.target||n.srcElement;v.hasClass(n,this.dropdownMenuItemClass)&&(n=
n.itemInfo.value,this.highlightSelectedItemAfterClick&&this.setHighlightValue(n),this.emit("click-item",n));this.hideMenu()},clearHighlightValue:function(){l("."+this.dropdownMenuItemClass,this.itemsContainer).removeClass("selected")},setHighlightValue:function(n){this.clearHighlightValue();l("."+this.dropdownMenuItemClass,this.itemsContainer).some(w.hitch(this,function(d){return d.itemInfo.value===n?(v.addClass(d,"selected"),!0):!1}))},getHighlightValue:function(){var n=l("."+this.dropdownMenuItemClass+
".selected",this.itemsContainer)[0];return n?n.itemInfo.value:null},getHighlightLabel:function(){var n=this.getHighlightValue(),d="";m.some(this.items,function(c){return c.value===n?(d=c.label,!0):!1},this);return d},isShowing:function(){return v.hasClass(this.domNode,"showing")},showMenu:function(n){this.itemsContainer.style.top=n.y+this.iconSize+this.offsetY+"px";this.menuLeadingIcon===window.isRTL?(this.itemsContainer.style.left=n.x+"px",this.itemsContainer.style.right="auto"):(this.itemsContainer.style.right=
window.innerWidth-(n.x+this.iconSize)+"px",this.itemsContainer.style.left="auto");v.place(this.shelter,document.body);v.place(this.itemsContainer,document.body);v.addClass(this.domNode,"showing")},hideMenu:function(){this.itemsContainer.parentNode&&this.itemsContainer.parentNode.removeChild(this.itemsContainer);this.shelter.parentNode&&this.shelter.parentNode.removeChild(this.shelter);v.removeClass(this.domNode,"showing")},destroy:function(){this.hideMenu();v.destroy(this.itemsContainer);v.destroy(this.shelter);
this.inherited(arguments)}})})},"jimu/FilterManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","esri/lang","./LayerInfos/LayerInfos"],function(E,q,A,w,m){var v=null,r=E(null,{_filters:null,layerInfos:null,constructor:function(){this._filters={};window.isBuilder?(A.subscribe("app/mapLoaded",q.hitch(this,this._onMapLoaded)),A.subscribe("app/mapChanged",q.hitch(this,this._onMapChanged))):(A.subscribe("mapLoaded",q.hitch(this,this._onMapLoaded)),A.subscribe("mapChanged",q.hitch(this,
this._onMapChanged)));A.subscribe("widgetDestroyed",q.hitch(this,this._onWidgetDestroyed))},getWidgetFilter:function(l,k){return q.getObject(l+".filterExprs."+k,!1,this._filters)},applyWidgetFilter:function(l,k,n,d,c,g){var b="object"===typeof l?l:null;b&&(l=b.layerId,k=b.widgetId,n=b.expression,d=b.enableMapFilter,c=b.useAND,g=b.zoomAfterFilter);this._setFilterExp(l,k,n,d,c);k=this.layerInfos.getLayerInfoById(l)||this.layerInfos.getTableInfoById(l);l=this.getFilterExp(l);null!==l&&k&&k.setFilter(l,
{zoomAfterFilter:g})},_onMapLoaded:function(){this.layerInfos=m.getInstanceSync();this._traversalFilter()},_onMapChanged:function(){this.layerInfos=m.getInstanceSync();this._traversalFilter()},_onWidgetDestroyed:function(l){for(var k in this._filters)if(this._filters[k]){var n=this._filters[k];if(n){var d=n.filterExprs;n=n.mapFilterControls;d&&delete d[l];n&&delete n[l]}}},_traversalFilter:function(){this.layerInfos.traversalAll(q.hitch(this,function(l){this._filters[l.id]||(this._filters[l.id]={definitionExpression:l.getFilter(),
filterExprs:{},mapFilterControls:{}})}))},_getPriorityOfMapFilter:function(l){l=q.getObject(l+".mapFilterControls",!1,this._filters);var k=0,n;for(n in l){var d=l[n];d.priority>k&&(k=d.priority)}return k},_getMapFilterControl:function(l){l=q.getObject(l+".mapFilterControls",!1,this._filters);var k=0,n=null,d;for(d in l){var c=l[d];c.priority>k&&(k=c.priority,n=c)}return n},_setFilterExp:function(l,k,n,d,c){var g=l+".filterExprs."+k,b=l+".mapFilterControls."+k;n?(q.setObject(g,n,this._filters),w.isDefined(d)&&
(l=this._getPriorityOfMapFilter(l),q.setObject(b,{enable:d,useAND:c,priority:l+1},this._filters))):(q.getObject(g,!1,this._filters)&&delete this._filters[l].filterExprs[k],q.getObject(b,!1,this._filters)&&delete this._filters[l].mapFilterControls[k])},getFilterExp:function(l,k){if(!this._filters[l])return null;var n=[],d=this._filters[l].definitionExpression,c=this._filters[l].filterExprs;l=this._getMapFilterControl(l);for(var g in c){var b=c[g];k&&0<=g.indexOf(k)||b&&n.push("("+b+")")}k=n.join(" AND ");
return d&&l&&l.enable||d&&null===l?k?l&&!1===l.useAND?"("+d+") OR "+k:"("+d+") AND "+k:d:k}});r.getInstance=function(){if(null===v)v=new r,window._filterManager=v;else return v};return r})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic"],function(E,q,A){var w=null;var m=E(null,{constructor:function(v){A.subscribe("publishData",q.hitch(this,this.onDataPublished));A.subscribe("fetchData",q.hitch(this,this.onFetchData));A.subscribe("clearAllData",q.hitch(this,
this.onClearAllData));A.subscribe("removeData",q.hitch(this,this.onRemoveData));A.subscribe("clearDataHistory",q.hitch(this,this.onClearDataHistory));this.widgetManager=v},_dataStore:{},onDataPublished:function(v,r,l,k){"undefined"===typeof k&&(k=!1);this._dataStore[r]?(this._dataStore[r].current=l,k&&(this._dataStore[r].history?this._dataStore[r].history.push(l):this._dataStore[r].history=[l])):(this._dataStore[r]={current:l},k&&(this._dataStore[r].history=[l]))},onFetchData:function(v){var r;if(v)"framework"===
v?this._dataStore[v]?A.publish("dataFetched","framework","framework",this._dataStore[v].current,this._dataStore[v].history):A.publish("noData","framework","framework"):(r=this.widgetManager.getWidgetById(v))?this._dataStore[v]?A.publish("dataFetched",r.name,v,this._dataStore[v].current,this._dataStore[v].history):A.publish("noData",r.name,v):A.publish("noData",void 0,v);else{for(var l in this._dataStore)(r=this.widgetManager.getWidgetById(l))&&A.publish("dataFetched",r.name,l,this._dataStore[l].current,
this._dataStore[l].history);r||A.publish("noData",void 0,void 0)}},onClearAllData:function(){this._dataStore={};A.publish("allDataCleared")},onRemoveData:function(v){delete this._dataStore[v];A.publish("dataRemoved",v)},onClearDataHistory:function(v){this._dataStore[v]&&(this._dataStore[v].history=[]);A.publish("dataHistoryCleared",v)}});m.getInstance=function(v){null===w&&(w=new m(v));return w};return m})},"jimu/SelectionManager":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/topic dojo/on esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/geometry/geometryEngine esri/graphic esri/Color esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b){var e=null,a=E(null,{constructor:function(){window.isBuilder?(m.subscribe("app/mapLoaded",A.hitch(this,this._onMapLoaded)),m.subscribe("app/mapChanged",A.hitch(this,this._onMapChanged))):(m.subscribe("mapLoaded",A.hitch(this,this._onMapLoaded)),m.subscribe("mapChanged",A.hitch(this,this._onMapChanged)))},_displayLayers:{},previousMapScale:null,setSelectionSymbol:function(f){var h=f.geometryType,p=new c(c.STYLE_CIRCLE,16,null,d.fromArray([0,255,255])),B=new g(g.STYLE_SOLID,
d.fromArray([0,255,255]),2),u=new b(b.STYLE_SOLID,B,d.fromArray([0,255,255,.3]));"esriGeometryPoint"===h?f.setSelectionSymbol(p):"esriGeometryPolyline"===h?f.setSelectionSymbol(B):"esriGeometryPolygon"===h&&f.setSelectionSymbol(u)},updateSelectionByFeatures:function(f,h,p){0<h.length&&(h=w.map(h,A.hitch(this,function(u){var t=null;t=0<=f.graphics.indexOf(u)?new n(u.toJson()):u;t.wabIsTemp=!0;return t})));f.getSelectionSymbol()||this.setSelectionSymbol(f);var B=new q;f._selectHandler({features:h},
p,null,null,B);this._isLayerNeedDisplayLayer(f)&&(this._displayLayers[f.id]||(this._displayLayers[f.id]=this._createDisplayLayer(f)),this._updateDisplayLayer(f,h,p));return B},getDisplayLayer:function(f){return this._displayLayers[f]},setSelection:function(f,h){return this.updateSelectionByFeatures(f,h,r.SELECTION_NEW)},addFeaturesToSelection:function(f,h){return this.updateSelectionByFeatures(f,h,r.SELECTION_ADD)},removeFeaturesFromSelection:function(f,h){return this.updateSelectionByFeatures(f,
h,r.SELECTION_SUBTRACT)},clearSelection:function(f){var h=new q;this.clearDisplayLayer(f);f.clearSelection();h.resolve();return h},clearDisplayLayer:function(f){(f=this._displayLayers[f.id])&&f.clear()},getClientFeaturesByGeometry:function(f,h,p){return w.filter(f.graphics,A.hitch(this,function(B){return B.geometry?p?k.contains(h,B.geometry):k.intersects(h,B.geometry):!1}))},getUnionGeometryBySelectedFeatures:function(f){var h=null;f=f.getSelectedFeatures();0<f.length&&(h=w.map(f,A.hitch(this,function(p){return p.geometry})),
h=k.union(h));return h},_createDisplayLayer:function(f){var h=new l,p=f.objectIdField;h.fields=f.fields;h.id="displayLayer_of_"+f.id;this.map.addLayer(h);if(!this.map.spatialReference.equals(f.spatialReference)||f.hasWebGLSurface()){var B=f.getSelectionSymbol();v(f,"update-end",A.hitch(this,function(){var u=Math.round(this.map.getScale());if(this.previousMapScale!==u&&h.graphics&&0<h.graphics.length){this.previousMapScale=u;var t=w.map(h.graphics,function(z){return z.attributes[p]});u=w.filter(f.graphics,
function(z){return 0<=t.indexOf(z.attributes[p])});h.clear();w.forEach(u,A.hitch(this,function(z){z=new n(z.toJson());z.setSymbol(B);h.add(z)}))}}))}return h},_updateDisplayLayer:function(f,h,p){var B=this._displayLayers[f.id],u=f.getSelectionSymbol();f.hasWebGLSurface()?this._updateDisplayLayerWebGL(f,B,u,h,p):(h=f.getSelectedFeatures(),this.clearDisplayLayer(f),w.forEach(h,A.hitch(this,function(t){t.visible&&(t.setSymbol(null),t=new n(t.toJson()),t.setSymbol(u),B.add(t))})))},_updateDisplayLayerWebGL:function(f,
h,p,B,u){u===r.SELECTION_NEW&&(f._selectedFeaturesWebGL={});u===r.SELECTION_NEW||u===r.SELECTION_ADD?w.forEach(B,A.hitch(this,function(z){z.visible&&(f._selectedFeaturesWebGL[z.attributes[f.objectIdField]]=z)})):u===r.SELECTION_SUBTRACT&&w.forEach(B,A.hitch(this,function(z){z=z.attributes[f.objectIdField];z in f._selectedFeaturesWebGL&&delete f._selectedFeaturesWebGL[z]}));this.clearDisplayLayer(f);for(var t in f._selectedFeaturesWebGL)B=new n(f._selectedFeaturesWebGL[t].toJson()),B.setSymbol(p),
h.add(B)},_isLayerNeedDisplayLayer:function(f){return f.hasWebGLSurface()||!f.getMap()},_onMapLoaded:function(f){this.map=f},_onMapChanged:function(f){this.map=f}});a.getInstance=function(){e||(e=new a,window._selectionManager=e);return e};return a})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase jimu/dijit/BindLabelPropsMixin dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(E,q,A,w,m,v,r,l,
k,n){return E([v,r,l],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(m.subscribe("publishData",q.hitch(this,this._onReceiveData)));this.own(m.subscribe("dataFetched",q.hitch(this,this._onReceiveData)));
this.own(m.subscribe("noData",q.hitch(this,this._onNoData)));this.own(m.subscribe("dataSourceDataUpdated",q.hitch(this,this.onDataSourceDataUpdate)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(d){},onSignOut:function(){},onPositionChange:function(d){this.setPosition(d)},setPosition:function(d,c){this.position=
d;var g=k.getPositionStyle(this.position);g.position="absolute";c||(c="map"===d.relativeTo?this.map.id:window.jimuConfig.layoutId);w.place(this.domNode,c);w.setStyle(this.domNode,g);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return w.getMarginBox(this.domNode)},setMap:function(d){this.map=d},setState:function(d){this.state=d},setWindowState:function(d){this.windowState=d},resize:function(){},onConfigChanged:function(d){},onAppConfigChanged:function(d,
c,g){},onAction:function(d,c){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return n.getInstance().getPanelById(this.id+"_panel");var d=n.getInstance().getPanelById(this.gid+"_panel");return d?d:n.getInstance().getPanelById(this.id+"_panel")},publishData:function(d,c){"undefined"===typeof c&&(c=!1);m.publish("publishData",this.name,this.id,d,c)},fetchData:function(d){d?m.publish("fetchData",d):0!==this.listenWidgetIds.length?A.forEach(this.listenWidgetIds,
function(c){m.publish("fetchData",c)},this):m.publish("fetchData")},fetchDataByName:function(d){d=this.widgetManager.getWidgetsByName(d);A.forEach(d,function(c){this.fetchData(c.id)},this)},openWidgetById:function(d){return this.widgetManager.triggerWidgetOpen(d)},_onReceiveData:function(d,c,g,b){if(c!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(c)))this.onReceiveData(d,c,g,b)},onReceiveData:function(d,c,g,b){},updateDataSourceData:function(d,c){m.publish("updateDataSourceData",
"widget~"+this.id+"~"+d,c)},onDataSourceDataUpdate:function(d,c){},_onNoData:function(d,c){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(c)))this.onNoData(d,c)},onNoData:function(d,c){}})})},"jimu/dijit/BindLabelPropsMixin":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/query","dojo/_base/array","jimu/utils"],function(E,q,A,w,m){return E("jimu-bind-label-props-mixin",null,{isRenderIdForAttrs:!1,buildRendering:function(){this.inherited(arguments);if(this.isRenderIdForAttrs){var v=
A("[data-a11y-label-id],[data-a11y-label-by], [data-label-for], [data-label-id]",this.domNode);(q.getAttr(this.domNode,"data-a11y-label-id")||q.getAttr(this.domNode,"data-a11y-label-by")||q.getAttr(this.domNode,"data-label-for")||q.getAttr(this.domNode,"data-label-id"))&&v.unshift(this.domNode);var r={},l=[],k={},n=0,d="jimuUniqName_"+m.getUUID();w.forEach(v,function(f){var h=q.getAttr(f,"data-a11y-label-id"),p=q.getAttr(f,"data-a11y-label-by"),B=q.getAttr(f,"data-label-for"),u=q.getAttr(f,"data-label-id");
h?(q.removeAttr(f,"data-a11y-label-id"),a=d+"_"+n,q.setAttr(f,"id",a),r[h]=a,n++):p?l.push(f):B?(k.hasOwnProperty(B)||(k[B]={}),k[B].forDom=f):(k.hasOwnProperty(u)||(k[u]={}),k[u].idDom=f)});for(var c in l){v=l[c];var g=q.getAttr(v,"data-a11y-label-by").split(" "),b=[];w.forEach(g,function(f){b.push(r[f])});q.removeAttr(v,"data-a11y-label-by");q.setAttr(v,"aria-labelledby",b.join(" "))}for(var e in k){var a=d+"_"+n;c=k[e].forDom;v=k[e].idDom;c&&(q.removeAttr(c,"data-label-for"),q.setAttr(c,"for",
a));v&&(q.removeAttr(v,"data-label-id"),q.setAttr(v,"id",a));n++}}}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g){var b=null;var e=E(null,{constructor:function(){this.panels=[];this.widgetManager=g.getInstance();l(window,"resize",q.hitch(this,this.onWindowResize));this.activePanel=
null;k.subscribe("/dnd/move/start",q.hitch(this,this._onMoveStart));k.subscribe("widgetActived",q.hitch(this,this._onWidgetActived))},showPanel:function(a){var f=new v,h=this.getPanelById(a.id+"_panel");h?("closed"===h.state&&this.openPanel(h),f.resolve(h)):r({Panel:this._loadPanelClass(a.panel.uri),nls:this._loadThemeI18N(a.panel.uri)}).then(q.hitch(this,function(p){var B=a.id+"_panel",u=this.getPanelById(B),t={label:a.label,config:a,uri:a.panel.uri,position:a.panel.position,map:this.map,widgetManager:this.widgetManager,
panelManager:this,id:B,gid:a.gid,nls:p.nls};q.mixin(t,a.panel.options);try{u=new p.Panel(t),console.log("panel ["+B+"] created.")}catch(z){console.log("create panel error: "+z+", panelId: "+B);f.reject(z);return}u.setPosition(a.panel.position);c.setVerticalCenter(u.domNode);this.openPanel(u);u.domNode.addEventListener("click",q.hitch(this,this._onPanelClick,u),{capture:!0});f.resolve(u)}));return f},setMap:function(a){this.map=a;l(this.map,"resize",q.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a))return;for(var f=0;f<this.panels.length;f++)this.panels[f].gid===a.gid&&this.panels[f].id!==a.id&&this.closePanel(this.panels[f])},closeAllPanelsInGroup:function(a){for(var f=0;f<this.panels.length;f++)this.panels[f].gid===a&&this.closePanel(this.panels[f])},openPanel:function(a){var f=new v;if("string"===typeof a){if(a=this.getPanelById(a),!a)return f.reject(),f}else this.panels.some(function(h){return h.id===a.id})||this.panels.push(a);if(!a.started)try{a.started=
!0,a.startup()}catch(h){console.error("fail to startup panel "+a.id+". "+h.stack)}if("opened"===a.state)return this._activePanel(a),f.resolve(a),f;a.setState("opened");return this.playOpenPanelAnimation(a).then(q.hitch(this,function(){w.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var f=new v;return"string"===typeof a&&(a=this.getPanelById(a),!a)||"closed"===a.state?(f.resolve(),f):this.playClosePanelAnimation(a).then(q.hitch(this,function(){this.activePanel&&
this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&w.setStyle(a.domNode,"display","none")}))},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(f){console.log(console.error("fail to minimize panel "+a.id+". "+f.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;
"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(f){console.log(console.error("fail to maximize panel "+a.id+". "+f.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(f){console.log(console.error("fail to noralize panel "+a.id+". "+f.stack))}},changeWindowStateTo:function(a,f){if("string"===typeof a&&(a=this.getPanelById(a),
!a))return;"normal"===f?this.normalizePanel(a):"minimized"===f?this.minimizePanel(a):"maximized"===f?this.maximizePanel(a):console.log("error state: "+f)},getPanelById:function(a){for(var f=0;f<this.panels.length;f++)if(this.panels[f].id===a)return this.panels[f]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==
this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(f){console.log(console.error("fail to destroy panel "+a.id+". "+f.stack))}}},destroyAllPanels:function(){var a=A.map(this.panels,function(f){return f.id});A.forEach(a,function(f){this.destroyPanel(f)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return n();var f=new v;"string"===typeof a.openAnimation?"fadeIn"===a.openAnimation?(w.setStyle(a.domNode,{opacity:0,display:""}),m.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){f.resolve()}}).play()):f.resolve():f.resolve();return f},playClosePanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return n();var f=new v;"string"===
typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?m.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){f.resolve()}}).play():f.resolve());return f},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var f=w.getMarginBox(window.jimuConfig.layoutId),h=f.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:f.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,
borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?(h=0,this.panels.filter(function(p){return"minimized"===p.windowState&&"closed"!==p.state&&p.id!==a.id}).some(function(p){return 0===p._mobileBottom})&&(h=a.titleHeight),a._mobileBottom=h,f.h>f.w?{left:0,right:0,top:"auto",bottom:h,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:f.w-f.w/2,right:0,top:"auto",bottom:h,width:f.w/2,height:a.titleHeight,contentHeight:f.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}):f.h>f.w?{left:0,right:0,top:h,bottom:0,width:"auto",height:"auto",contentHeight:f.h-h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",
borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:f.w-f.w/2,right:0,top:0,bottom:0,width:f.w/2,height:"auto",contentHeight:f.h-h-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},activatePanel:function(a){"closed"!==a.state&&this._activePanel(a)},
_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&w.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),w.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var f=this.widgetManager.activeWidget;f&&"active"===f.state&&f.getPanel()!==a&&(f.setState("opened"),
!1===f.inPanel&&w.setStyle(f.domNode,"zIndex","undefined"!==typeof f.position.zIndex?f.position.zIndex:"auto"),f.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&w.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var f=this.panels.indexOf(a);-1<f&&this.panels.splice(f,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=
null)},_onMoveStart:function(a){A.forEach(this.panels,function(f){f.domNode===a.node&&this._activePanel(f)},this)},_onWidgetActived:function(a){this.activePanel&&"active"===this.activePanel.state&&a.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),w.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var f=new v;
d([a],function(h){f.resolve(h)});return f},_loadThemeI18N:function(a){var f=new v;a.startWith("themes")?(a=a.split("/"),d(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(h){f.resolve(h)})):f.resolve({});return f}});e.getInstance=function(){null===b&&(b=new e,window._panelManager=b);return b};return e})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(E,q,A,w){return E([w],{widget:null,baseClass:"jimu-widget-frame jimu-container",
postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&q.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(m){this.loading=m;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(m){this.widget=m;this.loading&&
this.loading.destroy();A.place(m.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(m){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+m.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./a11y/BaseWidgetPanel ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),
function(E,q,A,w,m,v,r,l,k,n){E=E([m,v],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var d=this.getAllWidgetConfigs();Array.isArray(this.config.widgets)?(d=this.config.widgets,1<d.length&&this._addTagToGroupPanel()):d=[this.config];A.forEach(d,function(c,g){if(!1!==
c.visible){var b=new l;var e=this.createFrame(c);this._initFrameEvents(e,c,g);this.addChild(e);e.setLoading(b);this.widgetManager.loadWidget(c).then(q.hitch(this,function(a){e.setWidget(a);a.startup()}))}},this)},getAllWidgetConfigs:function(){var d=[];return d=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(d){for(var c=this.getChildren(),g=0;g<c.length;g++)if(c[g].getWidget()&&c[g].getWidget().id===d)return c[g].getWidget()},getWidgets:function(){return this.getChildren().map(function(d){return d.getWidget()})},
createFrame:function(d){return new k},setPosition:function(d,c){this.position=d;var g=n.getPositionStyle(this.position);g.position="absolute";c||(c="map"===d.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(g.display="none");w.place(this.domNode,c);w.setStyle(this.domNode,g)},getPosition:function(){return this.position},setState:function(d){this.state=d},setWindowState:function(d){this.windowState=d},resize:function(){this.getChildren().forEach(function(d){d.resize()})},
onPositionChange:function(d){this.setPosition(d)},onOpen:function(){A.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.openWidget(d.getWidget())},this);this._onOpenAndFocus()},onClose:function(){A.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.closeWidget(d.getWidget())},this)},onMaximize:function(){A.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.maximizeWidget(d.getWidget())},this)},onMinimize:function(){A.forEach(this.getChildren(),
function(d){d.getWidget()&&this.widgetManager.minimizeWidget(d.getWidget())},this)},onNormalize:function(){A.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.normalizeWidget(d.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(d){this._updateConfig(d)},reloadWidget:function(d){this.isWidgetInPanel(d)&&(this._updateConfig(d),this.getChildren().forEach(function(c){c.getWidget()&&c.getWidget().id===d.id&&(c.getWidget().destroy(),c.setLoading(new l),
this.widgetManager.loadWidget(d).then(q.hitch(this,function(g){c.setWidget(g);g.startup();"closed"===this.state&&this.widgetManager.closeWidget(g)})))},this))},isWidgetInPanel:function(d){return A.some(this.getAllWidgetConfigs(),function(c){if(d.id===c.id)return!0})?!0:!1},_updateConfig:function(d){if(Array.isArray(this.config.widgets)){for(var c=-1,g=0;g<this.config.widgets.length;g++)this.config.widgets[g].id===d.id&&(c=g);0<c&&(this.config.widgets[c]=d)}else this.config=d},destroy:function(){this.getChildren().forEach(function(d){try{d.domNode&&
d.destroy()}catch(c){console.error("destroy widget frame error."+c.stack)}});this.inherited(arguments)}});E.extend(r);return E})},"jimu/a11y/BaseWidgetPanel":function(){define("dojo/_base/lang dojo/_base/html dojo/query dojo/on dojo/keys ./../utils".split(" "),function(E,q,A,w,m,v){var r={frameSectionIndex:"91"};r.panelNls=window.jimuNls.panelHeader;r._addTagToGroupPanel=function(){var l=this.config.widgets;this.isGroupPanel=!0;l.forEach(function(k){k.inGroupPanel=!0})};r._setAriaLabel=function(l,
k){if(l.folded){var n=r.panelNls.expanded;q.setStyle(l.containerNode,"display","inherit")}else n=r.panelNls.collapsed,q.setStyle(l.containerNode,"display","none");k=v.getSubstituteString(k,n);q.setAttr(l.titleNode,"aria-label",k)};r._initFrameEvents=function(l,k,n){if(this.isGroupPanel){var d=v.getSubstituteString(k.label,r.panelNls.expanded);k=v.getSubstituteString(k.label,r.panelNls.pressToFocus);q.setAttr(l.titleNode,"aria-label",d);q.setAttr(l.titleNode,"tabindex",r.frameSectionIndex);q.setAttr(l.containerNode,
"aria-label",k);q.setAttr(l.containerNode,"tabindex",r.frameSectionIndex);0===n?this.firstTitleNode=l.titleNode:n===this.config.widgets.length-1&&(this.lastTitleNode=l.titleNode,this.lastContent=l.containerNode);this.own(w(l.titleNode,"click",E.hitch(this,function(){l.foldEnable&&this._setAriaLabel(l,l.label)})));this.own(w(l.titleNode,"keydown",E.hitch(this,function(c){q.hasClass(c.target,"title")&&(c.keyCode===m.TAB?c.target===this.firstTitleNode&&c.shiftKey?(c.preventDefault(),this.lastContent.focus()):
c.target!==this.lastTitleNode||c.shiftKey||"none"!==q.getStyle(this.lastContent,"display")||(c.preventDefault(),this.firstTitleNode.focus()):!l.foldEnable||c.keyCode!==m.ENTER&&c.keyCode!==m.SPACE||(c.stopPropagation(),this._setAriaLabel(l,l.label),l.onFoldableNodeClick()))})));this.own(w(l.containerNode,"keydown",E.hitch(this,function(c){var g=c.target;q.hasClass(g,"jimu-panel-content")?c.keyCode===m.ENTER?(c=A(".jimu-widget",g)[0])&&v.focusFirstFocusNode(c):c.target!==this.lastContent||c.shiftKey||
c.keyCode!==m.TAB||(c.preventDefault(),this.firstTitleNode.focus()):c.keyCode===m.ESCAPE&&(c.stopPropagation(),l.containerNode.focus())})))}};r._onOpenAndFocus=function(){this.config.openAtStart&&!this._isFirstOpenAtStart?this._isFirstOpenAtStart=!0:this.isGroupPanel&&this.firstTitleNode&&this.firstTitleNode.focus()};return r})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(E,q,A,w,m){return E([w,
m],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(A(window,"resize",q.hitch(this,this._onWindowResize)))},getConfig:function(){},getDataSources:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define("require dojo/_base/lang dojo/_base/html dojox/gfx esri/symbols/jsonUtils esri/symbols/PictureMarkerSymbol".split(" "),function(E,q,A,w,m,v){return{cloneSymbol:function(r){if(!r)return null;var l=null;try{var k=r.toJson();
l=m.fromJson(k)}catch(n){console.error(n)}return l},getDefaultMarkerSymbol:function(){return m.fromJson({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return m.fromJson({tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return m.fromJson({tags:["opaque"],title:"Blue",style:"esriSFSSolid",color:[79,
129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return m.fromJson({color:[255,255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return m.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return m.fromJson({color:[255,
255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},getGreyPinMarkerSymbol:function(){var r=E.toUrl("jimu/css/images/grey_pin.png");r=new v(r,16,16);r.setOffset(0,8);return r},createSymbolNode:function(r,l){var k=32,n=32,d=A.create("div",{},document.body);A.setStyle(d,"display","inline-block");if(l)k=l.width,n=l.height;else if(k=80,n=30,this.isSimpleMarkerSymbol(r))n=k=Math.min(r.size+12,125);else if(this.isPictureMarkerSymbol(r)){if(!r.url||
"http://"===r.url||-1===r.url.indexOf("http://")&&-1===r.url.indexOf("https://")&&-1===r.url.indexOf("data:"))return;n=k=Math.min(Math.max(r.width,r.height),125)}else if(this.isSimpleLineSymbol(r)||this.isCartographicLineSymbol(r))k=190,n=20;var c=w.createSurface(d,k,n);if("vml"===w.renderer){var g=c.getEventSource();A.setStyle(g,"position","relative");A.setStyle(g.parentNode,"position","relative")}g=null;g=l?m.getShapeDescriptors(r):this.isSimpleLineSymbol(r)||this.isCartographicLineSymbol(r)?this._getLineShapeDesc(r):
m.getShapeDescriptors(r);try{var b=c.createShape(g.defaultShape);g.fill&&b.setFill(g.fill);g.stroke&&b.setStroke(g.stroke)}catch(e){c.clear();c.destroy();return}r=c.getDimensions();r={dx:r.width/2,dy:r.height/2};c=b.getBoundingBox();l=c.width;c=c.height;if(l>k||c>n)k=((k<n?k:n)-5)/(l>c?l:c),q.mixin(r,{xx:k,yy:k});b.applyTransform(r);d&&A.addClass(d,"symbol");return d},_getLineShapeDesc:function(r){var l=null;if(this.isSimpleLineSymbol(r)||this.isCartographicLineSymbol(r))l={defaultShape:{type:"path",
path:"M -90,0 L 90,0 E"},fill:null,stroke:r.getStroke()};return l},isSimpleMarkerSymbol:function(r){return r&&"esri.symbol.SimpleMarkerSymbol"===r.declaredClass},isPictureMarkerSymbol:function(r){return r&&"esri.symbol.PictureMarkerSymbol"===r.declaredClass},isSimpleLineSymbol:function(r){return r&&"esri.symbol.SimpleLineSymbol"===r.declaredClass},isCartographicLineSymbol:function(r){return r&&"esri.symbol.CartographicLineSymbol"===r.declaredClass},isSimpleFillSymbol:function(r){return r&&"esri.symbol.SimpleFillSymbol"===
r.declaredClass},isPictureFillSymbol:function(r){return r&&"esri.symbol.PictureFillSymbol"===r.declaredClass},isTextSymbol:function(r){return r&&"esri.symbol.TextSymbol"===r.declaredClass}}})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(E,q,A){return E(null,{constructor:function(){this.panelManager=A.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups=
"all")},getOpenedIds:function(){},setOpenedIds:function(w){},getConfigById:function(w){for(var m=this.getAllConfigs(),v=0;v<m.length;v++)if(m[v].id===w)return m[v]},getAllConfigs:function(){var w=[];w=w.concat(this.getWidgetConfigs(),this.getGroupConfigs());w=q.filter(w,function(m){return m.visible});return w.sort(function(m,v){return m.index-v.index})},getAllConfigsIncludeInvisible:function(){var w=[];w=w.concat(this.getWidgetConfigs(),this.getGroupConfigs());return w.sort(function(m,v){return m.index-
v.index})},isControlled:function(w){return q.some(this.getAllConfigsIncludeInvisible(),function(m){return m.id===w})},widgetIsControlled:function(w){return q.some(this.getAllConfigsIncludeInvisible(),function(m){return m.id===w?!0:q.some(m.widgets,function(v){return v.id===w})})},getGroupConfigs:function(){var w=[];if(!this.appConfig.widgetPool)return w;this.appConfig.widgetPool.groups&&q.forEach(this.appConfig.widgetPool.groups,function(m){this.controlledGroups&&(Array.isArray(this.controlledGroups)?
-1<this.controlledGroups.indexOf(m.id)&&w.push(m):"all"===this.controlledGroups&&w.push(m))},this);return w},getWidgetConfigs:function(){var w=[];if(!this.appConfig.widgetPool)return w;this.appConfig.widgetPool.widgets&&q.forEach(this.appConfig.widgetPool.widgets,function(m){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(m.id)&&w.push(m):"all"===this.controlledWidgets&&w.push(m))},this);return w}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),
function(E,q,A,w,m,v,r,l){var k=null,n=null,d=!1;E=E(null,function(){});var c=require.toUrl("jimu"),g=v(c+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),b=v(c+"/SpatialReference/transform.json",{handleAs:"json"});E.loadResource=function(){var e=new w;if(k&&n)return e.resolve(),e;m([g,b]).then(function(a){k=a[0];n=a[1];d=!0;e.resolve()},function(a){console.error(a);d=!1;e.reject(a)});return e};E.getAllCSUnits=function(){if(d){var e=[];A.forEach(k.wkids,q.hitch(this,function(a){a=this.getCSUnit(a);
-1===A.indexOf(e,a)&&e.push(a)}));return e}};E.convertUnit=function(e,a,f){if(d)return l.convertUnit(e,a,f)};E.getUnitRate=function(e,a){if(d)return l.getUnitRate(e,a)};E.isProjectUnit=function(e){if(d)return l.isProjectUnit(e)};E.isGeographicUnit=function(e){if(d)return l.isGeographicUnit(e)};E.getGeographicUnits=function(){if(d)return l.getGeographicUnits()};E.getProjectUnits=function(){if(d)return l.getProjectUnits()};E.getCSUnit=function(e){if(d){e=this.getCSStr(e);var a=0,f=0;a=e.lastIndexOf("UNIT");
f=e.indexOf(",",a);return e.slice(a+6,f-1)}};E.isSameSR=function(e,a){if(d)return e=this.indexOfWkid(e),a=this.indexOfWkid(a),k.labels[e]===k.labels[a]};E.isValidWkid=function(e){if(d)return-1<this.indexOfWkid(e)};E.getSRLabel=function(e){if(d&&this.isValidWkid(e))return e=this.indexOfWkid(e),k.labels[e]};E.indexOfWkid=function(e){if(d)return A.indexOf(k.wkids,e)};E.isWebMercator=function(e){return r.prototype._isWebMercator?r.prototype._isWebMercator.apply({wkid:parseInt(e,10)},[]):(new r(parseInt(e,
10))).isWebMercator()};E.standardizeWkid=function(e){return this.isWebMercator(e)?3857:parseInt(e,10)};E.isValidTfWkid=function(e){if(d)return-1<this.indexOfTfWkid(e)};E.getTransformationLabel=function(e){if(d)return this.isValidTfWkid(e)?(e=this.indexOfTfWkid(e),n.labels[e]):""};E.indexOfTfWkid=function(e){if(d)return A.indexOf(n.tfWkids,e)};E.isGeographicCS=function(e){if(d)return this.isValidWkid(e)?k.details[this.indexOfWkid(e)].startWith("GEOGCS"):!1};E.isProjectedCS=function(e){if(d)return this.isValidWkid(e)?
k.details[this.indexOfWkid(e)].startWith("PROJCS"):!1};E.getGeoCSByProj=function(e){if(d&&this.isProjectedCS(e))return e=this.getSpheroidStr(e),e=A.indexOf(k.details,e),k.wkids[e]};E.getSpheroidStr=function(e){if(d){if(this.isGeographicCS(e))return k.details[this.indexOfWkid(e)];if(this.isProjectedCS(e)){e=k.details[this.indexOfWkid(e)];var a=e.indexOf("GEOGCS"),f=e.indexOf("PROJECTION")-1;return e.slice(a,f)}return null}};E.getCSStr=function(e){if(d)return k.details[this.indexOfWkid(e)]};E.isSameSpheroid=
function(e,a){if(d)return e=this.getSpheroidStr(e),a=this.getSpheroidStr(a),e&&a&&e===a?!0:!1};return E})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(E,q){var A="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
w="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),m={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,
YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};E=E(null,function(){});E.convertUnit=function(v,r,l){return m[v.toUpperCase()]/m[r.toUpperCase()]*l};E.getUnitRate=function(v,r){return m[v.toUpperCase()]/m[r.toUpperCase()]};E.isProjectUnit=function(v){return-1<q.indexOf(A,v.toUpperCase())};E.isGeographicUnit=function(v){return-1<
q.indexOf(w,v.toUpperCase())};E.getGeographicUnits=function(){return w};E.getProjectUnits=function(){return A};return E})},"jimu/dijit-all":function(){define([],1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),function(E,q,A,w,m,v,r,l){return E(q,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,constructor:function(){},postCreate:function(){r.create("div",
{"class":"jimu-radio-inner"},this.domNode);this.checked&&v.add(this.domNode,"jimu-radio-checked");this.own(m(this.domNode,"click",A.hitch(this,function(){this.checked||this.check()})))},check:function(k){void 0===k&&(k=!0);this.checked=!0;v.add(this.domNode,"jimu-radio-checked");k&&this._changeOthersState(!1);this.onStateChange()},uncheck:function(k){void 0===k&&(k=!0);this.checked=!1;v.remove(this.domNode,"jimu-radio-checked");k&&this._changeOthersState(!1);this.onStateChange()},_changeOthersState:function(k){null!==
this.group&&w.forEach(l.toArray(),function(n){n.id!==this.id&&n["class"]===this["class"]&&n.group===this.group&&(k?n.check(!1):n.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/dom-class dojo/Evented ./a11y/CheckBox".split(" "),function(E,q,A,w,m,v,r){E=E([q,v],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",checked:!1,disabled:!1,status:!0,label:"",title:"",postCreate:function(){this.checkNode=
w.create("div",{"class":"checkbox jimu-float-leading jimu-icon jimu-icon-checkbox"},this.domNode);this.labelNode=w.create("div",{"class":"label jimu-float-leading",innerHTML:this.label||""},this.domNode);this.checked&&(w.addClass(this.checkNode,"checked"),w.addClass(this.checkNode,"jimu-icon-checked"));this.status=this._getStatusByDisabled(this.disabled);this.status||(w.addClass(this.domNode,"jimu-state-disabled"),w.addClass(this.checkNode,"jimu-state-disabled"));this.a11y_setDisabled(!this.status);
this.own(this.watch("disabled",A.hitch(this,function(){this.setStatus(this._getStatusByDisabled(this.disabled))})));this._udpateLabelClass();this.a11y_init()},setLabel:function(l){this.label=l;this.labelNode.innerHTML=this.label;this.labelNode.title=this.label;this.a11y_updateAriaLabel(l);this._udpateLabelClass()},_udpateLabelClass:function(){this.labelNode&&(this.labelNode.innerHTML?w.removeClass(this.labelNode,"not-visible"):w.addClass(this.labelNode,"not-visible"))},setValue:function(l){this.status&&
(!0===l?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(l){l=!!l;var k=this.status!==l;(this.status=l)?(m.remove(this.domNode,"jimu-state-disabled"),w.removeClass(this.checkNode,"jimu-state-disabled")):(m.add(this.domNode,"jimu-state-disabled"),w.addClass(this.checkNode,"jimu-state-disabled"));this.a11y_setDisabled(!this.status);k&&this.emit("status-change",l)},getStatus:function(){return this.status},check:function(l){if(this.status&&(this.checked=!0,this.a11y_changeAriaCheckedAttr(),
w.addClass(this.checkNode,"checked jimu-icon-checked"),w.removeClass(this.checkNode,"checked jimu-icon-checkbox"),!l))this.onStateChange()},uncheck:function(l){if(this.status&&(this.checked=!1,this.a11y_changeAriaCheckedAttr(),w.removeClass(this.checkNode,"checked"),w.removeClass(this.checkNode,"jimu-icon-checked"),w.addClass(this.checkNode,"jimu-icon-checkbox"),!l))this.onStateChange()},onStateChange:function(){if(this.onChange&&A.isFunction(this.onChange))this.onChange(this.checked);this.emit("change",
this.checked)},focus:function(){this.checkNode&&this.checkNode.focus&&this.checkNode.focus()},_getStatusByDisabled:function(l){return!0===l||"true"===l||"disabled"===l?!1:!0}});E.extend(r);return E})},"jimu/dijit/a11y/CheckBox":function(){define(["dojo/_base/lang","dojo/on","dojo/_base/html","dijit/a11yclick"],function(E,q,A,w){return{a11y_init:function(){A.setAttr(this.domNode,"tabindex","0");A.setAttr(this.domNode,"role","checkbox");this.setLabel(this.label);this.a11y_changeAriaCheckedAttr();this.own(q(this.domNode,
"focus",E.hitch(this,function(){A.addClass(this.checkNode,"dijitCheckBoxFocused")})));this.own(q(this.domNode,"blur",E.hitch(this,function(){A.removeClass(this.checkNode,"dijitCheckBoxFocused")})));this.own(q(this.domNode,w,E.hitch(this,function(){this.status&&(this.checked?this.uncheck():this.check())})))},a11y_changeAriaCheckedAttr:function(){A.setAttr(this.domNode,"aria-checked",this.checked?"true":"false")},a11y_setDisabled:function(m){m=m.toString();"false"===m?A.removeAttr(this.domNode,"disabled"):
A.setAttr(this.domNode,"disabled",m);A.setAttr(this.domNode,"aria-disabled",m)},a11y_updateAriaLabel:function(m){""===this.label?(A.setAttr(this.domNode,"title",this.title),A.setAttr(this.domNode,"aria-label",this.title)):A.setAttr(this.domNode,"aria-label",this.title?this.title:m)}}})},"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase jimu/dijit/BindLabelPropsMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr dojo/Deferred dojox/gfx dojo/promise/all jimu/utils jimu/symbolUtils jimu/portalUrlUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font esri/arcgis/Portal esri/request jimu/dijit/ImageChooser jimu/dijit/ColorPicker jimu/dijit/_Transparency jimu/dijit/LoadingIndicator jimu/dijit/formSelect dijit/form/NumberSpinner".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u,t,z,x,y,D,H,I,N,S){return E([q,A,w,m,r],{templateString:v,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,_customPictureMarkerSymbol:null,isArrow:!1,symbol:null,type:null,DEFAULT_PORTAL_URL:"//arcgis.com/",_portalLoadTimeoutInMs:3E3,_isOnline:!0,_localTypes:"basic A-Z arrows business cartographic nationalParkService outdoorRecreation peoplePlaces safetyHealth shapes transportation damage disasters emergencyManagement generalInfrastructure localGovernment numbers pointsOfInterest stateGovernment FireFly".split(" "),
cropImage:!1,postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser;this._setTemplateNls()},postCreate:function(){this.inherited(arguments);this._initImageChooser();this.own(d(document.body,"click",l.hitch(this,this._onBodyClicked)));(this._isIE8=8===c("ie"))&&k.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(M){this.reset();var Q=
M&&M.declaredClass;Q&&"string"===typeof Q&&0<=Q.indexOf("esri.symbol")&&(this.symbol=this._cloneSymbol(M),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(M){this.reset();
if("marker"===M||"line"===M||"fill"===M||"text"===M)this.type=M,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===this.type&&this._initTextSection()},getSymbol:function(){return this._getSymbol(!1)},getValidSymbol:function(){return this._getSymbol(!0)},_getSymbol:function(M){var Q=null;"marker"===this.type?Q=this._getPointSymbolBySetting(M):"line"===this.type?Q=this._getLineSymbolBySetting(M):"fill"===this.type?
Q=this._getFillSymbolBySetting(M):"text"===this.type&&(Q=this._getTextSymbolBySetting(M));M=null;Q&&(M=this._cloneSymbol(Q));return M},hideColorPicker:function(){for(var M="pointColor pointOutlineColor lineColor fillColor fillOutlineColor textColor".split(" "),Q=0,da=M.length;Q<da;Q++){var J=M[Q];this[J]&&this[J].hideTooltipDialog()}},_onBodyClicked:function(M){M=M.target||M.srcElement;this._tryHideDropDownOfSelectDijit(M,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(M,this.lineStylesSelect)},
_tryHideDropDownOfSelectDijit:function(M,Q){var da=Q.domNode,J=Q.dropDown.domNode;da=M===da||k.isDescendant(M,da);M=M===J||k.isDescendant(M,J);if(!da&&!M)Q.dropDown.onCancel()},_onChange:function(M){M=this._cloneSymbol(M);this.emit("change",M)},_hideAllSections:function(){g(".symbol-section",this.domNode).style("display","none")},_showSection:function(M){this._hideAllSections();g("."+M+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(M,Q,da){return h.getAncestorDom(M,
Q,da)},_getAbsoluteUrl:function(M){return window.location.protocol+"//"+window.location.host+require.toUrl(M)},_cloneSymbol:function(M){if(!M)return null;var Q=M;try{var da=M.toJson();Q=u.fromJson(da);"fill"===this.type&&(Q.arrowWidth=M.arrowWidth)}catch(J){console.error(J)}return Q},_createSymbolIconTable:function(M,Q,da){var J=this.type+"-icon-table";M=k.toDom('\x3ctable class\x3d"icon-table '+(J+" "+(J+"-"+M))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');J=g("tbody",M)[0];for(var R=Math.ceil(Q.length/
8),W=0;W<R;W++)k.create("tr",{},J);var X=g("tr",M);n.forEach(Q,l.hitch(this,function(ia,ma){var ha=l.clone(ia),xa=u.fromJson(ia);ma=k.create("td",{},X[Math.floor(ma/8)]);k.addClass(ma,"symbol-td-item");xa=this._createSymbolNode(xa);k.addClass(xa,"symbol-div-item");var ua=xa.firstChild;k.addClass(ua,"svg-node");if(this._isIE8&&"point"===da)if(window.isRTL){if("Cross"===ia.name||"X"===ia.name)k.setStyle(ua,"right","-20px"),k.setStyle(xa,"marginTop","20px")}else"Cross"!==ia.name&&"X"!==ia.name||k.setStyle(xa,
"marginTop","20px");xa.symbol=ha;k.place(xa,ma)}));return M},_updatePreview:function(M){var Q=this._cloneSymbol(this.symbol);k.empty(M);(Q=p.createSymbolNode(Q))||(Q=k.create("div"));k.place(Q,M)},_createSymbolNode:function(M){(M=p.createSymbolNode(M,{width:36,height:36}))||(M=k.create("div"));k.setStyle(M,{width:"36px",height:"36px"});return M},_getLineShapeDesc:function(M){var Q=null;if(this.isSimpleLineSymbol(M)||this.isCartographicLineSymbol(M))Q={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},
fill:null,stroke:M.getStroke()};return Q},_initPointSection:function(){this._showSection("point");this._pointEventsBinded||(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showBuildInPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new t({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());
this._initPointSettings(this.symbol);this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(d(this.pointIconTables,".symbol-div-item:click",l.hitch(this,this._onPointSymIconItemClick)));this.own(d(this.pointSymClassSelect,"change",l.hitch(this,this._onPointSymClassSelectChange)));this.own(d(this.pointSize,"change",l.hitch(this,this._onPointSymbolChange,!1)));this.own(d(this.pointColor,"change",l.hitch(this,this._onPointSymbolChange,!1)));this.own(d(this.pointAlpha,"change",l.hitch(this,
this._onPointSymbolChange,!1)));this.own(d(this.pointOutlineColor,"change",l.hitch(this,this._onPointSymbolChange,!1)));this.own(d(this.pointOutlineWidth,"change",l.hitch(this,this._onPointSymbolChange,!1)))},_onPointSymbolChange:function(M){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(M),this._onChange(this.symbol))},_initPointSettings:function(M){if(M){this._invokeSymbolChangeEvent=!1;if(this.isSimpleMarkerSymbol(M)){if(this.pointSize.set("value",M.size),this.pointColor.setColor(M.color),
this.pointAlpha.setAlpha(parseFloat(M.color.a.toFixed(2))),M=M.outline)this.pointOutlineColor.setColor(M.color),this.pointOutlineWidth.set("value",parseFloat(M.width.toFixed(0)))}else this.isPictureMarkerSymbol(M)&&this.pointSize.set("value",M.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(M){return M&&"esri.symbol.SimpleMarkerSymbol"===M.declaredClass},isPictureMarkerSymbol:function(M){return M&&"esri.symbol.PictureMarkerSymbol"===M.declaredClass},_isCustomImageOptionSelected:function(){return"custom"===
this.pointSymClassSelect.get("value")},_onPointSymClassSelectChange:function(){if(this._isCustomImageOptionSelected())this._showCustomPictureMarkerSymSettings(),this._customPictureMarkerSymbol&&(this.symbol=this._customPictureMarkerSymbol,this._onPointSymbolChange());else{this._showSimpleMarkerSymSettings();this._showSelectedPointSymIconTable();var M=this.pointSymClassSelect.get("value");this.pointSymClassSelect["def"+M]?(M=this.pointSymClassSelect.getOptions(M),this.pointSymClassSelect.domNode.title=
M?M.label:""):this._requestPointSymJson(M)}},_hideAllPointSymIconTable:function(){g(".marker-icon-table",this.pointIconTables).style("display","none")},_showSelectedPointSymIconTable:function(){this._hideAllPointSymIconTable();var M=this.pointSymClassSelect.get("value");M=g(".marker-icon-table-"+M,this.pointIconTables);0<M.length&&M.style("display","table")},_getLocalSymbols:function(M){M=M||this.pointSymClassSelect.get("value");M=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+M+".json");return b(M,
{handleAs:"json"})},_getPortalSymbolsByType:function(M){var Q=new e;M?this._fetchSymbols(M).then(l.hitch(this,function(da){Q.resolve(da)}),l.hitch(this,function(da){Q.reject(da)})):Q.reject(null);return Q},_requestPointSymJson:function(M){this.pointSymClassSelect["def"+M]||(this.loadingShelter.show(),!this._isOnline&&window.isXT?this._offLineGetSymbols(M):this._symbolTypes?this._handleGetPointSymbols(l.hitch(this,this._getPortalSymbolsByType),M):this._initPortal().then(l.hitch(this,this._fetchSymbolTypes)).then(l.hitch(this,
function(Q){this.domNode&&(this._clearOptions(),this._createOptions(Q),this._handleGetPointSymbols(l.hitch(this,this._getPortalSymbolsByType),M))}),l.hitch(this,function(Q){this.domNode&&(window.isXT?this._offLineGetSymbols(M):(this.loadingShelter.hide(),console.error("Fetching symbols failed",Q)))})))},_offLineGetSymbols:function(M){this._isOnline=!1;if(0===this.pointSymClassSelect.options.length){var Q=[];n.forEach(this._localTypes,l.hitch(this,function(da,J){Q.push({id:J,title:this.nls[da]||da})}));
this._clearOptions();this._createOptions(Q)}this._handleGetPointSymbols(l.hitch(this,this._getLocalSymbols),M)},_clearOptions:function(){this.pointSymClassSelect&&this.pointSymClassSelect.removeOption(this.pointSymClassSelect.options)},_createOptions:function(M){if(this.pointSymClassSelect){var Q=[],da="",J=!1;"[object Array]"===Object.prototype.toString.call(M)&&0<M.length&&n.forEach(M,l.hitch(this,function(R){da=R.title||R.name;J=R.defaultType?!0:!1;da&&(R.id||0===R.id)&&Q.push({label:da,value:R.id,
selected:J})}));Q.push({label:this.nls.customImage,value:"custom"});this.pointSymClassSelect.addOption(Q)}},_initPortal:function(){var M=new e;if(this._portal)M.resolve();else{var Q=B.getStandardPortalUrl(window.portalUrl),da=new I.Portal(Q?Q:this.DEFAULT_PORTAL_URL);if(da.loaded)return this._portal=da,M.resolve(),M.promise;this.own(da.on("load",l.hitch(this,function(){this._portal=da;M.resolve()})));setTimeout(function(){M.reject()},this._portalLoadTimeoutInMs)}return M},_handleGetPointSymbols:function(M,
Q){if(this.pointSymClassSelect){var da=Q||this.pointSymClassSelect.get("value");Q="def"+da;M=M(da);this.pointSymClassSelect[Q]=M;M.then(l.hitch(this,function(J){this.domNode&&(this.loadingShelter.hide(),this._getPointSymbolsSucess(da,J))}),l.hitch(this,function(J){this.domNode&&(this.loadingShelter.hide(),console.error("Fetching symbols failed",J))}))}},_getPointSymbolsSucess:function(M,Q){if(this.domNode){var da=this.pointSymClassSelect.getOptions(M);this.pointSymClassSelect.domNode.title=da?da.label:
"";M=this._createSymbolIconTable(M,Q,"point");k.place(M,this.pointIconTables);this._showSelectedPointSymIconTable()}},_fetchSymbols:function(M){var Q=[],da=new e;Q=this._symbolTypes.filter(function(J){return J.id===M});this._getSymbolListData(Q).then(l.hitch(this,function(J){da.resolve(J)}),l.hitch(this,function(J){console.warn("fetch symbols failed",J);da.reject(J)}));return da},_getSymbolListData:function(M){M=n.filter(M,function(Q){return Q.dataUrl});M=n.map(M,function(Q){return N({url:Q.dataUrl}).promise});
return f(M).then(function(Q){return Q[0]})},_fetchSymbolTypes:function(){var M=new e;this._symbolTypes?M.resolve(this._symbolTypes):this._getSymbolListGroupId().then(l.hitch(this,this._getSymbolListItems)).then(l.hitch(this,function(Q){this._symbolTypes=Q;M.resolve(Q)}),l.hitch(this,function(Q){console.warn("fetch symbol types failed",Q);M.reject(Q)}));return M},_getSymbolListGroupId:function(){var M=new e;this._portal||M.reject("no portal");this._portal.queryGroups({q:this._portal.symbolSetsGroupQuery}).then(function(Q){M.resolve(Q.results[0].id)},
l.hitch(this,function(Q){console.warn("get symbol list group id failed",Q);M.reject(Q)}));return M},_getSymbolListItems:function(M){var Q=new e,da=this._portal;M="group:"+M+' AND type:"Symbol Set"';var J=[];this._portal||Q.reject("no portal");M="vml"===a.renderer?M+' AND -typekeywords:"by value"':M+' AND (typekeywords:"by value" AND typekeywords:"marker")';da.queryItems({q:M,num:50,sortField:"title"}).then(l.hitch(this,function(R){var W,X,ia,ma;n.forEach(R.results,function(ha){W=ha.typeKeywords.join(" ");
-1<W.indexOf("marker")&&(X=ha.title,ia={name:X,id:ha.id,title:ha.title,keywords:W,dataUrl:ha.itemDataUrl},(ma="Basic"===ha.name)?(ia.defaultType=!0,J.unshift(ia)):J.push(ia))},this);0<J.length?Q.resolve(J):Q.reject()}),function(){Q.reject()});return Q},_onPointSymIconItemClick:function(M){if(M=this._getAncestor(M.target||M.srcElement,function(da){return k.hasClass(da,"symbol-div-item")},5))if(g(".selected-symbol-div-item",M.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),
k.addClass(M,"selected-symbol-div-item"),M=M.symbol){this.symbol=u.fromJson(M);M=k.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?this._showSimpleMarkerSymSettings():this._showBuildInPictureMarkerSymSettings();this._onPointSymbolChange(!0);var Q=k.getStyle(this.pointColorTr,"display");M!==Q&&this.emit("resize")}},_showSimpleMarkerSymSettings:function(){k.addClass(this.pointCustomImageTr,"hidden");k.removeClass(this.pointIconTablesTr,"hidden");k.removeClass(this.pointColorTr,
"hidden");k.removeClass(this.pointOpacityTr,"hidden");k.removeClass(this.pointOutlineColorTr,"hidden");k.removeClass(this.pointOulineWidthTr,"hidden")},_showBuildInPictureMarkerSymSettings:function(){k.addClass(this.pointCustomImageTr,"hidden");k.removeClass(this.pointIconTablesTr,"hidden");k.addClass(this.pointColorTr,"hidden");k.addClass(this.pointOpacityTr,"hidden");k.addClass(this.pointOutlineColorTr,"hidden");k.addClass(this.pointOulineWidthTr,"hidden")},_showCustomPictureMarkerSymSettings:function(){k.removeClass(this.pointCustomImageTr,
"hidden");k.addClass(this.pointIconTablesTr,"hidden");k.addClass(this.pointColorTr,"hidden");k.addClass(this.pointOpacityTr,"hidden");k.addClass(this.pointOutlineColorTr,"hidden");k.addClass(this.pointOulineWidthTr,"hidden")},_getPointSymbolBySetting:function(M){if(!this.symbol||M&&!this.pointSize.validate())return null;var Q=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){if(M&&!this.pointOutlineWidth.validate())return null;this.symbol.setSize(Q);M=this.pointColor.getColor();
Q=this.pointAlpha.getAlpha();M.a=Q;this.symbol.setColor(M);M=this.pointOutlineColor.getColor();Q=(Q=parseFloat(this.pointOutlineWidth.get("value")))?Q:0;var da=new x;da.setStyle(x.STYLE_SOLID);da.setColor(M);da.setWidth(Q);this.symbol.setOutline(da)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(Q),this.symbol.setHeight(Q));this._updatePreview(this.pointSymPreview);return this.symbol},_initImageChooser:function(){this.imageChooser=new S({cropImage:this.cropImage,customZIndex:this.customZIndex,
showSelfImg:!1,goldenWidth:16,goldenHeight:16,format:["image/gif","image/png","image/jpeg"],label:this.nls.chooseFile});k.addClass(this.imageChooser.domNode,"custom-image-chooser");this.own(d(this.imageChooser,"change",l.hitch(this,this._onImageChange)));this.imageChooser.placeAt(this.customImageTd,"first")},_onImageChange:function(M,Q){this.imageNameNode.innerHTML=Q.fileName;M=M.replace(/^data:image\/.*;base64,/,"");Q=parseFloat(this.pointSize.get("value"));this._customPictureMarkerSymbol=this.symbol=
new z({type:"esriPMS",url:null,imageData:M,contentType:"image/png",color:null,width:Q,height:Q,angle:0,xoffset:0,yoffset:0});this._onPointSymbolChange()},_initLineSection:function(){this._showSection("line");this._lineEventBinded||(this._lineEventBinded=!0,this._bindLineEvents(),this._requestLineSymJson("line"));this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},_bindLineEvents:function(){this.own(d(this.lineIconTables,".symbol-div-item:click",l.hitch(this,this._onLineSymIconItemClick)));
this.own(d(this.lineColor,"change",l.hitch(this,this._onLineSymbolChange)));this.own(d(this.lineStylesSelect,"change",l.hitch(this,this._onLineSymbolChange)));this.own(d(this.lineAlpha,"change",l.hitch(this,this._onLineSymbolChange)));this.own(d(this.lineWidth,"change",l.hitch(this,this._onLineSymbolChange)))},_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(M){M&&(this._invokeSymbolChangeEvent=!1,
this.lineColor.setColor(M.color),this.lineAlpha.setAlpha(parseFloat(M.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(M.width.toFixed(0))),this.lineStylesSelect.set("value",M.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(M){return M&&"esri.symbol.SimpleLineSymbol"===M.declaredClass},isCartographicLineSymbol:function(M){return M&&"esri.symbol.CartographicLineSymbol"===M.declaredClass},_requestLineSymJson:function(M){var Q=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+
M+".json");b(Q,{handleAs:"json"}).then(l.hitch(this,function(da){this.domNode&&(da=this._createSymbolIconTable(M,da,"line"),k.place(da,this.lineIconTables))}),l.hitch(this,function(da){console.error("get line symbol failed",da)}))},_onLineSymIconItemClick:function(M){if(M=this._getAncestor(M.target||M.srcElement,function(Q){return k.hasClass(Q,"symbol-div-item")},5))if(g(".selected-symbol-div-item",M.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),k.addClass(M,"selected-symbol-div-item"),
M=M.symbol)M=u.fromJson(M),this._initLineSettings(M),this._onLineSymbolChange()},_getLineSymbolBySetting:function(M){if(M&&!this.lineWidth.validate())return null;this.symbol=new x;M=this.lineColor.getColor();var Q=this.lineStylesSelect.get("value");M.a=this.lineAlpha.getAlpha();var da=parseFloat(this.lineWidth.get("value"));this.symbol.setStyle(Q);this.symbol.setColor(M);this.symbol.setWidth(da);this._updatePreview(this.lineSymPreview);return this.symbol},setFillSectionType:function(M){M?k.addClass(this.fillSection,
"arrow-symbol-section"):(k.removeClass(this.fillSection,"arrow-symbol-section"),this.isArrow&&!this.arrowWidth.validate()&&this.arrowWidth.set("value",12));this.isArrow=M},_initFillSection:function(){this.setFillSectionType(this.isArrow);this._showSection("fill");this._fillEventBinded||(this._fillEventBinded=!0,this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(d(this.fillIconTables,".symbol-div-item:click",
l.hitch(this,this._onFillSymIconItemClick)));this.own(d(this.fillColor,"change",l.hitch(this,this._onFillSymbolChange,!1)));this.own(d(this.fillAlpha,"change",l.hitch(this,this._onFillSymbolChange,!1)));this.own(d(this.fillOutlineColor,"change",l.hitch(this,this._onFillSymbolChange,!1)));this.own(d(this.fillOutlineWidth,"change",l.hitch(this,this._onFillSymbolChange,!1)));this.own(d(this.arrowWidth,"change",l.hitch(this,this._onFillSymbolChange,!1)))},_onFillSymbolChange:function(M){this._invokeSymbolChangeEvent&&
(this._getFillSymbolBySetting(M),this._onChange(this.symbol))},_initFillSettings:function(M){M&&(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(M.color),this.fillAlpha.setAlpha(parseFloat(M.color.a.toFixed(2))),M.outline&&(this.fillOutlineColor.setColor(M.outline.color),this.fillOutlineWidth.set("value",parseInt(M.outline.width,10))),this._invokeSymbolChangeEvent=!0,this.arrowWidth.set("value",parseInt(M.arrowWidth,10)))},_isSimpleFillSymbol:function(M){return M&&"esri.symbol.SimpleFillSymbol"===
M.declaredClass},_requestFillSymJson:function(M){var Q=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+M+".json");b(Q,{handleAs:"json"}).then(l.hitch(this,function(da){this.domNode&&(da=this._createSymbolIconTable(M,da,"fill"),k.place(da,this.fillIconTables))}),l.hitch(this,function(da){console.error("get fill symbol failed",da)}))},_onFillSymIconItemClick:function(M){if(M=this._getAncestor(M.target||M.srcElement,function(Q){return k.hasClass(Q,"symbol-div-item")},5))if(g(".selected-symbol-div-item",
M.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),k.addClass(M,"selected-symbol-div-item"),M=M.symbol)M=u.fromJson(M),M.arrowWidth=this.symbol.arrowWidth,this._initFillSettings(M),this._onFillSymbolChange()},_getFillSymbolBySetting:function(M){if(M&&(!this.fillOutlineWidth.validate()||this.isArrow&&!this.arrowWidth.validate()))return null;this.symbol=new y;var Q=this.fillColor.getColor();Q.a=this.fillAlpha.getAlpha();M=this.fillOutlineColor.getColor();var da=parseInt(this.fillOutlineWidth.get("value"),
10);da=da?da:0;this.symbol.setColor(Q);this.symbol.setStyle(y.STYLE_SOLID);Q=new x;Q.setStyle(x.STYLE_SOLID);Q.setColor(M);Q.setWidth(da);this.symbol.setOutline(Q);M=parseInt(this.arrowWidth.get("value"),10);this.symbol.arrowWidth=M;this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||(this._textEventBinded=!0,this._bindTextEvents());this._initTextSettings();this._getTextSymbolBySetting()},_bindTextEvents:function(){this.own(d(this.inputText,
"change",l.hitch(this,this._onTextSymbolChange)));this.own(d(this.textColor,"change",l.hitch(this,this._onTextSymbolChange)));this.own(d(this.textFontSize,"change",l.hitch(this,this._onTextSymbolChange)))},_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(M){M&&(this._invokeSymbolChangeEvent=!1,this.inputText.value=M.text,this.textColor.setColor(M.color),M=parseInt(M.font.size,10),this.textFontSize.set("value",
M),this._invokeSymbolChangeEvent=!0)},_isTextSymbol:function(M){return M&&"esri.symbol.TextSymbol"===M.declaredClass},_updateTextPreview:function(M,Q){var da=this.textColor.getColor().toHex(),J=parseInt(this.textFontSize.get("value"),10)+"px";k.setStyle(this.textPreview,{color:da,fontSize:J,fontFamily:Q});this.textPreview.innerHTML=M},_getTextSymbolBySetting:function(M){var Q=h.sanitizeHTML(this.inputText.value);if(M&&(""===Q.replace(/^\s+|\s+$/g,"")||!this.textFontSize.validate()))return null;this.symbol=
new D;M=this.textColor.getColor();var da=parseInt(this.textFontSize.get("value"),10),J=new H;J.setSize(da);this.symbol.setText(Q);this.symbol.setColor(M);this.symbol.setFont(J);this._updateTextPreview(Q,J.family);return this.symbol},_setTemplateNls:function(){"undefined"===typeof this.nls.damage&&(this.nls.damage="Damage");"undefined"===typeof this.nls.disasters&&(this.nls.disasters="Disasters");"undefined"===typeof this.nls.emergencyManagement&&(this.nls.emergencyManagement="Emergency Management");
"undefined"===typeof this.nls.generalInfrastructure&&(this.nls.generalInfrastructure="General Infrastructure");"undefined"===typeof this.nls.localGovernment&&(this.nls.localGovernment="Local Government");"undefined"===typeof this.nls.numbers&&(this.nls.numbers="Numbers");"undefined"===typeof this.nls.pointsOfInterest&&(this.nls.pointsOfInterest="Points of Interest");"undefined"===typeof this.nls.stateGovernment&&(this.nls.stateGovernment="State Government")}})})},"esri/arcgis/Portal":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/_base/array dojo/_base/sniff require ../config ../kernel ../lang ../request ../urlUtils ../Evented ../IdentityManager".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g){var b={options:{disableIdentityLookup:!0},requestParams:{f:"json"}},e=function(y){function D(H){y[H]||(y[H]=function(){var I=arguments;return w.when(y,function(N){Array.prototype.unshift.call(I,N.results||N);return e(m[H].apply(m,I))})})}if(!y)return y;y.then&&(y=q.delegate(y));y.total||(y.total=w.when(y,function(H){return n.isDefined(H.total)?H.total:H.length||0}));D("forEach");D("filter");D("map");D("some");D("every");return y},a={useSSL:function(y,D){var H=b&&
b.self||{};if(H&&!H.isPortal)return-1!==y.indexOf("https:")||H.allSSL?D.replace("http:","https:"):D;var I=a.getLocation(D);return-1<H.portalHostname.toLowerCase().indexOf(I.hostname.toLowerCase())&&I.port&&"80"!==I.port&&"443"!==I.port?(D=I.pathname,D=0===D.indexOf("/")?D:"/"+D,H.allSSL||-1<y.indexOf("https:")?"https://"+I.hostname+(H.httpsPort&&"443"!==H.httpsPort?":"+H.httpsPort:"")+D+I.search:"http://"+I.hostname+(H.httpPort&&"80"!==H.httpPort?":"+H.httpPort:"")+D+I.search):-1!==y.indexOf("https:")||
H.allSSL?D.replace("http:","https:"):D},formatUrl:function(y){var D=b.currentToken;return-1!==y.indexOf("null")?null:a.useSSL(window.location.protocol,D?y+(-1!==y.indexOf("?")?"\x26":"?")+("token\x3d"+D):y)},getLocation:function(y){var D=document.createElement("a");D.href=y;return{protocol:D.protocol,hostname:D.hostname,port:D.port,pathname:D.pathname,search:D.search,hash:D.hash,host:D.host}},resultsToTypedArray:function(y,D,H){H=H?H.listings||H.notifications||H.userInvitations||H.tags||H.items||
H.groups||H.comments||H.provisions||H.results||H:[];return m.map(H,function(I){I=q.mixin(I,D||{});return y?new y(I):I})},clearFieldsFromObject:function(y,D){var H,I=y.length;if(q.isArray(y))for(H=0;H<I;H++)delete D[y[H]];else for(H in y)delete D[H];return D},requestToTypedArray:function(y,D,H,I,N){return e(a.request(y,D,H).then(q.partial(a.resultsToTypedArray,I,N)))},request:function(y,D,H){if(D){D.portal&&delete D.portal;if(D.form){var I=D.form;delete D.form}if(D.hasOwnProperty("withCredentials")){var N=
D.withCredentials;delete D.withCredentials}}D=q.mixin(q.mixin({},D||{}),b.requestParams);y={url:a.useSSL(window.location.protocol,y.url||y),content:D,callbackParamName:"callback",timeout:S&&S.timeout||0,form:I};null!=N&&(y.withCredentials=N);var S=q.mixin(H||{},b.options);return d(y,S)},formatQueryParams:function(y,D,H){y=q.mixin(q.mixin({},y),q.isString(D)?{q:D}:D||{});y.q=!H&&b.extraQuery?"("+y.q+")"+b.extraQuery:y.q;return y}},f=E([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(y){q.mixin(this,
y);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null}}),h=E([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(y){q.mixin(this,y);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null}}),p=E([],{declaredClass:"esri.arcgis.PortalItem",constructor:function(y){q.mixin(this,y);this.folderId=this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=
this.hasOwnProperty("ownerFolder")?this.itemUrl.replace("/content/","/content/users/"+this.owner+(this.folderId?"/"+this.folderId:"")+"/"):null;this.itemDataUrl=a.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=a.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.displayName=this._getDisplayName();this.iconUrl=this._getIconUrl();this.isPremiumContent=this._getIsPremiumContent();this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=
this.modified?new Date(this.modified):null},getTypeInfo:function(){var y=this.type;return{source:-1<m.indexOf(this.typeKeywords||[],"ArcGIS Server")||"Feature Collection"===y?y:null,displayName:this.displayName,iconUrl:this.iconUrl,isPremiumContent:this.isPremiumContent,premiumIconUrl:this._getPremiumIconUrl()}},addComment:function(y){var D=q.isString(y)?{comment:y}:y;return a.request(this.itemUrl+"/addComment",D,{usePost:!0}).then(q.hitch(this,function(H){return new f(q.mixin(D,{id:H.commentId,item:this}))}))},
updateComment:function(y){if(y&&y.url&&y.comment)return a.request(y.url+"/update",{comment:y.comment},{usePost:!0}).then(function(D){y.id=D.commentId;return y});throw Error();},getComments:function(){return a.requestToTypedArray(this.itemUrl+"/comments",null,null,f,{item:this})},deleteComment:function(y){if(y&&y.url)return a.request(y.url+"/delete",null,{usePost:!0});throw Error();},addRating:function(y){var D=q.isObject(y)?y:{rating:parseFloat(y)};return a.request(this.itemUrl+"/addRating",D,{usePost:!0}).then(q.hitch(this,
function(H){return new h(q.mixin(D,{id:H.ratingId,item:this}))}))},getRating:function(){return a.request(this.itemUrl+"/rating").then(q.hitch(this,function(y){return new h(q.mixin(y,{item:this}))}))},deleteRating:function(){return a.request(this.itemUrl+"/deleteRating",null,{usePost:!0})},_getDisplayName:function(){var y=this.type,D=this.typeKeywords||[],H=y;"Feature Service"===y||"Feature Collection"===y?H=-1<m.indexOf(D,"Table")?"Table":-1<m.indexOf(D,"Route Layer")?"Route Layer":-1<m.indexOf(D,
"Markup")?"Markup":"Feature Layer":"Image Service"===y?H=-1<m.indexOf(D,"Elevation 3D Layer")?"Elevation Layer":-1<m.indexOf(D,"Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===y?H="Scene Layer":"Video Service"===y?H="Video Layer":"Scene Package"===y?H="Scene Layer Package":"Stream Service"===y?H="Feature Layer":"Geoprocessing Service"===y&&this.portal&&this.portal.isPortal?H=-1<m.indexOf(D,"Web Tool")?"Tool":"Geoprocessing Service":"Geoenrichment Service"===y?H="GeoEnrichment Service":
"Geocoding Service"===y?H="Locator":"Microsoft Powerpoint"===y?H="Microsoft PowerPoint":"GeoJson"===y?this.type=H="GeoJSON":"Globe Service"===y?H="Globe Layer":"Vector Tile Service"===y?H="Tile Layer":"netCDF"===y?H="NetCDF":"Map Service"===y?H=-1===m.indexOf(D,"Spatiotemporal")&&(-1<m.indexOf(D,"Hosted Service")||-1<m.indexOf(D,"Tiled"))&&-1===m.indexOf(D,"Relational")?"Tile Layer":"Map Image Layer":y&&-1<y.toLowerCase().indexOf("add in")?H=y.replace(/(add in)/ig,"Add-In"):"datastore catalog service"===
y?H="Big Data File Share":"Compact Tile Package"===y?H="Tile Package (tpkx)":"Raster function template"===y?H="Raster Function Template":"OGCFeatureServer"===y?H="OGC Feature Layer":"web mapping application"===y&&-1<m.indexOf(D,"configurableApp")&&(H="Instant App");return H},_getIconUrl:function(){var y=this.type&&this.type.toLowerCase()||"",D=this.typeKeywords||[],H=!1,I=!1,N=!1,S=!1,M=!1,Q=!1;I=!1;0<y.indexOf("service")||"feature collection"===y||"kml"===y||"wms"===y||"wmts"===y||"wfs"===y?(H=-1<
m.indexOf(D,"Hosted Service"),"feature service"===y||"feature collection"===y||"kml"===y||"wfs"===y?(S=-1<m.indexOf(D,"Table"),I=-1<m.indexOf(D,"Route Layer"),N=-1<m.indexOf(D,"Markup"),M=-1!==m.indexOf(D,"Spatiotemporal"),Q=-1!==m.indexOf(D,"UtilityNetwork"),y=M&&S?"spatiotemporaltable":S?"table":I?"routelayer":N?"markup":M?"spatiotemporal":Q?"utilitynetwork":H?"featureshosted":"features"):"map service"===y||"wms"===y||"wmts"===y?(M=-1!==m.indexOf(D,"Spatiotemporal"),I=-1!==m.indexOf(D,"Relational"),
y=M||I?"mapimages":H||-1<m.indexOf(D,"Tiled")||"wmts"===y?"maptiles":"mapimages"):y="scene service"===y?-1<m.indexOf(D,"Line")?"sceneweblayerline":-1<m.indexOf(D,"3DObject")?"sceneweblayermultipatch":-1<m.indexOf(D,"Point")?"sceneweblayerpoint":-1<m.indexOf(D,"IntegratedMesh")?"sceneweblayermesh":-1<m.indexOf(D,"PointCloud")?"sceneweblayerpointcloud":-1<m.indexOf(D,"Polygon")?"sceneweblayerpolygon":-1<m.indexOf(D,"Building")?"sceneweblayerbuilding":-1<m.indexOf(D,"Voxel")?"sceneweblayervoxel":"sceneweblayer":
"image service"===y?-1<m.indexOf(D,"Elevation 3D Layer")?"elevationlayer":-1<m.indexOf(D,"Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===y?"streamlayer":"vector tile service"===y?"vectortile":"datastore catalog service"===y?"datastorecollection":"geocoding service"===y?"geocodeservice":"video service"===y?"mediaservice":"geoprocessing service"===y?-1<m.indexOf(D,"Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":"geodata service"===y?"geodataservice":"layers"):y="web map"===
y||"cityengine web scene"===y?"maps":"web scene"===y?-1<m.indexOf(D,"ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===y&&-1<m.indexOf(D,"configurableApp")?"instantapps":"web mapping application"===y||"mobile application"===y||"application"===y||"operation view"===y||"desktop application"===y?"apps":"map document"===y||"map package"===y||"published map"===y||"scene document"===y||"globe document"===y||"basemap package"===y||"mobile basemap package"===y||"mobile map package"===
y||"project package"===y||"project template"===y||"pro map"===y||"layout"===y||"layer"===y&&-1<m.indexOf(D,"ArcGIS Pro")||"explorer map"===y&&m.indexOf(D,"Explorer Document")?"mapsgray":"service definition"===y||"csv"===y||"shapefile"===y||"cad drawing"===y||"geojson"===y||"360 vr experience"===y||"netcdf"===y||"administrative report"===y?"datafiles":"explorer add in"===y||"desktop add in"===y||"windows viewer add in"===y||"windows viewer configuration"===y?"appsgray":"arcgis pro add in"===y||"arcgis pro configuration"===
y?"addindesktop":"rule package"===y||"file geodatabase"===y||"sqlite geodatabase"===y||"csv collection"===y||"kml collection"===y||"windows mobile package"===y||"map template"===y||"desktop application template"===y||"gml"===y||"arcpad package"===y||"code sample"===y||"form"===y||"document link"===y||"earth configuration"===y||"operations dashboard add in"===y||"rules package"===y||"image"===y||"workflow manager package"===y||"explorer map"===y&&-1<m.indexOf(D,"Explorer Mapping Application")||-1<
m.indexOf(D,"Document")?"datafilesgray":"network analysis service"===y||"geoprocessing service"===y||"geodata service"===y||"geometry service"===y||"geoprocessing package"===y||"locator package"===y||"geoprocessing sample"===y||"workflow manager service"===y?"toolsgray":"layer"===y||"layer package"===y||"explorer layer"===y?"layersgray":"scene package"===y?"scenepackage":"mobile scene package"===y?"mobilescenepackage":"tile package"===y||"compact tile package"===y?"tilepackage":"task file"===y?"taskfile":
"report template"===y?"report-template":"statistical data collection"===y?"statisticaldatacollection":"insights workbook"===y?"workbook":"insights model"===y?"insightsmodel":"insights page"===y?"insightspage":"insights theme"===y?"insightstheme":"hub initiative"===y?"hubinitiative":"hub page"===y?"hubpage":"hub site application"===y?"hubsite":"hub event"===y?"hubevent":"hub project"===y?"hubproject":"relational database connection"===y?"relationaldatabaseconnection":"big data file share"===y?"datastorecollection":
"image collection"===y?"imagecollection":"desktop style"===y?"desktopstyle":"style"===y?"style":"dashboard"===y?"dashboard":"raster function template"===y?"rasterprocessingtemplate":"vector tile package"===y?"vectortilepackage":"ortho mapping project"===y?"orthomappingproject":"ortho mapping template"===y?"orthomappingtemplate":"solution"===y?"solutions":"geopackage"===y?"geopackage":"deep learning package"===y?"deeplearningpackage":"real time analytic"===y?"realtimeanalytics":"big data analytic"===
y?"bigdataanalytics":"feed"===y?"feed":"excalibur imagery project"===y?"excaliburimageryproject":"notebook"===y?"notebook":"storymap"===y?"storymap":"survey123 add in"===y?"survey123addin":"mission"===y?"mission":"mission report"===y?"missionreport":"quickcapture project"===y?"quickcaptureproject":"pro report"===y?"proreport":"pro report template"===y?"proreporttemplate":"urban model"===y?"urbanmodel":"web experience"===y?"experiencebuilder":"web experience template"===y?"webexperiencetemplate":"experience builder widget"===
y?"experiencebuilderwidget":"experience builder widget package"===y?"experiencebuilderwidgetpackage":"workflow"===y?"workflow":"kernel gateway connection"===y?"kernelgatewayconnection":"insights script"===y?"insightsscript":"hub initiative template"===y?"hubinitiativetemplate":"storymap theme"===y?"storymaptheme":"knowledge graph"===y?"knowledgegraph":"native application"===y?"nativeapp":"native application installer"===y?"nativeappinstaller":"link chart"===y?"linkchart":"investigation"===y?"investigation":
"ogcfeatureserver"===y?"features":"pro project"===y?"proproject":"insights workbook package"===y?"insightsworkbookpackage":"apache parquet"===y?"apacheparquet":"notebook code snippets"===y||"notebook code snippet library"===y?"notebookcodesnippets":"suitability model"===y?"suitabilitymodel":"esri classifier definition"===y?"classifierdefinition":"esri classification schema"===y?"classificationschema":"insights data engineering workbook"===y?"dataengineeringworkbook":"insights data engineering model"===
y?"dataengineeringmodel":"deep learning studio project"===y?"deeplearningproject":"discussion"===y?"discussion":"maps";return y?r.toUrl("../css/images/item_type_icons/"+y+"16.png"):null},_getIsPremiumContent:function(){var y=this.typeKeywords,D=!1;if(-1<m.indexOf(y,"Requires Subscription")||-1<m.indexOf(y,"Requires Credits"))D=!0;return D},_getPremiumIconUrl:function(){var y=this.typeKeywords,D;this.isPremiumContent&&(D=-1<m.indexOf(y,"Requires Credits")?"premiumcredits":"premiumitem");return D?r.toUrl("../css/images/item_type_icons/"+
D+"16.png"):null},getThumbnailUrl:function(y){var D=this.thumbnailUrl;D&&y&&(D+=(-1===D.indexOf("?")?"?":"\x26")+"w\x3d"+y);return D}}),B=E([],{declaredClass:"esri.arcgis.PortalListing",constructor:function(y){q.mixin(this,y);this.id=this.itemId;this.url=(this.portal&&this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":"listings/")+this.itemId;this.commentsUrl=this.url+"/comments";this.created=this.created?new Date(this.created):null;this.banner=this.banner?a.formatUrl(this.url+"/info/"+
this.banner):"";this.thumbnail=this.thumbnail?a.formatUrl(this.url+"/info/"+this.thumbnail):"";this.largeThumbnail=this.largeThumbnail?a.formatUrl(this.url+"/info/"+this.largeThumbnail):"";this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||0;this.numComments=this.numComments||0;this.listingProperties=this.listingProperties||{priceDesc:"",creditsPerTransaction:0,licenseType:"free",trialSupported:!1,trialDuration:0,listingAccess:"private"};for(var D in this.listingProperties)this[D]&&
(this.listingProperties[D]=this[D]);this.properties=this.properties||{systemRequirements:"",termsAndConditions:"",version:"1.0"};this.screenshots=m.map(this.screenshots,q.hitch(this,function(H){return a.formatUrl(this.url+"/info/"+H)}));this.vendorName=this.vendor.name;this.vendor.thumbnail=this.vendor.thumbnail?this.userItemUrl?a.formatUrl(this.portal.portalUrl+"/portals/self/resources/"+this.vendor.thumbnail):a.formatUrl(this.url+"/vendorinfo/"+this.vendor.thumbnail):""},getComments:function(){return a.requestToTypedArray(this.commentsUrl,
null,null,f,{item:this})},getVendor:function(){return this.vendor}}),u=E([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(y){q.mixin(this,y);this.created=this.created?new Date(this.created):null;this.startDate=this.startDate?new Date(this.startDate):null;this.endDate=this.endDate&&-1!==this.endDate?new Date(this.endDate):null;this.listing=y.listing?new B(q.mixin(y.listing,{portal:this.portal})):null}}),t=E([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(y){q.mixin(this,
y);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=a.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getMembers:function(){return a.request(this.url+"/users")},queryItems:function(y,D){y=a.formatQueryParams({},y,D);y.q="group:"+this.id+(y.q?" "+y.q:"");return this.portal.queryItems(y)},getThumbnailUrl:function(y){var D=this.thumbnailUrl;D&&y&&(D+=
(-1===D.indexOf("?")?"?":"\x26")+"w\x3d"+y);return D}}),z=E([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(y){q.mixin(this,y);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null},getItems:function(){return a.requestToTypedArray(this.url,null,null,p,{portal:this.portal,folderId:this.id})}}),x=E([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(y){q.mixin(this,y);this.url=(this.portal&&
this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;this.thumbnailUrl=this.thumbnail?a.formatUrl(this.url+"/info/"+this.thumbnail):null;this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getGroups:function(){return e(a.request(this.url).then(q.hitch(this,function(y){return a.resultsToTypedArray(t,{portal:this.portal},y.groups)})))},getNotifications:function(){return a.requestToTypedArray(this.url+
"/notifications",null,null,null,{portal:this.portal})},getGroupInvitations:function(){return a.requestToTypedArray(this.url+"/invitations",null,null,null,{portal:this.portal})},getTags:function(){return a.requestToTypedArray(this.url+"/tags",null,null,null,{portal:this.portal})},getFolders:function(){return e(this.getContent(null,{num:1}).then(function(y){return y.folders}))},getItems:function(y){return e(this.getContent(y).then(function(D){return D.items}))},getItem:function(y){return a.request(this.portal.portalUrl+
"content/items/"+y).then(q.hitch(this,function(D){return new p(q.mixin(D,{portal:this.portal}))}))},getContent:function(y,D){var H=this.url.replace("/community/","/content/")+(y?"/"+y:"");return a.request(H,D).then(q.hitch(this,function(I){I.folders=a.resultsToTypedArray(z,{portal:this.portal},I.folders);I.items=a.resultsToTypedArray(p,{portal:this.portal,folderId:y},I.items);return I}))},getThumbnailUrl:function(y){var D=this.thumbnailUrl;D&&y&&(D+=(-1===D.indexOf("?")?"?":"\x26")+"w\x3d"+y);return D}});
E={Portal:E([g],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},onError:function(){},constructor:function(y){y=q.isObject(y)?y:{url:y};this.registerConnectEvents();b={options:{disableIdentityLookup:!0},requestParams:{f:"json"}};y.self?(b.self=y.self,q.mixin(this,{url:y.url||c.getProtocolForWebResource()+"//"+(y.self.urlKey?y.self.urlKey+"."+y.self.customBaseUrl:y.self.portalHostname)}),this.portalUrl=-1!==this.url.indexOf("/sharing")?this.url+"/":this.url+"/sharing/rest/",y=y.self.user?this.signIn():
this.init(this.url)):(y.url&&q.mixin(this,{url:y.url}),y=this.init(this.url));y.then(q.hitch(this,function(){this.emit("ready",this);this.onLoad(this)}))},init:function(y,D){y=(y||this.portalUrl).replace(/\/+$/,"");this.portalUrl=-1!==y.indexOf("/sharing")?y+"/":y+"/sharing/rest/";c.canUseXhr(this.portalUrl)||l.defaults.io.corsEnabledServers.push(this.portalUrl.replace(/^https?:\/\//i,""));return this._getSelf(this.portalUrl).then(q.hitch(this,function(H){b.self=q.mixin({},H);(H=H.user)&&D&&(b.currentToken=
D&&D.token,b.loggedInUser=new x(q.mixin(H,{portal:this,credential:D})));b.self.id&&!1===b.self.canSearchPublic&&(b.extraQuery=" AND orgid:"+b.self.id);q.mixin(this,b.self);this.thumbnailUrl=a.formatUrl(this.portalUrl+"portals/self/resources/"+this.thumbnail);this.isOrganization=this.access&&this.access.length?!0:!1;this.created=this.created?new Date(this.created):null;this.modified=this.modified?new Date(this.modified):null;return this}),q.hitch(this,function(H){this.onError(H);throw H;}))},signIn:function(){var y=
new w,D=q.hitch(this,function(){this._onSignIn().then(q.hitch(this,function(){y.resolve(b.loggedInUser)}),q.hitch(this,function(H){y.reject(H)}))});if(b&&b.self)b&&b.loggedInUser?setTimeout(function(){y.resolve(b.loggedInUser)},0):D();else this.on("load",q.hitch(this,function(){D()}));return y},signOut:function(){b.loggedInUser.credential&&b.loggedInUser.credential.destroy();b.loggedInUser=null;b.options.disableIdentityLookup=!0;a.clearFieldsFromObject(b.self,this);b.self=null;return this.init(this.url)},
getPortalUser:function(){return b.loggedInUser},addResource:function(y,D){return a.request(this.portalUrl+"portals/self/addResource",{key:y,text:D},{usePost:!0})},update:function(y){return a.request(this.portalUrl+"portals/self/update",y,{usePost:!0})},queryGroups:function(y,D){return this._queryPortal(this.portalUrl+"community/groups",a.formatQueryParams({},y,D),t)},queryItems:function(y,D){return this._queryPortal(this.portalUrl+"search",a.formatQueryParams({},y,D),p)},queryListings:function(y){y=
a.formatQueryParams({},y,!0);var D="";y.q&&-1<y.q.toLowerCase().indexOf("mylistings:true")?(y.q=y.q.toLowerCase().replace("mylistings:true",""),D="?mylistings\x3dtrue"):y.q||(y.q='""');return this._queryPortal(this.portalUrl+"content/listings"+D,y,B)},queryCustomerList:function(y,D){y=a.formatQueryParams({},y,!0);return this._queryPortal(this.portalUrl+"portals/self/customersList",y)},getProvisions:function(){return this.getCustomers().then(q.hitch(this,function(y){return y.purchases}))},getInterests:function(){return this.getCustomers().then(q.hitch(this,
function(y){return y.interests}))},getTrials:function(){return this.getCustomers().then(q.hitch(this,function(y){return y.trials}))},getCustomers:function(y){return a.request(this.portalUrl+"portals/self/customers",{status:y||"all"})},getMyPurchases:function(){return this.getPurchases().then(function(y){return y.purchases})},getMyInterests:function(){return this.getPurchases().then(function(y){return y.interests})},getPurchases:function(){return a.request(this.portalUrl+"portals/self/purchases").then(q.hitch(this,
function(y){y.interests=m.map(y.interests,function(D){return q.mixin(D.provision,{listing:D.listing})});y.purchases=m.map(y.purchases,function(D){return q.mixin(D.provision,{listing:D.listing})});y.trials=m.map(y.trials,function(D){return q.mixin(D.provision,{listing:D.listing})});y.interests=a.resultsToTypedArray(u,{portal:this},y.interests);y.trials=a.resultsToTypedArray(u,{portal:this},y.trials);y.purchases=a.resultsToTypedArray(u,{portal:this},y.purchases);return y}))},queryUsers:function(y,D){return this._queryPortal(this.portalUrl+
"community/users",a.formatQueryParams({sortField:"username"},y,D),x)},_onSignIn:function(){b.options.disableIdentityLookup=!1;b.self=null;return k.id.getCredential(this.portalUrl).then(q.hitch(this,"init",this.url)).then(function(){return b.loggedInUser},q.hitch(this,function(y){b.options.disableIdentityLookup=!0;this.onError(y);throw y;}))},_getSelf:function(y){y+="portals/self";if(b.self){var D=new w;setTimeout(function(){D.resolve(b.self)},0)}else D=a.request(y,{culture:A.locale,withCredentials:!0});
return D},_queryPortal:function(y,D,H){var I=q.mixin({num:10,start:0,sortField:"title",sortOrder:"asc"},D),N=["start","query","num","nextStart"];y=a.request(y,I).then(q.hitch(this,function(S){S.results=a.resultsToTypedArray(H,{portal:this},S);S.queryParams=q.mixin({},I);S.nextQueryParams=q.mixin(I,{start:S.nextStart});return a.clearFieldsFromObject(N,S)}));y=q.delegate(y);y.queryParams=q.mixin({},I);y.nextQueryParams=w.when(y,function(S){return S.nextQueryParams});return e(y)}}),PortalFolder:z,PortalGroup:t,
PortalItem:p,PortalUser:x,PortalComment:f,PortalRating:h,PortalUtil:a,PortalResult:e,PortalListing:B};v("extend-esri")&&q.mixin(q.getObject("arcgis",!0,k),E);return E})},"jimu/dijit/ImageChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/text!./templates/ImageChooser.html dojo/sniff esri/lang ../utils ./_CropImage jimu/dijit/Popup jimu/dijit/Message jimu/dijit/LoadingShelter".split(" "),function(E,q,A,w,
m,v,r,l,k,n,d,c,g,b,e){var a=0;E=q([A,w,E],{templateString:l,declaredClass:"jimu.dijit.ImageChooser",cropImage:!0,displayImg:null,stretchImg:!0,defaultSelfSrc:null,showSelfImg:!1,label:null,showTip:!0,goldenWidth:400,goldenHeight:400,maxSize:1024,format:null,customZIndex:null,imageData:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.imageChooser;this.nls.common=window.jimuNls.common;this.nls.readError=this.nls.readError||"Failed to read the file."},postCreate:function(){this._initial();
d.file.supportHTML5()||k("safari")||!d.file.isEnabledFlash()||d.file.loadFileAPI().then(m.hitch(this,function(){v.setStyle(this.mask,"zIndex",1)}))},setImageSize:function(f){this.goldenWidth=f.width;this.goldenHeight=f.height},disableChooseImage:function(){v.setStyle(this.fileForm,"display","none");this.label&&"string"===typeof this.label&&v.addClass(this.displayText,"disable-label");v.removeAttr(this.domNode,"title")},enableChooseImage:function(){v.setStyle(this.fileForm,"display","block");this.label&&
"string"===typeof this.label&&v.removeClass(this.displayText,"disable-label");this._addTip()},setDefaultSelfSrc:function(f){this.defaultSelfSrc=f;this.imageData=this.selfImg.src=f},getImageData:function(){return this.imageData},_initial:function(){this._initFileForm();this._processProperties();this._addTip()},_processProperties:function(){this.fileProperty={};this.label&&"string"===typeof this.label&&(this.displayText.innerHTML=d.sanitizeHTML(this.label),v.setStyle(this.hintText,"display","block"));
this.showSelfImg&&v.setStyle(this.hintImage,"display","block");!1===this.stretchImg?v.addClass(this.selfImg,"no-stretch-img"):v.removeClass(this.selfImg,"no-stretch-img");this.defaultSelfSrc&&(this.imageData=this.selfImg.src=this.defaultSelfSrc);if(this.format){var f="image/*";"string"===typeof this.format&&/^image\/./.test(this.format)?f=this.format:"[object Array]"===Object.prototype.toString.call(this.format)&&0<this.format.length&&(f=this.format.join(","));v.setAttr(this.fileInput,"accept",f)}d.file.supportHTML5()||
k("safari")||!d.file.isEnabledFlash()||v.setStyle(this.fileInput,{width:"100%",height:"100%",position:"absolute",left:0,top:0,opacity:0,zIndex:9})},_newMessage:function(f){this.msgPopupOpen=!0;this.msgPopup=new b({customZIndex:this.customZIndex,message:f})},_porcessMaskClick:function(){v.setAttr(this.fileInput,"id","imageChooser_"+a);v.setAttr(this.mask,"for","imageChooser_"+a);a++;r.once(this.mask,"click",m.hitch(this,function(f){f.stopPropagation();if(k("safari")&&7>k("safari"))this._newMessage(this.nls.unsupportReaderAPI),
f.preventDefault();else{if(!d.file.supportHTML5()){if(!d.file.isEnabledFlash()){var h=v.create("a",{href:"http://helpx.adobe.com/flash-player.html",innerHTML:this.nls.enableFlash,target:"_blank"});this._newMessage(h);f.preventDefault();return}if(!d.file.supportFileAPI()){this._newMessage(this.nls.unsupportReaderAPI);f.preventDefault();return}}v.setStyle(this.fileInput,"display","none");setTimeout(m.hitch(this,function(){v.setStyle(this.fileInput,"display","block")}),200)}}))},triggerImgUpload:function(){var f=
document.createEvent("MouseEvents");f.initEvent("click",!0,!1);this.mask.dispatchEvent(f)},_addTip:function(){if(this.showTip){var f=n.substitute({width:this.goldenWidth||40,height:this.goldenHeight||40},this.nls.toolTip);v.setAttr(this.domNode,"title",f)}else v.setAttr(this.domNode,"title","")},_onFileInputChange:function(f){var h=f.target.files&&f.target.files[0]||f.files&&f.files[0];if(this.format&&-1===this.format.indexOf(h.type))this._newMessage(this.nls.invalidType),this._initFileForm();else{var p=
1024*this.maxSize;d.file.readFile(f,"image/*",p,m.hitch(this,function(B,u,t){B?(u=this.nls[B.errCode],"exceed"===B.errCode&&(u=u.replace("1024",p/1024)),this._newMessage(u)):(this.fileProperty.fileName=u,this.cropImage&&"image/gif"!==h.type?this._cropImageByUser(t,h.type):this._readFileData(t));this._initFileForm()}))}},_initFileForm:function(){this.mask&&v.destroy(this.mask);this.fileInput&&v.destroy(this.fileInput);this.fileForm&&v.destroy(this.fileForm);this.fileForm=v.create("form",{"data-dojo-attach-point":"fileForm"},
this.domNode);this.mask=v.create("label",{"data-dojo-attach-point":"mask"},this.fileForm);this.fileInput=v.create("input",{type:"file","data-dojo-attach-point":"fileInput"},this.fileForm);this._porcessMaskClick();r.once(this.fileInput,"change",m.hitch(this,this._onFileInputChange))},_readFileData:function(f){this.onImageChange(f,this.fileProperty);this.displayImg&&v.setAttr(this.displayImg,"src",f);this.showSelfImg&&(this.selfImg?v.setAttr(this.selfImg,"src",f):this.selfImg.src=f,(f=v.getMarginBox(this.hintImage))&&
f.w&&f.h&&(v.style(this.selfImg,"maxWidth",f.w+"px"),v.style(this.selfImg,"maxHeight",f.h+"px")))},_cropImageByUser:function(f,h){var p=new c({imageSrc:f,type:h,nls:m.clone(this.nls),goldenWidth:this.goldenWidth,goldenHeight:this.goldenHeight}),B=new e({hidden:!0});this.cropPopupOpen=!0;this.cropPopup=new g({titleLabel:this.nls.cropImage,content:p,customZIndex:this.customZIndex,width:500,height:480,buttons:[{label:this.nls.common.ok,onClick:m.hitch(this,function(){B.show();var u=p.getData();u&&this._readFileData(u);
this.cropPopup.close();p.destroy();B.hide()})}]});B.placeAt(this.cropPopup.domNode);p.startup();v.addClass(this.cropPopup.domNode,"image-chooser-crop-popup")},onImageChange:function(f){this.imageData=f;this.emit("imageChange",this.imageData,this.fileProperty);this.emit("change",this.imageData,this.fileProperty)}});E.GIF="image/gif";E.JPEG="image/jpeg";E.PNG="image/png";return E})},"jimu/dijit/_CropImage":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_CropImage.html jimu/dijit/Message libs/cropperjs/cropperjs xstyle/css!libs/cropperjs/cropper.css dojo/NodeList-dom".split(" "),
function(E,q,A,w,m,v,r,l,k){return E([m,v],{templateString:r,imageSrc:null,type:null,goldenWidth:4,goldenHeight:3,_haveShowReadErrMsg:!1,postCreate:function(){this.type||(this.type="image/jpeg");this.setImageSrc(this.imageSrc);this.loadingImg.src=require.toUrl("jimu")+"/images/loading.gif";this._checkImgError();this.own(w(this.baseImage,"load",A.hitch(this,function(){q.setStyle(this.loadingImg,"display","none");this._initCropper()})))},_initCropper:function(){this.cropper&&this.cropper.destroy&&this.cropper.destroy();
this.cropper=new k(this.baseImage,{aspectRatio:this.goldenWidth/this.goldenHeight,preview:".img-preview"})},setImageSrc:function(n){q.setAttr(this.baseImage,"src",n)},getData:function(){try{var n=this.cropper.getCroppedCanvas();this.cropper.getCroppedCanvas();return n.toDataURL(this.type||"image/jpeg")}catch(d){return this._readError(),null}},destroy:function(){this.cropper&&this.cropper.destroy&&this.cropper.destroy();this.inherited(arguments)},_checkImgError:function(){setTimeout(A.hitch(this,function(){"none"!==
q.getStyle(this.loadingImg,"display")&&this._readError()}),5E3)},_readError:function(){this._haveShowReadErrMsg||(new l({message:this.nls.readError}),this._haveShowReadErrMsg=!0)}})})},"libs/cropperjs/cropperjs":function(){!function(E,q){"object"==typeof exports&&"undefined"!=typeof module?module.exports=q():"function"==typeof define&&define.amd?define(q):(E=E||self).Cropper=q()}(this,function(){function E(V){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ca){return typeof ca}:
function(ca){return ca&&"function"==typeof Symbol&&ca.constructor===Symbol&&ca!==Symbol.prototype?"symbol":typeof ca})(V)}function q(V,ca){for(var aa=0;aa<ca.length;aa++){var ea=ca[aa];ea.enumerable=ea.enumerable||!1;ea.configurable=!0;"value"in ea&&(ea.writable=!0);Object.defineProperty(V,ea.key,ea)}}function A(V){if(!(V=function(ca){if(Array.isArray(ca)){for(var aa=0,ea=Array(ca.length);aa<ca.length;aa++)ea[aa]=ca[aa];return ea}}(V)||function(ca){if(Symbol.iterator in Object(ca)||"[object Arguments]"===
Object.prototype.toString.call(ca))return Array.from(ca)}(V)))throw new TypeError("Invalid attempt to spread non-iterable instance");return V}function w(V){return"number"==typeof V&&!Da(V)}function m(V){return"object"===E(V)&&null!==V}function v(V){if(!m(V))return!1;try{var ca=V.constructor,aa=ca.prototype;return ca&&aa&&Ca.call(aa,"isPrototypeOf")}catch(ea){return!1}}function r(V){return"function"==typeof V}function l(V){return Array.from?Array.from(V):O.call(V)}function k(V,ca){return V&&r(ca)&&
(Array.isArray(V)||w(V.length)?l(V).forEach(function(aa,ea){ca.call(V,aa,ea,V)}):m(V)&&Object.keys(V).forEach(function(aa){ca.call(V,V[aa],aa,V)})),V}function n(V){var ca=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1E11;return G.test(V)?Math.round(V*ca)/ca:V}function d(V,ca){var aa=V.style;k(ca,function(ea,la){L.test(la)&&w(ea)&&(ea="".concat(ea,"px"));aa[la]=ea})}function c(V,ca){if(ca)if(w(V.length))k(V,function(ea){c(ea,ca)});else if(V.classList)V.classList.add(ca);else{var aa=V.className.trim();
aa?0>aa.indexOf(ca)&&(V.className="".concat(aa," ").concat(ca)):V.className=ca}}function g(V,ca){ca&&(w(V.length)?k(V,function(aa){g(aa,ca)}):V.classList?V.classList.remove(ca):0<=V.className.indexOf(ca)&&(V.className=V.className.replace(ca,"")))}function b(V,ca,aa){ca&&(w(V.length)?k(V,function(ea){b(ea,ca,aa)}):aa?c(V,ca):g(V,ca))}function e(V){return V.replace(P,"$1-$2").toLowerCase()}function a(V,ca){return m(V[ca])?V[ca]:V.dataset?V.dataset[ca]:V.getAttribute("data-".concat(e(ca)))}function f(V,
ca,aa){m(aa)?V[ca]=aa:V.dataset?V.dataset[ca]=aa:V.setAttribute("data-".concat(e(ca)),aa)}function h(V,ca,aa){var ea=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},la=aa;ca.trim().split(T).forEach(function(oa){if(!Y){var za=V.listeners;za&&za[oa]&&za[oa][aa]&&(la=za[oa][aa],delete za[oa][aa],0===Object.keys(za[oa]).length&&delete za[oa],0===Object.keys(za).length&&delete V.listeners)}V.removeEventListener(oa,la,ea)})}function p(V,ca,aa){var ea=3<arguments.length&&void 0!==arguments[3]?
arguments[3]:{},la=aa;ca.trim().split(T).forEach(function(oa){if(ea.once&&!Y){var za=V.listeners,sa=void 0===za?{}:za;la=function(){delete sa[oa][aa];V.removeEventListener(oa,la,ea);for(var Ea=arguments.length,Ba=Array(Ea),ya=0;ya<Ea;ya++)Ba[ya]=arguments[ya];aa.apply(V,Ba)};sa[oa]||(sa[oa]={});sa[oa][aa]&&V.removeEventListener(oa,sa[oa][aa],ea);sa[oa][aa]=la;V.listeners=sa}V.addEventListener(oa,la,ea)})}function B(V,ca,aa){var ea;return r(Event)&&r(CustomEvent)?ea=new CustomEvent(ca,{detail:aa,bubbles:!0,
cancelable:!0}):(ea=document.createEvent("CustomEvent")).initCustomEvent(ca,!0,!0,aa),V.dispatchEvent(ea)}function u(V){V=V.getBoundingClientRect();return{left:V.left+(window.pageXOffset-document.documentElement.clientLeft),top:V.top+(window.pageYOffset-document.documentElement.clientTop)}}function t(V){V=V.match(ja);return null!==V&&(V[1]!==fa.protocol||V[2]!==fa.hostname||V[3]!==fa.port)}function z(V){var ca="timestamp\x3d".concat((new Date).getTime());return V+(-1===V.indexOf("?")?"?":"\x26")+
ca}function x(V){var ca=V.rotate,aa=V.scaleX,ea=V.scaleY,la=V.translateX;V=V.translateY;var oa=[];w(la)&&0!==la&&oa.push("translateX(".concat(la,"px)"));w(V)&&0!==V&&oa.push("translateY(".concat(V,"px)"));w(ca)&&0!==ca&&oa.push("rotate(".concat(ca,"deg)"));w(aa)&&1!==aa&&oa.push("scaleX(".concat(aa,")"));w(ea)&&1!==ea&&oa.push("scaleY(".concat(ea,")"));ca=oa.length?oa.join(" "):"none";return{WebkitTransform:ca,msTransform:ca,transform:ca}}function y(V,ca){var aa=V.pageX;V=V.pageY;var ea={endX:aa,
endY:V};return ca?ea:C({startX:aa,startY:V},ea)}function D(V){var ca=V.aspectRatio,aa=V.height,ea=V.width,la=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"contain",oa=0<ea&&ea<1/0,za=0<aa&&aa<1/0;oa&&za?(oa=aa*ca,"contain"===la&&ea<oa||"cover"===la&&oa<ea?aa=ea/ca:ea=aa*ca):oa?aa=ea/ca:za&&(ea=aa*ca);return{width:ea,height:aa}}function H(V){V=new DataView(V);try{var ca,aa;if(255===V.getUint8(0)&&216===V.getUint8(1))for(var ea=V.byteLength,la=2;la+1<ea;){if(255===V.getUint8(la)&&225===V.getUint8(la+
1)){var oa=la;break}la+=1}if(oa){ea=oa+10;var za=oa+4;oa=4;la="";for(oa+=za;za<oa;za+=1)la+=ka(V.getUint8(za));if("Exif"===la){var sa=V.getUint16(ea);if(((ca=18761===sa)||19789===sa)&&42===V.getUint16(ea+2,ca)){var Ea=V.getUint32(ea+4,ca);8<=Ea&&(aa=ea+Ea)}}}if(aa){var Ba,ya,Ha=V.getUint16(aa,ca);for(ya=0;ya<Ha;ya+=1)if(Ba=aa+12*ya+2,274===V.getUint16(Ba,ca)){Ba+=8;var Na=V.getUint16(Ba,ca);V.setUint16(Ba,1,ca);break}}}catch(Qa){Na=1}return Na}var I="undefined"!=typeof window,N=I?window:{},S=!!I&&
"ontouchstart"in N.document.documentElement,M=!!I&&"PointerEvent"in N,Q="".concat("cropper","-crop"),da="".concat("cropper","-disabled"),J="".concat("cropper","-hidden"),R="".concat("cropper","-hide"),W="".concat("cropper","-invisible"),X="".concat("cropper","-modal"),ia="".concat("cropper","-move"),ma="".concat("cropper","Action"),ha="".concat("cropper","Preview"),xa=M?"pointerdown":S?"touchstart":"mousedown",ua=M?"pointermove":S?"touchmove":"mousemove",na=M?"pointerup pointercancel":S?"touchend touchcancel":
"mouseup",va=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,ra=/^data:image\/jpeg;base64,/,wa=/^img|canvas$/i,Z={viewMode:0,dragMode:"crop",initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,
minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Da=Number.isNaN||N.isNaN,Ca=Object.prototype.hasOwnProperty,O=Array.prototype.slice,C=Object.assign||function(V){for(var ca=arguments.length,aa=Array(1<ca?ca-1:0),ea=1;ea<ca;ea++)aa[ea-1]=arguments[ea];return m(V)&&0<aa.length&&aa.forEach(function(la){m(la)&&Object.keys(la).forEach(function(oa){V[oa]=la[oa]})}),
V},G=/\.\d*(?:0|9){12}\d*$/,L=/^width|height|left|top|marginLeft|marginTop$/,P=/([a-z\d])([A-Z])/g,T=/\s\s*/,Y=function(){var V=!1;if(I){var ca=!1,aa=function(){},ea=Object.defineProperty({},"once",{get:function(){return V=!0,ca},set:function(la){ca=la}});N.addEventListener("test",aa,ea);N.removeEventListener("test",aa,ea)}return V}(),fa=N.location,ja=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i,ka=String.fromCharCode,ta=/^data:.*,/,pa=N.Cropper;S=function(){function V(ea){var la=1<arguments.length&&void 0!==
arguments[1]?arguments[1]:{};if(!(this instanceof V))throw new TypeError("Cannot call a class as a function");if(!ea||!wa.test(ea.tagName))throw Error("The first argument is required and must be an \x3cimg\x3e or \x3ccanvas\x3e element.");this.element=ea;this.options=C({},Z,v(la)&&la);this.disabled=this.cropped=!1;this.pointers={};this.sizing=this.sized=this.replaced=this.reloading=this.ready=!1;this.init()}var ca,aa;return aa=[{key:"noConflict",value:function(){return window.Cropper=pa,V}},{key:"setDefaults",
value:function(ea){C(Z,v(ea)&&ea)}}],ca=[{key:"init",value:function(){var ea,la=this.element,oa=la.tagName.toLowerCase();if(!la.cropper){if(la.cropper=this,"img"===oa){if(this.isImg=!0,ea=la.getAttribute("src")||"",!(this.originalUrl=ea))return;ea=la.src}else"canvas"===oa&&window.HTMLCanvasElement&&(ea=la.toDataURL());this.load(ea)}}},{key:"load",value:function(ea){var la=this;if(ea){this.url=ea;this.imageData={};var oa=this.element,za=this.options;if(za.rotatable||za.scalable||(za.checkOrientation=
!1),za.checkOrientation&&window.ArrayBuffer)if(ra.test(ea))this.read((sa=ea.replace(ta,""),Ea=atob(sa),Ba=new ArrayBuffer(Ea.length),k(ya=new Uint8Array(Ba),function(Na,Qa){ya[Qa]=Ea.charCodeAt(Qa)}),Ba));else{var sa,Ea,Ba,ya,Ha=new XMLHttpRequest;sa=this.clone.bind(this);this.reloading=!0;(this.xhr=Ha).onabort=sa;Ha.onerror=sa;Ha.ontimeout=sa;Ha.onprogress=function(){"image/jpeg"!==Ha.getResponseHeader("content-type")&&Ha.abort()};Ha.onload=function(){la.read(Ha.response)};Ha.onloadend=function(){la.reloading=
!1;la.xhr=null};za.checkCrossOrigin&&t(ea)&&oa.crossOrigin&&(ea=z(ea));Ha.open("GET",ea);Ha.responseType="arraybuffer";Ha.withCredentials="use-credentials"===oa.crossOrigin;Ha.send()}else this.clone()}}},{key:"read",value:function(ea){var la=this.options,oa=this.imageData,za=H(ea),sa=0,Ea=1,Ba=1;1<za&&(this.url=function(ya,Ha){var Na=[];for(ya=new Uint8Array(ya);0<ya.length;)Na.push(ka.apply(null,l(ya.subarray(0,8192)))),ya=ya.subarray(8192);return"data:".concat(Ha,";base64,").concat(btoa(Na.join("")))}(ea,
"image/jpeg"),ea=function(ya){var Ha=0,Na=1,Qa=1;switch(ya){case 2:Na=-1;break;case 3:Ha=-180;break;case 4:Qa=-1;break;case 5:Ha=90;Qa=-1;break;case 6:Ha=90;break;case 7:Ha=90;Na=-1;break;case 8:Ha=-90}return{rotate:Ha,scaleX:Na,scaleY:Qa}}(za),sa=ea.rotate,Ea=ea.scaleX,Ba=ea.scaleY);la.rotatable&&(oa.rotate=sa);la.scalable&&(oa.scaleX=Ea,oa.scaleY=Ba);this.clone()}},{key:"clone",value:function(){var ea,la,oa=this.element,za=this.url;this.options.checkCrossOrigin&&t(za)&&(la=(ea=oa.crossOrigin)?za:
(ea="anonymous",z(za)));this.crossOrigin=ea;this.crossOriginUrl=la;var sa=document.createElement("img");ea&&(sa.crossOrigin=ea);sa.src=la||za;(this.image=sa).onload=this.start.bind(this);sa.onerror=this.stop.bind(this);c(sa,R);oa.parentNode.insertBefore(sa,oa.nextSibling)}},{key:"start",value:function(){var ea=this,la=this.isImg?this.element:this.image;la.onload=null;la.onerror=null;this.sizing=!0;var oa=N.navigator&&/^(?:.(?!chrome|android))*safari/i.test(N.navigator.userAgent),za=function(Ba,ya){C(ea.imageData,
{naturalWidth:Ba,naturalHeight:ya,aspectRatio:Ba/ya});ea.sizing=!1;ea.sized=!0;ea.build()};if(!la.naturalWidth||oa){var sa=document.createElement("img"),Ea=document.body||document.documentElement;(this.sizingImage=sa).onload=function(){za(sa.width,sa.height);oa||Ea.removeChild(sa)};sa.src=la.src;oa||(sa.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",Ea.appendChild(sa))}else za(la.naturalWidth,
la.naturalHeight)}},{key:"stop",value:function(){var ea=this.image;ea.onload=null;ea.onerror=null;ea.parentNode.removeChild(ea);this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var ea=this.element,la=this.options,oa=this.image,za=ea.parentNode,sa=document.createElement("div");sa.innerHTML='\x3cdiv class\x3d"cropper-container" touch-action\x3d"none"\x3e\x3cdiv class\x3d"cropper-wrap-box"\x3e\x3cdiv class\x3d"cropper-canvas"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"cropper-drag-box"\x3e\x3c/div\x3e\x3cdiv class\x3d"cropper-crop-box"\x3e\x3cspan class\x3d"cropper-view-box"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-h"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-v"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-center"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-face"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-e" data-cropper-action\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-n" data-cropper-action\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-w" data-cropper-action\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-s" data-cropper-action\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-e" data-cropper-action\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-n" data-cropper-action\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-w" data-cropper-action\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-s" data-cropper-action\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-ne" data-cropper-action\x3d"ne"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-nw" data-cropper-action\x3d"nw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-sw" data-cropper-action\x3d"sw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-se" data-cropper-action\x3d"se"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e';
sa=sa.querySelector(".".concat("cropper","-container"));var Ea=sa.querySelector(".".concat("cropper","-canvas")),Ba=sa.querySelector(".".concat("cropper","-drag-box")),ya=sa.querySelector(".".concat("cropper","-crop-box")),Ha=ya.querySelector(".".concat("cropper","-face"));this.container=za;this.cropper=sa;this.canvas=Ea;this.dragBox=Ba;this.cropBox=ya;this.viewBox=sa.querySelector(".".concat("cropper","-view-box"));this.face=Ha;Ea.appendChild(oa);c(ea,J);za.insertBefore(sa,ea.nextSibling);this.isImg||
g(oa,R);this.initPreview();this.bind();la.initialAspectRatio=Math.max(0,la.initialAspectRatio)||NaN;la.aspectRatio=Math.max(0,la.aspectRatio)||NaN;la.viewMode=Math.max(0,Math.min(3,Math.round(la.viewMode)))||0;c(ya,J);la.guides||c(ya.getElementsByClassName("".concat("cropper","-dashed")),J);la.center||c(ya.getElementsByClassName("".concat("cropper","-center")),J);la.background&&c(sa,"".concat("cropper","-bg"));la.highlight||c(Ha,W);la.cropBoxMovable&&(c(Ha,ia),f(Ha,ma,"all"));la.cropBoxResizable||
(c(ya.getElementsByClassName("".concat("cropper","-line")),J),c(ya.getElementsByClassName("".concat("cropper","-point")),J));this.render();this.ready=!0;this.setDragMode(la.dragMode);la.autoCrop&&this.crop();this.setData(la.data);r(la.ready)&&p(ea,"ready",la.ready,{once:!0});B(ea,"ready")}}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),g(this.element,J))}},{key:"uncreate",value:function(){this.ready?
(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],q(V.prototype,ca),aa&&q(V,aa),V}();return C(S.prototype,{render:function(){this.initContainer();this.initCanvas();this.initCropBox();this.renderCanvas();this.cropped&&this.renderCropBox()},initContainer:function(){var V=this.element,ca=this.options,aa=this.container,ea=this.cropper;c(ea,J);g(V,J);ca=
{width:Math.max(aa.offsetWidth,Number(ca.minContainerWidth)||200),height:Math.max(aa.offsetHeight,Number(ca.minContainerHeight)||100)};d(ea,{width:(this.containerData=ca).width,height:ca.height});c(V,J);g(ea,J)},initCanvas:function(){var V=this.containerData,ca=this.imageData,aa=this.options.viewMode,ea=90==Math.abs(ca.rotate)%180,la=ea?ca.naturalHeight:ca.naturalWidth,oa=ea?ca.naturalWidth:ca.naturalHeight,za=la/oa;ea=V.width;var sa=V.height;V.height*za>V.width?3===aa?ea=V.height*za:sa=V.width/za:
3===aa?sa=V.width/za:ea=V.height*za;la={aspectRatio:za,naturalWidth:la,naturalHeight:oa,width:ea,height:sa};la.left=(V.width-ea)/2;la.top=(V.height-sa)/2;la.oldLeft=la.left;la.oldTop=la.top;this.canvasData=la;this.limited=1===aa||2===aa;this.limitCanvas(!0,!0);this.initialImageData=C({},ca);this.initialCanvasData=C({},la)},limitCanvas:function(V,ca){var aa=this.options,ea=this.containerData,la=this.canvasData,oa=this.cropBoxData,za=aa.viewMode,sa=la.aspectRatio,Ea=this.cropped&&oa;V&&(V=Number(aa.minCanvasWidth)||
0,aa=Number(aa.minCanvasHeight)||0,1<za?(V=Math.max(V,ea.width),aa=Math.max(aa,ea.height),3===za&&(V<aa*sa?V=aa*sa:aa=V/sa)):0<za&&(V?V=Math.max(V,Ea?oa.width:0):aa?aa=Math.max(aa,Ea?oa.height:0):Ea&&((V=oa.width)<(aa=oa.height)*sa?V=aa*sa:aa=V/sa)),sa=D({aspectRatio:sa,width:V,height:aa}),V=sa.width,aa=sa.height,la.minWidth=V,la.minHeight=aa,la.maxWidth=1/0,la.maxHeight=1/0);ca&&((Ea?0:1)<za?(ca=ea.width-la.width,sa=ea.height-la.height,la.minLeft=Math.min(0,ca),la.minTop=Math.min(0,sa),la.maxLeft=
Math.max(0,ca),la.maxTop=Math.max(0,sa),Ea&&this.limited&&(la.minLeft=Math.min(oa.left,oa.left+(oa.width-la.width)),la.minTop=Math.min(oa.top,oa.top+(oa.height-la.height)),la.maxLeft=oa.left,la.maxTop=oa.top,2===za&&(la.width>=ea.width&&(la.minLeft=Math.min(0,ca),la.maxLeft=Math.max(0,ca)),la.height>=ea.height&&(la.minTop=Math.min(0,sa),la.maxTop=Math.max(0,sa))))):(la.minLeft=-la.width,la.minTop=-la.height,la.maxLeft=ea.width,la.maxTop=ea.height))},renderCanvas:function(V,ca){var aa=this.canvasData,
ea=this.imageData;if(ca){ca=ea.naturalWidth*Math.abs(ea.scaleX||1);var la=ea.naturalHeight*Math.abs(ea.scaleY||1);ea=ea.rotate||0;if(90==(ea=Math.abs(ea)%180))la={width:la,height:ca};else{var oa=ea%90*Math.PI/180,za=Math.sin(oa),sa=Math.cos(oa);oa=ca*sa+la*za;ca=ca*za+la*sa;la=90<ea?{width:ca,height:oa}:{width:oa,height:ca}}ca=la.width;la=la.height;ea=ca/aa.naturalWidth*aa.width;za=la/aa.naturalHeight*aa.height;aa.left-=(ea-aa.width)/2;aa.top-=(za-aa.height)/2;aa.width=ea;aa.height=za;aa.aspectRatio=
ca/la;aa.naturalWidth=ca;aa.naturalHeight=la;this.limitCanvas(!0,!1)}(aa.width>aa.maxWidth||aa.width<aa.minWidth)&&(aa.left=aa.oldLeft);(aa.height>aa.maxHeight||aa.height<aa.minHeight)&&(aa.top=aa.oldTop);aa.width=Math.min(Math.max(aa.width,aa.minWidth),aa.maxWidth);aa.height=Math.min(Math.max(aa.height,aa.minHeight),aa.maxHeight);this.limitCanvas(!1,!0);aa.left=Math.min(Math.max(aa.left,aa.minLeft),aa.maxLeft);aa.top=Math.min(Math.max(aa.top,aa.minTop),aa.maxTop);aa.oldLeft=aa.left;aa.oldTop=aa.top;
d(this.canvas,C({width:aa.width,height:aa.height},x({translateX:aa.left,translateY:aa.top})));this.renderImage(V);this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(V){var ca=this.canvasData,aa=this.imageData,ea=ca.width/ca.naturalWidth*aa.naturalWidth,la=ca.height/ca.naturalHeight*aa.naturalHeight;C(aa,{width:ea,height:la,left:(ca.width-ea)/2,top:(ca.height-la)/2});d(this.image,C({width:aa.width,height:aa.height},x(C({translateX:aa.left,translateY:aa.top},aa))));V&&this.output()},
initCropBox:function(){var V=this.options,ca=this.canvasData,aa=V.aspectRatio||V.initialAspectRatio;V=Number(V.autoCropArea)||.8;var ea={width:ca.width,height:ca.height};aa&&(ca.height*aa>ca.width?ea.height=ea.width/aa:ea.width=ea.height*aa);this.cropBoxData=ea;this.limitCropBox(!0,!0);ea.width=Math.min(Math.max(ea.width,ea.minWidth),ea.maxWidth);ea.height=Math.min(Math.max(ea.height,ea.minHeight),ea.maxHeight);ea.width=Math.max(ea.minWidth,ea.width*V);ea.height=Math.max(ea.minHeight,ea.height*V);
ea.left=ca.left+(ca.width-ea.width)/2;ea.top=ca.top+(ca.height-ea.height)/2;ea.oldLeft=ea.left;ea.oldTop=ea.top;this.initialCropBoxData=C({},ea)},limitCropBox:function(V,ca){var aa=this.options,ea=this.containerData,la=this.canvasData,oa=this.cropBoxData,za=this.limited,sa=aa.aspectRatio;if(V){V=Number(aa.minCropBoxWidth)||0;aa=Number(aa.minCropBoxHeight)||0;var Ea=za?Math.min(ea.width,la.width,la.width+la.left,ea.width-la.left):ea.width,Ba=za?Math.min(ea.height,la.height,la.height+la.top,ea.height-
la.top):ea.height;V=Math.min(V,ea.width);aa=Math.min(aa,ea.height);sa&&(V&&aa?V<aa*sa?aa=V/sa:V=aa*sa:V?aa=V/sa:aa&&(V=aa*sa),Ea<Ba*sa?Ba=Ea/sa:Ea=Ba*sa);oa.minWidth=Math.min(V,Ea);oa.minHeight=Math.min(aa,Ba);oa.maxWidth=Ea;oa.maxHeight=Ba}ca&&(oa.maxTop=za?(oa.minLeft=Math.max(0,la.left),oa.minTop=Math.max(0,la.top),oa.maxLeft=Math.min(ea.width,la.left+la.width)-oa.width,Math.min(ea.height,la.top+la.height)-oa.height):(oa.minLeft=0,oa.minTop=0,oa.maxLeft=ea.width-oa.width,ea.height-oa.height))},
renderCropBox:function(){var V=this.options,ca=this.containerData,aa=this.cropBoxData;(aa.width>aa.maxWidth||aa.width<aa.minWidth)&&(aa.left=aa.oldLeft);(aa.height>aa.maxHeight||aa.height<aa.minHeight)&&(aa.top=aa.oldTop);aa.width=Math.min(Math.max(aa.width,aa.minWidth),aa.maxWidth);aa.height=Math.min(Math.max(aa.height,aa.minHeight),aa.maxHeight);this.limitCropBox(!1,!0);aa.left=Math.min(Math.max(aa.left,aa.minLeft),aa.maxLeft);aa.top=Math.min(Math.max(aa.top,aa.minTop),aa.maxTop);aa.oldLeft=aa.left;
aa.oldTop=aa.top;V.movable&&V.cropBoxMovable&&f(this.face,ma,aa.width>=ca.width&&aa.height>=ca.height?"move":"all");d(this.cropBox,C({width:aa.width,height:aa.height},x({translateX:aa.left,translateY:aa.top})));this.cropped&&this.limited&&this.limitCanvas(!0,!0);this.disabled||this.output()},output:function(){this.preview();B(this.element,"crop",this.getData())}},{initPreview:function(){var V=this.crossOrigin,ca=this.options.preview,aa=V?this.crossOriginUrl:this.url,ea=document.createElement("img");
if(V&&(ea.crossOrigin=V),ea.src=aa,this.viewBox.appendChild(ea),this.viewBoxImage=ea,ca)ea=ca,"string"==typeof ca?ea=this.element.ownerDocument.querySelectorAll(ca):ca.querySelector&&(ea=[ca]),k(this.previews=ea,function(la){var oa=document.createElement("img");f(la,ha,{width:la.offsetWidth,height:la.offsetHeight,html:la.innerHTML});V&&(oa.crossOrigin=V);oa.src=aa;oa.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"';
la.innerHTML="";la.appendChild(oa)})},resetPreview:function(){k(this.previews,function(V){var ca=a(V,ha);d(V,{width:ca.width,height:ca.height});V.innerHTML=ca.html;if(m(V[ha]))try{delete V[ha]}catch(aa){V[ha]=void 0}else if(V.dataset)try{delete V.dataset[ha]}catch(aa){V.dataset[ha]=void 0}else V.removeAttribute("data-".concat(e(ha)))})},preview:function(){var V=this.imageData,ca=this.canvasData,aa=this.cropBoxData,ea=aa.width,la=aa.height,oa=V.width,za=V.height,sa=aa.left-ca.left-V.left,Ea=aa.top-
ca.top-V.top;this.cropped&&!this.disabled&&(d(this.viewBoxImage,C({width:oa,height:za},x(C({translateX:-sa,translateY:-Ea},V)))),k(this.previews,function(Ba){var ya=a(Ba,ha),Ha=ya.width;ya=ya.height;var Na=Ha,Qa=ya,Ra=1;ea&&(Qa=la*(Ra=Ha/ea));la&&ya<Qa&&(Na=ea*(Ra=ya/la),Qa=ya);d(Ba,{width:Na,height:Qa});d(Ba.getElementsByTagName("img")[0],C({width:oa*Ra,height:za*Ra},x(C({translateX:-sa*Ra,translateY:-Ea*Ra},V))))}))}},{bind:function(){var V=this.element,ca=this.options,aa=this.cropper;r(ca.cropstart)&&
p(V,"cropstart",ca.cropstart);r(ca.cropmove)&&p(V,"cropmove",ca.cropmove);r(ca.cropend)&&p(V,"cropend",ca.cropend);r(ca.crop)&&p(V,"crop",ca.crop);r(ca.zoom)&&p(V,"zoom",ca.zoom);p(aa,xa,this.onCropStart=this.cropStart.bind(this));ca.zoomable&&ca.zoomOnWheel&&p(aa,"wheel",this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0});ca.toggleDragModeOnDblclick&&p(aa,"dblclick",this.onDblclick=this.dblclick.bind(this));p(V.ownerDocument,ua,this.onCropMove=this.cropMove.bind(this));p(V.ownerDocument,
na,this.onCropEnd=this.cropEnd.bind(this));ca.responsive&&p(window,"resize",this.onResize=this.resize.bind(this))},unbind:function(){var V=this.element,ca=this.options,aa=this.cropper;r(ca.cropstart)&&h(V,"cropstart",ca.cropstart);r(ca.cropmove)&&h(V,"cropmove",ca.cropmove);r(ca.cropend)&&h(V,"cropend",ca.cropend);r(ca.crop)&&h(V,"crop",ca.crop);r(ca.zoom)&&h(V,"zoom",ca.zoom);h(aa,xa,this.onCropStart);ca.zoomable&&ca.zoomOnWheel&&h(aa,"wheel",this.onWheel,{passive:!1,capture:!0});ca.toggleDragModeOnDblclick&&
h(aa,"dblclick",this.onDblclick);h(V.ownerDocument,ua,this.onCropMove);h(V.ownerDocument,na,this.onCropEnd);ca.responsive&&h(window,"resize",this.onResize)}},{resize:function(){var V=this.options,ca=this.container,aa=this.containerData,ea=Number(V.minContainerWidth)||200,la=Number(V.minContainerHeight)||100;if(!(this.disabled||aa.width<=ea||aa.height<=la)){var oa,za,sa=ca.offsetWidth/aa.width;if(1!==sa||ca.offsetHeight!==aa.height)V.restore&&(oa=this.getCanvasData(),za=this.getCropBoxData()),this.render(),
V.restore&&(this.setCanvasData(k(oa,function(Ea,Ba){oa[Ba]=Ea*sa})),this.setCropBoxData(k(za,function(Ea,Ba){za[Ba]=Ea*sa})))}},dblclick:function(){var V;this.disabled||"none"===this.options.dragMode||this.setDragMode((V=this.dragBox,(V.classList?V.classList.contains(Q):-1<V.className.indexOf(Q))?"move":"crop"))},wheel:function(V){var ca=this,aa=Number(this.options.wheelZoomRatio)||.1,ea=1;this.disabled||(V.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(function(){ca.wheeling=!1},50),
V.deltaY?ea=0<V.deltaY?1:-1:V.wheelDelta?ea=-V.wheelDelta/120:V.detail&&(ea=0<V.detail?1:-1),this.zoom(-ea*aa,V)))},cropStart:function(V){var ca=V.buttons,aa=V.button;if(!(this.disabled||w(ca)&&1!==ca||w(aa)&&0!==aa||V.ctrlKey)){ca=this.options;var ea=this.pointers;V.changedTouches?k(V.changedTouches,function(la){ea[la.identifier]=y(la)}):ea[V.pointerId||0]=y(V);ca=1<Object.keys(ea).length&&ca.zoomable&&ca.zoomOnTouch?"zoom":a(V.target,ma);va.test(ca)&&!1!==B(this.element,"cropstart",{originalEvent:V,
action:ca})&&(V.preventDefault(),this.action=ca,this.cropping=!1,"crop"===ca&&(this.cropping=!0,c(this.dragBox,X)))}},cropMove:function(V){var ca=this.action;if(!this.disabled&&ca){var aa=this.pointers;V.preventDefault();!1!==B(this.element,"cropmove",{originalEvent:V,action:ca})&&(V.changedTouches?k(V.changedTouches,function(ea){C(aa[ea.identifier]||{},y(ea,!0))}):C(aa[V.pointerId||0]||{},y(V,!0)),this.change(V))}},cropEnd:function(V){if(!this.disabled){var ca=this.action,aa=this.pointers;V.changedTouches?
k(V.changedTouches,function(ea){delete aa[ea.identifier]}):delete aa[V.pointerId||0];ca&&(V.preventDefault(),Object.keys(aa).length||(this.action=""),this.cropping&&(this.cropping=!1,b(this.dragBox,X,this.cropped&&this.options.modal)),B(this.element,"cropend",{originalEvent:V,action:ca}))}}},{change:function(V){var ca=this.canvasData,aa=this.containerData,ea=this.cropBoxData,la=this.pointers,oa=this.action,za=this.options.aspectRatio,sa=ea.left,Ea=ea.top,Ba=ea.width,ya=ea.height,Ha=sa+Ba,Na=Ea+ya,
Qa=0,Ra=0,Ia=aa.width,Xa=aa.height,Va=!0;!za&&V.shiftKey&&(za=Ba&&ya?Ba/ya:1);this.limited&&(Qa=ea.minLeft,Ra=ea.minTop,Ia=Qa+Math.min(aa.width,ca.width,ca.left+ca.width),Xa=Ra+Math.min(aa.height,ca.height,ca.top+ca.height));var gb,ab;ca=la[Object.keys(la)[0]];var Ma=ca.endX-ca.startX,Ka=ca.endY-ca.startY;aa=function(Wa){switch(Wa){case "e":Ha+Ma>Ia&&(Ma=Ia-Ha);break;case "w":sa+Ma<Qa&&(Ma=Qa-sa);break;case "n":Ea+Ka<Ra&&(Ka=Ra-Ea);break;case "s":Na+Ka>Xa&&(Ka=Xa-Na)}};switch(oa){case "all":sa+=Ma;
Ea+=Ka;break;case "e":if(0<=Ma&&(Ia<=Ha||za&&(Ea<=Ra||Xa<=Na))){Va=!1;break}aa("e");0>(Ba+=Ma)&&(oa="w",sa-=Ba=-Ba);za&&(ya=Ba/za,Ea+=(ea.height-ya)/2);break;case "n":if(0>=Ka&&(Ea<=Ra||za&&(sa<=Qa||Ia<=Ha))){Va=!1;break}aa("n");ya-=Ka;Ea+=Ka;0>ya&&(oa="s",Ea-=ya=-ya);za&&(Ba=ya*za,sa+=(ea.width-Ba)/2);break;case "w":if(0>=Ma&&(sa<=Qa||za&&(Ea<=Ra||Xa<=Na))){Va=!1;break}aa("w");Ba-=Ma;sa+=Ma;0>Ba&&(oa="e",sa-=Ba=-Ba);za&&(ya=Ba/za,Ea+=(ea.height-ya)/2);break;case "s":if(0<=Ka&&(Xa<=Na||za&&(sa<=Qa||
Ia<=Ha))){Va=!1;break}aa("s");0>(ya+=Ka)&&(oa="n",Ea-=ya=-ya);za&&(Ba=ya*za,sa+=(ea.width-Ba)/2);break;case "ne":if(za){if(0>=Ka&&(Ea<=Ra||Ia<=Ha)){Va=!1;break}aa("n");ya-=Ka;Ea+=Ka;Ba=ya*za}else aa("n"),aa("e"),0<=Ma?Ha<Ia?Ba+=Ma:0>=Ka&&Ea<=Ra&&(Va=!1):Ba+=Ma,0>=Ka?Ra<Ea&&(ya-=Ka,Ea+=Ka):(ya-=Ka,Ea+=Ka);0>Ba&&0>ya?(oa="sw",Ea-=ya=-ya,sa-=Ba=-Ba):0>Ba?(oa="nw",sa-=Ba=-Ba):0>ya&&(oa="se",Ea-=ya=-ya);break;case "nw":if(za){if(0>=Ka&&(Ea<=Ra||sa<=Qa)){Va=!1;break}aa("n");ya-=Ka;Ea+=Ka;Ba=ya*za;sa+=ea.width-
Ba}else aa("n"),aa("w"),0>=Ma?Qa<sa?(Ba-=Ma,sa+=Ma):0>=Ka&&Ea<=Ra&&(Va=!1):(Ba-=Ma,sa+=Ma),0>=Ka?Ra<Ea&&(ya-=Ka,Ea+=Ka):(ya-=Ka,Ea+=Ka);0>Ba&&0>ya?(oa="se",Ea-=ya=-ya,sa-=Ba=-Ba):0>Ba?(oa="ne",sa-=Ba=-Ba):0>ya&&(oa="sw",Ea-=ya=-ya);break;case "sw":if(za){if(0>=Ma&&(sa<=Qa||Xa<=Na)){Va=!1;break}aa("w");Ba-=Ma;sa+=Ma;ya=Ba/za}else aa("s"),aa("w"),0>=Ma?Qa<sa?(Ba-=Ma,sa+=Ma):0<=Ka&&Xa<=Na&&(Va=!1):(Ba-=Ma,sa+=Ma),0<=Ka?Na<Xa&&(ya+=Ka):ya+=Ka;0>Ba&&0>ya?(oa="ne",Ea-=ya=-ya,sa-=Ba=-Ba):0>Ba?(oa="se",sa-=
Ba=-Ba):0>ya&&(oa="nw",Ea-=ya=-ya);break;case "se":if(za){if(0<=Ma&&(Ia<=Ha||Xa<=Na)){Va=!1;break}aa("e");ya=(Ba+=Ma)/za}else aa("s"),aa("e"),0<=Ma?Ha<Ia?Ba+=Ma:0<=Ka&&Xa<=Na&&(Va=!1):Ba+=Ma,0<=Ka?Na<Xa&&(ya+=Ka):ya+=Ka;0>Ba&&0>ya?(oa="nw",Ea-=ya=-ya,sa-=Ba=-Ba):0>Ba?(oa="sw",sa-=Ba=-Ba):0>ya&&(oa="ne",Ea-=ya=-ya);break;case "move":this.move(Ma,Ka);Va=!1;break;case "zoom":this.zoom((gb=C({},la),ab=[],k(la,function(Wa,lb){delete gb[lb];k(gb,function(Ua){var La=Math.abs(Wa.startX-Ua.startX),cb=Math.abs(Wa.startY-
Ua.startY),hb=Math.abs(Wa.endX-Ua.endX);Ua=Math.abs(Wa.endY-Ua.endY);La=Math.sqrt(La*La+cb*cb);ab.push((Math.sqrt(hb*hb+Ua*Ua)-La)/La)})}),ab.sort(function(Wa,lb){return Math.abs(Wa)<Math.abs(lb)}),ab[0]),V);Va=!1;break;case "crop":Ma&&Ka?(V=u(this.cropper),sa=ca.startX-V.left,Ea=ca.startY-V.top,Ba=ea.minWidth,ya=ea.minHeight,0<Ma?oa=0<Ka?"se":"ne":0>Ma&&(sa-=Ba,oa=0<Ka?"sw":"nw"),0>Ka&&(Ea-=ya),this.cropped||(g(this.cropBox,J),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))):Va=!1}Va&&(ea.width=
Ba,ea.height=ya,ea.left=sa,ea.top=Ea,this.action=oa,this.renderCropBox());k(la,function(Wa){Wa.startX=Wa.endX;Wa.startY=Wa.endY})}},{crop:function(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&c(this.dragBox,X),g(this.cropBox,J),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=C({},this.initialImageData),this.canvasData=C({},this.initialCanvasData),this.cropBoxData=
C({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(C(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),g(this.dragBox,X),c(this.cropBox,J)),this},replace:function(V){var ca=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&V&&(this.isImg&&(this.element.src=V),ca?(this.url=V,this.image.src=V,this.ready&&
(this.viewBoxImage.src=V,k(this.previews,function(aa){aa.getElementsByTagName("img")[0].src=V}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(V))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,g(this.cropper,da)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,c(this.cropper,da)),this},destroy:function(){var V=this.element;return V.cropper&&(V.cropper=void 0,this.isImg&&this.replaced&&(V.src=this.originalUrl),
this.uncreate()),this},move:function(V){var ca=1<arguments.length&&void 0!==arguments[1]?arguments[1]:V,aa=this.canvasData,ea=aa.left;aa=aa.top;return this.moveTo(void 0===V?V:ea+Number(V),void 0===ca?ca:aa+Number(ca))},moveTo:function(V){var ca=1<arguments.length&&void 0!==arguments[1]?arguments[1]:V,aa=this.canvasData,ea=!1;return V=Number(V),ca=Number(ca),this.ready&&!this.disabled&&this.options.movable&&(w(V)&&(aa.left=V,ea=!0),w(ca)&&(aa.top=ca,ea=!0),ea&&this.renderCanvas(!0)),this},zoom:function(V,
ca){var aa=this.canvasData;return V=0>(V=Number(V))?1/(1-V):1+V,this.zoomTo(aa.width*V/aa.naturalWidth,null,ca)},zoomTo:function(V,ca,aa){var ea,la,oa,za=this.options,sa=this.canvasData,Ea=sa.width,Ba=sa.height,ya=sa.naturalWidth,Ha=sa.naturalHeight;if(0<=(V=Number(V))&&this.ready&&!this.disabled&&za.zoomable){za=ya*V;Ha*=V;if(!1===B(this.element,"zoom",{ratio:V,oldRatio:Ea/ya,originalEvent:aa}))return this;aa?(V=this.pointers,ca=u(this.cropper),ya=V&&Object.keys(V).length?(oa=la=ea=0,k(V,function(Na){var Qa=
Na.startY;ea+=Na.startX;la+=Qa;oa+=1}),{pageX:ea/=oa,pageY:la/=oa}):{pageX:aa.pageX,pageY:aa.pageY},sa.left-=(ya.pageX-ca.left-sa.left)/Ea*(za-Ea),sa.top-=(ya.pageY-ca.top-sa.top)/Ba*(Ha-Ba)):v(ca)&&w(ca.x)&&w(ca.y)?(sa.left-=(ca.x-sa.left)/Ea*(za-Ea),sa.top-=(ca.y-sa.top)/Ba*(Ha-Ba)):(sa.left-=(za-Ea)/2,sa.top-=(Ha-Ba)/2);sa.width=za;sa.height=Ha;this.renderCanvas(!0)}return this},rotate:function(V){return this.rotateTo((this.imageData.rotate||0)+Number(V))},rotateTo:function(V){return w(V=Number(V))&&
this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=V%360,this.renderCanvas(!0,!0)),this},scaleX:function(V){var ca=this.imageData.scaleY;return this.scale(V,w(ca)?ca:1)},scaleY:function(V){var ca=this.imageData.scaleX;return this.scale(w(ca)?ca:1,V)},scale:function(V){var ca=1<arguments.length&&void 0!==arguments[1]?arguments[1]:V,aa=this.imageData,ea=!1;return V=Number(V),ca=Number(ca),this.ready&&!this.disabled&&this.options.scalable&&(w(V)&&(aa.scaleX=V,ea=!0),w(ca)&&(aa.scaleY=
ca,ea=!0),ea&&this.renderCanvas(!0,!0)),this},getData:function(){var V=0<arguments.length&&void 0!==arguments[0]&&arguments[0],ca=this.options,aa=this.imageData,ea=this.canvasData,la=this.cropBoxData;if(this.ready&&this.cropped){var oa={x:la.left-ea.left,y:la.top-ea.top,width:la.width,height:la.height};var za=aa.width/aa.naturalWidth;if(k(oa,function(sa,Ea){oa[Ea]=sa/za}),V)V=Math.round(oa.y+oa.height),ea=Math.round(oa.x+oa.width),oa.x=Math.round(oa.x),oa.y=Math.round(oa.y),oa.width=ea-oa.x,oa.height=
V-oa.y}else oa={x:0,y:0,width:0,height:0};return ca.rotatable&&(oa.rotate=aa.rotate||0),ca.scalable&&(oa.scaleX=aa.scaleX||1,oa.scaleY=aa.scaleY||1),oa},setData:function(V){var ca=this.options,aa=this.imageData,ea=this.canvasData,la={};if(this.ready&&!this.disabled&&v(V)){var oa=!1;ca.rotatable&&w(V.rotate)&&V.rotate!==aa.rotate&&(aa.rotate=V.rotate,oa=!0);ca.scalable&&(w(V.scaleX)&&V.scaleX!==aa.scaleX&&(aa.scaleX=V.scaleX,oa=!0),w(V.scaleY)&&V.scaleY!==aa.scaleY&&(aa.scaleY=V.scaleY,oa=!0));oa&&
this.renderCanvas(!0,!0);ca=aa.width/aa.naturalWidth;w(V.x)&&(la.left=V.x*ca+ea.left);w(V.y)&&(la.top=V.y*ca+ea.top);w(V.width)&&(la.width=V.width*ca);w(V.height)&&(la.height=V.height*ca);this.setCropBoxData(la)}return this},getContainerData:function(){return this.ready?C({},this.containerData):{}},getImageData:function(){return this.sized?C({},this.imageData):{}},getCanvasData:function(){var V=this.canvasData,ca={};return this.ready&&k("left top width height naturalWidth naturalHeight".split(" "),
function(aa){ca[aa]=V[aa]}),ca},setCanvasData:function(V){var ca=this.canvasData,aa=ca.aspectRatio;return this.ready&&!this.disabled&&v(V)&&(w(V.left)&&(ca.left=V.left),w(V.top)&&(ca.top=V.top),w(V.width)?(ca.width=V.width,ca.height=V.width/aa):w(V.height)&&(ca.height=V.height,ca.width=V.height*aa),this.renderCanvas(!0)),this},getCropBoxData:function(){var V,ca=this.cropBoxData;return this.ready&&this.cropped&&(V={left:ca.left,top:ca.top,width:ca.width,height:ca.height}),V||{}},setCropBoxData:function(V){var ca,
aa,ea=this.cropBoxData,la=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&v(V)&&(w(V.left)&&(ea.left=V.left),w(V.top)&&(ea.top=V.top),w(V.width)&&V.width!==ea.width&&(ca=!0,ea.width=V.width),w(V.height)&&V.height!==ea.height&&(aa=!0,ea.height=V.height),la&&(ca?ea.height=ea.width/la:aa&&(ea.width=ea.height*la)),this.renderCropBox()),this},getCroppedCanvas:function(){var V=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;
var ca,aa,ea,la,oa,za,sa,Ea,Ba,ya,Ha,Na,Qa,Ra,Ia,Xa,Va,gb,ab,Ma,Ka,Wa,lb,Ua,La,cb,hb,Lb,xb,jb,yb,Mb,Eb,pb,Nb,Ob,Fb,Gb,Hb,bb=this.canvasData,ub=(ca=this.image,aa=this.imageData,ea=aa.aspectRatio,la=aa.naturalWidth,oa=aa.naturalHeight,za=aa.rotate,sa=void 0===za?0:za,Ea=aa.scaleX,Ba=void 0===Ea?1:Ea,ya=aa.scaleY,Ha=void 0===ya?1:ya,Na=bb.aspectRatio,Qa=bb.naturalWidth,Ra=bb.naturalHeight,Ia=V.fillColor,Xa=void 0===Ia?"transparent":Ia,Va=V.imageSmoothingEnabled,gb=void 0===Va||Va,ab=V.imageSmoothingQuality,
Ma=void 0===ab?"low":ab,Ka=V.maxWidth,Wa=void 0===Ka?1/0:Ka,lb=V.maxHeight,Ua=void 0===lb?1/0:lb,La=V.minWidth,cb=void 0===La?0:La,hb=V.minHeight,Lb=void 0===hb?0:hb,xb=document.createElement("canvas"),jb=xb.getContext("2d"),yb=D({aspectRatio:Na,width:Wa,height:Ua}),Mb=D({aspectRatio:Na,width:cb,height:Lb},"cover"),Eb=Math.min(yb.width,Math.max(Mb.width,Qa)),pb=Math.min(yb.height,Math.max(Mb.height,Ra)),Nb=D({aspectRatio:ea,width:Wa,height:Ua}),Ob=D({aspectRatio:ea,width:cb,height:Lb},"cover"),Fb=
Math.min(Nb.width,Math.max(Ob.width,la)),Gb=Math.min(Nb.height,Math.max(Ob.height,oa)),Hb=[-Fb/2,-Gb/2,Fb,Gb],xb.width=n(Eb),xb.height=n(pb),jb.fillStyle=Xa,jb.fillRect(0,0,Eb,pb),jb.save(),jb.translate(Eb/2,pb/2),jb.rotate(sa*Math.PI/180),jb.scale(Ba,Ha),jb.imageSmoothingEnabled=gb,jb.imageSmoothingQuality=Ma,jb.drawImage.apply(jb,[ca].concat(A(Hb.map(function(mb){return Math.floor(n(mb))})))),jb.restore(),xb);if(!this.cropped)return ub;ea=this.getData();la=ea.x;aa=ea.y;ca=ea.width;ea=ea.height;
bb=ub.width/Math.floor(bb.naturalWidth);1!==bb&&(la*=bb,aa*=bb,ca*=bb,ea*=bb);sa=ca/ea;oa=D({aspectRatio:sa,width:V.maxWidth||1/0,height:V.maxHeight||1/0});za=D({aspectRatio:sa,width:V.minWidth||0,height:V.minHeight||0},"cover");sa=D({aspectRatio:sa,width:V.width||(1!==bb?ub.width:ca),height:V.height||(1!==bb?ub.height:ea)});bb=sa.width;sa=sa.height;bb=Math.min(oa.width,Math.max(za.width,bb));sa=Math.min(oa.height,Math.max(za.height,sa));oa=document.createElement("canvas");za=oa.getContext("2d");
oa.width=n(bb);oa.height=n(sa);za.fillStyle=V.fillColor||"transparent";za.fillRect(0,0,bb,sa);sa=V.imageSmoothingEnabled;V=V.imageSmoothingQuality;za.imageSmoothingEnabled=void 0===sa||sa;V&&(za.imageSmoothingQuality=V);var qb,kb,Ib,zb,Ab,Bb;V=ub.width;sa=ub.height;la<=-ca||V<la?Ab=Ib=qb=la=0:0>=la?(Ib=-la,la=0,Ab=qb=Math.min(V,ca+la)):la<=V&&(Ib=0,Ab=qb=Math.min(ca,V-la));0>=qb||aa<=-ea||sa<aa?Bb=zb=kb=aa=0:0>=aa?(zb=-aa,aa=0,Bb=kb=Math.min(sa,ea+aa)):aa<=sa&&(zb=0,Bb=kb=Math.min(ea,sa-aa));qb=[la,
aa,qb,kb];0<Ab&&0<Bb&&(kb=bb/ca,qb.push(Ib*kb,zb*kb,Ab*kb,Bb*kb));return za.drawImage.apply(za,[ub].concat(A(qb.map(function(mb){return Math.floor(n(mb))})))),oa},setAspectRatio:function(V){var ca=this.options;return this.disabled||void 0===V||(ca.aspectRatio=Math.max(0,V)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(V){var ca=this.options,aa=this.dragBox,ea=this.face;if(this.ready&&!this.disabled){var la="crop"===V,oa=ca.movable&&"move"===V;
V=la||oa?V:"none";ca.dragMode=V;f(aa,ma,V);b(aa,Q,la);b(aa,ia,oa);ca.cropBoxMovable||(f(ea,ma,V),b(ea,Q,la),b(ea,ia,oa))}return this}}),S})},"xstyle/css":function(){define(["require"],function(E){function q(A,w,m){var v=document.documentElement;A=v.insertBefore(document.createElement(A),v.firstChild);A.id=w;w=(A.currentStyle||getComputedStyle(A,null)||{})[m];v.removeChild(A);return w}return{load:function(A,w,m,v){function r(d){var c=q("x-parse",null,"content"),g=d&&(d.sheet||d.styleSheet);c&&"none"!=
c&&"normal"!=c?w([eval(c)],function(b){d?b.process(d,m):(b.processAll(),m(g))}):m(g)}var l=w.toUrl(A);if(l.match(/!$/)){var k={wait:!1};l=l.slice(0,-1)}var n=w.cache&&w.cache["url:"+l];if(null!=n)n.xCss&&(n=n.cssText),"string"==typeof n?E(["./core/load-css"],function(d){r(d.insertCss(n))}):r();else{if("none"==q("div",A.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return r();E(["./core/load-css"],function(d){d(l,r,k)})}}}})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/keys dojo/_base/Color dijit/TooltipDialog dijit/popup jimu/dijit/ColorSelector jimu/utils".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c){return E([q,A],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:'\x3cdiv role\x3d"button" tabindex\x3d"0"data-dojo-attach-event\x3d"onclick:_domNodeClick,onkeydown:_domNodeKeydown" aria-pressed\x3d"false"\x3e\x3c/div\x3e',_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?
this.color instanceof l||(this.color=new l(this.color)):this.color=new l("#ccc");m.setStyle(this.domNode,"backgroundColor",this.color.toHex());this.showLabel&&this._changeLabel(this.color);this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){n.close(this.tooltipDialog);this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(g){var b=this.tooltipDialog.domNode;return g===b||m.isDescendant(g,b)},hideTooltipDialog:function(){this._hideTooltipDialog()},
_showTooltipDialog:function(){n.open({parent:this.getParent(),popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=!0;this.picker.cursorNode.focus()},_hideTooltipDialog:function(){this._isTooltipDialogOpened=!1;this.onClose();n.close(this.tooltipDialog)},_createTooltipDialog:function(){var g=m.create("div");this.tooltipDialog=new k({content:g});m.addClass(this.tooltipDialog.domNode,"jimu-color-picker-dialog");this.own(v(this.tooltipDialog.domNode,"keydown",w.hitch(this,function(a){a.keyCode===
r.ESCAPE&&(this._hideTooltipDialog(),this.domNode.focus(),m.setAttr(this.domNode,"aria-pressed","false"))})));var b=new d({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:w.hitch(this,function(a){this.ensureMode||(a=new l(a),this.setColor(a))})});b.placeAt(g);b.startup();if(this.ensureMode){var e=m.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-trailing",title:this.nls.cancel,innerHTML:this.nls.cancel},g);this.own(v(e,"click",w.hitch(this,
function(){this._hideTooltipDialog()})));"undefined"===typeof this.showOk&&(e=m.create("div",{"class":"jimu-btn jimu-float-trailing ok",title:this.nls.ok,innerHTML:this.nls.ok},g),this.own(v(e,"click",w.hitch(this,function(){var a=this.picker.get("value");this.setColor(new l(a));this._hideTooltipDialog()}))));g=m.create("div",{"class":"jimu-btn jimu-float-trailing",title:this.nls.apply,innerHTML:this.nls.apply},g);this.own(v(g,"click",w.hitch(this,function(){var a=this.picker.get("value");this.setColor(new l(a))})))}this.own(v(document.body,
"click",w.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=b},_domNodeClick:function(g){g.stopPropagation();g.preventDefault();this._isTooltipDialogOpened?(this._hideTooltipDialog(),m.setAttr(this.domNode,"aria-pressed","false")):(this._showTooltipDialog(),m.setAttr(this.domNode,"aria-pressed","true"))},_domNodeKeydown:function(g){g.keyCode!==r.ENTER&&g.keyCode!==r.SPACE||this._domNodeClick(g)},setColor:function(g,b){if(g instanceof l){var e=
this.color,a="";e&&(a=e.toHex());e=g.toHex();this.color=g;m.setStyle(this.domNode,"backgroundColor",e);if(a!==e&&(this.picker.set("value",e),!1!==b))this.onChange(new l(e))}},getColor:function(){return this.color},_changeLabel:function(g){m.empty(this.domNode);m.create("span",{innerHTML:g.toHex(),className:"color-label",style:{color:c.invertColor(g.toHex())}},this.domNode)},onChange:function(g){this.showLabel&&this._changeLabel(g)},onClose:function(){},getPopup:function(){return this.tooltipDialog||
null},setLabel:function(g){m.empty(this.domNode);m.create("span",{innerHTML:g||"",className:"text-label"},this.domNode)},isTooltipDialogOpened:function(){return this._isTooltipDialogOpened}})})},"jimu/dijit/ColorSelector":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dojox/widget/ColorPicker dijit/_base/focus dojo/fx dojo/_base/lang dojo/_base/html dojo/sniff".split(" "),function(E,q,A,w,m,v,r,l,k){return q([A,w,E],{baseClass:"jimu-color-selector",declaredClass:"jimu.dijit.ColorSelector",
_setPoint:function(n){n&&m.focus(n.target);if(!this._CURSOR_WIDTH||!this._CURSOR_HEIGHT){var d=l.getMarginBox(this.cursorNode);d.w&&d.h&&(this._CURSOR_WIDTH=d.w/2,this._CURSOR_HEIGHT=d.h/2)}this._BORDER_WIDTH&&this._BORDER_HEIGHT||(d=l.getBorderExtents(n.target||n.srcElement),d.w&&d.h&&(this._BORDER_WIDTH=d.w,this._BORDER_HEIGHT=d.h));var c=d=0;k("ff")||k("ie")||k("MSIE")?(d=n.offsetX,c=n.offsetY):n.offsetX&&n.offsetY&&(d=n.offsetX+this._BORDER_WIDTH,c=n.offsetY+this._BORDER_HEIGHT);n=c-this._CURSOR_HEIGHT;
d-=this._CURSOR_WIDTH;this.animatePoint?v.slideTo({node:this.cursorNode,duration:this.slideDuration,top:n,left:d,onEnd:r.hitch(this,function(){this._updateColor(!0);m.focus(this.cursorNode)})}).play():(l.style(this.cursorNode,{left:d+"px",top:n+"px"}),this._updateColor(!0))},_setHuePoint:function(n){n=n.offsetY-this.PICKER_HUE_SELECTOR_H/2;this.animatePoint?v.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:n,left:0,onEnd:r.hitch(this,function(){this._updateColor(!0);m.focus(this.hueCursorNode)})}).play():
(l.style(this.hueCursorNode,"top",n+"px"),this._updateColor(!0))}})})},"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u,t,z){E.experimental("dojox.widget.ColorPicker");return q("dojox.widget.ColorPicker",f,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),
_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:z,postMixInProperties:function(){d.contains(l.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=e.getUniqueId(this.id);A.mixin(this,B.getLocalization("dojox.widget","ColorPicker"));A.mixin(this,B.getLocalization("dojo.cldr",
"number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);7>r("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility=
"hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),this._mover=new b.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new b.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(v.subscribe("/dnd/move/stop",A.hitch(this,"_clearTimer"))),this._subs.push(v.subscribe("/dnd/move/start",
A.hitch(this,"_setTimer"))),this._keyListeners=[],this._connects.push(h.addKeyListener(this.hueCursorNode,{charOrCode:c.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,A.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(h.addKeyListener(this.hueCursorNode,{charOrCode:c.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,A.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(h.addKeyListener(this.cursorNode,{charOrCode:c.UP_ARROW,shiftKey:!1,metaKey:!1,
ctrlKey:!1,altKey:!1},this,A.hitch(this,this._updateCursorNode),25,25)),this._connects.push(h.addKeyListener(this.cursorNode,{charOrCode:c.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,A.hitch(this,this._updateCursorNode),25,25)),this._connects.push(h.addKeyListener(this.cursorNode,{charOrCode:c.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,A.hitch(this,this._updateCursorNode),25,25)),this._connects.push(h.addKeyListener(this.cursorNode,{charOrCode:c.RIGHT_ARROW,shiftKey:!1,
metaKey:!1,ctrlKey:!1,altKey:!1},this,A.hitch(this,this._updateCursorNode),25,25)))},_setValueAttr:function(x,y){this._started&&this.setColor(x,y)},setColor:function(x,y){x=p.fromString(x);this._updatePickerLocations(x);this._updateColorInputs(x);this._updateValue(x,y)},_setTimer:function(x){if(x.node==this.cursorNode||x.node==this.hueCursorNode)a.focus(x.node),n.setSelectable(this.domNode,!1),this._timer=setInterval(A.hitch(this,"_updateColor"),45)},_clearTimer:function(x){this._timer&&(clearInterval(this._timer),
this._timer=null,this.onChange(this.value),n.setSelectable(this.domNode,!0))},_setHue:function(x){m.style(this.colorUnderlay,"backgroundColor",p.fromHsv(x,100,100).toHex())},_updateHueCursorNode:function(x,y,D){if(-1!==x){x=m.style(this.hueCursorNode,"top");y=this.PICKER_HUE_SELECTOR_H/2;x+=y;var H=!1;D.charOrCode==c.UP_ARROW?0<x&&(--x,H=!0):D.charOrCode==c.DOWN_ARROW&&x<this.PICKER_HUE_H&&(x+=1,H=!0);H&&m.style(this.hueCursorNode,"top",x-y+"px")}else this._updateColor(!0)},_updateCursorNode:function(x,
y,D){y=this.PICKER_SAT_SELECTOR_H/2;var H=this.PICKER_SAT_SELECTOR_W/2;if(-1!==x){x=m.style(this.cursorNode,"top");var I=m.style(this.cursorNode,"left");x+=y;I+=H;var N=!1;D.charOrCode==c.UP_ARROW?0<x&&(--x,N=!0):D.charOrCode==c.DOWN_ARROW?x<this.PICKER_SAT_VAL_H&&(x+=1,N=!0):D.charOrCode==c.LEFT_ARROW?0<I&&(--I,N=!0):D.charOrCode==c.RIGHT_ARROW&&I<this.PICKER_SAT_VAL_W&&(I+=1,N=!0);N&&(I-=H,m.style(this.cursorNode,"top",x-y+"px"),m.style(this.cursorNode,"left",I+"px"))}else this._updateColor(!0)},
_updateColor:function(x){var y=this.PICKER_HUE_SELECTOR_H/2,D=this.PICKER_SAT_SELECTOR_H/2,H=this.PICKER_SAT_SELECTOR_W/2;y=m.style(this.hueCursorNode,"top")+y;D=m.style(this.cursorNode,"top")+D;H=m.style(this.cursorNode,"left")+H;y=Math.round(360-y/this.PICKER_HUE_H*360);H=p.fromHsv(y,H/this.PICKER_SAT_VAL_W*100,100-D/this.PICKER_SAT_VAL_H*100);this._updateColorInputs(H);this._updateValue(H,x);y!=this._hue&&this._setHue(y)},_colorInputChange:function(x){var y=!1;switch(x.target){case this.hexCode:var D=
p.fromString(x.target.value);y=!0;break;case this.Rval:case this.Gval:case this.Bval:D=p.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);y=!0;break;case this.Hval:case this.Sval:case this.Vval:D=p.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),y=!0}y&&(this._updatePickerLocations(D),this._updateColorInputs(D),this._updateValue(D,!0))},_updateValue:function(x,y){x=x.toHex();this.value=this.valueNode.value=x;if(y&&(!this._timer||this.liveUpdate))this.onChange(x)},_updatePickerLocations:function(x){var y=
this.PICKER_HUE_SELECTOR_H/2,D=this.PICKER_SAT_SELECTOR_H/2,H=this.PICKER_SAT_SELECTOR_W/2;x=x.toHsv();y=Math.round(this.PICKER_HUE_H-x.h/360*this.PICKER_HUE_H)-y;H=Math.round(x.s/100*this.PICKER_SAT_VAL_W)-H;D=Math.round(this.PICKER_SAT_VAL_H-x.v/100*this.PICKER_SAT_VAL_H)-D;this.animatePoint?(g.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:y,left:0}).play(),g.slideTo({node:this.cursorNode,duration:this.slideDuration,top:D,left:H}).play()):(m.style(this.hueCursorNode,"top",y+"px"),
m.style(this.cursorNode,{left:H+"px",top:D+"px"}));x.h!=this._hue&&this._setHue(x.h)},_updateColorInputs:function(x){var y=x.toHex();this.showRgb&&(this.Rval.value=x.r,this.Gval.value=x.g,this.Bval.value=x.b);this.showHsv&&(x=x.toHsv(),this.Hval.value=Math.round(x.h),this.Sval.value=Math.round(x.s),this.Vval.value=Math.round(x.v));this.showHex&&(this.hexCode.value=y);this.previewNode.style.backgroundColor=y;this.webSafe&&(this.safePreviewNode.style.backgroundColor=y)},_setHuePoint:function(x){var y=
this.PICKER_HUE_SELECTOR_H/2;x=x.layerY||x.y-x.target.getBoundingClientRect().top;x-=y;this.animatePoint?g.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:x,left:0,onEnd:A.hitch(this,function(){this._updateColor(!0);a.focus(this.hueCursorNode)})}).play():(m.style(this.hueCursorNode,"top",x+"px"),this._updateColor(!0))},_setPoint:function(x){var y=this.PICKER_SAT_SELECTOR_H/2,D=this.PICKER_SAT_SELECTOR_W/2,H=x.layerY||x.y-x.target.getBoundingClientRect().top;H-=y;y=x.layerX||x.x-x.target.getBoundingClientRect().left;
y-=D;x&&a.focus(x.target);this.animatePoint?g.slideTo({node:this.cursorNode,duration:this.slideDuration,top:H,left:y,onEnd:A.hitch(this,function(){this._updateColor(!0);a.focus(this.cursorNode)})}).play():(m.style(this.cursorNode,{left:y+"px",top:H+"px"}),this._updateColor(!0))},_handleKey:function(x){},focus:function(){this.focused||a.focus(this.focusNode)},_stopDrag:function(x){k.stop(x)},destroy:function(){this.inherited(arguments);w.forEach(this._subs,function(x){v.unsubscribe(x)});delete this._subs}})})},
"dojox/color":function(){define(["./color/_base"],function(E){return E})},"dojox/color/_base":function(){define(["../main","dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(E,q,A,w){E=q.getObject("color",!0,E);E.Color=A;E.blend=A.blendColors;E.fromRgb=A.fromRgb;E.fromHex=A.fromHex;E.fromArray=A.fromArray;E.fromString=A.fromString;E.greyscale=w.makeGrey;q.mixin(E,{fromCmy:function(m,v,r){q.isArray(m)?(v=m[1],r=m[2],m=m[0]):q.isObject(m)&&(v=m.m,r=m.y,m=m.c);return new A({r:Math.round(255*
(1-m/100)),g:Math.round(255*(1-v/100)),b:Math.round(255*(1-r/100))})},fromCmyk:function(m,v,r,l){q.isArray(m)?(v=m[1],r=m[2],l=m[3],m=m[0]):q.isObject(m)&&(v=m.m,r=m.y,l=m.b,m=m.c);l/=100;return new A({r:Math.round(255*(1-Math.min(1,m/100*(1-l)+l))),g:Math.round(255*(1-Math.min(1,v/100*(1-l)+l))),b:Math.round(255*(1-Math.min(1,r/100*(1-l)+l)))})},fromHsl:function(m,v,r){q.isArray(m)?(v=m[1],r=m[2],m=m[0]):q.isObject(m)&&(v=m.s,r=m.l,m=m.h);v/=100;for(r/=100;0>m;)m+=360;for(;360<=m;)m-=360;if(120>
m){var l=(120-m)/60;var k=m/60;m=0}else 240>m?(l=0,k=(240-m)/60,m=(m-120)/60):(l=(m-240)/60,k=0,m=(360-m)/60);l=2*v*Math.min(l,1)+(1-v);k=2*v*Math.min(k,1)+(1-v);m=2*v*Math.min(m,1)+(1-v);.5>r?(l*=r,k*=r,m*=r):(l=(1-r)*l+2*r-1,k=(1-r)*k+2*r-1,m=(1-r)*m+2*r-1);return new A({r:Math.round(255*l),g:Math.round(255*k),b:Math.round(255*m)})}});E.fromHsv=function(m,v,r){q.isArray(m)?(v=m[1],r=m[2],m=m[0]):q.isObject(m)&&(v=m.s,r=m.v,m=m.h);360==m&&(m=0);v/=100;r/=100;var l,k;if(0==v)var n=k=l=r;else{var d=
m/60;m=Math.floor(d);var c=d-m;d=r*(1-v);var g=r*(1-v*c);v=r*(1-v*(1-c));switch(m){case 0:l=r;n=v;k=d;break;case 1:l=g;n=r;k=d;break;case 2:l=d;n=r;k=v;break;case 3:l=d;n=g;k=r;break;case 4:l=v;n=d;k=r;break;case 5:l=r,n=d,k=g}}return new A({r:Math.round(255*l),g:Math.round(255*n),b:Math.round(255*k)})};q.extend(A,{toCmy:function(){return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*(1-this.g/255)),y:Math.round(100*(1-this.b/255))}},toCmyk:function(){var m=this.r/255,v=this.g/255,r=this.b/255;
var l=Math.min(1-m,1-v,1-r);return{c:Math.round((1-m-l)/(1-l)*100),m:Math.round((1-v-l)/(1-l)*100),y:Math.round((1-r-l)/(1-l)*100),b:Math.round(100*l)}},toHsl:function(){var m=this.r/255,v=this.g/255,r=this.b/255,l=Math.min(m,r,v),k=Math.max(m,v,r),n=k-l,d=0,c=0;l=(l+k)/2;0<l&&1>l&&(c=n/(.5>l?2*l:2-2*l));0<n&&(k==m&&k!=v&&(d+=(v-r)/n),k==v&&k!=r&&(d+=2+(r-m)/n),k==r&&k!=m&&(d+=4+(m-v)/n),d*=60);return{h:d,s:Math.round(100*c),l:Math.round(100*l)}},toHsv:function(){var m=this.r/255,v=this.g/255,r=this.b/
255,l=Math.max(m,v,r),k=l-Math.min(m,r,v),n=null,d=0==l?0:k/l;0==d?n=0:(n=m==l?60*(v-r)/k:v==l?120+60*(r-m)/k:240+60*(m-v)/k,0>n&&(n+=360));return{h:n,s:Math.round(100*d),v:Math.round(100*l)}}});return E})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(E,q,A,w){var m={};q.setObject("dojo.colors",m);var v=function(l,k,n){0>n&&++n;1<n&&--n;var d=6*n;return 1>d?l+(k-l)*d:1>2*n?k:2>3*n?l+(k-l)*(2/3-n)*6:l};E.colorFromRgb=A.fromRgb=function(l,
k){var n=l.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(n){l=n[2].split(/\s*,\s*/);var d=l.length;n=n[1];if("rgb"==n&&3==d||"rgba"==n&&4==d)return n=l[0],"%"==n.charAt(n.length-1)?(n=w.map(l,function(b){return 2.56*parseFloat(b)}),4==d&&(n[3]=l[3]),A.fromArray(n,k)):A.fromArray(l,k);if("hsl"==n&&3==d||"hsla"==n&&4==d){n=(parseFloat(l[0])%360+360)%360/360;var c=parseFloat(l[1])/100,g=parseFloat(l[2])/100;c=.5>=g?g*(c+1):g+c-g*c;g=2*g-c;n=[256*v(g,c,n+1/3),256*v(g,c,n),256*v(g,c,n-1/
3),1];4==d&&(n[3]=l[3]);return A.fromArray(n,k)}}return null};var r=function(l,k,n){l=Number(l);return isNaN(l)?n:l<k?k:l>n?n:l};A.prototype.sanitize=function(){this.r=Math.round(r(this.r,0,255));this.g=Math.round(r(this.g,0,255));this.b=Math.round(r(this.b,0,255));this.a=r(this.a,0,1);return this};m.makeGrey=A.makeGrey=function(l,k){return A.fromArray([l,l,l,k])};q.mixin(A.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,
228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,
140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],
greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,
178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,
255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,
128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return A})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dojo/_base/config dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule ./a11y/_Transparency".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b){E=E([A,w,m,v],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:r,nls:null,_nls0:"0%",_nls50:"50%",_nls100:"100%",alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency;var e=q.locale||"";e=e.toLowerCase();"ar"===e?(this._nls0="\u066a0",this._nls50="\u066a50",this._nls100="\u066a100"):"tr"===e&&(this._nls0="%0",this._nls50="%50",this._nls100="%100")},postCreate:function(){this.inherited(arguments);"number"===
typeof this.alpha&&this.setAlpha(this.alpha);this.a11y_initAriaAttrs()},setAlpha:function(e){this.opacitySlider.set("value",Math.round(100-100*e))},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var e=this.getAlpha();this.emit("change",e)}});E.extend(b);return E})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u){var t=q("dijit.form._SliderMover",d,{onMouseMove:function(z){var x=this.widget,y=x._abspos;y||(y=x._abspos=m.position(x.sliderBarContainer,!0),x._setPixelValue_=l.hitch(x,"_setPixelValue"),x._isReversed_=x._isReversed());z=z[x._mousePixelCoord]-y[x._startingPixelCoord];x._setPixelValue_(x._isReversed_?y[x._pixelCount]-z:z,y[x._pixelCount],!1)},destroy:function(z){d.prototype.destroy.apply(this,arguments);var x=this.widget;x._abspos=null;x._setValueAttr(x.value,
!0)}});A=q("dijit.form.HorizontalSlider",[p,B],{templateString:u,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:e.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(z){this.disabled||this.readOnly||z.altKey||z.ctrlKey||z.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(z){if(!(this.disabled||this.readOnly||z.altKey||z.ctrlKey||z.metaKey)){switch(z.keyCode){case r.HOME:this._setValueAttr(this.minimum,!1);break;case r.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?r.RIGHT_ARROW:r.LEFT_ARROW:case !1===this._descending?r.DOWN_ARROW:r.UP_ARROW:case !1===this._descending?r.PAGE_DOWN:r.PAGE_UP:this.increment(z);
break;case this._descending||this.isLeftToRight()?r.LEFT_ARROW:r.RIGHT_ARROW:case !1===this._descending?r.UP_ARROW:r.DOWN_ARROW:case !1===this._descending?r.PAGE_UP:r.PAGE_DOWN:this.decrement(z);break;default:return}z.stopPropagation();z.preventDefault()}},_onHandleClick:function(z){this.disabled||this.readOnly||(k("ie")||a.focus(this.sliderHandle),z.stopPropagation(),z.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(z){if(!this.disabled&&!this.readOnly&&
this.clickSelect){a.focus(this.sliderHandle);z.stopPropagation();z.preventDefault();var x=m.position(this.sliderBarContainer,!0),y=z[this._mousePixelCoord]-x[this._startingPixelCoord];this._setPixelValue(this._isReversed()?x[this._pixelCount]-y:y,x[this._pixelCount],!0);this._movable.onMouseDown(z)}},_setPixelValue:function(z,x,y){if(!this.disabled&&!this.readOnly){var D=this.discreteValues;if(1>=D||Infinity==D)D=x;D--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(z/
(x/D))/D+this.minimum,this.maximum),this.minimum),y)}},_setValueAttr:function(z,x){this._set("value",z);this.valueNode.value=z;this.focusNode.setAttribute("aria-valuenow",z);this.inherited(arguments);var y=this.maximum>this.minimum?(z-this.minimum)/(this.maximum-this.minimum):0,D=!1===this._descending?this.remainingBar:this.progressBar,H=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(x&&0<this.slideDuration&&
D.style[this._progressPixelSize]){var I=this,N={},S=parseFloat(D.style[this._progressPixelSize]),M=this.slideDuration*(y-S/100);0!=M&&(0>M&&(M=0-M),N[this._progressPixelSize]={start:S,end:100*y,units:"%"},this._inProgressAnim=w.animateProperty({node:D,duration:M,onAnimate:function(Q){H.style[I._progressPixelSize]=100-parseFloat(Q[I._progressPixelSize])+"%"},onEnd:function(){delete I._inProgressAnim},properties:N}),this._inProgressAnim.play())}else D.style[this._progressPixelSize]=100*y+"%",H.style[this._progressPixelSize]=
100*(1-y)+"%"},_bumpValue:function(z,x){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var y=v.getComputedStyle(this.sliderBarContainer),D=m.getContentBox(this.sliderBarContainer,y);y=this.discreteValues;if(1>=y||Infinity==y)y=D[this._pixelCount];y--;z=Math.round((this.value-this.minimum)*y/(this.maximum-this.minimum))+z;0>z&&(z=0);z>y&&(z=y);z=z*(this.maximum-this.minimum)/y+this.minimum;this._setValueAttr(z,x)}},_onClkBumper:function(z){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(z,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(z){this._bumpValue(z.keyCode==r.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(z){this._bumpValue(z.keyCode==r.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(z){this.focused&&(z.stopPropagation(),z.preventDefault(),this._bumpValue(0>z.wheelDelta?-1:1,!0))},
startup:function(){this._started||(E.forEach(this.getChildren(),function(z){this[z.container]!=this.containerNode&&this[z.container].appendChild(z.domNode)},this),this.inherited(arguments))},_typematicCallback:function(z,x,y){if(-1==z)this._setValueAttr(this.value,!0);else this[x==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](y)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var z=c('label[for\x3d"'+this.id+'"]');z.length&&(z[0].id||(z[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",z[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(f.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),f.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(b(this.domNode,
g.wheel,l.hitch(this,"_mouseWheeled")));var z=q(t,{widget:this});this._movable=new n(this.sliderHandle,{mover:z});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});A._Mover=t;return A})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(E,q,A,w,m,v){E=E("dijit.form.HorizontalRuleLabels",
v,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(r){return r},_genHTML:function(r,l){l=
this.labels[l];return this._positionPrefix+this._calcPosition(r)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(l)+this._labelPrefix+l+this._suffix},_genDirectionHTML:function(r){return""},getLabels:function(){var r=this.labels;!r.length&&this.srcNodeRef&&(r=w("\x3e li",this.srcNodeRef).map(function(d){return String(d.innerHTML)}));if(!r.length&&1<this.count){r=[];for(var l=this.minimum,k=(this.maximum-l)/(this.count-1),n=0;n<this.count;n++)r.push(n<this.numericMargin||n>=this.count-
this.numericMargin?"":A.format(l,this.constraints)),l+=k}return r},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();this.count=this.labels.length}});q("dojo-bidi")&&E.extend({_setTextDirAttr:function(r){this.textDir!=r&&(this._set("textDir",r),w(".dijitRuleLabelContainer",this.domNode).forEach(m.hitch(this,function(l){l.style.direction=this.getTextDir(l.innerText||l.textContent||"")})))},_genDirectionHTML:function(r){return this.textDir?"direction:"+this.getTextDir(r)+
";":""}});return E})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(E,q,A){return E("dijit.form.HorizontalRule",[q,A],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(w){return this._positionPrefix+
w+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);if(1==this.count)var w=this._genHTML(50,0);else{var m,v=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){w=this._genHTML(0,0);for(m=1;m<this.count-1;m++)w+=this._genHTML(v*m,m);w+=this._genHTML(100,this.count-1)}else{w=this._genHTML(100,0);for(m=1;m<this.count-1;m++)w+=this._genHTML(100-v*m,m);w+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=w}})})},"jimu/dijit/a11y/_Transparency":function(){define(["dojo/_base/html"],
function(E){return{a11y_initAriaAttrs:function(){var q=this["aria-labelledby"];q&&(E.removeAttr(this.domNode,"aria-labelledby"),E.setAttr(this.opacitySlider.focusNode,"aria-labelledby",q))}}})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(E,q,A,w){return E("dijit.form.NumberSpinner",[A,w.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(m,v){var r=this.constraints,l=isNaN(m),k=!isNaN(r.max),n=
!isNaN(r.min);l&&0!=v&&(m=0<v?n?r.min:k?r.max:0:k?this.constraints.max:n?r.min:0);v=m+v;if(l||isNaN(v))return m;k&&v>r.max&&(v=r.max);n&&v<r.min&&(v=r.min);return v},_onKeyDown:function(m){if(!(this.disabled||this.readOnly||m.keyCode!=q.HOME&&m.keyCode!=q.END||m.ctrlKey||m.altKey||m.metaKey||"undefined"==typeof this.get("value"))){var v=this.constraints[m.keyCode==q.HOME?"min":"max"];"number"==typeof v&&this._setValueAttr(v,!1);m.stopPropagation();m.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(E,q,A,w,m,v,r,l,k,n){return E("dijit.form._Spinner",l,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:k,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(d){return d},_arrowPressed:function(d,c,g){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),c*g),!1),n.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=
null},_typematicCallback:function(d,c,g){var b=this.smallDelta;c==this.textbox&&(c=g.keyCode,b=c==q.PAGE_UP||c==q.PAGE_DOWN?this.largeDelta:this.smallDelta,c=c==q.UP_ARROW||c==q.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==d?this._arrowReleased(c):this._arrowPressed(c,c==this.upArrowNode?1:-1,b)},_wheelTimer:null,_mouseWheeled:function(d){if(this.focused){d.stopPropagation();d.preventDefault();var c=d.wheelDelta/120;Math.floor(c)!=c&&(c=0<d.wheelDelta?1:-1);d=d.detail?-1*d.detail:c;if(0!==d){var g=
this[0<d?"upArrowNode":"downArrowNode"];this._arrowPressed(g,d,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(g)},50)}}},_setConstraintsAttr:function(d){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):
this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(d,c){this.focusNode.setAttribute("aria-valuenow",d);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(v(this.domNode,m.wheel,A.hitch(this,"_mouseWheeled")),r.addListener(this.upArrowNode,this.textbox,{keyCode:q.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),r.addListener(this.downArrowNode,this.textbox,
{keyCode:q.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),r.addListener(this.upArrowNode,this.textbox,{keyCode:q.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),r.addListener(this.downArrowNode,this.textbox,{keyCode:q.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,
this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(E,q,A){return E("dijit.form.RangeBoundTextBox",A,{rangeMessage:"",rangeCheck:function(w,m){return("min"in m?0<=this.compare(w,m.min):!0)&&("max"in m?0>=this.compare(w,m.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var w=this.get("value");
if(null==w)return!1;var m=!1;"min"in this.constraints&&(m=this.constraints.min,m=0>this.compare(w,"number"==typeof m&&0<=m&&0!=w?0:m));!m&&"max"in this.constraints&&(m=this.constraints.max,m=0<this.compare(w,"number"!=typeof m||0<m?m:0));return m},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(w){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(w))},getErrorMessage:function(w){var m=
this.get("value");return null==m||""===m||"number"==typeof m&&isNaN(m)||this.isInRange(w)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=q.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(E,q,A,w,m,v){var r=
function(k){k=k||{};var n=A.getLocalization("dojo.cldr","number",A.normalizeLocale(k.locale)),d=k.pattern?k.pattern:n[(k.type||"decimal")+"Format"];k="number"==typeof k.places?k.places:"string"===typeof k.places&&0<k.places.length?k.places.replace(/.*,/,""):-1!=d.indexOf(".")?d.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:n.decimal,places:k}},l=E("dijit.form.NumberTextBoxMixin",null,{pattern:function(k){return"("+(this.focused&&this.editOptions?this._regExpGenerator(q.delegate(k,this.editOptions))+
"|":"")+this._regExpGenerator(k)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:m.format,_regExpGenerator:m.regexp,_decimalInfo:r(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(k){var n="number"==typeof k.places?k.places:0;n&&n++;"number"!=typeof k.max&&(k.max=9*Math.pow(10,15-n));"number"!=typeof k.min&&(k.min=-9*Math.pow(10,15-n));this.inherited(arguments,[k]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&
this.set("value",this.value);this._decimalInfo=r(k)},_onFocus:function(k){if(!this.disabled&&!this.readOnly){var n=this.get("value");"number"!=typeof n||isNaN(n)||(n=this.format(n,this.constraints),void 0!==n&&(this.textbox.value=n,"mouse"!==k&&this.textbox.select()));this.inherited(arguments)}},format:function(k,n){var d=String(k);if("number"!=typeof k)return d;if(isNaN(k))return"";if(!("rangeCheck"in this&&this.rangeCheck(k,n))&&!1!==n.exponent&&/\de[-+]?\d/i.test(d))return d;this.editOptions&&
this.focused&&(n=q.mixin({},n,this.editOptions));return this._formatter(k,n)},_parser:m.parse,parse:function(k,n){var d=q.mixin({},n,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=d.places){var c=d.places;c="number"===typeof c?c:Number(c.split(",").pop());d.places="0,"+c}d=this._parser(k,d);this.editOptions&&this.focused&&isNaN(d)&&(d=this._parser(k,n));return d},_getDisplayedValueAttr:function(){var k=this.inherited(arguments);return isNaN(k)?this.textbox.value:k},filter:function(k){if(null==
k||"string"==typeof k&&""==k)return NaN;"number"!=typeof k||isNaN(k)||0==k||(k=m.round(k,this._decimalInfo.places));return this.inherited(arguments,[k])},serialize:function(k,n){return"number"!=typeof k||isNaN(k)?"":this.inherited(arguments)},_setBlurValue:function(){var k=q.hitch(q.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(k,!0)},_setValueAttr:function(k,n,d){if(void 0!==k&&void 0===d)if(d=String(k),"number"==typeof k)if(isNaN(k))d="";else{if("rangeCheck"in this&&this.rangeCheck(k,
this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(d))d=void 0}else k?k=void 0:(d="",k=NaN);this.inherited(arguments,[k,n,d])},_getValueAttr:function(){var k=this.inherited(arguments);if(isNaN(k)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+m._realNumberRegexp(q.delegate(this.constraints))+"$")).test(this.textbox.value))return k=Number(this.textbox.value),isNaN(k)?void 0:k}else return k},isValid:function(k){if(!this.focused||
this._isEmpty(this.textbox.value))return this.inherited(arguments);var n=this.get("value");return!isNaN(n)&&this.rangeCheck(n,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var k="number"==typeof this.constraints.min,n="number"==typeof this.constraints.max,d=this.get("value");if(isNaN(d)||!k&&!n)return this.inherited(arguments);var c=d|0,g=0>d,b=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),
e=(this.maxLength||20)-this.textbox.value.length,a=b?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"";c=b?c+"."+a:c+"";e=w.rep("9",e);b=d;g?b=Number(c+e):d=Number(c+e);return!(k&&d<this.constraints.min||n&&b>this.constraints.max)}});E=E("dijit.form.NumberTextBox",[v,l],{baseClass:"dijitTextBox dijitNumberTextBox"});E.Mixin=l;return E})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),
function(E,q,A,w,m,v,r,l){return E([l],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,_status:null,postCreate:function(){this.inherited(arguments);this._validatingNode=q.create("div",{"class":"jimu-service-validating"},this.domNode);this._validNode=q.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=q.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},
this.domNode);q.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(w(this,"Change",A.hitch(this,"_onServiceUrlChange")))},setProcessFunction:function(k,n){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof k&&(this._fetchHandle=v.after(this,"onFetch",k),this.own(this._fetchHandle));"function"===typeof n&&(this._fetchErrHandle=v.after(this,"onFetchError",n),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&
this._fetchHandle.remove&&(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),this._fetchErrHandle=null)},onFetch:function(k){return k},onFetchError:function(k){},getStatus:function(){return this._status},_onServiceUrlChange:function(k){var n=new m;n.then(A.hitch(this,function(){this._valid()}),A.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();k?r({url:A.trim(k||""),handleAs:"json",content:{f:"json"},
callbackParamName:"callback"}).then(A.hitch(this,function(d){this.onFetch({url:this.getValue(),data:d})?n.resolve("success"):n.reject("error")}),A.hitch(this,function(d){n.reject(d)})):n.reject("error")},_validating:function(){this._status="validating";q.removeClass(this.domNode,"jimu-serviceurl-input-invalid");q.removeClass(this.domNode,"jimu-serviceurl-input-valid");q.addClass(this.domNode,"jimu-serviceurl-input-validating")},_valid:function(){this._status="valid";q.removeClass(this.domNode,"jimu-serviceurl-input-invalid");
q.removeClass(this.domNode,"jimu-serviceurl-input-validating");q.addClass(this.domNode,"jimu-serviceurl-input-valid")},_inValid:function(){this._status="invalid";q.removeClass(this.domNode,"jimu-serviceurl-input-validating");q.removeClass(this.domNode,"jimu-serviceurl-input-valid");q.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dijit/registry jimu/utils jimu/dijit/CheckBox dijit/form/Select".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g){return E([q,A,w],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"headTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" data-dojo-attach-point\x3d"tableInHeadSection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"headColgroup"\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"  data-dojo-attach-point\x3d"thead"\x3e\x3c/thead\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"bodyTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0"data-dojo-attach-point\x3d"tableInBodySection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"bodyColgroup"\x3e\x3c/colgroup\x3e\x3ctbody class\x3d"simple-table-tbody" data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",_classVerticalScroll:"vertical-scroll",autoHeight:!0,selectable:!1,fields:null,singleClickEdit:!1,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);
this._initSelf()},startup:function(){this.inherited(arguments);this.updateUI()},_initSelf:function(){this.own(d.bindClickAndDblclickEvents(this.tableInBodySection,m.hitch(this,function(a){if(a=d.getAncestorDom(a.target||a.srcElement,function(f){return v.hasClass(f,"simple-table-row")&&v.hasClass(f,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),m.hitch(this,function(a){if(a=d.getAncestorDom(a.target||a.srcElement,function(f){return v.hasClass(f,"simple-table-row")&&v.hasClass(f,
"not-empty")},this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var b=Math.random().toString();this._name="jimu_table_"+b.slice(2,b.length);if(this.fields&&0<this.fields.length){var e=v.create("tr",{},this.thead);r.forEach(this.fields,m.hitch(this,function(a){var f="auto";"actions"===a.type&&(a.name="actions");a.hidden?f=1:void 0!==a.width&&null!==a.width?f=a.width:"actions"!==a.type||a.name||(a.width=this._calculateActionsWidth(a)+20,f=a.width);v.create("col",{width:f},this.headColgroup);
v.create("col",{width:f},this.bodyColgroup);f=v.create("th",{innerHTML:d.sanitizeHTML(a.title),title:a.title},e);if("checkbox"===a.type){f.innerHTML="";var h=new c({label:a.title});this.own(l(h.domNode,"click",m.hitch(this,function(){h.getValue()?this._checkAllTdCheckBoxes(a.name):this._uncheckAllTdCheckBoxes(a.name)})));h.placeAt(f)}v.addClass(f,"simple-table-field");a.hidden&&v.addClass(f,"hidden-column");a["class"]&&v.addClass(f,a["class"]);v.addClass(f,a.name)}))}else this.fields=null},_getThCheckBox:function(b){var e=
null;b=k(".simple-table-field."+b+" .jimu-checkbox",this.thead)[0];return e=n.byNode(b)},_getAllEnabledTdCheckBoxes:function(b){b=k(".simple-table-cell."+b+" .jimu-checkbox",this.tbody);b=r.map(b,function(e){return n.byNode(e)});return b=r.filter(b,function(e){return e.getStatus()})},_checkAllTdCheckBoxes:function(b){b=this._getAllEnabledTdCheckBoxes(b);r.forEach(b,function(e){e.getValue()||e.setValue(!0)})},_uncheckAllTdCheckBoxes:function(b){b=this._getAllEnabledTdCheckBoxes(b);r.forEach(b,function(e){e.getValue()&&
e.setValue(!1)})},_delaySyncThCheckBoxStatusWithAllTdCheckBoxes:function(b){setTimeout(m.hitch(this,function(){this._syncThCheckBoxStatusWithAllTdCheckBoxes(b)}),100)},_syncThCheckBoxStatusWithAllTdCheckBoxes:function(b){var e=this._getAllEnabledTdCheckBoxes(b);e=r.filter(e,m.hitch(this,function(a){return a.getStatus()}));0!==e.length&&(b=this._getThCheckBox(b),r.every(e,function(a){return a.getValue()})?b.getValue()||b.setValue(!0):b.getValue()&&b.setValue(!1))},clear:function(){var b=this._getNotEmptyRows(),
e=r.map(b,m.hitch(this,function(a){return this.getRowData(a)}));v.empty(this.tbody);r.forEach(b,m.hitch(this,function(a,f){this._onDeleteRow(a,e[f])}));this.updateUI();this._rowIndex=0;this._onClearRows(b)},addRows:function(b){var e=[];this.fields&&b&&0<b.length&&r.forEach(b,m.hitch(this,function(a){e.push(this.addRow(a,-1,!0))}));this.updateUI();return e},addRow:function(b,e,a){this._rowIndex++;var f={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==
typeof b)return f;var h=r.filter(this.fields,m.hitch(this,function(B){return"text"===B.type&&!0===B.unique}));h=r.filter(h,m.hitch(this,function(B){return 0<this.getRowDataArrayByFieldValue(B.name,b[B.name]).length}));if(0<h.length)return f.errorCode=this.REPEATING_ERROR,f.errorMessage="repeating data",f.repeatFields=h,f;var p=v.create("tr",{"class":"simple-table-row not-empty"},this.tbody);v.setAttr(p,"rowId","row"+this._rowIndex);r.forEach(this.fields,m.hitch(this,function(B){var u=b[B.name],t=
B.type,z=null;"actions"===t?z=this._createActionsTd(p,B):("text"===t?z=this._createTextTd(p,B,u):"radio"===t?z=this._createRadioTd(p,B,u):"checkbox"===t?z=this._createCheckboxTd(p,B,u):"empty"===t?z=this._createEmptyTd(p,B):"extension"===t?z=this._createExtensionTd(p,B,u):"dropdown"===t&&(z=this._createDropdownTd(p,B,u)),B.hidden&&v.addClass(z,"hidden-column"))}));a||(this.updateUI(),a=this.getRows(),"number"===typeof e&&0<=e&&e<a.length&&v.place(p,a[e],"before"));f.success=!0;f.tr=p;f.errorMessage=
null;this._onAddRow(p);return f},deleteRow:function(b){if(b){var e=this.getRowData(b);v.destroy(b);this.updateUI();this._onDeleteRow(b,e)}},selectRow:function(b){this.selectable&&(k(".simple-table-row",this.tbody).removeClass("jimu-state-active"),v.addClass(b,"jimu-state-active"),this._onSelectRow(b))},updateUI:function(){this._updateRowClassName();this._updateHeight();v.removeClass(this.domNode,this._classVerticalScroll);0<this.bodyDiv.clientHeight&&this.bodyDiv.clientHeight<this.bodyDiv.scrollHeight&&
v.addClass(this.domNode,this._classVerticalScroll);r.forEach(this.fields,m.hitch(this,function(b){"checkbox"===b.type&&this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(b.name)}))},_updateHeadTableWidth:function(){if(this.domNode){var b=v.getContentBox(this.tableInBodySection).w,e="100%";"number"===typeof b&&0<b&&(e=b+"px");v.setStyle(this.tableInHeadSection,"width",e)}},_updateHeight:function(){var b=this.getRows();this.autoHeight&&v.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*
(0<b.length?b.length:1)+1+"px");b&&0<b.length&&this.bodyTableDiv&&(b=v.getMarginSize(b[0]))&&b.h&&v.setStyle(this.bodyTableDiv,"backgroundSize","1px "+b.h+"px")},_updateRowClassName:function(){var b=k("."+this._classFirstSimpleTableRow,this.tbody)[0];b&&(b=k("."+this._classRowUpDiv,b)[0])&&v.removeClass(b,this._classJimuStateDisabled);(b=k("."+this._classLastSimpleTableRow,this.tbody)[0])&&(b=k("."+this._classRowDownDiv,b)[0])&&v.removeClass(b,this._classJimuStateDisabled);b=k("."+this._classSimpleTableRow,
this.tbody);b.removeClass("odd");b.removeClass("even");b.removeClass(this._classFirstSimpleTableRow);b.removeClass(this._classLastSimpleTableRow);r.forEach(b,m.hitch(this,function(a,f){0===f%2?v.addClass(a,"odd"):v.addClass(a,"even")}));if(0<b.length){var e=b[0];v.addClass(e,this._classFirstSimpleTableRow);(e=k("."+this._classRowUpDiv,e)[0])&&v.addClass(e,this._classJimuStateDisabled);b=b[b.length-1];v.addClass(b,this._classLastSimpleTableRow);(b=k("."+this._classRowDownDiv,b)[0])&&v.addClass(b,this._classJimuStateDisabled)}},
_createTextTd:function(b,e,a){var f=null;return f=e.editable?this._createEditableTextTd(b,e,a):this._createNormalTextTd(b,e,a)},_createNormalTextTd:function(b,e,a){var f=v.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');v.addClass(f,e.name);var h=k("div",f)[0];h.innerHTML=d.sanitizeHTML(a)||"";h.title=a||"";e["class"]&&v.addClass(f,e["class"]);v.place(f,b);return f},_createEditableTextTd:function(b,e,a){var f=v.toDom('\x3ctd class\x3d"editable-text-td '+
e.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');v.addClass(f,"simple-table-cell");v.place(f,b);e["class"]&&v.addClass(f,e["class"]);var h=k("div",f)[0],p=k("input",f)[0];h.innerHTML=d.sanitizeHTML(a)||"";""!==h.innerHTML&&(h.title=h.innerText||h.innerHTML);p.value=h.innerHTML;this.own(l(h,this.singleClickEdit?"click":"dblclick",m.hitch(this,function(B){this.singleClickEdit||B.stopPropagation();
p.value=h.innerText||h.innerHTML;v.setStyle(h,"display","none");v.setStyle(p,"display","inline");p.focus();p.select&&p.select()})));this.own(l(p,"blur",m.hitch(this,function(){p.value=m.trim(d.sanitizeHTML(p.value));var B=h.innerText||h.innerHTML,u=p.value;""!==u?e.unique?0<this.getRowDataArrayByFieldValue(e.name,u,b).length?p.value=B:h.innerHTML=d.sanitizeHTML(u):h.innerHTML=d.sanitizeHTML(u):p.value=B;v.setStyle(p,"display","none");v.setStyle(h,"display","block")})));return f},_createRadioTd:function(b,
e,a){var f=v.toDom('\x3ctd class\x3d"radio-td '+e.name+'"\x3e\x3cinput class\x3d"jimu-radio-btn" type\x3d"radio" /\x3e\x3c/td\x3e');v.addClass(f,"simple-table-cell");v.place(f,b);e["class"]&&v.addClass(f,e["class"]);b=k("input",f)[0];b.name=e.radio&&"row"===e.radio?this._name+this._rowIndex:this._name+e.name;b.checked=!0===a;return f},_createCheckboxTd:function(b,e,a){var f=v.toDom('\x3ctd class\x3d"checkbox-td '+e.name+'"\x3e\x3c/td\x3e');v.addClass(f,"simple-table-cell");v.place(f,b);e["class"]&&
v.addClass(f,e["class"]);var h=new c({onChange:m.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(e.name);"function"===typeof e.onChange&&setTimeout(m.hitch(this,function(){e.onChange(b,h)}),200)})});this.own(l(h,"status-change",m.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(e.name)})));this._setValueForCheckBox(h,a);h.placeAt(f);return f},_createActionsTd:function(b,e){var a=v.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');
v.addClass(a,"simple-table-cell");var f=k(".action-item-parent",a)[0];v.place(a,b);e["class"]&&v.addClass(a,e["class"]);r.forEach(e.actions,m.hitch(this,function(h){"up"===h?(h=v.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},f),h.title=this.nls.moveUp,this.own(l(h,"click",m.hitch(this,function(p){p.stopPropagation();if(this.onBeforeRowUp(b)){p=k(".simple-table-row",this.tbody);var B=r.indexOf(p,b);0<B&&(p=p[B-1])&&(v.place(b,p,"before"),this.updateUI(),
this.emit("row-up",b))}})))):"down"===h?(h=v.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},f),h.title=this.nls.moveDown,this.own(l(h,"click",m.hitch(this,function(p){p.stopPropagation();if(this.onBeforeRowDown(b)){p=k(".simple-table-row",this.tbody);var B=r.indexOf(p,b);B<p.length-1&&(p=p[B+1])&&(v.place(b,p,"after"),this.updateUI(),this.emit("row-down",b))}})))):"edit"===h?(h=v.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},
f),h.title=this.nls.edit,this.own(l(h,"click",m.hitch(this,function(p){p.stopPropagation();this.onBeforeRowEdit(b)&&this._onActionsEdit(b)})))):"delete"===h&&(h=v.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},f),h.title=this.nls.deleteRow,this.own(l(h,"click",m.hitch(this,function(p){p.stopPropagation();this.onBeforeRowDelete(b)&&this.deleteRow(b)}))))}));e=this._calculateActionsWidth(e)+"px";v.setStyle(f,"width",e);return a},_calculateActionsWidth:function(b){return 20*
r.map(b.actions,function(e){return"up"===e||"down"===e||"edit"===e||"delete"===e}).length},_createEmptyTd:function(b,e){b=v.create("td",{"class":e.name},b);v.addClass(b,"simple-table-cell");v.addClass(b,"empty-text-td");e["class"]&&v.addClass(b,e["class"]);return b},_createExtensionTd:function(b,e,a){b=v.create("td",{"class":e.name},b);v.addClass(b,"simple-table-cell");v.addClass(b,"extension-td");e["class"]&&v.addClass(b,e["class"]);e.create&&"function"===typeof e.create&&e.create(b);e.setValue&&
"function"===typeof e.setValue&&e.setValue(b,a);return b},_createDropdownTd:function(b,e,a){b=v.create("td",{"class":e.name},b);v.addClass(b,"simple-table-cell");v.addClass(b,"dropdown-td");e["class"]&&v.addClass(b,e["class"]);(new g({options:a})).placeAt(b);return b},editRow:function(b,e){var a={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof e||!v.isDescendant(b,this.tbody))return a;var f=m.mixin([],this.fields);f=r.filter(f,m.hitch(this,
function(p){return"text"===p.type&&!0===p.unique}));f=r.filter(f,m.hitch(this,function(p){return 0<this.getRowDataArrayByFieldValue(p.name,e[p.name],b).length}));if(0<f.length)return a.errorCode=this.REPEATING_ERROR,a.errorMessage="repeating data",a.repeatFields=f,a;var h=k(".simple-table-cell",b);r.forEach(this.fields,m.hitch(this,function(p,B){if(e.hasOwnProperty(p.name)){B=h[B];var u=e[p.name],t=p.type;"text"===t?p.editable?this._editEditableText(B,p,u):this._editNormalText(B,p,u):"radio"===t?
this._editRadio(B,p,u):"checkbox"===t?this._editCheckbox(B,p,u):"extension"===t?this._editExtension(B,p,u):"dropdown"===t&&this._editDropdown(B,p,u)}}));a.success=!0;a.tr=b;a.errorMessage=null;this._onEditRow(b);return a},_editNormalText:function(b,e,a){b=k("div",b)[0];b.innerHTML=d.sanitizeHTML(a)||"";b.title=b.innerHTML},_editEditableText:function(b,e,a){e=k("div",b)[0];e.innerHTML=d.sanitizeHTML(a)||"";k("input",b)[0].value=e.innerHTML},_editRadio:function(b,e,a){k("input",b)[0].checked=!0===a},
_editCheckbox:function(b,e,a){b=k(".jimu-checkbox",b)[0];b=n.byNode(b);this._setValueForCheckBox(b,a)},_setValueForCheckBox:function(b,e){null===e?b.setStatus(!1):(b.setStatus(!0),e!==b.getValue()&&b.setValue(e))},_editExtension:function(b,e,a){e.setValue&&"function"===typeof e.setValue&&e.setValue(b,a)},_editDropdown:function(b,e,a){b=k(".dijitSelect",b)[0];n.byNode(b).set("value",a)},_getAllRows:function(){return k(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var b=this._getAllRows();
return r.filter(b,m.hitch(this,function(e){return!v.hasClass(e,"empty")}))},_getEmptyRows:function(){var b=this._getAllRows();return r.filter(b,m.hitch(this,function(e){return v.hasClass(e,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var b=null,e=k(".simple-table-row",this.tbody);e=r.filter(e,m.hitch(this,function(a){return!v.hasClass(a,"empty")&&v.hasClass(a,"jimu-state-active")}));0<e.length&&(b=e[0]);return b},getSelectedRowData:function(){var b=null,
e=this.getSelectedRow();e&&(b=this._getRowDataByTr(e));return b},getData:function(b){var e=this._getNotEmptyRows();b&&(e=r.filter(e,m.hitch(this,function(a){return a!==b})));return r.map(e,m.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(b){return this._getRowDataByTr(b)},_getRowDataByTr:function(b){var e=null;if(b)e={};else return null;r.forEach(this.fields,m.hitch(this,function(a){var f=a.type;if("actions"!==f){var h=a.name;e[h]=null;var p=k(".simple-table-cell."+
h,b)[0];p&&("text"===f?(a=k("div",p)[0],e[h]=a.innerText||a.innerHTML):"radio"===f?(a=k("input",p)[0],e[h]=a.checked):"checkbox"===f?(a=k(".jimu-checkbox",p)[0],a=n.byNode(a),a.getStatus()?e[h]=a.getValue():e[h]=null):"extension"===f?a.getValue&&"function"===typeof a.getValue&&(e[h]=a.getValue(p,a)):"dropdown"===f&&(a=k(".dijitSelect",p)[0],a=n.byNode(a),e[h]=a.get("value")))}}));return e},getRowDataArrayByFieldValue:function(b,e,a){var f=[];if(!this.fields||!r.some(this.fields,m.hitch(this,function(h){return h.name===
b})))return[];a=this.getData(a);return f=r.filter(a,m.hitch(this,function(h){return h[b]==e}))},moveToTop:function(b){b&&b.parentNode===this.tbody&&v.place(b,this.tbody,"first")},_onClickRow:function(b){this.emit("row-click",b)},_onDblClickRow:function(b){this.emit("row-dblclick",b)},_onSelectRow:function(b){this.emit("row-select",b)},_onAddRow:function(b){this.emit("row-add",b)},_onEditRow:function(b){this.emit("row-edit",b)},_onDeleteRow:function(b,e){this.emit("row-delete",b,e)},_onEnterRow:function(b){this.emit("row-enter",
b)},_onClearRows:function(b){this.emit("rows-clear",b)},_onActionsEdit:function(b){this.emit("actions-edit",b)},onBeforeRowUp:function(b){return!0},onBeforeRowDown:function(b){return!0},onBeforeRowEdit:function(b){return!0},onBeforeRowDelete:function(b){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/keys dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),function(E,q,A,
w,m,v,r,l,k,n,d){return E([l,k,r],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new n(null,this.containerNode);this.own(m(this.containerNode,"keydown",q.hitch(this,
function(g){g.keyCode===v.ESCAPE&&(g.stopPropagation(),this._currentCtrlNode.focus())})));var c=1/this.tabs.length*100;this.isNested&&w.addClass(this.domNode,"nested");A.forEach(this.tabs,function(g){this._createTab(g,c)},this);this.own(m(this.controlNode,"keydown",q.hitch(this,function(g){var b=g.target,e;g.keyCode===v.RIGHT_ARROW?e=b.nextElementSibling?b.nextElementSibling:this.controlNodes[0]:g.keyCode===v.LEFT_ARROW?e=b.previousElementSibling?b.previousElementSibling:this.controlNodes[this.controlNodes.length-
1]:g.keyCode===v.HOME?e=this.controlNodes[0]:g.keyCode===v.END&&(e=this.controlNodes[this.controlNodes.length-1]);e&&(b=e,e.focus())})))}},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);d.setVerticalCenter(this.domNode)},_createTab:function(c,g){g=w.create("div",{innerHTML:d.sanitizeHTML(c.title),"class":"tab jimu-vcenter-text",style:{width:this.isNested?"auto":g+"%"},label:c.title},this.controlNode);this.viewStack.viewType=c.content.domNode?
"dijit":"dom";c.content.label=c.title;this.viewStack.addView(c.content);this.own(m(g,"click",q.hitch(this,function(b){this.onSelect(c.title,b)})));this.own(m(g,"keydown",q.hitch(this,function(b){if(b.keyCode===v.ENTER||b.keyCode===v.SPACE)this.onSelect(c.title,b)})));g.label=c.title;this.controlNodes.push(g)},onSelect:function(c,g){w.hasClass(g.target,"jimu-state-selected")||this.selectTab(c,g)},selectTab:function(c){this._selectControl(c);this.viewStack.switchView(c);this.emit("tabChanged",c)},_selectControl:function(c){A.forEach(this.controlNodes,
function(g){w.removeClass(g,"jimu-state-selected");w.setAttr(g,"tabindex","-1");g.label===c&&(this._currentCtrlNode=g,w.addClass(g,"jimu-state-selected"),w.setAttr(g,"tabindex","0"))},this)}})})},"jimu/dijit/ViewStack":function(){define("dojo/_base/declare dojo/_base/fx dojo/_base/lang dojo/_base/html dojo/_base/array dijit/_WidgetBase".split(" "),function(E,q,A,w,m,v){return E(v,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);
this.views||(this.views=[]);m.forEach(this.views,A.hitch(this,function(r){1===r.nodeType?(w.place(r,this.domNode),w.addClass(r,"view"),w.setStyle(r,"display","none")):r.domNode&&(w.place(r.domNode,this.domNode),w.addClass(r.domNode,"view"),w.setStyle(r.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var r="",l=this.getSelectedView();l&&(r=l.label);return r},
getViewByLabel:function(r){for(var l=0;l<this.views.length;l++)if(r===this.views[l].label)return this.views[l];return null},addView:function(r){this.views.push(r);1===r.nodeType?(w.place(r,this.domNode),w.addClass(r,"view")):r.domNode&&(w.place(r.domNode,this.domNode),w.addClass(r.domNode,"view"))},removeView:function(r){var l=this.views.length;this.views=m.filter(this.views,function(k){return r!==k});l!==this.views.length&&(1===r.nodeType?w.destroy(r):r.domNode&&r.destroyRecursive())},switchView:function(r){var l;
var k="number"===typeof r?this.views[r]:"string"===typeof r?this.getViewByLabel(r):r;this.views.forEach(A.hitch(this,function(n){if(n)if(1===n.nodeType?l=n:n.domNode&&(l=n.domNode),n===k){if(w.setStyle(l,"display","block"),q.fadeIn({node:l}).play(),n.domNode)if(!n._started)n.startup(),n._started=!0;else if("function"===typeof n.onShown)n.onShown()}else if(w.setStyle(l,"display","none"),q.fadeOut({node:l}).play(),n.domNode&&"function"===typeof n.onHidden)n.onHidden()}));this._currentView=k;this.onViewSwitch(k)},
onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/keys dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack jimu/utils".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g){return E([k,n,r],{templateString:d,baseClass:"jimu-tab3",declaredClass:"jimu.dijit.TabContainer3",_currentIndex:-1,selected:"",tabs:null,average:!0,postCreate:function(){this.inherited(arguments);
this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(b){A.forEach(this.tabItems,q.hitch(this,function(e,a){w.removeClass(e,"jimu-state-active");w.setAttr(e,"tabindex","-1");e.label===b&&(w.addClass(e,"jimu-state-active"),w.setAttr(e,"tabindex","0"),this._currentIndex=a)}));this.viewStack.switchView(b);this.emit("tabChanged",b)},addTab:function(b){if(!this.average){var e=l("td:last-child",this.tabTr);0<e.length&&w.destroy(e[0])}0<
A.filter(this.tabs,function(a){return a.title===b.title}).length?console.error("tab title conflict: "+b.title):(this.tabs.push(b),this._createTab(b),this.average||this._addEmptyTab())},_addEmptyTab:function(){var b=w.toDom('\x3ctd nowrap class\x3d"tab-item-td tab-item-td-empty" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');w.place(b,this.tabTr)},removeTab:function(b){var e=-1;if(A.some(this.tabs,function(f,h){if(f.title===b)return e=h,!0})){var a=
this.tabs.splice(e,1)[0];A.some(this.tabItems,function(f,h){if(f.label===b)return this.tabItems.splice(h,1),w.destroy(f),!0},this);this.viewStack.removeView(a.content)}},showShelter:function(){w.setStyle(this.shelter,"display","block")},hideShelter:function(){w.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},_initSelf:function(){this.viewStack=new c(null,this.containerNode);this.own(m(this.containerNode,
"keydown",q.hitch(this,function(b){b.keyCode===v.ESCAPE&&(b.stopPropagation(),this.tabItems[this._currentIndex].focus())})));this.tabItems=[];A.forEach(this.tabs,function(b){this._createTab(b)},this);this.own(m(this.tabTr,"keydown",q.hitch(this,function(b){var e=b.target,a;b.keyCode===v.RIGHT_ARROW?a=e.nextElementSibling?!this.average&&w.hasClass(e.nextElementSibling,"tab-item-td-empty")?this.tabItems[0]:e.nextElementSibling:this.tabItems[0]:b.keyCode===v.LEFT_ARROW?a=e.previousElementSibling?e.previousElementSibling:
this.tabItems[this.tabItems.length-1]:b.keyCode===v.HOME?a=this.tabItems[0]:b.keyCode===v.END&&(a=this.tabItems[this.tabItems.length-1]);a&&(e=a,a.focus())})));this.average?(this.controlTable.style.tableLayout="fixed",w.addClass(this.domNode,"average")):this._addEmptyTab()},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(b){var e=w.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');e.label=b.title||"";e.title=
b.title;w.place(e,this.tabTr);var a=l(".tab-item-div",e)[0];a.innerHTML=g.sanitizeHTML(e.label);a.label=e.label;b.content.label=e.label;this.viewStack.addView(b.content);this.own(m(e,"click",q.hitch(this,function(f){this._onSelect(b.title,f)})));this.own(m(e,"keydown",q.hitch(this,function(f){f.keyCode!==v.ENTER&&f.keyCode!==v.SPACE||this._onSelect(b.title,f)})));this.tabItems.push(e)},_onSelect:function(b,e){w.hasClass(e.target,"jimu-state-active")||this.selectTab(b)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(E,q,A,w){return E([w],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",constructor:function(){this.items=[];this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(q.hitch(this,function(m){this._placeItem(m)}));this.resize()},_placeItem:function(m){m.domNode?A.place(m.domNode,this.domNode):A.place(m,this.domNode)},addItem:function(m){this.items.push(m);this._placeItem(m);
this.resize()},addItems:function(m){this.items=this.items.concat(m);this.items.forEach(q.hitch(this,function(v){this._placeItem(v)}));this.resize()},removeItem:function(m){var v;for(v=0;v<this.items.length;v++)if(this.items[v].label===m){this.items[v].domNode?this.items[v].destroy():A.destroy(this.items[v]);this.items.splice(v,1);this.resize();break}},empty:function(){var m;for(m=0;m<this.items.length;m++)this.items[m].domNode?this.items[m].destroy():A.destroy(this.items[m]);this.items=[]},resize:function(){var m=
A.getMarginBox(this.domNode);var v=this.getItemSize(m);var r=Math.floor((m.w+this.hmargin)/(v.width+this.hmargin));this.items.forEach(q.hitch(this,function(l,k){this.setItemPosition(l,k,v,r)}))},getItemSize:function(m){var v={},r;if("fixWidth"===this.strategy)v.width=this.itemSize.width,v.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(r=0;r<this.itemSize.length;r++){if(m.w<=this.itemSize[r].screenWidth){v.width=this.itemSize[r].width;v.height=this.itemSize[r].height;break}}else"fixCols"===
this.strategy&&(v.width=(m.w-this.hmargin*(this.maxCols-1))/this.maxCols,v.height="number"===typeof this.itemSize.height?this.itemSize.height:v.width*parseFloat(this.itemSize.height.substring(0,this.itemSize.height.length-1))/100);return v},setItemPosition:function(m,v,r,l){v++;var k=v%l;v=Math.ceil(v/l);0===k&&(k=l);l={position:"absolute",top:(this.vmargin+r.height)*(v-1)+"px"};l[window.isRTL?"right":"left"]=(this.hmargin+r.width)*(k-1)+"px";0<=r.width&&(l.width=r.width+"px");0<=r.height&&(l.height=
r.height+"px");A.setStyle(m.domNode?m.domNode:m,l)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dijit/a11yclick dojo/query dojo/Evented esri/graphic esri/layers/GraphicsLayer jimu/dijit/Draw esri/symbols/jsonUtils esri/geometry/Polygon".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f){var h={};return E([q,A,w,c],
{templateString:m,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,_isDisabled:!1,_shiftKey:!1,_ctrlKey:!1,_metaKey:!1,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);var p={};this.drawLayerId&&(p.id=this.drawLayerId);
this.drawLayer=new b(p);this._initDefaultSymbols();this._initTypes();p=d(".draw-item",this.domNode);p.forEach(function(B){r.setAttr(B,"role","button");r.setAttr(B,"tabindex","0")});this.own(p.on(n,v.hitch(this,this._onItemClick)));r.setAttr(this.btnClear,"role","button");r.setAttr(this.btnClear,"tabindex","0");this.own(k(this.btnClear,n,v.hitch(this,this._onClickClear)));this.own(k(document.body,"keydown",v.hitch(this,function(B){this._shiftKey=!!B.shiftKey;this._ctrlKey=!!B.ctrlKey;this._metaKey=
!!B.metaKey})));this.own(k(document.body,"keyup",v.hitch(this,function(B){this._shiftKey=!!B.shiftKey;this._ctrlKey=!!B.ctrlKey;this._metaKey=!!B.metaKey})));this.map&&this.setMap(this.map);r.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none");this.enable();h[this.id]=this},enable:function(){this._isDisabled=!1;r.addClass(this.domNode,"enabled");r.removeClass(this.domNode,"disabled")},disable:function(){this._isDisabled=!0;r.addClass(this.domNode,"disabled");r.removeClass(this.domNode,
"enabled");this.deactivate()},hideLayer:function(){this.drawLayer&&this.drawLayer.hide()},showLayer:function(){this.drawLayer&&this.drawLayer.show()},isEnabled:function(){return!this._isDisabled},isActive:function(){var p=d(".draw-item.jimu-state-active",this.domNode);return p&&0<p.length},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.deactivate();this.drawLayer&&this.map&&
this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;delete h[this.id];this.inherited(arguments)},setMap:function(p){p&&(this.map=p,this.map.addLayer(this.drawLayer),this.drawToolBar=new e(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(k(this.drawToolBar,"draw-end",v.hitch(this,this._onDrawEnd))))},setPointSymbol:function(p){this.pointSymbol=p;
this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(p){this.polylineSymbol=p;this.drawToolBar.setLineSymbol(p)},setPolygonSymbol:function(p){this.polygonSymbol=p;this.drawToolBar.setFillSymbol(p)},setTextSymbol:function(p){this.textSymbol=p},reset:function(){this.deactivate();this.clear()},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();d(".draw-item",this.domNode).removeClass("jimu-state-active");this.drawToolBar&&(this.drawToolBar.deactivate(),
this.emit("draw-deactivate"))},activate:function(p){var B=null,u=d(".draw-item",this.domNode);"TEXT"===p?(p="POINT",B=this.textIcon):(u=u.filter(function(t){return t.getAttribute("data-geotype")===p}),0<u.length&&(B=u[0]));B&&this._activate(B)},onIconSelected:function(p,B,u){this.emit("icon-selected",p,B,u)},onDrawEnd:function(p,B,u,t,z,x){this.emit("draw-end",p,B,u,t,z,x)},onClear:function(){this.emit("clear")},addGraphic:function(p){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(p)},
removeGraphic:function(p){this.drawLayer.remove(p)},getFirstGraphic:function(){var p=null;this.drawLayer&&0<this.drawLayer.graphics.length&&(p=this.drawLayer.graphics[0]);return p},show:function(){r.removeClass(this.domNode,"hidden")},hide:function(){r.addClass(this.domNode,"hidden")},getDrawItemIcons:function(){return d(".draw-item",this.domNode)},_onClickClear:function(){this._isDisabled||(this.clear(),this.emit("user-clear"))},_initDefaultSymbols:function(){var p={style:"esriSMSCircle",color:[0,
0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},B={style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},u={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=a.fromJson(p));this.polylineSymbol||(this.polylineSymbol=a.fromJson(B));this.polygonSymbol||(this.polygonSymbol=a.fromJson(u))},_initTypes:function(){this.geoTypes&&
0<this.geoTypes.length?this.types=null:(this.geoTypes=[],this.types&&0<this.types.length||(this.types=["point","arrow","polyline","polygon"]),0<=this.types.indexOf("point")&&(this.geoTypes=this.geoTypes.concat(["POINT"])),0<=this.types.indexOf("arrow")&&(this.geoTypes=this.geoTypes.concat(["ARROW"])),0<=this.types.indexOf("polyline")&&(this.geoTypes=this.geoTypes.concat(["LINE","POLYLINE","FREEHAND_POLYLINE"])),0<=this.types.indexOf("polygon")&&(this.geoTypes=this.geoTypes.concat("TRIANGLE EXTENT CIRCLE ELLIPSE POLYGON FREEHAND_POLYGON".split(" "))),
0<=this.types.indexOf("text")&&(this.geoTypes=this.geoTypes.concat(["TEXT"])));var p=d(".draw-item",this.domNode);p.style("display","none");l.forEach(p,v.hitch(this,function(B){var u=B.getAttribute("data-geotype");u=0<=l.indexOf(this.geoTypes,u);r.setStyle(B,"display",u?"block":"none")}))},_onItemClick:function(p){this._isDisabled||(p=p.target||p.srcElement,r.hasClass(p,"draw-item")&&(r.hasClass(p,"jimu-state-active")?this.deactivate():this._activate(p)))},_activate:function(p){this._deactiveAllDrawBoxes();
d(".draw-item",this.domNode).removeClass("jimu-state-active");r.addClass(p,"jimu-state-active");var B=p.getAttribute("data-geotype"),u=p.getAttribute("data-commontype"),t=e[B];"TEXT"===B&&(t=e.POINT);this.disableWebMapPopup();this.drawToolBar.activate(t);this.emit("draw-activate",t);this.onIconSelected(p,B,u)},_onDrawEnd:function(p){var B=d(".draw-item.jimu-state-active",this.domNode)[0],u=B.getAttribute("data-geotype");B=B.getAttribute("data-commontype");var t=null;t="extent"===p.geometry.type?f.fromExtent(p.geometry):
p.geometry;t.geoType=u;t.commonType=B;p=t.type;var z=null;z="point"===p||"multipoint"===p?r.hasClass(this.textIcon,"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===p||"polyline"===p?this.polylineSymbol:this.polygonSymbol;t=new g(t,z,null,null);this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(t);this.deactivateAfterDrawing&&this.deactivate();this.onDrawEnd(t,u,B,this._shiftKey,this._ctrlKey,this._metaKey)},_deactiveAllDrawBoxes:function(){var p;l.forEach(Object.keys(h),
v.hitch(this,function(B){(p=h[B])&&p.drawToolBar&&B!==this.id&&p.deactivate()}))}})})},"jimu/dijit/Draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/has esri/kernel esri/toolbars/draw esri/graphic esri/geometry/Polyline esri/geometry/Polygon esri/geometry/Multipoint esri/geometry/Rect".split(" "),function(E,q,A,w,m,v,r,l,k,n,d){var c=E([v],{baseClass:"jimu-draw",declaredClass:"jimu.dijit.Draw",_onMouseDragHandler:function(g){if(this._graphic||this._points.length)if(w("esri-touch")&&
!this._points.length)g.preventDefault();else{this._dragged=!0;if(this.map.snappingManager)var b=this.map.snappingManager._snappingPoint;var e=this._points[0],a=b||g.mapPoint,f=this.map,h=f.spatialReference;b=this._graphic;var p=c,B=f.toScreen(e),u=f.toScreen(a),t=[];t=u.x-B.x;u=u.y-B.y;var z=Math.sqrt(t*t+u*u);switch(this._geometryType){case p.CIRCLE:this._hideTooltip();b.geometry=k.createCircle({center:B,r:z,numberOfPoints:60,map:f});b.setGeometry(b.geometry);break;case p.ELLIPSE:this._hideTooltip();
b.geometry=k.createEllipse({center:B,longAxis:t,shortAxis:u,numberOfPoints:60,map:f});b.setGeometry(b.geometry);break;case p.TRIANGLE:this._hideTooltip();t=[[0,-z],[.8660254037844386*z,.5*z],[-.8660254037844386*z,.5*z],[0,-z]];b.geometry=this._toPolygon(t,B.x,B.y);b.setGeometry(b.geometry);break;case p.ARROW:this._hideTooltip();e=u/z;f=t/z;a=.25*f*z;h=.25*z/(u/t);z*=.25*e;p=this.fillSymbol?this.fillSymbol.arrowWidth:12;t=[[t,u],[t-a*(1+p/h),u+p*f-z],[t-a*(1+p/2/h),u+p/2*f-z],[-p/2*e,p/2*f],[p/2*e,
-p/2*f],[t-a*(1-p/2/h),u-p/2*f-z],[t-a*(1-p/h),u-p*f-z],[t,u]];b.geometry=this._toPolygon(t,B.x,B.y);b.setGeometry(b.geometry);break;case p.LEFT_ARROW:this._hideTooltip();t=0>=t?[[t,0],[.75*t,u],[.75*t,.5*u],[0,.5*u],[0,-.5*u],[.75*t,-.5*u],[.75*t,-u],[t,0]]:[[0,0],[.25*t,u],[.25*t,.5*u],[t,.5*u],[t,-.5*u],[.25*t,-.5*u],[.25*t,-u],[0,0]];b.geometry=this._toPolygon(t,B.x,B.y);b.setGeometry(b.geometry);break;case p.RIGHT_ARROW:this._hideTooltip();t=0<=t?[[t,0],[.75*t,u],[.75*t,.5*u],[0,.5*u],[0,-.5*
u],[.75*t,-.5*u],[.75*t,-u],[t,0]]:[[0,0],[.25*t,u],[.25*t,.5*u],[t,.5*u],[t,-.5*u],[.25*t,-.5*u],[.25*t,-u],[0,0]];b.geometry=this._toPolygon(t,B.x,B.y);b.setGeometry(b.geometry);break;case p.UP_ARROW:this._hideTooltip();t=0>=u?[[0,u],[-t,.75*u],[-.5*t,.75*u],[-.5*t,0],[.5*t,0],[.5*t,.75*u],[t,.75*u],[0,u]]:[[0,0],[-t,.25*u],[-.5*t,.25*u],[-.5*t,u],[.5*t,u],[.5*t,.25*u],[t,.25*u],[0,0]];b.geometry=this._toPolygon(t,B.x,B.y);b.setGeometry(b.geometry);break;case p.DOWN_ARROW:this._hideTooltip();t=
0<=u?[[0,u],[-t,.75*u],[-.5*t,.75*u],[-.5*t,0],[.5*t,0],[.5*t,.75*u],[t,.75*u],[0,u]]:[[0,0],[-t,.25*u],[-.5*t,.25*u],[-.5*t,u],[.5*t,u],[.5*t,.25*u],[t,.25*u],[0,0]];b.geometry=this._toPolygon(t,B.x,B.y);b.setGeometry(b.geometry);break;case p.RECTANGLE:this._hideTooltip();t=[[0,0],[t,0],[t,u],[0,u],[0,0]];b.geometry=this._toPolygon(t,B.x,B.y);b.setGeometry(b.geometry);break;case p.LINE:b.setGeometry(q.mixin(b.geometry,{paths:[[[e.x,e.y],[a.x,a.y]]]}));break;case p.EXTENT:b&&f.graphics.remove(b,!0);
b=new d(this._normalizeRect(e,a,h));b._originOnly=!0;this._graphic=f.graphics.add(new r(b,this.fillSymbol),!0);f.snappingManager&&f.snappingManager._setGraphic(this._graphic);break;case p.FREEHAND_POLYLINE:this._hideTooltip();if(!1===this._canDrawFreehandPoint(g)){w("esri-touch")&&g.preventDefault();return}this._points.push(g.mapPoint.offset(0,0));b.geometry._insertPoints([a.offset(0,0)],0);b.setGeometry(b.geometry);break;case p.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(g)){w("esri-touch")&&
g.preventDefault();return}this._points.push(g.mapPoint.offset(0,0));b.geometry._insertPoints([a.offset(0,0)],0);b.setGeometry(b.geometry)}w("esri-touch")&&g.preventDefault()}},_onClickHandler:function(g){if(this.map.snappingManager)var b=this.map.snappingManager._snappingPoint;var e=b||g.mapPoint;g=this.map;b=g.toScreen(e);var a=c;this._points.push(e.offset(0,0));switch(this._geometryType){case a.POINT:this.onDrawStart();this._drawEnd(e.offset(0,0));this._setTooltipMessage(0);break;case a.POLYLINE:1===
this._points.length?(b=new l(g.spatialReference),b.addPath(this._points),this._graphic=g.graphics.add(new r(b,this.lineSymbol),!0),g.snappingManager&&g.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=A.connect(g,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry._insertPoints([e.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol));break;case a.POLYGON:1===this._points.length?(b=new k(g.spatialReference),
b.addRing(this._points),this._graphic=g.graphics.add(new r(b,this.fillSymbol),!0),g.snappingManager&&g.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=A.connect(g,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry._insertPoints([e.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));break;case a.MULTI_POINT:b=this._points;1===b.length?(e=new n(g.spatialReference),e.addPoint(b[b.length-1]),this._graphic=
g.graphics.add(new r(e,this.markerSymbol),!0),g.snappingManager&&g.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(b[b.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case a.ARROW:g=this.fillSymbol?this.fillSymbol.arrowWidth:12;this._addShape([[0,0],[-g,g],[-g,g/2],[-96,g/2],[-96,-g/2],[-g,-g/2],[-g,-g],[0,0]],b.x,b.y);break;case a.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,
-12],[24,-24],[0,0]],b.x,b.y);break;case a.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],b.x,b.y);break;case a.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],b.x,b.y);break;case a.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],b.x,b.y);break;case a.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],b.x,b.y);break;case a.RECTANGLE:this._addShape([[0,
-96],[96,-96],[96,0],[0,0],[0,-96]],b.x-48,b.y+48);break;case a.CIRCLE:this._clear();this.onDrawStart();this._drawEnd(k.createCircle({center:b,r:48,numberOfPoints:60,map:g}));break;case a.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(k.createEllipse({center:b,longAxis:48,shortAxis:24,numberOfPoints:60,map:g}))}this._setTooltipMessage(this._points.length)}});q.mixin(c,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",
FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});w("extend-esri")&&q.setObject("toolbars.Draw",c,m);return c})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u,t,z,x,y,D){var H=E(e,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(I,N){this.markerSymbol=new a(a.STYLE_SOLID,10,new f(f.STYLE_SOLID,new m([255,0,0]),2),new m([0,0,0,.25]));this.lineSymbol=new f(f.STYLE_SOLID,new m([255,0,0]),2);this.fillSymbol=new h(h.STYLE_SOLID,new f(f.STYLE_SOLID,new m([255,0,0]),2),new m([0,0,0,.25]));this._points=[];this._mouse=!r("esri-touch")&&!r("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=q.mixin(q.mixin({},this._defaultOptions),N||{});if(l("ios")||l("android"))this._options.showTooltips=!1;this._onKeyDownHandler=q.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=q.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=q.hitch(this,this._onMouseUpHandler);this._onClickHandler=q.hitch(this,this._onClickHandler);this._onMouseMoveHandler=q.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=q.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=q.hitch(this,this._onDblClickHandler);this._updateTooltip=q.hitch(this,this._updateTooltip);this._hideTooltip=q.hitch(this,this._hideTooltip);this._redrawGraphic=q.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(I){this.respectDrawingVertexOrder=I},setMarkerSymbol:function(I){this.markerSymbol=I},setLineSymbol:function(I){this.lineSymbol=I},
setFillSymbol:function(I){this.fillSymbol=I},activate:function(I,N){this._geometryType&&this.deactivate();var S=this.map,M=w.connect,Q=H;this._options=q.mixin(q.mixin({},this._options),N||{});S.navigationManager.setImmediateClick(!1);switch(I){case Q.ARROW:case Q.LEFT_ARROW:case Q.RIGHT_ARROW:case Q.UP_ARROW:case Q.DOWN_ARROW:case Q.TRIANGLE:case Q.CIRCLE:case Q.ELLIPSE:case Q.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=M(S,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=M(S,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=M(S,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=M(S,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=M(S,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=M(S,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=M(S,"onMouseDragEnd",this._onMouseUpHandler));r("esri-touch")&&(this._onMouseDownHandler2_connect=
M(S,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=M(S,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=M(S,"onSwipeEnd",this._onMouseUpHandler));break;case Q.POINT:this._onClickHandler_connect=M(S,"onClick",this._onClickHandler);break;case Q.LINE:case Q.EXTENT:case Q.FREEHAND_POLYLINE:case Q.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=M(S,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=
M(S,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=M(S,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=M(S,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=M(S,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=M(S,"onMouseDragEnd",this._onMouseUpHandler));r("esri-touch")&&(this._onMouseDownHandler2_connect=M(S,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=M(S,"onSwipeMove",
this._onMouseDragHandler),this._onMouseUpHandler2_connect=M(S,"onSwipeEnd",this._onMouseUpHandler));break;case Q.POLYLINE:case Q.POLYGON:case Q.MULTI_POINT:S.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=M(S,"onClick",this._onClickHandler);this._onDblClickHandler_connect=M(S,"onDblClick",this._onDblClickHandler);this._dblClickZoom=S.isDoubleClickZoom;S.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+I);return}this._onKeyDown_connect=M(S,"onKeyDown",
this._onKeyDownHandler);this._redrawConnect=M(S,"onExtentChange",this._redrawGraphic);this._geometryType=I;this._toggleTooltip(!0);S.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(S.snappingManager._startSelectionLayerQuery(),S.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var I=this.map;this._clear();var N=w.disconnect;N(this._onMouseMoveHandler_connect);N(this._onMouseDownHandler_connect);N(this._onMouseDragHandler_connect);
N(this._onMouseUpHandler_connect);N(this._onMouseDownHandler2_connect);N(this._onMouseDragHandler2_connect);N(this._onMouseUpHandler2_connect);N(this._onClickHandler_connect);N(this._onDblClickHandler_connect);N(this._onKeyDown_connect);N(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=this._onMouseUpHandler2_connect=this._onClickHandler_connect=
this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;I.snappingManager&&(I.snappingManager._stopSelectionLayerQuery(),I.snappingManager._killOffSnapping());switch(this._geometryType){case H.CIRCLE:case H.ELLIPSE:case H.TRIANGLE:case H.ARROW:case H.LEFT_ARROW:case H.RIGHT_ARROW:case H.UP_ARROW:case H.DOWN_ARROW:case H.RECTANGLE:case H.LINE:case H.EXTENT:case H.FREEHAND_POLYLINE:case H.FREEHAND_POLYGON:this._activateMapTools(!0,!1,!1,!0);break;case H.POLYLINE:case H.POLYGON:case H.MULTI_POINT:this._dblClickZoom&&
I.enableDoubleClickZoom()}N=this._geometryType;this._geometryType=null;I.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(N)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._graphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},finishDrawing:function(){var I=this._points,N=this.map.spatialReference,S=H;I=I.slice(0,I.length);switch(this._geometryType){case S.POLYLINE:if(!this._graphic||2>
I.length)return;var M=new t(N);M.addPath([].concat(I));break;case S.POLYGON:if(!this._graphic||3>I.length)return;M=new z(N);I=[].concat(I,[I[0].offset(0,0)]);z.prototype.isClockwise(I)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),I.reverse());M.addRing(I);break;case S.MULTI_POINT:M=new x(N),A.forEach(I,function(Q){M.addPoint(Q)})}w.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);
this._drawEnd(M)},_drawEnd:function(I){if(I){var N=this.map.spatialReference,S;this.onDrawEnd(I);N&&(N.isWebMercator()?S=u.webMercatorToGeographic(I,!0):4326===N.wkid&&(S=B.fromJson(I.toJson())));this.onDrawComplete({geometry:I,geographicGeometry:S})}},_normalizeRect:function(I,N,S){var M=I.x;I=I.y;var Q=N.x;N=N.y;return{x:Math.min(M,Q),y:Math.max(I,N),width:Math.abs(M-Q),height:Math.abs(I-N),spatialReference:S}},_onMouseDownHandler:function(I){this._dragged=!1;if(this.map.snappingManager)var N=this.map.snappingManager._snappingPoint;
var S=N||I.mapPoint,M=H;N=this.map;var Q=N.spatialReference;this._points.push(S.offset(0,0));switch(this._geometryType){case M.LINE:this._graphic=N.graphics.add(new p(new t({paths:[[[S.x,S.y],[S.x,S.y]]],spatialReference:Q}),this.lineSymbol),!0);N.snappingManager&&N.snappingManager._setGraphic(this._graphic);break;case M.FREEHAND_POLYLINE:this._oldPoint=I.screenPoint;S=new t(Q);S.addPath(this._points);this._graphic=N.graphics.add(new p(S,this.lineSymbol),!0);N.snappingManager&&N.snappingManager._setGraphic(this._graphic);
break;case M.CIRCLE:case M.ELLIPSE:case M.TRIANGLE:case M.ARROW:case M.LEFT_ARROW:case M.RIGHT_ARROW:case M.UP_ARROW:case M.DOWN_ARROW:case M.RECTANGLE:case M.FREEHAND_POLYGON:this._oldPoint=I.screenPoint,S=new z(Q),S.addRing(this._points),this._graphic=N.graphics.add(new p(S,this.fillSymbol),!0),N.snappingManager&&N.snappingManager._setGraphic(this._graphic)}r("esri-touch")&&I.preventDefault();if(1===this._points.length)this.onDrawStart()},_onMouseMoveHandler:function(I){if(this.map.snappingManager)var N=
this.map.snappingManager._snappingPoint;I=N||I.mapPoint;N=this._graphic.geometry;switch(this._geometryType){case H.POLYLINE:case H.POLYGON:var S=this._points.length,M=!!N.getPoint(0,S);I=I.offset(0,0);M?N.setPoint(0,S,I):N.insertPoint(0,S,I);this._graphic.setGeometry(N)}},_onMouseDragHandler:function(I){if(this._graphic||this._points.length)if(r("esri-touch")&&!this._points.length)I.preventDefault();else{this._dragged=!0;if(this.map.snappingManager)var N=this.map.snappingManager._snappingPoint;var S=
this._points[0],M=N||I.mapPoint,Q=this.map,da=Q.spatialReference;N=this._graphic;var J=H,R=Q.toScreen(S),W=Q.toScreen(M),X=[];X=W.x-R.x;W=W.y-R.y;var ia=Math.sqrt(X*X+W*W);switch(this._geometryType){case J.CIRCLE:this._hideTooltip();N.geometry=z.createCircle({center:R,r:ia,numberOfPoints:60,map:Q});N.setGeometry(N.geometry);break;case J.ELLIPSE:this._hideTooltip();N.geometry=z.createEllipse({center:R,longAxis:X,shortAxis:W,numberOfPoints:60,map:Q});N.setGeometry(N.geometry);break;case J.TRIANGLE:this._hideTooltip();
X=[[0,-ia],[.8660254037844386*ia,.5*ia],[-.8660254037844386*ia,.5*ia],[0,-ia]];N.geometry=this._toPolygon(X,R.x,R.y);N.setGeometry(N.geometry);break;case J.ARROW:this._hideTooltip();S=W/ia;Q=X/ia;M=.25*Q*ia;da=.25*ia/(W/X);ia*=.25*S;X=[[X,W],[X-M*(1+24/da),W+24*Q-ia],[X-M*(1+12/da),W+12*Q-ia],[-12*S,12*Q],[12*S,-12*Q],[X-M*(1-12/da),W-12*Q-ia],[X-M*(1-24/da),W-24*Q-ia],[X,W]];N.geometry=this._toPolygon(X,R.x,R.y);N.setGeometry(N.geometry);break;case J.LEFT_ARROW:this._hideTooltip();X=0>=X?[[X,0],
[.75*X,W],[.75*X,.5*W],[0,.5*W],[0,-.5*W],[.75*X,-.5*W],[.75*X,-W],[X,0]]:[[0,0],[.25*X,W],[.25*X,.5*W],[X,.5*W],[X,-.5*W],[.25*X,-.5*W],[.25*X,-W],[0,0]];N.geometry=this._toPolygon(X,R.x,R.y);N.setGeometry(N.geometry);break;case J.RIGHT_ARROW:this._hideTooltip();X=0<=X?[[X,0],[.75*X,W],[.75*X,.5*W],[0,.5*W],[0,-.5*W],[.75*X,-.5*W],[.75*X,-W],[X,0]]:[[0,0],[.25*X,W],[.25*X,.5*W],[X,.5*W],[X,-.5*W],[.25*X,-.5*W],[.25*X,-W],[0,0]];N.geometry=this._toPolygon(X,R.x,R.y);N.setGeometry(N.geometry);break;
case J.UP_ARROW:this._hideTooltip();X=0>=W?[[0,W],[-X,.75*W],[-.5*X,.75*W],[-.5*X,0],[.5*X,0],[.5*X,.75*W],[X,.75*W],[0,W]]:[[0,0],[-X,.25*W],[-.5*X,.25*W],[-.5*X,W],[.5*X,W],[.5*X,.25*W],[X,.25*W],[0,0]];N.geometry=this._toPolygon(X,R.x,R.y);N.setGeometry(N.geometry);break;case J.DOWN_ARROW:this._hideTooltip();X=0<=W?[[0,W],[-X,.75*W],[-.5*X,.75*W],[-.5*X,0],[.5*X,0],[.5*X,.75*W],[X,.75*W],[0,W]]:[[0,0],[-X,.25*W],[-.5*X,.25*W],[-.5*X,W],[.5*X,W],[.5*X,.25*W],[X,.25*W],[0,0]];N.geometry=this._toPolygon(X,
R.x,R.y);N.setGeometry(N.geometry);break;case J.RECTANGLE:this._hideTooltip();X=[[0,0],[X,0],[X,W],[0,W],[0,0]];N.geometry=this._toPolygon(X,R.x,R.y);N.setGeometry(N.geometry);break;case J.LINE:N.setGeometry(q.mixin(N.geometry,{paths:[[[S.x,S.y],[M.x,M.y]]]}));break;case J.EXTENT:N&&Q.graphics.remove(N,!0);N=new y(this._normalizeRect(S,M,da));N._originOnly=!0;this._graphic=Q.graphics.add(new p(N,this.fillSymbol),!0);Q.snappingManager&&Q.snappingManager._setGraphic(this._graphic);break;case J.FREEHAND_POLYLINE:this._hideTooltip();
if(!1===this._canDrawFreehandPoint(I)){r("esri-touch")&&I.preventDefault();return}this._points.push(I.mapPoint.offset(0,0));N.geometry._insertPoints([M.offset(0,0)],0);N.setGeometry(N.geometry);break;case J.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(I)){r("esri-touch")&&I.preventDefault();return}this._points.push(I.mapPoint.offset(0,0));N.geometry._insertPoints([M.offset(0,0)],0);N.setGeometry(N.geometry)}r("esri-touch")&&I.preventDefault()}},_canDrawFreehandPoint:function(I){if(!this._oldPoint)return!1;
var N=this._oldPoint.x-I.screenPoint.x,S=this._oldPoint.y-I.screenPoint.y,M=this._options.tolerance;if((0>N?-1*N:N)<M&&(0>S?-1*S:S)<M)return!1;N=new Date;if(N-this._startTime<this._options.drawTime)return!1;this._startTime=N;this._oldPoint=I.screenPoint;return!0},_onMouseUpHandler:function(I){if(this._dragged&&this._graphic){0===this._points.length&&this._points.push(I.mapPoint.offset(0,0));if(this.map.snappingManager)var N=this.map.snappingManager._snappingPoint;var S=this._points[0];N=N||I.mapPoint;
var M=this.map.spatialReference,Q=H;switch(this._geometryType){case Q.CIRCLE:case Q.ELLIPSE:case Q.TRIANGLE:case Q.ARROW:case Q.LEFT_ARROW:case Q.RIGHT_ARROW:case Q.UP_ARROW:case Q.DOWN_ARROW:case Q.RECTANGLE:var da=this._graphic.geometry;break;case Q.LINE:da=new t({paths:[[[S.x,S.y],[N.x,N.y]]],spatialReference:M});break;case Q.EXTENT:da=(new y(this._normalizeRect(S,N,M))).getExtent();break;case Q.FREEHAND_POLYLINE:da=new t(M);da.addPath([].concat(this._points,[N.offset(0,0)]));break;case Q.FREEHAND_POLYGON:da=
new z(M),S=[].concat(this._points,[N.offset(0,0),this._points[0].offset(0,0)]),z.prototype.isClockwise(S)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),S.reverse()),da.addRing(S)}r("esri-touch")&&I.preventDefault();this._clear();this._drawEnd(da)}else this._clear()},_isPointToPointTool:function(I){switch(I){case H.POLYLINE:case H.POLYGON:case H.MULTI_POINT:return!0;default:return!1}},_onClickHandler:function(I){if(this.map.snappingManager)var N=
this.map.snappingManager._snappingPoint;N=N||I.mapPoint;I=this.map;var S=I.toScreen(N),M=H;if(this._isPointToPointTool(this._geometryType)){var Q=this._points[this._points.length-1];if(N&&Q&&N.x===Q.x&&N.y===Q.y)return;this._points.push(N.offset(0,0))}switch(this._geometryType){case M.POINT:this.onDrawStart();this._drawEnd(N.offset(0,0));this._setTooltipMessage(0);break;case M.POLYLINE:1===this._points.length?(N=new t(I.spatialReference),N.addPath(this._points),this._graphic=I.graphics.add(new p(N,
this.lineSymbol),!0),I.snappingManager&&I.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=w.connect(I,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,N.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol));break;case M.POLYGON:1===this._points.length?(N=new z(I.spatialReference),N.addRing(this._points),this._graphic=I.graphics.add(new p(N,this.fillSymbol),
!0),I.snappingManager&&I.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=w.connect(I,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,N.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));break;case M.MULTI_POINT:N=this._points;1===N.length?(S=new x(I.spatialReference),S.addPoint(N[N.length-1]),this._graphic=I.graphics.add(new p(S,this.markerSymbol),
!0),I.snappingManager&&I.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(N[N.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case M.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],S.x,S.y);break;case M.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],S.x,S.y);break;case M.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,
12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],S.x,S.y);break;case M.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],S.x,S.y);break;case M.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],S.x,S.y);break;case M.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],S.x,S.y);break;case M.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],S.x-48,S.y+48);break;case M.CIRCLE:this._clear();
this.onDrawStart();this._drawEnd(z.createCircle({center:S,r:48,numberOfPoints:60,map:I}));break;case M.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(z.createEllipse({center:S,longAxis:48,shortAxis:24,numberOfPoints:60,map:I}))}this._setTooltipMessage(this._points.length)},_addShape:function(I,N,S){this._setTooltipMessage(0);this._clear();this.onDrawStart();this._drawEnd(this._toPolygon(I,N,S))},_toPolygon:function(I,N,S){var M=this.map,Q=new z(M.spatialReference);Q.addRing(A.map(I,function(da){return M.toMap({x:da[0]+
N,y:da[1]+S})}));return Q},_onDblClickHandler:function(I){var N=this._points,S=this.map.spatialReference,M=H;r("esri-touch")&&N.push(I.mapPoint);var Q=N[N.length-1],da=N[N.length-2];N=Q&&da&&Q.x===da.x&&Q.y===da.y?N.slice(0,N.length-1):N.slice(0,N.length);switch(this._geometryType){case M.POLYLINE:if(!this._graphic||2>N.length){w.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(I);return}var J=new t(S);J.addPath([].concat(N));break;case M.POLYGON:if(!this._graphic||
3>N.length)return;J=new z(S);I=[].concat(N,[N[0].offset(0,0)]);z.prototype.isClockwise(I)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),I.reverse());J.addRing(I);break;case M.MULTI_POINT:J=new x(S),A.forEach(N,function(R){J.addPoint(R)})}w.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(J)},_onKeyDownHandler:function(I){I.keyCode===k.ESCAPE&&
(w.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(I){this._options.showTooltips&&(I?this._tooltip||(this._tooltip=n.create("div",{"class":"esriMapTooltip"},this.map.container),c.isBodyLtr()||d.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=w.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=
w.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=w.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(w.disconnect(this._onTooltipMouseEnterHandler_connect),w.disconnect(this._onTooltipMouseLeaveHandler_connect),w.disconnect(this._onTooltipMouseMoveHandler_connect),n.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var I=this._tooltip;I&&(I.style.display="none")},_setTooltipMessage:function(I){var N=this._tooltip;if(N){var S=
"";switch(this._geometryType){case H.POINT:S=D.toolbars.draw.addPoint;break;case H.ARROW:case H.LEFT_ARROW:case H.RIGHT_ARROW:case H.UP_ARROW:case H.DOWN_ARROW:case H.TRIANGLE:case H.RECTANGLE:case H.CIRCLE:case H.ELLIPSE:S=D.toolbars.draw.addShape;break;case H.LINE:case H.EXTENT:case H.FREEHAND_POLYLINE:case H.FREEHAND_POLYGON:S=D.toolbars.draw.freehand;break;case H.POLYLINE:case H.POLYGON:S=D.toolbars.draw.start;1===I?S=D.toolbars.draw.resume:2<=I&&(S=D.toolbars.draw.complete);break;case H.MULTI_POINT:S=
D.toolbars.draw.addMultipoint,1<=I&&(S=D.toolbars.draw.finish)}N.innerHTML=S}},_updateTooltip:function(I){var N=this._tooltip;if(N){if(I.clientX||I.pageY){var S=I.clientX;I=I.clientY}else S=I.clientX+v.body().scrollLeft-v.body().clientLeft,I=I.clientY+v.body().scrollTop-v.body().clientTop;N.style.display="none";d.set(N,{left:S+this._options.tooltipOffset+"px",top:I+"px"});N.style.display=""}},_redrawGraphic:function(I,N,S,M){(S||this.map.wrapAround180)&&(I=this._graphic)&&I.setGeometry(I.geometry)},
onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawStart:function(){},onDrawEnd:function(){}});q.mixin(H,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});r("extend-esri")&&
q.setObject("toolbars.Draw",H,g);return H})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(E,q,A,w,m){E=E([m],{declaredClass:"esri.toolbars._Toolbar",constructor:function(v){this.map=v},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(v,
r,l,k){var n=this.map;v&&(this._mapNavState={isDoubleClickZoom:n.isDoubleClickZoom,isClickRecenter:n.isClickRecenter,isPan:n.isPan,isRubberBandZoom:n.isRubberBandZoom,isKeyboardNavigation:n.isKeyboardNavigation,isScrollWheelZoom:n.isScrollWheelZoom},n.disableDoubleClickZoom(),n.disableClickRecenter(),n.disablePan(),n.disableRubberBandZoom(),n.disableKeyboardNavigation());r&&n.hideZoomSlider();l&&n.hidePanArrows();k&&n.graphics.disableMouseEvents()},_activateMapTools:function(v,r,l,k){var n=this.map,
d=this._mapNavState;v&&d&&(d.isDoubleClickZoom&&n.enableDoubleClickZoom(),d.isClickRecenter&&n.enableClickRecenter(),d.isPan&&n.enablePan(),d.isRubberBandZoom&&n.enableRubberBandZoom(),d.isKeyboardNavigation&&n.enableKeyboardNavigation(),d.isScrollWheelZoom&&n.enableScrollWheelZoom());r&&n.showZoomSlider();l&&n.showPanArrows();k&&n.graphics.enableMouseEvents()},_deactivateScrollWheel:function(){var v=this.map;this._scrollWheelState={isScrollWheelZoom:v.isScrollWheelZoom,isScrollWheelPan:v.isScrollWheelPan};
v.disableScrollWheelZoom();v.disableScrollWheelPan()},_activateScrollWheel:function(){var v=this.map,r=this._scrollWheelState;r&&(r.isScrollWheelZoom&&v.enableScrollWheelZoom(),r.isScrollWheelPan&&v.enableScrollWheelPan())}});A("extend-esri")&&q.setObject("toolbars._Toolbar",E,w);return E})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(E,q,A,w){return E([A],{declaredClass:"jimu.dijit.URLInput",required:!0,
invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!0,allowLocal:!0,postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?this.nls.invalidUrl:"Invalid Url"},postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-url-input")},validator:function(m){if(!1===this.required&&""===m)return!0;if(isFinite(m))return!1;var v="^"+w.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal});v=new RegExp(v,"g");v.lastIndex=
0;v=v.test(m);return this.rest?(m=/\/rest\/services/gi.test(m),v&&m):v}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(E,q,A){var w=E.getObject("validate.regexp",!0,A);return w=A.validate.regexp={ipAddress:function(m){m="object"==typeof m?m:{};"boolean"!=typeof m.allowDottedDecimal&&(m.allowDottedDecimal=!0);"boolean"!=typeof m.allowDottedHex&&(m.allowDottedHex=!0);"boolean"!=typeof m.allowDottedOctal&&(m.allowDottedOctal=!0);"boolean"!=typeof m.allowDecimal&&
(m.allowDecimal=!0);"boolean"!=typeof m.allowHex&&(m.allowHex=!0);"boolean"!=typeof m.allowIPv6&&(m.allowIPv6=!0);"boolean"!=typeof m.allowHybrid&&(m.allowHybrid=!0);var v=[];m.allowDottedDecimal&&v.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");m.allowDottedHex&&v.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");m.allowDottedOctal&&v.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");m.allowDecimal&&v.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");
m.allowHex&&v.push("0[xX]0*[\\da-fA-F]{1,8}");m.allowIPv6&&v.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");m.allowHybrid&&v.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");m="";0<v.length&&(m="("+v.join("|")+")");return m},host:function(m){m="object"==typeof m?m:{};"boolean"!=typeof m.allowIP&&(m.allowIP=!0);"boolean"!=typeof m.allowLocal&&(m.allowLocal=!1);"boolean"!=typeof m.allowPort&&(m.allowPort=!0);"boolean"!=typeof m.allowNamed&&
(m.allowNamed=!1);var v=m.allowPort?"(\\:\\d+)?":"",r="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.?)";m.allowIP&&(r+="|"+w.ipAddress(m));m.allowLocal&&(r+="|localhost");m.allowNamed&&(r+="|^[^-][a-zA-Z0-9_-]*");return"("+r+")"+v},url:function(m){m="object"==typeof m?m:{};"scheme"in m||(m.scheme=[!0,!1]);return q.buildGroupRE(m.scheme,function(v){return v?"(https?|ftps?)\\://":""})+w.host(m)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},
emailAddress:function(m){m="object"==typeof m?m:{};"boolean"!=typeof m.allowCruft&&(m.allowCruft=!1);m.allowPort=!1;var v="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+w.host(m);m.allowCruft&&(v="\x3c?(mailto\\:)?"+v+"\x3e?");return v},emailAddressList:function(m){m="object"==typeof m?m:{};"string"!=typeof m.listSeparator&&(m.listSeparator="\\s;,");var v=w.emailAddress(m);return"("+v+"\\s*["+m.listSeparator+"]\\s*)*"+v+"\\s*["+m.listSeparator+"]?\\s*"},numberFormat:function(m){m=
"object"==typeof m?m:{};"undefined"==typeof m.format&&(m.format="###-###-####");return q.buildGroupRE(m.format,function(v){return q.escapeString(v,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(m){m="object"==typeof m?m:{};"boolean"!=typeof m.allowTerritories&&(m.allowTerritories=!0);"boolean"!=typeof m.allowMilitary&&(m.allowMilitary=!0);
var v="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";m.allowTerritories&&(v+="|AS|FM|GU|MH|MP|PW|PR|VI");m.allowMilitary&&(v+="|AA|AE|AP");return"("+v+")"}}}})},"jimu/dijit/ColorPalette":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dojo/query jimu/dijit/ColorChooser jimu/dijit/CustomColorPicker jimu/dijit/ColorRecords dijit/popup jimu/utils dijit/a11yclick".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a){return q([A,m,w,E],{templateString:"\x3cdiv\x3e\x3c/div\x3e",baseClass:"jimu-color-palette",declaredClass:"jimu.dijit.ColorPalette",_TRANSPARENT_STR:"rgba(0, 0, 0, 0)",value:"",_defaultAppearance:{showTransparent:!0,showColorPalette:!0,showCoustom:!0,showColorPickerOK:!1,showColorPickerApply:!0,showCoustomRecord:!0,closeDialogWhenChange:!1},recordUID:"",postMixInProperties:function(){this.nls=window.jimuNls.colorPalette},postCreate:function(){this.inherited(arguments);
this.value=this.value?new k(this.value):new k("#fff");this._createContent()},initUI:function(){this._toggleCustomColorPicker("init",!1)},_createContent:function(){this.appearance=v.mixin(this._defaultAppearance,this.appearance);var f=r.create("div",{"class":"jimu-colorpalette"},this.domNode);this.initPanel=r.create("div",{"class":"init-panel"},f);this.customPanel=r.create("div",{"class":"custom-panel hide"},f);this.appearance.showTransparent&&this._createSpecialColors(this.initPanel);this.appearance.showColorPalette&&
this._createColorChooser(this.initPanel);this.appearance.showCoustom&&this._createCustomColorPicker(this.initPanel);this.appearance.showCoustom&&this.appearance.showCoustomRecord&&this._createCoustomRecord(this.initPanel)},setColor:function(f){this._isColorEqual(f)||(this.value=new k(f),this._setSpatialColor(this.value),"undefined"!==typeof this.value.a&&0===this.value.a?(this.colorChooser.setColor(new k("transparent"),!1),this.picker.setColor(new k("#fff"),!1)):(this.colorChooser.setColor(this.value.toHex(),
!1),this.picker.setColor(this.value,!1)),this.colorRecords&&this.colorRecords.selecteColor(this.value))},getColor:function(){return this.value},changeColor:function(f){if("undefined"!==typeof this.value.a&&0===this.value.a)this.onChange(this.value);else this.onChange(this.value.toHex());this.emit("change",this.value);!0===this.appearance.closeDialogWhenChange&&!1!==f&&this._closeDialog()},refreshRecords:function(){this.colorRecords&&this.colorRecords.refresh()},destroy:function(){b.close(this.tooltipDialog);
this.picker.destroy();this.inherited(arguments)},_createSpecialColors:function(f){f=r.create("div",{"class":"special-color"},f);this.transparentBtn=r.create("div",{"class":"transparent btn",innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"transparent icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"transparent text jimu-float-leading"\x3e'+this.nls.transparent+"\x3c/div\x3e\x3c/div\x3e"},f);this.own(l(this.transparentBtn,a,v.hitch(this,this._onTransparentClick)))},_onTransparentClick:function(){this.setColor(new k("transparent"));
this.changeColor()},_setSpatialColor:function(f){if(this.transparentBtn){var h=n(".btn-wapper",this.transparentBtn)[0];r.removeClass(h,"selected");f&&f.toString&&f.toString()===this._TRANSPARENT_STR&&r.addClass(h,"selected")}},_createColorChooser:function(f){this.colorChooser=new d({});this.colorChooser.placeAt(f);this.own(l(this.colorChooser,"change",v.hitch(this,function(h){h=new k(h);this.setColor(h);this.changeColor()})))},_createCustomColorPicker:function(){this.coustomtBtn=r.create("div",{"class":"coustom btn",
innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"custom icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"custom text jimu-float-leading"\x3e'+this.nls.custom+"\x3c/div\x3e\x3c/div\x3e"},this.initPanel);this.own(l(this.coustomtBtn,"click",v.hitch(this,function(){this._toggleCustomColorPicker("custom")})));this.picker=new c({showOk:this.appearance.showColorPickerOK,showApply:this.appearance.showColorPickerApply,value:this.value.toHex()});this.picker.placeAt(this.customPanel);this.picker.setColor(this.value);
this.own(l(this.picker,"ok",v.hitch(this,function(f){this.setColor(new k(f));this.changeColor();this._addAColorRecord(f);this._toggleCustomColorPicker("init");this._closeDialog()})));this.own(l(this.picker,"apply",v.hitch(this,function(f){this.setColor(new k(f));this.changeColor(!1);this._addAColorRecord(f)})));this.own(l(this.picker,"cancel",v.hitch(this,function(){this._toggleCustomColorPicker("init");this._closeDialog()})))},_toggleCustomColorPicker:function(f,h){"custom"===f?(r.removeClass(this.customPanel,
"hide"),r.addClass(this.initPanel,"hide")):(r.addClass(this.customPanel,"hide"),r.removeClass(this.initPanel,"hide"));"undefined"!==typeof h&&!1===h||this.emit("change-style")},_createCoustomRecord:function(f){this.colorRecords=new g({recordsLength:10,uid:this.recordUID||""});this.colorRecords.placeAt(f);this.own(l(this.colorRecords,"choose",v.hitch(this,function(h){this.setColor(new k(h));this.changeColor()})))},_addAColorRecord:function(f){this.colorRecords&&this.colorRecords.push&&this.colorRecords.push(f)},
_isColorEqual:function(f){return this.value.toString()===(new k(f)).toString()?!0:!1},_changeLabel:function(f){r.empty(this.domNode);r.create("span",{innerHTML:f.toHex(),className:"color-label",style:{color:e.invertColor(f.toHex())}},this.domNode)},onOpen:function(){this.openDialog()},openDialog:function(){this.initUI()},_closeDialog:function(){this.emit("close")},onClose:function(){this._closeDialog()}})})},"jimu/dijit/ColorChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/i18n dojo/_base/Color dijit/a11yclick dojo/i18n!dojo/nls/colors".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c){return q([A,w,m,E],{templateString:'\x3cdiv\x3e\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\x3ctable class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e',baseClass:"jimu-color-chooser",declaredClass:"jimu.dijit.ColorChooser",uid:"",colorsArray:["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),
"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),
"rgb(0,0,1) darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],postCreate:function(){this.inherited(arguments);this.colorTitleNls=n.getLocalization("dojo","colors");this._createColorsBlocks()},_createColorsBlocks:function(){this._row=this.colorsArray.length;this._col=this.colorsArray[0].length;for(var g=0;g<this._row;g++)for(var b=r.create("tr",{role:"row"},this.gridNode),e=0;e<this._col;e++){var a=this.colorsArray[g][e],f=d.named[a],h="";f?h=a:"rgb(0,0,1)"===
a&&(h="black",f="rgb(0,0,1)");a=this.colorTitleNls[h];f=(new d(f)).toString();this["record"+e]=r.create("td",{"class":"dijitPaletteCell","data-title":f,role:"gridcell"},b);var p=r.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+e]);r.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),alt:a,title:a,"data-title":h,width:"16px",height:"16px",style:"background-color: "+f},p)}this.own(l(this.gridNode,c,v.hitch(this,this.onColorClick)))},onColorClick:function(g){for(var b=
g.target;"TD"!==b.tagName;){if(!b.parentNode||b===this.gridNode)return;b=b.parentNode}b=r.getAttr(b,"data-title");b=(new d(b)).toString();this.setColor(b);g.stopPropagation();g.preventDefault()},_onChange:function(g){this.emit("change",g)},setColor:function(g,b){g=new d(g);for(var e=null,a=k("td",this.domNode),f=0,h=a.length;f<h;f++)r.removeClass(a[f],"dijitPaletteCellSelected");f=0;for(h=a.length;f<h;f++)if(g.toString()===r.getAttr(a[f],"data-title")){e=a[f];break}e&&r.addClass(e,"dijitPaletteCellSelected");
(e&&"undefined"===typeof b||!0===b)&&this._onChange(g)}})})},"jimu/dijit/CustomColorPicker":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color jimu/dijit/ColorSelector".split(" "),function(E,q,A,w,m,v,r,l,k){return q([A,w,E],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,
ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof l||(this.color=new l(this.color)):this.color=new l("#ccc");v.setStyle(this.domNode,"backgroundColor",this.color.toHex());this._createDialog(this.domNode)},destroy:function(){this.picker.destroy();this.inherited(arguments)},_handlerOk:function(n){n&&n.stopPropagation&&n.preventDefault&&(n.stopPropagation(),n.preventDefault());this.emit("ok",
this.color)},_handlerApply:function(n){n&&n.stopPropagation&&n.preventDefault&&(n.stopPropagation(),n.preventDefault());this.emit("apply",this.color)},_handlerCancel:function(n){n&&n.stopPropagation&&n.preventDefault&&(n.stopPropagation(),n.preventDefault());this.emit("cancel")},_createDialog:function(){var n=v.create("div",{"class":"dojox-color-picker-container"},this.domNode),d=new k({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:m.hitch(this,function(g){g=
new l(g);this.setColor(g)})});d.placeAt(n);d.startup();n=v.create("div",{"class":"btns-container jimu-float-trailing"},n);if(!0===this.showOk){var c=v.create("div",{"class":"jimu-btn jimu-float-leading ok",title:this.nls.ok,innerHTML:this.nls.ok},n);this.own(r(c,"click",m.hitch(this,function(g){var b=this.picker.get("value");this.setColor(new l(b));this._handlerOk(g)})))}!0===this.showApply&&(c=v.create("div",{"class":"jimu-btn jimu-float-leading apply",title:this.nls.apply,innerHTML:this.nls.apply},
n),this.own(r(c,"click",m.hitch(this,function(g){var b=this.picker.get("value");this.setColor(new l(b));this._handlerApply(g)}))));n=v.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-leading",title:this.nls.cancel,innerHTML:this.nls.cancel},n);this.own(r(n,"click",m.hitch(this,function(g){this._handlerCancel(g)})));this.picker=d},setColor:function(n){if(n instanceof l){var d=this.color,c="";d&&(c=d.toHex());d=n.toHex();this.color=n;c!==d&&this.picker.set("value",d)}},getColor:function(){return this.color},
onClose:function(){}})})},"jimu/dijit/ColorRecords":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/_base/Color dojo/cookie dojo/text!./templates/ColorRecords.html dijit/a11yclick".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g){return q([A,w,m,E],{templateString:c,baseClass:"jimu-color-records",declaredClass:"jimu.dijit.ColorRecords",uid:"",recordsLength:10,colorList:null,
postCreate:function(){this.inherited(arguments);this.colorList=[];this._createCoustomRecord();""===this.uid&&(this.uid="wab_colorRecords");this.refresh()},push:function(b){this.colorList.unshift(b);this.colorList.length>this.recordsLength&&this.colorList.pop();this._setColors()},selecteColor:function(b){b=new n(b);for(var e=null,a=k("td",this.domNode),f=0,h=a.length;f<h;f++)r.removeClass(a[f],"dijitPaletteCellSelected");f=0;for(h=a.length;f<h;f++)if(b.toString()===r.getAttr(a[f],"title")){e=a[f];
break}e&&(r.addClass(e,"dijitPaletteCellSelected"),this.onChoose(b))},refresh:function(){this._getCookie(this.uid);this._setColors()},_setColors:function(){for(var b=0;b<this.recordsLength;b++){var e=this["record"+b];if(e&&this.colorList[b]&&this.colorList[b].toString){var a=this.colorList[b].toString();r.setAttr(e,"title",a);e=this._findImg(e);r.setStyle(e,"background-color",a);r.setAttr(e,"alt",a);r.setAttr(e,"title",a)}}this._setCookie(this.uid)},_createCoustomRecord:function(){for(var b=0;b<this.recordsLength;b++){this["record"+
b]=r.create("td",{"class":"dijitPaletteCell",tabindex:b,title:"",role:"gridcell"},this.container);var e=r.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+b]);r.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),style:"background-color: #ffffff"},e)}this.own(l(this.gridNode,g,v.hitch(this,this.onRecordClick)))},onRecordClick:function(b){for(var e=b.target;"TD"!==e.tagName;){if(!e.parentNode||e===this.gridNode)return;e=e.parentNode}e=r.getAttr(e,
"title");e=(new n(e)).toString();this.onChoose(e);b.stopPropagation();b.preventDefault()},onChoose:function(b){this.emit("choose",b)},_findImg:function(b){var e=null;return b.nodeName&&"IMG"===b.nodeName.toUpperCase()?b:e=k(".dijitColorPaletteSwatch",b)[0]},_setCookie:function(b){for(var e=[],a=0,f=this.recordsLength;a<f;a++){var h=this.colorList[a];h&&h.toString&&(e[a]=h.toString())}this._cleanCookie(b);try{var p=JSON.stringify(e);d(b,p,{expires:1E3,path:"/"})}catch(B){console.error("ColorRecords: cookieList JSON.stringify error."+
B.stack)}},_getCookie:function(b){b=d(b);if("undefined"!==typeof b)try{var e=JSON.parse(b);if(e&&"undefined"!==typeof e.length){b=0;for(var a=this.recordsLength;b<a;b++){var f=e[b];f&&f.toString&&(this.colorList[b]=new n(f.toString()))}}}catch(h){console.error("ColorRecords: cookieList JSON.parse error."+h.stack)}},_cleanCookie:function(b){d(b,null,{expires:-1})}})})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle ./a11y/OnScreenWidgetPanel dojo/touch".split(" "),
function(E,q,A,w,m,v,r,l,k,n){E=E([r,v],{baseClass:"jimu-panel jimu-on-screen-widget-panel jimu-main-background",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode" role\x3d"dialog" aria-label\x3d"${label}"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3ch2 class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode" tabindex\x3d"-1" data-dojo-attach-event\x3d"onkeydown:_onTitleLabelKeyDown"\x3e${label}\x3c/h2\x3e\x3cdiv class\x3d"btns-container"\x3e\x3cdiv tabindex\x3d"0" class\x3d"foldable-btn jimu-vcenter" aria-label\x3d"${headerNls.foldWindow}" role\x3d"button"data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked,onkeydown:_onFoldableBtnKeyDown"\x3e\x3c/div\x3e\x3cdiv tabindex\x3d"0" class\x3d"max-btn jimu-vcenter" aria-label\x3d"${headerNls.maxWindow}" role\x3d"button"data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked,onkeydown:_onMaxBtnKeyDown"\x3e\x3c/div\x3e\x3cdiv tabindex\x3d"0" class\x3d"close-btn jimu-vcenter" aria-label\x3d"${headerNls.closeWindow}" role\x3d"button"data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,onkeydown:_onCloseBtnKey"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postMixInProperties:function(){this.headerNls=window.jimuNls.panelHeader},postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w);this.a11y_init()},_onMaxBtnClicked:function(d){d.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?(A.setAttr(this.maxNode,"aria-label",
this.headerNls.maxWindow),this.panelManager.normalizePanel(this)):(A.setAttr(this.maxNode,"aria-label",this.headerNls.restoreWindow),this.panelManager.maximizePanel(this),A.removeClass(this.foldableNode,"fold-up"),A.addClass(this.foldableNode,"fold-down"),A.setAttr(this.foldableNode,"aria-label",this.headerNls.foldWindow)),this._setMobilePosition());this.panelManager.activatePanel(this)},_onFoldableBtnClicked:function(d){d&&d.stopPropagation();this._getPositionInfo().isRunInMobile&&("minimized"===
this.windowState?(A.removeClass(this.foldableNode,"fold-up"),A.addClass(this.foldableNode,"fold-down"),A.setAttr(this.foldableNode,"aria-label",this.headerNls.foldWindow),this.panelManager.normalizePanel(this)):(A.removeClass(this.foldableNode,"fold-down"),A.addClass(this.foldableNode,"fold-up"),A.setAttr(this.foldableNode,"aria-label",this.headerNls.unfoldWindow),this.panelManager.minimizePanel(this)),A.setAttr(this.maxNode,"aria-label",this.headerNls.maxWindow),this._setMobilePosition())},_onCloseBtnClicked:function(d){d.preventDefault();
d.stopPropagation();this.panelManager.closePanel(this)},_normalizePositionObj:function(d){var c=this._getLayoutBox();d.left=isFinite(d.left)?d.left:c.w-d.right;d.top=isFinite(d.top)?d.top:c.h-d.bottom;delete d.right;delete d.bottom;this.position=q.mixin(q.clone(this.position),d)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||
400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();this.resizeHandle=(new k({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(d,c){this.disableMoveable();var g=A.getMarginBox(jimuConfig.layoutId);g.l=g.l-d+
c;g.w+=2*(d-c);this.moveable=new m.boxConstrainedMoveable(this.domNode,{box:g,handle:this.titleNode,within:!0});this.own(w(this.moveable,"Moving",q.hitch(this,this.onMoving)));this.own(w(this.moveable,"MoveStop",q.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);window.appInfo.isRunInMobile&&(this._setMobilePosition(),
l.isInNavMode()&&"minimized"===this.windowState&&this._onFoldableBtnClicked());this.inherited(arguments)},_switchToMobileUI:function(){A.removeClass(this.titleNode,"title-normal");A.addClass(this.titleNode,"title-full");A.setStyle(this.foldableNode,"display","block");A.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(A.removeClass(this.foldableNode,"fold-up"),A.addClass(this.foldableNode,"fold-down"),A.setAttr(this.foldableNode,"aria-label",this.headerNls.foldWindow)):(A.removeClass(this.foldableNode,
"fold-down"),A.addClass(this.foldableNode,"fold-up"),A.setAttr(this.foldableNode,"aria-label",this.headerNls.unfoldWindow))},_switchToDesktopUI:function(){A.removeClass(this.titleNode,"title-full");A.addClass(this.titleNode,"title-normal");A.setStyle(this.foldableNode,"display","none");A.setStyle(this.maxNode,"display","none")},resize:function(d){var c=this._getPositionInfo(),g={left:c.position.left,top:c.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};d&&(d.t=this.domNode.offsetTop,
g.left=isFinite(d.l)?d.l:g.left,g.top=isFinite(d.t)?d.t:g.top,g.width=isFinite(d.w)?d.w:g.width,g.height=isFinite(d.h)?d.h:g.height,this._normalizePositionObj(q.clone(g)),this.makePositionInfoBox(),g.width=this._positionInfoBox.w,g.height=this._positionInfoBox.h);c.position=g;this._onResponsible(c);this.inherited(arguments)},_onResponsible:function(d){d.isRunInMobile?(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(d.position),
this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(d){this._normalizePositionObj(d);this.makePositionInfoBox();d=this._getPositionInfo();this._onResponsible(d)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var d=jimuConfig.layoutId;d="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return A.getMarginBox(d)},_getPositionInfo:function(){var d=
{isRunInMobile:!1,position:{left:0,top:5}},c=this._getLayoutBox(),g=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return d.isRunInMobile=!0,d;window.isRTL?(d.position.left=c.w-g,d.position.left+this._positionInfoBox.w>c.w&&(d.position.left-=this._positionInfoBox.w,0>d.position.left&&(d.position.left=c.w-this._positionInfoBox.w))):(d.position.left=g,d.position.left+this._positionInfoBox.w>c.w&&(d.position.left=c.w>this._positionInfoBox.w?c.w-this._positionInfoBox.w:0));g=this._positionInfoBox.t;
c=c.h-g;g>=c?g>=this._positionInfoBox.h&&(d.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):c>=this._positionInfoBox.h&&(d.position.top=this._positionInfoBox.t+40+3);return d},_setMobilePosition:function(){window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==A.byId(jimuConfig.layoutId)&&A.place(this.domNode,jimuConfig.layoutId);var d=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(d.zIndex=this.position.zIndex);var c=l.getPositionStyle(d);q.mixin(c,
d.borderRadiusStyle);A.setStyle(this.domNode,c)},_setDesktopPosition:function(d){!window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==A.byId(jimuConfig.mapId)&&A.place(this.domNode,jimuConfig.mapId);A.setStyle(this.domNode,{left:d.left+"px",right:"auto",top:d.top+"px",width:(d.width||this.position.width||this._originalBox.w)+"px",height:(d.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(d){A.setStyle(d.node,"opacity",.9)},onMoveStop:function(d){A.setStyle(d.node,
"opacity",1);d=A.getMarginBox(d.node);this._normalizePositionObj(q.clone({left:d.l,top:d.t,width:d.w,height:d.h}));this.makePositionInfoBox()}});E.extend(n);return E})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),function(E,
q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f){E.experimental("dojox.layout.ResizeHandle");var h=g("dojox.layout._ResizeHelper",a,{show:function(){c.set(this.domNode,"display","")},hide:function(){c.set(this.domNode,"display","none")},resize:function(p){d.setMarginBox(this.domNode,p)}});return g("dojox.layout.ResizeHandle",[a,f],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,minWidth:100,
constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,b.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=e.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new h({id:"dojoxGlobalResizeHelper"})).placeAt(r.body()),
n.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var p=q.partial(n.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;p("dojoxResizeNW");break;case "x":this._resizeX=!0;p("dojoxResizeW");break;case "y":this._resizeY=!0,p("dojoxResizeN")}},_beginSizing:function(p){if(!this._isSizing&&
(A.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=e.byId(this.targetId))?this.targetWidget.domNode:k.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var B=d.position(this.targetDomNode,!0);this._resizeHelper.resize({l:B.x,t:B.y,w:B.w,h:B.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:B.x,t:B.y})}this._isSizing=!0;this.startPoint={x:p.clientX,y:p.clientY};
B=c.getComputedStyle(this.targetDomNode);var u="border-model"===d.boxModel?{w:0,h:0}:d.getPadBorderExtents(this.targetDomNode,B),t=d.getMarginExtents(this.targetDomNode,B);this.startSize={w:c.get(this.targetDomNode,"width",B),h:c.get(this.targetDomNode,"height",B),pbw:u.w,pbh:u.h,mw:t.w,mh:t.h};this.isLeftToRight()||"absolute"!=c.get(this.targetDomNode,"position")||(B=d.position(this.targetDomNode,!0),this.startPosition={l:B.x,t:B.y});this._pconnects=[A.connect(r.doc,b.move,this,"_updateSizing"),
A.connect(r.doc,b.release,this,"_endSizing")];m.stop(p)}},_updateSizing:function(p){if(this.activeResize)this._changeSizing(p);else{var B=this._getNewCoords(p,"border",this._resizeHelper.startPosition);if(!1===B)return;this._resizeHelper.resize(B)}p.preventDefault()},_getNewCoords:function(p,B,u){try{if(!p.clientX||!p.clientY)return!1}catch(x){return!1}this._activeResizeLastEvent=p;var t=(this.isLeftToRight()?1:-1)*(this.startPoint.x-p.clientX),z=this.startPoint.y-p.clientY;p=this.startSize.w-(this._resizeX?
t:0);z=this._checkConstraints(p,this.startSize.h-(this._resizeY?z:0));(u=u||this.startPosition)&&this._resizeX&&(z.l=u.l+t,z.w!=p&&(z.l+=p-z.w),z.t=u.t);switch(B){case "margin":z.w+=this.startSize.mw,z.h+=this.startSize.mh;case "border":z.w+=this.startSize.pbw,z.h+=this.startSize.pbh}return z},_checkConstraints:function(p,B){if(this.minSize){var u=this.minSize;p<u.w&&(p=u.w);B<u.h&&(B=u.h)}this.constrainMax&&this.maxSize&&(u=this.maxSize,p>u.w&&(p=u.w),B>u.h&&(B=u.h));if(this.fixedAspect){u=this.startSize.w;
var t=this.startSize.h,z=u*B-t*p;0>z?p=B*u/t:0<z&&(B=p*t/u)}return{w:p,h:B}},_changeSizing:function(p){var B=this.targetWidget&&q.isFunction(this.targetWidget.resize),u=this._getNewCoords(p,B&&"margin");if(!1!==u&&(B?this.targetWidget.resize(u):this.animateSizing?l[this.animateMethod]([v.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:u.w}},duration:this.animateDuration}),v.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:u.h}},
duration:this.animateDuration})]).play():c.set(this.targetDomNode,{width:u.w+"px",height:u.h+"px"}),this.intermediateChanges))this.onResize(p)},_endSizing:function(p){w.forEach(this._pconnects,A.disconnect);var B=q.partial(A.publish,this.endTopic,[this]);this.activeResize?B():(this._resizeHelper.hide(),this._changeSizing(p),setTimeout(B,this.animateDuration+15));this._isSizing=!1;this.onResize(p)},onResize:function(p){}})})},"jimu/a11y/OnScreenWidgetPanel":function(){define(["dojo/_base/lang","dojo/on",
"dojo/_base/html","dojo/keys"],function(E,q,A,w){return{a11y_init:function(){this.own(q(this.domNode,"keydown",E.hitch(this,function(m){A.hasClass(m.target,"close-btn")||m.keyCode!==w.ESCAPE||(m.stopPropagation(),this.closeNode.focus())})))},_onTitleLabelKeyDown:function(m){m.shiftKey&&m.keyCode===w.TAB&&m.preventDefault()},_onMaxBtnKeyDown:function(m){m.keyCode!==w.ENTER&&m.keyCode!==w.SPACE||this._onMaxBtnClicked(m)},_onFoldableBtnKeyDown:function(m){m.keyCode===w.ENTER||m.keyCode===w.SPACE?this._onFoldableBtnClicked(m):
m.keyCode===w.TAB&&m.shiftKey&&m.preventDefault()},_onCloseBtnKey:function(m){m.keyCode===w.ENTER||m.keyCode===w.SPACE?this._onCloseBtnClicked(m):m.keyCode===w.TAB&&m.shiftKey&&(window.appInfo.isRunInMobile||m.preventDefault())}}})},"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo".split(" "),function(E,q,A,w,m,v){return E(v,{constructor:function(r,l,k,n){this.noLegend=n},_initVisible:function(){var r=
!1,l=this.originOperLayer.mapService;this.originOperLayer.mapService&&l.layerInfo._subLayerVisible[l.subId]&&(r=!0);this._visible=r},_setTopLayerVisible:function(r){if(this.originOperLayer.mapService){var l=this.originOperLayer.mapService;if(0<this.originOperLayer.subLayers.length){l.layerInfo._subLayerVisible[l.subId]=r?!0:!1;this._visible=r;var k={};this.traversal(function(n){0===n.getSubLayers().length&&(k[n.originOperLayer.mapService.subId]=n.isVisbleOrInvisilbe())});l.layerInfo._setSubLayerVisible(k)}}},
setLayerVisiblefromTopLayer:function(){},_visibleChanged:function(r){},_sevVisible:function(r){this.visible=r},obtainNewSubLayers:function(){var r=[];q.forEach(this.originOperLayer.subLayers,function(l){l.parentLayerInfo=this;l=this._layerInfoFactory.create(l);r.push(l);l.init()},this);return r},getOpacity:function(){},setOpacity:function(r){},getLayerObject:function(){var r=new w;this.layerObject.empty?m({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",timeout:1E5,content:{f:"json"}}).then(A.hitch(this,
function(l){var k=this.layerObject.url;this.layerObject=l;this.layerObject.url=k;this.layerObject.id=this.id;r.resolve(this.layerObject)}),function(l){r.reject(l)}):r.resolve(this.layerObject);return r},getLayerType:function(){var r=new w;r.resolve("GroupLayer");return r},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},getScaleRange:function(){var r=this.originOperLayer.mapService;return(r=r.layerInfo._getJsapiLayerInfoById(r.subId))&&
0<=r.minScale&&0<=r.maxScale?{minScale:r.minScale,maxScale:r.maxScale}:{minScale:0,maxScale:0}}})})},"jimu/dijit/Filter":function(){define("dojo/on dijit/a11yclick dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/Filter.html jimu/filterUtils jimu/utils jimu/LayerInfos/LayerInfos jimu/dijit/_filter/ValueProviderFactory dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/aspect dojo/Deferred esri/request ./_SingleFilter ./_FilterSet jimu/dijit/formSelect ./LoadingIndicator".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u){return w([m,v,r,k,A],{templateString:l,baseClass:"jimu-filter",declaredClass:"jimu.dijit.Filter",nls:null,_filterUtils:null,autoSwitchMode:!0,_validOptions:!1,_layerDefinition:null,_popupFieldsInfo:[],_def:null,valueProviderFactory:null,featureLayerId:null,layerInfosObj:null,mode:"desktop",noFilterTip:"",enableAskForValues:!1,mobileBreakWidth:600,runtime:!1,widgetId:"",postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.nls.add=
window.jimuNls.common.add;this.nls.apply=window.jimuNls.common.apply;this.layerInfosObj=d.getInstanceSync();this._filterUtils=new k;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._setDesktopMode();this.noFilterTip&&"string"===typeof this.noFilterTip&&(this.noFilterTipSection.innerHTML=n.sanitizeHTML(this.noFilterTip));this._bindBtnsEvent()},startup:function(){this.inherited(arguments);this.autoUpdateMode()},resize:function(){this.autoUpdateMode()},_bindBtnsEvent:function(){this.own(E(this.btnAddExpDesktop,
q,b.hitch(this,function(){this._onBtnAddExpClick()})));this.own(E(this.btnAddSetDesktop,q,b.hitch(this,function(){this._onBtnAddSetClick()})));this.own(E(this.btnAddExpMobile,q,b.hitch(this,function(){this._onBtnAddExpClick()})));this.own(E(this.btnAddSetMobile,q,b.hitch(this,function(){this._onBtnAddSetClick()})))},autoUpdateMode:function(){this.autoSwitchMode&&(this._clearMode(),this.domNode.clientWidth>=this.mobileBreakWidth?this._setDesktopMode():this._setMobileMode())},setMode:function(t){"desktop"===
t?this._setDesktopMode():"mobile"===t&&this._setMobileMode()},_setMode:function(t){this.mode=t;this._setModeClass(this.mode)},_setModeClass:function(t){e.removeClass(this.domNode,"desktop-mode");e.removeClass(this.domNode,"mobile-mode");e.addClass(this.desktopAddSection,"hidden");e.addClass(this.mobileAddSection,"hidden");t&&e.addClass(this.domNode,t+"-mode")},_clearMode:function(){this._setModeClass("")},_setDesktopMode:function(){this._setMode("desktop");e.removeClass(this.desktopAddSection,"hidden")},
_setMobileMode:function(){this._setMode("mobile");e.removeClass(this.mobileAddSection,"hidden")},reset:function(){this.isBuilding()||(this.removeAllFilters(),this.url=null,this.isHosted=!1,this._layerDefinition=null,this._popupFieldsInfo=[],this.valueProviderFactory=this.partsObj=this.expr=this.featureLayerId=null)},isBuilding:function(){return this._def&&!this._def.isFulfilled()},build:function(t){var z=new h;this.isBuilding()?z.reject("Filter is already building."):(this._def=null,this.reset(),
this.url=t.url,this.isHosted=n.isHostedService(this.url),this._layerDefinition=t.layerDefinition,this.featureLayerId=t.featureLayerId,t.widgetId&&(this.widgetId=t.widgetId),this.useStandardizedQueries=this._filterUtils.useStandardizedQueries(t.layerDefinition),this.layerTimeZoneOffset=this._filterUtils.getLayerTimezoneOffset(t.layerDefinition),t.partsObj?(this.partsObj=this._updatePartsObj(t.partsObj),this._def=this._init("partsObj")):(this.expr=t.expr||"1\x3d1",this._def=this._init("expr")),z=this._def);
return z},buildByExpr:function(t,z,x){console.warn("Filter#buildByExpr() method is deprecated, please use Filter#build() instead.");return this.build({url:t,expr:z,layerDefinition:x,featureLayerId:this.featureLayerId})},buildByFilterObj:function(t,z,x){console.warn("Filter#buildByFilterObj() method is deprecated, please use Filter#build() instead.");return this.build({url:t,partsObj:z,layerDefinition:x,featureLayerId:this.featureLayerId})},_updatePartsObj:function(t){a.forEach(t,b.hitch(this,function(z){z.parts?
a.forEach(z.parts,b.hitch(this,function(x){x.interactiveObj&&!0===x.interactiveObj.cascade?x.interactiveObj.cascade="previous":!1===x.interactiveObj.cascade&&(x.interactiveObj.cascade="none")})):z.interactiveObj&&!0===z.interactiveObj.cascade?z.interactiveObj.cascade="previous":!1===z.interactiveObj.cascade&&(z.interactiveObj.cascade="none")}));return t},removeAllFilters:function(){this._destroyAllFilters()},_getLayerDefinitionRaw:function(t,z){var x=new h;z?x.resolve(z):(this.loading.show(),p({url:t,
content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(b.hitch(this,function(y){this.domNode?(this.loading.hide(),x.resolve(y)):x.reject()}),b.hitch(this,function(y){console.error(y);x.reject();this.domNode&&this.loading.hide()})));return x},_validateLayerDefinition:function(t){return this._isObject(t)},_init:function(t){var z=new h;if(!this._isString(this.url))return z.reject(),z;var x=b.hitch(this,function(){setTimeout(b.hitch(this,function(){this.emit("change");z.resolve()}),1500)}),
y=b.hitch(this,function(){e.addClass(this.errorSection,"hidden");this.removeAllFilters();if(this.featureLayerId){this._tryOverrideFieldAliases(this.featureLayerId,this._layerDefinition);var D=this.layerInfosObj.getLayerOrTableInfoById(this.featureLayerId).getPopupInfo()}var H=this._layerDefinition.fields;H&&0<H.length?(this._popupFieldsInfo=D?n.completePopupFieldFromLayerField(H,D.fieldInfos):H,(H=a.filter(H,b.hitch(this,function(I){return 0<=this._supportFieldTypes.indexOf(I.type)})))&&0<H.length?
(this._validOptions=!0,e.removeClass(this.btnAddSetDesktop,"jimu-state-disabled"),e.removeClass(this.btnAddExpDesktop,"jimu-state-disabled"),e.removeClass(this.btnAddSetMobile,"jimu-state-disabled"),e.removeClass(this.btnAddExpMobile,"jimu-state-disabled"),this.createFieldsStore(),this.valueProviderFactory=new c({url:this.url,layerDefinition:this._layerDefinition,featureLayerId:this.featureLayerId}),"expr"===t?this._isString(this.expr)?("1\x3d1"===this.expr.replace(/\s/gi,"")&&this.removeAllFilters(),
this._parseExpr(this.expr)?x():z.reject()):z.reject():"partsObj"===t?this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),x()):z.reject():this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),x()):this._isString(this.expr)?this._parseExpr(this.expr)?x():z.reject():(this.removeAllFilters(),x())):(this._showErrorOptions(this.nls.error.noFilterFields),z.reject())):(D&&(this._popupFieldsInfo=D.fieldInfos),z.reject())});this._validateLayerDefinition(this._layerDefinition)?
y():(this.loading.show(),p({url:this.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(b.hitch(this,function(D){this.domNode?(this.loading.hide(),this._layerDefinition=D,y()):z.reject()}),b.hitch(this,function(D){console.error(D);z.reject();this.domNode&&this.loading.hide()})));return z},_tryOverrideFieldAliases:function(t,z){if(t=this.layerInfosObj.getLayerOrTableInfoById(t))if(t=t.getPopupInfo())if(t=t.fieldInfos,z=z.fields,t&&0<t.length&&z&&0<z.length){var x={};a.forEach(t,
b.hitch(this,function(y){y.fieldName&&(x[y.fieldName]=y)}));a.forEach(z,b.hitch(this,function(y){var D=x[y.name];D&&D.label&&(y.alias=D.label)}))}},_handleUseStandardizedQueriesAndTimeZone:function(t){t&&(t.parts?a.forEach(t.parts,b.hitch(this,function(z){"date"===z.fieldObj.shortType&&(this.useStandardizedQueries&&(z._useStandardizedQueries=this.useStandardizedQueries),z._layerTimeZoneOffset=this.layerTimeZoneOffset)})):"date"===t.fieldObj.shortType&&(this.useStandardizedQueries&&(t._useStandardizedQueries=
this.useStandardizedQueries),t._layerTimeZoneOffset=this.layerTimeZoneOffset));return t},toJson:function(){var t={logicalOperator:this.allAnySelect.value,parts:[]},z=this._getAllSingleFiltersAndFilterSets();if(0===z.length)return t.expr="1\x3d1",t;a.forEach(z,b.hitch(this,function(x){x=x.toJson();x=this._handleUseStandardizedQueriesAndTimeZone(x);t.parts.push(x)}));return a.every(t.parts,b.hitch(this,function(x){return!!x}))&&0<t.parts.length?(t.expr=this.getExprByFilterObj(t),t):null},toValidJson:function(){var t=
{logicalOperator:this.allAnySelect.value,parts:[]},z=this._getAllSingleFiltersAndFilterSets();if(0===z.length)return t.expr="1\x3d1",t;a.forEach(z,b.hitch(this,function(x){if(x=x.toJson())x=this._handleUseStandardizedQueriesAndTimeZone(x),t.parts.push(x)}));t.expr=0<t.parts.length?this.getExprByFilterObj(t):"1\x3d1";return t},createFieldsStore:function(){if(this._layerDefinition.fields&&0!==this._layerDefinition.fields.length){var t=b.clone(this._layerDefinition.fields);0===this.setFieldsStoreByFieldInfos(t)&&
this._showErrorOptions(this.nls.error.noFilterFields)}else this._showErrorOptions(this.nls.error.noFilterFields)},_parsePartsObj:function(t){this._validatePartsObj(t)&&(this.removeAllFilters(),this._buildEditUIByPartsObj(t))},_parseExpr:function(t){this._destroyAllFilters();var z=null;if(!this._validateLayerDefinition(this._layerDefinition))return z;if(!t||"string"!==typeof t)return this._showErrorOptions(this.nls.error.invalidSQL),z;if("1\x3d1"===this.expr.replace(/\s/gi,""))return z={expr:"1\x3d1",
parts:[],logicalOperator:"AND"};try{z=this.getFilterObjByExpr(t)}catch(x){z=null,console.error(x)}z?this._buildEditUIByPartsObj(z):this._showErrorOptions(this.nls.error.cantParseSQL);return z},_buildEditUIByPartsObj:function(t){t&&(this._destroyAllFilters(),a.forEach(t.parts,b.hitch(this,function(z){z.parts?this._addFilterSet(z):z.fieldObj&&z.operator&&z.valueObj&&this._addSingleFilter(z)})),this._setValutForAllAnySelect(t.logicalOperator),this._setFilterMsgUI(t.parts.length))},_addSingleFilter:function(t){t=
{widgetId:this.widgetId,url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,part:t,OPERATORS:b.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,runtime:this.runtime};t=new B(t);t.placeAt(this.allExpsBox);t.startup();this.own(f.after(t,"_destroySelf",b.hitch(this,function(){this._checkFilterNumbers();
this._focusOnMobileAdd();this.emit("change")})));this.own(E(t,"change",b.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return t},_focusOnMobileAdd:function(){e.hasClass(this.mobileAddSection,"hidden")||this.btnAddExpMobile.focus()},_addFilterSet:function(t){t={widgetId:this.widgetId,url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,
partsObj:t,OPERATORS:b.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,runtime:this.runtime};t=new u(t);t.placeAt(this.allExpsBox);t.startup();this.own(f.after(t,"_destroySelf",b.hitch(this,function(){this._checkFilterNumbers();this._focusOnMobileAdd();this.emit("change")})));this.own(E(t,"change",b.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return t},_destroyAllFilters:function(){for(var t=
this._getAllSingleFiltersAndFilterSets();0<t.length;)t[0].destroy(),t.splice(0,1);this._checkFilterNumbers()},_getAllSingleFiltersAndFilterSetsDoms:function(){var t=[];this.allExpsBox.childNodes&&0<this.allExpsBox.childNodes.length&&a.forEach(this.allExpsBox.childNodes,b.hitch(this,function(z){(e.hasClass(z,"jimu-single-filter")||e.hasClass(z,"jimu-filter-set"))&&t.push(z)}));return t},_getAllSingleFiltersAndFilterSets:function(){var t=this._getAllSingleFiltersAndFilterSetsDoms();return a.map(t,b.hitch(this,
function(z){return g.byNode(z)}))},_setValutForAllAnySelect:function(t){this.allAnySelect.set("value",t)},_setFilterMsgUI:function(t){2>t?(this._setValutForAllAnySelect("AND"),e.setStyle(this.allAnySelect.domNode,"display","none"),e.setStyle(this.oneOrZeroMsg,"display","block")):(e.setStyle(this.oneOrZeroMsg,"display","none"),e.setStyle(this.allAnySelect.domNode,"display","inline-table"))},_checkFilterNumbers:function(){var t=this._getAllSingleFiltersAndFilterSetsDoms();this._setFilterMsgUI(t.length);
0<t.length?e.addClass(this.noFilterTipSection,"hidden"):e.removeClass(this.noFilterTipSection,"hidden");this.emit("filter-number-change")},_showErrorOptions:function(t){console.error(t);e.addClass(this.errorSection,"hidden");this.errorTip.innerHTML=t;this.loading.hide()},_onBtnApplyClicked:function(){this.emit("apply")},_onBtnAddSetClick:function(){this._layerDefinition&&this._validOptions&&(this._addFilterSet(),this.emit("change"))},_onBtnAddExpClick:function(){this._layerDefinition&&this._validOptions&&
(this._addSingleFilter(),this.emit("change"))}})})},"jimu/dijit/_filter/ValueProviderFactory":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare ./BlankValueProvider ./SimpleValueProvider ./TwoNumbersValueProvider ./TwoDatesValueProvider ./ListValueProvider ./AdvancedListValueProvider ./PredefinedValueProvider ./NumberListValueProvider ./DateIsInValueProvider jimu/utils jimu/LayerInfos/LayerInfos".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g,b){var e={stringOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorStartsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorEndsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,
supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorContains:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorDoesNotContain:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsAnyOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsNoneOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},stringOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0}},numberOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsAtLeast:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},
field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsLessThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0}},numberOperatorIsAtMost:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsGreaterThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},
unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsAnyOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNoneOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNotBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},
dateOperatorIsOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsNotOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,
filterCodedValueIfPossible:!0}},dateOperatorIsIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsNotIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsOnOrBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsOnOrAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorNotInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0,
customVirtualDates:!0}},dateOperatorIsNotBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0}},dateOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},dateOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}}},a=A([],{nls:null,layerInfo:null,popupInfo:null,url:null,layerDefinition:null,featureLayerId:null,constructor:function(f){E.mixin(this,f);this.nls=window.jimuNls.filterBuilder;f=b.getInstanceSync();this.featureLayerId&&
(this.layerInfo=f.getLayerOrTableInfoById(this.featureLayerId))&&(this.popupInfo=this.layerInfo.getPopupInfo())},getSupportedValueTypes:function(f,h){var p=[];if(h=e[h])h.value&&p.push("value"),h.field&&0<this._getSameShortTypeFieldNames(f).length&&p.push("field"),h.unique&&this.url&&(this._isStreamServer(this.url)||p.push("unique")),h.multiple&&this.url&&(this._isStreamServer(this.url)||p.push("multiple")),h.uniquePredefined&&this.url&&(this._isStreamServer(this.url)||p.push("uniquePredefined")),
h.multiplePredefined&&this.url&&(this._isStreamServer(this.url)||p.push("multiplePredefined"));return p},_isStreamServer:function(f){f=(f||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(f)},_getSameShortTypeFieldNames:function(f){var h=[],p=this._getFieldInfo(this.layerDefinition,f),B=a.getShortTypeByEsriType(p.type);q.forEach(this.layerDefinition.fields,E.hitch(this,function(u){u.name!==f&&a.getShortTypeByEsriType(u.type)===B&&h.push(u.name)}));return h},_getSameShortTypeFieldNameLabels:function(f){var h=
[],p=this._getFieldInfo(this.layerDefinition,f),B=a.getShortTypeByEsriType(p.type);q.forEach(this.layerDefinition.fields,E.hitch(this,function(u){u.name!==f&&a.getShortTypeByEsriType(u.type)===B&&h.push({value:u.name,label:u.alias})}));return h},getValueProvider:function(f,h){var p=null,B=E.clone(e[f.operator]);if(B){var u=f.valueObj.type,t=f.fieldObj.name,z=this._getFieldInfo(this.layerDefinition,t),x=B[u],y=x.normalProviderType,D=null,H=g.getCodedValueListForCodedValueOrSubTypes(this.layerDefinition,
t);"field"===u?(t=this._getSameShortTypeFieldNameLabels(t),0<t.length&&(D=t)):H&&0<H.length&&x.codedValueProviderType&&(y=x.codedValueProviderType);f={nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,partObj:f,fieldInfo:z,codedValues:H,staticValues:D,layerInfo:this.layerInfo,popupInfo:this.popupInfo,operatorInfo:B,filterCodedValueIfPossible:!!x.filterCodedValueIfPossible,runtime:h};if("BLANK_VALUE_PROVIDER"===y)p=new w(f);else if("SIMPLE_VALUE_PROVIDER"===y)p=new m(f);else if("TWO_NUMBERS_VALUE_PROVIDER"===
y)p=new v(f);else if("TWO_DATES_VALUE_PROVIDER"===y)p=new r(f);else if("LIST_VALUE_PROVIDER"===y)f.showNullValues=!1,"value"===u||"field"===u?p=new l(f):(f.providerType=y,f.selectUI="dropdown",p=new k(f));else if("NUMBER_LIST_VALUE_PROVIDER"===y)p=new d(f);else if("DATE_IS_IN_VALUE_PROVIDER"===y)p=new c(f);else if("ADVANCED_LIST_VALUE_PROVIDER"===y)f.providerType=y,f.selectUI="dropdown",p=new k(f);else if("UNIQUE_PREDEFINED_VALUE_PROVIDER"===y||"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===y)f.providerType=
y,f.selectUI=f.partObj.valueObj?f.partObj.valueObj.selectUI:null,p=h?new k(f):new n(f)}return p},_getFieldInfo:function(f,h){f=f.fields;for(var p=0;p<f.length;p++){var B=f[p];if(h===B.name)return B}return null}});a.getOperatorInfo=function(f){return E.clone(e[f])};a.isSupportVirtualDates=function(f){var h=e[f];return h&&h.value&&h.value.customVirtualDates?{status:!0,num:"dateOperatorIsBetween"===f||"dateOperatorIsNotBetween"===f?2:1}:{status:!1}};a.getOperatorsByShortType=function(f,h){var p=[];"string"===
f?p="stringOperatorIs stringOperatorIsNot stringOperatorStartsWith stringOperatorEndsWith stringOperatorContains stringOperatorDoesNotContain stringOperatorIsAnyOf stringOperatorIsNoneOf stringOperatorIsBlank stringOperatorIsNotBlank".split(" "):"number"===f?p="numberOperatorIs numberOperatorIsNot numberOperatorIsAtLeast numberOperatorIsAtMost numberOperatorIsLessThan numberOperatorIsGreaterThan numberOperatorIsAnyOf numberOperatorIsNoneOf numberOperatorIsBetween numberOperatorIsNotBetween numberOperatorIsBlank numberOperatorIsNotBlank".split(" "):
"date"===f&&(p="dateOperatorIsOn dateOperatorIsNotOn dateOperatorIsIn dateOperatorIsNotIn dateOperatorIsBefore dateOperatorIsAfter dateOperatorIsOnOrBefore dateOperatorIsOnOrAfter dateOperatorIsBetween dateOperatorIsNotBetween dateOperatorIsBlank dateOperatorIsNotBlank".split(" "),h&&p.splice(8,0,"dateOperatorInTheLast","dateOperatorNotInTheLast"));return p};a.getShortTypeByEsriType=function(f){var h=null;"esriFieldTypeString"===f?h="string":"esriFieldTypeDate"===f?h="date":0<=["esriFieldTypeOID",
"esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(f)&&(h="number");return h};return a})},"jimu/dijit/_filter/BlankValueProvider":function(){define(["dojo/_base/html","dojo/_base/declare","./ValueProvider"],function(E,q,A){return q([A],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.inherited(arguments);E.addClass(this.domNode,"jimu-filter-blank-value-provider")},getDijits:function(){return[]},getStatus:function(){return 1},
setValueObject:function(){},getValueObject:function(){return{isValid:!0,type:this.partObj.valueObj.type,value:null}},isBlankValueProvider:function(){return!0}})})},"jimu/dijit/_filter/ValueProvider":function(){define("dojo/on dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin jimu/FilterManager jimu/utils esri/lang".split(" "),function(E,q,A,w,m,v,r,l,k,n,d){return v([r,l,q],{baseClass:"jimu-filter-value-provider",fieldName:null,
shortType:null,_enabled:!1,cascade:"none",filterCodedValue:!1,fieldPopupInfo:null,nls:null,url:null,layerDefinition:null,fieldInfo:null,partObj:null,runtime:!0,staticValues:null,codedValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,postMixInProperties:function(){this.inherited(arguments);this.shortType=this.partObj.fieldObj.shortType;this.fieldName=this.partObj.fieldObj.name;this.cascade=this.partObj.interactiveObj&&this.partObj.interactiveObj.cascade;this.runtime&&
this.codedValues&&this.filterCodedValueIfPossible&&n.isCodedValuesSupportFilter(this.layerDefinition,this.codedValues.length)?this.filterCodedValue=!0:this.filterCodedValue=!1;this.popupInfo&&this.popupInfo.fieldInfos&&0<this.popupInfo.fieldInfos.length&&m.some(this.popupInfo.fieldInfos,A.hitch(this,function(c){return c.fieldName===this.fieldName?(this.fieldPopupInfo=c,!0):!1}))},postCreate:function(){this.inherited(arguments);this.filterManager=k.getInstance()},getDijits:function(){return[]},bindChangeEvents:function(){var c=
this.getDijits();m.forEach(c,A.hitch(this,function(g){g.declaredClass&&0===g.declaredClass.indexOf("dijit.")&&w.addClass(g.domNode,g.declaredClass.replace(/\./g,"-"));this.own(E(g,"change",A.hitch(this,this._onChanged)));this.own(E(g,"enter",A.hitch(this,this._onEnter)))}))},_onChanged:function(){this._onEnterTriggered||this.emit("change")},_onEnterTriggered:!1,_onEnter:function(){this._onEnterTriggered=!0;this.emit("change");this.emit("enter");setTimeout(A.hitch(this,function(){this._onEnterTriggered=
!1}),100)},tryLocaleNumber:function(c){var g=n.localizeNumber(c);if(null===g||void 0===g)g=c;return g},getPartObject:function(){var c=this.getValueObject();if(!c)return null;var g=A.clone(this.partObj);g.valueObj=c;return g},setValueObject:function(){},getValueObject:function(){},tryGetValueObject:function(){return this.getValueObject()},setRequired:function(){},getStatus:function(){var c=1,g=this.getDijits();0<g.length&&(c=m.map(g,A.hitch(this,function(b){return"function"===typeof b.getStatus?b.getStatus():
this.getStatusForDijit(b)})),c=Math.min.apply(c,c));return c},getStatusForDijit:function(c){return c.validate()?c.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},isBlankValueProvider:function(){return!1},getFilterExpr:function(){var c="1\x3d1";c=this.getLayerFilterExpr();if("all"===this.cascade||"previous"===this.cascade){var g=this.getCascadeFilterExpr();c="("+
c+") AND ("+g+")"}return c},getLayerFilterExpr:function(){var c="1\x3d1";this.layerInfo&&(c=this.layerInfo.getFilter());c||(c="1\x3d1");return c},_getWebMapFilterExpr:function(){var c="";this.layerInfo&&(c=this.layerInfo.getFilterOfWebmap());c||(c="1\x3d1");return c},getDropdownFilterExpr:function(c){var g="1\x3d1";c=this.layerInfo&&this.runtime&&c?this.filterManager.getFilterExp(this.layerInfo.id,c):this._getWebMapFilterExpr();"all"===this.cascade||"previous"===this.cascade?(g=this.getCascadeFilterExpr(),
g=c?"("+c+") AND ("+g+")":"("+g+")"):c&&(g=c);return g},getCascadeFilterExpr:function(){return"1\x3d1"},getDropdownFilterPartsObj:function(){var c={parts:[]};if("all"===this.cascade||"previous"===this.cascade)c=this.getCascadeFilterPartsObj();return c},getCascadeFilterPartsObj:function(){return{}},getCodedValueListByPartsObj:function(c,g,b,e){var a=n.getFieldInfoByFieldName(c.fields,g),f=c.typeIdField,h=null;b=b.parts;for(var p in b){var B=b[p];if(B.fieldObj.name===f){f=B.valueObj.value;h=n._getCodedValueBySubTypeId(c,
g,f,a);break}}h||(h=e?e:n._getAllCodedValue(c,a));if(h&&0<h.length)var u=h[0].value;return{selectedValue:u,valueLabels:h}},isDefined:function(c){return d.isDefined(c)},disable:function(){this._enabled=!1},enable:function(){this._enabled=!0},isEnabled:function(){return this._enabled},destroy:function(){this.inherited(arguments)}})})},"jimu/dijit/_filter/SimpleValueProvider":function(){define("dojo/_base/html dojo/_base/declare dojo/_base/lang dojo/on dojo/keys jimu/utils ./ValueProvider dijit/form/ValidationTextBox dijit/form/NumberTextBox ./DateValueSelector".split(" "),
function(E,q,A,w,m,v,r,l,k,n){return q([r],{templateString:"\x3cdiv\x3e\x3c/div\x3e",_dijit:null,customId:null,postCreate:function(){this.inherited(arguments);this.customId=this.partObj.vpId;E.addClass(this.domNode,"jimu-filter-simple-value-provider");var d=null;"string"===this.shortType?(d={required:!1,trim:!0,intermediateChanges:!1},this.customId&&(d.id=this.customId),this._dijit=new l(d),this._dijit.startup(),this._dijit.on("keydown",function(c){(c.keyCode||c.which)===m.ENTER&&this._dijit.emit("enter")}.bind(this))):
"number"===this.shortType?(d={required:!1,intermediateChanges:!1,constraints:{pattern:"#####0.##########"}},this.customId&&(d.id=this.customId),this._dijit=new k(d),this._dijit.startup(),this._dijit.on("keydown",function(c){(c.keyCode||c.which)===m.ENTER&&this._dijit.emit("enter")}.bind(this))):(d={runtime:this.runtime,popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo},this.runtime&&(d.virtualDates=this.partObj.interactiveObj.virtualDates),this.customId&&(d.customId=this.customId,d.prompt=this.partObj.interactiveObj.prompt+
" "+this.partObj.interactiveObj.hint),this._dijit=new n(d),this.own(w(this._dijit,"change",A.hitch(this,function(c){this.emit("change",c,"start")}))));!this.customId||"string"!==this.shortType&&"number"!==this.shortType||(d=E.toDom('\x3clabel for\x3d"'+this.customId+'" class\x3d"screen-readers-only"\x3e'+this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint+"\x3c/label\x3e"),E.place(d,this.domNode));E.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(this.domNode)},
getDijits:function(){return[this._dijit]},setValueObject:function(d){this.isDefined(d.value)&&("date"===this.shortType?this._dijit.setValueObject(d):this._dijit.set("value",d.value))},getValueObject:function(){if(this.isValidValue())if("date"===this.shortType){var d=this._dijit.getValueObject();if(d&&d.value)return d.isValid=!0,d.type=this.partObj.valueObj.type,d}else return d=this._dijit.get("value"),d="number"===this.shortType?parseFloat(d):v.sanitizeHTML(d),{isValid:!0,type:this.partObj.valueObj.type,
value:d};return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:null}:null},setRequired:function(d){this._dijit.set("required",d)}})})},"jimu/dijit/_filter/DateValueSelector":function(){define("dojo/aspect dojo/Evented dojo/on dojo/keys dojo/query dojo/_base/html dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase jimu/filterUtils jimu/utils jimu/dijit/Popup jimu/dijit/formSelect jimu/dijit/dateTimePicker".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e){return k([n,q],{virtualDates:null,customId:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);v.addClass(this.domNode,"jimu-date-value-selector");this.dateTypeSelect=new b({"aria-label":this.prompt});v.addClass(this.dateTypeSelect.domNode,"date-type-select");v.addClass(this.dateTypeSelect.domNode,"restrict-select-width");this.dateTypeSelect.placeAt(this.domNode);
this.own(A(this.dateTypeSelect,"change",r.hitch(this,function(){this._onDateTypeSelectChanged()})));this.virtualDates&&0<this.virtualDates.length||(this.virtualDates=[d.VIRTUAL_DATE_TODAY,d.VIRTUAL_DATE_YESTERDAY,d.VIRTUAL_DATE_TOMORROW],this.runtime&&this.virtualDates.unshift(d.VIRTUAL_DATE_CUSTOM));this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});(!this.runtime||this.runtime&&0<=this.virtualDates.indexOf(d.VIRTUAL_DATE_CUSTOM))&&this.dateTypeSelect.addOption({value:"custom",label:this.nls.custom});
l.map(this.virtualDates,r.hitch(this,function(a){if("custom"!==a){var f={value:a,label:a};switch(a){case d.VIRTUAL_DATE_TODAY:f.label=this.nls.today;break;case d.VIRTUAL_DATE_YESTERDAY:f.label=this.nls.yesterday;break;case d.VIRTUAL_DATE_TOMORROW:f.label=this.nls.tomorrow}this.dateTypeSelect.addOption(f)}}));this.dateTypeSelect.startup();this.own(A(v.byId("main-page"),"click",r.hitch(this,function(){this.hideDateTimePopup()})));this.own(E.before(this.dateTypeSelect,"openDropDown",r.hitch(this,function(){this.hideDateTimePopup();
"custom"===this.dateTypeSelect.getValue()&&this.dateTimeObj&&this.dateTimeObj.value&&(this.dateTypeSelect.textDirNode.innerText=this.dateTimeObj.value);"custom"!==this.dateTypeSelect.getValue()&&this.dateTimePopup&&this.dateTimePopup.hide()})));this.own(E.after(this.dateTypeSelect,"closeDropDown",r.hitch(this,function(){this.customId||v.setAttr(this.dateTypeSelect,"aria-label",this.dateTypeSelect.textDirNode.innerText);this.dateTypeSelect.textDirNode.title="";setTimeout(r.hitch(this,function(){"custom"===
this.dateTypeSelect.getValue()&&this.dateTimeObj&&this.dateTimeObj.value&&this.dateTypeSelect.textDirNode&&(this.dateTypeSelect.textDirNode.innerText=this.dateTimeObj.value,this.dateTypeSelect.textDirNode.title=this.dateTimeObj.value);this.dateTimePopup&&this.dateTimePopup.domNode&&"block"===v.getStyle(this.dateTimePopup.domNode,"display")&&this.dateTimePicker&&this.dateTimePicker.calendar&&this.dateTimePicker.calendar.focus()}),200)})));this.own(E.after(this.dateTypeSelect.dropDown,"onItemClick",
r.hitch(this,function(a){a&&"custom"===a.option.value&&this.showDateTimePopup()}),!0));this.popupInfo&&this.popupInfo.fieldInfos&&(this.fieldInfo=this.popupInfo.fieldInfos.filter(r.hitch(this,function(a){return a.fieldName===this._fieldInfo.name}))[0])},hideDateTimePopup:function(){this.dateTimePopup&&this.dateTimePopup.domNode&&"block"===v.getStyle(this.dateTimePopup.domNode,"display")&&(this.dateTimePicker&&!0===this.dateTimePopupClick?this.dateTimePopupClick=!1:this.dateTimePopup.hide())},getDijits:function(){return[]},
setValueObject:function(a){if(a.virtualDate&&"custom"!==a.virtualDate)this.dateTypeSelect.set("value",a.virtualDate,!1),this.customId||v.setAttr(this.dateTypeSelect,"aria-label",a.virtualDate);else if(this.dateTypeSelect.set("value","custom",!1),a.value){var f=c.getDateByDateTimeStr(a.value),h=c.localizeDateTimeByFieldInfo(f,this.fieldInfo,a.enableTime,a.timeAccuracy);this.dateTimeObj={date:f,value:h};this.dateTypeSelect.textDirNode.innerText=h;this.dateTypeSelect.textDirNode.title=h;this.enableTime=
a.enableTime;this.timeAccuracy=a.timeAccuracy;this.customId||v.setAttr(this.dateTypeSelect,"aria-label",this.dateTypeSelect.textDirNode.innerText)}},getValueObject:function(){return this.isValidValue()?this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var a={value:null,virtualDate:""},f=this.dateTypeSelect.get("value"),h=null;"custom"===f?(h=this.dateTimeObj.date,a.value=h?c.getDateTimeStr(h,!0):null,a.virtualDate="",a.enableTime=this.enableTime?this.enableTime:
!1,a.timeAccuracy=this.timeAccuracy?this.timeAccuracy:""):(h=d.getRealDateByVirtualDate(f),a.virtualDate=f,h?a.value=c.getDateTimeStr(h):a=null);return a},setRequired:function(){},getStatus:function(){return"custom"===this.dateTypeSelect.get("value")?this.dateTimePicker?this._getStatusForDijit(this.dateTimePicker):this.dateTimeObj?1:0:""===this.dateTypeSelect.get("value")?0:1},_getStatusForDijit:function(a){return a.validate()?a.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},
isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},_onDateTypeSelectChanged:function(){"dateTime"===this.dateTypeSelect.get("value")&&this.showDateTimePopup();this.emit("change",this.dateTypeSelect.get("value"))},showDateTimePopup:function(){if(this.dateTimePopup)this.resize(),this.dateTimePicker.reset(),this.dateTimePopup.show();else{this.dateTimeObj||(this.dateTimeObj={date:null});this.dateTimePicker=new e({runtime:this.runtime,value:this.dateTimeObj.date,
fieldInfo:this.fieldInfo,enableTime:this.enableTime,timeAccuracy:this.timeAccuracy});this.own(A(this.dateTimePicker,"created",r.hitch(this,function(f){this.dateTypeSelect.textDirNode.innerText=f.value;this.dateTypeSelect.textDirNode.title=f.value;this.dateTimeObj=f})));this.own(A(this.dateTimePicker,"timeChange",r.hitch(this,function(f){f&&(this.dateTypeSelect.textDirNode.innerText=f.value,this.dateTypeSelect.textDirNode.title=f.value,this.enableTime=f.enableTime,this.timeAccuracy=f.timeAccuracy,
this.dateTimeObj=f,this.emit("change"))})));this.own(A(this.dateTimePicker,"timeStatusChanged",r.hitch(this,function(){this.popupH=this.enableTime?353:309})));this.own(A(this.dateTimePicker,"close",r.hitch(this,function(){this.dateTimePopup.hide();this.dateTypeSelect.focus()})));this.runtime?this._isOnlyShowDate()?(this.popupH=265,this.own(A(this.dateTimePicker,"calendarChange",r.hitch(this,function(f){f&&this.dateTypeSelect.textDirNode.innerText!==f.value&&(this.dateTypeSelect.textDirNode.innerText=
f.value,this.dateTypeSelect.textDirNode.title=f.value,this.enableTime=f.enableTime,this.timeAccuracy=f.timeAccuracy,this.dateTimeObj=f,this.emit("change"))})))):this.popupH=320:this.popupH=this.enableTime?353:309;var a=this._calculatePopup();this.dateTimePopup=new g({width:this.popupW,autoHeight:!0,classNames:["dijitCalendarPopup","jimu-popup-date-time-picker"],content:this.dateTimePicker.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:a.left,
top:a.top},useFocusLogic:!1,onClose:r.hitch(this,function(){this.dateTimePopup.hide();return!1}),buttons:[]});this._isOnlyShowDate()&&v.setStyle(this.dateTimePopup.contentContainerNode,{marginBottom:"-3px"});this.own(A(this.dateTimePopup.domNode,"click",r.hitch(this,function(){this.dateTimePopupClick=!0})));this.own(A(this.dateTimePopup.domNode,"keydown",r.hitch(this,function(f){f.keyCode===w.ESCAPE?(this.dateTimePopup.hide(),this.dateTypeSelect.focus()):this.runtime&&f.keyCode===w.TAB&&(f.preventDefault(),
this._isOnlyShowDate()||(v.hasClass(f.target,"dijitCalendarSelectedDate")?this.dateTimePicker.timeTextBox.focusNode:this.dateTimePicker.calendar).focus())})))}},_getLastBtnFromDTPopup:function(){for(var a=null,f=m(".jimu-btn",this.dateTimePopup.buttonContainer),h=f.length-1;0<=h;h--)if("none"!==v.getStyle(f[h],"display")){a=f[h];break}return a},_isOnlyShowDate:function(){return this.runtime&&!this.enableTime?!0:!1},_calculatePopup:function(){var a=v.getStyle(this.domNode,"width");this.popupW=210<
a?a:210;var f=v.position(this.domNode),h=v.position(document.body).h,p=f.y+30;h-p<this.popupH&&(p=f.y-this.popupH,p=0<p?p:(h-this.popupH)/2);h=v.position(document.body).w;f.x+this.popupW>h&&(f.x-=this.popupW-a);return{left:f.x,top:p-1}},resize:function(){var a=this._calculatePopup();this.dateTimePopup.setCustomPosition(a.left,a.top,this.popupW,this.popupH)},destroy:function(){this.dateTimePopup&&(this.dateTimePopup.onClose=r.hitch(this,function(){return!0}),this.dateTimePopup.close())}})})},"jimu/dijit/dateTimePicker":function(){define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang jimu/utils dijit/Calendar dijit/form/TimeTextBox dojo/text!./templates/dateTimePicker.html dojo/on dojo/Evented jimu/dijit/CheckBox".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c){return E([A,w,m,c],{baseClass:"jimu-datetimepicker",declaredClass:"jimu.datetimepicker",templateString:n,value:null,fieldInfo:null,enableTime:!1,timeAccuracy:"",runtime:!1,postMixInProperties:function(){this.timeNls=window.apiNls.widgets.imageFilter.imageFilterSettings;this.timeUnit=window.jimuNls.timeUnit},postCreate:function(){this._initSelf()},_initSelf:function(){this.calendar=new l({value:this.value,"class":"jimu-calendar"},this.calendarDiv);this.own(d(this.calendar,
"change",v.hitch(this,function(){this._valueChange();this.runtime&&!this.enableTime&&this.emit("close")})));this.calendar.startup();if(this.runtime)if(q.setStyle(this.timeTextContainerSetting,"display","none"),this.enableTime){q.setStyle(this.timeTextContainerRuntime,"display","block");var g={constraints:{timePattern:"s"===this.timeAccuracy?"HH:mm:ss":"m"===this.timeAccuracy?"HH:mm":"HH",clickableIncrement:"T00:30:00",visibleIncrement:"T01:00:00",visibleRange:"T01:00:00"}};"h"===this.timeAccuracy&&
(g.constraints.clickableIncrement="T01:00:00");this.timeTextBox=new k(g,this.timeTextBoxDiv);this.own(d(this.timeTextBox,"change",v.hitch(this,function(){this.enableTime=""===this.timeTextBox.displayedValue?!1:!0;this._valueChange()})));this.timeTextBox.startup();this.timeTextBox.set("value",this.value)}else q.setStyle(this.timeTextContainerRuntime,"display","none");else q.setStyle(this.timeTextContainerRuntime,"display","none"),q.setStyle(this.timeTextContainerSetting,"display","block"),this._initTimePickers();
this._enableTime=this.enableTime;this.emit("created",this.getValueObj())},_initTimePickers:function(){this.timeCheckbox.setValue(this.enableTime);this.enableTime&&(q.setStyle(this.timeTableContainer,"display","block"),this.value&&this._setTimeBox_HMS(this.value));this.own(d(this.timeCheckbox,"change",v.hitch(this,function(){this._changeTimeCheckStatus();this._valueChange();this.emit("timeStatusChanged")})));this.own(d(this.hourSelect,"change",v.hitch(this,function(){this._valueChange()})));this.own(d(this.minuteSelect,
"change",v.hitch(this,function(){this._valueChange()})));this.own(d(this.secondSelect,"change",v.hitch(this,function(){this._valueChange()})))},_changeTimeCheckStatus:function(){(this._enableTime=this.timeCheckbox.checked)?q.setStyle(this.timeTableContainer,"display","block"):q.setStyle(this.timeTableContainer,"display","none")},_valueChange:function(){this.emit("timeChange",this.getValueObj())},isValid:function(){if(null===this.calendar.value)return!1;if(this.runtime){if(this._enableTime&&!this.timeTextBox.isValid())return!1}else if(this.timeCheckbox.checked){if(!this.hourSelect.isValid()||
!this.minuteSelect.isValid()||!this.secondSelect.isValid()||""===this.hourSelect.displayedValue||""!==this.hourSelect.displayedValue&&""!==this.secondSelect.displayedValue&&""===this.minuteSelect.displayedValue)return!1}else this.hourSelect.isValid()||this.hourSelect.set("value",null),this.minuteSelect.isValid()||this.minuteSelect.set("value",null),this.secondSelect.isValid()||this.secondSelect.set("value",null);return!0},getValueObj:function(){if(!this.isValid())return!1;var g=new Date(this.calendar.value.toDateString());
if(this.runtime){if(this.enableTime){var b=this.timeTextBox.get("value");b&&(g.setHours(b.getHours()),g.setMinutes(b.getMinutes()),g.setSeconds(b.getSeconds()))}}else if(this.enableTime=this._enableTime){b=this.hourSelect.get("value");var e=this.minuteSelect.get("value"),a=this.secondSelect.get("value");this.timeAccuracy=a?"s":e?"m":"h";g.setHours(b?b.getHours():null);g.setMinutes(e?e.getMinutes():null);g.setSeconds(a?a.getSeconds():null)}else this.timeAccuracy="";b=r.localizeDateTimeByFieldInfo(g,
this.fieldInfo,this.enableTime,this.timeAccuracy);this.value=g;return{date:g,value:b,enableTime:this.enableTime,timeAccuracy:this.timeAccuracy}},validate:function(){this.set("DisplayedValue",this.calendar.value?1:0);return!0},reset:function(){var g=this.calendar.get("value");g&&this.value&&this.value.toDateString()===g.toDateString()||this.calendar.set("value",this.value);this.timeCheckbox.setValue(this.enableTime);this.runtime?this.enableTime&&this.timeTextBox.set("value",this.value):this._setTimeBox_HMS(this.enableTime?
this.value:null)},_setTimeBox_HMS:function(g){var b=null,e=null,a=null;"h"===this.timeAccuracy?b=g:"m"===this.timeAccuracy?b=e=g:"s"===this.timeAccuracy&&(b=e=a=g);this.hourSelect.set("value",b);this.minuteSelect.set("value",e);this.secondSelect.set("value",a)}})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f){var h=w("dijit.Calendar",[g,b,e],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(p){l.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",p)},_createMonthWidget:function(){return new h._MonthDropDownButton({id:this.id+"_mddb",
tabIndex:-1,onMonthSelect:n.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(d(this.domNode,"keydown",n.hitch(this,"_onKeyDown")),d(this.dateRowsNode,"mouseover",n.hitch(this,"_onDayMouseOver")),d(this.dateRowsNode,"mouseout",n.hitch(this,"_onDayMouseOut")),d(this.dateRowsNode,"mousedown",n.hitch(this,"_onDayMouseDown")),d(this.dateRowsNode,"mouseup",n.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(p){var B=
new this.dateClassObj(this.currentFocus);B.setDate(1);B.setMonth(p);p=this.dateModule.getDaysInMonth(B);var u=this.currentFocus.getDate();B.setDate(Math.min(u,p));this._setCurrentFocusAttr(B)},_onDayMouseOver:function(p){(p=v.contains(p.target,"dijitCalendarDateLabel")?p.target.parentNode:p.target)&&(p.dijitDateValue&&!v.contains(p,"dijitCalendarDisabledDate")||p==this.previousYearLabelNode||p==this.nextYearLabelNode)&&(v.add(p,"dijitCalendarHoveredDate"),this._currentNode=p)},_onDayMouseOut:function(p){!this._currentNode||
p.relatedTarget&&p.relatedTarget.parentNode==this._currentNode||(p="dijitCalendarHoveredDate",v.contains(this._currentNode,"dijitCalendarActiveDate")&&(p+=" dijitCalendarActiveDate"),v.remove(this._currentNode,p),this._currentNode=null)},_onDayMouseDown:function(p){(p=p.target.parentNode)&&p.dijitDateValue&&!v.contains(p,"dijitCalendarDisabledDate")&&(v.add(p,"dijitCalendarActiveDate"),this._currentNode=p)},_onDayMouseUp:function(p){(p=p.target.parentNode)&&p.dijitDateValue&&v.remove(p,"dijitCalendarActiveDate")},
handleKey:function(p){var B=-1,u=this.currentFocus;switch(p.keyCode){case k.RIGHT_ARROW:B=1;case k.LEFT_ARROW:var t="day";this.isLeftToRight()||(B*=-1);break;case k.DOWN_ARROW:B=1;case k.UP_ARROW:t="week";break;case k.PAGE_DOWN:B=1;case k.PAGE_UP:t=p.ctrlKey||p.altKey?"year":"month";break;case k.END:u=this.dateModule.add(u,"month",1),t="day";case k.HOME:u=new this.dateClassObj(u);u.setDate(1);break;default:return!0}t&&(u=this.dateModule.add(u,t,B));this._setCurrentFocusAttr(u);return!1},_onKeyDown:function(p){this.handleKey(p)||
(p.stopPropagation(),p.preventDefault())},onValueSelected:function(){},onChange:function(p){this.onValueSelected(p)},getClassForDate:function(){}});h._MonthDropDownButton=w("dijit.Calendar._MonthDropDownButton",f,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new h._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(p){var B=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,p);this.dropDown.set("months",
B);this.containerNode.innerHTML=(6==c("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+B[p.getMonth()]+"\x3c/div\x3e"}});h._MonthDropDown=w("dijit.Calendar._MonthDropDown",[b,a,e],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(p){this.domNode.innerHTML=
"";E.forEach(p,function(B,u){r.create("div",{className:"dijitCalendarMonthLabel",month:u,innerHTML:B},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(p){this.onChange(m.get(p.target,"month"))},onChange:function(){}});return h})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a){var f=q("dijit.CalendarLite",[b,e],{templateString:a,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(h){return h&&!isNaN(h)&&"object"==typeof h&&h.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var h=this._get("value");if(h&&!isNaN(h)){var p=
new this.dateClassObj(h);p.setHours(0,0,0,0);p.getDate()<h.getDate()&&(p=this.dateModule.add(p,"hour",1));return p}return null},_setValueAttr:function(h,p){"string"==typeof h&&(h=v.fromISOString(h));h=this._patchDate(h);if(this._isValidDate(h)&&!this.isDisabledDate(h,this.lang)){if(this._set("value",h),this.set("currentFocus",h),this._markSelectedDates([h]),this._created&&(p||"undefined"==typeof p))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(h){if(h||
0===h)h=new this.dateClassObj(h),h.setHours(1,0,0,0);return h},_setText:function(h,p){for(;h.firstChild;)h.removeChild(h.firstChild);h.appendChild(h.ownerDocument.createTextNode(p))},_populateGrid:function(){var h=new this.dateClassObj(this.currentFocus);h.setDate(1);h=this._patchDate(h);var p=h.getDay(),B=this.dateModule.getDaysInMonth(h),u=this.dateModule.getDaysInMonth(this.dateModule.add(h,"month",-1)),t=new this.dateClassObj,z=0<=this.dayOffset?this.dayOffset:A.getFirstDayOfWeek(this.lang);z>
p&&(z-=7);if(!this.summary){var x=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,h);this.gridNode.setAttribute("summary",x[h.getMonth()])}this._date2cell={};E.forEach(this.dateCells,function(y,D){var H=D+z,I=new this.dateClassObj(h),N="dijitCalendar",S=0;H<p?(H=u-p+H+1,S=-1,N+="Previous"):H>=p+B?(H=H-p-B+1,S=1,N+="Next"):(H=H-p+1,N+="Current");S&&(I=this.dateModule.add(I,"month",S));I.setDate(H);this.dateModule.compare(I,t,"date")||(N="dijitCalendarCurrentDate "+N);this.isDisabledDate(I,
this.lang)?(N="dijitCalendarDisabledDate "+N,y.setAttribute("aria-disabled","true")):(N="dijitCalendarEnabledDate "+N,y.removeAttribute("aria-disabled"),y.setAttribute("aria-selected","false"));(S=this.getClassForDate(I,this.lang))&&(N=S+" "+N);y.className=N+"Month dijitCalendarDateTemplate";N=I.valueOf();this._date2cell[N]=y;y.dijitDateValue=N;N=I.getDateLocalized?I.getDateLocalized(this.lang):I.getDate();this._setText(this.dateLabels[D],N);k.set(y,"aria-label",m.format(I,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var h=new this.dateClassObj(this.currentFocus);h.setDate(1);this.monthWidget.set("month",h);var p=h.getFullYear()-1,B=new this.dateClassObj;E.forEach(["previous","current","next"],function(u){B.setFullYear(p++);this._setText(this[u+"YearLabelNode"],this.dateLocaleModule.format(B,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(h){this.dateModule=h.datePackage?n.getObject(h.datePackage,
!1):w;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=h.datePackage?n.getObject(h.datePackage+".locale",!1):m},_createMonthWidget:function(){return f._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var h=this.dowTemplateString,p=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),B=0<=this.dayOffset?this.dayOffset:A.getFirstDayOfWeek(this.lang);this.dayCellsHtml=g.substitute([h,
h,h,h,h,h,h].join(""),{d:""},function(){return p[B++%7]});h=g.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[h,h,h,h,h,h].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);r.setSelectable(this.domNode,!1);h=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",h,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var h=n.hitch(this,function(p,
B,u){this[p].dojoClick=!0;return d(this[p],"click",n.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,B,u))}))});this.own(h("incrementMonth","month",1),h("decrementMonth","month",-1),h("nextYearLabelNode","year",1),h("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(h,p){var B=this.currentFocus,u=this._getNodeByDate(B);h=this._patchDate(h);this._set("currentFocus",h);this._date2cell&&0==this.dateModule.difference(B,h,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));h=this._getNodeByDate(h);h.setAttribute("tabIndex",this.tabIndex);(this.focused||p)&&h.focus();u&&u!=h&&(c("webkit")?u.setAttribute("tabIndex","-1"):u.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(h){h.stopPropagation();h.preventDefault();for(h=h.target;h&&!h.dijitDateValue&&0!==h.dijitDateValue;h=h.parentNode);h&&!l.contains(h,"dijitCalendarDisabledDate")&&this.set("value",
h.dijitDateValue)},_getNodeByDate:function(h){return(h=this._patchDate(h))&&this._date2cell?this._date2cell[h.valueOf()]:null},_markSelectedDates:function(h){function p(B,u){l.toggle(u,"dijitCalendarSelectedDate",B);u.setAttribute("aria-selected",B?"true":"false")}E.forEach(this._selectedCells||[],n.partial(p,!1));this._selectedCells=E.filter(E.map(h,this._getNodeByDate,this),function(B){return B});E.forEach(this._selectedCells,n.partial(p,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
f._MonthWidget=q("dijit.CalendarLite._MonthWidget",b,{_setMonthAttr:function(h){var p=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,h),B=6==c("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+E.map(p,function(u){return"\x3cdiv\x3e"+u+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=B+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+p[h.getMonth()]+"\x3c/div\x3e"}});return f})},"dijit/form/TimeTextBox":function(){define("dojo/_base/declare dojo/keys dojo/query dojo/_base/lang ../_TimePicker ./_DateTimeTextBox".split(" "),
function(E,q,A,w,m,v){return E("dijit.form.TimeTextBox",v,{baseClass:"dijitTextBox dijitComboBox dijitTimeTextBox",popupClass:m,_selector:"time",value:new Date(""),maxHeight:-1,openDropDown:function(r){this.inherited(arguments);var l=A(".dijitTimePickerItemSelected",this.dropDown.domNode),k=this.dropDown.domNode.parentNode;k.scrollTop=l[0]?l[0].offsetTop-(k.clientHeight-l[0].clientHeight)/2:(k.scrollHeight-k.clientHeight)/2;this.dropDown.on("input",w.hitch(this,function(){this.set("value",this.dropDown.get("value"),
!1)}))},_onInput:function(){this.inherited(arguments);var r=this.get("displayedValue");this.filterString=r&&!this.parse(r,this.constraints)?r.toLowerCase():"";this._opened&&this.closeDropDown();this.openDropDown()}})})},"dijit/_TimePicker":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/sniff dojo/query dojo/mouse dojo/on ./_WidgetBase ./form/_ListMouseMixin".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a){return m("dijit._TimePicker",[e,a],{baseClass:"dijitTimePicker",pickerMin:"T00:00:00",pickerMax:"T23:59:59",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",value:new Date,_visibleIncrement:2,_clickableIncrement:1,_totalIncrements:10,constraints:{},serialize:w.toISOString,buildRendering:function(){this.inherited(arguments);this.timeMenu=this.containerNode=this.domNode},setValue:function(f){l.deprecated("dijit._TimePicker:setValue() is deprecated.  Use set('value', ...) instead.",
"","2.0");this.set("value",f)},_setValueAttr:function(f){this._set("value",f);this._showText()},_setFilterStringAttr:function(f){this._set("filterString",f);this._showText()},isDisabledDate:function(){return!1},_getFilteredNodes:function(f,h,p,B){f=this.ownerDocument.createDocumentFragment();for(h=0;h<this._maxIncrement;h++)(p=this._createOption(h))&&f.appendChild(p);return f},_showText:function(){var f=w.fromISOString;this.domNode.innerHTML="";this._clickableIncrementDate=f(this.clickableIncrement);
this._visibleIncrementDate=f(this.visibleIncrement);var h=function(B){return 3600*B.getHours()+60*B.getMinutes()+B.getSeconds()},p=h(this._clickableIncrementDate);h=h(this._visibleIncrementDate);(this.value||this.currentFocus).getTime();this._refDate=f(this.pickerMin);this._refDate.setFullYear(1970,0,1);this._clickableIncrement=1;this._visibleIncrement=h/p;f=f(this.pickerMax);f.setFullYear(1970,0,1);f=.001*(f.getTime()-this._refDate.getTime());this._maxIncrement=Math.ceil((f+1)/p);p=this._getFilteredNodes();
!p.firstChild&&this.filterString?(this.filterString="",this._showText()):this.domNode.appendChild(p)},constructor:function(){this.constraints={}},postMixInProperties:function(){this.inherited(arguments);this._setConstraintsAttr(this.constraints)},_setConstraintsAttr:function(f){for(var h in{clickableIncrement:1,visibleIncrement:1,pickerMin:1,pickerMax:1})h in f&&(this[h]=f[h]);f.locale||(f.locale=this.lang)},_createOption:function(f){var h=new Date(this._refDate),p=this._clickableIncrementDate;h.setHours(h.getHours()+
p.getHours()*f,h.getMinutes()+p.getMinutes()*f,h.getSeconds()+p.getSeconds()*f);"time"==this.constraints.selector&&h.setFullYear(1970,0,1);var B=A.format(h,this.constraints);if(this.filterString&&0!==B.toLowerCase().indexOf(this.filterString))return null;p=this.ownerDocument.createElement("div");p.className=this.baseClass+"Item";p.date=h;p.idx=f;r.create("div",{"class":this.baseClass+"ItemInner",innerHTML:B},p);B=1>f%this._visibleIncrement&&-1<f%this._visibleIncrement;f=!B&&!(f%this._clickableIncrement);
B?p.className+=" "+this.baseClass+"Marker":f&&(p.className+=" "+this.baseClass+"Tick");this.isDisabledDate(h)&&(p.className+=" "+this.baseClass+"ItemDisabled");this.value&&!q.compare(this.value,h,this.constraints.selector)&&(p.selected=!0,p.className+=" "+this.baseClass+"ItemSelected",this._selectedDiv=p,B?p.className+=" "+this.baseClass+"MarkerSelected":f&&(p.className+=" "+this.baseClass+"TickSelected"),this._highlightOption(p,!0));return p},onOpen:function(){this.inherited(arguments);this.set("selected",
this._selectedDiv)},_onOptionSelected:function(f,h){(f=f.target.date||f.target.parentNode.date)&&!this.isDisabledDate(f)&&(this._set("value",f),this.emit("input"),h&&(this._highlighted_option=null,this.set("value",f),this.onChange(f)))},onChange:function(){},_highlightOption:function(f,h){if(f){if(h)this._highlighted_option&&this._highlightOption(this._highlighted_option,!1),this._highlighted_option=f;else{if(this._highlighted_option!==f)return;this._highlighted_option=null}v.toggle(f,this.baseClass+
"ItemHover",h);v.contains(f,this.baseClass+"Marker")?v.toggle(f,this.baseClass+"MarkerHover",h):v.toggle(f,this.baseClass+"TickHover",h)}},handleKey:function(f){if(f.keyCode==k.DOWN_ARROW)return this.selectNextNode(),this._onOptionSelected({target:this._highlighted_option},!1),f.stopPropagation(),f.preventDefault(),!1;if(f.keyCode==k.UP_ARROW)return this.selectPreviousNode(),this._onOptionSelected({target:this._highlighted_option},!1),f.stopPropagation(),f.preventDefault(),!1;if(f.keyCode==k.ENTER||
f.keyCode===k.TAB){if(!this._keyboardSelected&&f.keyCode===k.TAB)return!0;this._highlighted_option&&this._onOptionSelected({target:this._highlighted_option},!0);return f.keyCode===k.TAB}},onHover:function(f){this._highlightOption(f,!0)},onUnhover:function(f){this._highlightOption(f,!1)},onSelect:function(f){this._highlightOption(f,!0)},onDeselect:function(f){this._highlightOption(f,!1)},onClick:function(f){this._onOptionSelected({target:f},!0)}})})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(E,q,A,w,m,v,r,l){new Date("X");return w("dijit.form._DateTimeTextBox",[v,r],{templateString:l,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:q.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(k,n){var d=this._isInvalidDate(k),c=this._isInvalidDate(n);if(d||c)return d&&c?0:d?-1:1;k=this.format(k,this._unboundedConstraints);n=this.format(n,this._unboundedConstraints);
d=this.parse(k,this._unboundedConstraints);c=this.parse(n,this._unboundedConstraints);return k==n?0:E.compare(d,c,this._selector)},autoWidth:!0,format:function(k,n){return k?this.dateLocaleModule.format(k,n):""},parse:function(k,n){return this.dateLocaleModule.parse(k,n)||(this._isEmpty(k)?null:void 0)},serialize:function(k,n){k.toGregorian&&(k=k.toGregorian());return A.toISOString(k,n)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(k){k=
k||{};this.dateModule=k.datePackage?m.getObject(k.datePackage,!1):E;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=k.datePackage?m.getObject(k.datePackage+".locale",!1):q;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(k){k.selector=this._selector;k.fullYear=!0;var n=A.fromISOString;"string"==typeof k.min&&(k.min=n(k.min),this.dateClassObj instanceof Date||(k.min=new this.dateClassObj(k.min)));"string"==typeof k.max&&(k.max=n(k.max),this.dateClassObj instanceof Date||(k.max=new this.dateClassObj(k.max)));this.inherited(arguments);this._unboundedConstraints=m.mixin({},this.constraints,{min:null,max:null})},_isDefinitelyOutOfRange:function(){var k=
this.inherited(arguments),n=!1;if(k&&(this.constraints.min||this.constraints.max)){var d=(new RegExp(this._lastRegExp)).exec(this._lastInputEventValue);null!=d&&(k=d[3],this.constraints.min&&(n=this.constraints.min instanceof Date?this.constraints.min:new Date(String(this.constraints.min)),minYear=n.getFullYear(),n=parseInt((k+"9999").substr(0,4),10),n=n<minYear),!n&&this.constraints.max&&(n=this.constraints.max instanceof Date?this.constraints.max:new Date(String(this.constraints.max)),maxYear=n.getFullYear(),
k=parseInt((k+"0000").substr(0,4),10),n=k>maxYear),k=n)}return k},_isInvalidDate:function(k){return!k||isNaN(k)||"object"!=typeof k||k.toString()==this._invalidDate},_setValueAttr:function(k,n,d){void 0!==k&&("string"==typeof k&&(k=A.fromISOString(k)),this._isInvalidDate(k)&&(k=null),k instanceof Date&&!(this.dateClassObj instanceof Date)&&(k=new this.dateClassObj(k)));this.inherited(arguments,[k,n,d]);this.value instanceof Date&&(this.filterString="");!1!==n&&this.dropDown&&this.dropDown.set("value",
k,!1)},_set:function(k,n){if("value"==k){n instanceof Date&&!(this.dateClassObj instanceof Date)&&(n=new this.dateClassObj(n));var d=this._get("value");if(d instanceof this.dateClassObj&&0==this.compare(n,d))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(k){this._isInvalidDate(k)&&(k=new this.dateClassObj);this._set("dropDownDefaultValue",k)},openDropDown:function(k){this.dropDown&&this.dropDown.destroy();var n=m.isString(this.popupClass)?m.getObject(this.popupClass,!1):this.popupClass,
d=this,c=this.get("value");this.dropDown=new n({onChange:function(g){d.set("value",g,!0)},id:this.id+"_popup",dir:d.dir,lang:d.lang,value:c,textDir:d.textDir,currentFocus:this._isInvalidDate(c)?this.dropDownDefaultValue:c,constraints:d.constraints,filterString:d.filterString,datePackage:d.datePackage,isDisabledDate:function(g){return!d.rangeCheck(g,d.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(k,n){this._setValueAttr(this.parse(k,
this.constraints),n,k)}})})},"jimu/dijit/_filter/TwoNumbersValueProvider":function(){define("dojo/_base/html dojo/_base/lang dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./TwoNumbersValueProvider.html dijit/form/NumberTextBox jimu/utils".split(" "),function(E,q,A,w,m,v,r,l,k){return A([w,m,v],{templateString:r,customId:null,postCreate:function(){this.inherited(arguments);E.addClass(this.domNode,"jimu-two-numbers-filter-value-provider");this.customId=
this.partObj.vpId;var n={required:!1,intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},d=q.clone(n);if(this.customId){n.id=this.customId+"_between";var c=this.customId;var g=E.toDom('\x3clabel for\x3d"'+n.id+'" class\x3d"screen-readers-only"\x3e'+this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint+"\x3c/label\x3e");E.place(g,this._dijit1_container)}else c=k.getUUID();d.id=c+"_and";c=E.toDom('\x3clabel for\x3d"'+d.id+'" class\x3d"screen-readers-only"\x3e'+this.nls.and+
"\x3c/label\x3e");E.place(c,this._dijit2_container);this._dijit1=new l(n);this._dijit2=new l(d);this._dijit1.startup();this._dijit2.startup();this._dijit1.on("blur",function(){this._onRangeNumberBlur()}.bind(this));this._dijit2.on("blur",function(){this._onRangeNumberBlur()}.bind(this));E.setStyle(this._dijit1.domNode,"width","100%");E.setStyle(this._dijit2.domNode,"width","100%");this._dijit1.placeAt(this._dijit1_container);this._dijit2.placeAt(this._dijit2_container)},_onRangeNumberBlur:function(){if(this._dijit1.validate()&&
this._dijit2.validate()){var n=parseFloat(this._dijit1.get("value")),d=parseFloat(this._dijit2.get("value"));n>d&&(this._dijit1.set("value",d),this._dijit2.set("value",n))}},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(n){this.isDefined(n.value1)&&this._dijit1.set("value",n.value1);this.isDefined(n.value2)&&this._dijit2.set("value",n.value2)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),
value2:parseFloat(this._dijit2.get("value"))}:null},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var n={isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))};isNaN(n.value1)&&(n.value1=null);isNaN(n.value2)&&(n.value2=null);return n}return null},setRequired:function(n){this._dijit1.set("required",n);this._dijit2.set("required",n)}})})},"jimu/dijit/_filter/TwoDatesValueProvider":function(){define("dojo/Evented dojo/on dojo/_base/html dojo/_base/declare dojo/_base/lang ./ValueProvider dijit/_WidgetsInTemplateMixin ./DateValueSelector dojo/text!./TwoDatesValueProvider.html jimu/utils".split(" "),
function(E,q,A,w,m,v,r,l,k,n){return w([v,r,E],{templateString:k,customId:null,postCreate:function(){this.inherited(arguments);this.customId=this.partObj.vpId;A.addClass(this.domNode,"jimu-two-dates-filter-value-provider");var d={runtime:this.runtime,popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo,style:{width:"100%"}},c=m.clone(d);if(this.customId){d.customId=this.customId+"_between";d.prompt=this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint;var g=this.customId}else g=n.getUUID();
c.customId=g+"_and";c.prompt=this.nls.and;this.runtime&&(d.virtualDates=this.partObj.interactiveObj.virtualDates1,c.virtualDates=this.partObj.interactiveObj.virtualDates2);this._dijit1=new l(d,this._dijitDiv1);this._dijit2=new l(c,this._dijitDiv2);this.own(q(this._dijit1,"change",m.hitch(this,function(b){this.emit("change",b,"start")})));this.own(q(this._dijit2,"change",m.hitch(this,function(b){this.emit("change",b,"end")})))},_initDateSelectors:function(){},_onDateValueSelectorChanged:function(){this.emit("change")},
getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(d){this._setValueObject(this._dijit1,d,1);this._setValueObject(this._dijit2,d,2)},_setValueObject:function(d,c,g){var b="value"+g;if(this.isDefined(c[b])){var e={enableTime:c["enableTime"+g],timeAccuracy:c["timeAccuracy"+g],value:null,virtualDate:""};e.value=c[b];e.virtualDate=c["virtualDate"+g];d.setValueObject(e)}},getValueObject:function(){if(this.isValidValue()){var d=this._dijit1.getValueObject(),c=this._dijit2.getValueObject();
if(d.value&&c.value)return{isValid:!0,type:this.partObj.valueObj.type,enableTime1:d.enableTime?!0:!1,timeAccuracy1:d.timeAccuracy?d.timeAccuracy:"",enableTime2:c.enableTime?!0:!1,timeAccuracy2:c.timeAccuracy?c.timeAccuracy:"",value1:d.value,value2:c.value,virtualDate1:d.virtualDate,virtualDate2:c.virtualDate}}return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:null,value2:null,virtualDate1:null,
virtualDate2:null}:null},getStatus:function(){return 1===this._dijit1.getStatus()&&1===this._dijit2.getStatus()?1:-1===this._dijit1.getStatus()||-1===this._dijit2.getStatus()?-1:0},setRequired:function(d){this._dijit1.set("required",d);this._dijit2.set("required",d)}})})},"jimu/dijit/_filter/ListValueProvider":function(){define("dojo/aspect dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/_base/declare ./ValueProvider dojo/store/Memory jimu/utils dijit/form/FilteringSelect".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d){return r([l],{templateString:"\x3cdiv\x3e\x3c/div\x3e",codedValues:null,staticValues:null,showNullValues:!1,layerDataChanged:!1,ifDropDown:!1,customId:null,postCreate:function(){this.inherited(arguments);w.addClass(this.domNode,"jimu-filter-list-value-provider");this.customId=this.partObj.vpId;this._initValueSelect();this._uniqueValueCache={};this.noDataTips='\x3cdiv class\x3d"error-tip-section" style\x3d"display: block;"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text"\x3e'+
this.nls.noFilterValueTip+"\x3c/span\x3e\x3c/div\x3e";var c=new k({idProperty:"id",data:[]});this.valuesSelect.set("store",c);this.isNumberField=n.isNumberField(this.fieldInfo.type);!this.staticValues&&"function"===typeof this.valuesSelect._onDropDownMouseDown&&(!this.codedValues||this.codedValues&&this.filterCodedValue)&&(this.own(E.before(this.valuesSelect,"_onDropDownMouseDown",A.hitch(this,this._onBeforeDropDownMouseDown))),this.own(v(document.body,"click",A.hitch(this,this._onBodyClick))),this.layerInfo&&
this.layerInfo.getLayerObject().then(A.hitch(this,function(g){g.on("edits-complete",A.hitch(this,function(){this.layerDataChanged=!0}))})))},_initValueSelect:function(){var c={searchAttr:"label",required:!1,intermediateChanges:!0};this.customId&&(c["aria-label"]=this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint);this.valuesSelect=new d(c);this.valuesSelect.startup();this.valuesSelect.on("input",A.hitch(this,this._onFilteringSelectInput));w.setStyle(this.valuesSelect.domNode,
"width","100%");this.valuesSelect.placeAt(this.domNode)},_onFilteringSelectInput:function(){this.emit("change")},_getCodedValueLabelsBySubTypeId:function(){var c=this.getDropdownFilterPartsObj();return this.getCodedValueListByPartsObj(this.layerDefinition,this.fieldName,c,this.codedValues)},_onBeforeDropDownMouseDown:function(){this.ifDropDown=!0;this._tryUpdatingUniqueValues(void 0,!0);return arguments},_onBodyClick:function(c){c=c.target||c.srcElement;c===this.domNode||w.isDescendant(c,this.domNode)||
this.msgDiv&&w.setStyle(this.msgDiv,"display","none")},getDijits:function(){return[this.valuesSelect]},isValidValue:function(){return 0<this.getStatus()},getStatus:function(){var c=this.valuesSelect.get("item");if(c&&void 0!==c.value){if(this.isNumberField&&!n.isValidNumber(c.value)&&"value"===this.partObj.valueObj.type){var g=parseFloat(c.value);return n.isValidNumber(g)?(c.value=g,this._getStatusForDijit(this.valuesSelect)):-1}return this._getStatusForDijit(this.valuesSelect)}return 0},_getStatusForDijit:function(c){return c.validate()?
c.get("DisplayedValue")?1:0:-1},setValueObject:function(c){return this.staticValues?this._setValueForStaticValues(c.value,this.staticValues):this.codedValues?this.filterCodedValue?this._tryUpdatingUniqueValues(c.value,!1):this._setValueForStaticValues(c.value,this.codedValues):this._tryUpdatingUniqueValues(c.value,!1)},getValueObject:function(){if(this.isValidValue()){var c=this.valuesSelect.get("item").value;return{isValid:!0,type:this.partObj.valueObj.type,value:c}}return null},tryGetValueObject:function(){return this.isValidValue()?
this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:"string"===this.shortType?"":null}:null},setRequired:function(c){this.valuesSelect.set("required",c)},_setValueForStaticValues:function(c,g){var b=null,e=-1;b=null;g&&(b=m.map(g,A.hitch(this,function(a,f){a={id:f,value:a.value,label:a.label};a.value+""===c+""&&(e=f);return a})),this.valuesSelect.store.setData(b),0<=e&&(b=this.valuesSelect.store.get(e))&&this.valuesSelect.set("item",b),this._checkIfNoData())},
_uniqueValueLoadingDef:null,_uniqueValueLoadingExpr:"",_uniqueValueCache:null,_tryUpdatingUniqueValues:function(c,g){var b=new q;if(this.valuesSelect._opened)this._checkIfNoData(),b.resolve();else{var e=this.getDropdownFilterExpr();e!==this._uniqueValueLoadingExpr||this.layerDataChanged?(this.valuesSelect.readOnly=!0,this._uniqueValueLoadingDef&&(this._uniqueValueLoadingDef.reject(),this._uniqueValueLoadingDef=null),this._uniqueValueLoadingExpr=e,this._uniqueValueLoadingDef=this._getUniqueValues(e),
this._uniqueValueLoadingDef.then(A.hitch(this,function(a){this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._setValueForUniqueValues(c,a),this._hideLoadingIcon(),g&&this.valuesSelect.toggleDropDown(),this._checkIfNoData(),b.resolve())}),A.hitch(this,function(a){console.error(a);this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._hideLoadingIcon(),this._checkIfNoData(),b.reject(a))}))):(this._checkIfNoData(),b.resolve())}return b},_setValueForUniqueValues:function(c,
g){g.sort(function(a,f){return a.value<f.value?-1:a.value===f.value?0:1});this.showNullValues||(g=m.filter(g,A.hitch(this,function(a){return"\x3cNull\x3e"!==a.value&&null!==a.value})));if(void 0===c){var b=this.getValueObject();b&&(c=b.value)}var e=-1;b=null;g=m.map(g,A.hitch(this,function(a,f){var h={id:f,value:a.value,label:a.label};a.value+""===c+""&&(e=f);return h}));this.valuesSelect.store.setData(g);0<=e&&(b=this.valuesSelect.store.get(e));this.valuesSelect.set("item",b)},_checkIfNoData:function(){this.runtime&&
this.ifDropDown&&(this.ifDropDown=!1,0===this.valuesSelect.store.data.length&&(this.msgDiv?w.setStyle(this.msgDiv,"display","block"):(this.msgDiv=document.createElement("div"),w.addClass(this.msgDiv,"jimu-filter-list-value-provider-tip-container"),this.msgDiv.innerHTML=this.noDataTips,this.valuesSelect.domNode.parentNode.appendChild(this.msgDiv))))},_showLoadingIcon:function(){w.addClass(this.valuesSelect.domNode,"loading")},_hideLoadingIcon:function(){w.removeClass(this.valuesSelect.domNode,"loading")},
_getUniqueValues:function(c){var g=new q;this._uniqueValueCache[c]&&!this.layerDataChanged?g.resolve(this._uniqueValueCache[c]):(this._showLoadingIcon(),n.getUniqueValues(this.url,this.fieldName,c,this.layerDefinition,this.fieldPopupInfo).then(A.hitch(this,function(b){this.domNode&&(this._uniqueValueCache[c]=b,g.resolve(b),this._hideLoadingIcon())}),A.hitch(this,function(b){this.domNode&&(g.reject(b),this._hideLoadingIcon())})));this.layerDataChanged=!1;return g}})})},"jimu/dijit/_filter/AdvancedListValueProvider":function(){define("dojo/Deferred dojo/_base/lang dojo/on dojo/keys dojo/Evented dojo/_base/html dojo/_base/array dojo/_base/declare dojo/query ./ValueProvider ./AdvancedListValueSelect dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./AdvancedListValueProvider.html jimu/utils jimu/dijit/_filter/pageControlForQuery jimu/dijit/Popup".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f){return l([n,c,g,m],{templateString:b,codedValues:null,staticValues:null,showNullValues:!1,cbxPopup:null,pageSize:1E3,pageIndex:1,emptyStr:"",postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.emptyStr=window.apiNls.widgets.FeatureTable.empty},postCreate:function(){this.inherited(arguments);this.noDataTips='\x3cdiv class\x3d"error-tip-section" style\x3d"display: block;"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text"\x3e'+
this.nls.noFilterValueTip+"\x3c/span\x3e\x3c/div\x3e";v.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");"ADVANCED_LIST_VALUE_PROVIDER"===this.providerType?(this.controlType="multipleDynamic",this.checkedNumDiv.style.display="block"):"LIST_VALUE_PROVIDER"===this.providerType?(this.controlType="uniqueDynamic",this.checkedNameDiv.style.display="block"):(this.runtime&&"dropdown"===this.selectUI&&("UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?this.checkedNameDiv.style.display=
"block":this.checkedNumDiv.style.display="block"),this.controlType="MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"multiplePredefined":"uniquePredefined");this.selectType="MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"multiple":"UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"unique":"LIST_VALUE_PROVIDER"===this.providerType?"unique":"multiple";this.disPlayLabel="value";!this.runtime||"multiplePredefined"!==this.controlType&&"uniquePredefined"!==this.controlType||(this.disPlayLabel=
"alias");!this.runtime||"multipleDynamic"!==this.controlType&&"uniqueDynamic"!==this.controlType||(this.isLoadDataAdvanced=!0);this.runtime&&"esriFieldTypeDate"===this.fieldInfo.type&&this.partObj.fieldObj&&(this.fieldPopupInfo={format:{dateFormat:this.partObj.fieldObj.dateFormat}});this.isNumberField=e.isNumberField(this.fieldInfo.type);this.pageControlForQuery||(this.pageControlForQuery=new a({pageSize:this.pageSize,pageIndex:1,layerUrl:this.url,fieldInfo:this.fieldInfo,queryWhere:"1\x3d1",layerDefinition:this.layerDefinition,
fieldPopupInfo:this.fieldPopupInfo,isNumberField:this.isNumberField}),this.pageControlForQuery.on("query_getNewExpr",q.hitch(this,this._resetPageControlNewExpr)));this.listSelect||(this._resetPromptLabel(!1),this.listSelectDataList=this.partObj&&this.partObj.valueObj&&this.partObj.valueObj.value?this.partObj.valueObj.value:[],this.listSelect=new d({label:this.promptLabel.innerHTML,emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,selectUI:this.selectUI,controlType:this.controlType,
selectType:this.selectType,dataList:this.listSelectDataList,selectedDataList:[],isNumberField:this.isNumberField}),q.isArray(this.listSelectDataList)?this.getCheckedList(this.listSelectDataList):(this.listSelect.checkedList=[this.listSelectDataList],this.listSelect._updateCheckedLabelListFromCheckedList()),this.listSelect.on("advancedListValueSelect_itemChecked",q.hitch(this,this._createTarget)),this.listSelect.on("advancedListValueSelect_itemUnChecked",q.hitch(this,this._destoryTarget)),this.listSelect.on("advancedListValueSelect_addNextPage",
q.hitch(this,this._addNextPage)),this.listSelect.on("advancedListValueSelect_searchKey",q.hitch(this,this._searchKey)),this.listSelect.on("advancedListValueSelect_searchKeyLocal",q.hitch(this,this._searchKeyLocal)),this.listSelect.on("advancedListValueSelect_itemsConfirmed",q.hitch(this,function(){this.cbxPopup&&this.cbxPopup.domNode&&("block"===v.getStyle(this.cbxPopup.domNode,"display")&&(this._resetListSelectState(this),this.cbxPopup.hide()),this.checkedBtn.focus())})),this.own(A(this.checkedBtn,
"keydown",q.hitch(this,function(h){v.hasClass(h.target||h.srcElement,"checkBtn")&&h.keyCode===w.ENTER&&this._checkedBtnEvent()}))),this.staticValues||"function"!==typeof this._checkedBtnEvent||(!this.codedValues||this.codedValues&&this.filterCodedValue)&&this.layerInfo&&this.layerInfo.getLayerObject().then(q.hitch(this,function(h){h.on("edits-complete",q.hitch(this,function(){this.layerDataChanged=!0}))})));"dropdown"===this.selectUI?(v.setStyle(this.checkedBtn,"display","block"),this._multipleSelectProviderEventHandler=
q.hitch(this,this._multipleSelectProviderEvent),document.addEventListener("click",this._multipleSelectProviderEventHandler,{capture:!0})):this.listSelect.placeAt(this.listContent)},_resetPromptLabel:function(h){h=h?this.nls.noFilterValueTip+" ":"";"undefined"!==typeof this.promptLabel&&(this.promptLabel.innerHTML=e.sanitizeHTML(this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint+h))},filterExpr:null,_resetPageControlNewExpr:function(){var h=this.getDropdownFilterExpr(this.partObj.widgetId);
return this.filterExpr!==h?(this.pageControlForQuery.reset(),this.filterExpr=this.pageControlForQuery.cascadeFilterExprs=h,!0):!1},_multipleSelectProviderEvent:function(h){h=h.target||h.srcElement;if(this.cbxPopup&&this.cbxPopup.domNode){if(v.isDescendant(h,this.cbxPopup.domNode)||v.isDescendant(h,this.checkedBtn))return;"block"===v.getStyle(this.cbxPopup.domNode,"display")&&(this._resetListSelectState(this),this.cbxPopup.hide())}else!v.isDescendant(h,this.checkedBtn)&&this.isPopupLoading&&(this.isLoadDataAdvanced=
!0);this.msgDiv&&v.setStyle(this.msgDiv,"display","none")},_checkedBtnEvent:function(){this._showPopup()},_onBeforeDropDownMouseDown:function(){this._tryUpdatingUniqueValues(void 0,!0);return arguments},_isRestSelectList:!1,_resetListSelectState:function(h){"block"===v.getStyle(h.listSelect.searchKeyInput,"display")&&("multipleDynamic"===this.controlType&&this.listSelect.showAllList(),h.listSelect.listContainer.scrollTop=0,h.listSelect.queryState=!0,h.listSelect.valueInput.set("value",""),this._isRestSelectList=
!0)},_createTarget:function(h){this._checkedChanged(1,h);this.cbxPopup&&("uniqueDynamic"===this.controlType||"uniquePredefined"===this.controlType)&&this.cbxPopup.domNode&&(this._resetListSelectState(this),this.cbxPopup.close())},_destoryTarget:function(h){this._checkedChanged(-1,h)},_checkedChanged:function(h,p){if("multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType&&this.runtime&&"dropdown"===this.selectUI)p&&(h=parseInt(this.checkedNum.innerText,10)+h,this.checkedNum.innerText=
0<h?h:0);else if("uniqueDynamic"===this.controlType||"uniquePredefined"===this.controlType&&this.runtime&&"dropdown"===this.selectUI)"uniqueDynamic"===this.controlType&&(p===this.emptyStr?v.addClass(this.checkedNameDiv,"checkedEmptyNameDiv"):v.removeClass(this.checkedNameDiv,"checkedEmptyNameDiv")),h=p?p:this._getCheckedNameDivText(),this._setCheckedNameDivText(h);this.listSelect.set("displayedValue","12345678");this.emit("change")},_clearCheckedTxt:function(){this.runtime&&"dropdown"===this.selectUI&&
("multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType?this.checkedNum.textContent?this.checkedNum.textContent=0:this.checkedNum.innerText=0:("uniqueDynamic"===this.controlType||"uniquePredefined"===this.controlType)&&this._setCheckedNameDivText(""),this.valueList=[],this.listSelect.checkedList=[],this.listSelect.checkedLabelList=[],this.listSelect.valueInput.set("value",""),"multipleDynamic"===this.controlType&&this.listSelect.showAllList());this.listSelect.set("displayedValue",
"12345678");this.emit("change")},_layerDataChangedCallback:function(){this.layerDataChanged&&(this.pageControlForQuery.reset(),this.listSelect.ifFristPage=!0,this.layerDataChanged=!1)},_addNextPage:function(){this.listSelect&&(this._showLoadingIcon(),this._layerDataChangedCallback(),this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage).then(q.hitch(this,function(h){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;this.listSelect.ifFristPage&&this._checkIfNoData(h)||
(this.listSelect.setCBXData(h,!0,this.listSelect.ifFristPage),this._hideLoadingIcon())}),q.hitch(this,function(h){console.log(h);this.listSelect.queryState=!1;this._hideLoadingIcon()})))},_searchKey:function(h){this.listSelect&&(this._showLoadingIcon(),this._layerDataChangedCallback(),this.pageControlForQuery._searchKey(h).then(q.hitch(this,function(p){this.listSelect.setCBXContentBySearch(p);this._resetPopupStyles(!p.length);this._hideLoadingIcon()}),q.hitch(this,function(p){console.log(p);this._hideLoadingIcon()})))},
_searchKeyLocal:function(h,p){if(this.listSelect){"uniqueDynamic"===this.controlType&&this._isRestSelectList&&(this.listSelect.keyQueryMode=!1,this._isRestSelectList=this.listSelect.cacheQueryMode=!1);this._showLoadingIcon();var B=this.pageControlForQuery._searchKeyLocal(h);""===h&&0===B.length?(this.layerDataChanged=!0,this._layerDataChangedCallback(),this._addNextPage()):this.listSelect.setCBXContentBySearch(B,p);this._resetPopupStyles(!0);this._hideLoadingIcon()}},queryByPage:function(){var h=
this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage);h.then(q.hitch(this,function(p){h.resolve(p)}),q.hitch(this,function(p){console.log(p);h.reject(p)}))},getCheckedList:function(h){this.listSelect.checkedList=[];this.listSelect.checkedLabelList=[];r.forEach(h,q.hitch(this,function(p){if(q.isObject(p)){if(p.isChecked)var B=p.value}else B=p;if(B||0===B)B=this.isNumberField?parseFloat(B):B,this.listSelect.checkedList.push(B)}))},getCheckedStrsList:function(h){var p=[];r.forEach(h,q.hitch(this,
function(B){var u;q.isObject(B)?B.isChecked&&(u=B[this.disPlayLabel]):u=B;(u||0===u)&&p.push(u)}));return p},showContent:function(h){var p=new E;this.getCheckedList(this.valueList);this.listSelect.codedValues=!1;this.listSelect.disPlayLabel="value";if("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType){this.runtime&&(this.listSelect.disPlayLabel="alias");var B=this._checkIfNoData(this.valueList);B||(this.listSelect.setCBXData(this.valueList,!0,h),this.listSelect._updateCheckedLabelListFromCheckedList());
this._hideLoadingIcon();p.resolve(B);return p}if(this.staticValues)return B=this._setValueForStaticValues(this.staticValues),p.resolve(B),p;if(this.codedValues)if(this.filterCodedValue)this.listSelect.codedValues=!0;else return B=this._setValueForStaticValues(this.codedValues),p.resolve(B),p;this._showLoadingIcon();if("multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType)this._layerDataChangedCallback(),this.pageControlForQuery.queryByPage(h).then(q.hitch(this,function(u){this.listSelect.isCacheFinish=
this.pageControlForQuery._isUniqueValueCacheFinish;u=this._handleCodedValue(u);(B=this._checkIfNoData(u))||this.listSelect.setCBXData(u,!0,h);this._hideLoadingIcon();p.resolve(B)}),q.hitch(this,function(u){console.log(u);this._hideLoadingIcon();p.reject(u)}));return p},_handleCodedValue:function(h){this.listSelect.disPlayLabel="label";if(!this.codedValues)return this.listSelect._updateCheckedLabelListFromCheckedList(),h;this.pageControlForQuery._codedvalueCache=h;"uniqueDynamic"===this.controlType&&
this._setCheckedName(this.listSelect.checkedList?this.listSelect.checkedList[0]:"",h);this.listSelect._updateCheckedLabelList(this.codedValues);return h},_showDropdown:function(h){var p=v.position(h.target);var B=this.isInFilterSet?this.domNode.parentNode.parentNode.parentNode:this.domNode.parentNode;var u=v.position(B);if("none"!==v.getStyle(this.listContentPopup,"display"))v.setStyle(this.listContentPopup,"display","none");else{r.forEach(k(".value-type-popup",B),function(z){v.setStyle(z,"display",
"none")},this);v.place(this.listContentPopup,B);var t=v.hasClass(k(".desktop-add-section",B.parentNode)[0],"hidden")?-5:30;t=p.y-u.y-B.parentNode.scrollTop+t;t+170>B.parentNode.scrollHeight&&(t=B.parentNode.scrollHeight-170-40);window.isRTL?p=p.x-u.x+20:(p=p.x-u.x-100-90,p+150>B.clientWidth&&(p=B.clientWidth-150));v.setStyle(this.listContentPopup,{display:"block",left:p+"px",top:t+"px"});h.stopPropagation()}},_calculatePopup:function(){var h=v.position(this.domNode.parentNode),p=v.position(document.body).h,
B=h.y+30;p-B<this._cbxHeight&&(B=h.y-this._cbxHeight);return{left:h.x,top:B}},_cbxWidth:210,_cbxHeight:362,popupIsNoData:!1,isPopupLoading:!1,isLoadDataAdvanced:!1,_showPopup:function(){if(!this.isPopupLoading)if(this.cbxPopup&&this.cbxPopup.domNode&&"block"===v.getStyle(this.cbxPopup.domNode,"display"))this._resetListSelectState(this),this.cbxPopup.hide();else{var h=this._resetPageControlNewExpr();h&&this.cbxPopup&&(this.cbxPopup.close(),this._clearCheckedTxt());if(h||this.cbxPopup){var p=this._calculatePopup();
this._cbxWidth=v.getStyle(this.checkedBtn,"width");if(!h&&this.cbxPopup&&this.cbxPopup.domNode&&!this.layerDataChanged)this.popupIsNoData?this._checkIfNoData([]):(this.cbxPopup.show(),this._resetPopupStyles(),this.listSelect.valueInput&&"block"===v.getStyle(this.listSelect.searchKeyInput,"display")?this.listSelect.valueInput.focus():this.listSelect.listContent.focus(),this.listSelect.queryState=!1);else{this.isPopupLoading=!0;this.isLoadDataAdvanced||this._showDataQueryingIcon();var B=this.showContent(!0);
B.then(q.hitch(this,function(u){this.isPopupLoading=!1;this._hideDataQueryingIcon();(this.popupIsNoData=u)?this._clearCheckedTxt():(this.cbxPopup=new f({width:this._cbxWidth,height:this._cbxHeight,content:this.listSelect.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:p.left,top:p.top},hiddenAfterInit:this.isLoadDataAdvanced,useFocusLogic:!1,onClose:q.hitch(this,function(){this.cbxPopup.hide();return!1}),buttons:[]}),this.cbxPopup.setDomNodeStyls({"border-radius":0,
border:"1px solid #999"}),this.cbxPopup.on("popupHasInitedSuccessfully",q.hitch(this,function(t){this._resetPopupStyles(!1,!0);t||(this.listSelect.valueInput&&"block"===v.getStyle(this.listSelect.searchKeyInput,"display")?this.listSelect.valueInput.focus():this.listSelect.listContent.focus())})));this.isLoadDataAdvanced&&(this.isLoadDataAdvanced=!1)}),q.hitch(this,function(u){this.isPopupLoading=!1;console.log(u);B.reject(u)}))}}else v.setStyle(this.msgDiv,"display","block")}},_itemContainerH:300,
_resetPopupStyles:function(h,p){var B=this._itemContainerH,u=v.getStyle(this.listSelect.listContent,"height");0===u&&this.cbxPopup&&this.cbxPopup.domNode&&"none"===v.getStyle(this.cbxPopup.domNode,"display")&&(u=this.popupInitHeight);p&&(this.popupInitHeight=u);!h||this.listSelect.codedValues||this.pageControlForQuery._isUniqueValueCacheFinish||(u+=25);this.pageControlForQuery._isUniqueValueCacheFinish&&"block"===v.getStyle(this.listSelect.noDataTips,"display")&&(u+=30);B=u<B?u:B;v.setStyle(this.listSelect.listContainer,
"height",B+"px");v.setStyle(this.listSelect.selectedContainer,"height",B+30+"px");"multipleDynamic"===this.controlType?B=B+30+30:"uniqueDynamic"===this.controlType&&(B+=30);this._cbxHeight=B+10;h=this._calculatePopup();this._cbxWidth=v.getStyle(this.checkedBtn,"width");this.cbxPopup.setCustomPosition(h.left,h.top,this._cbxWidth,this._cbxHeight);this._resetItemWidth()},_resetItemWidth:function(){var h=this._cbxWidth-20;"uniqueDynamic"===this.controlType||this.runtime&&"uniquePredefined"===this.controlType&&
"dropdown"===this.selectUI||!this.runtime&&("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType)||(h=!this.runtime||"dropdown"===this.selectUI||"uniquePredefined"!==this.controlType&&"multiplePredefined"!==this.controlType?h-30:h-15);window.isRTL&&(h-=3);this.listSelect._itemLabelW=h;k(".item .label",this.listSelect.listContent).style({"max-width":h+"px"})},_setValueForStaticValues:function(h){this.listSelect.codedValues=!0;this.listSelect._updateCheckedLabelList(this.codedValues);
if(h){this.pageControlForQuery._codedvalueCache=h;var p=this._checkIfNoData(h);p||(this.listSelect.disPlayLabel="label",this.listSelect.setCBXData(h,!0,!0));return p}return!1},_checkIfNoData:function(h){if(this.runtime&&"dropdown"===this.selectUI){if(h&&0<h.length)return this._resetPromptLabel(!1),!1;this.msgDiv?v.setStyle(this.msgDiv,"display","block"):(this.msgDiv=document.createElement("div"),v.addClass(this.msgDiv,"jimu-filter-list-value-provider-tip-container"),this.msgDiv.innerHTML=this.noDataTips,
this.checkedBtn.parentNode.appendChild(this.msgDiv));this._resetPromptLabel(!0);return!0}this._resetPromptLabel(!1);return!1},getDijits:function(){return[this.listSelect]},_setCheckedName:function(h,p){var B=h;if(p=p?p:this.codedValues){for(var u=!1,t=0;t<p.length;t++){var z=p[t];if(z.value===h){B=z.label;u=!0;break}}u||(B=this.emptyStr,this.valueList=[],this.listSelect&&(this.listSelect.checkedList=[],this.listSelect.checkedLabelList=[]))}else void 0===h?(B=this.emptyStr,v.addClass(this.checkedNameDiv,
"checkedEmptyNameDiv")):v.removeClass(this.checkedNameDiv,"checkedEmptyNameDiv");this._setCheckedNameDivText(B)},setValueObject:function(h){h.value=h.value||0===h.value?h.value:[];this.valueList=h.value;this.enableEmpty=h.enableEmpty;this.listSelect.enableEmpty=h.enableEmpty;if("multipleDynamic"===this.controlType)this.checkedNum.innerText=this.valueList.length,this.isLoadDataAdvanced&&this._checkedBtnEvent();else if("uniqueDynamic"===this.controlType){h=this.valueList;q.isArray(h)&&0===h.length&&
(h=void 0);this._setCheckedName(h);this.valueList=[this.valueList];if(h&&"esriFieldTypeDate"===this.fieldInfo.type){var p=e.getDateByDateTimeStrAndFormat(h,this.fieldPopupInfo);h=e.getDateTimeStrByFieldInfo(p,this.fieldPopupInfo);p=e.localizeDateByFieldInfo(p,this.fieldPopupInfo);this._setCheckedName(p);this.valueList=[h]}this.isLoadDataAdvanced&&this._checkedBtnEvent()}else this.emptyStr=h.emptyLabel?h.emptyLabel:this.emptyStr,this.listSelect.emptyStr=this.emptyStr,this.runtime&&"dropdown"===this.selectUI&&
(p=[],"value"===this.disPlayLabel?(this.getCheckedList(this.valueList),p=this.listSelect.checkedList):p=this.getCheckedStrsList(this.valueList),"uniquePredefined"===this.controlType?0<this.listSelect.checkedList.length?this._setCheckedNameDivText(p[0]):this._setCheckedNameDivText(h.enableEmpty?this.emptyStr:""):this.checkedNum.innerText=p.length),this.showContent(!0),setTimeout(q.hitch(this,function(){this._cbxWidth=v.getStyle(this.listSelect.listContent,"width");this._resetItemWidth()}),50)},_getCheckedNameDivText:function(){return this.checkedNameDiv.textContent||
this.checkedNameDiv.innerText||""},_setCheckedNameDivText:function(h){this.isNumberField&&"number"===typeof h&&(h=e._getValues(this.layerDefinition,this.fieldPopupInfo,this.fieldName,[h])[0].label);this.checkedNameDiv.textContent?this.checkedNameDiv.textContent=h:this.checkedNameDiv.innerText=h},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var h=null;h="multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType?[]:"string"===
this.shortType?"":null;return{isValid:!0,type:this.partObj.valueObj.type,value:h}}return null},getValueObject:function(){if(this.isValidValue()){var h="multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType?this.listSelect.getListCheckedValues():this.listSelect.getListValues();"uniqueDynamic"===this.controlType&&(h=q.isArray(h)?h[0]:h);return{isValid:!0,type:this.partObj.valueObj.type,value:h}}return null},setRequired:function(h){this.listSelect.set("required",h)},_showDataQueryingIcon:function(){this._validatingNode||
(this._validatingNode=v.create("div",{"class":"jimu-circle-loading"},this.checkedBtn));v.setStyle(this._validatingNode,"display","block")},_hideDataQueryingIcon:function(){this._validatingNode&&v.setStyle(this._validatingNode,"display","none")},_showLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&v.addClass(this.listSelect.listContainer,"jimu-circle-loading")},_hideLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&v.removeClass(this.listSelect.listContainer,
"jimu-circle-loading")},destroy:function(){this._multipleSelectProviderEventHandler&&document.removeEventListener("click",this._multipleSelectProviderEventHandler,{capture:!0});this.cbxPopup&&this.cbxPopup.domNode&&(this.cbxPopup.onClose=q.hitch(this,function(){return!0}),this.cbxPopup.close());this.inherited(arguments)},destroyProvider:function(){this.listSelect&&this.listSelect.destroy();this.listSelect=null}})})},"jimu/dijit/_filter/AdvancedListValueSelect":function(){define("dojo/_base/lang dojo/Evented dojo/_base/html dojo/_base/declare dijit/_WidgetBase dojo/on dojo/keys dojo/query dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./AdvancedListValueSelect.html jimu/utils".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c){return w([m,k,n,q],{templateString:d,selectType:null,dataList:[],checkedList:[],checkedLabelList:[],_itemLabelW:215,ifFristPage:!0,queryState:!0,isCacheFinish:!1,keyQueryMode:!1,cacheQueryMode:!1,emptyStr:"",postMixInProperties:function(){this.inherited(arguments);this.jimuCommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder;this.noDataNls=window.apiNls.widgets.FeatureTable.noData},postCreate:function(){this.inherited(arguments);this.inputType="unique"===
this.selectType?"radio":"checkbox";if("multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType)A.addClass(this.listContainer,"items-setting-dropdown-content"),this.searchKeyInput.style.display="block";"uniqueDynamic"===this.controlType&&A.addClass(this.listContainer,"items_content_no_selected_toggle");this.runtime?(A.addClass(this.listContainer,"items-widget-content"),"dropdown"!==this.selectUI&&(A.addClass(this.listContainer,"items-widget-expaned-content"),A.addClass(this.listContent,
"jimu-multiple-items-expanded-list"),A.setAttr(this.listContent,"aria-label",this.label),A.addClass(this.listContent,c.lastFocusNodeClassInDOM),A.removeAttr(this.multipleSelect,"tabindex"))):(A.addClass(this.listContainer,"items-setting-popup-content"),this.searchKeyInput.style.display="block");this.runtime||"predefined"!==this.controlType||(A.addClass(this.listContainer,"items-setting-dropdown-content"),A.addClass(this.listContainer,"items_content_no_selected_toggle"),this.searchKeyInput.style.display=
"block");this._addCBXClickEvent();this._addCBXHoverEvent();this.disPlayLabel="value";!this.runtime||"multiplePredefined"!==this.controlType&&"uniquePredefined"!==this.controlType||(this.disPlayLabel="alias");"multipleDynamic"===this.controlType&&(this.selectedToggleDiv.style.display="block",this.selectedToggle=l(".showAllIcon",this.selectedToggleDiv)[0],this.own(v(this.selectedToggleDiv,"click",E.hitch(this,"_toggleFilter"))),this.own(v(this.selectedToggleDiv,"keydown",E.hitch(this,function(g){g.keyCode===
r.ENTER&&this._toggleFilter(g)}))),this._addSelectedContainerEvent());this._addKeyDownEvent()},_addKeyDownEvent:function(){this.own(v(this.multipleSelect,"keydown",E.hitch(this,function(g){var b=g.which||g.keyCode,e=g.target;if(b===r.ESCAPE||"dropdown"===this.selectUI&&("INPUT"===e.tagName&&g.shiftKey&&b===r.TAB||("multipleDynamic"===this.controlType&&A.hasClass(e,"clearAllSelectedIcon")||"multipleDynamic"!==this.controlType&&A.hasClass(e,"item"))&&!g.shiftKey&&b===r.TAB))g.preventDefault(),this.currentHoverItem&&
(A.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=null),this.emit("advancedListValueSelect_itemsConfirmed")})));this.own(v(this.listContent,"focus",E.hitch(this,function(){c.isInNavMode()&&(this.currentItem=(this.currentItem=this.getCurrentItem())?this.currentItem:this._getCheckInputItems()[0],this.currentHoverItem=this.currentItem.parentNode,"dropdown"===this.selectUI?this.currentHoverItem.focus():this._isFocusFirstItem=!0,A.addClass(this.currentHoverItem,"active"),setTimeout(E.hitch(this,
function(){A.addClass(this.currentHoverItem,"active")}),10))})));this.own(v(this.listContent,"blur",E.hitch(this,function(){this.currentHoverItem&&A.removeClass(this.currentHoverItem,"active")})));this.own(v(this.showAllIconBtn,"keydown",E.hitch(this,function(g){g.shiftKey&&g.keyCode===r.TAB&&(g.preventDefault(),"block"===A.getStyle(this.selectedContainer,"display")?this.selectedListContent.focus():this.listContent.focus())})));this.own(v(this.listContent,"keydown",E.hitch(this,function(g){if(c.isInNavMode()){var b=
g.which||g.keyCode;-1<[r.SPACE,r.UP_ARROW,r.DOWN_ARROW].indexOf(b)&&g.preventDefault();if(b===r.TAB&&A.hasClass(g.target,"item"))g.preventDefault(),this.currentHoverItem&&A.removeClass(this.currentHoverItem,"active"),"dropdown"===this.selectUI?(this.currentHoverItem=null,g.shiftKey?"block"===this.searchKeyInput.style.display?this.valueInput.focus():this.emit("advancedListValueSelect_itemsConfirmed"):"multipleDynamic"===this.controlType&&this.showAllIconBtn.focus()):this.listContent.focus();else if(b===
r.SPACE||b===r.ENTER)g=l(".checkInput",this.currentHoverItem)[0],b=l(".label",this.currentHoverItem)[0],this._setCBXChecked(g,this._getNodeText(b)),"radio"===this.inputType&&("dropdown"===this.selectUI&&(A.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=null),this.emit("advancedListValueSelect_itemsConfirmed"));else if(b===r.UP_ARROW||b===r.DOWN_ARROW)if("dropdown"!==this.selectUI&&this._isFocusFirstItem)this._isFocusFirstItem=!1,this.currentHoverItem.focus(),setTimeout(E.hitch(this,
function(){A.addClass(this.currentHoverItem,"active")}),5);else{g=(g=b===r.UP_ARROW?this.currentHoverItem.previousSibling:this.currentHoverItem.nextSibling)?g:this.currentHoverItem;if(this.listContainer.scrollHeight>this.listContainer.clientHeight){b=this.listContainer.clientHeight+this.listContainer.scrollTop;var e=g.offsetTop+g.offsetHeight;e-=30;e>b?this.listContainer.scrollTop=e-this.listContainer.clientHeight:g.offsetTop<this.listContainer.scrollTop+30&&(this.listContainer.scrollTop=g.offsetTop-
30)}A.removeClass(this.currentHoverItem,"active");this.currentHoverItem=g;A.addClass(this.currentHoverItem,"active");this.currentHoverItem.focus()}}})));this.own(v(this.selectedListContent,"focus",E.hitch(this,function(){if(c.isInNavMode()){var g=l(".item",this.selectedListContent);g.length&&(this.currentHoverItem=g[0],this.currentHoverItem.focus(),A.addClass(this.currentHoverItem,"active"),setTimeout(E.hitch(this,function(){A.addClass(this.currentHoverItem,"active")}),50))}})));this.own(v(this.selectedListContent,
"blur",E.hitch(this,function(){c.isInNavMode()&&this.currentHoverItem&&A.removeClass(this.currentHoverItem,"active")})));this.own(v(this.selectedContainer,"keydown",E.hitch(this,function(g){if(c.isInNavMode()){var b=g.which||g.keyCode;if(b===r.TAB)g.preventDefault(),this.currentHoverItem&&A.removeClass(this.currentHoverItem,"active"),this.showAllIconBtn.focus();else if(0!==l(".item",this.selectedListContent).length)if(-1<[r.SPACE,r.UP_ARROW,r.DOWN_ARROW].indexOf(b)&&g.preventDefault(),b===r.SPACE||
b===r.ENTER)g=l(".checkInput",this.currentHoverItem)[0],b=l(".label",this.currentHoverItem)[0],this._setCBXSelectedChecked(g,this._getNodeText(b));else if(b===r.UP_ARROW||b===r.DOWN_ARROW)g=(g=b===r.UP_ARROW?this.currentHoverItem.previousSibling:this.currentHoverItem.nextSibling)?g:this.currentHoverItem,this.selectedContainer.scrollHeight>this.selectedContainer.clientHeight&&(b=g.offsetTop+g.offsetHeight,b>this.selectedContainer.clientHeight+this.selectedContainer.scrollTop?this.selectedContainer.scrollTop=
b-this.selectedContainer.clientHeight:g.offsetTop<this.selectedContainer.scrollTop&&(this.selectedContainer.scrollTop=g.offsetTop)),A.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=g,A.addClass(this.currentHoverItem,"active"),this.currentHoverItem.focus()}})))},_toggleFilter:function(g){var b=g.target;A.hasClass(b,"clearAllSelectedIcon")?(this._clearAllSelected(),this.currentHoverItem=this.currentItem=null):A.hasClass(b,"iconHover")||A.hasClass(b,"selectedToggleDiv")||(A.hasClass(b,
"showAllIcon")?(this.selectedContainer.style.display="none",this.listContent.focus()):(this._initSelectedContainerItems(),this.selectedContainer.style.display="block",this.selectedListContent.focus()),A.removeClass(this.selectedToggle,"iconHover"),this.selectedToggle=b,A.addClass(this.selectedToggle,"iconHover"),g.stopPropagation())},showAllList:function(){A.hasClass(this.selectedToggle,"showSelectedIcon")&&A.hasClass(this.selectedToggle,"iconHover")&&(A.removeClass(this.selectedToggle,"iconHover"),
this.selectedToggle=l(".showAllIcon",this.selectedToggleDiv)[0],A.addClass(this.selectedToggle,"iconHover"),A.setStyle(this.selectedContainer,"display","none"))},_clearAllSelected:function(){var g=A.hasClass(this.selectedToggle,"showAllIcon")?this.listContainer:this.selectedListContent;g=l(".item .checkInput.checked",g);for(var b=0;b<g.length;b++)g[b].click()},_initSelectedContainerItems:function(){for(var g=this.selectedListContent.innerHTML="",b=this.runtime?" labelRuntime":"",e=0;e<this.checkedList.length;e++){var a=
this.checkedList[e],f="value"===this.disPlayLabel?a:this.checkedLabelList[e];a='data\x3d"'+(this.isNumberField?a:encodeURIComponent(a))+'"';g+='\x3cdiv role\x3d"option" class\x3d"item" tabindex\x3d"-1" aria-selected\x3d"true" aria-checked\x3d"true"\x3e\x3cdiv class\x3d"checkInput '+this.inputType+' checked" '+a+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label jimu-ellipsis-Blanks'+b+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+f+"\x3c/div\x3e\x3c/div\x3e"}this.selectedListContent.innerHTML=g},_addSelectedContainerEvent:function(){this.own(v(this.selectedListContent,
"click",E.hitch(this,function(g){var b=g.target;if(A.hasClass(b,"item")){var e=b.firstElementChild;b=b.firstElementChild.nextSibling}else if(A.hasClass(b,"checkInput"))e=b,b=b.nextSibling;else if(A.hasClass(b,"label"))e=b.previousSibling;else{g.stopPropagation();return}this._setCBXSelectedChecked(e,this._getNodeText(b));g.stopPropagation()})))},_setCBXSelectedChecked:function(g,b){var e=b;if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)e=decodeURIComponent(A.getAttr(g,"data"));A.hasClass(g,
"checked")?(A.setAttr(g.parentNode,"aria-checked","false"),"radio"!==this.inputType&&(A.removeClass(g,"checked"),this._updateCheckedList("remove",e,b),this.checkCBXItems(),this.emit("advancedListValueSelect_itemUnChecked",b))):(A.setAttr(g.parentNode,"aria-checked","true"),"radio"===this.inputType&&this.currentItem&&(!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),A.removeClass(this.currentItem,"checked")),A.addClass(g,"checked"),this._updateCheckedList("add",e,b),this.checkCBXItems(),
this.emit("advancedListValueSelect_itemChecked",b))},_getNodeText:function(g){return g.textContent||g.innerText||""},_updateCheckedList:function(g,b,e){b!==this.emptyStr&&(b=this.isNumberField?parseFloat(b):b);if("remove"===g)for(var a in this.checkedList){if(this.checkedList[a]===b||this.isNumberField&&isNaN(this.checkedList[a])&&isNaN(b)){this.checkedList.splice(a,1);this.checkedLabelList.splice(a,1);break}}else"radio"===this.inputType?(this.checkedList=[b],this.checkedLabelList=[e]):(this.checkedList.push(b),
this.checkedLabelList.push(e));this._updateListContentLabel()},_updateListContentLabel:function(){if("dropdown"!==this.selectUI&&this.runtime){var g=this.checkedLabelList.join(" ");g=g?g:this.emptyStr;A.setAttr(this.listContent,"aria-label",this.label+g)}},_updateCheckedLabelList:function(g){this.checkedLabelList=[];for(var b=0;b<this.checkedList.length;b++)for(var e=0;e<g.length;e++)this.checkedList[b]===g[e].value&&this.checkedLabelList.push(g[e].label)},_updateCheckedLabelListFromCheckedList:function(){for(var g=
0;g<this.checkedList.length;g++)this.checkedLabelList.push(this.checkedList[g]+"");this._updateListContentLabel()},_createTarget:function(g){g=this._getNodeText(g.target).split(": ")[1];this.emit("advancedListValueSelect_itemChecked",g)},_deleteCBXItem:function(){},_getCheckInputItems:function(){return l(".item .checkInput",this.listContent)},getListCheckedValuesOrigin:function(){for(var g=[],b=this._getCheckInputItems(),e=0;e<b.length;e++){var a=b[e],f=this._getNodeText(a.nextSibling);A.hasClass(a,
"checked")&&g.push(f)}return g},getListCheckedValues:function(){for(var g=[],b=E.clone(this.checkedList),e=0;e<b.length;e++){var a=b[e];a=this.isNumberField?parseFloat(a):a;g.push(a)}return g},getListValues:function(){var g=[],b=this._getCheckInputItems();if(0===b.length)return this.dataList;for(var e=0;e<b.length;e++){var a=b[e],f=this._getNodeText(a.nextSibling);if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)f=decodeURIComponent(A.getAttr(a,"data"));f=this.isNumberField?parseFloat(f):
f;f={value:f,isChecked:!1};A.hasClass(a,"checked")&&(f.isChecked=!0);g.push(f)}return g},getIfValueExist:function(g){for(var b=this._getCheckInputItems(),e=0;e<b.length;e++){var a=this._getNodeText(b[e].nextSibling);if(g===a)return!0}return!1},getCurrentItem:function(){for(var g=this._getCheckInputItems(),b=0;b<g.length;b++){var e=g[b];if(A.hasClass(e,"checked"))return e}return null},checkCBXItems:function(g){g=g?"":this.valueInput.get("value");this.valueInput.set("value",g);g=l(".item .label",this.listContent);
for(var b=0;b<g.length;b++){var e=g[b],a="value"===this.disPlayLabel?this._getNodeText(e):decodeURIComponent(A.getAttr(e.previousSibling,"data"));a=this.isNumberField?parseFloat(a):a;0<=this.checkedList.indexOf(a)||this.isNumberField&&0<=this.checkedList.indexOf(parseFloat(a))?A.addClass(e.previousSibling,"checked"):A.removeClass(e.previousSibling,"checked")}},reset:function(){this.listContent.innerHTML=""},setCBXData:function(g,b,e,a){a||(this.queryState=!1);g=g?g:[];if(this.listContent){A.setStyle(this.noDataTips,
"display","none");var f=0,h="radio"===this.inputType?" labelBig":"",p=this.runtime?" labelRuntime":"";a=this.listContent.innerHTML;if(e){a=this.listContent.innerHTML="";if("uniquePredefined"===this.controlType&&this.enableEmpty||"uniqueDynamic"===this.controlType&&!this.keyQueryMode)e=a="",this.checkedList[0]===this.emptyStr&&(a=" checked",e=" active",f=1),0===this.checkedList.length&&(a=" checked",this.currentItem=!0,f=1),a='\x3cdiv role\x3d"option" class\x3d"item emptyItem'+e+'" aria-selected\x3d"true" tabindex\x3d"-1" '+
(a?'aria-checked\x3d"true"':'aria-checked\x3d"false"')+'\x3e\x3cdiv class\x3d"checkInput '+this.inputType+a+"\" data\x3d'"+(this.emptyStr+"'\x3e\x3c/div\x3e\x3cdiv class\x3d\"label")+h+" jimu-ellipsis-Blanks"+p+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+this.emptyStr+"\x3c/div\x3e\x3c/div\x3e";this.listContainer.scrollTop=0}if(0===g.length)return g=this.listContent.innerHTML.replace(/(^\s*)|(\s*$)/g,""),""!==g||this.cacheQueryMode&&!this.isCacheFinish||A.setStyle(this.noDataTips,"display",
"block"),""===g&&(this.listContent.innerHTML=a),this.listContent;e="";for(var B=0;B<g.length;B++){var u=g[B],t="";if(b)if(this.runtime&&("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType))u.isChecked&&(t=" checked",this.currentItem=!0,f++);else if(0<=this.checkedList.indexOf(u.value)||this.isNumberField&&0<=this.checkedList.indexOf(parseFloat(u.value)))t=" checked",this.currentItem=!0,f++;var z="";z=t?'aria-checked\x3d"true"':'aria-checked\x3d"false"';var x='data\x3d"'+
(this.isNumberField?u.value:encodeURIComponent(u.value))+'"';e+='\x3cdiv class\x3d"item" role\x3d"option" tabindex\x3d"-1" aria-selected\x3d"true" '+z+'\x3e\x3cdiv class\x3d"checkInput '+this.inputType+t+'" '+x+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label'+h+" jimu-ellipsis-Blanks"+p+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+u[this.disPlayLabel]+"\x3c/div\x3e\x3c/div\x3e"}g=this.checkedList.length-f;if(this.runtime&&0<g)for(b=0;b<g;b++)this.emit("advancedListValueSelect_itemUnChecked","");this.listContent.innerHTML=
a+e;return this.listContent}},setCBXContentBySearch:function(g,b){0===g.length?this.setCBXData([],!1,!0,b):this.setCBXData(g,!0,!0,b)},_onSearchKeyChange:function(){var g=this.valueInput.get("value");this.searchName=g;this.listContainer.scrollTop=0;this.reset();this.cacheQueryMode=this.keyQueryMode=this.ifFristPage=!0;this.emit("advancedListValueSelect_searchKeyLocal",g);this.codedValues||(this.isCacheFinish||A.setStyle(this.loadMoreDataBtn,"display","block"),0===g.length&&(this.queryState=this.cacheQueryMode=
this.keyQueryMode=!1,A.setStyle(this.loadMoreDataBtn,"display","none")))},_loadMoreDataFromServer:function(){this.keyQueryMode=this.ifFristPage=!0;this.cacheQueryMode=!1;this.queryState=!0;A.setStyle(this.loadMoreDataBtn,"display","none");var g=this.valueInput.get("value");this.searchName=g;this.listContainer.scrollTop=0;"multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType?this.emit("advancedListValueSelect_searchKey",g):this.runtime||this.emit("advancedListValueSelect_searchKey",
g)},currentHoverItem:null,_addCBXHoverEvent:function(){this.own(v(this.listContent,"mouseover",E.hitch(this,function(g){g=g.target||g.srcElement;if(g=A.hasClass(g,"item")?g:c.getAncestorDom(g,function(b){return A.hasClass(b,"item")},3))this.currentHoverItem&&A.removeClass(this.currentHoverItem,"active"),A.addClass(g,"active"),this.currentHoverItem=g})));this.own(v(this.listContent,"mouseout",E.hitch(this,function(){this.currentHoverItem&&A.removeClass(this.currentHoverItem,"active");this.currentHoverItem=
null})))},_addCBXClickEvent:function(){this.own(v(this.valueInput,"change",E.hitch(this,function(){this._onSearchKeyChange()})));this.own(v(this.loadMoreDataBtn,"click",E.hitch(this,function(){this._loadMoreDataFromServer()})));this.own(v(this.listContainer,"scroll",E.hitch(this,this.dropDownScroll)));this.own(v(this.searchKeyInput,"click",E.hitch(this,function(g){g.stopPropagation()})));this.own(v(this.listContainer,"click",E.hitch(this,function(g){var b=g.target;if(A.hasClass(b,"item")){var e=b.firstElementChild;
b=b.firstElementChild.nextSibling}else if(A.hasClass(b,"checkInput"))e=b,b=b.nextSibling;else if(A.hasClass(b,"label"))e=b.previousSibling;else{g.stopPropagation();return}this._setCBXChecked(e,this._getNodeText(b));g.stopPropagation()})))},scrollDiff:100,dropDownScroll:function(g){this.runtime&&("uniquePredefined"===this.controlType||"multiplePredefined"===this.controlType)||this.cacheQueryMode||this.codedValues||(this.queryState?this.listContainer.scrollTop=this.containerScrollTop:(g=g.target,g.scrollHeight-
g.clientHeight-g.scrollTop<=this.scrollDiff&&!this.queryState&&(this.containerScrollTop=this.listContainer.scrollTop,this.queryState=!0,this.ifFristPage=!1,this.emit("advancedListValueSelect_addNextPage"))))},_setCBXChecked:function(g,b){var e=b;if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)e=decodeURIComponent(A.getAttr(g,"data"));A.hasClass(g,"checked")?(A.setAttr(g.parentNode,"aria-checked","false"),"radio"===this.inputType?this.runtime||"predefined"!==this.controlType?this.emit("advancedListValueSelect_itemChecked",
b):this.emit("advancedListValueSelect_itemCheckedForPredefined",e,b):(A.removeClass(g,"checked"),this._updateCheckedList("remove",e,b),this.emit("advancedListValueSelect_itemUnChecked",b))):(A.setAttr(g.parentNode,"aria-checked","true"),"radio"===this.inputType&&this.currentItem&&(!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),this.currentItem&&(A.removeClass(this.currentItem,"checked"),A.setAttr(this.currentItem.parentNode,"aria-checked","false"))),A.addClass(g,"checked"),this.currentItem=
g,this._updateCheckedList("add",e,b),this.runtime||"predefined"!==this.controlType?this.emit("advancedListValueSelect_itemChecked",b):this.emit("advancedListValueSelect_itemCheckedForPredefined",e,b))},initDoms:function(g,b){this.setCBXData(g,b)},getData:function(){},refreshData:function(){this.checkCBXItems()},validate:function(){var g=this.checkedList.length?"12345678":null;1===this.checkedList.length&&this.checkedList[0]===this.emptyStr&&(g=null);if(this.isNumberField)for(var b=0;b<this.checkedList.length;b++){var e=
this.checkedList[b];if(e!==this.emptyStr&&isNaN(e)){g=null;break}}this.set("DisplayedValue",g);return!0},setRequired:function(g){this.mutiValuesSelect.set("required",g)},destroy:function(){A.destroy(this.domNode);this.inherited(arguments)}})})},"jimu/dijit/_filter/pageControlForQuery":function(){define("dojo/Deferred esri/tasks/query dojo/_base/array dojo/_base/lang dojo/_base/declare jimu/Query jimu/LayerStructure dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./pageControlForQuery.html jimu/filterUtils jimu/utils".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g){return m([l,k,n],{templateString:d,layerUrl:null,fieldInfo:null,fieldPopupInfo:null,spatialReference:null,layerDefinition:null,isNumberField:!1,showNullValues:!1,_isUniqueValueCacheFinish:!1,_uniqueValueCache:{},_uniqueValueCacheForOtherTypes:{},_codedvalueCache:[],cascadeFilterExprs:"1\x3d1",numbericFieldLength:{esriFieldTypeOID:32,esriFieldTypeSmallInteger:16,esriFieldTypeInteger:32,esriFieldTypeSingle:128,esriFieldTypeDouble:1024},pageIndex:1,pageSize:1E3,postCreate:function(){this.inherited(arguments);
this.spatialReference=r.getInstance().map.spatialReference;this.reset();this.queryType=v.getQueryType(this.layerDefinition);this.isNumberField?this.fieldLength=this.numbericFieldLength[this.fieldInfo.type]:(this.filterUtils=new c,this.isLayerHosted=g.isHostedService(this.layerUrl))},reset:function(){this.pageIndex=1;this._isUniqueValueCacheFinish=!1;this._uniqueValueCache={};this._uniqueValueCacheForOtherTypes={};this._codedvalueCache=[]},isKeyQueryLoader:!1,_searchKey:function(b){var e=new E,a=new q,
f="";this.isNumberField?f="CAST("+this.fieldInfo.name+" AS CHAR("+this.fieldLength+")) LIKE '%"+b+"%'":(f=this.isLayerHosted&&this.filterUtils.containsNonLatinCharacter(b)?"N":"",f=this.isLayerHosted?this.fieldInfo.name+" LIKE "+f+"'%"+b.replace(/'/g,"''")+"%'":"LOWER("+this.fieldInfo.name+") LIKE "+f+"'%"+b.replace(/'/g,"''").toLowerCase()+"%'");a.where="(("+this.cascadeFilterExprs+") AND ("+f+"))";a.geometry=null;a.outSpatialReference=this.spatialReference;a.outFields=[this.fieldInfo.name];a.returnDistinctValues=
!0;a.returnGeometry=!1;a.orderByFields=a.outFields;this.layerLoaderForKey=new v({url:this.layerUrl,query:a,pageSize:this.pageSize});this.isKeyQueryLoader=!0;this._uniqueValueCacheForOtherTypes={};this.queryByPage(!0).then(w.hitch(this,function(h){e.resolve(h)}),w.hitch(this,function(h){e.reject("reject:"+h)}));return e},_searchKeyLocal:function(b){b=b.toLowerCase();this.isKeyQueryLoader=!1;var e=[],a=this._codedvalueCache;if(0<a.length)for(var f=0;f<a.length;f++){var h=a[f];h.label&&0<=h.label.toString().toLowerCase().indexOf(b)&&
e.push(h)}else for(f in a=this._uniqueValueCache,a)for(var p=a[f],B=0;B<p.length;B++){h=p[B];var u=h.label;u&&0<=u.toString().toLowerCase().indexOf(b)&&e.push(h)}return e},queryByPage:function(b){var e=new E;this.layerLoader&&this.layerLoader.query.where!==this.cascadeFilterExprs&&(this.layerLoader=null,this.isKeyQueryLoader=!1,this.reset());if(!this.layerLoader){var a=new q;a.where=this.cascadeFilterExprs;a.geometry=null;a.outSpatialReference=this.spatialReference;a.outFields=[this.fieldInfo.name];
a.returnDistinctValues=!0;a.returnGeometry=!1;a.orderByFields=a.outFields;this.layerLoader=new v({url:this.layerUrl,query:a,pageSize:this.pageSize})}b&&(this.pageIndex=1);b=[];if(this.isKeyQueryLoader){if(this._uniqueValueCacheForOtherTypes[this.pageIndex])return b=this._resolveValueLabelsFromCache(this._uniqueValueCacheForOtherTypes),e.resolve(b),e;b=this.layerLoaderForKey}else{if(this._uniqueValueCache[this.pageIndex])return b=this._resolveValueLabelsFromCache(this._uniqueValueCache),e.resolve(b),
e;b=this.layerLoader}1===this.queryType?b.queryByPage(this.pageIndex).then(w.hitch(this,function(f){if(f){var h=f.features||[];f=h.length;this.showNullValues||(h=this._getNotNullValues(h));h=this._getValueLabelsFromFeatures(h);this.isKeyQueryLoader?(this._uniqueValueCacheForOtherTypes[this.pageIndex-1]=h,f<this.pageSize&&(this._uniqueValueCacheForOtherTypes[this.pageIndex]=[])):(this._uniqueValueCache[this.pageIndex-1]=h,f<this.pageSize&&(this._uniqueValueCache[this.pageIndex]=[],this._isUniqueValueCacheFinish=
!0));0===h.length&&this.pageIndex--;e.resolve(h)}else e.reject("Can't get features from current layer")}),w.hitch(this,function(f){e.reject(f)})):b.getAllFeatures().then(w.hitch(this,function(f){if(f){var h=f.features||[];this.showNullValues||(h=this._getNotNullValues(h));f=0<h.length?!0:!1;h=this._getDistinctValues(h);h=this._getValueLabelsFromFeatures(h);h=this.isKeyQueryLoader?this._getAndStoreValueLabelsForOtherTypes(h,this._uniqueValueCacheForOtherTypes):this._getAndStoreValueLabelsForOtherTypes(h,
this._uniqueValueCache);this._isUniqueValueCacheFinish=!0;e.resolve(f?h:[])}else e.reject("Can't get features from current layer")}),w.hitch(this,function(f){e.reject(f)}));this.pageIndex++;return e},_resolveValueLabelsFromCache:function(b){b=b[this.pageIndex];0!==b.length&&this.pageIndex++;return b},_getAndStoreValueLabelsForOtherTypes:function(b,e){for(var a=0;a<b.length;a+=this.pageSize)e[parseInt(a/this.pageSize,10)+1]=b.slice(a,a+this.pageSize);for(var f in e)b=parseInt(f,10)+1,e[b]||(e[b]=[]);
return e[1]},_getDistinctValues:function(b){var e={},a=[],f;for(f in b){var h=b[f],p=h.attributes[this.fieldInfo.name];e[p]||(e[p]=!0,a.push(h))}return a},_getNotNullValues:function(b){return b=A.filter(b,w.hitch(this,function(e){e=e.attributes[this.fieldInfo.name];return"\x3cNull\x3e"!==e&&null!==e}))},_getValueLabelsFromFeatures:function(b){var e=this.fieldInfo.name;b=A.map(b,function(a){return a.attributes[e]});b=g._getValues(this.layerDefinition,this.fieldPopupInfo,e,b);"esriFieldTypeDate"===
this.fieldInfo.type&&(b=this._getDistinctValueLabelsByFormat(b));return b},_getDistinctValueLabelsByFormat:function(b){var e={},a=[],f;for(f in b){var h=b[f].value;e[h]||(e[h]=!0,a.push(b[f]))}return a}})})},"jimu/dijit/_filter/PredefinedValueProvider":function(){define("dojo/_base/html dojo/_base/declare dojo/text!./PredefinedValueProvider.html dojo/_base/lang dojo/on jimu/dijit/Popup ./PredefinedValuePopup ./ValueProvider".split(" "),function(E,q,A,w,m,v,r,l){return q([l],{templateString:A,nls:null,
url:"",layerDefinition:null,partObj:null,fieldInfo:null,codedValues:null,staticValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,runtime:!1,providerType:null,valueProvider:null,postCreate:function(){this.inherited(arguments);this.jimuNls=window.jimuNls;E.addClass(this.domNode,"jimu-filter-indexBtn-value-provider");E.addClass(this.valueProviderPopupNode,"value-type-popup");E.setStyle(this.valueProviderPopupNode,"display","none");var k="";"UNIQUE_PREDEFINED_VALUE_PROVIDER"===
this.providerType?k=this.nls.predefinedUniqueTips:"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType&&(k=this.nls.predefinedMultipleTips);this.indexBtnTips.title=k;this.indexBtnTips.innerText=k+" ...";this._initProvider();this._bindEvent()},_initProvider:function(){var k={preDefinedTips:this.indexBtnTips,nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,partObj:this.partObj,fieldInfo:this.fieldInfo,codedValues:this.codedValues,staticValues:this.staticValues,layerInfo:this.layerInfo,
popupInfo:this.popupInfo,operatorInfo:this.operatorInfo,filterCodedValueIfPossible:this.filterCodedValueIfPossible,runtime:this.runtime,selectUI:this.selectUI,providerType:this.providerType};if("UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType||"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType)this.valueProvider=new r(k);this.valueProvider.on("predefinedValuePopup_setApplyBtnState",w.hitch(this,function(n){this.popup&&(n?this.popup.enableButton(0):this.popup.disableButton(0))}))},_bindEvent:function(){this.own(m(this.indexBtn,
"click",w.hitch(this,function(){this.valueProvider&&this.destroyProvider();this._initProvider();this.setValueObject(this.valueObjEnd,this.valueObjEnd.type);this.popup=new v({width:800,height:600,content:this.valueProvider,titleLabel:this.indexBtnTips.title,useFocusLogic:!1,onClose:w.hitch(this,function(){this.getValueObject(!1);this._closeCBXPopup();this.destroyProvider()}),buttons:[{label:this.nls.apply,disable:!0,onClick:w.hitch(this,function(){this.getValueObject(!0)?this.popup.close():alert("please configurate some items")})},
{label:this.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:w.hitch(this,function(){this.popup.close()})}]});E.addClass(this.popup.domNode,"widget-at-filter-popup");setTimeout(w.hitch(this,function(){this.valueProvider._setApplyState(this.getValueObject(!0));this.valueProvider._setDisplayTypeStyle()}),100)})))},_closeCBXPopup:function(){this.valueProvider.cbxPopup&&this.valueProvider.cbxPopup.domNode&&(this.valueProvider.cbxPopup.onClose=w.hitch(this,function(){return!0}),this.valueProvider.cbxPopup.close())},
_saveData:function(){this.valueProvider.saveData()},reset:function(){},getDijits:function(){return[]},getStatus:function(){return 1},setValueObject:function(k){k&&(this.valueObjEnd=k);this.valueProvider.setValueObject(k,!0)},valueObj:null,getValueObject:function(k){if(k)return this.valueObjEnd=k=this.valueProvider.getValueObject(),k.value.length;delete this.valueObjEnd.valueList;return 0===this.valueObjEnd.value.length?0:this.valueObjEnd},destroyProvider:function(){this.valueProvider&&this.valueProvider.destroyProvider();
this.valueProvider=null}})})},"jimu/dijit/_filter/PredefinedValuePopup":function(){define("dojo/_base/lang dojo/Deferred dojo/_base/html dojo/_base/array dojo/_base/declare dojo/Evented dojo/query ./ValueProvider ./EditTable ./AdvancedListValueSelect dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./PredefinedValuePopup.html dojo/store/Memory jimu/utils jimu/dijit/Popup jimu/dijit/_filter/pageControlForQuery dojox/form/CheckedMultiSelect".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,
g,b,e,a,f,h){return m([l,d,c,v],{templateString:g,codedValues:null,staticValues:null,showNullValues:!1,cbxPopup:null,pageSize:1E3,pageIndex:1,selectUI:null,postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder;this.emptyStr=window.apiNls.widgets.FeatureTable.empty},postCreate:function(){this.inherited(arguments);this.selectUI=this.selectUI?this.selectUI:"dropdown";A.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");
this.controlType="unique";"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType&&(this.controlType="multiple");this.isNumberField=e.isNumberField(this.fieldInfo.type);this.editTable||(this.editTable=new k({tableType:this.controlType,dataList:[],codedValues:this.codedValues,emptyStr:this.emptyStr,customValue:this.Nls.addValuePlaceHolder,customLabel:this.Nls.addLabelPlaceHolder,isNumberField:this.isNumberField}),this.editTable.placeAt(this.tableContent),this.editTable.on("editTable_openListSelectByName",
E.hitch(this,this._showListSelectByTable)),this.editTable.on("editTable_itemChanged",E.hitch(this,this._editTableItemChanged)),this.editTable.on("editTable_getValLabelsArrayForNumber",E.hitch(this,this._getValLabelsArrayForNumber)));this.supportPaing=!0;this.pageControlForQuery||(this.pageControlForQuery=new f({pageSize:this.pageSize,pageIndex:1,layerUrl:this.url,fieldInfo:this.fieldInfo,queryWhere:"1\x3d1",layerDefinition:this.layerDefinition,fieldPopupInfo:this.fieldPopupInfo,isNumberField:this.isNumberField}));
this.listSelect||(this.listSelect=new n({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],isNumberField:this.isNumberField}),this.listSelect.on("advancedListValueSelect_itemChecked",E.hitch(this,this._createTarget)),this.listSelect.on("advancedListValueSelect_itemUnChecked",E.hitch(this,this._destoryTarget)),this.listSelect.on("advancedListValueSelect_addNextPage",E.hitch(this,this._addNextPage)),this.listSelect.on("advancedListValueSelect_searchKey",
E.hitch(this,this._searchKey)),this.listSelect.on("advancedListValueSelect_searchKeyLocal",E.hitch(this,this._searchKeyLocal)),this.listSelect.on("advancedListValueSelect_itemCheckedForPredefined",E.hitch(this,this._createTargetForPredefined)));this.mutiValuesSelect||(this.mutiValuesSelect=new h({multiple:!0,required:!1,intermediateChanges:!0,style:{width:"100%"}}));this._multipleSelectProviderEventHandler=E.hitch(this,this._multipleSelectProviderEvent);document.addEventListener("click",this._multipleSelectProviderEventHandler);
var p=new b({idProperty:"id",data:[]});this.listSelect.set("store",p)},_multipleSelectProviderEvent:function(p){var B=p.target||p.srcElement,u=A.isDescendant(B,this.editTable.searchBtn);this.editTable&&this.cbxPopup&&this.cbxPopup.domNode?(u?"block"===A.getStyle(this.cbxPopup.domNode,"display")?A.setStyle(this.cbxPopup.domNode,"display","none"):A.setStyle(this.cbxPopup.domNode,"display","block"):A.isDescendant(B,this.cbxPopup.domNode)||this._createTargetForPredefined(),p.stopPropagation()):this._isInSelectPopup(B)||
this.runtime?p.stopPropagation():A.setStyle(this.valuesPopupNode,"display","none")},_initAdvancedListValueSelect:function(){this.pageControlForQuery.pageIndex=1;this.pageControlForQuery.isKeyQueryLoader=!1;this.listSelect=new n({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,isCacheFinish:this.pageControlForQuery._isUniqueValueCacheFinish,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],isNumberField:this.isNumberField});this.listSelect.on("advancedListValueSelect_itemChecked",
E.hitch(this,this._createTarget));this.listSelect.on("advancedListValueSelect_itemUnChecked",E.hitch(this,this._destoryTarget));this.listSelect.on("advancedListValueSelect_addNextPage",E.hitch(this,this._addNextPage));this.listSelect.on("advancedListValueSelect_searchKey",E.hitch(this,this._searchKey));this.listSelect.on("advancedListValueSelect_searchKeyLocal",E.hitch(this,this._searchKeyLocal));this.listSelect.on("advancedListValueSelect_itemCheckedForPredefined",E.hitch(this,this._createTargetForPredefined))},
_isInSelectPopup:function(p){for(var B="dijitCheckBoxInput dojoxMultiSelectItemLabel dojoxMultiSelectItemBox dojoxMultiSelectItem dojoxCheckedMultiSelectWrapper dojoxCheckedMultiSelect value-type-popup popupOper pageItem".split(" "),u=!1,t=0;t<=B.length;t++)if(A.hasClass(p,B[t])){u=!0;break}return u},_createTarget:function(){this.editTable._createTarget("","","","",!0);this._editTableItemChanged()},_createTargetForPredefined:function(p,B){this.editTable._setNewLabel(p,B);this.cbxPopup.close();this._editTableItemChanged()},
_destoryTarget:function(p){this.editTable._destroyTarget(p);this._editTableItemChanged()},_editTableItemChanged:function(){if(!this.runtime){var p=this.getValueObject();this._setApplyState(p.value.length)}},_setApplyState:function(p){this.emit("predefinedValuePopup_setApplyBtnState",p)},_cbxWidth:245,_cbxHeight:340,isPopupLoading:!1,_showListSelectByTable:function(p){if(!this.isPopupLoading){this._initAdvancedListValueSelect();this.valueList=[p];this.getCheckedList(this.valueList);p=A.position(this.editTable.searchBtn);
var B=p.x-226,u=p.y+30;window.isRTL&&(B=p.x);this.cbxPopup=new a({width:this._cbxWidth,height:this._cbxHeight,content:this.listSelect.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:B,top:u},useFocusLogic:!1,buttons:[]});this.cbxPopup.setDomNodeStyls({"border-radius":0,border:"1px solid #999"});this.cbxPopup.on("popupHasInitedSuccessfully",E.hitch(this,function(){var t=A.position(this.editTable.searchBtn),z=t.x-226,x=t.y+30;window.isRTL&&
(z=t.x);this.cbxPopup.setCustomPosition(z,x)}));this.listSelect.valueInput&&this.listSelect.valueInput.focus();this._showLoadingIcon();this.isPopupLoading=!0;this._valueLabels().then(E.hitch(this,function(t){this.isPopupLoading=!1;this._hideLoadingIcon();if(!0!==t){var z=!1;this.valueList&&0!==this.valueList.length&&(z=!0);this.listSelect.setCBXData(t,z)}}))}},_valueLabels:function(){var p=new q;this.listSelect.codedValues=!1;this.listSelect.disPlayLabel="label";if(this.staticValues)return this._setValueForStaticValues(this.staticValues),
p.resolve(!0),p;if(this.codedValues)if(this.filterCodedValue)this.listSelect.codedValues=!0;else return this._setValueForStaticValues(this.codedValues),p.resolve(!0),p;this.pageControlForQuery.queryByPage(!0).then(E.hitch(this,function(B){p.resolve(B)}),E.hitch(this,function(B){console.log(B);this._hideLoadingIcon();p.reject(B)}));return p},_setValueForStaticValues:function(p){this.listSelect.codedValues=!0;p&&(this.pageControlForQuery._codedvalueCache=p,p=0<p.length?p:[],this.listSelect.setCBXData(p,
!0,!0))},_changeDisplayType:function(p){p=p.target||p.srcElement;p=A.hasClass(p,"option")?p:e.getAncestorDom(p,function(B){return A.hasClass(B,"option")},2);A.hasClass(p,"checked")||(A.addClass(p,"checked"),p=r("."+this.selectUI+"Option ",this.displayTypes)[0],A.removeClass(p,"checked"),this.selectUI="expanded"===this.selectUI?"dropdown":"expanded")},_setDisplayTypeStyle:function(){var p=r(".title",this.displayTypes)[0],B=r(".label",this.displayTypes);p=(A.getStyle(this.displayTypes,"width")-A.getStyle(p,
"width")-80)/2;var u=A.getStyle(B[0],"width");u=u<p?u:p;var t=A.getStyle(B[1],"width");t=t<p?t:p;A.setStyle(B[0],"width",u+"px");A.setStyle(B[1],"width",t+"px")},_addNextPage:function(){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage).then(E.hitch(this,function(p){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;this.listSelect.setCBXData(p,!0);this._hideLoadingIcon()}),E.hitch(this,function(p){console.log(p);
this._hideLoadingIcon()})))},_searchKey:function(p){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery._searchKey(p).then(E.hitch(this,function(B){this.listSelect.setCBXContentBySearch(B);this._hideLoadingIcon()}),E.hitch(this,function(B){console.log(B);this._hideLoadingIcon()})))},_searchKeyLocal:function(p){this.listSelect&&(this._showLoadingIcon(),p=this.pageControlForQuery._searchKeyLocal(p),this.listSelect.setCBXContentBySearch(p),this._hideLoadingIcon())},_handlerPageValues:function(){},
getCheckedList:function(p){this.listSelect.checkedList=[];this.isNumberField?w.forEach(p,E.hitch(this,function(B){this.listSelect.checkedList.push(parseFloat(B))})):this.listSelect.checkedList=p},_showPopup:function(){var p=this.getValueObject().valueList;this.valueList=null===p?void 0:p;this.getCheckedList(this.valueList);this.cbxPopup?(this.listSelect.checkCBXItems(!1),this.cbxPopup.show()):(this.cbxPopup=new a({width:355,height:596,content:this.listSelect.domNode,titleLabel:this.layerDefinition.name+
"("+this.fieldName+")",isResize:!1,useFocusLogic:!1,onClose:E.hitch(this,function(){this.cbxPopup.hide();return!1}),buttons:[]}),this._showLoadingIcon(),this.pageControlForQuery.queryByPage().then(E.hitch(this,function(B){this._hideLoadingIcon();var u=!1;this.valueList&&0!==this.valueList.length&&(u=!0);this.listSelect.setCBXData(B,u)})))},getDijits:function(){return[this.mutiValuesSelect]},setValueObject:function(p){p.value=p.value?p.value:[];var B=r("."+(p.selectUI?p.selectUI:this.selectUI)+"Option ",
this.displayTypes)[0];A.addClass(B,"checked");B=null;if(this.isNumberField){B=[];for(var u=0;u<p.value.length;u++)B.push(p.value[u].value);B=this._getValLabelsArrayForNumber(!1,B)}this.editTable.emptyLabel=p.emptyLabel;this.editTable.enableEmpty=p.enableEmpty;this.editTable.setListValues(p.value,B)},_getValLabelsArrayForNumber:function(p,B){B=e._getValues(this.layerDefinition,this.fieldPopupInfo,this.fieldName,B);p&&(this.editTable.currentValLabel=B[0].label);return B},tryGetValueObject:function(){return this.isValidValue()?
this.getValueObject():this.isEmptyValue()?{isValid:!0,selectUI:this.selectUI,type:this.partObj.valueObj.type,value:[],valueList:[]}:null},getValueObject:function(){if(this.isValidValue()){var p=this.editTable.getListValues(),B={isValid:!0,selectUI:this.selectUI,type:this.partObj.valueObj.type,value:p.list,valueList:p.valueList};"unique"===this.controlType&&(B.emptyLabel=p.emptyLabel,B.enableEmpty=p.enableEmpty);return B}return null},setRequired:function(p){this.mutiValuesSelect.set("required",p)},
queryByPage:function(){var p=this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage);p.then(E.hitch(this,function(B){p.resolve(B)}),E.hitch(this,function(B){console.log(B);p.reject(B)}))},_showLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&A.addClass(this.listSelect.listContainer,"jimu-circle-loading")},_hideLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&A.removeClass(this.listSelect.listContainer,"jimu-circle-loading")},destroy:function(){this._multipleSelectProviderEventHandler&&
document.removeEventListener("click",this._multipleSelectProviderEventHandler);this.inherited(arguments)},destroyProvider:function(){this.editTable&&this.editTable.destroy();this.listSelect&&this.listSelect.destroy();this.listSelect=null;this.destroy();A.destroy(this.domNode)}})})},"jimu/dijit/_filter/EditTable":function(){define("dojo/_base/lang dojo/_base/html dojo/Evented dojo/on dojo/keys dojo/dom-attr dojo/_base/declare dijit/_WidgetBase dojo/query dijit/form/ValidationTextBox dijit/form/NumberTextBox dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./EditTable.html jimu/utils".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e){return r([l,c,g,A],{templateString:b,currentItem:null,dataList:[],codedValues:null,isNumberField:!0,tableType:"unique",postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");"unique"===this.tableType?(this.inputType="radio",q.addClass(this.listContent,"radio-items-list-content")):
this.inputType="checkbox"},_onListContentDblClicked:function(a){this.isSearch=!1;var f=a.target||a.srcElement,h=e.getAncestorDom(f,function(B){return q.hasClass(B,"item")},3);if(h&&(q.hasClass(f,"name")||q.hasClass(f,"alias"))&&(!q.hasClass(h,"empty")||!q.hasClass(f,"name"))){this._dijit?(this.editState="active",this.updateInputDivPre=this.updateInputDiv,this._dijitPre=this._dijit):this.editState="negative";a=this._getNodeText(f);var p=decodeURIComponent(q.getAttr(f,"data"));h=q.hasClass(h,"custom");
this.placeHolder=q.hasClass(f,"name")&&!this.codedValues?p:a;h?q.hasClass(f,"alias")&&this.placeHolder!==this.customLabel?this.currentLabel=a:this.currentLabel=NaN:this.currentLabel=this.isNumberField&&q.hasClass(f,"name")&&!this.codedValues?parseFloat(this.placeHolder):this.placeHolder;v.set(f,"innerHTML","");a="";q.hasClass(f,"name")&&(a='\x3cdiv class\x3d"searchBtn"\x3e\x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8"\x3e\x3c/div\x3e\x3c/div\x3e');this.updateInputDiv=q.create("div",{"class":"updateInputDiv",
innerHTML:'\x3cdiv class\x3d"inputDiv"\x3e\x3c/div\x3e'+a},f);a=k(".inputDiv",this.updateInputDiv)[0];this.searchBtn=k(".searchBtn",this.updateInputDiv)[0];this.own(w(this.updateInputDiv,"dblclick",E.hitch(this,function(B){B.stopPropagation();B.preventDefault()})));p={required:!1,intermediateChanges:!1,value:this.currentLabel};this.codedValues&&q.hasClass(f,"name")&&(p.disabled=!0);this.isNumberField&&q.hasClass(f,"name")?(p.constraints={pattern:"#####0.##########"},this._dijit=new d(p)):(p.trim=
!0,this._dijit=new n(p));this._dijit.startup();this._dijit.on("keydown",function(B){(B.keyCode||B.which)===m.ENTER&&this._dijit.emit("blur")}.bind(this));this._dijit.on("blur",E.hitch(this,function(){if(this._dijit){var B="Error"!==this._dijit.state?this._dijit.displayedValue:this.currentLabel;this.isNumberField&&q.hasClass(f,"name")&&"Error"===this._dijit.state&&this._dijit.setValue(parseFloat(B));B=e.sanitizeHTML(B);var u=this._dijit.get("value");""!==u&&u?q.hasClass(f,"name")&&(this.placeHolder===
this.customValue||"NaN"===this.placeHolder&&""!==this._dijit.displayedValue)&&(u=e.getAncestorDom(this._dijit.domNode,function(t){return q.hasClass(t,"item")},4),q.removeClass(u,"custom"),this.emit("editTable_itemChanged")):B=this.placeHolder;this.newLabel=B;setTimeout(E.hitch(this,function(){if(this.isSearch||"active"===this.editState)"active"===this.editState&&(t=this.updateInputDivPre.parentNode,z=decodeURIComponent(q.getAttr(t,"data")),q.hasClass(t,"name")?this.currentValLabel=""===this._dijitPre.displayedValue?
z===this.customValue?this.customValue:this.isNumberField?this._getLocalNumber(z):z:this.isNumberField?this._getLocalNumber(this._dijitPre.value):this._dijitPre.value:this.currentValLabel=""===this._dijitPre.displayedValue?z===this.customLabel?this.customLabel:z:this._dijitPre.displayedValue,!q.hasClass(t,"name")||"NaN"===this.newLabel||this.newLabel===this.customValue||this._getNodeText(t.nextSibling)!==this.customLabel&&this._dijit.value!==this.customLabel||(q.isDescendant(this.updateInputDiv,t.nextSibling)?
this._dijit.set("value",this.currentValLabel):(x=this.isNumberField?this.currentValLabel:this.newLabel,q.setAttr(t.nextSibling,"data",encodeURIComponent(x)),this._setNodeText(t.nextSibling,x),q.setAttr(t.nextSibling,"title",x))),x=q.hasClass(t,"name")?""===this._dijitPre.displayedValue?z===this.customValue?this.customValue:z:this._dijitPre.value:this.newLabel,q.setAttr(t,"data",encodeURIComponent(x)),x=q.hasClass(t,"name")?this.currentValLabel:this.newLabel,this._setNodeText(t,x),q.setAttr(t,"title",
x),this._dijitPre=this.updateInputDivPre=null,this.editState="negative");else{var t=this.updateInputDiv.parentNode;var z=decodeURIComponent(q.getAttr(t,"data"));q.hasClass(t,"name")?this.currentValLabel=""===this._dijit.displayedValue?z===this.customValue?this.customValue:this.isNumberField?this._getLocalNumber(z):z:this.isNumberField?this._getLocalNumber(this._dijit.value):this._dijit.value:this.currentValLabel=""===this._dijit.displayedValue?z===this.customLabel?this.customLabel:z:this._dijit.displayedValue;
if(q.hasClass(t,"name")&&"NaN"!==this.newLabel&&this.newLabel!==this.customValue&&this._getNodeText(t.nextSibling)===this.customLabel){var x=this.isNumberField?this.currentValLabel:this.newLabel;q.setAttr(t.nextSibling,"data",encodeURIComponent(x));this._setNodeText(t.nextSibling,x);q.setAttr(t.nextSibling,"title",x)}x=q.hasClass(t,"name")?""===this._dijit.displayedValue?z===this.customValue?this.customValue:z:this._dijit.value:this.newLabel;q.setAttr(t,"data",encodeURIComponent(x));x=q.hasClass(t,
"name")?this.currentValLabel:this.newLabel;this._setNodeText(t,x);q.setAttr(t,"title",x);this._dijit=null;this.isSearch=!1}}),300);this.placeHolder=""}}));q.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(a);k("input",this._dijit.domNode)[1].focus();this.searchBtn&&(this.own(w(this.searchBtn,"click",E.hitch(this,function(B){this.isSearch||(this.isSearch=!0,this.searchTarget=B.target||B.srcElement,this.emit("editTable_openListSelectByName",this.newLabel),B.stopPropagation(),B.preventDefault())}))),
this.codedValues&&this.searchBtn.click())}},_getLocalNumber:function(a){"string"===typeof a&&(a=parseFloat(a));this.emit("editTable_getValLabelsArrayForNumber",!0,[a]);return this.currentValLabel},_setNewLabel:function(a,f){if(void 0===a&&void 0===f)if(""!==this._dijit.displayedValue)this.codedValues?(f=this._dijit.displayedValue,a=this._getCodeFromCodevalueLabel(f)):(f=a=this._dijit.value,this.isNumberField&&this.newLabel!==this.customValue&&(f=this._getLocalNumber(a)));else if(a=f=this.customValue,
this.updateInputDiv&&this.updateInputDiv.parentNode){var h=this.updateInputDiv.parentNode;h=decodeURIComponent(q.getAttr(h,"data"));h!==this.customValue&&(a=this.isNumberField?parseFloat(h):h,f=this.codedValues?this._getLabelFromCodevalue(a):this.isNumberField?this._getLocalNumber(a):a)}this.updateInputDiv&&this.updateInputDiv.parentNode&&(h=this.updateInputDiv.parentNode,f!==this.customValue&&this._getNodeText(h.nextSibling)===this.customLabel&&(q.setAttr(h.nextSibling,"data",encodeURIComponent(f)),
this._setNodeText(h.nextSibling,f),q.setAttr(h.nextSibling,"title",f)),this.codedValues||(a=a?a:decodeURIComponent(q.getAttr(h,"data"))),q.setAttr(h,"data",encodeURIComponent(a)),a=h.parentNode,f!==this.customValue&&q.removeClass(a,"custom"),this._setNodeText(h,f),q.setAttr(h,"title",f));this._dijit=this.updateInputDiv=null},_onListContentClicked:function(a){a=a.target||a.srcElement;var f=e.getAncestorDom(a,function(h){return q.hasClass(h,"item")},3);f&&(q.hasClass(a,"checkboxEmpty")?q.hasClass(a,
"checked")?q.removeClass(a,"checked"):q.addClass(a,"checked"):q.hasClass(a,this.inputType)?("radio"===this.inputType&&!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),q.hasClass(a,"checked")?"radio"!==this.inputType?q.removeClass(a,"checked"):q.hasClass(this.currentItem,"checked")||q.removeClass(a,"checked"):("radio"===this.inputType&&this.currentItem&&q.removeClass(this.currentItem,"checked"),q.addClass(a,"checked"),this.currentItem=a)):q.hasClass(a,"action")&&(q.hasClass(a,"up")?
f.previousElementSibling&&q.place(f,f.previousElementSibling,"before"):q.hasClass(a,"down")?f.nextElementSibling&&q.place(f,f.nextElementSibling,"after"):q.hasClass(a,"delete")&&(q.destroy(f),this.emit("editTable_itemChanged"))))},_getLabelFromCodevalue:function(a){for(var f=a,h=0;h<this.codedValues.length;h++){var p=this.codedValues[h];if(p.value===a){f=p.label;break}}return f},_getCodeFromCodevalueLabel:function(a){for(var f=a,h=0;h<this.codedValues.length;h++){var p=this.codedValues[h];if(p.label===
a){f=p.value;break}}return f},_createEmptyTarget:function(a){for(var f=this.emptyStr,h=this.emptyLabel?this.emptyLabel:f,p=" checked",B=0;B<a.length;B++)if(a[B].isChecked){p="";break}" checked"===p&&(this.currentItem=!0);B='data\x3d"'+encodeURIComponent(f)+'"';var u="",t=this.Nls.emptyValueTips;if(0===a.length||this.enableEmpty)u=" checked";return q.create("div",{"class":"item empty",innerHTML:'\x3cdiv class\x3d"label name jimu-ellipsis" style\x3d"cursor: default;"'+B+"\x3e"+f+'\x3c/div\x3e\x3cdiv class\x3d"label alias jimu-ellipsis-Blanks" data\x3d"'+
h+'"\x3e'+h+'\x3c/div\x3e\x3cdiv class\x3d"label '+this.inputType+p+' jimu-ellipsis"\x3e\x3c/div\x3e\x3cdiv class\x3d"label checkbox checkboxEmpty'+u+' jimu-ellipsis jimu-flipx" title\x3d"'+t+'"\x3e\x3c/div\x3e'},this.listContent)},_createTarget:function(a,f,h,p,B){var u="item";B&&(a=f=this.customValue,h=this.customLabel,u="item custom");a=a||0===a?a:"";f=f||"";h=h?h:a;p=p?p:"";var t=a;(this.codedValues||this.isNumberField)&&a!==this.Nls.addValuePlaceHolder&&(t=this.codedValues?this._getLabelFromCodevalue(a):
f);f=this.isNumberField?a:encodeURIComponent(a);p=q.create("div",{"class":u,innerHTML:'\x3cdiv class\x3d"label name jimu-ellipsis-Blanks" data\x3d"'+(f+'"\x3e')+t+'\x3c/div\x3e\x3cdiv class\x3d"label alias jimu-ellipsis-Blanks" data\x3d"'+h+'"\x3e'+h+'\x3c/div\x3e\x3cdiv class\x3d"label '+this.inputType+p+' jimu-ellipsis"\x3e\x3c/div\x3e\x3cdiv class\x3d"actions jimu-float-trailing"\x3e\x3cdiv class\x3d"delete action jimu-float-trailing"\x3e\x3c/div\x3e\x3cdiv class\x3d"down action jimu-float-trailing"\x3e\x3c/div\x3e\x3cdiv class\x3d"up action jimu-float-trailing"\x3e\x3c/div\x3e\x3c/div\x3e'},
this.listContent);B&&(B=k(".name",p)[0],q.setAttr(B,"title",a),q.setAttr(B.nextSibling,"title",h));return p},_destroyTarget:function(a){for(var f=k(".item .name",this.listContent),h=0;h<f.length;h++){var p=f[h];if(v.get(this._dijit.domNode.parentNode,"innerHTML")===a){q.destroy(p.parentNode);break}}},getCurrentItem:function(){for(var a=k(".item .radio",this.listContent),f=0;f<a.length;f++){var h=a[f];if(q.hasClass(h,"checked"))return h}return null},_getEmptyLabel:function(){var a=k(".label.alias",
this.listContent.firstChild)[0],f=this._getNodeText(a);a.children.length&&(f="Error"===this._dijit.state?decodeURIComponent(q.getAttr(a,"data")):this._dijit.value);return f=e.sanitizeHTML(f)},_getEmptyStatus:function(){var a=k(".checkboxEmpty",this.listContent.firstChild)[0];return q.hasClass(a,"checked")?!0:!1},_getNodeText:function(a){return a.textContent||a.innerText||""},_setNodeText:function(a,f){a.innerHTML="\x26nbsp;";a.textContent?a.textContent=f:a.innerText=f},getListValues:function(){this.listItemsArray=
[];this.listValuesArray=[];for(var a=k(".item .name",this.listContent),f="radio"===this.inputType?1:0;f<a.length;f++){var h=a[f],p=e.getAncestorDom(h,function(u){return q.hasClass(u,"item")},3);if(!q.hasClass(p,"custom")){p=this._getNodeText(h);var B=decodeURIComponent(q.getAttr(h,"data"));if(this.isNumberField||this.codedValues)p=B;h.children.length&&(p="Error"===this._dijit.state?B:this._dijit.value,this.codedValues&&(p=this._getCodeFromCodevalueLabel(p),p=void 0!==p?p:B));p=this.isNumberField?
parseFloat(p):e.sanitizeHTML(p);B=this._getNodeText(h.nextSibling);B===this.customLabel&&(B=p.toString(),this.isNumberField&&(B=this._getLocalNumber(B)));h.nextSibling.children.length&&(B="Error"===this._dijit.state?decodeURIComponent(q.getAttr(h.nextSibling,"data")):this._dijit.value);B=e.sanitizeHTML(B);B={value:p,alias:B,isChecked:!1};this.listItemsArray.push(B);this.listValuesArray.push(p);q.hasClass(h.nextSibling.nextSibling,"checked")&&(B.isChecked=!0)}}a={list:this.listItemsArray,valueList:this.listValuesArray};
"radio"===this.inputType&&(a.emptyLabel=this._getEmptyLabel(),a.enableEmpty=this._getEmptyStatus());return a},setListValues:function(a,f){v.set(this.listContent,"innerHTML","");"radio"===this.inputType&&this._createEmptyTarget(a);for(var h=0;h<a.length;h++){var p=a[h],B="";p.isChecked&&(B=" checked",this.currentItem=!0);this._createTarget(p.value,f?f[h].label:p.value,p.alias,B)}a=k(".name",this.listContent);for(f=0;f<a.length;f++)h=a[f],q.setAttr(h,"title",this._getNodeText(h)),h=h.nextSibling,q.setAttr(h,
"title",this._getNodeText(h))},_initTable:function(){},getDijits:function(){return[this.mutiValuesSelect]},destroy:function(){this.inherited(arguments)}})})},"dojox/form/CheckedMultiSelect":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/event dojo/dom-geometry dojo/dom-class dojo/dom-construct dojo/i18n dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/registry dijit/Menu dijit/MenuItem dijit/Tooltip dijit/form/_FormSelectWidget dijit/form/ComboButton dojo/text!dojox/form/resources/_CheckedMultiSelectMenuItem.html dojo/text!dojox/form/resources/_CheckedMultiSelectItem.html dojo/text!dojox/form/resources/CheckedMultiSelect.html dojo/i18n!dojox/form/nls/CheckedMultiSelect dijit/form/CheckBox".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u){var t=E("dojox.form._CheckedMultiSelectItem",[k,n,d],{templateString:p,baseClass:"dojoxMultiSelectItem",option:null,parent:null,disabled:!1,readOnly:!1,postMixInProperties:function(){this._type=this.parent.multiple?{type:"checkbox",baseClass:"dijitCheckBox"}:{type:"radio",baseClass:"dijitRadio"};this.disabled||(this.disabled=this.option.disabled=this.option.disabled||!1);this.readOnly||(this.readOnly=this.option.readOnly=this.option.readOnly||!1);
this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.labelNode.innerHTML=this.option.label},_changeBox:function(){this.get("disabled")||this.get("readOnly")||(this.parent.multiple?this.option.selected=this.checkBox.get("value")&&!0:this.parent.set("value",this.option.value),this.parent._updateSelection(),this.parent.focus())},_onClick:function(y){this.get("disabled")||this.get("readOnly")?w.stop(y):this.checkBox._onClick(y)},_updateBox:function(){this.checkBox.set("value",
this.option.selected)},_setDisabledAttr:function(y){this.disabled=y||this.option.disabled;this.checkBox.set("disabled",this.disabled);v.toggle(this.domNode,"dojoxMultiSelectDisabled",this.disabled)},_setReadOnlyAttr:function(y){this.checkBox.set("readOnly",y);this.readOnly=y}}),z=E("dojox.form._CheckedMultiSelectMenu",g,{multiple:!1,buildRendering:function(){this.inherited(arguments);var y=this.menuTableNode=this.domNode,D=this.domNode=r.create("div",{style:{overflowX:"hidden",overflowY:"scroll"}});
y.parentNode&&y.parentNode.replaceChild(D,y);v.remove(y,"dijitMenuTable");D.className=y.className+" dojoxCheckedMultiSelectMenu";y.className="dijitReset dijitMenuTable";y.setAttribute("role","listbox");D.setAttribute("role","presentation");D.appendChild(y)},resize:function(y){y&&(m.setMarginBox(this.domNode,y),"w"in y&&(this.menuTableNode.style.width="100%"))},onClose:function(){this.inherited(arguments);this.menuTableNode&&(this.menuTableNode.style.width="")},onItemClick:function(y,D){"undefined"==
typeof this.isShowingNow&&this._markActive();this.focusChild(y);if(y.disabled||y.readOnly)return!1;if(!this.multiple)this.onExecute();y.onClick(D)}}),x=E("dojox.form._CheckedMultiSelectMenuItem",b,{templateString:h,option:null,parent:null,iconClass:"",postMixInProperties:function(){this.parent.multiple?(this._iconClass="dojoxCheckedMultiSelectMenuCheckBoxItemIcon",this._type={type:"checkbox"}):(this._iconClass="",this._type={type:"hidden"});this.disabled=this.option.disabled;this.checked=this.option.selected;
this.label=this.option.label;this.readOnly=this.option.readOnly;this.inherited(arguments)},onChange:function(y){},_updateBox:function(){v.toggle(this.domNode,"dojoxCheckedMultiSelectMenuItemChecked",!!this.option.selected);this.domNode.setAttribute("aria-checked",this.option.selected);this.inputNode.checked=this.option.selected;this.parent.multiple||v.toggle(this.domNode,"dijitSelectSelectedOption",!!this.option.selected)},_onClick:function(y){this.disabled||this.readOnly||(this.parent.multiple?(this.option.selected=
!this.option.selected,this.parent.onChange(),this.onChange(this.option.selected)):this.option.selected||(A.forEach(this.parent.getChildren(),function(D){D.option.selected=!1}),this.option.selected=!0,this.parent.onChange(),this.onChange(this.option.selected)));this.inherited(arguments)}});return E("dojox.form.CheckedMultiSelect",a,{templateString:B,baseClass:"dojoxCheckedMultiSelect",required:!1,invalidMessage:"$_unset_$",_message:"",dropDown:!1,labelText:"",tooltipPosition:[],postMixInProperties:function(){this.inherited(arguments);
this._nlsResources=l.getLocalization("dojox.form","CheckedMultiSelect",this.lang);"$_unset_$"==this.invalidMessage&&(this.invalidMessage=this._nlsResources.invalidMessage)},_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var y=this.srcNodeRef.selectedIndex||0;this.value=this.options[0<=y?y:0].value}this.dropDown&&(v.toggle(this.selectNode,"dojoxCheckedMultiSelectHidden"),this.dropDownMenu=new z({id:this.id+"_menu",style:"display: none;",multiple:this.multiple,
onChange:q.hitch(this,"_updateSelection")}))},startup:function(){this.dropDown&&(this.dropDownButton=new f({label:this.labelText,dropDown:this.dropDownMenu,baseClass:"dojoxCheckedMultiSelectButton",maxHeight:this.maxHeight},this.comboButtonNode));this.inherited(arguments)},_onMouseDown:function(y){y.preventDefault()},validator:function(){return this.required?A.some(this.getOptions(),function(y){return y.selected&&null!=y.value&&0!=y.value.toString().length}):!0},validate:function(y){e.hide(this.domNode);
(y=this.isValid(y))||this.displayMessage(this.invalidMessage);return y},isValid:function(y){return this.validator()},getErrorMessage:function(y){return this.invalidMessage},displayMessage:function(y){e.hide(this.domNode);y&&e.show(y,this.domNode,this.tooltipPosition)},onAfterAddOptionItem:function(y,D){},_addOptionItem:function(y){if(this.dropDown){var D=new x({option:y,parent:this.dropDownMenu});this.dropDownMenu.addChild(D)}else D=new t({option:y,parent:this,disabled:this.disabled,readOnly:this.readOnly}),
this.wrapperDiv.appendChild(D.domNode);this.onAfterAddOptionItem(D,y)},_refreshState:function(){this.validate(this.focused)},onChange:function(y){this._refreshState()},reset:function(){this.inherited(arguments);e.hide(this.domNode)},_updateSelection:function(){this.inherited(arguments);this._handleOnChange(this.value);A.forEach(this._getChildren(),function(I){I._updateBox()});r.empty(this.containerNode);var y=this;A.forEach(this.value,function(I){I=r.create("option",{value:I,label:I,selected:"selected"});
r.place(I,y.containerNode)});if(this.dropDown&&this.dropDownButton){var D=0,H="";A.forEach(this.options,function(I){I.selected&&(D++,H=I.label)});this.dropDownButton.set("label",this.multiple?q.replace(this._nlsResources.multiSelectLabelText,{num:D}):H)}},_getChildren:function(){return this.dropDown?this.dropDownMenu.getChildren():A.map(this.wrapperDiv.childNodes,function(y){return c.byNode(y)})},invertSelection:function(y){this.multiple&&(A.forEach(this.options,function(D){D.selected=!D.selected}),
this._updateSelection())},_setDisabledAttr:function(y){this.inherited(arguments);this.dropDown&&this.dropDownButton.set("disabled",y);A.forEach(this._getChildren(),function(D){D&&D.set&&D.set("disabled",y)})},_setReadOnlyAttr:function(y){this.inherited(arguments);"readOnly"in this.attributeMap&&this[this.attributeMap.readOnly].setAttribute("readonly",y);this.readOnly=y;A.forEach(this._getChildren(),function(D){D&&D.set&&D.set("readOnly",y)})},uninitialize:function(){e.hide(this.domNode);A.forEach(this._getChildren(),
function(y){y.destroyRecursive()});this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a){d("dijit-legacy-requires")&&a(0,function(){E(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return A("dijit.Menu",
e,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):q.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(f){return g.get(this._iframeContentDocument(f))||this._iframeContentDocument(f).__parent__||f.name&&document.frames[f.name]||null},_iframeContentDocument:function(f){return f.contentDocument||
f.contentWindow&&f.contentWindow.document||f.name&&document.frames[f.name]&&document.frames[f.name].document||null},bindDomNode:function(f){f=w.byId(f,this.ownerDocument);if("iframe"==f.tagName.toLowerCase()){var h=f;var p=this._iframeContentWindow(h);p=c.body(p.document)}else p=f==c.body(this.ownerDocument)?this.ownerDocument.documentElement:f;var B={node:f,iframe:h};m.set(f,"_dijitMenu"+this.id,this._bindings.push(B));var u=k.hitch(this,function(t){var z=this.selector,x=z?function(D){return n.selector(z,
D)}:function(D){return D},y=this;return[n(t,x(this.leftClickToOpen?"click":"contextmenu"),function(D){D.stopPropagation();D.preventDefault();(new Date).getTime()<y._lastKeyDown+500||y._scheduleOpen(this,h,{x:D.pageX,y:D.pageY},D.target)}),n(t,x("keydown"),function(D){if(93==D.keyCode||D.shiftKey&&D.keyCode==l.F10||y.leftClickToOpen&&D.keyCode==l.SPACE)D.stopPropagation(),D.preventDefault(),y._scheduleOpen(this,h,null,D.target),y._lastKeyDown=(new Date).getTime()})]});B.connects=p?u(p):[];h&&(B.onloadHandler=
k.hitch(this,function(){var t=this._iframeContentWindow(h);t=c.body(t.document);B.connects=u(t)}),h.addEventListener?h.addEventListener("load",B.onloadHandler,!1):h.attachEvent("onload",B.onloadHandler))},unBindDomNode:function(f){try{var h=w.byId(f,this.ownerDocument)}catch(t){return}f="_dijitMenu"+this.id;if(h&&m.has(h,f)){for(var p=m.get(h,f)-1,B=this._bindings[p],u;u=B.connects.pop();)u.remove();(u=B.iframe)&&(u.removeEventListener?u.removeEventListener("load",B.onloadHandler,!1):u.detachEvent("onload",
B.onloadHandler));m.remove(h,f);delete this._bindings[p]}},_scheduleOpen:function(f,h,p,B){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:B,delegatedTarget:f,iframe:h,coords:p})},1))},_openMyself:function(f){function h(){D.refocus&&H&&H.focus();b.close(D)}var p=f.target,B=f.iframe,u=f.coords,t=!u;this.currentTarget=f.delegatedTarget;if(u){if(B){f=v.position(B,!0);p=this._iframeContentWindow(B);p=v.docScroll(p.document);var z=r.getComputedStyle(B),
x=r.toPixelValue,y=(d("ie")&&d("quirks")?0:x(B,z.paddingLeft))+(d("ie")&&d("quirks")?x(B,z.borderLeftWidth):0);B=(d("ie")&&d("quirks")?0:x(B,z.paddingTop))+(d("ie")&&d("quirks")?x(B,z.borderTopWidth):0);u.x+=f.x+y-p.x;u.y+=f.y+B-p.y}}else u=v.position(p,!0),u.x+=10,u.y+=10;var D=this;B=this._focusManager.get("prevNode");f=this._focusManager.get("curNode");var H=!f||w.isDescendant(f,this.domNode)?B:f;b.open({popup:this,x:u.x,y:u.y,onExecute:h,onCancel:h,orient:this.isLeftToRight()?"L":"R"});this.focus();
t||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);b.close(this)}},destroy:function(){q.forEach(this._bindings,function(f){f&&this.unBindDomNode(f.node)},this);this.inherited(arguments)}})})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(E,q,A,w,m,v,r,l,k){w("dijit-legacy-requires")&&
v(0,function(){E(["dijit/form/RadioButton"])});return q("dijit.form.CheckBox",[r,l],{templateString:k,baseClass:"dijitCheckBox",_setValueAttr:function(n,d){"string"==typeof n&&(this.inherited(arguments),n=!0);this._created&&this.set("checked",n,d)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&
m("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&m("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(E,q){return E("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(A){this._set("readOnly",A);q.set(this.focusNode,"readOnly",
A)},_setLabelAttr:void 0,_getSubmitValue:function(A){return null==A||""===A?"on":A},_setValueAttr:function(A){A=this._getSubmitValue(A);this._set("value",A);q.set(this.focusNode,"value",A)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));q.set(this.focusNode,"value",this.value)},_onClick:function(A){return this.readOnly?(A.stopPropagation(),A.preventDefault(),!1):this.inherited(arguments)}})})},"jimu/dijit/_filter/NumberListValueProvider":function(){define("dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./NumberListValueProvider.html dijit/form/NumberTextBox dijit/form/Select".split(" "),
function(E,q,A,w,m,v,r,l){return w([m,v,r],{templateString:l,postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-number-list-filter-value-provider");this.rangeSelect.removeOption(this.rangeSelect.getOptions());A.forEach("dateOperatorMinutes dateOperatorHours dateOperatorDays dateOperatorWeeks dateOperatorMonths dateOperatorYears".split(" "),E.hitch(this,function(k){this.rangeSelect.addOption({value:k,label:this.nls[k]})}));this.rangeSelect.set("value","dateOperatorDays")},
getDijits:function(){return[this._dijit1,this.rangeSelect]},setValueObject:function(k){this.isDefined(k.value)&&this._dijit1.set("value",k.value);this.isDefined(k.range)&&this.rangeSelect.set("value",k.range)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()}:null},_getRangeByUI:function(){var k=this.rangeSelect.get("value");"none"===k&&(k=null);return k},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();
if(this.isEmptyValue()){var k={isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()};isNaN(k.value)&&(k.value=null);return k}return null},setRequired:function(k){this._dijit1.set("required",k);this.rangeSelect.set("required",k)}})})},"jimu/dijit/_filter/DateIsInValueProvider":function(){define("dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/text!./DateIsInValueProvider.html ./ValueProvider jimu/filterUtils jimu/utils dijit/form/Select dijit/form/DateTextBox".split(" "),
function(E,q,A,w,m,v,r,l,k){return w([r,m,E],{templateString:v,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},virtualDates:null,postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-date-is-in-value-provider");this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});return["thisWeek","thisMonth","thisQuarter","thisYear"].forEach(A.hitch(this,function(n){this.dateTypeSelect.addOption({value:n,label:this.nls[n]})}))},getDijits:function(){return[this.dateTypeSelect]},
_setValueObject:function(n,d,c,g){if(this.isDefined(d[c])){var b={value:null,virtualDate:""};b.value=d[c];b.virtualDate=d[g];n.setValueObject(b)}},setValueObject:function(n){this.dateTypeSelect.set("value",n.virtualDate)},getValueObject:function(){return this.isValidValue()?this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var n={isValid:!0,type:this.partObj.valueObj.type,value:null,virtualDate:this.dateTypeSelect.get("value")},d=this.dateTypeSelect.get("value"),
c=l.getRealDateByVirtualDate(d);n.virtualDate=d;c&&(n.value1=k.getDateTimeStr(c[0]),n.value2=k.getDateTimeStr(c[1]));return n},setRequired:function(n){this.dateTypeSelect.set("required",n)},getStatus:function(){return this.dateTypeSelect.get("value")?1:0},_onDateTypeSelectChanged:function(){this.emit("change")}})})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(E,q,A){return E("dijit.form.DateTextBox",A,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",
popupClass:q,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"jimu/dijit/_SingleFilter":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilter.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/keys dijit/a11yclick dijit/focus dojo/query dojo/store/Memory jimu/utils jimu/filterUtils dijit/Tooltip dojo/mouse jimu/dijit/_filter/ValueProviderFactory dijit/popup jimu/dijit/CheckBox dijit/form/Select dijit/form/FilteringSelect dijit/form/ValidationTextBox".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f,h,p,B,u){return q([A,w,m,E],{templateString:v,baseClass:"jimu-single-filter",declaredClass:"jimu.dijit._SingleFilter",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],supportFieldTypes:[],part:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,valueProvider:null,dateOptionsObj:{status:!1},allDates:[f.VIRTUAL_DATE_CUSTOM,f.VIRTUAL_DATE_TODAY,f.VIRTUAL_DATE_YESTERDAY,f.VIRTUAL_DATE_TOMORROW],
runtime:!1,widgetId:"",postMixInProperties:function(){this.supportFieldTypes=[];this.supportFieldTypes.push(this.stringFieldType);this.supportFieldTypes.push(this.dateFieldType);this.supportFieldTypes=this.supportFieldTypes.concat(this.numberFieldTypes);this.nls=window.jimuNls.filterBuilder;this.nls.deleteText=window.jimuNls.common.deleteText},postCreate:function(){this.inherited(arguments);this._initSelf();this.own(n(this.valueTypeSetNode,c,r.hitch(this,this._onValueTypeSetClick)));this.own(n(this.btnDelete,
c,r.hitch(this,function(){this._destroySelf()})));this.own(n(document,"click",r.hitch(this,function(t){t=t.target;l.isDescendant(t,this.valueTypePopupNode)&&!l.hasClass(t,"value-type-popup-icon")||this._closeEsriPopup()})));this.customDijit&&this.own(n(window,"resize",r.hitch(this,function(){this._closeEsriPopup()})))},toJson:function(){var t={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",caseSensitive:!1},z=this._getFieldObjByUI();if(!z)return null;t.fieldObj=z;z=this._getOperatorByUI();
if(!z)return null;t.operator=z;t.caseSensitive=this.cbxCaseSensitive.getStatus()&&this.cbxCaseSensitive.getValue();z=this._getValueTypeByUI();var x=this._isUseAskForValues();if(x){if(!this.promptTB.validate())return this._showValidationErrorTip(this.promptTB),null;t.interactiveObj={prompt:a.sanitizeHTML(this.promptTB.get("value")),hint:a.sanitizeHTML(this.hintTB.get("value")),cascade:"none"};this.dateOptionsObj.status&&(1===this.dateOptionsObj.num?t.interactiveObj.virtualDates=this._getRelativeDatesByUI("start"):
(t.interactiveObj.virtualDates1=this._getRelativeDatesByUI("start"),t.interactiveObj.virtualDates2=this._getRelativeDatesByUI("end")));if("unique"===z||"multiple"===z)t.interactiveObj.cascade=this.cascadeSelect.get("value")}t.valueObj={isValid:!0,type:""};x=x?this.valueProvider.tryGetValueObject():this.valueProvider.getValueObject();if(!x)return null;x.type=z;t.valueObj=x;return t},_getRelativeDatesByUI:function(t){var z=[];k.forEach(this.allDates,function(x){this[x+"_"+t+"_date"].checked&&z.push(x)},
this);return z},_removeRelativeDateChangeEvents:function(){k.forEach(this.allDates,function(t){var z=this[t+"_start_date"];z.changeEvent&&z.changeEvent.remove();2===this.dateOptionsObj.num&&(t=this[t+"_end_date"],t.changeEvent&&t.changeEvent.remove())},this)},_getFieldObjByUI:function(){var t=this._getSelectedFilteringItem(this.fieldsSelect);if(!t)return null;var z="";0!==this.popupFieldsInfo.length&&(z=a.getDateFieldFormatByFieldName(this.popupFieldsInfo,t.name));return{name:t.name,label:t.name,
dateFormat:z,shortType:t.shortType,type:t.type}},_getOperatorByUI:function(){var t=this.operatorsSelect.get("value");"none"===t&&(t=null);return t},showDelteIcon:function(){l.setStyle(this.btnDelete,"display","inline-block")},hideDeleteIcon:function(){l.setStyle(this.btnDelete,"display","none")},_showCaseSensitive:function(){l.setStyle(this.cbxCaseSensitive.domNode,"display","inline-block")},_hideCaseSensitive:function(){l.setStyle(this.cbxCaseSensitive.domNode,"display","none")},_showAndEnableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!0);
this._showCaseSensitive()},_hideAndDisableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!1);this._hideCaseSensitive()},_initSelf:function(){this.isHosted&&(this.cbxCaseSensitive.setValue(!1),this.cbxCaseSensitive.setStatus(!1),this.cbxCaseSensitive.domNode.title=this.nls.notSupportCaseSensitiveTip);this.own(n(this.fieldsSelect,"MouseEnter",r.hitch(this,this._updateFieldsSelectTitle)));this.own(n(this.operatorsSelect,"MouseEnter",r.hitch(this,this._updateOperatorsSelectTitle)));this.enableAskForValues?
(l.setStyle(this.cbxAskValues.domNode,"display","inline-block"),l.setStyle(this.promptSection,"display","block"),this.own(n(this.cbxAskValues,"status-change",r.hitch(this,this._onCbxAskValuesStatusChanged))),this.cbxAskValues.onChange=r.hitch(this,this._onCbxAskValuesClicked)):(l.setStyle(this.cbxAskValues.domNode,"display","none"),l.setStyle(this.promptSection,"display","none"));var t=this.layerInfo.fields;t&&0<t.length&&(t=k.filter(t,r.hitch(this,function(z){return 0<=this.supportFieldTypes.indexOf(z.type)})),
0<t.length&&(this._initValueTypeUI(),this._enableAllValueTypeOptions(),this._initFieldsSelect(t),this.part?this._showPart(this.part):this._resetByFieldAndOperator(),setTimeout(r.hitch(this,function(){this._bindFieldsSelectChangeAndOperatorChangeEvents()}),0)))},_bindFieldsSelectChangeAndOperatorChangeEvents:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this.fieldsSelect&&(this._handle1=n(this.fieldsSelect,"change",r.hitch(this,this._onFieldsSelectChange)));this.operatorsSelect&&
(this._handle2=n(this.operatorsSelect,"change",r.hitch(this,this._onOperatorsSelectChange)))},_removeFieldsSelectChangeAndOperatorChangeEvents:function(){this._handle1&&this._handle1.remove();this._handle2&&this._handle2.remove();this._handle2=this._handle1=null},_isServiceSupportDistinctValues:function(t,z){if(this._isStreamServer(t))return!1;t=z.currentVersion?z:z.toJson().layerDefinition;return 10.1<=parseFloat(t.currentVersion)},_isStreamServer:function(t){t=(t||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(t)},
_updateFieldsSelectTitle:function(){this.fieldsSelect.domNode.title="";var t=this._getSelectedFilteringItem(this.fieldsSelect);t&&(this.fieldsSelect.domNode.title=t.displayName||t.alias||t.name)},_updateOperatorsSelectTitle:function(){this.operatorsSelect.domNode.title="";var t=this.operatorsSelect.get("value");t&&(t=this.operatorsSelect.getOptions(t),this.operatorsSelect.domNode.title=t.label,l.setAttr(this.operatorsSelect.domNode,"aria-label",t.label))},_showValidationErrorTip:function(t){try{!t.validate()&&
t.domNode&&t.focusNode&&(t.focusNode.focus(),t.focusNode.blur())}catch(z){console.error(z)}},_getSelectedFilteringItem:function(t){if(t.validate()){var z=t.get("item");if(z)return z}this._showValidationErrorTip(t);return null},_getShortTypeByFieldType:function(t){return t===this.stringFieldType?"string":t===this.dateFieldType?"date":0<=this.numberFieldTypes.indexOf(t)?"number":null},_initFieldsSelect:function(t){t=k.map(t,r.hitch(this,function(x,y){var D=r.mixin({},x);D.id=y;D.shortType=this._getShortTypeByFieldType(x.type);
D.alias||(D.alias=D.name);x="";"string"===D.shortType?x=this.nls.string:"number"===D.shortType?x=this.nls.number:"date"===D.shortType&&(x=this.nls.date);D.displayName=D.alias+" ("+x+")";return D}));if(0<t.length){var z=new e({data:t});this.fieldsSelect.set("store",z);this.fieldsSelect.set("value",t[0].id)}setTimeout(r.hitch(this,function(){this.fieldsSelect&&this.fieldsSelect.focusNode&&this.fieldsSelect.focusNode.focus()}),2);this._updateOperatorsByFieldsSelect()},_showPart:function(t){if((this.part=
t)&&this.part.fieldObj&&this.part.operator&&this.part.valueObj){this._removeFieldsSelectChangeAndOperatorChangeEvents();var z=this.part.fieldObj.name;t=this.part.operator;this.part.caseSensitive=!!this.part.caseSensitive;z=this.fieldsSelect.store.query({name:z});0!==z.length&&(z=z[0])&&(this.fieldsSelect.set("value",z.id),this._updateOperatorsByFieldsSelect(),this.operatorsSelect.set("value",t),this._resetByFieldAndOperator(this.part),t=this.part.interactiveObj)&&(this.cbxAskValues.check(),this._updatePrompt(),
this.promptTB.set("value",t.prompt||""),this.hintTB.set("value",t.hint||""),"unique"===this.part.valueObj.type||"multiple"===this.part.valueObj.type?this.cascadeSelect.set("value",t.cascade):this.cascadeSelect.set("value","none"))}},_onFieldsSelectChange:function(){this._updateOperatorsByFieldsSelect();this._resetByFieldAndOperator()},_updateOperatorsByFieldsSelect:function(){this._updateFieldsSelectTitle();this.operatorsSelect.removeOption(this.operatorsSelect.getOptions());this.operatorsSelect.addOption({value:"none",
label:this.nls.none});var t=this._getSelectedFilteringItem(this.fieldsSelect);t&&(this.operatorsSelect.shortType=t.shortType,t=B.getOperatorsByShortType(t.shortType,this.isHosted),this.operatorsSelect.removeOption(this.operatorsSelect.getOptions()),k.forEach(t,r.hitch(this,function(z){this.operatorsSelect.addOption({value:z,label:this.nls[z]})})))},_onOperatorsSelectChange:function(){this._resetByFieldAndOperator()},_updateValueTypeClass:function(){l.removeClass(this.domNode,"value-type");l.removeClass(this.domNode,
"field-type");l.removeClass(this.domNode,"unique-type");l.removeClass(this.domNode,"support-cascade");var t=this._getValueTypeByUI();if("value"===t)l.addClass(this.domNode,"value-type"),this.cascadeSelect.set("value","none");else if("field"===t)l.addClass(this.domNode,"field-type"),this.cascadeSelect.set("value","none");else{l.addClass(this.domNode,"unique-type");this.cascadeSelect.set("value","previous");var z=!0;z=this._getSelectedFilteringItem(this.fieldsSelect);z=a.getCodedValuesOrTypesCount(z,
this.layerInfo);(z=0<z?a.isCodedValuesSupportFilter(this.layerInfo,z):!0)?("uniquePredefined"===t||"multiplePredefined"===t?this.cascadeSelect.set("value","none"):this.cascadeSelect.set("value","previous"),l.addClass(this.domNode,"support-cascade")):this.cascadeSelect.set("value","none")}},_enableValueTypeSelectOption:function(t,z){t=b("li[data-type\x3d"+t+"]",this.valueTypePopupNode)[0];z?(l.removeClass(t,"disabled"),l.setAttr(t,"aria-disabled","false")):(l.addClass(t,"disabled"),l.setAttr(t,"aria-disabled",
"true"))},_setVisibleValueTypeSelectOption:function(t,z){t=b("li[data-type\x3d"+t+"]",this.valueTypePopupNode)[0];z?l.setStyle(t,"display","block"):l.setStyle(t,"display","none")},_calcValueTypePosition:function(t){t=l.position(t.target);var z=l.position(document.body).w;var x=l.position(document.body).h;var y=l.getStyle(this.valueTypePopupNode,"width"),D=l.getStyle(this.valueTypePopupNode,"height");x=x-t.y-16-10>=D?t.y+16+10:t.y-D-10;z=z-t.x>=y?t.x:t.x+16-y;window.isRTL&&(z=t.x+16>=y?t.x+16-y:t.x);
return{left:z,top:x}},_onValueTypeSetClick:function(t){u.open({popup:this.customDijit,around:t.target});var z=this._calcValueTypePosition(t);u.open({x:z.left,y:z.top,popup:this.customDijit});t.stopPropagation();a.isInNavMode()&&g.focus(this.valueTypePopupDelBtn)},_onValueTypeClick:function(t){var z=l.getAttr(t.currentTarget,"data-type");l.hasClass(t.currentTarget,"disabled")?t.stopPropagation():(b("li",this.valueTypePopupNode).forEach(function(x){l.removeClass(x,"selected")}),l.addClass(t.currentTarget,
"selected"),this._resetByFieldAndOperator(null,z),this._closeEsriPopup())},_enableValueTypeOption:function(t){this._enableValueTypeSelectOption("value",t)},_enableFieldTypeOption:function(t){this._enableValueTypeSelectOption("field",t)},_enableUniqueTypeOption:function(t){this._enableValueTypeSelectOption("unique",t)},_enableUniquePredefinedTypeOption:function(t){this.runtime?this._setVisibleValueTypeSelectOption("uniquePredefined",!1):this._enableValueTypeSelectOption("uniquePredefined",t)},_enableValuesTypeOption:function(t){this._enableValueTypeSelectOption("values",
t)},_enableMultipleTypeOption:function(t){this._enableValueTypeSelectOption("multiple",t)},_enableMultiplePredefinedTypeOption:function(t){this.runtime?this._setVisibleValueTypeSelectOption("multiplePredefined",!1):this._enableValueTypeSelectOption("multiplePredefined",t)},_enableAllValueTypeOptions:function(){this._enableValueTypeOption(!0);this._enableFieldTypeOption(!0);this._enableUniqueTypeOption(!0);this._enableUniquePredefinedTypeOption(!0);this._enableMultipleTypeOption(!0);this._enableMultiplePredefinedTypeOption(!0)},
_disableAllValueTypeOptions:function(){this._enableValueTypeOption(!1);this._enableFieldTypeOption(!1);this._enableUniqueTypeOption(!1);this._enableUniquePredefinedTypeOption(!1);this._enableMultipleTypeOption(!1);this._enableMultiplePredefinedTypeOption(!1)},_resetByFieldAndOperator:function(t,z){this._updateOperatorsSelectTitle();this.valueProvider&&this.valueProvider.destroy();this._hideCaseSensitive();this._disableAllValueTypeOptions();t||(t={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",
caseSensitive:!1},t.fieldObj=this._getFieldObjByUI(),t.operator=this._getOperatorByUI());t.widgetId=this.widgetId;var x=[],y=null;t.fieldObj&&t.operator&&(x=this.valueProviderFactory.getSupportedValueTypes(t.fieldObj.name,t.operator),t.valueObj?y=t.valueObj.type:(y=z&&0<=x.indexOf(z)?z:x[0],t.valueObj={type:y}),0<=x.indexOf("value")&&this._enableValueTypeOption(!0),0<=x.indexOf("field")&&this._enableFieldTypeOption(!0),0<=x.indexOf("unique")&&this._enableUniqueTypeOption(!0),0<=x.indexOf("values")&&
this._enableValuesTypeOption(!0),0<=x.indexOf("uniquePredefined")&&this._enableUniquePredefinedTypeOption(!0),0<=x.indexOf("multiple")&&this._enableMultipleTypeOption(!0),0<=x.indexOf("multiplePredefined")&&this._enableMultiplePredefinedTypeOption(!0),"value"===y?(this._enableValueTypeOption(!0),this.dateOptionsObj.status=!1,l.removeClass(this.domNode,"support-relative-start-date"),l.removeClass(this.domNode,"support-relative-end-date"),this._initDateOptionsUI(t)):"field"===y?this._enableFieldTypeOption(!0):
"unique"===y?this._enableUniqueTypeOption(!0):"values"===y?this._enableValuesTypeOption(!0):"uniquePredefined"===y?this._enableUniquePredefinedTypeOption(!0):"multiple"===y?this._enableMultipleTypeOption(!0):"multiplePredefined"===y&&this._enableMultiplePredefinedTypeOption(!0),this._updateValueTypeUI(y));0<x.length?(this.valueProvider=this.valueProviderFactory.getValueProvider(t,this.runtime),this.valueProvider.placeAt(this.valueProviderContainer),this.valueProvider.setValueObject(t.valueObj),this.own(n(this.valueProvider,
"change",r.hitch(this,function(D,H){D&&this.dateOptionsObj.status&&this[D+"_"+H+"_date"].setValue(!0);this.emit("change")}))),this.valueProvider.bindChangeEvents(),this.valueProvider.isBlankValueProvider()?(l.addClass(this.valueProvider.domNode,"hidden"),l.addClass(this.attributeValueContainer,"hidden")):l.removeClass(this.attributeValueContainer,"hidden"),(z=B.getOperatorInfo(t.operator))&&y&&(z[y]&&z[y].supportCaseSensitive&&this._showCaseSensitive(),t&&this.cbxCaseSensitive.setValue(t.caseSensitive))):
l.addClass(this.attributeValueContainer,"hidden");this._updateWhenValueRadioChanged();this.emit("change")},_initDateOptionsUI:function(t){t.fieldObj.type===this.dateFieldType&&(this.dateOptionsObj=B.isSupportVirtualDates(t.operator),this.dateOptionsObj.status&&(1===this.dateOptionsObj.num?(this._initDateOptions(t.interactiveObj.virtualDates,"start"),this.startDateOptions.innerHTML=this.nls.dateOptions):(this._initDateOptions(t.interactiveObj.virtualDates1,"start"),this._initDateOptions(t.interactiveObj.virtualDates2,
"end"),l.addClass(this.domNode,"support-relative-end-date"),this.startDateOptions.innerHTML=this.nls.startDateOptions),l.addClass(this.domNode,"support-relative-start-date")))},_initDateOptions:function(t,z){t||(t=this.allDates);k.forEach(this.allDates,function(x){var y=this[x+"_"+z+"_date"];y.changeEvent&&y.changeEvent.remove();y.setValue(0<=t.indexOf(x));y.changeEvent=n(y,"change",r.hitch(this,this._onShowTooltipCBXsChange,y,x,z))},this)},_onShowTooltipCBXsChange:function(t,z,x){if(t&&!1===t.checked){var y=
"";if(this._isCurrentDateOptIsSelected(z,x))y=this.nls.notUncheckedCurrent;else if(this._isDateOptionsAllHide(x))y=this.nls.atLeastOne;else return;t.check();h.hide();h.show(y,t.domNode);this.own(n.once(t.domNode,p.leave,r.hitch(this,function(){h.hide(t.domNode)})))}},_isDateOptionsAllHide:function(t){var z=!0;k.some(this.allDates,function(x){if(!0===this[x+"_"+t+"_date"].checked)return z=!1,!0},this);return z},_isCurrentDateOptIsSelected:function(t,z){var x=this.valueProvider.getValueObject();if(x)if("start"===
z)if(1===this.dateOptionsObj.num){if(!x.virtualDate&&t===f.VIRTUAL_DATE_CUSTOM||x.virtualDate===t)return!0}else{if(!x.virtualDate1&&t===f.VIRTUAL_DATE_CUSTOM||x.virtualDate1===t)return!0}else if(!x.virtualDate2&&t===f.VIRTUAL_DATE_CUSTOM||x.virtualDate2===t)return!0;return!1},_updateWhenValueRadioChanged:function(){this._updatePrompt(!1,!0);this._updateValueTypeClass()},_onCbxAskValuesClicked:function(){this._updateRequiredProperty();this._updatePrompt(!0)},_onCbxAskValuesStatusChanged:function(){this._updateRequiredProperty()},
_isUseAskForValues:function(){var t=this._getValueTypeByUI();return"uniquePredefined"===t||"multiplePredefined"===t?!0:this.cbxAskValues.status&&this.cbxAskValues.checked},_isValueRequired:function(){return!this._isUseAskForValues()},_updateRequiredProperty:function(){var t=this._isValueRequired();this.valueProvider.setRequired(t)},_getValueTypeByUI:function(){var t=b("li.selected",this.valueTypePopupNode)[0];return t?l.getAttr(t,"data-type"):null},_closeEsriPopup:function(){this.customDijit&&u.close(this.customDijit)},
_destroyEsriPopup:function(){this.customDijit&&(this.customDijit.destroy(),u.close(this.customDijit))},_initValueTypeUI:function(){if(!this.valueTypePopupNode){this.valueTypePopupNode=document.createElement("DIV");l.addClass(this.valueTypePopupNode,"value-type-popup");this.valueTypePopupNode.innerHTML='\x3cdiv class\x3d"value-type-popup-header"\x3e\x3cspan class\x3d"value-type-popup-title jimu-ellipsis" title\x3d"'+this.nls.setInputType+'"\x3e'+this.nls.setInputType+'\x3c/span\x3e\x3cspan role\x3d"button" tabindex\x3d"0" aria-label\x3d"'+
this.nls.deleteText+'" class\x3d"value-type-popup-icon jimu-icon jimu-icon-delete"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul role\x3d"listbox" tabindex\x3d"0"\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"value" title\x3d"'+this.nls.value+'"\x3e\x3cspan\x3e'+this.nls.value+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"field" title\x3d"'+this.nls.field+'"\x3e\x3cspan\x3e'+this.nls.field+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"unique" title\x3d"'+
this.nls.unique+'"\x3e\x3cspan\x3e'+this.nls.unique+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"uniquePredefined" title\x3d"'+this.nls.uniquePredefined+'"\x3e\x3cspan\x3e'+this.nls.uniquePredefined+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"multiple" title\x3d"'+this.nls.multiple+'"\x3e\x3cspan\x3e'+this.nls.multiple+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"multiplePredefined" title\x3d"'+
this.nls.multiplePredefined+'"\x3e\x3cspan\x3e'+this.nls.multiplePredefined+"\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3c/ul\x3e";this.customDijit=new A({baseClass:"jimu-filter-valueType",domNode:this.valueTypePopupNode});this.valueTypePopupDelBtn=b(".value-type-popup-icon",this.valueTypePopupNode)[0];this.own(n(this.valueTypePopupDelBtn,"click",r.hitch(this,function(z){this._closeEsriPopup();z.stopPropagation()})));this.own(n(this.valueTypePopupDelBtn,"keydown",r.hitch(this,function(z){z.keyCode===
d.ENTER||z.keyCode===d.SPACE||z.keyCode===d.ESCAPE?(z.stopPropagation(),this._closeEsriPopup(),a.isInNavMode()&&g.focus(this.valueTypeSetNode)):z.shiftKey||z.keyCode!==d.TAB||this.valueTypeList.focus()})));this.valueTypeList=b("ul",this.valueTypePopupNode)[0];var t=b("li",this.valueTypePopupNode);this.own(n(this.valueTypeList,"focus",r.hitch(this,function(){this.selectedValueType=b("li.selected",this.valueTypePopupNode)[0];this.selectedValueType.focus()})));this.own(n(this.valueTypeList,"keydown",
r.hitch(this,function(z){if(z.keyCode===d.TAB)z.shiftKey?(z.preventDefault(),this.valueTypePopupDelBtn.focus()):(z.preventDefault(),this._closeEsriPopup(),a.isInNavMode()&&g.focus(this.valueTypeSetNode));else{var x=!1;if(z.keyCode===d.DOWN_ARROW){var y=this.selectedValueType;for(z=0;z<t.length-1;z++)if(x){if("none"!==l.getStyle(t[z],"display")){y=t[z];break}}else t[z]===this.selectedValueType&&(x=!0)}else if(z.keyCode===d.UP_ARROW)for(y=this.selectedValueType,z=t.length-1;0<=z;z--)if(x){if("none"!==
l.getStyle(t[z],"display")){y=t[z];break}}else t[z]===this.selectedValueType&&(x=!0);else if(z.keyCode===d.HOME)y=t[0];else if(z.keyCode===d.END)for(z=t.length-1;0<=z;z--)if("none"!==l.getStyle(t[z],"display")){y=t[z];break}y&&(this.selectedValueType=y,y.focus())}})));this.own(n(t,"click",r.hitch(this,function(z){this._onValueTypeClick(z)})));this.own(n(t,"keydown",r.hitch(this,function(z){z.keyCode===d.ENTER&&(this._onValueTypeClick(z),l.hasClass(z.target,"disabled")||this.valueTypeSetNode.focus())})));
this.own(n(this.valueTypePopupNode,"keydown",r.hitch(this,function(z){z.keyCode===d.ESCAPE&&(z.stopPropagation(),g.focus(this.valueTypePopupDelBtn))})))}},_updateValueTypeUI:function(t){b("li",this.valueTypePopupNode).forEach(function(z){l.removeClass(z,"selected")});if(t=b("li[data-type\x3d"+t+"]",this.valueTypePopupNode)[0])return l.addClass(t,"selected")},_updatePrompt:function(t,z){this.promptTB.set("value","");this.hintTB.set("value","");this.cbxAskValues.setStatus(!0);!t&&z&&this.cbxAskValues.uncheck(!0);
l.setStyle(this.promptTable,"display","table");z=this.operatorsSelect.get("value");var x=this.nls[z],y=!1,D=this._getValueTypeByUI(),H=B.getOperatorInfo(z);H&&D&&(H=H[D])&&H.supportAskForValue&&(y=!0);y||(this.cbxAskValues.uncheck(!0),this.cbxAskValues.setStatus(!1));H=this.cbxAskValues.getValue();(D=0<=["uniquePredefined","multiplePredefined"].indexOf(D)?!0:!1)?this.cbxAskValues.check(!0):t?H?this.cbxAskValues.check(!0):this.cbxAskValues.uncheck(!0):y?this.cbxAskValues.status||this.cbxAskValues.check(!0):
this.cbxAskValues.uncheck(!0);this.cbxAskValues.status&&this.cbxAskValues.checked?(l.setStyle(this.promptTable,"display","table"),(t=this._getSelectedFilteringItem(this.fieldsSelect))&&"none"!==z&&this.promptTB.set("value",(t.alias||t.name)+" "+x)):l.setStyle(this.promptTable,"display","none");D?(this.cbxAskValues.setStatus(!1),this.cascadeSelect.setDisabled(!0)):this.cascadeSelect.setDisabled(!1)},_destroySelf:function(){this.destroy()},destroy:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();
this.dateOptionsObj.status&&this._removeRelativeDateChangeEvents();this._destroyEsriPopup();this.inherited(arguments)}})})},"jimu/dijit/_FilterSet":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_FilterSet.html dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dijit/a11yclick dojo/aspect dojo/query ./_SingleFilter".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e){return q([A,w,m,
E],{templateString:v,baseClass:"jimu-filter-set",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],partsObj:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,runtime:!1,widgetId:"",postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.nls.deleteText=window.jimuNls.common.deleteText;this.nls.addText=window.jimuNls.common.add;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this._initSelf()},toJson:function(){var a=b(".jimu-single-filter",this.allExpsBox);a=n.map(a,l.hitch(this,function(f){return r.byNode(f).toJson()}));return n.every(a,l.hitch(this,function(f){return!!f}))&&0<a.length?{logicalOperator:this.allAnySelect.value,parts:a}:null},showDelteIcon:function(){k.setStyle(this.btnDelete,"display","block")},hideDeleteIcon:function(){k.setStyle(this.btnDelete,"display","none")},_initSelf:function(){this.own(d(this.btnDelete,c,l.hitch(this,function(){this._destroySelf()})));
this.own(d(this.btnAdd,c,l.hitch(this,function(){this._addSingleFilter();this.emit("change")})));if(this.partsObj){this.allAnySelect.value=this.partsObj.logicalOperator;var a=this.partsObj.parts||[];0===a.length?(this._addSingleFilter(),this._addSingleFilter()):1===a.length?(this._addSingleFilter(a[0]),this._addSingleFilter()):n.forEach(a,l.hitch(this,function(f){this._addSingleFilter(f)}))}else this._addSingleFilter(),this._addSingleFilter();setTimeout(l.hitch(this,function(){this.allAnySelect.focus()}),
5)},_addSingleFilter:function(a){a=new e({widgetId:this.widgetId,url:this.url,layerInfo:this.layerInfo,popupFieldsInfo:this.popupFieldsInfo,stringFieldType:this.stringFieldType,dateFieldType:this.dateFieldType,numberFieldTypes:this.numberFieldTypes,part:a,OPERATORS:this.OPERATORS,enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,isInFilterSet:!0,runtime:this.runtime});a.placeAt(this.allExpsBox);a.startup();this.own(g.after(a,"_destroySelf",
l.hitch(this,function(){this._checkFilterNumbers();this.allAnySelect.focus()})));this.own(d(a,"change",l.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return a},_checkFilterNumbers:function(){var a=b(".jimu-single-filter",this.allExpsBox),f=2<a.length;n.forEach(a,l.hitch(this,function(h){h=r.byNode(h);f?h.showDelteIcon():h.hideDeleteIcon()}))},_destroySelf:function(){this.destroy()}})})},"jimu/dijit/FilterParameters":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/promise/all dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/_base/array dojo/query dijit/registry jimu/filterUtils jimu/utils ./_SingleFilterParameter ./_filter/ValueProviderFactory".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b,e,a,f){return m([v,r,l,q],{baseClass:"jimu-filter-parameters",templateString:'\x3cdiv\x3e\x3ctable style\x3d"width:100%;border-collapse:collapse;"\x3e\x3ctbody data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e',_filterUtils:null,_spObj:null,nls:null,partsObj:null,layerInfo:null,OPERATORS:null,url:null,featureLayerId:null,widgetId:"",postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this._filterUtils=new b;this.OPERATORS=
k.clone(this._filterUtils.OPERATORS);this._spObj={}},destroy:function(){this.clear();this._filterUtils=null;this.inherited(arguments)},getFilterExpr:function(h){var p=this._getNewValidPartsObj(this.partsObj,!0),B=p?this._getFilterExprByPartsObj(p):null;return h&&h.ifDisplaySQL?void 0===p.displaySQL?B:p.displaySQL:B},getValueProviders:function(){for(var h=[],p=this._getAllInteractiveSinglePartArray(this.partsObj),B=0;B<p.length;B++){var u=p[B].spId;u&&(u=this._getSingleFilterParameterBySpId(u),h.push(u))}return h},
_getNewValidPartsObj:function(h,p){h=k.clone(h);for(var B={logicalOperator:h.logicalOperator,parts:[]},u=k.hitch(this,function(D){if(D.spId){var H=this._getSingleFilterParameterBySpId(D.spId),I=H.getValueObject();this.useStandardizedQueries&&"date"===D.fieldObj.shortType&&(D._useStandardizedQueries=this.useStandardizedQueries,D._layerTimeZoneOffset=this.layerTimeZoneOffset);D.valueObj=I;if(!I||"uniquePredefined"!==I.type&&"multiplePredefined"!==I.type)return I&&"multipleDynamic"===I.type?0<I.value.length?
1:-1:I&&"unique"===I.type?null===I.value||void 0===I.value||""===I.value?-1:1:H.getStatus();H=[];for(var N in I.value)I.value[N].isChecked&&H.push(I.value[N]);if(0<H.length)return D.valueObj.value=H,1;D.valueObj.value="";return-1}return D.valueObj?1:-1}),t=k.hitch(this,function(D){var H=u(D);0<H&&B.parts.push(D);return H}),z=k.hitch(this,function(D){var H=[];D.parts=d.filter(D.parts,k.hitch(this,function(I){I=u(I);H.push(I);return 0<I}));1===D.parts.length?B.parts.push(D.parts[0]):2<=D.parts.length&&
B.parts.push(D);return Math.min.apply(H,H)}),x=0;x<h.parts.length;x++){var y=h.parts[x];if(y.parts){if(0>z(y)&&p)return null}else if(0>t(y)&&p&&y.valueObj&&"uniquePredefined"!==y.valueObj.type&&"multiplePredefined"!==y.valueObj.type&&"unique"!==y.valueObj.type)return null}return B},_getFilterExprByPartsObj:function(h){this._filterUtils.isHosted=e.isHostedService(this.url);return this._filterUtils.getExprByFilterObj(h)},_getSingleFilterParameterBySpId:function(h){return this._spObj[h]},_getCascadeFilterPartsObj:function(h){var p=
{logicalOperator:this.partsObj.logicalOperator,parts:[]},B=k.clone(this.partsObj);var u="none";h.interactiveObj&&h.interactiveObj.cascade&&(u=h.interactiveObj.cascade);if("previous"===u)for(u=0;u<B.parts.length;u++){var t=B.parts[u];if(t.majorCascadeIndex<h.majorCascadeIndex)p.parts.push(t);else if(t.parts&&t.majorCascadeIndex===h.majorCascadeIndex){var z=k.clone(t);z.parts=d.filter(z.parts,k.hitch(this,function(x){return x.minorCascadeIndex<h.minorCascadeIndex}));p.parts.push(z)}}else if("all"===
u)for(u=0;u<B.parts.length;u++)t=B.parts[u],t.majorCascadeIndex!==h.majorCascadeIndex?p.parts.push(t):t.majorCascadeIndex===h.majorCascadeIndex&&t.parts&&(z=k.clone(t),d.some(t.parts,k.hitch(this,function(x){return x.spId===h.spId}))&&(z.parts=d.filter(z.parts,k.hitch(this,function(x){return x.minorCascadeIndex!==h.minorCascadeIndex})),p.parts.push(z)));return p=this._getNewValidPartsObj(p,!1)},_getCascadeFilterExpr:function(h){var p="1\x3d1";(h=this._getCascadeFilterPartsObj(h))&&(p=this._getFilterExprByPartsObj(h));
p||(p="1\x3d1");return p},clear:function(){this.featureLayerId=this.url=null;this.widgetId="";var h=c(".jimu-single-filter-parameter",this.tbody);d.forEach(h,k.hitch(this,function(p){g.byNode(p).destroy()}));n.empty(this.tbody);this.layerInfo=this.partsObj=null},build:function(h,p,B,u,t){var z=new A;this.clear();this.url=h;this.layerInfo=p;this.partsObj=k.clone(B);this.useStandardizedQueries=this._filterUtils.useStandardizedQueries(p);this.layerTimeZoneOffset=this._filterUtils.getLayerTimezoneOffset(p);
this.partsObj=this._updatePartsObj(this.partsObj,p);this.featureLayerId=u;this.widgetId=t;this._setCascadeIndexForPartsObj(this.partsObj);h=this._getAllInteractiveSinglePartArray(this.partsObj);var x=this.partsObj.wId;if(0<h.length){var y=new f({url:this.url,layerDefinition:p,featureLayerId:this.featureLayerId});h=d.map(h,k.hitch(this,function(D,H){x&&(D.vpId=x+"_"+H);D.widgetId=this.widgetId;H=n.create("tr",{innerHTML:"\x3ctd\x3e\x3c/td\x3e"},this.tbody);H=c("td",H)[0];var I=this._getFieldInfo(D.fieldObj.name,
this.layerInfo);I=new a({nls:this.nls,url:this.url,layerDefinition:p,fieldInfo:I,part:D,valueProviderFactory:y});this.own(E(I,"change",k.hitch(this,this._onSingleFilterParameterChanged)));this.own(E(I,"enter",k.hitch(this,this._catchSingleFilterParameterEnter)));I.placeAt(H);I.startup();D.spId=I.id;return this._spObj[I.id]=I}));d.forEach(h,k.hitch(this,function(D){D.valueProvider.getCascadeFilterExpr=k.hitch(this,this._getCascadeFilterExpr,D.part);D.valueProvider.getCascadeFilterPartsObj=k.hitch(this,
this._getCascadeFilterPartsObj,D.part)}));h=d.map(h,k.hitch(this,function(D){return D.init()}));w(h).then(k.hitch(this,function(D){z.resolve(D)}),k.hitch(this,function(){z.reject()}))}else z.resolve();return z},_updatePartsObj:function(h){d.forEach(h,k.hitch(this,function(p){p.parts?d.forEach(p.parts,k.hitch(this,function(B){B.interactiveObj&&!0===B.interactiveObj.cascade?B.interactiveObj.cascade="previous":!1===B.interactiveObj.cascade&&(B.interactiveObj.cascade="none")})):p.interactiveObj&&!0===
p.interactiveObj.cascade?p.interactiveObj.cascade="previous":!1===p.interactiveObj.cascade&&(p.interactiveObj.cascade="none")}));return h},_setCascadeIndexForPartsObj:function(h){for(var p=0;p<h.parts.length;p++){var B=h.parts[p];B.majorCascadeIndex="AND"===h.logicalOperator?p:0;B.minorCascadeIndex=0;B.cascadeIndex=B.majorCascadeIndex;if(B.parts)for(var u=0;u<B.parts.length;u++){var t=B.parts[u];t.majorCascadeIndex=B.majorCascadeIndex;t.minorCascadeIndex="AND"===B.logicalOperator?u:0;t.cascadeIndex=
parseFloat(t.majorCascadeIndex+"."+t.minorCascadeIndex)}}},_getFieldInfo:function(h,p){p=p.fields;for(var B=0;B<p.length;B++){var u=p[B];if(h===u.name)return u}return null},_getAllInteractiveSinglePartArray:function(h){for(var p=[],B=0;B<h.parts.length;B++){var u=h.parts[B];if(u.parts)for(var t=0;t<u.parts.length;t++){var z=u.parts[t];z.interactiveObj&&p.push(z)}else u.interactiveObj&&p.push(u)}return p},_catchSingleFilterParameterEnter:function(){this.emit("enter")},_onSingleFilterParameterChanged:function(){this.emit("change",
this.getFilterExpr(!1))}})})},"jimu/dijit/_SingleFilterParameter":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilterParameter.html dojo/_base/lang ../utils".split(" "),function(E,q,A,w,m,v,r,l,k,n){return w([m,v,r,q],{baseClass:"jimu-single-filter-parameter",templateString:l,valueProvider:null,nls:null,url:null,layerDefinition:null,fieldInfo:null,part:null,valueProviderFactory:null,
postCreate:function(){this.inherited(arguments);this.valueProvider=this.valueProviderFactory.getValueProvider(this.part,!0);this.valueProvider.placeAt(this.valueProviderTd);this.own(E(this.valueProvider,"change",k.hitch(this,this._onValueProviderChanged)));this.own(E(this.valueProvider,"enter",k.hitch(this,this._onValueProviderEnter)));this.valueProvider.bindChangeEvents()},getValueObject:function(){return this.valueProvider.getValueObject()},init:function(){return this.build(this.fieldInfo,this.part)},
build:function(d,c){var g=null;this.fieldInfo=d;this.part=c;if(d=c.interactiveObj)this.promptNode.innerHTML=n.sanitizeHTML(d.prompt||""),this.hintNode.innerHTML=n.sanitizeHTML(d.hint||"");(d=this.valueProvider.setValueObject(this.part.valueObj))&&"function"===typeof d.then?g=d:(g=new A,g.resolve(this.valueProvider));return g},disable:function(){this.valueProvider.disable()},enable:function(){this.valueProvider.enable()},isEnabled:function(){return this.valueProvider.isEnabled()},getStatus:function(){return this.valueProvider.getStatus()},
_showValidationErrorTip:function(d){!d.validate()&&d.domNode&&d.focusNode&&(d.focusNode.focus(),d.focusNode.blur())},_onValueProviderEnter:function(){this.emit("enter")},_onValueProviderChanged:function(){this.emit("change")}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(E,q,A,w,m,v,r,l,k){return v("dijit.layout._LayoutWidget",[q,A,w],{baseClass:"dijitLayoutContainer",
isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);r.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var n=this.getParent&&this.getParent();n&&n.isLayoutContainer||(this.resize(),this.own(m.on("resize",E.hitch(this,"resize"))))}},resize:function(n,d){var c=this.domNode;n&&l.setMarginBox(c,n);d=d||{};E.mixin(d,n||{});"h"in d&&"w"in d||(d=E.mixin(l.getMarginBox(c),d));n=k.getComputedStyle(c);var g=l.getMarginExtents(c,
n),b=l.getBorderExtents(c,n);d=this._borderBox={w:d.w-(g.w+b.w),h:d.h-(g.h+b.h)};g=l.getPadExtents(c,n);this._contentBox={l:k.toPixelValue(c,n.paddingLeft),t:k.toPixelValue(c,n.paddingTop),w:d.w-g.w,h:d.h-g.h};this.layout()},layout:function(){},_setupChild:function(n){r.add(n.domNode,this.baseClass+"-child "+(n.baseClass?this.baseClass+"-"+n.baseClass:""))},addChild:function(n,d){this.inherited(arguments);this._started&&this._setupChild(n)},removeChild:function(n){r.remove(n.domNode,this.baseClass+
"-child"+(n.baseClass?" "+this.baseClass+"-"+n.baseClass:""));this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],function(E,q,A){return E("dgrid.OnDemandGrid",[q,A],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),function(E,q,A,w,m,v,r){function l(d,c){c&&c.nodeType&&d.appendChild(c)}
function k(d,c,g,b){if(this.formatter){b=this.formatter;var e=this.grid.formatterScope;g.innerHTML="string"===typeof b&&e?e[b](c,d):this.formatter(c,d)}else null!=c&&g.appendChild(document.createTextNode(c))}var n=8>w("ie")&&!w("quirks");q=q("dgrid.Grid",v,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(d){return"object"!=typeof d?this.columns[d]:this.cell(d).column},listType:"grid",cell:function(d,c){if(d.column&&d.element)return d;d.target&&d.target.nodeType&&(d=d.target);
if(d.nodeType){do{if(this._rowIdToObject[d.id])break;var g=d.columnId;if(g){c=g;var b=d;break}d=d.parentNode}while(d&&d!=this.domNode)}if(!b&&"undefined"!=typeof c){var e=this.row(d);if(g=e&&e.element){g=g.getElementsByTagName("td");for(var a=0;a<g.length;a++)if(g[a].columnId==c){b=g[a];break}}}if(null!=d)return{row:e||this.row(d),column:c&&this.column(c),element:b}},createRowCells:function(d,c,g,b){var e=m("table.dgrid-row-table[role\x3dpresentation]"),a=9>w("ie")||w("quirks")?m(e,"tbody"):e,f,h,
p;g=g||this.subRows;var B=0;for(f=g.length;B<f;B++){var u=g[B];var t=m(a,"tr");u.className&&m(t,"."+u.className);var z=0;for(h=u.length;z<h;z++){var x=u[z];var y=x.id;var D=x.field?".field-"+r.escapeCssIdentifier(x.field,"-"):"";(p="function"===typeof x.className?x.className(b):x.className)&&(D+="."+p);D=m(d+(".dgrid-cell.dgrid-cell-padding"+(y?".dgrid-column-"+r.escapeCssIdentifier(y,"-"):"")+D.replace(/ +/g,"."))+"[role\x3d"+("th"===d?"columnheader":"gridcell")+"]");D.columnId=y;n?(y=m(D,"!dgrid-cell-padding div.dgrid-cell-padding"),
D.contents=y):y=D;if(p=x.colSpan)D.colSpan=p;if(p=x.rowSpan)D.rowSpan=p;c(y,x);t.appendChild(D)}}return e},left:function(d,c){d.element||(d=this.cell(d));return this.cell(this._move(d,-(c||1),"dgrid-cell"))},right:function(d,c){d.element||(d=this.cell(d));return this.cell(this._move(d,c||1,"dgrid-cell"))},renderRow:function(d,c){var g=this.createRowCells("td",function(b,e){var a=d;e.get?a=e.get(d):"field"in e&&"_item"!=e.field&&(a=a[e.field]);e.renderCell?l(b,e.renderCell(d,a,b,c)):k.call(e,d,a,b,
c)},c&&c.subRows,d);return m("div[role\x3drow]\x3e",g)},renderHeader:function(){var d=this,c=this.headerNode,g=c.childNodes.length;for(c.setAttribute("role","row");g--;)m(c.childNodes[g],"!");g=this.createRowCells("th",function(b,e){var a=e.headerNode=b;n&&(b=b.parentNode);var f=e.field;f&&(b.field=f);e.renderHeaderCell?l(a,e.renderHeaderCell(a)):("label"in e||e.field)&&a.appendChild(document.createTextNode("label"in e?e.label:e.field));!1!==e.sortable&&f&&"_item"!=f&&(b.sortable=!0,b.className+=
" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[g.id=this.id+"-header"]=this.columns;c.appendChild(g);this._sortListener&&this._sortListener.remove();this._sortListener=A(g,"click,keydown",function(b){if("click"==b.type||32==b.keyCode||!w("opera")&&13==b.keyCode){var e=b.target,a,f;do if(e.sortable){var h=[{attribute:a=e.field||e.columnId,descending:(f=d._sort[0])&&f.attribute==a&&!f.descending}];a={bubbles:!0,cancelable:!0,grid:d,parentType:b.type,sort:h};A.emit(b.target,
"dgrid-sort",a)&&(d._sortNode=e,d.set("sort",h));break}while((e=e.parentNode)&&e!=c)}})},resize:function(){var d=this.headerNode.firstChild,c=this.contentNode,g;this.inherited(arguments);if(!w("ie")||7<w("ie")&&!w("quirks"))c.style.width="",c&&d&&(g=d.offsetWidth)!=c.offsetWidth&&(c.style.width=g+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(d,c){this.inherited(arguments);this.updateSortArrow(this._sort)},
_findSortArrowParent:function(d){var c=this.columns,g;for(g in c){var b=c[g];if(b.field==d)return b.headerNode}},updateSortArrow:function(d,c){this._lastSortedArrow&&(m(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),m(this._lastSortedArrow,"!"),delete this._lastSortedArrow);c&&(this._sort=d);if(d[0]&&(c=d[0].attribute,d=d[0].descending,c=this._sortNode||this._findSortArrowParent(c),delete this._sortNode,c)){c=c.contents||c;var g=this._lastSortedArrow=m("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]");
g.innerHTML="\x26nbsp;";c.insertBefore(g,c.firstChild);m(c,d?".dgrid-sort-down":".dgrid-sort-up");this.resize()}},styleColumn:function(d,c){return this.addCssRule("#"+r.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+r.escapeCssIdentifier(d,"-"),c)},_configColumns:function(d,c){var g=[],b=c instanceof Array;r.each(c,function(e,a){"string"==typeof e&&(c[a]=e={label:e});b||e.field||(e.field=a);a=e.id=e.id||(isNaN(a)?a:d+a);this._configColumn&&(this._configColumn(e,a,c,d),a=e.id);b&&(this.columns[a]=
e);e.grid=this;"function"===typeof e.init&&e.init();g.push(e)},this);return b?c:g},_destroyColumns:function(){var d=this.subRows,c=d&&d.length,g,b;this.cleanup();for(g=0;g<c;g++){var e=0;for(b=d[g].length;e<b;e++){var a=d[g][e];"function"===typeof a.destroy&&a.destroy()}}},configStructure:function(){var d=this.subRows,c=this._columns=this.columns;this.columns=!c||c instanceof Array?{}:c;if(d)for(c=0;c<d.length;c++)d[c]=this._configColumns(c+"-",d[c]);else this.subRows=[this._configColumns("",c)]},
_getColumns:function(){return this._columns||this.columns},_setColumns:function(d){this._destroyColumns();this.subRows=null;this.columns=d;this._updateColumns()},_setSubRows:function(d){this._destroyColumns();this.subRows=d;this._updateColumns()},setColumns:function(d){E.deprecated("setColumns(...)",'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",d)},setSubRows:function(d){E.deprecated("setSubRows(...)",'use set("subRows", ...) instead',"dgrid 0.4");this.set("subRows",d)},_updateColumns:function(){this.configStructure();
this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});q.appendIfNode=l;q.defaultRenderCell=k;return q})},"put-selector/put":function(){(function(E){var q,A=/[-+,> ]/;E([],q=function(w,m){function v(d){function c(){f&&a&&f!=a&&(a==d&&(g||(g=A.test(u)&&w.createDocumentFragment()))?g:a).insertBefore(f,e||null)}for(var g,b,e,a,f,h=arguments,p=h[0],B=0;B<h.length;B++){var u=
h[B];if("object"==typeof u){b=!1;if(u instanceof Array){f=w.createDocumentFragment();for(var t=0;t<u.length;t++)f.appendChild(v(u[t]));u=f}if(u.nodeType)f=u,c(),a=u,e=0;else for(t in u)f[t]=u[t]}else if(b)b=!1,f.appendChild(w.createTextNode(u));else{1>B&&(d=null);b=!0;if(p=u.replace(r,function(z,x,y,D,H,I){x&&(c(),"-"==x||"+"==x?(a=(e=f||a).parentNode,f=null,"+"==x&&(e=e.nextSibling)):("\x3c"==x?a=f=(f||a).parentNode:(","==x?a=d:f&&(a=f),f=null),e=0),f&&(a=f));if((z=!y&&D)||!f&&(y||H))"$"==z?(z=h[++B],
a.appendChild(w.createTextNode(z))):(z=z||v.defaultTag,(x=n&&h[B+1]&&h[B+1].name)&&(z="\x3c"+z+' name\x3d"'+x+'"\x3e'),f=k&&~(l=z.indexOf("|"))?w.createElementNS(k[z.slice(0,l)],z.slice(l+1)):w.createElement(z));if(y)if("$"==D&&(D=h[++B]),"#"==y)f.id=D;else if(x=(z=f.className)&&(" "+z+" ").replace(" "+D+" "," "),"."==y)f.className=z?(x+D).substring(1):D;else if("!"==u){var N;n?v("div",f,"\x3c").innerHTML="":(N=f.parentNode)&&N.removeChild(f)}else x=x.substring(1,x.length-1),x!=z&&(f.className=x);
H&&("$"==I&&(I=h[++B]),"style"==H?f.style.cssText=I:(y="!"==H.charAt(0)?(H=H.substring(1))&&"removeAttribute":"setAttribute",I=""===I?H:I,k&&~(l=H.indexOf("|"))?f[y+"NS"](k[H.slice(0,l)],H.slice(l+1),I):f[y](H,I)));return""}))throw new SyntaxError("Unexpected char "+p+" in "+u);c();a=p=f||a}}d&&g&&d.appendChild(g);return p}A=m||A;var r=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,l,k=!1;w=w||document;var n="object"==typeof w.createElement;v.addNamespace=
function(d,c){w.createElementNS?(k||(k={}))[d]=c:w.namespaces.add(d,c)};v.defaultTag="div";v.forDocument=q;return v})})(function(E,q,A){A=A||q;"function"===typeof define?define([],function(){return A()}):"undefined"==typeof window?require("./node-html")(module,A):put=A()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/query dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),
function(E,q,A,w,m,v,r,l,k,n){function d(t,z){return m("#"+r.escapeCssIdentifier(t),z)[0]}function c(t,z){n(document.body,t,".dgrid-scrollbar-measure");z=t["offset"+z]-t["client"+z];t.className="";t.parentNode&&document.body.removeChild(t);return z}function g(t){var z=t?"."+t.replace(B,"."):"";this._class&&(z="!"+this._class.replace(B,"!")+z);n(this.domNode,z);this._class=t}function b(){return this._class}function e(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function a(t){"undefined"!==
typeof t.x&&(this.bodyNode.scrollLeft=t.x);"undefined"!==typeof t.y&&(this.bodyNode.scrollTop=t.y)}k("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var f,h;v.add("dom-scrollbar-width",function(t,z,x){return c(x,"Width")});v.add("dom-scrollbar-height",function(t,z,x){return c(x,"Height")});v.add("dom-rtl-scrollbar-left",function(t,z,x){t=n("div");n(document.body,x,".dgrid-scrollbar-measure[dir\x3drtl]");n(x,t);z=!!v("ie")||!!v("trident")||t.offsetLeft>=v("dom-scrollbar-width");
x.className="";x.parentNode&&document.body.removeChild(x);n(t,"!");x.removeAttribute("dir");return z});var p=0,B=/ +/g,u=7>v("ie")&&!v("quirks")?function(){if(this._started){var t=document.documentElement;var z=t.clientWidth;t=t.clientHeight;var x=this._prevWinDims||[];if(x[0]!==z||x[1]!==t)this.resize(),this._prevWinDims=[z,t]}}:function(){this._started&&this.resize()};return q("dgrid.List",v("touch")?l:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,
addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,postscript:function(t,z){var x=this;(this._Row=function(y,D,H){this.id=y;this.data=D;this.element=H}).prototype.remove=function(){x.removeRow(this.element)};z&&(this.srcNodeRef=z=z.nodeType?z:d(z));this.create(t,z)},listType:"list",create:function(t,z){z=this.domNode=z||n("div");if(t){this.params=t;q.safeMixin(this,t);var x=t["class"]||t.className||z.className;this._sort=t.sort||[];delete this.sort}else this._sort=
[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=z.id=z.id||this.id||"dgrid_"+p++;null===this.useTouchScroll&&(this.useTouchScroll=!v("dom-scrollbar-width"));this.buildRendering();x&&g.call(this,x);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var t=this.domNode,z=this.addUiClasses,x=this;var y=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||
document.body.style.direction).toLowerCase();t.className="";n(t,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(z?".ui-widget":""));var D=this.headerNode=n(t,"div.dgrid-header.dgrid-header-row"+(z?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));(v("quirks")||8>v("ie"))&&n(t,"div.dgrid-spacer");var H=this.bodyNode=n(t,"div.dgrid-scroller");v("ff")&&(H.tabIndex=-1);this.headerScrollNode=n(t,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(z?".ui-widget-header":""));var I=
this.footerNode=n("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));n(t,I);y&&(t.className+=" dgrid-rtl"+(v("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));w(H,"scroll",function(N){x.showHeader&&(D.scrollLeft=N.scrollLeft||H.scrollLeft);N.stopPropagation();w.emit(t,"scroll",{scrollTarget:H})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=n(this.bodyNode,"div.dgrid-content"+(z?".ui-widget-content":""));this._listeners.push(this._resizeHandle=w(window,"resize",
r.throttleDelayed(u,this)))},postCreate:v("touch")?function(){this.useTouchScroll&&this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},resize:function(){var t=this.bodyNode,z=this.headerNode,x=this.footerNode,y=z.offsetHeight,D=this.showFooter?x.offsetHeight:0,H=v("quirks")||7>v("ie");this.headerScrollNode.style.height=t.style.marginTop=y+"px";t.style.marginBottom=
D+"px";H&&(t.style.height="",t.style.height=Math.max(this.domNode.offsetHeight-y-D,0)+"px",D&&(x.style.bottom="1px",setTimeout(function(){x.style.bottom=""},0)));f||(f=v("dom-scrollbar-width"),h=v("dom-scrollbar-height"),v("ie")&&(f++,h++),r.addCssRule(".dgrid-scrollbar-width","width: "+f+"px"),r.addCssRule(".dgrid-scrollbar-height","height: "+h+"px"),17==f||H||(r.addCssRule(".dgrid-header-row","right: "+f+"px"),r.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+f+"px")));H&&(z.style.width=
t.clientWidth+"px",setTimeout(function(){z.scrollLeft=t.scrollLeft},0))},addCssRule:function(t,z){t=r.addCssRule(t,z);this.cleanAddedRules&&this._listeners.push(t);return t},on:function(t,z){t=w(this.domNode,t,z);v("dom-addeventlistener")||this._listeners.push(t);return t},cleanup:function(){var t=this.observers,z;for(z in this._rowIdToObject)if(this._rowIdToObject[z]!=this.columns){var x=d(z,this.domNode);x&&this.removeRow(x,!0)}for(z=0;z<t.length;z++)(x=t[z])&&x.cancel();this.observers=[];this._numObservers=
0;this.preload=null},destroy:function(){if(this._listeners){for(var t=this._listeners.length;t--;)this._listeners[t].remove();delete this._listeners}this._started=!1;this.cleanup();n(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},newRow:function(t,z,x,y,D){if(z){var H=this.insertRow(t,z,x,y,D);n(H,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":
""));setTimeout(function(){n(H,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return H}},adjustRowIndices:function(t){var z=t.rowIndex;if(-1<z){do-1<t.rowIndex&&(this.maintainOddEven&&-1<(t.className+" ").indexOf("dgrid-row ")&&n(t,"."+(1==z%2?"dgrid-row-odd":"dgrid-row-even")+"!"+(0==z%2?"dgrid-row-odd":"dgrid-row-even")),t.rowIndex=z++);while((t=t.nextSibling)&&t.rowIndex!=z)}},renderArray:function(t,z,x){function y(){var xa=arguments;if(-1<J)for(var ua=0;ua<xa.length;ua++){var na=
xa[ua],va=ia[na?0:ia.length-1];if(va=va&&D(va)){var ra=va[na?"previousSibling":"nextSibling"];ra&&(ra=N.row(ra));ra&&ra.element!=va&&(na=na?"unshift":"push",t[na](ra.data),ia[na](ra.element),x.count++)}}}function D(xa){return!A.isDescendant(xa,N.domNode)&&d(xa.id)?N.row(xa.id.slice(N.id.length+5)).element:xa}function H(xa){W=N.insertRow(xa,R,null,S++,x);W.observerIndex=J;return W}function I(xa){X=xa.slice(0);(Q=z?z.parentNode:N.contentNode)&&Q.parentNode&&(Q!==N.contentNode||xa.length)?(Q.insertBefore(R,
z||null),(W=xa[xa.length-1])&&N.adjustRowIndices(W)):M[J]&&N.cleanEmptyObservers&&N._onEmptyRender(J);ia=xa;da&&(da.rows=ia)}x=x||{};var N=this,S=x.start||0,M=this.observers,Q;z||(this._lastCollection=t);if(t.observe&&this.shouldObserveStore){N._numObservers++;var da=t.observe(function(xa,ua,na){var va;if(-1<ua&&ia[ua]){var ra=ia.splice(ua,1)[0];ra.parentNode==Q&&((va=ra.nextSibling)&&ua!=na&&va.rowIndex--,N.removeRow(ra));x.count--;N._processScroll&&N._processScroll()}if(-1<na){if(ia.length)if(0===
na)var wa=(wa=ia[na])&&D(wa);else{if(wa=ia[na-1])wa=D(wa),wa=(wa.connected||wa).nextSibling}else wa=N._getFirstRowSibling&&N._getFirstRowSibling(Q);ra&&wa&&ra.id===wa.id&&(wa=(wa.connected||wa).nextSibling);wa&&!wa.parentNode&&(wa=d(wa.id));ra=z&&z.parentNode||wa&&wa.parentNode||N.contentNode;if(ra=N.newRow(xa,ra,wa,x.start+na,x))if(ra.observerIndex=J,ia.splice(na,0,ra),!va||na<ua)va=(va=ra.previousSibling)&&va.rowIndex+1!=ra.rowIndex&&0!=ra.rowIndex?va:ra;x.count++}0===ua?y(1,1):ua===t.length-(-1===
na?0:1)&&y(0,0);ua!=na&&va&&N.adjustRowIndices(va);N._onNotification(ia,xa,ua,na)},!0);var J=M.push(da)-1}var R=document.createDocumentFragment(),W,X;if(t.map){var ia=t.map(H,console.error);if(ia.then)return t.then(function(xa){t=xa;return ia.then(function(ua){I(ua);y(1,1,0,0);return X})})}else{ia=[];for(var ma=0,ha=t.length;ma<ha;ma++)ia[ma]=H(t[ma])}I(ia);y(1,1,0,0);return X},_onEmptyRender:function(t){"undefined"!==typeof t&&(this.observers[t].cancel(),this.observers[t]=0,this._numObservers--)},
_onNotification:function(t,z,x,y){},renderHeader:function(){},_autoId:0,insertRow:function(t,z,x,y,D){var H=D.parentId;H=this.id+"-row-"+(H?H+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(t):this._autoId++);var I=d(H,this.domNode),N=I&&I.previousSibling;I&&(I===x&&(x=(x.connected||x).nextSibling),this.removeRow(I));I=this.renderRow(t,D);I.className=(I.className||"")+" dgrid-row "+(1==y%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[I.id=
H]=t;z.insertBefore(I,x||null);N&&this.adjustRowIndices(N);I.rowIndex=y;return I},renderRow:function(t,z){return n("div",""+t)},removeRow:function(t,z){t=t.element||t;delete this._rowIdToObject[t.id];z||n(t,"!")},row:function(t){var z;if(t instanceof this._Row)return t;t.target&&t.target.nodeType&&(t=t.target);if(t.nodeType){do{var x=t.id;if(z=this._rowIdToObject[x])return new this._Row(x.substring(this.id.length+5),z,t);t=t.parentNode}while(t&&t!=this.domNode)}else return"object"==typeof t?z=this.store.getIdentity(t):
(z=t,t=this._rowIdToObject[this.id+"-row-"+z]),new this._Row(z,t,d(this.id+"-row-"+z,this.domNode))},cell:function(t){return{row:this.row(t)}},_move:function(t,z,x,y){var D;var H=D=t.element;z=z||1;do if(t=D[0>z?"previousSibling":"nextSibling"]){do if((D=t)&&-1<(D.className+" ").indexOf(x+" ")){H=D;z+=0>z?1:-1;break}while(t=(!y||!D.hidden)&&D[0>z?"lastChild":"firstChild"])}else if(D=D.parentNode,!D||D===this.bodyNode||D===this.headerNode)break;while(z);return H},up:function(t,z,x){t.element||(t=this.row(t));
return this.row(this._move(t,-(z||1),"dgrid-row",x))},down:function(t,z,x){t.element||(t=this.row(t));return this.row(this._move(t,z||1,"dgrid-row",x))},scrollTo:v("touch")?function(t){return this.useTouchScroll?this.inherited(arguments):a.call(this,t)}:a,getScrollPosition:v("touch")?function(){return this.useTouchScroll?this.inherited(arguments):e.call(this)}:e,get:function(t){var z="_get"+t.charAt(0).toUpperCase()+t.slice(1);return"function"===typeof this[z]?this[z].apply(this,[].slice.call(arguments,
1)):this[t]},set:function(t,z){if("object"===typeof t)for(var x in t)this.set(x,t[x]);else x="_set"+t.charAt(0).toUpperCase()+t.slice(1),"function"===typeof this[x]?this[x].apply(this,[].slice.call(arguments,1)):this[t]=z;return this},_getClass:b,_setClass:g,_getClassName:b,_setClassName:g,_setSort:function(t,z){this._sort="string"!=typeof t?t:[{attribute:t,descending:z}];this.refresh();this._lastCollection&&(t.length&&("string"!=typeof t&&(z=t[0].descending,t=t[0].attribute),this._lastCollection.sort(function(x,
y){x=x[t];y=y[t];void 0===x&&(x="");void 0===y&&(y="");return x==y?0:x>y==!z?1:-1})),this.renderArray(this._lastCollection))},sort:function(t,z){E.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",t,z)},_getSort:function(){return this._sort},_setShowHeader:function(t){var z=this.headerNode;this.showHeader=t;n(z,(t?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();t&&(z.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(t){E.deprecated("setShowHeader(...)",
'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",t)},_setShowFooter:function(t){this.showFooter=t;n(this.footerNode,(t?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has"],function(E){E.add("dom-contains",function(n,d,c){return!!c.contains});var q=[],A,w,m,v=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,r=setTimeout,l=clearTimeout;E.add("requestidlecallback",function(n){return"function"===typeof n.requestIdleCallback});var k={defaultDelay:15,
throttle:function(n,d,c){var g=!1;c=c||k.defaultDelay;return function(){g||(g=!0,n.apply(d,arguments),r(function(){g=!1},c))}},throttleDelayed:function(n,d,c){var g=!1;c=c||k.defaultDelay;return function(){if(!g){g=!0;var b=arguments;r(function(){g=!1;n.apply(d,b)},c)}}},debounce:function(n,d,c){var g;c=c||k.defaultDelay;return function(){g&&(l(g),g=null);var b=arguments;g=r(function(){g=null;n.apply(d,b)},c)}},each:function(n,d,c){var g;if(n)if("number"===typeof n.length){var b=0;for(g=n.length;b<
g;b++)d.call(c,n[b],b,n)}else for(b in n)d.call(c,n[b],b,n)},contains:function(n,d){return E("dom-contains")?n.contains(d):n.compareDocumentPosition(d)&8},addCssRule:function(n,d){A||(A=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(A),A=A.sheet||A.styleSheet,w=A.deleteRule?"deleteRule":"removeRule",m=A.cssRules?"cssRules":"rules");var c=q.length;q[c]=(A.cssRules||A.rules).length;A.addRule?A.addRule(n,d):A.insertRule(n+"{"+d+"}",q[c]);return{get:function(g){return A[m][q[c]].style[g]},
set:function(g,b){"undefined"!==typeof q[c]&&(A[m][q[c]].style[g]=b)},remove:function(){var g=q[c],b;if(void 0!==g){A[w](g);q[c]=void 0;var e=c+1;for(b=q.length;e<b;e++)q[e]>g&&q[e]--}}}},escapeCssIdentifier:function(n,d){return"string"===typeof n?n.replace(v,d||"\\$1"):n}};return k})},"xstyle/has-class":function(){define(["dojo/has"],function(E){var q={};return function(){for(var A,w=arguments,m=0;m<w.length;m++)if(A=w[m],!q[A]){q[A]=!0;var v=A.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),r=E(v[2]),
l=-v[4];(0<l?l<=r&&(-v[5]||l)>=r:!!r)==!v[1]&&(document.documentElement.className+=" has-"+A)}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(E,q,A,w,m,v,r,l,k){return A("dgrid.OnDemandList",[E,q],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:l.defaultDelay,keepScrollPosition:!1,
rowHeight:22,postCreate:function(){this.inherited(arguments);var n=this;r(this.bodyNode,"scroll",l[this.pagingMethod](function(d){n._processScroll(d)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(n,d){function c(u){k(B,"!");if(u)throw g._refreshDeferred&&(g._refreshDeferred.reject(u),delete g._refreshDeferred),u;}var g=this,b=d&&d.container||this.contentNode,e={query:n,count:0,options:d},a,f=this.preload,
h,p={node:k(b,"div.dgrid-preload",{rowIndex:0}),count:0,query:n,next:e,options:d};p.node.style.height="0";e.node=a=k(b,"div.dgrid-preload");e.previous=p;a.rowIndex=this.minRowsPerPage;f?((e.next=f.next)&&a.offsetTop>=f.node.offsetTop?e.previous=f:(e.next=f,e.previous=f.previous),e.previous.next=e,e.next.previous=e):this.preload=e;var B=k(a,"-div.dgrid-loading");k(B,"div.dgrid-below").innerHTML=this.loadingMessage;d=w.mixin(this.get("queryOptions"),d,{start:0,count:this.minRowsPerPage},"level"in n?
{queryLevel:n.level}:null);this._trackError(function(){return h=n(d)});if("undefined"===typeof h)c();else return m.when(g.renderArray(h,a,d),function(u){return m.when("undefined"===typeof h.total?h.length:h.total,function(t){var z=u.length,x=a.parentNode,y=g.noDataNode;k(B,"!");"queryLevel"in d||(g._total=t);0===t&&x&&(y&&(k(y,"!"),delete g.noDataNode),g.noDataNode=y=k("div.dgrid-no-data"),x.insertBefore(y,g._getFirstRowSibling(x)),y.innerHTML=g.noDataMessage);for(var D=y=0;D<z;D++)y+=g._calcRowHeight(u[D]);
z&&y&&(g.rowHeight=y/z);y=g.rowHeight*g.bufferRows;y>g.farOffRemoval&&(g.farOffRemoval=y);t-=z;e.count=t;a.rowIndex=z;t?a.style.height=Math.min(t*g.rowHeight,g.maxEmptySpace)+"px":(a.style.display="none",d.count++);g._previousScrollPosition&&x&&x.offsetHeight&&(g.scrollTo(g._previousScrollPosition),delete g._previousScrollPosition);g._processScroll();g._refreshDeferred&&(g._refreshDeferred.resolve(h),delete g._refreshDeferred);return u},c)},c),h},refresh:function(n){var d=this,c=n&&n.keepScrollPosition;
"undefined"===typeof c&&(c=this.keepScrollPosition);c&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store){c=this._refreshDeferred=new m;var g=d.renderQuery(function(b){return d.store.query(d.query,b)});"undefined"===typeof g&&c.reject();return c.then(function(b){d._refreshTimeout=setTimeout(function(){r.emit(d.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:d,results:b});d._refreshTimeout=null},0);delete d._refreshDeferred;return b},function(b){delete d._refreshDeferred;
throw b;})}},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(n){return n.lastChild},_calcRowHeight:function(n){var d=n.nextSibling;return d&&!/\bdgrid-preload\b/.test(d.className)?d.offsetTop-n.offsetTop:n.offsetHeight},lastScrollTop:0,_processScroll:function(n){function d(R,W,X,ia){var ma=b.farOffRemoval,ha=R.node;if(W>2*ma){for(var xa,ua=ha[X],na=0,va=0,ra=[];xa=ua;){var wa=b._calcRowHeight(xa);if(na+wa+ma>W||0>ua.className.indexOf("dgrid-row")&&0>
ua.className.indexOf("dgrid-loading"))break;ua=xa[X];na+=wa;va+=xa.count||1;b.removeRow(xa,!0);ra.push(xa)}R.count+=va;ia?(ha.rowIndex-=va,c(R)):ha.style.height=ha.offsetHeight+na+"px";var Z=k("div",ra);setTimeout(function(){k(Z,"!")},1)}}function c(R,W){R.node.style.height=Math.min(R.count*b.rowHeight,W?Infinity:b.maxEmptySpace)+"px"}function g(R,W){do R=W?R.next:R.previous;while(R&&!R.node.offsetWidth);return R}var b=this,e=b.bodyNode;n=n&&n.scrollTop||this.getScrollPosition().y;e=e.offsetHeight+
n;var a=b.preload,f=b.lastScrollTop,h=b.bufferRows*b.rowHeight,p=h-b.rowHeight,B,u,t,z=!0;for(b.lastScrollTop=n;a&&!a.node.offsetWidth;)a=a.previous;for(;a&&a!=x;){var x=b.preload;b.preload=a;var y=a.node;var D=y.offsetTop;if(e+1+p<D)a=g(a,z=!1);else if(n-1-p>D+y.offsetHeight)a=g(a,z=!0);else{var H=((y.rowIndex?n-h:e)-D)/b.rowHeight;D=(e-n+2*h)/b.rowHeight;D+=Math.min(Math.abs(Math.max(Math.min((n-f)*b.rowHeight,b.maxRowsPerPage/2),b.maxRowsPerPage/-2)),10);0==y.rowIndex&&(H-=D);H=Math.max(H,0);10>
H&&0<H&&D+H<b.maxRowsPerPage&&(D+=Math.max(0,H),H=0);D=Math.min(Math.max(D,b.minRowsPerPage),b.maxRowsPerPage,a.count);if(0==D)a=g(a,z);else{D=Math.ceil(D);H=Math.min(Math.floor(H),a.count-D);var I=w.mixin(b.get("queryOptions"),a.options);a.count-=D;var N=y,S=b.queryRowsOverlap,M=(0<y.rowIndex||y.offsetTop>n)&&a;if(M){var Q=a.previous;Q&&(d(Q,n-(Q.node.offsetTop+Q.node.offsetHeight),"nextSibling"),0<H&&Q.node==y.previousSibling?(H=Math.min(a.count,H),a.previous.count+=H,c(a.previous,!0),y.rowIndex+=
H,S=0):D+=H,a.count-=H);I.start=y.rowIndex-S;I.count=Math.min(D+S,b.maxRowsPerPage);y.rowIndex=I.start+I.count}else{if(a.next)if(d(a.next,a.next.node.offsetTop-e,"previousSibling",!0),N=y.nextSibling,N==a.next.node)a.next.count+=a.count-H,a.next.node.rowIndex=H+D,c(a.next),a.count=H,S=0;else var da=!0;I.start=a.count;I.count=Math.min(D+S,b.maxRowsPerPage)}da&&N&&N.offsetWidth&&(da=N.offsetTop);c(a);"level"in a.query&&(I.queryLevel=a.query.level);if("queryLevel"in I||!(I.start>b._total||0>I.count)){y=
k(N,"-div.dgrid-loading[style\x3dheight:"+D*b.rowHeight+"px]");k(y,"div.dgrid-"+(M?"below":"above")).innerHTML=b.loadingMessage;y.count=D;var J=a.query(I);if(void 0===b._trackError(function(){return J})){k(y,"!");return}(function(R,W,X,ia){t=m.when(b.renderArray(ia,R,I),function(ma){u=ia;N=R.nextSibling;k(R,"!");if(X&&N&&N.offsetWidth){var ha=b.getScrollPosition();b.scrollTo({x:ha.x,y:ha.y+N.offsetTop-X,preserveMomentum:!0})}m.when(ia.total||ia.length,function(xa){"queryLevel"in I||(b._total=xa);
W&&(W.count=xa-W.node.rowIndex,0===W.count&&I.count++,c(W))});b._processScroll();return ma},function(ma){k(R,"!");throw ma;})}).call(this,y,M,da,J);a=a.previous}}}}t&&(B=this._refreshDeferred)&&(delete this._refreshDeferred,m.when(t,function(){B.resolve(u)}))},removeRow:function(n,d){if(n){var c=n.previousSibling,g=n.nextSibling,b;if(b=c)b=c.observerIndex,b=null!=b?b:c.previousObserverIndex;c=b;if(b=g)b=g.observerIndex,b=null!=b?b:g.nextObserverIndex;g=n.observerIndex;n.observerIndex=void 0;d&&(n.nextObserverIndex=
b,n.previousObserverIndex=c);if(this.cleanEmptyObservers&&-1<g&&g!==c&&g!==b&&(c=this.observers,b=c[g])){if(!d)for(var e=b.rows,a=0;a<e.length;a++)if(e[a]!=n&&v.isDescendant(e[a],this.domNode))return this.inherited(arguments);b.cancel();this._numObservers--;c[g]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),function(E,q,A,w,m,v,r){function l(n){return n}
function k(n){if("object"!==typeof n)n=Error(n);else if("cancel"===n.dojoType)return;n.grid=this;m.emit(this.domNode,"dgrid-error",{grid:this,error:n,cancelable:!0,bubbles:!0})&&console.error(n)}return q("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};v.before(this,"configStructure",A.hitch(this,function(){this._columnsWithSet=
{}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(n){n.set&&(this._columnsWithSet[n.field]=n);this.inherited(arguments)},_updateNotifyHandle:function(n){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);n&&"function"===typeof n.notify&&this.shouldObserveStore&&(this._notifyHandle=v.after(n,"notify",A.hitch(this,
"_onNotify"),!0),(n=this.get("sort"))&&n.length||console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},_setStore:function(n,d,c){this._updateNotifyHandle(n);this.store=n;this.dirty={};this.set("query",d,c)},_setQuery:function(n,d){var c=d&&d.sort;this.query=void 0!==n?n:this.query;this.queryOptions=d||this.queryOptions;this._started&&(c?this.set("sort",c):this.refresh())},
setStore:function(n,d,c){E.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",n,d,c)},setQuery:function(n,d){E.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",n,d)},_getQueryOptions:function(){var n=A.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)n.sort=this._sort;return n},_getQuery:function(){var n=this.query;return"object"==typeof n&&null!=n?A.delegate(n,{}):n},_setSort:function(n,
d){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(n,d){this.inherited(arguments);n&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var n=this.inherited(arguments);this.store||(this.noDataNode=r(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return n},renderArray:function(){var n=this,d=this.inherited(arguments);this.store||w.when(d,function(c){c.length&&n.noDataNode&&r(n.noDataNode,"!")});
return d},_onEmptyRender:function(){},insertRow:function(n,d,c,g,b){var e=this.store,a=this.dirty;e=e&&e.getIdentity(n);var f;e in a&&!(e in this._updating)&&(f=a[e]);f&&(n=A.delegate(n,f));return this.inherited(arguments)},updateDirty:function(n,d,c){var g=this.dirty,b=g[n];b||(b=g[n]={});b[d]=c},setDirty:function(n,d,c){E.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(n,d,c)},save:function(){function n(p,B){return function(u){var t=d._columnsWithSet,z=d._updating,
x;if("function"===typeof u.set)u.set(B);else for(x in B)u[x]=B[x];for(x in t){var y=t[x].set(u);void 0!==y&&(u[x]=y)}z[p]=!0;return w.when(c.put(u),function(){delete g[p];delete z[p]})}}var d=this,c=this.store,g=this.dirty,b=new w,e=b.promise,a=function(p){var B;return d.getBeforePut||!(B=d.row(p).data)?function(){return c.get(p)}:function(){return B}},f;for(f in g){var h=n(f,g[f]);e=e.then(a(f)).then(h)}b.resolve();return e},revert:function(){this.dirty={};this.refresh()},_trackError:function(n){"string"==
typeof n&&(n=A.hitch(this,n));try{var d=n()}catch(c){k.call(this,c)}return w.when(d,l,A.hitch(this,k))},newRow:function(){var n=this.inherited(arguments);this.noDataNode&&(r(this.noDataNode,"!"),delete this.noDataNode);return n},removeRow:function(n,d){var c={element:n};!d&&this.noDataMessage&&this.up(c).element===n&&this.down(c).element===n&&(this.noDataNode=r(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/mouse dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),
function(E,q,A,w,m,v,r,l,k,n){function d(h,p){p=h.unselectable=p?"on":"";h=h.getElementsByTagName("*");for(var B=h.length;--B;)"INPUT"!==h[B].tagName&&"TEXTAREA"!==h[B].tagName&&(h[B].unselectable=p)}function c(h,p){var B=h.bodyNode,u=p?"text":21>m("ff")?"-moz-none":"none";b&&"msUserSelect"!==b?B.style[b]=u:m("dom-selectstart")?p||h._selectstartHandle?p&&h._selectstartHandle&&(h._selectstartHandle.remove(),delete h._selectstartHandle):h._selectstartHandle=w(B,"selectstart",function(t){var z=t.target&&
t.target.tagName;"INPUT"!==z&&"TEXTAREA"!==z&&t.preventDefault()}):(d(B,!p),p||h._unselectableHandle)?p&&h._unselectableHandle&&(h._unselectableHandle.remove(),delete h._unselectableHandle):h._unselectableHandle=r.after(h,"renderRow",function(t){d(t,!0);return t})}m.add("dom-comparedocumentposition",function(h,p,B){return!!B.compareDocumentPosition});m.add("pointer",function(h){return"PointerEvent"in h?"pointer":"MSPointerEvent"in h?"MSPointer":!1});m.add("css-user-select",function(h,p,B){h=B.style;
p=["Khtml","O","ms","Moz","Webkit"];B=p.length;var u="userSelect";do if("undefined"!==typeof h[u])return u;while(B--&&(u=p[B]+"UserSelect"));return!1});m.add("dom-selectstart","undefined"!==typeof document.onselectstart);var g=m("mac")?"metaKey":"ctrlKey",b=m("css-user-select"),e=(l=m("pointer"))&&"MS"===l.slice(0,2),a=l?l+(e?"Down":"down"):"mousedown",f=l?l+(e?"Up":"up"):"mouseup";"WebkitUserSelect"===b&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(b=!1);return q("dgrid.Selection",
null,{selectionDelegate:".dgrid-row",selectionEvents:a+","+f+",dgrid-cellfocusin",selectionTouchEvents:m("touch")?k.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var h=this.selectionMode;this.selectionMode="";this._setSelectionMode(h)},destroy:function(){this.inherited(arguments);
this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(h){h!=this.selectionMode&&(this.clearSelection(),this.selectionMode=h,this._selectionHandlerName="_"+h+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(h){E.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");
this.set("selectionMode",h)},_setAllowTextSelection:function(h){"undefined"!==typeof h?c(this,h):c(this,"none"===this.selectionMode);this.allowTextSelection=h},_handleSelect:function(h,p){if(!v.isRight(h)&&this[this._selectionHandlerName]&&this.allowSelect(this.row(p))&&("dgrid-cellfocusin"!==h.type||"mousedown"!==h.parentType)&&(h.type!==f||p==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=h;if(!h.keyCode||!h.ctrlKey||32==h.keyCode)if(!h.shiftKey&&h.type===a&&this.isSelected(p))this._waitForMouseUp=
p;else this[this._selectionHandlerName](h,p);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(h,p){h=h.keyCode?h.ctrlKey:h[g];this._lastSelected===p?this.select(p,null,!h||!this.isSelected(p)):(this.clearSelection(),this.select(p),this._lastSelected=p)},_multipleSelectionHandler:function(h,p){var B=this._lastSelected,u=h.keyCode?h.ctrlKey:h[g];if(!h.shiftKey){var t=u?null:!0;B=null}this.select(p,B,t);B||(this._lastSelected=p)},_extendedSelectionHandler:function(h,p){if(h[g]||!this.isSelected(p)||
1!==this.getSelectedCount())(2===h.button?this.isSelected(p):h.keyCode?h.ctrlKey:h[g])||this.clearSelection(null,!0),this._multipleSelectionHandler(h,p)},_toggleSelectionHandler:function(h,p){this.select(p,null,null)},_initSelectionEvents:function(){var h=this,p=this.contentNode,B=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};m("touch")&&!m("pointer")&&this.selectionTouchEvents?(w(p,k.selector(B,this.selectionTouchEvents),function(u){h._handleSelect(u,this);h._ignoreMouseSelect=
this}),w(p,w.selector(B,this.selectionEvents),function(u){h._ignoreMouseSelect!==this?h._handleSelect(u,this):u.type===f&&(h._ignoreMouseSelect=null)})):w(p,w.selector(B,this.selectionEvents),function(u){h._handleSelect(u,this)});this.addKeyHandler&&this.addKeyHandler(32,function(u){h._handleSelect(u,u.target)});if(this.allowSelectAll)this.on("keydown",function(u){u[g]&&65==u.keyCode&&!/\bdgrid-input\b/.test(u.target.className)&&(u.preventDefault(),h[h.allSelected?"clearSelection":"selectAll"]())});
this._setStore&&r.after(this,"_setStore",function(){h._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function h(z,x,y){z=x||z&&z[p.idProperty||"id"];if(null!=z&&(x=(z=p.row(z))&&p.selection[z.id]))p[y](z,null,x)}var p=this,B=this.store;this._removeDeselectSignals&&this._removeDeselectSignals();if(B&&B.notify){var u=r.before(B,"notify",function(z,x){z||h(z,x,"deselect")});var t=r.after(B,"notify",function(z,x){h(z,x,"select")},!0);this._removeDeselectSignals=
function(){u.remove();t.remove()}}else u=r.before(this,"removeRow",function(z,x){x||(z=this.row(z))&&z.id in this.selection&&this.deselect(z)}),this._removeDeselectSignals=function(){u.remove()}},allowSelect:function(h){return!0},_fireSelectionEvent:function(h){var p=this._selectionEventQueues[h],B=this._selectionTriggerEvent;var u={bubbles:!0,grid:this};B&&(u.parentType=B.type);u[this._selectionTargetType]=p;this._selectionEventQueues[h]=[];w.emit(this.contentNode,"dgrid-"+h,u)},_fireSelectionEvents:function(){var h=
this._selectionEventQueues,p;for(p in h)h[p].length&&this._fireSelectionEvent(p)},_select:function(h,p,B){"undefined"===typeof B&&(B=!0);h.element||(h=this.row(h));if(!1===B||this.allowSelect(h)){var u=this.selection;var t=!!u[h.id];null===B&&(B=!t);var z=h.element;B||this.allSelected?u[h.id]=B:delete this.selection[h.id];z&&(B?n(z,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):n(z,"!dgrid-selected!ui-state-active"));B!==t&&z&&this._selectionEventQueues[(B?"":"de")+"select"].push(h);
if(p)if(p.element||(p=this.row(p)),p){if(p=p.element)for(u=this._determineSelectionDirection(z,p),u||(p=document.getElementById(p.id),u=this._determineSelectionDirection(z,p));h.element!=p&&(h=this[u](h));)this._select(h,null,B)}else this._lastSelected=z,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")}},
_determineSelectionDirection:m("dom-comparedocumentposition")?function(h,p){h=p.compareDocumentPosition(h);return h&1?!1:2===h?"down":"up"}:function(h,p){return 1>p.sourceIndex?!1:p.sourceIndex>h.sourceIndex?"down":"up"},select:function(h,p,B){this._select(h,p,B);this._fireSelectionEvents()},deselect:function(h,p){this.select(h,p,!1)},clearSelection:function(h,p){this.allSelected=!1;for(var B in this.selection)h!==B&&this._select(B,null,!1);p||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var h in this._rowIdToObject){var p=this.row(this._rowIdToObject[h]);this._select(p.id,null,!0)}this._fireSelectionEvents()},getSelectedCount:function(){var h=0,p;for(p in this.selection)p&&(h+=1);return h},isSelected:function(h){if("undefined"===typeof h||null===h)return!1;h.element||(h=this.row(h));return h.id in this.selection?!!this.selection[h.id]:this.allSelected&&(!h.data||this.allowSelect(h))},refresh:function(){this.deselectOnRefresh&&
this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var h=this,p=this.inherited(arguments);A.when(p,function(B){var u=h.selection,t,z;for(t=0;t<B.length;t++){var x=h.row(B[t]);(z=x.id in u?u[x.id]:h.allSelected)&&h._select(x,null,z)}h._fireSelectionEvents()});return p}})})},"xstyle/main":function(){define("xstyle/main",["require","xstyle/core/parser","xstyle/core/base","xstyle/core/elemental","xstyle/core/generate"],function(E,q,A,w,m){function v(n){n=
document.getElementsByTagName(n);for(var d=0;d<n.length;d++)l(n[d])}function r(){v("link");v("style")}function l(n,d,c){function g(){E(["xstyle/core/load-imports"],function(B){B(n,function(){l(n,d,!0)})})}function b(B){for(var u=B.cssRules,t=0;t<u.length;t++){var z=u[t];if(z.selectorText&&"x-"==z.selectorText.substring(0,2)&&(a=!0,/^'/.test(z.style.content)))return k(eval(z.style.content),B,d),!0}}var e=n.sheet||n.styleSheet;if(e&&(!e.processed||c)){e.processed=!0;var a=e.needsParsing,f=e.rules||
e.cssRules;if((e.href||e.imports&&e.imports.length)&&!c)return g();if(!a)for(var h=0;h<f.length;h++){var p=f[h];if(p.href&&!c){if(!b(p.styleSheet))return g();return}}k(e.localSource||(e.ownerNode||e.owningElement).innerHTML,e,d)}}function k(n,d,c){d.addRule||(d.addRule=function(b,e,a){return this.insertRule(b+"{"+e+"}",0<=a?a:this.cssRules.length)});d.deleteRule||(d.deleteRule=d.removeRule);var g=1;(d.href||location.href).replace(/[^\/]+$/,"");A.css=n;q(A,n,d);0==--g&&c&&c(d);return A}w.ready(r);
q.getStyleSheet=function(n,d){return n.styleSheet||n};return{process:l,processAll:r,parse:k,generate:m,update:w.update,load:function(n,d,c,g){d(["xstyle/css"],function(b){b.load(n,d,function(e){e?l({sheet:e},c):(r(),c())},g)})}}})},"xstyle/core/parser":function(){define("xstyle/core/parser",[],function(){function E(){this.push.apply(this,arguments)}function q(c){this.value=c}function A(){var c=this.args[0];if("string"==typeof c)var g=c.split(/\s*,\s*/);else if(c){g=[];for(var b=0,e=0;e<c.length+1;e++){var a=
c[e];if("string"==typeof a||void 0===a)if(a=a&&a.split(/\s*,\s*/),1<g.length||void 0===a){var f=c.slice(b,e);0<b&&f.unshift(g.pop());b=e+1;g.push(f);a&&g.push.apply(g,a.slice(1))}}}else return[];return g}function w(c,g,b){function e(p,B){function u(S){y=!1;var M=f.lastIndex;S.then(function(){y=!0;Q&&(f.lastIndex=M,t())});var Q=!0}function t(){function S(Da){Da&&"string"==typeof Da&&da&&(Da=da+Da);ha?ha.push?"string"==typeof ha[ha.length-1]&&"string"==typeof Da?ha[ha.length-1]+=Da:Da&&ha.push(Da):
"string"==typeof ha&&"string"==typeof Da?ha+=Da:ha=new E(ha,Da):ha=Da}for(y=!0;y;){var M=f.exec(p);if(!M)break;var Q=M[5],da=M[1],J=M[2],R=M[3],W=M[4];W=W&&n(W);J=J&&n(J);if(N){if(R){var X=J;var ia=R.charAt(0);var ma="?"==R.charAt(1);-1<R.indexOf("\n")&&(W=R.slice(1))}else W=J;var ha=W;N=!1}else W=R?J+R:J,S(W);"{"!=Q&&(I+=M[0]);switch(Q){case "'":case '"':var xa="'"==Q?m:v;xa.lastIndex=f.lastIndex;(Q=xa.exec(p))||z("unterminated string");J=Q[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(Da,
Ca){if(Ca)return String.fromCharCode(parseInt(Ca,16))});f.lastIndex=xa.lastIndex;S(new q(J));I+=Q[0];continue;case "\\":Q=xa.lastIndex++;S(p.charAt(Q));continue;case "(":case "{":case "[":if("{"==Q){N=!0;":"==ia&&R&&(J+=R);J&&da&&(J=da+J);I=n((I+J).replace(/\s+/g," "));S(R=x.newRule(I));"\x3d"==ia&&(H=!1,ha.creating=!0);var ua=null,na=D;M[6]&&(W=B.cssRules||B.rules,R.cssRule=ua=W[M[6].slice(1)])&&(I=ua.selectorText);if(x.root&&H)for(W=B.cssRules||B.rules;ua=W[D++];)if(ua.selectorText==I||ua.selectorText&&
ua.selectorText.replace(/::/g,":").replace(/'/g,'"')==I.replace(/::/g,":").replace(/'/g,'"')){R.cssRule=ua;break}ua||(R.ruleIndex=D=na);R.styleSheet=B;ha.creating?(R.selector="."+("\x3d"==ia?J.match(/[\w-]*$/g,"")[0]:"")+"-x-"+k++,R.creating=!0):/^@(?!font-face)(?!FONT-FACE)/.test(I)?R.setMediaSelector(I):R.selector=x.root?I:x.selector+" "+I;I=""}else J=W.match(/(.*?)([\w-]*)$/),S(R=x.newCall(J[2],ha,x)),R.ref=x.getDefinition(J[2]),R.getArgs=A,(ha.calls||(ha.calls=[])).push(R);x.currentName=X;x.currentSequence=
ha;x.assignmentOperator=ia;var va;"{"==Q&&(va=R.selector.match(/[@:]\w+/))&&(va=va[0],(X=x.getDefinition(va))&&X.selector&&X.selector(R));h.push(x=R);x.operator=Q;x.start=f.lastIndex;ha=X=null;continue}if(ha)if(J="string"==typeof ha?ha:ha[0],J.charAt&&"@"==J.charAt(0))if(M=J.match(/\w+/)[0],"import"==M)J=w.getStyleSheet((B.cssRules||B.imports)[D++],ha,B),M=f.lastIndex,e(J.localSource,J),f.lastIndex=M;else{if("xstyle"==M){if("start"==J.slice(8,13))R=x?x.newRule(""):ra,R.root=x.root,h.push(x=R);else{var ra=
x||ra;h.pop();x=h[h.length-1]}f=x?a:/(@[\w\s])/g}}else if("\x3d"===ia)try{var wa=x.declareDefinition(X,ha,ma);wa&&wa.then&&u(wa)}catch(Da){z(Da)}switch(Q){case ":":"\x3d"==ia?(N=!0,ia=":"):S(":");break;case "}":if(X&&!x.root&&!x.isMediaBlock)try{x[":"==ia?"setValue":"declareDefinition"](X,ha,ma)}catch(Da){z(Da)}case ")":case "]":l[x.operator]!=Q&&z("Incorrect opening operator "+x.operator+" with closing operator "+Q);X=null;X=p.slice(x.start,f.lastIndex-1);x.cssText=x.cssText?x.cssText+";"+X:X;if("}"==
Q){"}"==Z&&(Z=x.parent.selector)&&"@"==!Z.charAt(0)&&z("A nested rule must end with a semicolon");if(x.root)z("Unmatched "+Q);else{try{x.onRule(x.selector,x)}catch(Da){z(Da)}H=!0}I=""}if(")"==Q||"]"==Q)x.args=[ha];if(")"==Q&&!ia){try{wa=h[h.length-2].onArguments&&h[h.length-2].onArguments(x)}catch(Da){z(Da)}wa&&wa.then&&u(wa)}h.pop();x=h[h.length-1];ha=x.currentSequence;X=x.currentName;ia=x.assignmentOperator;if(x.root&&"}"==Q){if(ia)try{x[":"==ia?"setValue":"declareDefinition"](X,ha,ma)}catch(Da){z(Da)}N=
!0;ia=!1}break;case "":case void 0:return;case ";":if(x&&X){try{(wa=x[":"==ia?"setValue":"declareDefinition"](X,ha,ma))&&wa.then&&u(wa)}catch(Da){z(Da)}X}ha=null;N=!0;ia=H=!1;I=""}var Z=Q}}function z(S){var M=p.slice(0,f.lastIndex).split("\n"),Q=M[M.length-1];M=(B.href||"in-page stylesheet")+":"+M.length+":"+Q.length+" near:\n"+Q.slice(-40);if(e.onerror)e.onerror(S,M);console.error(S.message||S,M);S.stack&&console.error(S.stack)}p=p.replace(r,function(S){return S.replace(/[^\n]/g,"")});var x=c;f.lastIndex=
0;var y,D=0,H=!0,I="",N=!0;t()}b=b||{addRule:function(){},cssRules:[]};var a,f=a=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g,h=[c];c.parse=e;e(g,b)}var m=/((?:\\.|[^'])*)'/g,v=/((?:\\.|[^"])*)"/g,r=/\/\*[\w\W]*?\*\//g,l={"{":"}","[":"]","(":")"},k=0,n="".trim?function(c){return c.trim()}:function(c){return c.replace(/^\s+|\s+$/g,"")},d=E.prototype=[];d.toString=function(){return this.join("")};
d.isSequence=!0;q.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};q.prototype.isLiteralString=!0;return w})},"xstyle/core/base":function(){define("xstyle/core/base","xstyle/core/elemental xstyle/core/expression xstyle/core/Definition xstyle/core/utils put-selector/put xstyle/core/Rule xstyle/core/es6".split(" "),function(E,q,A,w,m,v,r){function l(p,B,u){function t(x){return{selectElement:function(y){u.newElement&&(y=y.parentNode);if(x&&x.selector)for(;!f(y,
x);)if(y=y.parentNode,!y)throw Error("Rule not found");if(u.inherit)for(;!(p in y);)if(y=y.parentNode,!y)throw Error(p?p+" not found":"Property was never defined");return y},forElement:function(y){var D=y;y=this.selectElement(y);u.newElement&&(y["_"+p+"Node"]=D);y=u.get?u.get(y,p):y[p];return void 0===y&&x?c(p).valueOf().forRule(x):y},forRule:u.inherit&&function(y){return t(y)}}}var z=new A(function(){return t(B)});z.define=function(x,y){return l(p||y,x,u)};z.keepCSSValue=!0;z.put=u.inherit?function(x,
y){return c(p).put(x,y,p)}:function(x){return{forElement:function(y){if(B&&B.selector)for(;!f(y,B);)if(y=y.parentNode,!y)throw Error("Rule not found");u.set?u.set(y,p,x):y[p]=x;z.invalidate({elements:[y]})}}};return z}function k(p,B,u,t){return w.when(q.evaluate(p,u),function(z){z.forElement?E.addRenderer(p,function(x){t(z.forElement(x),x)}):t(z)})}function n(p,B){return{apply:function(u,t,z){k(u,z,t[0],function(x,y){x.observe(function(D){D=D?p:B;value.toString().replace(new RegExp(p+"\\([^)]+\\)",
"g"),D);y?y.style[z]=D:u.setStyle(z,D)})})}}}function d(p,B){var u=p.variables;if(u&&B in u)return u[B];if(p=p.bases)for(u=0;u<p.length;u++){var t=d(p[u],B);if(void 0!==t)return t}}function c(p){var B=h[p];B||(B=h[p]=new A(function(){return{forRule:function(u){a:{do{var t=d(u,p);if(void 0!==t){u=t;break a}u=u.parent}while(u);u=void 0}return u}}}),B.put=function(u,t,z){return{forRule:function(x){function y(H){D.push(H);for(var I in H.rules)y(H.rules[I])}(x.variables||(x.variables={}))[z]=u;for(var D=
[];x;)y(x),x=x.parent;B.invalidate({rules:D})}}});return B}var g=m("div"),b=navigator.userAgent,e=-1<b.indexOf("WebKit")?"-webkit-":-1<b.indexOf("Firefox")?"-moz-":-1<b.indexOf("MSIE")?"-ms-":-1<b.indexOf("Opera")?"-o-":"",a;v=new v;var f=E.matchesRule;v.root=!0;var h={};v.definitions={Math:Math,window:window,global:window,module:q.selfResolving(function(p,B){p[0].value&&(p=p[0].value);B||require([p]);return{then:function(u){return(new r.Promise(function(t){require([p],function(z){t(z)})})).then(u)}}}),
item:l("item",null,{inherit:!0}),pageContent:new A,content:l("content",null,{inherit:!0,newElement:function(){return this.element}}),elementProperty:l(null,null,{}),elementClass:l(null,null,{get:function(p,B){return-1<(" "+p.className+" ").indexOf(" "+B+" ")},set:function(p,B,u){this.get(p,B)!=u&&(p.className=u?p.className+(" "+B):(" "+p.className+" ").replace(" "+B+" ","").replace(/^ +| +$/g,""))}}),element:{forElement:function(p){return p},define:function(p){return{forElement:function(B){for(;!f(B,
p);)if(B=B.parentNode,!B)throw Error("Rule not found");return B}}}},event:{observe:function(p){p(a)},valueOf:function(){return a}},each:{put:function(p){return{forRule:function(B){B.each=p}}}},prefix:{put:function(p,B,u){return{forRule:function(t){if("string"==typeof g.style[e+u])return t._setStyleFromValue(e+u,p),!0}}}},"var":{define:function(p,B){return c(B)},selfResolving:!0,apply:function(p,B){return c(w.convertCssNameToJs(B[0]))}},inline:n("inline","none"),block:n("block","none"),visible:n("visible",
"hidden"),"extends":{apply:function(p,B){for(;0<B.length;)return w.extend(p,B[0],console.error)}},set:{selfExecuting:!0,apply:function(p,B){return B[0].put(B[1].valueOf())}},get:{apply:function(p,B){return B[0]},put:function(p,B){q.evaluate(B,p)}},toggle:{selfExecuting:!0,apply:function(p,B){return B[0].put(!B[0].valueOf())}},on:{put:function(p,B,u){return{forRule:function(t){E.on(document,u.charAt(2).toLowerCase()+u.slice(3),t,function(z){a=z;try{w.when(q.evaluate(t,p).valueOf(),function(x){x&&x.forRule&&
(x=x.forRule(t));x&&x.forElement&&(x=x.forElement(z.target));a=null},function(x){console.error("Error in "+u+" event handler, executing "+p,x)})}catch(x){console.error("Error in "+u+" event handler, executing "+p,x)}})}}}},title:{put:function(p){return{forRule:function(B){q.observe(q.evaluate(B,p),function(u){document.title=u})}}}},"@supports":{selector:function(p){function B(u){var t;if(t=u.match(/^\s*not(.*)/))return!B(t[1]);if(t=u.match(/\((.*)\)/))return B(t[1]);if(t=u.match(/([^:]*):(.*)/))return u=
w.convertCssNameToJs(t[1]),t=g.style[u]=t[2],g.style[u]==t;if(t=u.match(/\w+\[(.*)=(.*)\]/))return m(t[0])[t[1]]==t[2];if(t=u.match(/\w+/))return w.isTagSupported(t);throw Error("can't parse @supports string");}B(p.selector.slice(10))?p.selector="":p.disabled=!0}},"true":!0,"false":!1,"null":null};v.elementProperty=l;return v})},"xstyle/core/elemental":function(){define("xstyle/core/elemental",["put-selector/put","xstyle/core/utils"],function(E,q){function A(z,x,y,D){function H(I){if(!y)return D(I);
var N=I.target;do if(t(N,y))return D(I);while((N=N.parentNode)&&1===N.nodeType)}c?z.addEventListener(x,H,!!g[x]):w(z,g[x]||x,H)}function w(z,x,y){x="on"+x;var D=z[x];z[x]=function(H){H=H||window.event;H.target=H.target||H.srcElement;D&&D(H);y(H)}}function m(z){/e/.test(n.readyState||"")?z():n.addEventListener("DOMContentLoaded",z)}function v(z){for(var x=n.querySelectorAll(z.selector),y=z.name,D=0,H=x.length;D<H;D++){var I=x[D],N=I.elementalStyle;N||(N=I.elementalStyle={},I.elementalSpecificities=
{});var S=I.renderings;S||(S=I.renderings=[],p.push(I));S.push({name:y,rendered:N[y]==z.propertyValue,renderer:z});N[y]=z.propertyValue}}function r(){for(;p.length;){for(var z=p.shift(),x=z.renderings,y=z.elementalStyle;x.length;){var D=x.shift(),H=D.renderer,I=H.rendered;u=y[D.name]==H.propertyValue;if(!I&&u)try{H.render(z)}catch(N){console.error(N,N.stack),E(z,"div.error",N.toString())}I&&!u&&H.unrender&&H.unrender(z)}z.renderings=void 0}}function l(z,x){for(var y=0,D=f.length;y<D;y++){var H=f[y];
x&&x!=H.selector||!t(z,H.rule)||H.render(z)}}function k(z,x){var y={selector:z.selector,rule:z,render:x};f.push(y);B&&v(y);r();return{remove:function(){f.splice(f.indexOf(y),1)}}}var n=document,d=1,c=!!n.addEventListener,g={blur:"focusout",focus:"focusin"};A(n,"change",null,function(z){z=z.target;for(var x=0,y=h.length;x<y;x++){var D=h[x];if(-1<(" "+z.className+" ").indexOf(D.rule.selector.slice(1))){var H=D.definition.valueOf();H&&H.forRule&&(H=H.forRule(D.rule));H&&H.forElement&&(H=H.forElement(z));
var I="checkbox"===z.type?z.checked:z.value;"number"===typeof H&&isFinite(I)&&(I=+I);(H=D.definition.put(I))&&H.forRule&&(H=H.forRule(D.rule));H&&H.forElement&&H.forElement(z)}}});navigator.userAgent.match(/MSIE|Trident/)&&A(n,"keydown",null,function(z){if(13==z.keyCode){var x=z.target;if(document.createEvent)z=document.createEvent("Events"),z.initEvent("change",!0,!0),x.dispatchEvent(z);else document.onchange({target:x})}});var b=n.createElement("div"),e={"dom-qsa2.1":!!b.querySelectorAll},a=b.matches||
b.matchesSelector||b.webkitMatchesSelector||b.mozMatchesSelector||b.msMatchesSelector||b.oMatchesSelector,f=[],h=[],p=[],B;m(function(){if(!B)if(B=!0,e["dom-qsa2.1"]){for(var z=0,x=f.length;z<x;z++)v(f[z]);r()}else{var y=n.all;z=0;for(x=y.length;z<x;z++)l(y[z])}});var u,t=a?function(z,x){return a.call(z,x.selector)}:function(z,x){x.ieId||x.setStyle(x.ieId="x-ie-"+d++,"true");return!!z.currentStyle[x.ieId]};return{ready:m,on:A,matchesRule:t,addRenderer:k,addInputConnector:function(z,x){h.push({rule:z,
definition:x})},update:l,clearRenderers:function(){f=[]},observeForElement:function(z,x,y){return q.when(z,function(D){function H(I){I.observe?I.observe(y):y(I)}D.forElement?k(x,function(I){H(D.forElement(I))}):H(D)})}}})},"xstyle/core/utils":function(){define("xstyle/core/utils",[],function(){function E(m,v){for(var r=0,l=m.length;r<l;r++){var k=m[r];if(k&&"object"==typeof k&&v in k)return!0}}function q(m,v){return v.toUpperCase()}var A="div"==document.createElement("div").tagName,w={};return{when:function(m,
v,r){return m&&m.then?m.then(v,r)||m:v(m)},whenAll:function(m,v){return E(m,"then")?{then:function(r,l){function k(){n--;n||r(v(d))}for(var n=1,d=[],c=0;c<m.length;c++){var g=m[c];n++;g&&g.then?function(b){g.then(function(e){d[b]=e;k()},l)}(c):(d[c]=g,k())}k()},inputs:m}:v(m)},convertCssNameToJs:function(m){return m.replace(/-(\w)/g,q)},isTagSupported:function(m){if(m in w)return w[m];var v=document.createElement(m);A?(v=v.toString(),v=!("[object HTMLUnknownElement]"==v||"[object]"==v)):v=v.tagName==
m.toUpperCase();return w[m]=v},extend:function(m,v){var r=v.split(".");v=r[0];var l=m.getDefinition(v,"rules");r[0]="";m.selector+=m.extraSelector=r.join(".");if(l)return this.when(l,function(k){if(k.extend)k.extend(m,!0);else for(var n in k)m[n]=k[n]});m.tagName=v;if(!this.isTagSupported(v))throw Error("Extending undefined definition "+v);},someHasProperty:E}})},"xstyle/core/expression":function(){define("xstyle/core/expression",["xstyle/core/utils","xstyle/core/Definition"],function(E,q){function A(b,
e){var a=e[0];return a&&b?(a=k(a),A(b.property?b.property(a):b[a],e.slice(1))):b}function w(b,e,a){if(n(e,b)){var f={};f[b]=function(h){for(var p=[],B=0,u=e.length;B<u;B++){var t=e[B];t&&"function"==typeof t[b]&&(t=t[b](h));p[B]=t}return a(p)};return f}return a(e)}function m(b,e){return{apply:function(a,f,h){for(var p=0,B=f.length;p<B;p++){var u=f[p];u.dependencyOf&&u.dependencyOf(h)}p=function(){var t=[];if(b.selfExecuting)return b.apply(a,f,h);for(var z=0,x=f.length;z<x;z++)t[z]=f[z].valueOf();
if(b.selfWaiting)return b.apply(a,t,h);t.push(a);return E.whenAll(t,function(y){var D=y.pop();return w("forRule",y,function(H){return w("forElement",H,function(I){return b.apply(D,I,h)})})})};p.reverse=function(t){return e(t,f)};return p}}}function v(b){return c[b]||(c[b]=new Function("a","b","return "+b))}function r(b,e,a,f,h){function p(t){t.skipResolve=!0;t.precedence=e;t.infix=!1!==h}var B=function(t,z){var x=z[0];z=z[1];if(x&&x.put)t=f(t,z&&z.valueOf()),t!==d&&x.put(t);else if(z&&z.put)z.put(h(t,
x&&x.valueOf()));else throw new TypeError("Can not put");},u={apply:function(t,z,x){var y;a=v(a);f=f&&v(f);h=h&&v(h);g[b]=y=m(a,B);p(y);return y.apply(t,z,x)}};p(u);g[b]=u}function l(b,e){function a(y){for(;z<=y.precedence;){var D=B.pop(),H=g[B.pop()],I=new q;I.setCompute(H.apply(null,H.infix?[B.pop(),D]:[D],I));u=B.length?B[B.length-1]:void 0;B.push(I);z=u&&g[u]&&g[u].precedence}}var f;e=e.join?e.slice():[e];for(f=0;f<e.length;f++){var h=e[f];if("string"==typeof h){var p=h.match(/"[^"]*"|[+\-<>\|\/\?:^*!&|]+|[\w_$\.\/-]+/g);
h=[f,1];p&&h.push.apply(h,p);e.splice.apply(e,h);f+=h.length-3}}var B=[],u;p={};for(f=0;f<e.length;f++){h=e[f];if("("==h.operator){var t=B[B.length-1];void 0===t||g.hasOwnProperty(t)?h=l(b,h.getArgs()[0]):(B.pop(),h=function(y,D){function H(M){return E.when(y.valueOf(),function(Q){var da=y.parent&&y.parent.valueOf();if(!Q.selfResolving){if(!I){I=[];for(var J=0,R=D.length;J<R;J++)I[J]=l(b,D[J]);N=Q.selfReacting?Q.apply(da,I,S):m(Q).apply(da,I,S)}return N()}Q=Q.apply(da,D,S);return M?Q:Q.valueOf()})}
var I,N,S=new q(H);S.setReverseCompute(function(){var M=arguments;return E.when(H(!0),function(Q){return Q.put.apply(Q,M)})});return S}(t,h.getArgs()))}else if(g.hasOwnProperty(h)){t=g[h];a(t);var z=(u||t).precedence}else if(-1<h)h=+h;else if(h.isLiteralString)h=h.value;else{h=h.split(/\s*\/\s*/);t=h[0];var x=b.getDefinition(t);if("string"==typeof x||x instanceof Array)x=l(b,x);else if(void 0===x)throw Error('Could not find reference "'+t+'"');p[t]=x;1<h.length&&(x=A(x,h.slice(1)));h=x}B.push(h)}a({precedence:100});
if(1<B.length)throw Error("Could not reduce expression");h=B[0];h.inputs=p;return h}var k=E.convertCssNameToJs,n=E.someHasProperty,d={},c={},g={};r("+",6,"a+b","a-b","a-b");r("-",6,"a-b","a+b","b-a");r("*",5,"a*b","a/b","a/b");r("/",5,"a/b","a*b","b/a");r("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");r(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");r("!",4,"!a","!a",!1);r("%",5,"a%b");r("\x3e",8,"a\x3eb");r("\x3e\x3d",8,"a\x3e\x3db");r("\x3c",8,"a\x3cb");r("\x3c\x3d",8,"a\x3c\x3db");
r("\x3d\x3d",9,"a\x3d\x3d\x3db");r("\x26",8,"a\x26\x26b");r("|",8,"a||b");return{react:m,evaluate:l,selfResolving:function(b){b.selfResolving=!0;return b}}})},"xstyle/core/Definition":function(){define(["xstyle/core/utils","xstyle/core/es6"],function(E,q){function A(l){(this.computeValue=l)&&l.reverse&&this.setReverseCompute(l.reverse)}function w(l,k,n){if(k&&k.forElement)return{forElement:function(d){d=k.selectElement?k.selectElement(d):d;var c=["_cache_"+l.id];if(c in d){var g=d[c+"observe"];g.addKey&&
g.addKey(n);return d[c][n]}var b=d[c]=k.forElement(d),e=d[c+"observe"]=m(l,b,n,{elements:[d]});d.xcleanup=function(a){a&&q.unobserve(b,e)};return b[n]}}}function m(l,k,n,d){var c=l._properties;if("object"==typeof k){var g=function(b){for(var e=0;e<b.length;e++){var a=c[b[e].name];a&&a.invalidate&&a.invalidate(d)}};q.observe(k,g);g.addKey&&g.addKey(n)}return g}var v={},r=1;A.prototype={id:"x-variable-"+r++,cache:v,valueOf:function(){if((this.dependents||this._properties)&&this.cache!==v)return this.cache;
var l=this,k=this.computeValue;if(k.then)return this.cache=k.then(function(n){l.computeValue=n;(n=l.cache=n())&&n.then&&n.then(function(d){l.cache=d});return n});(k=l.cache=k())&&k.then&&k.then(function(n){l.cache=n});return k},property:function(l){var k=this._properties||(this._properties={}),n=k[l];if(!n){var d=this;n=k[l]=new A(function(){return E.when(d.valueOf(),function(c){if(c&&c.forRule)return{forRule:function(b){b=c.selectRule?c.selectRule(b):b;var e=["_cache_"+d.id],a;if((a=e in b?b[e]:
b[e]=c.forRule(b))&&a.forElement)return w(d,a,l);var f=b[e+"observe"];f&&(f.addKey?f.addKey(l):b[e+"observe"]=m(d,a,l,{rules:[b]}));return a[l]}};if(c&&c.forElement)return w(d,c,l);var g=d.cacheObserve;g?g.addKey&&g.addKey(l):g=d.cacheObserve=m(d,c,l);return c[l]})});n.key=l;n.parent=this;n.put=function(c){return E.when(d.valueOf(),function(g){function b(e){if(e.forElement)return{forElement:function(a){e.forElement(a)[l]=c}};e[l]=c}if(g.forRule)return{forRule:function(e){return b(g.forRule(e))}};
b(g)})};n.id=this.id+"-"+l}return n},invalidate:function(l){var k=this.cacheObserve;k&&(q.unobserve(this.cache,k),this.cacheObserve=null);this.cache=v;k=this._properties;for(d in k)k[d].invalidate(l);var n=this.dependents||0;var d=0;for(k=n.length;d<k;d++)try{n[d].invalidate(l)}catch(c){console.error(c,"invalidating a definition")}},dependencyOf:function(l){(this.dependents||(this.dependents=[])).push(l)},notDependencyOf:function(l){for(var k=this.dependents||0,n=0;n<k.length;n++)k[n]===l&&k.splice(n--,
1)},setReverseCompute:function(l){this.put=function(){var k=l.apply(this,arguments);this.invalidate();return k}},setCompute:function(l){(this.computeValue=l)&&l.reverse&&this.setReverseCompute(l.reverse);this.invalidate()},setSource:function(l){this.computeValue=function(){return l};this.invalidate()},observe:function(l){this.computeValue&&l(this.valueOf());var k=this;return this.dependencyOf({invalidate:function(){l(k.valueOf())}})},newElement:function(){return E.when(this.valueOf(),function(l){return l&&
l.newElement&&l.newElement()})}};return A})},"xstyle/core/es6":function(){define("xstyle/core/es6",[],function(){function E(g,b,e){v?-1===v.indexOf(g)&&v.push(g):(v=[g],setTimeout(function(){v.forEach(function(a){var f=[];a.properties.forEach(function(h){f.push({target:a.object,name:h})});a(f);a.object=null;a.properties=null});v=null},0));g.object=b;g=g.properties||(g.properties=[]);-1===g.indexOf(e)&&g.push(e)}function q(){return q}var A=Object.observe,w;if(w=Object.defineProperty)a:{try{Object.defineProperty({},
"t",{});w=!0;break a}catch(g){}w=void 0}var m={observe:A,defineProperty:w,promise:"undefined"!==typeof Promise,WeakMap:"function"===typeof WeakMap};A=m.observe?Object.observe:m.defineProperty?function(g,b){b.addKey=function(e){var a="key"+e;if(!this[a]){this[a]=!0;var f=g[e];if((a=Object.getOwnPropertyDescriptor(g,e))&&a.set){var h=a.set,p=a.get;Object.defineProperty(g,e,{get:function(){return f=p.call(this)},set:function(B){h.call(this,B);f!==B&&(f=B,b&&E(b,this,e))}})}else Object.defineProperty(g,
e,{get:function(){return f},set:function(B){f!==B&&(f=B,b&&E(b,this,e))}})}};b.remove=function(){b=null}}:function(g,b){n||(n=!0,setInterval(function(){for(var f=0,h=r.length;f<h;f++){var p=void 0,B=void 0,u=l[f],t=r[f],z=k[f];for(p in u)u.hasOwnProperty(p)&&u[p]!==t[p]&&(u[p]=t[p],(B||(B=[])).push({name:p}));for(p in t)t.hasOwnProperty(p)&&!u.hasOwnProperty(p)&&(u[p]=t[p],(B||(B=[])).push({name:p}));B&&z(B)}},20));var e={},a;for(a in g)g.hasOwnProperty(a)&&(e[a]=g[a]);r.push(g);l.push(e);k.push(b)};
var v;w=m.observe?Object.unobserve:function(g,b){b.remove&&b.remove();for(var e=0,a=r.length;e<a;e++)if(r[e]===g&&k[e]===b){r.splice(e,1);l.splice(e,1);k.splice(e,1);break}};var r=[],l=[],k=[],n=!1,d=1,c=function(){};c.prototype.toJSON=q;return{Promise:m.promise?Promise:function(){function g(b){function e(t){t&&t.then?t.then(e,a):(p=t,f())}function a(t){B=t;f()}function f(){h=!0;for(var t=0,z=u.length;t<z;t++)u[t]();u=0}var h,p,B,u=0;b(e,a);return{then:function(t,z){return new g(function(x,y){function D(){try{B&&
!z?y(B):x(B?z(B):t?t(p):p)}catch(H){y(H)}}h?D():(u||(u=[])).push(D)})}}}return g}(),WeakMap:m.WeakMap?WeakMap:function(g,b){var e="__"+(b||"")+d++;return m.defineProperty?{get:function(a){return a[e]},set:function(a,f){Object.defineProperty(a,e,{value:f,enumerable:!1})}}:{get:function(a){return(a=a[e])&&a.value},set:function(a,f){(a[e]||(a[e]=new c)).value=f}}},observe:A,unobserve:w,copy:function(g,b){for(var e in b)g[e]=b[e];return g}}})},"xstyle/core/Rule":function(){define("xstyle/core/Rule",["xstyle/core/expression",
"xstyle/core/Definition","put-selector/put","xstyle/core/es6","xstyle/core/utils"],function(E,q,A,w,m){function v(f,h,p){try{f[h]=p}catch(B){}}function r(){}function l(f,h,p,B){if(f.calls){var u;for(p=0;p<f.length;p++){var t=f[p];if(t instanceof k){f.hasOwnProperty(p)||(f[p]=t=c(t));var z=t.ref&&(t.ref.selfResolving?t.ref.apply(h,t.getArgs(),h):E.evaluate(h,[t.caller,t]));void 0!==z&&((u||(u=[])).push(z),t.evaluated=!0)}}}if(u)return h=E.react(function(){for(var x=0,y=f.slice(),D=0;D<f.length;D++){var H=
f[D];H instanceof k&&H.evaluated&&(y[D-1]=f[D-1].slice(0,-H.caller.length),y[D]=arguments[x++])}return y.join("")}),h.skipResolve=!0,B=new q,B.setCompute(h.apply(B,u,B)),B;if(!B)return f.toString()}function k(f){this.caller=f;this.args=[]}function n(f,h,p,B){return m.when(h,function(u){var t=u;u&&u.forRule&&((f._subRuleListeners||(f._subRuleListeners=[])).push(function(z){var x=t.forRule(z,!0);x&&x.forElement?d(z,x,B):p&&p(x)}),u=u.forRule(f));if(u&&u.forElement)return d(f,u,B);p&&p(u)})}function d(f,
h,p){return require(["xstyle/core/elemental"],function(B){B.addRenderer(f,function(u){var t=h.forElement(u);p&&p(t,u)})})}var c=Object.create||function(f){function h(){}h.prototype=f;return new h},g=m.convertCssNameToJs,b={"{":"}","[":"]","(":")"},e=A("div").style;r.prototype={property:function(f){return(this._properties||(this._properties={}))[f]||(this._properties[f]=new Proxy(this.get(f)))},eachProperty:function(f){for(var h=this.values||0,p=0;p<h.length;p++){var B=h[p];f.call(this,B||"unnamed",
h[B])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(f){f=(this.rules||(this.rules={}))[f]=new r;f.disabled=this.disabled;f.parent=this;return f},newCall:function(f){f=new k(f);f.parent=this;return f},addSheetRule:function(f,h){if("@"!=f.charAt(0)){var p=this.styleSheet,B=p.cssRules||p.rules,u=-1<this.ruleIndex?this.ruleIndex:B.length;try{p.addRule(f,h||" ",u)}catch(t){f.match(/-(moz|webkit|ie)-/)||console.warn("Unable to add rule",
f,h)}return B[u]}},onRule:function(){var f=this.getCssRule();if(this.installStyles)for(var h=0;h<this.installStyles.length;h++){var p=this.installStyles[h];v(f.style,p[0],p[1])}},setMediaSelector:function(f){this.isMediaBlock=!0;this.selector=f},setStyle:function(f,h){this.cssRule?v(this.cssRule.style,f,h):(this.installStyles||(this.installStyles=[])).push([f,h])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(f){return this.values[f]},
elements:function(f){var h=this;require(["xstyle/core/elemental"],function(p){p.addRenderer(h,function(B){f(B)})})},declareDefinition:function(f,h,p){f=f&&g(f);if(!this.disabled){var B=this;if(h.length)if("\x3e"==h[0].toString().charAt(0))f||(this.generator=h,require(["xstyle/core/generate","xstyle/core/elemental"],function(H,I){h=H.forSelector(h,B);I.addRenderer(B,h)}));else{var u=f in e||this.getDefinition(f);if(!p||!u){p=this.definitions||(this.definitions={});var t=h[0];if(t.indexOf&&-1<t.indexOf(",")){t=
h.join("").split(/\s*,\s*/);for(var z=[],x=0;x<t.length;x++)z[x]=E.evaluate(this,t[x])}h[0]&&"{"==h[0].operator?z=h[0]:h[1]&&"{"==h[1].operator&&(z=h[1],m.extend(z,h[0]));z=z||E.evaluate(this,h);if(z.then){var y=z;z={then:function(H){return y.then(function(I){return H(D(I))})}}}var D=function(H){H.define&&(H=H.define(B,f));return H};u&&console.warn('Overriding existing property "'+f+'"');return p[f]=D(z)}}else return p=this.definitions||(this.definitions={}),p[f]=h}},onArguments:function(f){var h=
f.ref;return h&&h.apply(this,f.getArgs(),this)},setValue:function(f,h,p){var B=g(f);if(!this.disabled){var u=this.values||(this.values=[]);u.push(f);u[f]=h;if(f){do{u=(p||this).getDefinition(f);if(void 0!==u){if(this.cssRule&&(!u||!u.keepCSSValue)){var t=this.cssRule.style;B in t&&v(t,B,"")}n(this,u.put(h,this,B))}f=f.substring(0,f.lastIndexOf("-"))}while(f)}B in e&&this._setStyleFromValue(B,h,!0)}},_setStyleFromValue:function(f,h,p){var B=h[0];if(B instanceof r)for(p=B.values,B=0;B<p.length;B++){var u=
p[B];this._setStyleFromValue(f+("main"==u?"":u.charAt(0).toUpperCase()+u.slice(1)),p[u])}else{if(h.calls){var t=this;if(h.expression=l(h,this,f,!0)){var z=h.expression&&h.expression.valueOf(),x=function(D,H){var I=z&&z.forRule?z.forRule(D,!0):z;if(I&&I.forElement)if(H=H&&H.elements)for(var N=0;N<H.length;N++)for(var S=H[N].querySelectorAll(D.selector),M=0;M<S.length;M++){var Q=S[M];v(Q.style,f,I.forElement(Q))}else d(D,I,function(da,J){v(J.style,f,da)});else D.setStyle(f,I)},y=[t];m.when(z,function(D){(z=
D)&&z.forRule&&(t._subRuleListeners||(t._subRuleListeners=[])).push(function(H){y.push(H);x(H)});x(t)});h.expression.dependencyOf({invalidate:function(D){m.when(h.expression.valueOf(),function(H){z=H;for(H=0;H<y.length;H++){var I=!0,N=y[H];if(D&&D.rules){I=!1;for(var S=0;S<D.rules.length;S++)if(D.rules[S]===N){I=!0;break}}I&&x(N,D)}})}})}}p||this.setStyle(f,h)}},put:function(f){var h=this;return{forRule:function(p){h.extend(p);if("defaults"!=f&&f&&"string"==typeof f&&h.values)for(var B=f.toString().split(/,\s*/),
u=0;u<B.length;u++){var t=h.values[u];t&&p.setValue(t,B[u],h)}}}},extend:function(f,h){(this.derivatives||(this.derivatives=[])).push(f);var p=this.extraSelector;p&&(f.selector+=p);var B=this.cssRule.style,u=f.getCssRule().style,t=f.inheritedStyles||(f.inheritedStyles={});for(p=0;p<B.length;p++){var z=g(B[p]);if(!u[z]||t[z])u[z]=B[z],t[z]=!0}if(p=this.values){p=c(p);var x=f.values;f.values=x?w.copy(p,x):p}if(h){if(p=this.definitions){p=c(p);var y=f.definitions;f.definitions=y?w.copy(p,y):p}f.tagName=
this.tagName||f.tagName}(f.bases||(f.bases=[])).push(this);h=this._subRuleListeners||0;for(p=0;p<h.length;p++)h[p](f);var D=f.getCssRule().style;this.eachProperty(function(H,I){H=g(H);"object"==typeof I&&(I=c(I));H in e&&!D[H]&&f._setStyleFromValue(H,I)});if(x&&f.definitions)for(p=0,h=x.length;p<h;p++)z=x[p],B=g(z),f.definitions[B]!==(y&&y[B])&&f.setValue(z,x[B]);if(x=this.generator){if(x instanceof Array)for(x=x.slice(0),p=0;p<x.length;p++)y=x[p],"{"===y.operator&&(h=f.newRule(),h.selector=y.selector+
f.selector.slice(1),h.styleSheet=f.styleSheet||f.cssRule.parentStyleSheet,y.extend(h,!0),x[p]=h);f.declareDefinition(null,x)}},getDefinition:function(f,h){f=g(f);var p=this;do{var B=p.definitions&&p.definitions[f];void 0===B&&h&&p[h]&&(B=p[h][f]);p=p.parent}while(void 0===B&&p);return B},newElement:function(){return A((this.tagName||"span")+(this.selector||""))},cssText:""};E.evaluateText=l;var a=k.prototype=new r;a.declareDefinition=a.setValue=function(f,h){this.args.push(h)};a.toString=function(){var f=
this.operator;return f+this.args+b[f]};r.updateStaleProperties=function(){};return r})},"xstyle/core/generate":function(){define("xstyle/core/generate",["xstyle/core/elemental","put-selector/put","xstyle/core/utils","xstyle/core/expression","xstyle/core/base"],function(E,q,A,w,m){function v(f,h){f=f.sort?f:[f];return function(p,B,u){var t=p,z;"content"in p||(p.content=void 0);if(void 0===u){var x=(p._contentNode||p).childNodes||0,y=x[0];if(y){var D=e.createDocumentFragment();do D.appendChild(y);while(y=
x[0]);p.content=D}if(p._contentNode){p._contentNode=void 0;try{p.innerHTML=""}catch(ma){}}}var H=0,I=[p],N=[];x=0;for(y=f.length;x<y;x++){var S=M,M=f[x];try{if(M.eachProperty){if(M.args)if("("==M.operator){var Q=f[x+1];r(M,Q,t,function(ma,ha,xa){n(ma,ha,xa,h)})}else{var da=M.args[0];if("string"===typeof da){var J=da.split("\x3d");try{t.setAttribute(J[0],J[1])}catch(ma){console.error(ma)}}else{var R=da[0].replace(/=$/,""),W=da[1];"("==W.operator?r(da[1],R,t,function(ma,ha,xa){k(ma,ha,xa,h)}):t.setAttribute(R,
W.value)}}}else if("string"==typeof M){"\x3d"==M.charAt(0)&&(M=M.slice(1));var X=t;Q=f[x+1];J=[];M.replace(/([,\n]+)?([\t ]*)?(\.|#)?([-\w%$|\.#]+)(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,function(){J.push(arguments)});for(var ia=0;ia<J.length;ia++)(function(ma,ha,xa,ua,na,va,ra){function wa(){var Ca=X._contentNode;Ca&&(Ca.innerHTML="",X=Ca)}ha?(ma=xa?xa.length:0,ma>H?(wa(),I[ma]=X):X=I[ma]||X,H=ma):wa();if(ua)var Z=(S&&S.args?"":"span")+ua+na;else{ua=na.match(/^[-\w]+/);if(!ua)throw new SyntaxError("Unable to parse selector",
na);ua=ua[0];if(ia===J.length-1&&Q&&Q.selector){Q.bases||A.extend(Q,ua);var Da=Q}else Da=h.getDefinition(ua);Da&&(Da.then||Da.newElement)?X=function(Ca,O,C,G){var L;A.when(Da&&Da.newElement&&Da.newElement(),function(T){(L=T)?(C=C.slice(G.length))&&q(L,C):L=q(C);if(P){P.parentNode.replaceChild(L,P);T=P.childNodes;var Y;for(L=L._contentNode||L;Y=T[0];)L.appendChild(Y)}});if(L)return Ca.insertBefore(L,O||null);var P=q("span");return Ca.insertBefore(P,O||null)}(X,u,na,ua):Z=na}Z&&(X=q(u||X,(u?"-":"")+
Z));u=null;va&&X.setAttribute(va,""===ra?va:ra);B&&(X.item=B);z=z||X;(ia<J.length-1||X!=t&&X!=p)&&N.push(ia==J.length-1&&Q&&Q.selector,X);t=X}).apply(this,J[ia])}else t.appendChild(e.createTextNode(M.value))}catch(ma){console.error(ma,ma.stack),t.innerHTML&&(t.innerHTML=""),t.appendChild(e.createTextNode(ma))}}for(;M=N.pop();)E.update(M,N.pop());return z}}function r(f,h,p,B){var u;if(h&&h.eachProperty){q(p,u=h.selector);var t=h}else q(p,u=f.selector||(f.selector=".-xbind-"+a++)),t=f;var z=f.getArgs()[0],
x=f.expressionResult,y=f.expressionDefinition;y||(y=f.expressionDefinition=w.evaluate(f.parent,z),x=y.valueOf(),E.addInputConnector(t,y),function(D,H,I){f.expressionResult=x;I.dependencyOf&&I.dependencyOf({invalidate:function(N){N=N?E.matchesRule(N.elements[0],t)?N.elements:N.elements[0].querySelectorAll(H):document.querySelectorAll(H);for(var S=0,M=N.length;S<M;S++)B(N[S],D,I.valueOf())}})}(h,u,y));B(p,h,x)}function l(f,h,p,B){return A.when(f,function(u){u&&u.forRule&&(u=u.forRule(h));u&&u.forElement&&
(u=u.forElement(p));B(u)})}function k(f,h,p,B){l(p,B,f,function(u){f.setAttribute(h,u)})}function n(f,h,p,B){f._defaultBinding=!0;if(p&&p.then&&"INPUT"!==f.tagName)try{f.appendChild(e.createTextNode("Loading"))}catch(u){}l(p,B,f,function(u){if(f._defaultBinding)if(d(f),f.childNodes.length&&(f.innerHTML=""),u&&u.sort)if(u.isSequence)v(u,B)(f);else{var t=h&&h.definitions&&h.definitions.each,z=B.newRule();t=t?v(t,z):function(H,I,N){return q(N||H,(N?"-":"")+(g[H.tagName]||"span"),""+I)};var x=[];if(u.track){u=
u.track();var y=u.tracking}u.forEach(function(H){x.push(t(f,H,null))});if(u.on)var D=u.on("add,delete,update",function(H){var I=H.target,N=H.previousIndex;H=H.index;if(-1<N){var S=x[N];d(S,!0);S.parentNode.removeChild(S);x.splice(N,1)}-1<H&&x.splice(H,0,t(f,I,x[H]||null))});if(y=y||D)f.xcleanup=function(){y.remove()}}else u&&u.nodeType?f.appendChild(u):(u=void 0===u?"":u,f.tagName in b?"checkbox"===f.type?f.checked=u:f.value=u:f.appendChild(e.createTextNode(u)))})}function d(f,h){f.xcleanup&&f.xcleanup(h);
f=f.getElementsByTagName("*");h=0;for(var p=f.length;h<p;h++){var B=f[h];B.xcleanup&&B.xcleanup(!0)}}function c(f,h){return v(h,m)(f)}var g={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},b={INPUT:1,TEXTAREA:1,SELECT:1},e=document,a=1;c.forSelector=v;return c})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(E,q,A,w,m,v,r,l,
k,n,d,c){A.isAsync||l(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var g=q("dojo.dnd.Source",d,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(b,e){w.mixin(this,w.mixin({},e));b=this.accept;if(b.length)for(this.accept={},e=0;e<b.length;++e)this.accept[b[e]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=
0;this.sourceState="";this.isSource&&m.add(this.node,"dojoDndSource");this.targetState="";this.accept&&m.add(this.node,"dojoDndTarget");this.horizontal&&m.add(this.node,"dojoDndHorizontal");this.topics=[k.subscribe("/dnd/source/over",w.hitch(this,"onDndSourceOver")),k.subscribe("/dnd/start",w.hitch(this,"onDndStart")),k.subscribe("/dnd/drop",w.hitch(this,"onDndDrop")),k.subscribe("/dnd/cancel",w.hitch(this,"onDndCancel"))]},checkAcceptance:function(b,e){if(this==b)return!this.copyOnly||this.selfAccept;
for(var a=0;a<e.length;++a){for(var f=b.getItem(e[a].id).type,h=!1,p=0;p<f.length;++p)if(f[p]in this.accept){h=!0;break}if(!h)return!1}return!0},copyState:function(b,e){if(b)return!0;2>arguments.length&&(e=this==c.manager().target);if(e){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){g.superclass.destroy.call(this);E.forEach(this.topics,function(b){b.remove()});this.targetAnchor=null},onMouseMove:function(b){if(!this.isDragging||"Disabled"!=this.targetState){g.superclass.onMouseMove.call(this,
b);var e=c.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(b.pageX-this._lastX)>this.delay||Math.abs(b.pageY-this._lastY)>this.delay)){var a=this.getSelectedNodes();a.length&&e.startDrag(this,a,this.copyState(n.getCopyKeyState(b),!0))}this.isDragging&&(a=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=v.position(this.current,!0)),a=this.horizontal?b.pageX-this.targetBox.x<this.targetBox.w/2==v.isBodyLtr(this.current.ownerDocument):b.pageY-
this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||a!=this.before)&&(this._markTargetAnchor(a),e.canDrop(!this.current||e.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(b){this.mouseDown||!this._legalMouseDown(b)||this.skipForm&&n.isFormElement(b)||(this.mouseDown=!0,this._lastX=b.pageX,this._lastY=b.pageY,g.superclass.onMouseDown.call(this,b))},onMouseUp:function(b){this.mouseDown&&(this.mouseDown=!1,g.superclass.onMouseUp.call(this,b))},onDndSourceOver:function(b){this!==
b?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(b=c.manager(),b.canDrop("Disabled"!=this.targetState&&(!this.current||b.source!=this||!(this.current.id in this.selection))))},onDndStart:function(b,e,a){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==b?a?"Copied":"Moved":"");e=this.accept&&this.checkAcceptance(b,e);this._changeState("Target",e?"":"Disabled");this==b&&c.manager().overSource(this);this.isDragging=!0},onDndDrop:function(b,
e,a,f){if(this==f)this.onDrop(b,e,a);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(b,e,a){if(this!=b)this.onDropExternal(b,e,a);else this.onDropInternal(e,a)},onDropExternal:function(b,e,a){var f=this._normalizedCreator;this._normalizedCreator=this.creator?function(h,p){return f.call(this,b.getItem(h.id).data,
p)}:a?function(h){var p=b.getItem(h.id);h=h.cloneNode(!0);h.id=n.getUniqueId();return{node:h,data:p.data,type:p.type}}:function(h){var p=b.getItem(h.id);b.delItem(h.id);return{node:h,data:p.data,type:p.type}};this.selectNone();a||this.creator||b.selectNone();this.insertNodes(!0,e,this.before,this.current);!a&&this.creator&&b.deleteSelectedNodes();this._normalizedCreator=f},onDropInternal:function(b,e){var a=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(e)this._normalizedCreator=
this.creator?function(f,h){return a.call(this,this.getItem(f.id).data,h)}:function(f){var h=this.getItem(f.id);f=f.cloneNode(!0);f.id=n.getUniqueId();return{node:f,data:h.data,type:h.type}};else{if(!this.current)return;this._normalizedCreator=function(f){var h=this.getItem(f.id);return{node:f,data:h.data,type:h.type}}}this._removeSelection();this.insertNodes(!0,b,this.before,this.current);this._normalizedCreator=a}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){g.superclass.onOverEvent.call(this);
c.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){g.superclass.onOutEvent.call(this);c.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(b){if(this.current!=this.targetAnchor||this.before!=b)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=b,this.targetAnchor&&
this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(b){this._changeState("Source",b?"Copied":"Moved")},_legalMouseDown:function(b){if("touchstart"!=b.type&&!r.isLeft(b))return!1;if(!this.withHandles)return!0;for(b=b.target;b&&b!==this.node;b=b.parentNode){if(m.contains(b,"dojoDndHandle"))return!0;
if(m.contains(b,"dojoDndItem")||m.contains(b,"dojoDndIgnore"))break}return!1}});return g})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c){var g=q("dojo.dnd.Selector",c,{constructor:function(b,e){e||(e={});this.singular=e.singular;this.autoSync=e.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;
this.events.push(k(this.node,n.press,w.hitch(this,"onMouseDown")),k(this.node,n.release,w.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var b=new l,e=d._empty,a;for(a in this.selection)a in e||b.push(m.byId(a));return b},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(b,e){this._addItemClass(m.byId(e),"Selected");this.selection[e]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var b=d._empty,
e;for(e in this.selection)if(!(e in b)){var a=m.byId(e);this.delItem(e);v.destroy(a)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(b,e){e=e||A.global;var a=this.selection,f=d._empty,h;for(h in a)h in f||b.call(e,this.getItem(h),h,this)},sync:function(){g.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var b=[],e=d._empty,a;for(a in this.selection)a in e||this.getItem(a)||b.push(a);E.forEach(b,function(f){delete this.selection[f]},
this);return this},insertNodes:function(b,e,a,f){var h=this._normalizedCreator;this._normalizedCreator=function(p,B){p=h.call(this,p,B);b?(this.anchor?this.anchor!=p.node&&(this._removeItemClass(p.node,"Anchor"),this._addItemClass(p.node,"Selected")):(this.anchor=p.node,this._removeItemClass(p.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[p.node.id]=1):(this._removeItemClass(p.node,"Selected"),this._removeItemClass(p.node,"Anchor"));return p};g.superclass.insertNodes.call(this,
e,a,f);this._normalizedCreator=h;return this},destroy:function(){g.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(b){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!d.getCopyKeyState(b)&&!b.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,r.isLeft(b)&&(b.stopPropagation(),b.preventDefault());else{if(!this.singular&&b.shiftKey){d.getCopyKeyState(b)||this._removeSelection();var e=this.getAllNodes();if(e.length&&(this.anchor||(this.anchor=
e[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var a=0,f;a<e.length&&(f=e[a],f!=this.anchor&&f!=this.current);++a);for(++a;a<e.length;++a){f=e[a];if(f==this.anchor||f==this.current)break;this._addItemClass(f,"Selected");this.selection[f.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?d.getCopyKeyState(b)&&this.selectNone():(this.selectNone(),this.anchor=
this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):d.getCopyKeyState(b)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=
1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);b.stopPropagation();b.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=k(this.node,
n.move,w.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var b=d._empty,e;for(e in this.selection)if(!(e in b)){var a=m.byId(e);a&&this._removeItemClass(a,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return g})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d,c,g,b){q=q("dojo.dnd.Container",k,{skipForm:!1,allowNested:!1,constructor:function(e,a){this.node=v.byId(e);a||(a={});this.creator=a.creator||null;this.skipForm=a.skipForm;this.parent=a.dropParent&&v.byId(a.dropParent);this.map={};this.current=null;this.containerState="";r.add(this.node,"dojoDndContainer");a&&a._skipStartup||this.startup();this.events=[d(this.node,g.over,w.hitch(this,"onMouseOver")),d(this.node,g.out,w.hitch(this,"onMouseOut")),d(this.node,"dragstart",
w.hitch(this,"onSelectStart")),d(this.node,"selectstart",w.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(e){return this.map[e]},setItem:function(e,a){this.map[e]=a},delItem:function(e){delete this.map[e]},forInItems:function(e,a){a=a||A.global;var f=this.map,h=b._empty,p;for(p in f)p in h||e.call(a,f[p],p,this);return a},clearItems:function(){this.map={}},getAllNodes:function(){return c((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var e={};this.getAllNodes().forEach(function(a){if(a.id){var f=
this.getItem(a.id);if(f){e[a.id]=f;return}}else a.id=b.getUniqueId();f=a.getAttribute("dndType");var h=a.getAttribute("dndData");e[a.id]={data:h||a.innerHTML,type:f?f.split(/\s*,\s*/):["text"]}},this);this.map=e;return this},insertNodes:function(e,a,f){this.parent.firstChild?a?f||(f=this.parent.firstChild):f&&(f=f.nextSibling):f=null;if(f)for(a=0;a<e.length;++a){var h=this._normalizedCreator(e[a]);this.setItem(h.node.id,{data:h.data,type:h.type});f.parentNode.insertBefore(h.node,f)}else for(a=0;a<
e.length;++a)h=this._normalizedCreator(e[a]),this.setItem(h.node.id,{data:h.data,type:h.type}),this.parent.appendChild(h.node);return this},destroy:function(){E.forEach(this.events,function(e){e.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(e,a,f){e._skipStartup=!0;return new f(a,e)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var e=this.parent.getElementsByTagName("tbody");e&&e.length&&(this.parent=
e[0])}this.defaultCreator=b._defaultCreator(this.parent);this.sync()},onMouseOver:function(e){for(var a=e.relatedTarget;a&&a!=this.node;)try{a=a.parentNode}catch(f){a=null}a||(this._changeState("Container","Over"),this.onOverEvent());a=this._getChildByEvent(e);this.current!=a&&(this.current&&this._removeItemClass(this.current,"Over"),a&&this._addItemClass(a,"Over"),this.current=a)},onMouseOut:function(e){for(e=e.relatedTarget;e;){if(e==this.node)return;try{e=e.parentNode}catch(a){e=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(e){this.withHandles||this.skipForm&&b.isFormElement(e)||(e.stopPropagation(),e.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(e,a){var f="dojoDnd"+e;e=e.toLowerCase()+"State";r.replace(this.node,f+a,f+this[e]);this[e]=a},_addItemClass:function(e,a){r.add(e,"dojoDndItem"+a)},_removeItemClass:function(e,a){r.remove(e,"dojoDndItem"+
a)},_getChildByEvent:function(e){if(e=e.target)for(var a=e.parentNode;a;e=a,a=e.parentNode)if((a==this.parent||this.allowNested)&&r.contains(e,"dojoDndItem"))return e;return null},_normalizedCreator:function(e,a){e=(this.creator||this.defaultCreator).call(this,e,a);w.isArray(e.type)||(e.type=["text"]);e.node.id||(e.node.id=b.getUniqueId());r.add(e.node,"dojoDndItem");return e}});b._createNode=function(e){return e?function(a){return l.create(e,{innerHTML:a})}:b._createSpan};b._createTrTd=function(e){var a=
l.create("tr");l.create("td",{innerHTML:e},a);return a};b._createSpan=function(e){return l.create("span",{innerHTML:e})};b._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};b._defaultCreator=function(e){e=e.tagName.toLowerCase();var a="tbody"==e||"thead"==e?b._createTrTd:b._createNode(b._defaultCreatorNodes[e]);return function(f,h){var p=f&&w.isObject(f);if(p&&f.tagName&&f.nodeType&&f.getAttribute){var B=f.getAttribute("dndData")||f.innerHTML;p=(p=f.getAttribute("dndType"))?p.split(/\s*,\s*/):
["text"]}else B=p&&f.data?f.data:f,p=p&&f.type?f.type:["text"],f=("avatar"==h?b._createSpan:a)(String(B));f.id||(f.id=b.getUniqueId());return{node:f,data:B,type:p}}};return q})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,g,b){var e=q("dojo.dnd.Manager",[v],{constructor:function(){this.source=this.avatar=
null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:r("touch")?4:16,OFFSET_Y:r("touch")?4:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());n.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),n.publish("/dnd/source/over",null)):n.publish("/dnd/source/over",null)},startDrag:function(a,
f,h){function p(B){B.preventDefault();B.stopPropagation()}g.autoScrollStart(w.doc);this.source=a;this.nodes=f;this.copy=!!h;this.avatar=this.makeAvatar();w.body().appendChild(this.avatar.node);n.publish("/dnd/start",a,f,this.copy);this.events=[k(w.doc,d.move,A.hitch(this,"onMouseMove")),k(w.doc,d.release,A.hitch(this,"onMouseUp")),k(w.doc,"keydown",A.hitch(this,"onKeyDown")),k(w.doc,"keyup",A.hitch(this,"onKeyUp")),k(w.doc,"dragstart",p),k(w.body(),"selectstart",p)];a="dojoDnd"+(h?"Copy":"Move");
m.add(w.body(),a)},canDrop:function(a){a=!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){m.remove(w.body(),["dojoDndCopy","dojoDndMove"]);E.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new b(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var f=this.avatar;f&&(g.autoScrollNodes(a),f=f.node.style,
f.left=a.pageX+this.OFFSET_X+"px",f.top=a.pageY+this.OFFSET_Y+"px",f=!!this.source.copyState(c.getCopyKeyState(a)),this.copy!=f&&this._setCopyStatus(f));r("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var f=!!this.source.copyState(c.getCopyKeyState(a));n.publish("/dnd/drop/before",this.source,this.nodes,f,this.target,a);n.publish("/dnd/drop",this.source,this.nodes,f,this.target,a)}else n.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case l.CTRL:a=
!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case l.ESCAPE:n.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==l.CTRL&&(a=!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();m.replace(w.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});c._manager=null;e.manager=c.manager=function(){c._manager||
(c._manager=new e);return c._manager};return e})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(E,q,A,w,m,v,r,l){return E("dojo.dnd.Avatar",null,{constructor:function(k){this.manager=k;this.construct()},construct:function(){var k=v.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),n=this.manager.source,d=v.create("tbody",null,k),c=v.create("tr",
null,d),g=v.create("td",null,c),b=Math.min(5,this.manager.nodes.length),e=0;r("highcontrast")&&v.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},g);v.create("span",{innerHTML:n.generateText?this._generateText():""},g);for(w.set(c,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});e<b;++e){if(n.creator)var a=n._normalizedCreator(n.getItem(this.manager.nodes[e].id).data,"avatar").node;else a=this.manager.nodes[e].cloneNode(!0),"tr"==a.tagName.toLowerCase()&&(c=v.create("table"),
v.create("tbody",null,c).appendChild(a),a=c);a.id="";c=v.create("tr",null,d);g=v.create("td",null,c);g.appendChild(a);w.set(c,{"class":"dojoDndAvatarItem",style:{opacity:(9-e)/10}})}this.node=k},destroy:function(){v.destroy(this.node);this.node=!1},update:function(){m.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(r("highcontrast")){var k=A.byId("a11yIcon"),n="+";this.manager.canDropFlag&&!this.manager.copy?n="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||
(n="x"):n="o";k.innerHTML=n}l("tr.dojoDndAvatarHeader td span"+(r("highcontrast")?" span":""),this.node).forEach(function(d){d.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(E,q,A,w){return E("dijit.CheckedMenuItem",A,{baseClass:"dijitMenuItem dijitCheckedMenuItem",
templateString:w,checked:!1,_setCheckedAttr:function(m){this.domNode.setAttribute("aria-checked",m?"true":"false");this._set("checked",m)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(m){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(m)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(E,q,A,w,m,v,r,l,k,n,d){var c=k("dijit.ColorPalette",[A,w,m],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:q,baseClass:"dijitColorPalette",_dyeFactory:function(g,b,e,a){return new this._dyeClass(g,
b,e,a)},buildRendering:function(){this.inherited(arguments);this._dyeClass=k(c._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],r.getLocalization("dojo","colors",this.lang))}});c._Color=k("dijit._Color",l,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":E.toUrl("./themes/a11y/colors7x10.png"),"3x4":E.toUrl("./themes/a11y/colors3x4.png")},constructor:function(g,b,e,a){this._title=a;this._row=b;this._col=e;this.setColor(l.named[g])},getValue:function(){return this.toHex()},fillCell:function(g,b){b=d.substitute(v("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:b,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});n.place(b,g)}});return c})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(E,q,A,w,m,v,r,l,k,n,d){return E("dijit._PaletteMixin",l,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(c){return new ("string"==
typeof this.dyeClass?v.getObject(this.dyeClass):this.dyeClass)(c)},_preparePalette:function(c,g){this._cells=[];var b=this._blankGif;this.own(r(this.gridNode,k,v.hitch(this,"_onCellClick")));for(var e=0;e<c.length;e++)for(var a=w.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),f=0;f<c[e].length;f++){var h=c[e][f];if(h){var p=this._dyeFactory(h,e,f,g[h]);h=w.create("td",{"class":this.cellClass,tabIndex:"-1",title:g[h],role:"gridcell"},a);p.fillCell(h,b);h.idx=this._cells.length;this._cells.push({node:h,
dye:p})}}this._xDim=c[0].length;this._yDim=c.length;var B={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},u;for(u in B)this.own(d.addKeyListener(this.domNode,{keyCode:m[u],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var t=B[u];return function(z){this._navigateByKey(t,z)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){n.focus(this._currentFocus)},
_onCellClick:function(c){for(var g=c.target;"TD"!=g.tagName;){if(!g.parentNode||g==this.gridNode)return;g=g.parentNode}var b=this._getDye(g).getValue();this._setCurrent(g);n.focus(g);this._setValueAttr(b,!0);c.stopPropagation();c.preventDefault()},_setCurrent:function(c){"_currentFocus"in this&&q.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=c)&&q.set(c,"tabIndex",this.tabIndex)},_setValueAttr:function(c,g){0<=this._selectedCell&&A.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(c)for(var b=0;b<this._cells.length;b++)if(c==this._cells[b].dye.getValue()){this._selectedCell=b;A.add(this._cells[b].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?c:null);if(g||void 0===g)this.onChange(c)},onChange:function(){},_navigateByKey:function(c,g){-1!=g&&(c=this._currentFocus.idx+c,c<this._cells.length&&-1<c&&(c=this._cells[c].node,this._setCurrent(c),this.defer(v.hitch(n,"focus",c))))},_getDye:function(c){return this._cells[c.idx].dye}})})},
"dojo/_base/query":function(){define(["../query","./NodeList"],function(E){return E})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(E,q,A){return E("dijit.form.ComboBox",[q,A],{})})},"dojo/store/Observable":function(){define(["../_base/lang","../when","../_base/array"],function(E,q,A){var w=function(m){function v(d,c){var g=m[d];g&&(m[d]=function(b,e){var a;"put"===d&&(a=m.getIdentity(b));if(n)return g.apply(this,arguments);n=!0;try{var f=
g.apply(this,arguments);q(f,function(h){c("object"==typeof h&&h||b,a,e)});return f}finally{n=!1}})}var r=[],l=0;m=E.delegate(m);m.notify=function(d,c,g){l++;for(var b=r.slice(),e=0,a=b.length;e<a;e++)b[e](d,c,g)};var k=m.query;m.query=function(d,c){c=c||{};var g=k.apply(this,arguments);if(g&&g.forEach){var b=E.mixin({},c);delete b.start;delete b.count;var e=m.queryEngine&&m.queryEngine(d,b),a=l,f=[],h;g.observe=function(p,B){1==f.push(p)&&r.push(h=function(t,z,x){var y=x&&x.before&&m.getIdentity(x.before);
q(g,function(D){var H=D.length!=c.count,I;if(++a!=l)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var N=-1,S=-1;if(void 0!==z){var M=[].concat(D);e&&!t&&(M=e(D));var Q=0;for(I=D.length;Q<I;Q++){var da=D[Q];if(m.getIdentity(da)==z&&!(0>M.indexOf(da))){var J=da;N=Q;!e&&t||D.splice(Q,1);break}}}if(e){if(t&&(e.matches?e.matches(t):e([t]).length))if(Q=-1<N?N:D.length,D.splice(Q,0,t),S=A.indexOf(e(D),t),D.splice(Q,1),c.start&&0==S||!H&&S==D.length)S=-1;
else{if(x&&void 0!==x.before){if(null===x.before)Q=D.length;else a:{Q=m;H=I=void 0;H=void 0==H?D.length:H;for(I=void 0==I?0:I;I<H;++I)if(Q.getIdentity(D[I])===y){Q=I;break a}Q=-1}-1!==Q&&(S=Q)}D.splice(S,0,t)}}else t&&(void 0!==z?S=N:c.start||(S=m.defaultIndex||0,D.splice(S,0,t)));if((-1<N||-1<S)&&(B||!e||N!=S))for(H=f.slice(),Q=0;D=H[Q];Q++)D(t||J,N,S)})});var u={};u.remove=u.cancel=function(){var t=A.indexOf(f,p);-1<t&&(f.splice(t,1),f.length||r.splice(A.indexOf(r,h),1))};return u}}return g};var n;
v("put",function(d,c,g){m.notify(d,c,g)});v("add",function(d,c,g){m.notify(d,c,g)});v("remove",function(d){m.notify(void 0,d)});return m};E.setObject("dojo.store.Observable",w);return w})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/sniff","./TextBox"],function(E,q,A,w){return E("dijit.form.SimpleTextarea",w,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",
postMixInProperties:function(){!this.value&&this.srcNodeRef&&(this.value=this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);A("ie")&&this.cols&&q.add(this.textbox,"dijitTextAreaCols")},filter:function(m){m&&(m=m.replace(/\r/g,""));return this.inherited(arguments)},_onInput:function(m){if(this.maxLength){var v=parseInt(this.maxLength),r=this.textbox.value.replace(/\r/g,"");v=r.length-v;if(0<v){var l=this.textbox;if(l.selectionStart){var k=l.selectionStart,
n=0;A("opera")&&(n=(this.textbox.value.substring(0,k).match(/\r/g)||[]).length);this.textbox.value=r.substring(0,k-v-n)+r.substring(k-n);l.setSelectionRange(k-v,k-v)}else this.ownerDocument.selection&&(l.focus(),r=this.ownerDocument.selection.createRange(),r.moveStart("character",-v),r.text="",r.select())}}this.inherited(arguments)}})})},"dijit/form/RadioButton":function(){define(["dojo/_base/declare","./CheckBox","./_RadioButtonMixin"],function(E,q,A){return E("dijit.form.RadioButton",[q,A],{baseClass:"dijitRadio"})})},
"dijit/form/_RadioButtonMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/lang dojo/query!css2 ../registry".split(" "),function(E,q,A,w,m,v){return q("dijit.form._RadioButtonMixin",null,{type:"radio",_getRelatedWidgets:function(){var r=[];m("input[type\x3dradio]",this.focusNode.form||this.ownerDocument).forEach(w.hitch(this,function(l){l.name==this.name&&l.form==this.focusNode.form&&(l=v.getEnclosingWidget(l))&&r.push(l)}));return r},_setCheckedAttr:function(r){this.inherited(arguments);
this._created&&r&&E.forEach(this._getRelatedWidgets(),w.hitch(this,function(l){l!=this&&l.checked&&l.set("checked",!1)}))},_getSubmitValue:function(r){return null==r?"on":r},_onClick:function(r){if(this.checked||this.disabled)return r.stopPropagation(),r.preventDefault(),!1;if(this.readOnly)return r.stopPropagation(),r.preventDefault(),E.forEach(this._getRelatedWidgets(),w.hitch(this,function(n){A.set(this.focusNode||this.domNode,"checked",n.checked)})),!1;var l=!1,k;E.some(this._getRelatedWidgets(),
function(n){return n.checked?(k=n,!0):!1});this.checked=!0;k&&(k.checked=!1);if(!1===this.onClick(r)||r.defaultPrevented)l=!0;this.checked=!1;k&&(k.checked=!0);l?r.preventDefault():this.set("checked",!0);return!l}})})},"url:jimu/dijit/templates/AGOLLoading.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/AddItemForm.html":'\x3cdiv style\x3d"width: 100%" class\x3d"jimu-item-form"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"itemForm" encType\x3d"multipart/form-data" action\x3d"" method\x3d""\x3e\r\n    \x3cdiv class\x3d"line"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.title}\x3c/div\x3e\r\n      \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"itemName"\r\n      required\x3d"true" class\x3d"input-item"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"line line-margin"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.folder}\x3c/div\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"itemFolder" data-dojo-type\x3d"dijit/form/FilteringSelect" trim\x3d"true" class\x3d"input-item"\x3e\x3c/input\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv class\x3d"symbol-chooser" style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"jimu/dijit/formSelect" aria-label\x3d"${nls.markerCategory}" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointCustomImageTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"customImageTd" class\x3d"custom-image-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"image-file-tip jimu-ellipsis jimu-leading-margin1" data-dojo-attach-point\x3d"imageNameNode"\x3e${nls.noFileChoosen}\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr" data-dojo-attach-point\x3d"pointIconTablesTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" style\x3d"position:relative"\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-attach-point\x3d"loadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-symbolSize"\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" data-a11y-label-by\x3d"point-symbol-section-symbolSize" style\x3d"width:100%;" data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true,required:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-color"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"point-symbol-section-color" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-transparency"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-a11y-label-by\x3d"point-symbol-section-transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-outlineColor"\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"point-symbol-section-outlineColor" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-outlineWidth"\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner"  data-a11y-label-by\x3d"point-symbol-section-outlineWidth" style\x3d"width:100%;" data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;overflow:hidden;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-color"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"line-symbol-section-color" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-style"\x3e${nls.style}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"jimu/dijit/formSelect" data-a11y-label-by\x3d"line-symbol-section-style" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-transparency"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-a11y-label-by\x3d"line-symbol-section-transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-width"\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"line-symbol-section-width" data-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true,required:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-color"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"fill-symbol-section-color" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"arrowWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"arrow-symbol-section-width"\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"arrowWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"arrow-symbol-section-width" data-dojo-props\x3d\'value:12,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true,required:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-transparency"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-a11y-label-by\x3d"fill-symbol-section-transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-outlineColor"\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"fill-symbol-section-outlineColor" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-outlineWidth"\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"fill-symbol-section-outlineWidth" data-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"text-symbol-section-text"\x3e${nls.text}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput class\x3d"text-input" data-dojo-attach-point\x3d"inputText" type\x3d"text"  data-a11y-label-by\x3d"text-symbol-section-text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"text-symbol-section-fontColor"\x3e${nls.fontColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"text-symbol-section-fontColor" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"text-symbol-section-fontSize"\x3e${nls.fontSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"text-symbol-section-fontSize" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true,required:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ImageChooser.html":'\x3cdiv class\x3d"jimu-image-chooser js-fileapi-wrapper"\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintText"\x3e\r\n\t\t\x3cspan class\x3d"display-text" data-dojo-attach-point\x3d"displayText"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintImage"\x3e\r\n\t\t\x3cimg class\x3d"display-image" data-dojo-attach-point\x3d"selfImg"\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--\r\n  \x3cform data-dojo-attach-point\x3d"fileForm"\x3e\r\n    \x3clabel data-dojo-attach-point\x3d"mask"\x3e\x3c/label\x3e\r\n    \x3cinput type\x3d"file" data-dojo-attach-point\x3d"fileInput"\x3e\r\n  \x3c/form\x3e\r\n  \x3cimg class\x3d"tmp-image" style\x3d"display:none" data-dojo-attach-point\x3d"tmpImg"\x3e--\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_CropImage.html":'\x3cdiv class\x3d"jimu-crop-image"\x3e\r\n\t\x3cimg class\x3d"loading-image" data-dojo-attach-point\x3d"loadingImg" src\x3d""\x3e\r\n\r\n\t\x3cimg class\x3d"base-image hide-status" data-dojo-attach-point\x3d"baseImage" width\x3d"100%" height\x3d"100%" style\x3d"display:none;width:100%;height:100%"\x3e\r\n\x3c/div\x3e\r\n',"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e${_nls0}\x3c/li\x3e\r\n      \x3cli\x3e${_nls50}\x3c/li\x3e\r\n      \x3cli\x3e${_nls100}\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon" data-dojo-attach-point\x3d"pointIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon" data-dojo-attach-point\x3d"lineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon" data-dojo-attach-point\x3d"polylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon" data-dojo-attach-point\x3d"freehandPolylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.arrow}" data-geotype\x3d"ARROW" data-commontype\x3d"arrow" class\x3d"draw-item arrow-icon" data-dojo-attach-point\x3d"arrowIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon" data-dojo-attach-point\x3d"triangleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon" data-dojo-attach-point\x3d"extentIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon" data-dojo-attach-point\x3d"circleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon" data-dojo-attach-point\x3d"ellipseIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon" data-dojo-attach-point\x3d"polygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon" data-dojo-attach-point\x3d"freehandPolygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"TEXT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"drawings-clear" data-dojo-attach-point\x3d"btnClear" title\x3d"${nls.clear}"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ColorRecords.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\t\t\x3ctr tabindex\x3d"0" role\x3d"row" data-dojo-attach-point\x3d"container"\x3e\r\n\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/Filter.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"contentSection" class\x3d"content-section"\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"desktopAddSection" class\x3d"desktop-add-section hidden"\x3e\r\n\t\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"btnAddExpDesktop" class\x3d"add-with-icon add-expression jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addAnotherExpression}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"btnAddSetDesktop" class\x3d"add-with-icon add-set jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addSet}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"matchMsg" class\x3d"match-msg"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"oneOrZeroMsg" tabindex\x3d"0" style\x3d"display:none;"\x3e${nls.oneOrZeroMsg}\x3c/div\x3e\r\n\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect" data-dojo-type\x3d"jimu/dijit/formSelect" class\x3d"dijit-form-Select restrict-select-width" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgAll}\x3c/option\x3e\r\n\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgAny}\x3c/option\x3e\r\n\t\t\t\x3c/select\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"allExpsBox" data-dojo-attach-point\x3d"allExpsBox"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"errorSection" class\x3d"hidden"\x3e\r\n\t\t\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"errorTip" class\x3d"error-tip"\x3e\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"mobileAddSection" class\x3d"mobile-add-section hidden"\x3e\r\n\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" title\x3d"${nls.addAnotherExpression}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddExpMobile"\x3e\r\n\t\t\t+ ${nls.addAnotherExpression}\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" title\x3d"${nls.addSet}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddSetMobile"\x3e\r\n\t\t\t+ ${nls.addSet}\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"noFilterTipSection" class\x3d"no-filter-tip hidden" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/dateTimePicker.html":'\x3cdiv data-dojo-attach-point\x3d"dateTimeBox" class\x3d"jimu-dateTimeBox"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"calendarDiv"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"timeTextContainerRuntime" class\x3d"timeTextContainer timeTextContainerRuntime"\x3e\r\n\t\t\x3cdiv class\x3d"timeTextIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"timeTextBoxDiv"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"timeTextContainerSetting" class\x3d"timeTextContainer" style\x3d"display:none;"\x3e\r\n\t\t\x3cdiv class\x3d"timeCheckbox" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"timeCheckbox" data-dojo-props\x3d"checked:true, label:\'${timeNls.showTime}\'"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"timeTableContainer" style\x3d"display:none;"\x3e\r\n\t\t\t\x3cdiv class\x3d"timeGroup"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"timeLabel jimu-ellipsis" title\x3d"${timeUnit.hour}"\x3e${timeUnit.hour}\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"timeLabel jimu-ellipsis" title\x3d"${timeUnit.minute}"\x3e${timeUnit.minute}\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"timeLabel jimu-ellipsis" title\x3d"${timeUnit.second}"\x3e${timeUnit.second}\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"timeGroup"\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"hourSelect" data-dojo-type\x3d"dijit/form/TimeTextBox"\r\n\t\t\t\t\tdata-dojo-props\x3d"constraints:{timePattern:\'HH\', clickableIncrement: \'T01:00:00\', visibleIncrement: \'T01:00:00\'}"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"minuteSelect" data-dojo-type\x3d"dijit/form/TimeTextBox"\r\n\t\t\t\t\tdata-dojo-props\x3d"constraints:{timePattern:\'mm\', clickableIncrement: \'T00:05:00\', visibleIncrement: \'T00:05:00\',pickerMin: \'T01:00:00\',pickerMax: \'T01:59:00\'}"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"secondSelect" data-dojo-type\x3d"dijit/form/TimeTextBox"\r\n\t\t\t\t\tdata-dojo-props\x3d"constraints:{timePattern:\'ss\', clickableIncrement: \'T00:00:05\', visibleIncrement: \'T00:00:05\',pickerMin: \'T01:00:00\',pickerMax: \'T01:00:59\'}"\x3e\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/TwoNumbersValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"numberRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;" data-dojo-attach-point\x3d"_dijit1_container"\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;" data-dojo-attach-point\x3d"_dijit2_container"\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/TwoDatesValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"dateRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv1"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv2"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/AdvancedListValueSelect.html":'\x3cdiv class\x3d"jimu-list-multiple-select" data-dojo-attach-point\x3d"multipleSelect" tabindex\x3d"0"\x3e\r\n  \x3cdiv class\x3d"selectedContainer" data-dojo-attach-point\x3d"selectedContainer"\x3e\r\n    \x3cdiv class\x3d"jimu-multiple-items-list items-content" data-dojo-attach-point\x3d"selectedListContent" tabindex\x3d"0"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv\x3e\r\n    \x3c!-- \x3cdiv style\x3d"position:absolute;height:345px;width:100%;z-index:1;display:none;" data-dojo-attach-point\x3d"listContainerOverlay"\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"searchKeyInput" data-dojo-attach-point\x3d"searchKeyInput" style\x3d"display:none;"\x3e\r\n      \x3cinput value\x3d"" placeholder\x3d"${jimuCommonNls.search}" data-dojo-type\x3d"dijit/form/ValidationTextBox"\r\n       data-dojo-attach-point\x3d"valueInput" data-dojo-props\x3d\'"required":false,intermediateChanges:true\' style\x3d"width:100%;" tabindex\x3d"0"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"items-content loading-center" data-dojo-attach-point\x3d"listContainer"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"listContentStore"style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\r\n      \x3c/div\x3e --\x3e\r\n      \x3cdiv class\x3d"jimu-multiple-items-list" data-dojo-attach-point\x3d"listContent" tabindex\x3d"0"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"loadMoreDataBtn" class\x3d"jimu-list-multiple-select-Tips load-more-data-Tips"\x3e${jimuCommonNls.searchMore}\x3c/div\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"noDataTips" class\x3d"jimu-list-multiple-select-Tips no-data-Tips"\x3e${Nls.noData}\x3c/div\x3e --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"noDataTips" class\x3d"jimu-list-multiple-select-Tips no-data-Tips"\x3e${noDataNls}\x3c/div\x3e\r\n      \x3c!-- \x3cdiv class\x3d"createNewItem" data-dojo-attach-point\x3d"createNewItem" data-dojo-attach-event\x3d"click:_createTarget"\x3e\x26nbsp;\x3c/div\x3e --\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--\r\n  \x3cdiv class\x3d"selectedToggleDiv" style\x3d"display:none;" data-dojo-attach-point\x3d"selectedToggleDiv"\x3e\r\n    \x3cspan class\x3d"selectedToggle" data-dojo-attach-point\x3d"selectedToggle"\x3e\x3c/span\x3e\r\n    \x3cspan class\x3d"toggleTxt" title\x3d"${Nls.showSelected}"\x3e${Nls.showSelected}\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  --\x3e\r\n\r\n  \x3cdiv class\x3d"selectedToggleDiv" style\x3d"display:none;" data-dojo-attach-point\x3d"selectedToggleDiv"\x3e\r\n      \x3cdiv class\x3d"showAllIcon iconHover jimu-flipx" title\x3d"${Nls.showAll}" data-dojo-attach-point\x3d"showAllIconBtn"  tabindex\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"showSelectedIcon jimu-flipx" title\x3d"${Nls.showSelected}" data-dojo-attach-point\x3d"showSelectedIconBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"clearAllSelectedIcon jimu-flipx" title\x3d"${Nls.unCheckAll}" data-dojo-attach-point\x3d"clearAllSelectedBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/AdvancedListValueProvider.html":'\x3cdiv\x3e\r\n   \x3cdiv role\x3d"button" aria-haspopup\x3d"true" class\x3d"checkBtn" tabindex\x3d"0" data-dojo-attach-point\x3d"checkedBtn" style\x3d"display:none;" data-dojo-attach-event\x3d"click:_checkedBtnEvent"\x3e\r\n       \x3cspan class\x3d"screen-readers-only" data-dojo-attach-point\x3d"promptLabel"\x3e\x3c/span\x3e\r\n       \x3cdiv data-dojo-attach-point\x3d"checkedNumDiv" class\x3d"checkedNumDiv"\x3e\x3cspan class\x3d"checkedNum" data-dojo-attach-point\x3d"checkedNum"\x3e\x3c/span\x3e${CommonNls.selected}\x3c/div\x3e\r\n       \x3cdiv data-dojo-attach-point\x3d"checkedNameDiv" class\x3d"checkedNum checkedNameDiv jimu-ellipsis-Blanks"\x3e\x3c/div\x3e\r\n       \x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8 checkBtnDownIcon"\x3e\x3c/div\x3e\r\n   \x3c/div\x3e\r\n   \x3cdiv data-dojo-attach-point\x3d"listContent"\x3e\x3c/div\x3e\r\n   \x3cdiv class\x3d"value-multiple-popup" data-dojo-attach-point\x3d"listContentPopup"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"listContent"\x3e\x3c/div\x3e\r\n   \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/pageControlForQuery.html":'\x3cdiv class\x3d"pageControl pageItem"\x3e\r\n  \x3c!--\r\n  \x3cdiv data-dojo-attach-point\x3d"prevPage" class\x3d"pageBtn pageDisabled pageItem"\x3e\x3c-prevPage\x3c/div\x3e\r\n  \x3cdiv class\x3d"pageItem" data-dojo-attach-point\x3d"currentPage"\x3e1\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"nextPage" class\x3d"pageBtn pageItem"\x3enextPage-\x3e\x3c/div\x3e\r\n  --\x3e\r\n\r\n  \x3c!-- \x3cdiv data-dojo-attach-point\x3d"addNextPage"\x3eLoad more data(Test)\x3c/div\x3e --\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/PredefinedValueProvider.html":'\x3cdiv\x3e\r\n    \x3c!-- \x3cdiv data-dojo-attach-point\x3d"valueproviderStore" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"jimu-filter-popup-btn jimu-not-selectable"\x3e\r\n      \x3cdiv class\x3d"predefined-btn"  data-dojo-attach-point\x3d\'indexBtn\'\x3e\r\n        \x3cdiv class\x3d"tip jimu-ellipsis" title\x3d"predefined" data-dojo-attach-point\x3d\'indexBtnTips\'\x3epredefined\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d\'valueProviderPopupNode\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/EditTable.html":'\x3cdiv\x3e\r\n    \x3cdiv class\x3d"jimu-multiple-set-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"" class\x3d"items-list-content items-list-header"  \x3e\r\n        \x3cdiv class\x3d"item"\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis" title\x3d"${Nls.value}"\x3e${Nls.value}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis" title\x3d"${CommonNls.label}"\x3e${CommonNls.label}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label checkboxHeader jimu-ellipsis" title\x3d"${CommonNls.defaults}"\x3e${CommonNls.defaults}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label lableR jimu-ellipsis" title\x3d"${CommonNls.actions}"\x3e${CommonNls.actions}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"listContent" class\x3d"items-list-content" data-dojo-attach-event\x3d"click:_onListContentClicked, dblclick:_onListContentDblClicked"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e',
"url:jimu/dijit/_filter/PredefinedValuePopup.html":'\x3cdiv\x3e\r\n   \x3c!--\r\n    \x3cselect data-dojo-attach-point\x3d"valProviderSelect" class\x3d"dijit-form-Select multiple-Select"  data-dojo-attach-event\x3d"onclick:_showPopup"\x3e\r\n    \x3c/select\x3e\r\n    --\x3e\r\n    \x3c!-- \x3cdiv class\x3d"subTitle"\x3e${CommonNls.layer}: \x3cspan data-dojo-attach-point\x3d"layerName"\x3e\x3c/span\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"jimu-filter-popup-btn jimu-not-selectable"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"listSelectStore" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e --\x3e\r\n\r\n      \x3c!-- for list select popup --\x3e\r\n      \x3c!-- \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e --\x3e\r\n      \x3c!-- for eidtTable --\x3e\r\n      \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"icon"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--\r\n      \x3cdiv class\x3d"add-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e\r\n        \x3cdiv class\x3d"tip"\x3eopenLayer-temp\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"add-btn add-btn-right" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n       --\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"tableContent"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"displayTypes" data-dojo-attach-point\x3d"displayTypes" data-dojo-attach-event\x3d"click:_changeDisplayType"\x3e\r\n      \x3cdiv class\x3d"title jimu-ellipsis"\x3e${Nls.displayAs}\x3c/div\x3e\r\n      \x3cspan class\x3d"option dropdownOption"\x3e\r\n        \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aDrowdownList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n      \x3cspan class\x3d"option expandedOption"\x3e\r\n      \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aExpandedList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3c!--\r\n    \x3cdiv class\x3d"jimu-multiple-set-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"" class\x3d"items-list-content items-list-header"  \x3e\r\n        \x3cdiv class\x3d"item"\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.name}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.label}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label checkboxHeader jimu-ellipsis" title\x3d"set default?"\x3e${CommonNls.defaults}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label lableR jimu-ellipsis"\x3e${CommonNls.actions}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"listContent" class\x3d"items-list-content" data-dojo-attach-event\x3d"click:_onListContentClicked"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    --\x3e\r\n\r\n    \x3cdiv class\x3d"value-type-popup" data-dojo-attach-point\x3d"valuesPopupNode" style\x3d"display:none;"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"mutiValuesSelect" multiple\x3d"true" data-dojo-type\x3d"dojox/form/CheckedMultiSelect" data-dojo-props\x3d\'searchAttr:"label",required:false,intermediateChanges:true\' style\x3d"width:100%;" \x3e\x3c/div\x3e --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"pageControlContainer"\x3eLoad more data\x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3c!-- \x3ca data-dojo-attach-event\x3d"onclick:_setSelectType" class\x3d"popupOper" style\x3d"display:none;"\x3etype\x3c/a\x3e --\x3e\r\n  \x3c/div\x3e',
"url:dojox/form/resources/_CheckedMultiSelectMenuItem.html":'\x3ctr class\x3d"dijitReset dijitMenuItem" dojoAttachPoint\x3d"focusNode" role\x3d"menuitemcheckbox" tabIndex\x3d"-1"\r\n\tdojoAttachEvent\x3d"ondijitclick:_onClick"\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\r\n\t\t\x3e\x3cdiv src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitMenuItemIcon ${_iconClass}" dojoAttachPoint\x3d"iconNode"\r\n\t\t\t\x3e\x3cinput class\x3d"dojoxCheckedMultiSelectCheckBoxInput" dojoAttachPoint\x3d"inputNode" type\x3d"${_type.type}"\r\n\t\t/\x3e\x3c/div\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" dojoAttachPoint\x3d"containerNode,labelNode"\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" dojoAttachPoint\x3d"accelKeyNode"\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26nbsp;\x3c/td\r\n\x3e\x3c/tr\x3e',
"url:dojox/form/resources/_CheckedMultiSelectItem.html":'\x3cdiv class\x3d"dijitReset ${baseClass}"\r\n\t\x3e\x3cinput class\x3d"${baseClass}Box" data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-point\x3d"checkBox" \r\n\t\tdata-dojo-attach-event\x3d"_onClick:_changeBox" type\x3d"${_type.type}" data-dojo-props\x3d\'disabled:${disabled}, readOnly:${readOnly}\' baseClass\x3d"${_type.baseClass}"\r\n\t/\x3e\x3cdiv class\x3d"dijitInline ${baseClass}Label" data-dojo-attach-point\x3d"labelNode" data-dojo-attach-event\x3d"onclick:_onClick"\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dojox/form/resources/CheckedMultiSelect.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}"\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"comboButtonNode"\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"selectNode" class\x3d"dijit dijitReset dijitInline ${baseClass}Wrapper" data-dojo-attach-event\x3d"onmousedown:_onMouseDown,onclick:focus"\r\n\t\t\x3e\x3cselect class\x3d"${baseClass}Select dojoxCheckedMultiSelectHidden" multiple\x3d"true" data-dojo-attach-point\x3d"containerNode,focusNode"\x3e\x3c/select\r\n\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"wrapperDiv"\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:jimu/dijit/_filter/NumberListValueProvider.html":'\x3cdiv\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"numberListTable" style\x3d"width:100%;border-collapse:collapse;"\r\n        cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n        \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n                \x3ctd style\x3d"width:50%;"\x3e\r\n                    \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n                        data-dojo-props\x3d\'"required":false,constraints:{min:0,pattern:"#####0.##########"}\'\r\n                        style\x3d"width:100%;" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                    \x3cselect data-dojo-attach-point\x3d"rangeSelect" data-dojo-type\x3d"dijit/form/Select"\r\n                        style\x3d"width:100%;" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n                        \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n                    \x3c/select\x3e\r\n                \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n        \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/DateIsInValueProvider.html":'\x3cdiv\x3e\r\n\t\x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"dateTypeSelect" class\x3d"date-type-select restrict-select-width" data-dojo-attach-event\x3d"change:_onDateTypeSelectChanged"\x3e\r\n\t\x3c/select\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/_SingleFilter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"settings-container"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"fieldsSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"displayName",required:true,intermediateChanges:true\' class\x3d"fields-select dijit-form-FilteringSelect"\x3e\x3c/div\x3e\r\n    \x3cselect data-dojo-attach-point\x3d"operatorsSelect" data-dojo-type\x3d"dijit/form/Select" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n      \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n    \x3c/select\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"attributeValueContainer" class\x3d"attribute-value-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"valueProviderContainer" class\x3d"value-provider-container"\x3e\x3c/div\x3e\r\n      \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"valueTypeSetNode" title\x3d"${nls.setInputType}" class\x3d"value-type-set jimu-icon jimu-icon-setting"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv role\x3d"button" tabindex\x3d"0" aria-label\x3d"\'${nls.deleteText}\'" class\x3d"jimu-icon jimu-icon-delete" data-dojo-attach-point\x3d"btnDelete"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"askvalues"\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxAskValues" label\x3d"${nls.askForValues}" class\x3d"jimu-trailing-margin6"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxCaseSensitive" label\x3d"${nls.caseSensitive}" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"promptSection" class\x3d"prompt"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"promptTable" cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"prompt-table" style\x3d"width:100%;"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.prompt}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"promptTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.hint}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"hintTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"relativeDatesTr" class\x3d"relative-start-date-tr"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"startDateOptions"\x3e${nls.dateOptions}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"custom_start_date" data-dojo-props\x3d\'title:"${nls.custom}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.custom}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"today_start_date" data-dojo-props\x3d\'title:"${nls.today}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.today}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"yesterday_start_date" data-dojo-props\x3d\'title:"${nls.yesterday}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.yesterday}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"tomorrow_start_date" data-dojo-props\x3d\'title:"${nls.tomorrow}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.tomorrow}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"relativeDatesTr" class\x3d"relative-end-date-tr"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"endDateOptions"\x3e${nls.endDateOptions}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"custom_end_date" data-dojo-props\x3d\'title:"${nls.custom}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.custom}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"today_end_date" data-dojo-props\x3d\'title:"${nls.today}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.today}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"yesterday_end_date" data-dojo-props\x3d\'title:"${nls.yesterday}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.yesterday}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"tomorrow_end_date" data-dojo-props\x3d\'title:"${nls.tomorrow}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.tomorrow}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"cascadeTr" class\x3d"cascade-tr"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv style\x3d"margin-bottom:5px;"\x3e${nls.listValues}:\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"cascadeSelect" class\x3d"cascade-select restrict-select-width" style\x3d"width:100%;"\x3e\r\n              \x3coption value\x3d"none"\x3e${nls.noneCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"previous"\x3e${nls.previousCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"all"\x3e${nls.allCascadeFilterTip}\x3c/option\x3e\r\n            \x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_FilterSet.html":'\x3cdiv\x3e\r\n\t\x3ctable class\x3d"header-table" cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgSetAll}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgSetAny}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-delete"\x3e\r\n\t\t\t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"btnDelete" aria-label\x3d"\'${nls.deleteText}\'" class\x3d"jimu-icon jimu-icon-delete" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-add"\x3e\r\n\t\t\t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"btnAdd" aria-label\x3d"\'${nls.addText}\'" class\x3d"jimu-icon jimu-icon-add" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"allExpsBox" class\x3d"jimu-filter-exps-box"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_SingleFilterParameter.html":'\x3cdiv\x3e\r\n  \x3ctable style\x3d"width:100%;"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"first-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"prompt" data-dojo-attach-point\x3d"promptNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"second-tr"\x3e\r\n        \x3ctd data-dojo-attach-point\x3d"valueProviderTd"\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"third-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"*now":function(E){E(['dojo/i18n!*preload*jimu/nls/main*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});
define("./ConfigManager ./LayoutManager ./DataManager ./WidgetManager ./FeatureActionManager ./SelectionManager ./DataSourceManager ./FilterManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/keys dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query esri/config esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils ./portalUtils require dojo/i18n dojo/i18n!./nls/main esri/main dojo/ready".split(" "),function(E,q,A,w,m,v,r,l,k,n,d,c,
g,b,e,a,f,h,p,B,u,t,z,x,y,D,H,I,N,S,M){function Q(){var X=window.location.search,ia={query:!0,find:!0};if(""===X)return{};X=p.queryToObject(X.substr(1));for(var ma in X)ia[ma]||(X[ma]=y.sanitizeHTML(X[ma]));return X}function da(X,ia){J=X;"loadingPageChange"!==ia&&k.setStyle(jimuConfig.mainPageId,"display","block")}f={};var J;window.topic=e;B.defaults.io.timeout=18E4;"function"!==typeof a.getAll&&(a.getAll=function(X){var ia=[];(X=a(X))&&ia.push(X);return ia});window.jimuNls=N;window.apiNls=S.bundle;
z.setProtocolErrorHandler(function(){return!0});z.setOAuthRedirectionHandler(function(X){window.location=X.authorizeUrl+"?canHandleCrossOrgSignin\x3dtrue\x26"+p.objectToQuery(X.authorizeParams)});z=y.getAncestorWindow();var R=!1,W=/^http(s?):\/\//gi;try{R=0===z.location.href.indexOf("https://")}catch(X){}u.setRequestPreCallback(function(X){X.content&&X.content.printFlag&&(X.timeout=3E5);R&&(X.url=X.url.replace(W,"//"));if(-1!==X.url.indexOf("/queryRelatedRecords?")){var ia=X.url,ma=B.defaults.io.proxyUrl;
ma&&0===X.url.indexOf(ma+"?")&&(ia=X.url.replace(ma+"?",""));y.isHostedService(ia)||(X.url=X.url.replace("FeatureServer","MapServer"))}/GPServer\/.+\/jobs/.test(X.url)&&(X.preventCache=(new Date).getTime());window.isBuilder||!J||J.mode||(J.appProxies&&0<J.appProxies.length&&d.some(J.appProxies,function(ha){var xa=ha.sourceUrl;ha=ha.proxyUrl;R&&(xa=xa.replace(W,"//"),ha=ha.replace(W,"//"));if(0<=X.url.indexOf(xa))return X.url=X.url.replace(xa,ha),!0}),J.map.appProxy&&d.some(J.map.appProxy.proxyItems,
function(ha){if(!ha.useProxy||!ha.proxyUrl)return!1;var xa=ha.sourceUrl;ha=ha.proxyUrl;R&&(xa=xa.replace(W,"//"),ha=ha.replace(W,"//"));if(0<=X.url.indexOf(xa))return X.url=X.url.replace(xa,ha),!0}));return X});c(window,"mousedown",function(X){y.isInNavMode()&&(k.removeClass(document.body,"jimu-nav-mode"),window.isMoveFocusWhenInit=!1);if(b.isMiddle(X))return X.preventDefault(),X.stopPropagation(),X.returnValue=!1});c(window,"keydown",function(X){X.keyCode!==g.TAB||y.isInNavMode()||k.addClass(document.body,
"jimu-nav-mode")});navigator.serviceWorker&&(window.postMessageToSw({type:"to_sw_credential",credential:null}),navigator.serviceWorker.onmessage=function(X){var ia=X.data;X.origin===window.location.origin&&"to_window_get_credential"===ia.type&&window.portalUrl&&(X=x.getStandardPortalUrl(window.portalUrl),X=D.getPortal(X),X.credential?window.postMessageToSw({type:"to_sw_credential",credential:X.credential.toJson()}):window.isCredentialSettled&&window.postMessageToSw({type:"to_sw_no_credential"}))});
String.prototype.startWith=function(X){return this.substr(0,X.length)===X?!0:!1};String.prototype.endWith=function(X){return this.substr(this.length-X.length,X.length)===X?!0:!1};Number.isNaN=Number.isNaN||function(X){return X!==X};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=n.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion=
"2.26";window.productVersion="Online 10.3";window.isBuilder?(e.subscribe("app/appConfigLoaded",da),e.subscribe("app/appConfigChanged",da)):(e.subscribe("appConfigLoaded",da),e.subscribe("appConfigChanged",da));if(n=y.has("ie"))9<n?k.addClass(document.body,"ie-nav-mode"):k.addClass(document.body,"ie-low-nav-mode"),10<n&&k.addClass(document.body,"ie-gte-10");f.initApp=function(){console.log("jimu.js init...");var X=Q();if(X.mobileBreakPoint)try{var ia=parseInt(X.mobileBreakPoint,10);jimuConfig.breakPoints[0]=
ia}catch(ma){console.error("mobileBreakPoint URL parameter must be a number.",ma)}X.mode&&(k.setStyle(jimuConfig.loadingId,"display","none"),k.setStyle(jimuConfig.mainPageId,"display","block"));A.getInstance(w.getInstance());m.getInstance();v.getInstance();r.getInstance();l.getInstance();ia=q.getInstance({mapId:jimuConfig.mapId,urlParams:X},jimuConfig.layoutId);X=E.getInstance(X);ia.startup();X.loadConfig();H(["dynamic-modules/preload"]);M(function(){setTimeout(function(){k.removeClass(document.body,
"dj_a11y")},50)})};return f});