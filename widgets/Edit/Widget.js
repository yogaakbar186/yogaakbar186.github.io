// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/dijit/editing/Editor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/string dijit/_Widget dijit/_Templated ../../domUtils ../../graphicsUtils ../../geometry/Polyline ../../geometry/Polygon ../../graphic ../../undoManager ../../tasks/query ../../layers/FeatureLayer ../../layers/FeatureTemplate ../../toolbars/draw ../../toolbars/edit ../AttributeInspector ./Util ./Add ./Update ./Delete ./Cut ./Union ./toolbars/Drawing ./SelectionHelper ./TemplatePicker ../../kernel ../../config dojo/i18n!../../nls/jsapi dojo/text!./templates/Editor.html dijit/ProgressBar dojo/NodeList-dom".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,p,h,r,d,x,D,q,H,t,G,T,A,S,O,V,I,g,C,B,J,M,Q,R,X){var W=N([u,w],{declaredClass:"esri.dijit.editing.Editor",widgetsInTemplate:!0,templateString:X,onLoad:function(){},constructor:function(k,F){k=k||{};k.settings||console.error("Editor: please provide 'settings' parameter in the constructor");k.settings.layerInfos||console.error("Editor: please provide 'layerInfos' parameter in the constructor");this._settings=k.settings;this._eConnects=[]},startup:function(){this.inherited(arguments);
this._setDefaultOptions();this._settings.map.setInfoWindowOnClick(!1);var k=this._settings.layerInfos;this.featureReductionEnabledLayers=[];z.forEach(k,function(L){L=L.featureLayer;L.isFeatureReductionEnabled()&&(L.disableFeatureReduction(),this.featureReductionEnabledLayers.push(L))},this);if(z.every(k,function(L){return L.featureLayer.loaded}))this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0;else{var F=k.length;z.forEach(k,function(L){L=L.featureLayer;
if(L.loaded)F--;else var E=y.connect(L,"onLoad",this,function(K){y.disconnect(E);E=null;F--;F||(this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0)})},this)}this._reset();this._enableMapClickHandler()},stopEditing:function(k){this._updateCurrentFeature(v.hitch(this,function(){this._clearSelection(!1);k&&k()}))},destroy:function(){this._settings.map.setInfoWindowOnClick(!0);this.drawingToolbar&&this.drawingToolbar.destroy();this.attributeInspector&&this.attributeInspector.destroy();
this.templatePicker&&this.templatePicker.destroy();this._selectionHelper&&this._selectionHelper.destroy();this._drawToolbar&&this._drawToolbar.deactivate();this._reset();this._disableMapClickHandler();z.forEach(this._eConnects,y.disconnect);y.disconnect(this._dtConnect);y.disconnect(this._templatePickerOnSelectionChangeEvent);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this.editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=
this.undoManager=null;this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures&&this._settings.map.infoWindow.clearFeatures();z.forEach(this.featureReductionEnabledLayers,function(k){k.enableFeatureReduction()});this.inherited(arguments)},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new t(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this.editToolbar=this._settings.editToolbar||new G(this._settings.map,{textSymbolEditorHolder:this.domNode});
this._settings.editToolbar=this.editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||!1;this._settings.toolbarOptions=v.mixin({reshapeVisible:!1,cutVisible:!1,mergeVisible:!1},this._settings.toolbarOptions);this._settings.createOptions=v.mixin({polylineDrawTools:[W.CREATE_TOOL_POLYLINE],polygonDrawTools:[W.CREATE_TOOL_POLYGON],editAttributesImmediately:!0},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=
this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?!0:!1;this._datePackage=this._settings.datePackage;var k=Q.defaults;this._settings.geometryService=this._settings.geometryService||k.geometryService;k.geometryService=k.geometryService||this._settings.geometryService},_initLayers:function(){this._settings.layers=[];this._settings.userIds={};this._settings.createOnlyLayer={};z.forEach(this._settings.layerInfos,
function(k){if(k.featureLayer&&k.featureLayer.loaded){this._settings.layers.push(k.featureLayer);var F=k.featureLayer.id;k.featureLayer.credential&&(this._settings.userIds[F]=k.featureLayer.credential.userId);k.userId&&(this._settings.userIds[F]=k.userId);var L=k.featureLayer.getEditCapabilities();this._settings.createOnlyLayer[F]=L.canCreate&&!L.canUpdate?!0:!1;this._isTextSymbolPointLayer(k.featureLayer)&&(k.disableAttributeUpdate=!0)}},this)},_reset:function(){this._hideAttributeInspector();this.editToolbar.deactivate();
this._editVertices=!0;this._drawingTool=this._activeTemplate=this._activeType=this._currentGraphic=this._layer=null;this._attributeChanged=!1},_saveFeatureOnClient:function(k){var F=this.templatePicker.getSelected();var L=F.template?F.featureLayer.renderer.getSymbol(F.template.prototype):F.symbolInfo.symbol;this._tempGraphic=new d(k,L,null,null);this._tempGraphic.setAttributes(v.mixin({},F.template.prototype.attributes));L=this._settings.map;L.graphics.add(this._tempGraphic);k=this._findCenterPoint(k);
this._createAttributeInspector();L.infoWindow.setTitle(F.featureLayer?F.featureLayer.name:R.widgets.attributeInspector.NLS_title);this.attributeInspector.showFeature(this._tempGraphic,F.featureLayer);this._showInfoWindow(k,L.getInfoWindowAnchor(k));if(this._settings.createOnlyLayer[F.featureLayer.id]||this._settings.invalidTemplate)this._infoWindowHideEvent=y.connect(L.infoWindow,"onHide",this,"_infoWindowHide");y.disconnect(this._templatePickerOnSelectionChangeEvent);this.templatePicker.clearSelection();
this._drawToolbar.deactivate();this._enableMapClickHandler();this.drawingToolbar&&this.drawingToolbar.deactivate();this._templatePickerOnSelectionChangeEvent=y.connect(this.templatePicker,"onSelectionChange",v.hitch(this,"_onCreateFeature"))},_saveAttributesOnClient:function(k,F,L){this._tempGraphic.attributes[F]="number"===typeof L&&isNaN(L)?null:L},_infoWindowHide:function(){this._createFeature(this._tempGraphic.geometry,this._tempGraphic.attributes);y.disconnect(this._infoWindowHideEvent)},_createFeature:function(k,
F){this._editClickPoint=this._findCenterPoint(k);k.rings?this._simplify(k,v.hitch(this,function(L){this._drawingTool!==H.TOOL_AUTO_COMPLETE_POLYGON?this._applyEdits([{layer:this._layer,adds:[this._createGraphic(L,F)]}],v.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})):this._autoComplete(L,v.hitch(this,function(E){E&&E.length&&this._applyEdits([{layer:this._layer,adds:z.map(E,v.hitch(this,function(K){return this._createGraphic(K,
F)}))}],function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})}))})):this._applyEdits([{layer:this._layer,adds:[this._createGraphic(k,F)]}],v.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer);this._layer&&this._layer.renderer&&"heatmap"===this._layer.renderer.type&&this._layer.refresh()}))},_chainAttachment:function(k,F){this.attributeInspector&&
this.attributeInspector._attachmentEditor&&this.attributeInspector._attachmentEditor._tempUpload&&this.attributeInspector._attachmentEditor._chainAttachment(k,F)},_updateCurrentFeature:function(k){var F=this._isModified();F?this._updateFeature(F,k):k&&k(!1)},_updateFeature:function(k,F,L){var E=k.geometry,K=k.getLayer();K.hasZ&&!K.enableZDefaults||K.hasM&&!K.allowUpdateWithoutMValues||L&&!this._isModified()?(L=new d,L.setAttributes(k.attributes),this._applyEdits([{layer:k.getLayer(),updates:[L]}],
F)):E.rings?this._simplify(E,v.hitch(this,function(P){this._applyEdits([{layer:k.getLayer(),updates:[v.mixin(k,{geometry:P})]}],F)})):this._applyEdits([{layer:k.getLayer(),updates:[k]}],F)},_deleteFeature:function(k,F){if(this._settings.invalidTemplate&&k===this._tempGraphic)this._settings.map.graphics.remove(this._tempGraphic),this._hideAttributeInspector();else{var L=[];k?L.push({layer:k.getLayer(),deletes:[k]}):(L=z.map(z.filter(this._settings.layers,function(E){return 0<E.getSelectedFeatures().length}),
function(E){return{layer:E,deletes:E.getSelectedFeatures()}}))&&L.length||!this._currentGraphic||L.push({layer:this._layer,deletes:[this._currentGraphic]});this._applyEdits(L,F)}},_stopEditing:function(k,F,L,E){e.hide(this.progressBar.domNode);this._settings.createOnlyLayer[k.id]||this._undoRedoAdd();if(!0===k._isSelOnly||1===k.mode||6===k.mode){if(F&&F.length){this.templatePicker.clearSelection();var K=new D;K.objectIds=[F[0].objectId];this._settings.createOnlyLayer[k.id]||this._settings.invalidTemplate?
this._settings.map.graphics.remove(this._tempGraphic):this._selectFeatures([k],K,v.hitch(this,"_onEditFeature"))}}else(K=this._selectionHelper.findMapService(this._settings.map,k))&&K.refresh(),F&&F.length&&(this.templatePicker.clearSelection(),this._settings.createOnlyLayer[k.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):A.findFeatures(F,k,v.hitch(this,"_onEditFeature")));E&&E.length&&(this._clearSelection(!0),this._undoRedo&&(K=this._selectionHelper.findMapService(k,
this._settings.map))&&K.refresh());this._undoRedo&&L&&L.length&&((K=this._selectionHelper.findMapService(k,this._settings.map))&&K.refresh(),this.attributeInspector.refresh(),this._undoRedo=!1);this.drawingToolbar&&this.drawingToolbar._updateUI();this._undoRedo=!1;this._settings.invalidTemplate=!1},_undoRedoAdd:function(){this._settings._isApplyEditsCall=!1;if(this._settings.undoManager){var k=this._edits&&this._edits.length?this._edits[0]:null;if(k){var F=k.adds||[],L=k.updates||[],E=k.deletes||
[],K=k.preUpdates||[];k={featureLayer:k.layer};"CUT"===this._activeTool?F.length&&L.length&&K.length&&this.undoManager.add(new I(v.mixin(k,{preUpdatedGraphics:K,addedGraphics:F,postUpdatedGraphics:L}))):"UNION"===this._activeTool?E.length&&L.length&&K.length&&this.undoManager.add(new g(v.mixin(k,{preUpdatedGraphics:K,deletedGraphics:E,postUpdatedGraphics:L}))):F.length?this.undoManager.add(new S(v.mixin(k,{addedGraphics:F}))):E.length?this.undoManager.add(new V(v.mixin(k,{deletedGraphics:E}))):L.length&&
(this._rollbackGraphic||K.length)&&this.undoManager.add(new O(v.mixin(k,{preUpdatedGraphics:K.length?K:[this._rollbackGraphic],postUpdatedGraphics:L})));this._rollbackGraphic=this._edits=null}}},_activateDrawToolbar:function(k){this._layer=k.featureLayer;this._activeType=k.type;this._drawingTool=(this._activeTemplate=k.template)?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,k.featureLayer);y.disconnect(this._dtConnect);var F=this._layer.fields;this._settings.invalidTemplate=
!1;if(this._activeTemplate&&this._activeTemplate.prototype){var L=v.mixin({},this._activeTemplate.prototype.attributes);F=F.filter(function(E){return!1===E.nullable&&!0===E.editable});this._settings.invalidTemplate=F.some(function(E){E=L[E.name];return null===E||void 0===E})}this._dtConnect=this._settings.createOnlyLayer[k.featureLayer.id]||this._settings.invalidTemplate?y.connect(this._drawToolbar,"onDrawEnd",this,"_saveFeatureOnClient"):y.connect(this._drawToolbar,"onDrawEnd",this,"_createFeature");
this.editToolbar.deactivate();this._disableMapClickHandler();this.drawingToolbar?this.drawingToolbar.activateEditing(this._drawTool,this._layer):this._drawToolbar.activate(this._drawTool)},_activateEditToolbar:function(k,F){var L=k.getLayer(),E=L?L.geometryType:null,K=this._isTextSymbolPoint(k),P=G.MOVE;"esriGeometryPoint"!==E&&!0===this._isNotesFeature(k)?(P=P|G.ROTATE|G.SCALE,this._editVertices=!1):"esriGeometryPoint"!==E&&!0===this._editVertices?(P=P|G.ROTATE|G.SCALE,this._editVertices=!1):K?(P=
P|G.ROTATE|G.SCALE|G.EDIT_TEXT,this._editVertices=!1):(P|=G.EDIT_VERTICES,this._editVertices=!0);this._attributeChanged=this._isModified();this._rollbackGraphic=new d(k.toJson());E=L.getEditCapabilities({feature:k,userId:this._settings.userIds[L.id]});var U=z.filter(this._settings.layerInfos,function(Y){return Y.featureLayer.layerId===L.layerId})[0];E.canUpdate&&!U.disableGeometryUpdate&&E.canUpdateGeometry&&(this.editToolbar.activate(P,k),K&&(this.editToolbar._textEditor._addTextBox(k),this.editToolbar._textSymbolEditor&&
this.editToolbar._textSymbolEditor.hide()));this._settings.map.infoWindow.isShowing||this._updateAttributeDisabled(k)||(k=F&&F.screenPoint||this._findCenterPoint(k),this._showInfoWindow(k,this._settings.map.getInfoWindowAnchor(k)))},_createGraphic:function(k,F){var L=new d(k,this._activeType&&this._activeType.symbol||this._layer.defaultSymbol,F);this._activeTemplate||F?L.attributes=F||v.mixin({},this._activeTemplate.prototype.attributes):(L.attributes=L.attributes||[],z.forEach(this._layer.fields,
function(E){L.attributes[E.name]=null},this));return L},_connectEvents:function(){var k=this._settings.layers;z.forEach(k,function(F){this._connect(F,"onEditsComplete",v.hitch(this,"_stopEditing",F))},this);z.forEach(k,function(F){this._connect(F,"onBeforeApplyEdits",v.hitch(this,function(){e.show(this.progressBar.domNode);this._settings._isApplyEditsCall=!0}))},this);this._connect(this.editToolbar,"onGraphicClick",v.hitch(this,"_activateEditToolbar"));this._connect(this.editToolbar,"onGraphicFirstMove",
v.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onVertexFirstMove",v.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onScaleStart",v.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onRotateStart",v.hitch(this,"_hideAttributeInspector"))},_connect:function(k,F,L){this._eConnects.push(y.connect(k,F,L))},_createWidgets:function(){this._selectionHelper=new B(this._settings);this._createTemplatePicker();this._createAttributeInspector();
this._createDrawingToolbar();this._createUndoRedoManager()},_createTemplatePicker:function(){if(this._settings.templatePicker)this.templatePicker=this._settings.templatePicker,e.hide(this.templatePickerDiv);else{var k=z.filter(this._settings.layers,function(F){return F.getEditCapabilities().canCreate});this.templatePicker=new J({"class":"esriTemplatePicker",featureLayers:k,showTooltip:!0,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},this.templatePickerDiv);this.templatePicker.startup();
this._settings.templatePicker=this.templatePicker}this._templatePickerOnSelectionChangeEvent=y.connect(this.templatePicker,"onSelectionChange",v.hitch(this,"_onCreateFeature"))},_createAttributeInspector:function(){var k=this._settings.map;this._settings.attributeInspector?(this._customAttributeInspector=!0,this.attributeInspector=this._settings.attributeInspector):(this._customAttributeInspector=!1,this.attributeInspector=new T({layerInfos:this._settings.layerInfos,hideNavButtons:this._usePopup,
datePackage:this._datePackage},l.create("div")),this.attributeInspector.startup(),k.infoWindow.setContent(this.attributeInspector.domNode),k.infoWindow.setTitle(R.widgets.attributeInspector.NLS_title),k.infoWindow.resize(350,375),m.query(".esriAttributeInspector .atiLayerName").style({display:"none"}));this._connect(this.attributeInspector,"onDelete",v.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",v.hitch(this,function(F){this._updateCurrentFeature(v.hitch(this,function(){this._attributeChanged=
!1;this._onEditFeature(F)}))}));this._usePopup&&k.infoWindow._setPagerCallbacks(this.attributeInspector,v.hitch(this.attributeInspector,"previous"),v.hitch(this.attributeInspector,"next"));this._connect(this.attributeInspector,"onAttributeChange",v.hitch(this,function(F,L,E){if(this._settings.createOnlyLayer[this._layer.id]||this._settings.invalidTemplate)this._saveAttributesOnClient(F,L,E);else{var K=F.getLayer();(K=z.filter(K.fields,function(P){return P.name===L})[0])&&""===E&&(E=null);this._rollbackGraphic=
new d(v.clone(F.toJson()));this.attributeInspector._rollbackInfo={field:K,graphic:this._rollbackGraphic};this._currentGraphic.attributes[L]="number"===typeof E&&isNaN(E)?null:E;this._currentGraphic.setAttributes(this._currentGraphic.attributes);this._updateFeature(this._currentGraphic,null,!0);this._attributeChanged=!1}}))},_createDrawingToolbar:function(){!0===this._settings.toolbarVisible&&(this.drawingToolbar=new C({"class":"esriDrawingToolbar",drawToolbar:this._drawToolbar,editToolbar:this.editToolbar,
settings:this._settings,onDelete:v.hitch(this,"_deleteFeature"),onApplyEdits:v.hitch(this,"_applyEdits"),onShowAttributeInspector:v.hitch(this,"_onEditFeature")},this.drawingToolbarDiv))},_createUndoRedoManager:function(){if(this._settings.enableUndoRedo||this._settings.undoManager)this._settings.enableUndoRedo=!0,this.undoManager=this._settings.undoManager,this.undoManager||(this.undoManager=this._settings.undoManager=new x({maxOperations:this._settings.maxUndoRedoOperations})),this._connect(this.undoManager,
"onUndoComplete",v.hitch(this,this._updateUndoRedoOperations)),this._connect(this.undoManager,"onRedoComplete",v.hitch(this,this._updateUndoRedoOperations)),this._connect(document,"onkeypress",v.hitch(this,function(k){if(k.metaKey||k.ctrlKey)"z"===k.charOrCode&&this._undo(),"y"===k.charOrCode&&this._redo()}))},_updateUndoRedoOperations:function(k){if(k&&k.addedIds){var F;for(F=0;F<this.undoManager.length;F++){var L=this.undoManager.get(F);L&&k.layer===L._featureLayer&&L.updateObjectIds(k.oldIds,k.addedIds)}}k&&
"Update Features"===k.operation.label&&this.attributeInspector.refresh()},_enableMapClickHandler:function(){this._mapClickHandler=y.connect(this._settings.map,"onClick",v.hitch(this,function(k){this._drawToolbar._geometryType||("SELECT"===this._activeTool?this._activeTool="":this._updateCurrentFeature(v.hitch(this,function(){this._reset();this._updateSelection(k)})))}))},_disableMapClickHandler:function(){y.disconnect(this._mapClickHandler)},_onCreateFeature:function(){var k=this.templatePicker.getSelected();
k?this._updateCurrentFeature(v.hitch(this,function(){this._currentGraphic&&this._clearSelection(!1);this._reset();this._activateDrawToolbar(k)})):(this._reset(),y.disconnect(this._dtConnect),this._drawToolbar.deactivate(),this._enableMapClickHandler(),this.drawingToolbar&&this.drawingToolbar.deactivate())},_isTextSymbolPoint:function(k){if("point"===k.geometry.type||"multipoint"===k.geometry.type){var F=k.getLayer(),L=F.renderer;k=k.symbol||F._getSymbol(k);!k&&(L.hasVisualVariables("sizeInfo",!1)||
L.hasVisualVariables("colorInfo",!1)||L.hasVisualVariables("opacityInfo",!1))&&L.addBreak&&L.infos&&1===L.infos.length&&(k=L.infos[0].symbol||L.defaultSymbol);if(k&&"textsymbol"===k.type)return!0}return!1},_isTextSymbolPointLayer:function(k){return"esriGeometryPoint"===k.geometryType&&k.renderer&&k.renderer._symbols&&k.renderer._symbols[0]&&k.renderer._symbols[0].symbol&&"textsymbol"===k.renderer._symbols[0].symbol.type?!0:!1},_updateAttributeDisabled:function(k){k=k.getLayer();if(!k)return!1;var F,
L=!1;for(F=0;F<this._settings.layerInfos.length;F++){var E=this._settings.layerInfos[F];if(E.featureLayer==k){L=E.disableAttributeUpdate;break}}return L},_onEditFeature:function(k,F){if(k=(v.isArray(k)?k[0]:k)||null){this._layer=k.getLayer();if(!this._customAttributeInspector&&!this._updateAttributeDisabled(k)){F=F||this._editClickPoint||this._findCenterPoint(k);if(1<this._currentFeatureCount){var L=this._popupFeatures.indexOf(k);L=b.substitute(R.widgets.popup.NLS_pagingInfo,{index:L+1,total:this._currentFeatureCount})}else L=
this._layer?this._layer.name:R.widgets.attributeInspector.NLS_title;this._settings.map.infoWindow.setTitle(L);if(this.drawingToolbar||!this._settings.map.infoWindow.isShowing)this.attributeInspector.refresh(),this._showInfoWindow(F,this._settings.map.getInfoWindowAnchor(F));this._editClickPoint=null}k!==this._currentGraphic&&(this._editVertices=!0,this._currentGraphic=k,k.getDojoShape()&&k.getDojoShape().moveToFront(),F=this._layer.hasM,this._layer.hasZ&&!this._layer.enableZDefaults||F&&!this._layer.allowUpdateWithoutMValues||
this._activateEditToolbar(k))}},_applyEdits:function(k,F){k=k||[];if(!(0>=k.length)){this._edits=this._oEdits=k;var L=[];z.forEach(k,function(E){E.layer&&L.push(E.layer.applyEdits(E.adds,E.updates,E.deletes))});0<L.length&&(this._deferredsList=(new a(L)).addCallback(v.hitch(this,function(){e.hide(this.progressBar.domNode);F&&F();var E=this._settings.map;E&&E.infoWindow.reposition&&E.infoWindow.isShowing&&E.infoWindow.reposition()})))}},_undo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&
(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.undo())},_redo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.redo())},_simplify:function(k,F){r.prototype.isSelfIntersecting(k)?this._settings.geometryService.simplify([k],function(L){var E=L&&L.length?L[0]:E;F&&F(E)}):F&&F(k)},_autoComplete:function(k,F){var L=this._getLayers("esriGeometryPolygon"),E=new D;E.geometry=k;
E.returnGeometry=!0;this._selectFeatures(L,E,v.hitch(this,function(K){!K||0>=K.length?F&&F([k]):this._settings.geometryService.autoComplete(p.getGeometries(K),this._toPolylines([E.geometry]),function(P){F&&F(P)})}))},_getLayers:function(k){return z.filter(this._settings.layers,function(F){return F.geometryType===k})},_selectFeatures:function(k,F,L,E){this._selectionHelper.selectFeatures(k,F,E||q.SELECTION_NEW,L)},_updateSelection:function(k){var F=k.mapPoint,L=k.graphic,E=this._settings.layerInfos,
K;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,F,q.SELECTION_NEW,v.hitch(this,function(P){var U=z.some(P,v.hitch(this,function(Z){return Z==L}));if(L&&!U)if(U=L.getLayer(),this._isValidLayer(U)){var Y=new D;Y.objectIds=[L.attributes[U.objectIdField]];this._selectionHelper.selectFeatures([U],Y,q.SELECTION_ADD,v.hitch(this,function(Z){Z&&Z.length&&(Z=Z.concat(P),K=A.sortFeaturesById(E,Z),this._updatePopupButtons(K),this._onEditFeature(K,F))}))}else P&&P.length?(K=A.sortFeaturesById(E,
P),this._updatePopupButtons(K),this._onEditFeature(K,F)):this._clearSelection();else P&&P.length?(K=A.sortFeaturesById(E,P),this._updatePopupButtons(K),this._onEditFeature(K,F)):this._clearSelection()}));L&&this._isTextSymbolPoint(L)&&this._isValidLayer(L.getLayer())&&this.editToolbar.activate(0|G.MOVE|G.ROTATE|G.SCALE|G.EDIT_TEXT,L)},_updatePopupButtons:function(k){if(this._usePopup&&k){var F=k.length;z.forEach([this._settings.map.infoWindow._prevFeatureButton,this._settings.map.infoWindow._nextFeatureButton],
v.hitch(this,function(E){1<F?n.remove(E,"hidden"):n.add(E,"hidden")}));var L=1<F?"block":"none";m.query(".esriAttributeInspector .atiLayerName").style({display:L});this._currentFeatureCount=F;this._popupFeatures=k}else this._currentFeatureCount=this._popupFeatures=null},_clearSelection:function(k){this._currentFeatureCount=0;this._popupFeatures=null;this._selectionHelper.clearSelection(k||!1);this._reset()},_findCenterPoint:function(k){k=k.geometry||k;switch(k.type){case "point":var F=k;break;case "polyline":F=
k.getPoint(0,Math.ceil(k.paths[0].length/2));break;case "polygon":F=k.rings.length-1,F=k.getPoint(F,k.rings[F].length-1)}return this._settings.map.toScreen(F)},_hideAttributeInspector:function(){!this._customAttributeInspector&&this._settings.map.infoWindow&&this._settings.map.infoWindow.hide()},_toPolylines:function(k){return z.map(k,function(F){var L=new h(F.spatialReference);z.forEach(F.rings,function(E){L.addPath(E)});return L})},_isNotesFeature:function(k){var F=k.getLayer(),L=F?F.types||null:
null;if(!L)return!1;var E=k.attributes[F.typeIdField],K;z.some(L,function(P){return P.id===E?(K=P.templates,!0):!1});return K?(k=K[0]||null)?this._isShapeTool(k.drawingTool)?!0:!1:!1:!1},_isValidLayer:function(k){var F,L=this._settings.layerInfos;for(F=0;F<L.length;F++){var E=L[F];if(k.id==(E.featureLayer?E.featureLayer.id:E.layerId))return!0}return!1},_isShapeTool:function(k){switch(k){case H.TOOL_ARROW:return t.ARROW;case H.TOOL_LEFT_ARROW:return t.LEFT_ARROW;case H.TOOL_RIGHT_ARROW:return t.RIGHT_ARROW;
case H.TOOL_UP_ARROW:return t.UP_ARROW;case H.TOOL_DOWN_ARROW:return t.DOWN_ARROW;case H.TOOL_CIRCLE:return t.CIRCLE;case H.TOOL_ELLIPSE:return t.ELLIPSE;case H.TOOL_TRIANGLE:return t.TRIANGLE;case H.TOOL_RECTANGLE:return t.RECTANGLE;default:return null}},_toDrawTool:function(k,F){F=F.geometryType;switch(k){case H.TOOL_POINT:return t.POINT;case H.TOOL_ARROW:return t.ARROW;case H.TOOL_LEFT_ARROW:return t.LEFT_ARROW;case H.TOOL_RIGHT_ARROW:return t.RIGHT_ARROW;case H.TOOL_UP_ARROW:return t.UP_ARROW;
case H.TOOL_DOWN_ARROW:return t.DOWN_ARROW;case H.TOOL_CIRCLE:return t.CIRCLE;case H.TOOL_ELLIPSE:return t.ELLIPSE;case H.TOOL_TRIANGLE:return t.TRIANGLE;case H.TOOL_RECTANGLE:return t.RECTANGLE;case H.TOOL_LINE:return t.POLYLINE;case H.TOOL_POLYGON:return t.POLYGON;case H.TOOL_FREEHAND:return"esriGeometryPolyline"===F?t.FREEHAND_POLYLINE:t.FREEHAND_POLYGON;default:return k=t.POINT,"esriGeometryPolyline"===F?(k=t.POLYLINE,this._settings.createOptions.polylineDrawTools[0]===W.CREATE_TOOL_FREEHAND_POLYLINE&&
(k=t.FREEHAND_POLYLINE)):"esriGeometryPolygon"===F&&(k=t.POLYGON,this._settings.createOptions.polygonDrawTools[0]===W.CREATE_TOOL_FREEHAND_POLYGON&&(k=t.FREEHAND_POLYGON)),k}},_isModified:function(){var k=this.editToolbar.getCurrentState();return(k.isModified||this._attributeChanged)&&k.graphic?k.graphic:null},_showInfoWindow:function(k,F){this._customAttributeInspector||this._settings.map.infoWindow.show(k,F)}});v.mixin(W,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",
CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",CREATE_TOOL_LEFT_ARROW:"leftarrow"});c("extend-esri")&&v.setObject("dijit.editing.Editor",W,M);return W})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,p,h,r,d,x,D,q){var H=v(w,{declaredClass:"esri.toolbars.Edit",constructor:function(t,G){this._map=t;this._tool=0;if(this._map.loaded)this._scratchGL=t.graphics;else var T=y.connect(this._map,"onLoad",this,function(){y.disconnect(T);T=null;this._scratchGL=this._map.graphics});t=f("esri-mobile");this._defaultOptions=z.mixin({vertexSymbol:new d(d.STYLE_CIRCLE,t?20:12,new x(x.STYLE_SOLID,new c([0,0,0,.5]),1),new c([128,128,128])),ghostVertexSymbol:new d(d.STYLE_CIRCLE,
t?18:10,new x(x.STYLE_SOLID,new c([0,0,0,.5]),1),new c([255,255,255,.75])),ghostLineSymbol:new x(x.STYLE_DOT,new c([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:t?24:16,boxLineSymbol:new x(x.STYLE_DASH,new c([64,64,64]),1),boxHandleSymbol:new d(d.STYLE_SQUARE,t?16:9,new x(x.STYLE_SOLID,new c([0,0,0,.5]),1),new c([255,255,255,.75])),textAnchorSymbol:new d(d.STYLE_CIRCLE,10,null,new c([255,0,0]))},G||{})},activate:function(t,G,T){this.deactivate();this._graphic=G;this._options=
z.mixin(z.mixin({},this._defaultOptions),T||{});var A=H.MOVE;T=H.EDIT_VERTICES;var S=H.SCALE,O=H.ROTATE,V=H.EDIT_TEXT,I=!1,g=!1,C=!1,B=this._map,J=B.spatialReference,M=G.geometry.spatialReference;this._geo=!(!J||!M||J.equals(M)||!J.isWebMercator()||4326!==M.wkid);this._isTextPoint=this._prepareTextSymbolEditing(G,t);(t&A)===A&&(I=this._enableMove(G));A=(t&S)===S;O=(t&O)===O;if(A||O)C=this._enableBoxEditing(G,A,O);(t&T)===T&&(g=this._enableVertexEditing(G));(t&V)===V&&this._enableTextEditing(G);if(!(I||
g||C))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=t)this._mapPanEndHandle=y.connect(B,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=y.connect(B,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,G);B.snappingManager&&(I||g)&&B.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var t=this._tool,G=this._graphic;if(t){var T=
!!this._modified;this._clear();y.disconnect(this._mapPanEndHandle);y.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(t,G,{isModified:T});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(t,G){},onDeactivate:function(t,G,T){},
onGraphicMoveStart:function(t){},onGraphicFirstMove:function(t){this._modified=!0},onGraphicMove:function(t,G){},onGraphicMoveStop:function(t,G){},onGraphicClick:function(t,G){},onVertexMoveStart:function(t,G){},onVertexFirstMove:function(t,G){this._modified=!0},onVertexMove:function(t,G,T){},onVertexMoveStop:function(t,G,T){},onVertexAdd:function(t,G){this._modified=!0},onVertexClick:function(t,G){},onVertexMouseOver:function(t,G){},onVertexMouseOut:function(t,G){},onVertexDelete:function(t,G){this._modified=
!0},onTextEditStart:function(t,G){},onTextEditEnd:function(t){},onScaleStart:function(t){},onScaleFirstMove:function(t){this._modified=!0},onScale:function(t,G){},onScaleStop:function(t,G){},onRotateStart:function(t){},onRotateFirstMove:function(t){this._modified=!0},onRotate:function(t,G){},onRotateStop:function(t,G){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(t,G){if("point"===t.geometry.type||"multipoint"===t.geometry.type){var T=t.getLayer(),A=T.renderer;T=t.symbol||T._getSymbol(t);!T&&(A.hasVisualVariables("sizeInfo",!1)||A.hasVisualVariables("colorInfo",!1)||A.hasVisualVariables("opacityInfo",!1))&&A.addBreak&&
A.infos&&1===A.infos.length&&(T=A.infos[0].symbol||A.defaultSymbol);if(T&&"textsymbol"===T.type){if((G&H.SCALE)===H.SCALE||(G&H.ROTATE)===H.ROTATE||(G&H.EDIT_TEXT)===H.EDIT_TEXT){t.setSymbol(new D(T.toJson()));var S=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(t),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){S._boxEditor&&S._boxEditor.refresh()})):
N(["../dijit/SymbolEditor"],function(O){if(!S._textSymbolEditor){var V=S._options.textSymbolEditorHolder?a.create("div",null,S._options.textSymbolEditorHolder):a.create("div",null,S._map.root);S._textSymbolEditor=new O({graphic:t},V);O=S._textSymbolEditor.domNode.parentNode.id;n.set(S._textSymbolEditor.domNode,{position:"map_root"===O?"absolute":"relative",left:"map_root"===O?S._map.width/2-100+"px":"5px",top:"20px","z-index":50});S._textSymbolEditor.startup();S._textSymbolEditor.createForm(t);S._textSymbolEditor.show();
S._textSymbolEditor.on("symbol-change",function(){S._boxEditor&&S._boxEditor.refresh()})}})}if((G&H.MOVE)===H.MOVE||(G&H.ROTATE)===H.ROTATE||(G&H.SCALE)===H.SCALE)this._textAnchor=new q(t.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(t){var G=this._map;switch(t.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new p(t,G,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(t){var G=
this._map;switch(t.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=h.create(t,G,this),!0}return!1},_enableBoxEditing:function(t,G,T){var A=this._map,S=t.geometry.type;return"polyline"===S||"polygon"===S||this._isTextPoint?(this._boxEditor=new e(t,A,this,G,T,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(t){return this._isTextPoint?(this._textEditor=new r(t,this._map,this),y.connect(this._textEditor,"onEditStart",z.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var t=this._graphicMover;t&&(t.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var t=this._vertexEditor;t&&(t.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var t=this._boxEditor;t&&(t.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(t,G,T){T&&this._refreshMoveables()},_refreshMoveables:function(t){var G=m.filter([this._graphicMover,this._vertexEditor,this._boxEditor],b.isDefined);m.forEach(G,function(T){T.refresh(t)})},_beginOperation:function(t){m.forEach(this._getAffectedTools(t),function(G){G.suspend()})},_endOperation:function(t){m.forEach(this._getAffectedTools(t),function(G){G.resume()})},_getAffectedTools:function(t){var G=[];switch(t){case "MOVE":G=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":G=[this._boxEditor];break;case "BOX":G=[this._vertexEditor]}return G=m.filter(G,b.isDefined)}});z.mixin(H,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});f("extend-esri")&&z.setObject("toolbars.Edit",H,l);return H})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,p,h,r){N=N(null,{declaredClass:"esri.toolbars._Box",constructor:function(d,x,D,q,H,t,G){this._graphic=d;this._map=x;this._toolbar=D;this._scale=q;this._rotate=H;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=t;d=D._options;this._markerSymbol=d.boxHandleSymbol;this._lineSymbol=d.boxLineSymbol;this._moveStartHandler=v.hitch(this,this._moveStartHandler);this._firstMoveHandler=v.hitch(this,this._firstMoveHandler);
this._moveStopHandler=v.hitch(this,this._moveStopHandler);this._moveHandler=v.hitch(this,this._moveHandler);this._isTextPoint=G;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){z.forEach(this._getAllGraphics(),function(d){d.hide()})},resume:function(){z.forEach(this._getAllGraphics(),function(d){d.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
z.forEach(this._connects,y.disconnect);var d=this._toolbar._scratchGL;this._anchors&&z.forEach(this._anchors,function(x){d.remove(x.graphic);(x=x.moveable)&&x.destroy()});this._box&&d.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var d=this._map,x=this._toolbar._scratchGL,D=this._getBoxCoords(),q=new w(d.spatialReference),H=v.clone(z.filter(D,function(t,G){return 8!==G&&0===G%2}));H[0]&&H.push([H[0][0],H[0][1]]);q.addPath(H);this._rotate&&
q.addPath([D[1],D[8]]);this._box?this._box.setGeometry(q):(this._box=new r(q,this._lineSymbol),x.add(this._box));this._anchors?z.forEach(this._anchors,function(t,G){this._scale||(G=8);var T=new u(D[G],d.spatialReference);t.graphic.setGeometry(T);T=t.moveable;var A=t.graphic.getDojoShape();A&&(T?A!==T.shape&&(T.destroy(),t.moveable=this._getMoveable(t.graphic,G)):t.moveable=this._getMoveable(t.graphic,G))},this):(this._anchors=[],this._connects=[],z.forEach(D,function(t,G){!this._scale&&8>G||(t=new u(t,
d.spatialReference),t=new r(t,this._markerSymbol),this._isTextPoint&&1===G%2&&t.hide(),x.add(t),this._anchors.push({graphic:t,moveable:this._getMoveable(t,G)}))},this))}else this._cleanUp()},_getBoxCoords:function(d){var x=this._map,D=[],q,H,t;if(this._isTextPoint){var G=this._graphic.getNode().getBoundingClientRect();var T=x.__container.getBoundingClientRect();G=[{x:G.left-T.left,y:G.top-T.top},{x:G.right-T.left,y:G.top-T.top},{x:G.right-T.left,y:G.bottom-T.top},{x:G.left-T.left,y:G.bottom-T.top}]}else G=
this._getTransformedBoundingBox(this._graphic);z.forEach(G,function(A,S,O){q=A;(H=O[S+1])||(H=O[0]);t={x:(q.x+H.x)/2,y:(q.y+H.y)/2};d||(q=x.toMap(q),t=x.toMap(t));D.push([q.x,q.y]);D.push([t.x,t.y])});this._rotate&&(G=v.clone(D[1]),G=d?{x:G[0],y:G[1]}:x.toScreen({x:G[0],y:G[1],spatialReference:x.spatialReference}),G.y-=this._toolbar._options.rotateHandleOffset,d||(G=x.toMap(G)),D.push([G.x,G.y]));return D},_getTransformedBoundingBox:function(d){var x=this._map,D=d.geometry.getExtent(),q=d.geometry.spatialReference;
d=new u(D.xmin,D.ymax,q);D=new u(D.xmax,D.ymin,q);d=x.toScreen(d);D=x.toScreen(D);return[{x:d.x,y:d.y},{x:D.x,y:d.y},{x:D.x,y:D.y},{x:d.x,y:D.y}]},_getAllGraphics:function(){var d=[this._box];this._anchors&&z.forEach(this._anchors,function(x){d.push(x.graphic)});return d=z.filter(d,b.isDefined)},_getMoveable:function(d,x){var D=d.getDojoShape();if(D)return d=new a(D),d._index=x,this._connects.push(y.connect(d,"onMoveStart",this._moveStartHandler)),this._connects.push(y.connect(d,"onFirstMove",this._firstMoveHandler)),
this._connects.push(y.connect(d,"onMoveStop",this._moveStopHandler)),d.onMove=this._moveHandler,(D=D.getEventSource())&&f.set(D,"cursor",this._toolbar._cursors["box"+x]),d},_moveStartHandler:function(d){this._toolbar["on"+(8===d.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(d){this._toolbar._deactivateScrollWheel();var x=d.host._index,D=this._wrapOffset=d.host.shape._wrapOffsets[0]||0,q=this._graphic.getLayer().getNavigationTransform();d=z.map(this._getBoxCoords(!0),
function(t){return{x:t[0]+D,y:t[1]}});var H=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:d[1].x,y:d[3].y};this._centerCoord=n.multiplyPoint(n.invert(q),H);if(8===x)H=n.multiplyPoint(n.invert(q),d[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,H)),this._startLine=[this._centerCoord,H],this._moveLine=v.clone(this._startLine);else if(H=n.multiplyPoint(n.invert(q),d[x]),q=n.multiplyPoint(n.invert(q),d[(x+4)%8]),this._isTextPoint&&(this._centerCoord=
this._deNormalizePoint(this._centerCoord,H)),this._firstMoverToAnchor=Math.sqrt((H.x-this._centerCoord.x)*(H.x-this._centerCoord.x)+(H.y-this._centerCoord.y)*(H.y-this._centerCoord.y)),this._startBox=q,this._startBox.width=d[4].x-d[0].x,this._startBox.height=d[4].y-d[0].y,this._moveBox=v.clone(this._startBox),this._xfactor=H.x>q.x?1:-1,this._yfactor=H.y>q.y?1:-1,1===x||5===x)this._xfactor=0;else if(3===x||7===x)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===x?this._rotateEvent:
this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(d,x){d=d.host._index;var D=this._defaultEventArgs;D.angle=0;D.scaleX=1;D.scaleY=1;if(8===d){var q=this._startLine;var H=this._moveLine;var t=H[1];t.x+=x.dx;t.y+=x.dy;x=this._getAngle(q,H);this._isTextPoint&&(x+=this._graphic.symbol.angle);H=n.rotategAt(x,q[0]);this._graphic.getDojoShape().setTransform(H);D.transform=H;D.angle=x;D.around=q[0]}else{q=this._startBox;H=this._moveBox;H.width+=x.dx*this._xfactor;H.height+=x.dy*this._yfactor;
this._uniformScaling||this._isTextPoint?(q=H.x+this._xfactor*H.width,H=H.y+this._yfactor*H.height,q=Math.sqrt((q-this._centerCoord.x)*(q-this._centerCoord.x)+(H-this._centerCoord.y)*(H-this._centerCoord.y)),this._scaleRatio=x=t=q/this._firstMoverToAnchor,q=this._centerCoord):(x=H.width/q.width,t=H.height/q.height,q={x:q.x,y:q.y});if(isNaN(x)||Infinity===x||-Infinity===x)x=1;if(isNaN(t)||Infinity===t||-Infinity===t)t=1;H=n.scaleAt(x,t,q);if(this._isTextPoint){var G=n.rotategAt(this._graphic.symbol.angle,
q);this._graphic.getDojoShape().setTransform([G,H])}else this._graphic.getDojoShape().setTransform(H);D.transform=H;D.scaleX=x;D.scaleY=t;D.around=q}this._toolbar["on"+(8===d?this._rotateEvent:this._scaleEvent)](this._graphic,D)},_moveStopHandler:function(d){this._toolbar._activateScrollWheel();var x=this._graphic,D=this._toolbar,q=D._geo?p.geographicToWebMercator(x.geometry):x.geometry,H=q.spatialReference,t=x.getDojoShape(),G=t.getTransform(),T=x.getLayer().getNavigationTransform();this._isTextPoint?
(x=this._graphic.symbol,8===d.host._index?x.angle+=this._getAngle(this._startLine,this._moveLine):x.font.setSize(Math.round(x.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(x)):(q=q.toJson(),this._updateSegments(q.paths||q.rings,G,T,H),t.setTransform(null),q=h.fromJson(q),x.setGeometry(D._geo?p.webMercatorToGeographic(q,!0):q));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;D._endOperation("BOX");this._defaultEventArgs.transform=
G;D["on"+(8===d.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(d,x,D,q){var H=this._map,t=this._wrapOffset||0;z.forEach(d,function(G){z.forEach(G,function(T){this._updatePoint(T,q,t,n,H,D,x)},this)},this)},_updatePoint:function(d,x,D,q,H,t,G){x=H.toScreen({x:d[0],y:d[1],spatialReference:x},!0);x.x+=D;x=q.multiplyPoint([t,G,q.invert(t)],x);x.x-=D;D=H.toMap(x);d[0]=D.x;d[1]=D.y},_getAngle:function(d,x){return 180*Math.atan2(x[0].y-
x[1].y,x[0].x-x[1].x)/Math.PI-180*Math.atan2(d[0].y-d[1].y,d[0].x-d[1].x)/Math.PI},_deNormalizePoint:function(d,x){var D=this._map._getFrameWidth();if(-1===D)return d;for(d={x:d.x,y:d.y};Math.abs(d.x-x.x)>=D;)d.x=d.x<x.x?d.x+D:d.x-D;var q=Math.abs(d.x-x.x);Math.abs(d.x-x.x+D)<q?d.x+=D:Math.abs(d.x-x.x-D)<q&&(d.x-=D);return d}});c("extend-esri")&&v.setObject("toolbars._Box",N,l);return N})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(N,v,z,y,m,c,f,a,n,l){return v("dojox.gfx.Moveable",null,{constructor:function(b,u){this.shape=b;this.delay=u&&0<u.delay?u.delay:0;this.mover=u&&u.mover?u.mover:n;this.leftButtonOnly=u&&u.leftButtonOnly;this.events=[this.shape.on(c.press,N.hitch(this,"onMouseDown"))]},destroy:function(){z.forEach(this.events,function(b){b.remove()});this.events=this.shape=null},onMouseDown:function(b){this.delay?(this.events.push(this.shape.on(c.move,N.hitch(this,"onMouseMove")),this.shape.on(c.release,N.hitch(this,
"onMouseUp"))),this._lastX=b.clientX,this._lastY=b.clientY):this.leftButtonOnly&&!l.isLeft(b)||new this.mover(this.shape,b,this);y.stop(b)},onMouseMove:function(b){var u=b.clientY;if(Math.abs(b.clientX-this._lastX)>this.delay||Math.abs(u-this._lastY)>this.delay)this.onMouseUp(b),new this.mover(this.shape,b,this);y.stop(b)},onMouseUp:function(b){this.events.pop().remove()},onMoveStart:function(b){m.publish("/gfx/move/start",b);f.add(a.body(),"dojoMove")},onMoveStop:function(b){m.publish("/gfx/move/stop",
b);f.remove(a.body(),"dojoMove")},onFirstMove:function(b){},onMove:function(b,u,w){this.onMoving(b,u,w);this.shape.applyLeftTransform(u);this.onMoved(b,u)},onMoving:function(b,u){},onMoved:function(b,u){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(N,v,z,y,m,c){return z("dojox.gfx.Mover",null,{constructor:function(f,a,n){this.shape=f;this.lastX=a.clientX;this.lastY=a.clientY;f=this.host=n;a=
document;n=y(a,m.move,N.hitch(this,"onFirstMove"));this.events=[y(a,m.move,N.hitch(this,"onMouseMove")),y(a,m.release,N.hitch(this,"destroy")),y(a,"dragstart",N.hitch(c,"stop")),y(a,"selectstart",N.hitch(c,"stop")),n];if(f&&f.onMoveStart)f.onMoveStart(this)},onMouseMove:function(f){var a=f.clientX,n=f.clientY;this.host.onMove(this,{dx:a-this.lastX,dy:n-this.lastY},f);this.lastX=a;this.lastY=n;c.stop(f)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){v.forEach(this.events,
function(a){a.remove()});var f=this.host;if(f&&f.onMoveStop)f.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u,w,e){var p=N(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(h,r,d,x){this.graphic=h;this.map=r;this.toolbar=d;this.tempPt=x;this._enableGraphicMover();this._moved=!1},refresh:function(h){var r=this.graphic.getDojoShape();!r||!h&&r._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var h=this.graphic,r=h.getDojoShape();r&&(r._hostGraphic=h,this._moveable=new c(r,{mover:p.Mover}),this._moveStartHandle=
z.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=z.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=z.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=z.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(h=r.getEventSource())&&m.set(h,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var h=this._moveable;if(h){z.disconnect(this._moveStartHandle);z.disconnect(this._firstMoveHandle);
z.disconnect(this._movingHandle);z.disconnect(this._moveStopHandle);var r=h.shape;r&&(r._hostGraphic=null,(r=r.getEventSource())&&m.set(r,"cursor","inherit"));h.destroy()}this._moveable=null},_moveStartHandler:function(){var h=this.graphic,r=this.map;this._startTx=h.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&r.snappingManager&&r.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(h)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(h,r,d){h=h.shape.getTransform();r=this.map;var x;b("esri-pointer")?x=r.navigationManager.pointerEvents._processTouchEvent(d,d):d&&"pointermove"===d.type&&(x=l.prototype._processTouchEvent.call({map:r},d,d));x&&r.snappingManager&&r.snappingManager._onSnappingMouseMoveHandler(x);this.tempPt&&this.tempPt.getDojoShape().setTransform(h);this.toolbar.onGraphicMove(this.graphic,h)},_moveStopHandler:function(h){var r=this.graphic,d=this.toolbar,x=this.map,D=d._geo?u.geographicToWebMercator(r.geometry):
r.geometry,q=D.type,H=r.getDojoShape(),t=H.getTransform();if(y.toJson(t)!==y.toJson(this._startTx)){this._moved=!0;switch(q){case "point":q=[t,a.invert(this._startTx)];if(x.snappingManager)var G=x.snappingManager._snappingPoint;D=G||x.toMap(a.multiplyPoint(q,x.toScreen(D,!0)));x.snappingManager&&x.snappingManager._killOffSnapping();break;case "polyline":D=this._updatePolyGeometry(D,D.paths,t);break;case "polygon":D=this._updatePolyGeometry(D,D.rings,t)}H.setTransform(null);r.setGeometry(d._geo?u.webMercatorToGeographic(D,
!0):D);this.tempPt&&this.tempPt.setGeometry(new e(r.geometry.toJson()))}else this._moved=!1;d._endOperation("MOVE");d.onGraphicMoveStop(r,t);this._moved||(h=h.__e,x=this.map.position,h=new w(h.pageX-x.x,h.pageY-x.y),d.onGraphicClick(r,{screenPoint:h,mapPoint:this.map.toMap(h)}))},_updatePolyGeometry:function(h,r,d){var x=this.map,D=h.getPoint(0,0);x=x.toMap(x.toScreen(D).offset(d.dx,d.dy));d=x.x-D.x;D=x.y-D.y;var q;for(x=0;x<r.length;x++){var H=r[x];for(q=0;q<H.length;q++){var t=h.getPoint(x,q);h.setPoint(x,
q,t.offset(d,D))}}return h}});p.Mover=N(f,{declaredClass:"esri.toolbars._Mover",constructor:function(h,r,d){this.__e=r}});b("extend-esri")&&(v.setObject("toolbars._GraphicMover",p,n),v.setObject("toolbars._Mover",p.Mover,n));return p})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(N,
v,z,y,m,c,f,a,n,l,b,u){var w=N(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(e,p,h){this.graphic=e;this.map=p;this.toolbar=h;e=h._options;this._symbol1=e.vertexSymbol;this._symbol2=e.ghostVertexSymbol;p=e.ghostLineSymbol;this._lineStroke={style:p.style,width:p.width,color:p.color};this._canDel=e.allowDeleteVertices;this._canAdd=e.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(e){e?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=z.connect(n,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=z.connect(n,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var e=this._getGraphicsLayer();this._mouseOverHandle=z.connect(e,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=z.connect(e,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new c({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),e=this._ctxDelete=new f({label:u.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
z.connect(e,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(e),this._ctxMenu.startup())},_removeControllers:function(){z.disconnect(this._firstMoveHandle);z.disconnect(this._moveStopHandle);z.disconnect(this._mouseOverHandle);z.disconnect(this._mouseOutHandle);z.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(e,p,h){var r,d,x=this.graphic,D=[];for(r=0;r<e.length;r++){var q=e[r],H=[];for(d=0;d<q.length;d++)H.push(new n(q[d],p,x,r,d,q.length,this,h));D.push(H)}return D},_remove:function(e){e&&y.forEach(e,function(p){y.forEach(p,function(h){h.destroy()})})},_refresh:function(e){e&&y.forEach(e,function(p){y.forEach(p,function(h){h.refresh()})})},_isNew:function(e){return-1===y.indexOf(this._vertexMovers[e.segIndex],e)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(e){e=this._selectedMover;this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(e);this._deleteVertex(e);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(e){e=e.graphic;var p=this._findMover(e);p&&(this.toolbar.onVertexMouseOver(this.graphic,p._getInfo()),p._placeholder||(this._selectedMover=p,this._canDel&&this._bindCtxNode(e.getDojoShape().getNode())))},_mouseOutHandler:function(e){if(e=
this._findMover(e.graphic))this.toolbar.onVertexMouseOut(this.graphic,e._getInfo())},_bindCtxNode:function(e){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(e);this._bindNode=e},_unbindCtxNode:function(){var e=this._bindNode;e&&this._ctxMenu.unBindDomNode(e)},_findMover:function(e){var p=[];var h=this._mpVertexMovers;y.forEach(this._vertexMovers,function(d){p=p.concat(d)});h&&y.forEach(h,function(d){p=p.concat(d)});
for(h=0;h<p.length;h++){var r=p[h];if(r.graphic===e)return r}},_firstMoveHandler:function(e){!this._isNew(e)&&this._canAdd&&this._hideRelatedMidpoints(e);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(e,p){var h=this._isNew(e);p&&(p.dx||p.dy)?(this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength,h),this._canAdd&&(h?this._addMidpoints(e):(this._repositionRelatedMidpoints(e),this._showRelatedMidpoints(e))),this.toolbar._endOperation("VERTICES")):
!h&&this._canAdd&&this._showRelatedMidpoints(e)},_showRelatedMidpoints:function(e){var p=this._getAdjacentMidpoints(e.ptIndex,e.segLength),h=this._mpVertexMovers[e.segIndex];for(e=0;e<p.length;e++){var r=h[p[e]];r.graphic.show();r.refresh()}},_hideRelatedMidpoints:function(e){var p=this._getAdjacentMidpoints(e.ptIndex,e.segLength),h=this._mpVertexMovers[e.segIndex];for(e=0;e<p.length;e++)h[p[e]].graphic.hide()},_repositionRelatedMidpoints:function(e){var p,h=this._getAdjacentMidpoints(e.ptIndex,e.segLength),
r=this._mpVertexMovers[e.segIndex];for(p=0;p<h.length;p++){var d=this._getAdjacentVertices(h[p],e.segLength),x=e.relatedGraphic.geometry.getPoint(e.segIndex,d[0]);d=e.relatedGraphic.geometry.getPoint(e.segIndex,d[1]);x=new l({x:(x.x+d.x)/2,y:(x.y+d.y)/2,spatialReference:x.spatialReference.toJson()});r[h[p]].graphic.setGeometry(x)}},_addMidpoints:function(e){var p=e.segIndex,h=e.ptIndex,r=e.segLength,d=h+1,x,D=r+1;this._mpVertexMovers[p].splice(h,1);var q=this._vertexMovers[p];for(x=0;x<d;x++)q[x].segLength+=
1;for(x=d;x<q.length;x++)q[x].ptIndex+=1,q[x].segLength+=1;e.ptIndex=d;e.segLength=q.length+1;q.splice(d,0,e);e.graphic.setSymbol(this._symbol1);q=this._mpVertexMovers[p];for(x=0;x<h;x++)q[x].segLength+=1;for(x=h;x<r-1;x++)q[x].ptIndex+=1,q[x].segLength+=1;d=this._getAdjacentVertices(h,D);p=this._getAdjacentVertices(h+1,D);r=e.relatedGraphic.geometry.getPoint(e.segIndex,d[0]);x=e.relatedGraphic.geometry.getPoint(e.segIndex,d[1]);d=new l({x:(r.x+x.x)/2,y:(r.y+x.y)/2,spatialReference:r.spatialReference.toJson()});
r=e.relatedGraphic.geometry.getPoint(e.segIndex,p[0]);x=e.relatedGraphic.geometry.getPoint(e.segIndex,p[1]);p=new l({x:(r.x+x.x)/2,y:(r.y+x.y)/2,spatialReference:r.spatialReference.toJson()});r=new n(d,this._symbol2,this.graphic,e.segIndex,h,D,this,!0);e=new n(p,this._symbol2,this.graphic,e.segIndex,h+1,D,this,!0);q.splice(h,0,r,e)},_deleteVertex:function(e){var p,h=e.ptIndex,r=this._vertexMovers[e.segIndex];for(p=0;p<h;p++)--r[p].segLength;for(p=h+1;p<r.length;p++){var d=r[p];--d.ptIndex;--d.segLength}r.splice(h,
1);p=e._getInfo();e.destroy();this.toolbar.onVertexDelete(this.graphic,p)}});v.mixin(w,{create:function(e,p,h){switch(e.geometry.type){case "multipoint":return new w.MultipointVertexEditor(e,p,h);case "polyline":return new w.PolylineVertexEditor(e,p,h);case "polygon":return new w.PolygonVertexEditor(e,p,h)}}});w.MultipointVertexEditor=N(w,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=z.connect(n,"onMoveStart",this,this._moveStartHandler);
z.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);z.disconnect(this._moveStartHandle)},_getSegments:function(e){var p=e.points,h=[],r=e.spatialReference;for(e=0;e<p.length;e++){var d=p[e];h.push(new l({x:d[0],y:d[1],spatialReference:r.toJson()}))}return[h]},_getMidpointSegments:function(e){return[]},_getControlPoints:function(e,p,h,r,d){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(e){var p=e.graphic;if(e=this._findMover(e))this.toolbar.onVertexMouseOver(p,
e._getInfo()),this._selectedMover=e,this._canDel&&this._bindCtxNode(e.graphic.getDojoShape().getNode())},_mouseOutHandler:function(e){var p=e.graphic;if(e=this._findMover(e))this.toolbar.onVertexMouseOut(p,e._getInfo())},_findMover:function(e){var p=[].concat(this._vertexMovers[0]),h=e.target;for(e=0;e<p.length;e++){var r=p[e];if(r.graphic.getDojoShape().getNode()===h)return r}},_moveStartHandler:function(e){var p=e.ptIndex,h=e.segLength-1,r=e.relatedGraphic.geometry.points;e=r.splice(p,1);r.push(e[0]);
r=this._vertexMovers[0];for(e=h;e>p;e--)--r[e].ptIndex;e=r.splice(p,1);r.push(e[0]);e[0].ptIndex=h},_moveStopHandler:function(e){this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(e,p,h,r,d,x,D,q){e=p.geometry;q?e.removePoint(d):e.setPoint(d,h);p.setGeometry(e)},_deleteMidpoints:function(e){}});w.PolylineVertexEditor=N(w,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(e){var p,h,r=e.paths,d=[];for(p=0;p<r.length;p++){var x=r[p],D=[];for(h=0;h<x.length;h++)D.push(e.getPoint(p,h));d.push(D)}return d},_getMidpointSegments:function(e){var p,h,r=e.paths,d=[],x=e.spatialReference;for(p=0;p<r.length;p++){var D=r[p],q=[];for(h=0;h<D.length-1;h++){var H=e.getPoint(p,h),t=e.getPoint(p,h+1);H=new l({x:(H.x+t.x)/2,y:(H.y+t.y)/2,spatialReference:x.toJson()});q.push(H)}d.push(q)}return d},_getControlPoints:function(e,p,h,r,d){var x=this.map,D,q;this._isNew(e)?
(e=r,r+=1,0<=e&&(D=x.toScreen(p.getPoint(h,e))),r<=d&&(q=x.toScreen(p.getPoint(h,r)))):(e=r-1,r+=1,0<=e&&(D=x.toScreen(p.getPoint(h,e))),r<d&&(q=x.toScreen(p.getPoint(h,r))));return[D,q]},_getAdjacentMidpoints:function(e,p){var h=[],r=e-1;0<=r&&h.push(r);e<p-1&&h.push(e);return h},_getAdjacentVertices:function(e,p){return[e,e+1]},_deleteMidpoints:function(e){var p=this._mpVertexMovers[e.segIndex],h=p.length-1,r=this._getAdjacentMidpoints(e.ptIndex,e.segLength).sort(),d,x=r[0];for(d=0;d<x;d++)--p[d].segLength;
for(d=x+1;d<p.length;d++){var D=p[d];--D.ptIndex;--D.segLength}if(1===r.length)p.splice(x,1)[0].destroy();else for(D=this._getAdjacentVertices(x,h),d=e.relatedGraphic.geometry.getPoint(e.segIndex,D[0]),D=e.relatedGraphic.geometry.getPoint(e.segIndex,D[1]),d=new l({x:(d.x+D.x)/2,y:(d.y+D.y)/2,spatialReference:d.spatialReference.toJson()}),e=new n(d,this._symbol2,this.graphic,e.segIndex,x,h,this,!0),p=p.splice(x,r.length,e),d=0;d<p.length;d++)p[d].destroy()},_updateRelatedGraphic:function(e,p,h,r,d,
x,D,q){e=p.geometry;D?e.insertPoint(r,d+1,b.fromJson(h.toJson())):q?e.removePoint(r,d):e.setPoint(r,d,b.fromJson(h.toJson()));p.setGeometry(e)}});w.PolygonVertexEditor=N(w,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(e){var p,h,r=e.rings,d=[];for(p=0;p<r.length;p++){var x=r[p],D=[];for(h=0;h<x.length-1;h++)D.push(e.getPoint(p,h));d.push(D)}return d},_getMidpointSegments:function(e){var p,h,r=e.rings,d=[],x=e.spatialReference;for(p=0;p<r.length;p++){var D=r[p],
q=[];for(h=0;h<D.length-1;h++){var H=e.getPoint(p,h),t=e.getPoint(p,h+1);H=new l({x:(H.x+t.x)/2,y:(H.y+t.y)/2,spatialReference:x.toJson()});q.push(H)}d.push(q)}return d},_getControlPoints:function(e,p,h,r,d){var x=this.map;this._isNew(e)?e=r:(e=r-1,e=0>e?(d+e)%d:e);r=(r+1)%d;d=x.toScreen(p.getPoint(h,e));p=x.toScreen(p.getPoint(h,r));return[d,p]},_getAdjacentMidpoints:function(e,p){var h=e-1;return[0>h?(p+h)%p:h,e]},_getAdjacentVertices:function(e,p){return[e,(e+1)%p]},_deleteMidpoints:function(e){var p=
e.ptIndex,h=this._mpVertexMovers[e.segIndex],r=h.length-1,d=this._getAdjacentMidpoints(p,e.segLength).sort();var x=d[0];var D=d[d.length-1];if(0===p){var q=this._getAdjacentVertices(r-1,r);p=e.relatedGraphic.geometry.getPoint(e.segIndex,q[0]);q=e.relatedGraphic.geometry.getPoint(e.segIndex,q[1]);p=new l({x:(p.x+q.x)/2,y:(p.y+q.y)/2,spatialReference:p.spatialReference.toJson()});e=new n(p,this._symbol2,this.graphic,e.segIndex,r-1,r,this,!0);h.splice(D,1,e)[0].destroy();h.splice(x,1)[0].destroy();for(d=
0;d<h.length-1;d++)x=h[d],--x.ptIndex,--x.segLength}else{q=this._getAdjacentVertices(x,r);p=e.relatedGraphic.geometry.getPoint(e.segIndex,q[0]);q=e.relatedGraphic.geometry.getPoint(e.segIndex,q[1]);p=new l({x:(p.x+q.x)/2,y:(p.y+q.y)/2,spatialReference:p.spatialReference.toJson()});e=new n(p,this._symbol2,this.graphic,e.segIndex,x,r,this,!0);D=h.splice(x,d.length,e);for(d=0;d<D.length;d++)D[d].destroy();for(d=0;d<x;d++)--h[d].segLength;for(d=x+1;d<h.length;d++)x=h[d],--x.ptIndex,--x.segLength}},_updateRelatedGraphic:function(e,
p,h,r,d,x,D,q){e=p.geometry;D?e.insertPoint(r,d+1,b.fromJson(h.toJson())):q?(e.removePoint(r,d),0===d&&e.setPoint(r,x-1,b.fromJson(e.getPoint(r,0).toJson()))):(e.setPoint(r,d,b.fromJson(h.toJson())),0===d&&e.setPoint(r,x,b.fromJson(h.toJson())));p.setGeometry(e)}});m("extend-esri")&&(v.setObject("toolbars._GraphicVertexEditor",w,a),v.setObject("toolbars._MultipointVertexEditor",w.MultipointVertexEditor,a),v.setObject("toolbars._PolylineVertexEditor",w.PolylineVertexEditor,a),v.setObject("toolbars._PolygonVertexEditor",
w.PolygonVertexEditor,a));return w})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u,w){N=N(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(e,p,h,r,d,x,D,q){this.point=e;this.symbol=p;this.relatedGraphic=h;this.segIndex=r;this.ptIndex=
d;this.segLength=x;this.editor=D;this.map=D.map;this._scratchGL=D.toolbar._scratchGL;this._placeholder=q||!1;this._type=h.geometry.type;this._init();this._enable()},refresh:function(e){if(e||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var e=new b(this.point.toJson());
e=new u(e,this.symbol);switch(this._type){case "multipoint":e._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(e)}this.graphic=e},_enable:function(){var e=this.graphic.getDojoShape();e&&(e._hasMover=!0,this._moveable=this._getMoveable(e),(e=e.getEventSource())&&m.set(e,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var e=this._moveable;if(e){z.disconnect(this._startHandle);
z.disconnect(this._firstHandle);z.disconnect(this._movingHandle);z.disconnect(this._stopHandle);var p=e.shape;p&&(p=p.getEventSource())&&m.set(p,"cursor","inherit");e.destroy();this._moveable=null}},_needRefresh:function(){var e=this.graphic.getDojoShape(),p=!1;if(e)switch(this._type){case "multipoint":var h=this.relatedGraphic.getDojoShape();h&&(h=h.children[this.ptIndex],e!==h&&(this.graphic._shape=h,p=!0));break;case "polyline":case "polygon":p=!e._hasMover}return p},_getMoveable:function(e){e=
new c(e,y("mac")&&y("ff")&&!l("esri-touch")&&{leftButtonOnly:!0});this._startHandle=z.connect(e,"onMoveStart",this,this._moveStartHandler);this._firstHandle=z.connect(e,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=z.connect(e,"onMoving",this,this._movingHandler);this._stopHandle=z.connect(e,"onMoveStop",this,this._moveStopHandler);return e},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(e){var p=this.map;p.snappingManager&&p.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();e.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(e){var p=e.shape,h=this._getControlEdges(),r=this._scratchGL._div,d,x=[],D=e.host.shape._wrapOffsets[0]||
0;for(d=0;d<h.length;d++){var q=h[d];q.x1+=D;q.x2+=D;x.push([r.createLine({x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2}).setStroke(this.editor._lineStroke),q.x1,q.y1,q.x2,q.y2])}p._lines=x;e.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(e,p,h){p=this.map;var r;l("esri-pointer")?r=p.navigationManager.pointerEvents._processTouchEvent(h,h):h&&"pointermove"===h.type&&(r=n.prototype._processTouchEvent.call({map:p},
h,h));r&&p.snappingManager&&p.snappingManager._onSnappingMouseMoveHandler(r);h=e.shape;e=h.getTransform();h=h._lines;for(r=0;r<h.length;r++)p=h[r],p[0].setShape({x1:p[1]+e.dx,y1:p[2]+e.dy,x2:p[3],y2:p[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),e)},_moveStopHandler:function(e){e=e.shape;var p=this.editor.toolbar,h=e.getTransform(),r=this.map,d=this.graphic,x=p._geo?w.geographicToWebMercator(d.geometry):d.geometry;p._activateScrollWheel();var D,q=e._lines;if(q){for(D=
0;D<q.length;D++)q[D][0].removeShape();e._lines=null}D=!1;q=!0;var H=this._getInfo();h&&(h.dx||h.dy)?this._placeholder&&(this._placeholder=!1,D=!0):q=!1;if(r.snappingManager)var t=r.snappingManager._snappingPoint;var G=[h,f.invert(this._startTx)];t=t||r.toMap(f.multiplyPoint(G,r.toScreen(x,!0)));r.snappingManager&&r.snappingManager._killOffSnapping();e.setTransform(null);d.setGeometry(p._geo?w.webMercatorToGeographic(t,!0):t);this.constructor.onMoveStop(this,h);p.onVertexMoveStop(this.relatedGraphic,
H,h);if(!q)p.onVertexClick(this.relatedGraphic,H);if(D)p.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var e=this.map,p=this.relatedGraphic.geometry,h=this.segIndex,r=this.ptIndex,d=this.segLength,x=this._scratchGL.getNavigationTransform(),D=x.dx;x=x.dy;var q=e.toScreen(this.graphic.geometry);e=q.x-D;q=q.y-x;var H=[];p=this.editor._getControlPoints(this,p,h,r,d);p[0]&&H.push({x1:e,y1:q,x2:p[0].x-D,y2:p[0].y-x});p[1]&&H.push({x1:e,y1:q,x2:p[1].x-D,y2:p[1].y-x});return H}});
l("extend-esri")&&v.setObject("toolbars.VertexMover",N,a);v.mixin(N,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return N})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(N,v,z,y,m,c,f,a,n,l){N=N(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(b,u,w){this._graphic=b;this._map=u;
this._toolbar=w;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(b){this._editBox?(z.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=z.connect(b.getLayer(),"onDblClick",this,function(u){this._map.navigationManager.setImmediateClick(!1);u.graphic==b&&(y.stop(u),z.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,
this._addTextBox(b))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(z.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(b,u){if(!this._editBox){if(!b.symbol.text){b.symbol.text="Tempt text";b.setSymbol(b.symbol);var w=""}var e=this._createInputTextStyle(b,this._map);""!==w&&(w=u||b.symbol.text);this._editBox=c.create("input",{type:"text",value:w});
a.set(this._editBox,e);f.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=z.connect(this._editBox,"onkeyup",v.hitch(this,function(h){h.keyCode!=n.ENTER&&h.keyCode!==n.TAB||this._disable()}));this._editBoxBlurHandler=z.connect(this._editBox,"onblur",v.hitch(this,function(h){this._disable()}));b.symbol.text="";b.setSymbol(b.symbol);b.hide();var p=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",
v.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(h){a.set(p,{left:this._editBoxLeft+h.delta.x+"px",top:this._editBoxTop+h.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(a.get(p,"left"));this._editBoxTop=parseFloat(a.get(p,"top"))});this.onEditStart(b,this._editBox);this._toolbar.onTextEditStart(b,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(z.disconnect(this._editBoxBlurHandler),
this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(z.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(b,
u){u=b.getDojoShape().getTransformedBoundingBox();var w=b.getLayer();w=w.hasLocalNavigationTransform()?{dx:0,dy:0}:w.getNavigationTransform();var e=b.symbol.font;return{"font-family":e.family,"font-size":e.size+"px","font-style":e.style,"font-variant":e.variant,"font-weight":e.weight,left:u[0].x+w.dx+"px",top:u[0].y+w.dy+"px",width:Math.abs(u[0].x-u[1].x)/Math.cos(b.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var b=this._graphic.symbol;
b.text=this._editBox.value;this._graphic.setSymbol(b)}else this._graphic.getLayer().remove(this._graphic)}});m("extend-esri")&&v.setObject("toolbars.TextEditor",N,l);return N})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,p,h,r,d,x,D,q,H,t,G,T,A,S,O,V,I,g,C,B,J,M,Q,R,X,W,k,F){var L=N([t,d,x],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:F,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,_currentFeature:null,
_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",red:"atiRequiredField"},
constructor:function(E,K){v.mixin(this,p.widgets.attributeInspector);E=E||{};E.featureLayer||E.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(E);this._layerInfos=E.layerInfos||[{featureLayer:E.featureLayer,options:E.options||[]}];this._layerInfos=z.filter(this._layerInfos,function(P){return!P.disableAttributeUpdate});this._hideNavButtons=E.hideNavButtons||!1},postCreate:function(){if(z.every(this._layerInfos,
function(K){return K.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var E=this._layerInfos.length;z.forEach(this._layerInfos,function(K){K=K.featureLayer;if(K.loaded)E--;else var P=y.connect(K,"onLoad",this,function(U){y.disconnect(P);P=null;E--;E||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();z.forEach(this._aiConnects,y.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(E,K){K&&(this._createOnlyFirstTime=!0);
this._updateSelection([E],K);this._updateUI()},onLayerSelectionChange:function(E,K,P){this._createOnlyFirstTime=!1;this._featureIdx=P===e.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(E,K,P,U){},onLayerError:function(E,K,P,U){},onLayerEditsError:function(E,
K,P,U){},onLayerEditsComplete:function(E,K,P,U){U=U||[];if(U.length){var Y=this._selection,Z=E.featureLayer.objectIdField;z.forEach(U,v.hitch(this,function(ca){z.some(Y,v.hitch(this,function(ba,da){if(ba.attributes[Z]!==ca.objectId)return!1;this._selection.splice(da,1);return!0}))}))}K=K||[];K.length&&(this._selection=T.findFeatures(K,E.featureLayer),this._featureIdx=0);U=this._numFeatures=(this._selection=T.sortFeaturesById(this._layerInfos,this._selection))?this._selection.length:0;if(K.length){if(K=
U?this._selection[this._featureIdx]:null)U=K.getLayer().getEditCapabilities(),U.canCreate&&!U.canUpdate||this._showFeature(K);this._updateUI()}P=P||[];if(P.length){var aa=this._rollbackInfo;z.forEach(P,function(ca){var ba=T.findFeatures(P,E.featureLayer)[0];if(!ca.success&&ba.attributes[E.featureLayer.objectIdField]===ca.objectId&&aa){var da=aa.field;ca=aa.graphic.attributes[da.name];var ea=z.filter(this._currentLInfo.fieldInfos,function(fa){return fa.fieldName===da.name},this)[0].dijit;ba.attributes[da.name]=
ca;"esriFieldTypeDate"===da.type&&(ca=new Date(ca));this._setValue(ea,ca)}},this)}this._rollbackInfo=null},onFieldValueChange:function(E,K){var P=E.field,U=E.dijit,Y=this._currentFeature,Z=this._currentLInfo,aa=P.name;E=this._isFieldRequired(P,E);if(""===U.displayedValue||"dijit.form.ValidationTextBox"!==U.declaredClass||U.isValid())if(""!==U.displayedValue&&U.displayedValue!==K&&U.isValid&&!U.isValid())this._setValue(U,Y.attributes[P.name]);else{var ca=!("esriFieldTypeInteger"!==P.type&&"esriFieldTypeSmallInteger"!==
P.type&&"esriFieldTypeSingle"!==P.type&&"esriFieldTypeDouble"!==P.type);if(E&&(null===K||""===K||"undefined"===typeof K||ca&&isNaN(K))){aa=Y.attributes[P.name];if("esriFieldTypeDate"===P.type&&(aa=new Date(aa),U instanceof Array)){this._setValue(U[0],aa);this._setValue(U[1],aa);return}this._setValue(U,aa)}else{if(ca){if(isNaN(K)||""===K)K=null;ca&&null!==K&&(K=Number(K))}"esriFieldTypeDate"===P.type&&(U instanceof Array?(K=U[0].getValue(),U=U[1].getValue(),K=K&&U?new Date(K.getFullYear(),K.getMonth(),
K.getDate(),U.getHours(),U.getMinutes(),U.getSeconds(),U.getMilliseconds()):K||U||null):(K=U.getValue(),P.domain&&(K=Number(K))),K=K&&K.getTime?K.getTime():K&&K.toGregorian?K.toGregorian().getTime():K);if(this._currentFeature.attributes[P.name]!==K){if(aa===Z.typeIdField){var ba=this._findFirst(Z.types,"id",K);z.forEach(Z.fieldInfos,function(da){(P=da.field)&&P.name!==Z.typeIdField&&(da=da.dijit,this._setFieldDomain(da,ba,P)&&da&&(this._setValue(da,Y.attributes[P.name]+""),!1===da.isValid()&&this._setValue(da,
null)))},this)}this.onAttributeChange(Y,aa,K)}}}else this._setValue(U,Y.attributes[P.name])},onDeleteBtn:function(E){this._deleteFeature()},onNextFeature:function(E){this._onNextFeature(1)},onPreviousFeature:function(E){this._onNextFeature(-1)},onFirstFeature:function(E){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(E){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var E=this._layerInfos;this._editorTrackingInfos={};z.forEach(E,this._initLayerInfo,
this)},_initLayerInfo:function(E){var K=E.featureLayer,P;this._userIds={};var U=K.id;K.credential&&(this._userIds[U]=K.credential.userId);E.userId&&(this._userIds[U]=E.userId);this._connect(K,"onSelectionComplete",v.hitch(this,"onLayerSelectionChange",E));this._connect(K,"onSelectionClear",v.hitch(this,"onLayerSelectionClear",E));this._connect(K,"onEditsComplete",v.hitch(this,"onLayerEditsComplete",E));this._connect(K,"error",v.hitch(this,"onLayerError",E));this._connect(K,"onUpdateEnd",v.hitch(this,
"onLayerUpdateEnd",E));E.showAttachments=K.hasAttachments?b.isDefined(E.showAttachments)?E.showAttachments:!0:!1;E.hideFields=E.hideFields||[];E.htmlFields=E.htmlFields||[];E.isEditable=K.isEditable()?b.isDefined(E.isEditable)?E.isEditable:!0:!1;E.typeIdField=K.typeIdField;E.layerId=K.id;E.types=K.types;K.globalIdField&&((P=this._findFirst(E.fieldInfos,"fieldName",K.globalIdField))||E.showGlobalID||E.hideFields.push(K.globalIdField));(U=this._findFirst(E.fieldInfos,"fieldName",K.objectIdField))||
E.showObjectID||E.hideFields.push(K.objectIdField);var Y=this._getFields(E.featureLayer);if(Y){var Z=E.fieldInfos||[];Z=z.map(Z,function(aa){return v.mixin({},aa)});Z.length?E.fieldInfos=z.filter(z.map(Z,v.hitch(this,function(aa){var ca=aa.stringFieldOption||(this._isInFields(aa.fieldName,E.htmlFields)?L.STRING_FIELD_OPTION_RICHTEXT:L.STRING_FIELD_OPTION_TEXTBOX);return v.mixin(aa,{field:this._findFirst(Y,"name",aa.fieldName),stringFieldOption:ca})})),"return item.field;"):(Y=z.filter(Y,v.hitch(this,
function(aa){return!this._isInFields(aa.name,E.hideFields)})),E.fieldInfos=z.map(Y,v.hitch(this,function(aa){var ca=this._isInFields(aa.name,E.htmlFields)?L.STRING_FIELD_OPTION_RICHTEXT:L.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:aa.name,field:aa,stringFieldOption:ca}})));E.showGlobalID&&!P&&Z.push(this._findFirst(Y,"name",K.globalIdField));E.showObjectID&&!U&&Z.push(this._findFirst(Y,"name",K.objectIdField));P=[];K.editFieldsInfo&&(K.editFieldsInfo.creatorField&&P.push(K.editFieldsInfo.creatorField),
K.editFieldsInfo.creationDateField&&P.push(K.editFieldsInfo.creationDateField),K.editFieldsInfo.editorField&&P.push(K.editFieldsInfo.editorField),K.editFieldsInfo.editDateField&&P.push(K.editFieldsInfo.editDateField));this._editorTrackingInfos[K.id]=P}},_createAttachmentEditor:function(){this._attachmentEditor=null;var E=z.filter(this._layerInfos,function(K){return K.showAttachments});E&&E.length&&(this._attachmentEditor=new G({"class":this.css.attachmentEditor},this.attachmentEditor),this._attachmentEditor.startup())},
_setCurrentLInfo:function(E){var K=this._currentLInfo?this._currentLInfo.featureLayer:null,P=E.featureLayer;if(K&&K.id===P.id&&!K.ownershipBasedAccessControlForFeatures&&(K=P.getEditCapabilities(),!K.canCreate||K.canUpdate))return;this._currentLInfo=E;this._createTable()},_updateSelection:function(E,K){this._selection=E||[];z.forEach(this._layerInfos,this._getSelection,this);this._selection=T.sortFeaturesById(this._layerInfos,this._selection);this._numFeatures=this._selection.length;this._showFeature(this._numFeatures?
this._selection[this._featureIdx]:null,K)},_getSelection:function(E){E=E.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(E)},_updateUI:function(){var E=this._numFeatures,K=this._currentLInfo;this.layerName.innerHTML=K&&0!==E?K.featureLayer?K.featureLayer.name:"":this.NLS_noFeaturesSelected;a.set(this.attributeTable,"display",E?"":"none");a.set(this.editButtons,"display",E?"":"none");a.set(this.navButtons,"display",!this._hideNavButtons&&1<E?"":"none");this.navMessage.innerHTML=
b.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&a.set(this._attachmentEditor.domNode,"display",K&&K.showAttachments&&E?"":"none");a.set(this.deleteBtn.domNode,"display",K&&!1===K.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(E){this._featureIdx+=E;0>this._featureIdx?this._featureIdx=this._numFeatures-
1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);E=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(E);this._updateUI();this.onNext(E)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(E,K){if(E){this._currentFeature=E;K=K?K:E.getLayer();var P=K.getEditCapabilities({feature:E,userId:this._userIds[K.id]});this._canUpdate=P.canUpdate;this._canDelete=P.canDelete;if(P=this._getLInfoFromFeatureLayer(K)){this._setCurrentLInfo(P);
var U=E.attributes,Y=this._findFirst(P.types,"id",U[P.typeIdField]),Z=null;z.forEach(P.fieldInfos,function(aa){Z=aa.field;var ca=[];aa.dijit&&1<aa.dijit.length?z.forEach(aa.dijit,function(ba){ca.push(ba)}):ca.push(aa.dijit);z.forEach(ca,v.hitch(this,function(ba){if(ba){var da=this._setFieldDomain(ba,Y,Z),ea=U[Z.name];ea=ea&&da&&da.codedValues&&da.codedValues.length?da.codedValues[ea]?da.codedValues[ea].name:ea:ea;b.isDefined(ea)||(ea="");"dijit.form.DateTextBox"===ba.declaredClass||"dijit.form.TimeTextBox"===
ba.declaredClass?ea=""===ea?null:new Date(ea):"dijit.form.FilteringSelect"===ba.declaredClass&&(ba._lastValueReported=null,ea=U[Z.name]+"");try{this._setValue(ba,ea),"dijit.form.FilteringSelect"===ba.declaredClass&&!1===ba.isValid()&&this._setValue(ba,null)}catch(fa){ba.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&P.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,K);(E=K.getEditSummary(E))?(this.editorTrackingInfoDiv.innerHTML=E,u.show(this.editorTrackingInfoDiv)):
u.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(E,K,P){if(!E)return null;var U=P.domain;K&&K.domains&&K.domains[P.name]&&!1===K.domains[P.name]instanceof w&&(U=K.domains[P.name]);if(!U)return null;U.codedValues&&0<U.codedValues.length?(E.set("store",this._toStore(z.map(U.codedValues,function(Y){return{id:Y.code+"",name:Y.name}}))),this._setValue(E,U.codedValues[0].code+"")):(E.constraints={min:b.isDefined(U.minValue)?U.minValue:Number.MIN_VALUE,max:b.isDefined(U.maxValue)?U.maxValue:
Number.MAX_VALUE},this._setValue(E,E.constraints.min));return U},_setValue:function(E,K){E.set&&(E._onChangeActive=!1,E.set("value",K,!0),E._onChangeActive=!0)},_getFields:function(E){var K=E._getOutFields();if(!K)return null;E=E.fields;return"*"==K?E:z.filter(z.map(K,v.hitch(this,"_findFirst",E,"name")),b.isDefined)},_isInFields:function(E,K){return E&&(K||K.length)?z.some(K,function(P){return P.toLowerCase()===E.toLowerCase()}):!1},_isFieldNullable:function(E,K){return!(!1===E.nullable||K.field&&
!1===K.field.nullable)},_isFieldRequired:function(E,K){return!1!==E.editable&&!1!==K.isEditable&&!this._isFieldNullable(E,K)},_findFirst:function(E,K,P){return(E=z.filter(E,function(U){return U.hasOwnProperty(K)&&U[K]===P}))&&E.length?E[0]:null},_getLInfoFromFeatureLayer:function(E){return this._findFirst(this._layerInfos,"layerId",E?E.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML="";this._attributes=n.create("table",{cellspacing:"0",cellpadding:"0"},
this.attributeTable);var E=n.create("tbody",null,this._attributes),K=this._currentLInfo,P=this._findFirst(K.types,"id",this._currentFeature.attributes[K.typeIdField]);z.forEach(K.fieldInfos,v.hitch(this,"_createField",P,E),this);this._createOnlyFirstTime=!1},_createField:function(E,K,P){var U=this._currentLInfo,Y=P.field;if(!this._isInFields(Y.name,U.hideFields)&&!this._isInFields(Y.name,this._editorTrackingInfos[U.featureLayer.id])){var Z=!1,aa;K=n.create("tr",null,K);var ca=n.create("td",{innerHTML:P.label||
Y.alias||Y.name,"class":this.css.label,"data-fieldname":Y.name},K);this._isFieldRequired(Y,P)&&n.create("span",{"class":this.css.red,innerHTML:" *"},ca);K=n.create("td",null,K);if(P.customField){n.place(P.customField.domNode||P.customField,n.create("div",null,K),"first");var ba=P.customField}else if(!1===U.isEditable||!1===Y.editable||!1===P.isEditable||"esriFieldTypeOID"===Y.type||"esriFieldTypeGlobalID"===Y.type||!this._canUpdate&&!this._createOnlyFirstTime)Z=!0;U=U.typeIdField&&Y.name.toLowerCase()==
U.typeIdField.toLowerCase();ca=!!this._getDomainForField(Y,E);!ba&&U?ba=this._createTypeField(Y,P,K):!ba&&ca&&(ba=this._createDomainField(Y,P,E,K));if(!ba)switch(Y.type){case "esriFieldTypeString":ba=this._createStringField(Y,P,K);break;case "esriFieldTypeDate":ba=this._createDateField(Y,P,K);P.format&&P.format.time&&(aa=this._createTimeField(Y,P,K));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":ba=this._createIntField(Y,P,K);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":ba=
this._createFltField(Y,P,K);break;default:ba=this._createStringField(Y,P,K)}P.tooltip&&P.tooltip.length&&this._toolTips.push(new Q({connectId:[ba.id],label:P.tooltip}));ba.onChange=v.hitch(this,"onFieldValueChange",P);ba.set("disabled",Z);aa?(P.dijit=[ba,aa],aa.onChange=v.hitch(this,"onFieldValueChange",P),aa.set("disabled",Z)):P.dijit=ba}},_createTypeField:function(E,K,P){P=n.create("div",null,P);var U=E.domain;return U&&"range"===U.type&&U.minValue===U.maxValue?new J({"class":this.css.field,trim:!0,
maxLength:E.length,name:E.alias||E.name,required:this._isFieldRequired(E,K)},P):new I({"class":this.css.field,name:E.alias||E.name,required:this._isFieldRequired(E,K),store:this._toStore(z.map(this._currentLInfo.types,function(Y){return{id:Y.id,name:Y.name}})),searchAttr:"name"},P)},_getDomainForField:function(E,K){var P=E.domain;(E=E.name)&&K&&K.domains&&K.domains[E]&&!1===K.domains[E]instanceof w&&(P=K.domains[E]);return P||null},_createDomainField:function(E,K,P,U){P=this._getDomainForField(E,
P);U=n.create("div",null,U);return P.codedValues?new I({"class":this.css.field,name:E.alias||E.name,searchAttr:"name",required:this._isFieldRequired(E,K)},U):new g({"class":this.css.field},U)},_createStringField:function(E,K,P){P=n.create("div",null,P);var U={trim:!0,maxLength:E.length,required:this._isFieldRequired(E,K)};if(K.stringFieldOption===L.STRING_FIELD_OPTION_TEXTAREA)return U["class"]=this.css.field+" "+this.css.textArea,new B(U,P);if(K.stringFieldOption===L.STRING_FIELD_OPTION_RICHTEXT)return U["class"]=
this.css.field+" "+this.css.richText,U.height="100%",U.width="100%",U.plugins=K.richTextPlugins||this._defaultRichTextPlugins,P=new D(U,P),P.startup(),P;var Y=this;U.validator=function(Z,aa){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return Y._isFieldNullable(E,K)||!(""===Z||null===Z)};return new J(U,P)},_createTimeField:function(E,K,P){P=n.create("div",null,P);E={"class":this.css.field,trim:!0,required:this._isFieldRequired(E,K),constraints:{formatLength:"medium"}};this._datePackage&&
(E.datePackage=this._datePackage);return new M(E,P)},_createDateField:function(E,K,P){P=n.create("div",null,P);E={"class":this.css.field,trim:!0,required:this._isFieldRequired(E,K)};this._datePackage&&(E.datePackage=this._datePackage);return new S(E,P)},_createIntField:function(E,K,P){P=n.create("div",null,P);return new V({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===E.type?{min:-32768,max:32767,places:0}:{places:0},trim:!0,invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(E,
K)},P)},_createFltField:function(E,K,P){P=n.create("div",null,P);return new V({"class":this.css.field,constraints:{max:Infinity,min:-Infinity,places:"0,20"},trim:!0,invalidMessage:this.NLS_validationFlt,required:this._isFieldRequired(E,K)},P)},_toStore:function(E){return new R({data:{identifier:"id",label:"name",items:E}})},_connect:function(E,K,P){this._aiConnects.push(y.connect(E,K,P))},_getDatePackage:function(E){return null===E.datePackage?null:E.datePackage?E.datePackage:"ar"===c.locale?"dojox.date.islamic":
null},_destroyAttributeTable:function(){z.forEach(this._layerInfos,function(E){z.forEach(E.fieldInfos,function(K){var P=K.dijit;if(P){P._onChangeHandle=null;if(K.customField)return;P instanceof Array?z.forEach(P,v.hitch(this,function(U){U.destroyRecursive?U.destroyRecursive():U.destroy&&U.destroy();U._onChangeHandle=null})):P.destroyRecursive?P.destroyRecursive():P.destroy&&P.destroy()}K.dijit=null},this)},this);z.forEach(this._toolTips,function(E){E.destroy()});this._toolTips=[];this._attributes&&
n.destroy(this._attributes)}});v.mixin(L,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});f("extend-esri")&&v.setObject("dijit.AttributeInspector",L,l);return L})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,p,h,r,d,x,D,q,H,t,G,T){function A(O){return new D({command:O.name})}function S(O){return new D({buttonClass:x,command:O.name})}z=z("dijit.Editor",G,{plugins:null,extraPlugins:null,constructor:function(){b.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",q]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(u("ie")||u("trident")||u("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new y;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);b.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=m.getLocalization("dijit._editor",
"commands",this.lang);u("webkit")&&n.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new h({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));v.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);f.add(this.iframe.parentNode,"dijitEditorIFrameContainer");f.add(this.iframe,"dijitEditorIFrame");c.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){v.forEach(this._plugins,function(O){O&&O.destroy&&O.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(O,V){var I=b.isString(O)?{name:O}:b.isFunction(O)?{ctor:O}:O;if(!I.setEditor){var g={args:I,plugin:null,editor:this};I.name&&(D.registry[I.name]?g.plugin=D.registry[I.name](I):e.publish(T._scopeName+".Editor.getPlugin",g));if(!g.plugin)try{var C=
I.ctor||b.getObject(I.name)||N(I.name);C&&(g.plugin=new C(I))}catch(B){throw Error(this.id+": cannot find plugin ["+I.name+"]");}if(!g.plugin)throw Error(this.id+": cannot find plugin ["+I.name+"]");O=g.plugin}1<arguments.length?this._plugins[V]=O:this._plugins.push(O);O.setEditor(this);b.isFunction(O.setToolbar)&&O.setToolbar(this.toolbar)},resize:function(O){O&&d.prototype.resize.apply(this,arguments)},layout:function(){var O=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+a.getPadBorderExtents(this.iframe.parentNode).h+
a.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=O+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(O){var V,I=this.document.body,g=I.clientWidth,C=I.clientHeight,B=I.clientLeft,J=I.offsetWidth,M=I.offsetHeight,Q=I.offsetLeft;/^rtl$/i.test(I.dir||"")?g<J&&O.x>g&&O.x<J&&(V=!0):O.x<B&&O.x>Q&&(V=!0);V||C<M&&O.y>C&&O.y<M&&(V=!0);V||(delete this._cursorToStart,delete this._savedSelection,"BODY"==O.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(O){this.customUndo&&this.endEditing(!0);"BODY"!=O.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(O){this._inEditing||(this._inEditing=!0,this._beginEditing(O));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(O){if(!this.customUndo||
"undo"!=O&&"redo"!=O){this.customUndo&&(this.endEditing(),this._beginEditing());var V=this.inherited(arguments);this.customUndo&&this._endEditing();return V}return this[O]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(O){try{var V=this.document.execCommand(O,!1,null);if(u("webkit")&&!V)throw{};}catch(I){V=w.substitute,alert(V(this.commands.systemShortcut,
[this.commands[O],V(this.commands[u("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[O]])])),V=!1}return V},queryCommandEnabled:function(O){return!this.customUndo||"undo"!=O&&"redo"!=O?this.inherited(arguments):"undo"==O?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(O){var V=O.mark,I=O.mark;O=O.isCollapsed;var g;if(I)if(9>u("ie")||9===u("ie")&&u("quirks"))if(b.isArray(I))V=[],v.forEach(I,function(J){V.push(t.getNode(J,this.editNode))},this),this.selection.moveToBookmark({mark:V,
isCollapsed:O});else{if(I.startContainer&&I.endContainer&&(g=t.getSelection(this.window))&&g.removeAllRanges){g.removeAllRanges();O=t.create(this.window);var C=t.getNode(I.startContainer,this.editNode);var B=t.getNode(I.endContainer,this.editNode);C&&B&&(O.setStart(C,I.startOffset),O.setEnd(B,I.endOffset),g.addRange(O))}}else(g=t.getSelection(this.window))&&g.removeAllRanges&&(g.removeAllRanges(),O=t.create(this.window),C=t.getNode(I.startContainer,this.editNode),B=t.getNode(I.endContainer,this.editNode),
C&&B&&(O.setStart(C,I.startOffset),O.setEnd(B,I.endOffset),g.addRange(O)))},_changeToStep:function(O,V){this.setValue(V.text);(O=V.bookmark)&&this._moveToBookmark(O)},undo:function(){var O=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var V=this._steps.pop();V&&0<this._steps.length&&(this.focus(),this._changeToStep(V,this._steps[this._steps.length-1]),this._undoedSteps.push(V),this.onDisplayChanged(),delete this._undoRedoActive,O=!0);delete this._undoRedoActive}return O},
redo:function(){var O=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var V=this._undoedSteps.pop();V&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],V),this._steps.push(V),this.onDisplayChanged(),O=!0);delete this._undoRedoActive}return O},endEditing:function(O){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(O),this._inEditing=!1)},_getBookmark:function(){var O=this.selection.getBookmark(),
V=[];if(O&&O.mark){var I=O.mark;if(9>u("ie")||9===u("ie")&&u("quirks")){var g=t.getSelection(this.window);if(b.isArray(I))v.forEach(O.mark,function(B){V.push(t.getIndex(B,this.editNode).o)},this),O.mark=V;else if(g){var C;g.rangeCount&&(C=g.getRangeAt(0));O.mark=C?C.cloneRange():this.selection.getBookmark()}}try{O.mark&&O.mark.startContainer&&(V=t.getIndex(O.mark.startContainer,this.editNode).o,O.mark={startContainer:V,startOffset:O.mark.startOffset,endContainer:O.mark.endContainer===O.mark.startContainer?
V:t.getIndex(O.mark.endContainer,this.editNode).o,endOffset:O.mark.endOffset})}catch(B){O.mark=null}}return O},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:H.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var O=H.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:O,bookmark:this._getBookmark()})},onKeyDown:function(O){u("ie")||this.iframe||O.keyCode!=l.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var V=
O.keyCode;if(O.ctrlKey&&!O.shiftKey&&!O.altKey){if(90==V||122==V){O.stopPropagation();O.preventDefault();this.undo();return}if(89==V||121==V){O.stopPropagation();O.preventDefault();this.redo();return}}this.inherited(arguments);switch(V){case l.ENTER:case l.BACKSPACE:case l.DELETE:this.beginEditing();break;case 88:case 86:if(O.ctrlKey&&!O.altKey&&!O.metaKey){this.endEditing();88==O.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!O.ctrlKey&&!O.altKey&&
!O.metaKey&&(O.keyCode<l.F1||O.keyCode>l.F15)){this.beginEditing();break}case l.ALT:this.endEditing();break;case l.UP_ARROW:case l.DOWN_ARROW:case l.LEFT_ARROW:case l.RIGHT_ARROW:case l.HOME:case l.END:case l.PAGE_UP:case l.PAGE_DOWN:this.endEditing(!0);case l.CTRL:case l.SHIFT:case l.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(O){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(O){this.customUndo?this.isClosed?this.setValue(O):(this.beginEditing(),O||(O="\x26#160;"),this.setValue(O),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(O){this.setValueDeferred.then(b.hitch(this,function(){!this.disabled&&O||!this._buttonEnabledPlugins&&O?
v.forEach(this._plugins,function(V){V.set("disabled",!0)}):this.disabled&&!O&&v.forEach(this._plugins,function(V){V.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&(n.set(this.document.body,"color",n.get(this.iframe,"color")),n.set(this.document.body,"background-color",n.get(this.iframe,"background-color")))}catch(O){}}});b.mixin(D.registry,{undo:A,redo:A,cut:A,copy:A,paste:A,insertOrderedList:A,insertUnorderedList:A,
indent:A,outdent:A,justifyCenter:A,justifyFull:A,justifyLeft:A,justifyRight:A,"delete":A,selectAll:A,removeFormat:A,unlink:A,insertHorizontalRule:A,bold:S,italic:S,underline:S,strikethrough:S,subscript:S,superscript:S,"|":function(){return new D({setEditor:function(O){this.editor=O;this.button=new r({ownerDocument:O.ownerDocument})}})}});return z})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(N,v,z,y,m,c,f,a){z("dijit-legacy-requires")&&m(0,function(){N(["dijit/ToolbarSeparator"])});return v("dijit.Toolbar",[c,a,f],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],
function(N,v,z,y){return N("dijit.ToolbarSeparator",[z,y],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',buildRendering:function(){this.inherited(arguments);v.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(N,v,z,y,m){v=v("dijit._editor._Plugin",y,{constructor:function(c){this.params=
c||{};z.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:m,disabled:!1,getLabel:function(c){return this.editor.commands[c]},_initButton:function(){if(this.command.length){var c=this.getLabel(this.command),f=this.editor,a=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(c=z.mixin({label:c,ownerDocument:f.ownerDocument,dir:f.dir,
lang:f.lang,showLabel:!1,iconClass:a,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete c.name,this.button=new this.buttonClass(c))}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(c,f,a){this.own(N.connect(c,f,this,a))},updateState:function(){var c=this.editor,f=this.command;if(c&&c.isLoaded&&f.length){var a=this.get("disabled");if(this.button)try{var n=
c._implCommand(f);var l=!a&&(this[n]?this[n](f):c.queryCommandEnabled(f));this.enabled!==l&&(this.enabled=l,this.button.set("disabled",!l));if(l&&"boolean"==typeof this.button.checked){var b=c.queryCommandState(f);this.checked!==b&&(this.checked=b,this.button.set("checked",c.queryCommandState(f)))}}catch(u){console.log(u)}}},setEditor:function(c){this.editor=c;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",z.hitch(this.editor,
"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",z.hitch(this,"updateState")))},setToolbar:function(c){this.button&&c.addChild(this.button)},set:function(c,f){if("object"===typeof c){for(var a in c)this.set(a,c[a]);return this}a=this._getAttrNames(c);if(this[a.s])var n=this[a.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(c,f);return n||this},get:function(c){var f=this._getAttrNames(c);
return this[f.g]?this[f.g]():this[c]},_setDisabledAttr:function(c){this._set("disabled",c);this.updateState()},_getAttrNames:function(c){var f=this._attrPairNames;if(f[c])return f[c];var a=c.charAt(0).toUpperCase()+c.substr(1);return f[c]={s:"_set"+a+"Attr",g:"_get"+a+"Attr"}},_set:function(c,f){this[c]=f}});v.registry={};return v})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b){return N("dijit._editor.plugins.EnterKeyHandling",n,{blockNodeForEnter:"BR",constructor:function(u){u&&("blockNodeForEnter"in u&&(u.blockNodeForEnter=u.blockNodeForEnter.toUpperCase()),y.mixin(this,u))},setEditor:function(u){if(this.editor!==u)if(this.editor=u,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,u.onLoadDeferred.then(y.hitch(this,function(e){this.own(m(u.document,"keydown",y.hitch(this,function(p){if(p.keyCode==z.ENTER){var h=y.mixin({},p);h.shiftKey=
!0;this.handleEnterKey(h)||(p.stopPropagation(),p.preventDefault())}})));9<=c("ie")&&10>=c("ie")&&this.own(m(u.document,"paste",y.hitch(this,function(p){setTimeout(y.hitch(this,function(){var h=this.editor.document.selection.createRange();h.move("character",-1);h.select();h.move("character",1);h.select()}),0)})));return e}));else if(this.blockNodeForEnter){var w=y.hitch(this,"handleEnterKey");u.addKeyHandler(13,0,0,w);u.addKeyHandler(13,0,1,w);this.own(this.editor.on("KeyPressed",y.hitch(this,"onKeyPressed")))}},
onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var u=this.editor.selection.getAncestorElement("LI");if(u){c("mozilla")&&"LI"==u.parentNode.parentNode.nodeName&&(u=u.parentNode.parentNode);var w=u.firstChild;!w||1!=w.nodeType||"UL"!=w.nodeName&&"OL"!=w.nodeName||(u.insertBefore(w.ownerDocument.createTextNode("\u00a0"),w),w=b.create(this.editor.window),w.setStart(u.firstChild,0),u=b.getSelection(this.editor.window,!0),u.removeAllRanges(),u.addRange(w))}else l.prototype.execCommand.call(this.editor,
"formatblock",this.blockNodeForEnter),(u=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?(u.innerHTML=this.bogusHtmlContent,9>=c("ie")&&(u=this.editor.document.selection.createRange(),u.move("character",-1),u.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",
blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(u){var w,e=this.editor.document,p;if(u.shiftKey){u=this.editor.selection.getParentElement();if(w=b.getAncestor(u,this.blockNodes)){if("LI"==w.tagName)return!0;u=b.getSelection(this.editor.window);var h=u.getRangeAt(0);h.collapsed||(h.deleteContents(),u=b.getSelection(this.editor.window),h=u.getRangeAt(0));if(b.atBeginningOfContainer(w,h.startContainer,h.startOffset)){var r=e.createElement("br");h=b.create(this.editor.window);w.insertBefore(r,
w.firstChild);h.setStartAfter(r);u.removeAllRanges();u.addRange(h)}else if(b.atEndOfContainer(w,h.startContainer,h.startOffset))h=b.create(this.editor.window),r=e.createElement("br"),w.appendChild(r),w.appendChild(e.createTextNode("\u00a0")),h.setStart(w.lastChild,0),u.removeAllRanges(),u.addRange(h);else{if((p=h.startContainer)&&3==p.nodeType){var d=p.nodeValue;var x=e.createTextNode(d.substring(0,h.startOffset));var D=e.createTextNode(d.substring(h.startOffset));w=e.createElement("br");""==D.nodeValue&&
c("webkit")&&(D=e.createTextNode("\u00a0"));v.place(x,p,"after");v.place(w,x,"after");v.place(D,w,"after");v.destroy(p);h=b.create(this.editor.window);h.setStart(D,0);u.removeAllRanges();u.addRange(h);return!1}return!0}}else u=b.getSelection(this.editor.window),u.rangeCount?(h=u.getRangeAt(0))&&h.startContainer&&(h.collapsed||(h.deleteContents(),u=b.getSelection(this.editor.window),h=u.getRangeAt(0)),(p=h.startContainer)&&3==p.nodeType?(w=h.startOffset,p.length<w&&(D=this._adjustNodeAndOffset(p,w),
p=D.node,w=D.offset),d=p.nodeValue,x=e.createTextNode(d.substring(0,w)),D=e.createTextNode(d.substring(w)),w=e.createElement("br"),D.length||(D=e.createTextNode("\u00a0")),x.length?v.place(x,p,"after"):x=p,v.place(w,x,"after"),v.place(D,w,"after"),v.destroy(p)):(0<=h.startOffset&&(r=p.childNodes[h.startOffset]),w=e.createElement("br"),D=e.createTextNode("\u00a0"),r?(v.place(w,r,"before"),v.place(D,w,"after")):(p.appendChild(w),p.appendChild(D))),h=b.create(this.editor.window),h.setStart(D,0),h.setEnd(D,
D.length),u.removeAllRanges(),u.addRange(h),this.editor.selection.collapse(!0)):l.prototype.execCommand.call(this.editor,"inserthtml","\x3cbr\x3e");return!1}var q=!0;u=b.getSelection(this.editor.window);h=u.getRangeAt(0);h.collapsed||(h.deleteContents(),u=b.getSelection(this.editor.window),h=u.getRangeAt(0));r=b.getBlockAncestor(h.endContainer,null,this.editor.editNode);var H=r.blockNode;if(this._checkListLater=H&&("LI"==H.nodeName||"LI"==H.parentNode.nodeName))return c("mozilla")&&(this._pressedEnterInBlock=
H),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(H.innerHTML)&&(H.innerHTML="",c("webkit")&&(h=b.create(this.editor.window),h.setStart(H,0),u.removeAllRanges(),u.addRange(h)),this._checkListLater=!1),!0;if(!r.blockNode||r.blockNode===this.editor.editNode){try{l.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(t){}r={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),
blockContainer:this.editor.editNode};if(r.blockNode){if(r.blockNode!=this.editor.editNode&&!(r.blockNode.textContent||r.blockNode.innerHTML).replace(/^\s+|\s+$/g,"").length)return this.removeTrailingBr(r.blockNode),!1}else r.blockNode=this.editor.editNode;u=b.getSelection(this.editor.window);h=u.getRangeAt(0)}H=e.createElement(this.blockNodeForEnter);H.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(r.blockNode);D=h.endOffset;q=h.endContainer;q.length<D&&(D=this._adjustNodeAndOffset(q,D),q=
D.node,D=D.offset);if(b.atEndOfContainer(r.blockNode,q,D))r.blockNode===r.blockContainer?r.blockNode.appendChild(H):v.place(H,r.blockNode,"after"),q=!1,h=b.create(this.editor.window),h.setStart(H,0),u.removeAllRanges(),u.addRange(h),this.editor.height&&a.scrollIntoView(H);else if(b.atBeginningOfContainer(r.blockNode,h.startContainer,h.startOffset))v.place(H,r.blockNode,r.blockNode===r.blockContainer?"first":"before"),H.nextSibling&&this.editor.height&&(h=b.create(this.editor.window),h.setStart(H.nextSibling,
0),u.removeAllRanges(),u.addRange(h),a.scrollIntoView(H.nextSibling)),q=!1;else{r.blockNode===r.blockContainer?r.blockNode.appendChild(H):v.place(H,r.blockNode,"after");q=!1;r.blockNode.style&&H.style&&r.blockNode.style.cssText&&(H.style.cssText=r.blockNode.style.cssText);if((p=h.startContainer)&&3==p.nodeType){D=h.endOffset;p.length<D&&(D=this._adjustNodeAndOffset(p,D),p=D.node,D=D.offset);d=p.nodeValue;x=e.createTextNode(d.substring(0,D));D=e.createTextNode(d.substring(D,d.length));v.place(x,p,
"before");v.place(D,p,"after");v.destroy(p);for(h=x.parentNode;h!==r.blockNode;){d=e.createElement(h.tagName);h.style&&d.style&&h.style.cssText&&(d.style.cssText=h.style.cssText);"FONT"===h.tagName&&(h.color&&(d.color=h.color),h.face&&(d.face=h.face),h.size&&(d.size=h.size));for(;D;)p=D.nextSibling,d.appendChild(D),D=p;v.place(d,h,"after");x=h;D=d;h=h.parentNode}if(1==D.nodeType||3==D.nodeType&&D.nodeValue)H.innerHTML="";for(x=D;D;)p=D.nextSibling,H.appendChild(D),D=p}h=b.create(this.editor.window);
e=x;if("BR"!==this.blockNodeForEnter){for(;e;)w=e,e=p=e.firstChild;w&&w.parentNode?(H=w.parentNode,h.setStart(H,0),u.removeAllRanges(),u.addRange(h),this.editor.height&&a.scrollIntoView(H),c("mozilla")&&(this._pressedEnterInBlock=r.blockNode)):q=!0}else h.setStart(H,0),u.removeAllRanges(),u.addRange(h),this.editor.height&&a.scrollIntoView(H),c("mozilla")&&(this._pressedEnterInBlock=r.blockNode)}return q},_adjustNodeAndOffset:function(u,w){for(;u.length<w&&u.nextSibling&&3==u.nextSibling.nodeType;)w-=
u.length,u=u.nextSibling;return{node:u,offset:w}},removeTrailingBr:function(u){if(u=/P|DIV|LI/i.test(u.tagName)?u:this.editor.selection.getParentOfType(u,["P","DIV","LI"]))u.lastChild&&(1<u.childNodes.length&&3==u.lastChild.nodeType&&/^[\s\xAD]*$/.test(u.lastChild.nodeValue)||"BR"==u.lastChild.tagName)&&v.destroy(u.lastChild),u.childNodes.length||(u.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,p,h,r,d,x,D,q,H,t,G,T,A,S,O,V){var I=z("dijit._editor.RichText",[t,G],{constructor:function(g){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};g&&w.isString(g.value)&&(this.value=g.value);this.onLoadDeferred=new y},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[w.trim,w.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);r("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));r("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(r("ie")||r("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[w.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[w.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);x.publish(V._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var g=w.hitch(this,function(J,M){return function(){return!this.execCommand(J,M)}}),C={b:g("bold"),i:g("italic"),u:g("underline"),a:g("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:g("formatblock",
"h1"),2:g("formatblock","h2"),3:g("formatblock","h3"),4:g("formatblock","h4"),"\\":g("insertunorderedlist")};r("ie")||(C.Z=g("redo"));for(var B in C)this.addKeyHandler(B,!0,!1,C[B])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(I._editorCommandsLocalized)this._local2NativeFormatNames=I._local2NativeFormatNames,this._native2LocalFormatNames=I._native2LocalFormatNames;else{I._editorCommandsLocalized=!0;I._local2NativeFormatNames={};
I._native2LocalFormatNames={};this._local2NativeFormatNames=I._local2NativeFormatNames;this._native2LocalFormatNames=I._native2LocalFormatNames;for(var g="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),C="",B,J=0;B=g[J++];)C="l"!==B.charAt(1)?C+("\x3c"+B+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+B+"\x3e\x3cbr/\x3e"):C+("\x3c"+B+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+B+"\x3e\x3cbr/\x3e");var M=a.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:C});this.ownerDocumentBody.appendChild(M);
g=w.hitch(this,function(){for(var Q=M.firstChild;Q;)try{this.selection.selectElement(Q.firstChild);var R=Q.tagName.toLowerCase();this._local2NativeFormatNames[R]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[R]]=R;Q=Q.nextSibling.nextSibling}catch(X){}a.destroy(M)});this.defer(g)}},open:function(g){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new y;this.isClosed||this.close();x.publish(V._scopeName+"._editor.RichText::open",
this);1===arguments.length&&g.nodeName&&(this.domNode=g);var C=this.domNode;if(w.isString(this.value)){var B=this.value;C.innerHTML=""}else if(C.nodeName&&"textarea"==C.nodeName.toLowerCase()){var J=this.textarea=C;this.name=J.name;B=J.value;C=this.domNode=this.ownerDocument.createElement("div");C.setAttribute("widgetId",this.id);J.removeAttribute("widgetId");C.cssText=J.cssText;C.className+=" "+J.className;a.place(C,J,"before");var M=w.hitch(this,function(){l.set(J,{display:"block",position:"absolute",
top:"-1000px"});if(r("ie")){var W=J.style;this.__overflow=W.overflow;W.overflow="hidden"}});r("ie")?this.defer(M,10):M();if(J.form){var Q=J.value;this.reset=function(){this.getValue()!==Q&&this.replaceValue(Q)};e(J.form,"submit",w.hitch(this,function(){c.set(J,"disabled",this.disabled);J.value=this.getValue()}))}}else B=S.getChildrenHtml(C),C.innerHTML="";this.value=B;C.nodeName&&"LI"===C.nodeName&&(C.innerHTML=" \x3cbr\x3e");this.header=C.ownerDocument.createElement("div");C.appendChild(this.header);
this.editingArea=C.ownerDocument.createElement("div");C.appendChild(this.editingArea);this.footer=C.ownerDocument.createElement("div");C.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!v.useXDomain||v.allowXdRichTextSave)){if((B=m.byId(V._scopeName+"._editor.RichText.value"))&&""!==B.value){M=B.value.split(this._SEPARATOR);for(var R=0,X;X=M[R++];)if(X=X.split(this._NAME_CONTENT_SEP),X[0]===this.name){this.value=X[1];M=M.splice(R,1);B.value=M.join(this._SEPARATOR);
break}}I._globalSaveHandler||(I._globalSaveHandler={},D.addOnUnload(function(){for(var W in I._globalSaveHandler){var k=I._globalSaveHandler[W];w.isFunction(k)&&k()}}));I._globalSaveHandler[this.id]=w.hitch(this,"_saveContent")}this.isClosed=!1;B=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");B.id=this.id+"_iframe";B.style.border="none";B.style.width="100%";this._layoutMode?B.style.height="100%":7<=r("ie")?(this.height&&(B.style.height=this.height),this.minHeight&&(B.style.minHeight=
this.minHeight)):B.style.height=this.height?this.height:this.minHeight;B.frameBorder=0;B._loadFunc=w.hitch(this,function(W){this.window=W;this.document=W.document;this.selection=new T.SelectionManager(W);r("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});M=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");M=11>r("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+M+"');document.close()":"javascript: '"+
M+"'";this.editingArea.appendChild(B);B.src=M;"LI"===C.nodeName&&(C.lastChild.style.marginTop="-1.2em");f.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var g=l.getComputedStyle(this.domNode);if(this["aria-label"])var C=this["aria-label"];else{var B=p('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||m.byId(this["aria-labelledby"],this.ownerDocument);B&&(C=B.textContent||B.innerHTML||"")}B="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(C?" aria-label\x3d'"+d.escape(C)+"'":"")+"\x3e\x3c/div\x3e";var J=[g.fontWeight,g.fontSize,g.fontFamily].join(" "),M=g.lineHeight;M=0<=M.indexOf("px")?parseFloat(M)/parseFloat(g.fontSize):0<=M.indexOf("em")?parseFloat(M):"normal";var Q="",R=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(X){X=X.replace(/^;/ig,"")+";";var W=X.split(":")[0];if(W){W=w.trim(W);W=W.toLowerCase();var k,F="";for(k=0;k<W.length;k++){var L=W.charAt(k);switch(L){case "-":k++,L=W.charAt(k).toUpperCase();default:F+=
L}}l.set(R.domNode,F,"")}Q+=X+";"});this.iframe.setAttribute("title",C);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||b.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",C?"\x3ctitle\x3e"+d.escape(C)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",J,";\n",this.height||r("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",M,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",r("ie")||r("trident")||r("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",C?" aria-label\x3d'"+d.escape(C)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+Q+"'\x3e",B,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var g=[];this.styleSheets&&(g=this.styleSheets.split(";"),this.styleSheets=
"");g=g.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var C="",B=0,J,M=H.get(this.ownerDocument);J=g[B++];)J=(new q(M.location,J)).toString(),this.editingAreaStyleSheets.push(J),C+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+J+'"/\x3e';return C},addStyleSheet:function(g){var C=g.toString(),B=H.get(this.ownerDocument);if("."===C.charAt(0)||"/"!==C.charAt(0)&&!g.host)C=(new q(B.location,C)).toString();-1<N.indexOf(this.editingAreaStyleSheets,C)||(this.editingAreaStyleSheets.push(C),
this.onLoadDeferred.then(w.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(C);else{var J=this.document.getElementsByTagName("head")[0],M=this.document.createElement("link");M.rel="stylesheet";M.type="text/css";M.href=C;J.appendChild(M)}})))},removeStyleSheet:function(g){var C=g.toString(),B=H.get(this.ownerDocument);if("."===C.charAt(0)||"/"!==C.charAt(0)&&!g.host)C=(new q(B.location,C)).toString();g=N.indexOf(this.editingAreaStyleSheets,C);-1!==g&&(delete this.editingAreaStyleSheets[g],
p('link[href\x3d"'+C+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(g){g=!!g;this._set("disabled",g);if(this.isLoaded){var C=r("ie")&&(this.isLoaded||!this.focusOnLoad);C&&(this.editNode.unselectable="on");this.editNode.contentEditable=!g;this.editNode.tabIndex=g?"-1":this.tabIndex;C&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(r("mozilla")&&!g&&this._mozSettingProps){g=this._mozSettingProps;for(var B in g)if(g.hasOwnProperty(B))try{this.document.execCommand(B,
!1,g[B])}catch(J){}}this._disabledOK=!0}},onLoad:function(g){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=O.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var C=this;this.beforeIframeNode=a.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=a.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){C.editNode.focus()};this.focusNode=
this.editNode;var B=this.events.concat(this.captureEvents),J=this.iframe?this.document:this.editNode;this.own.apply(this,N.map(B,function(M){var Q=M.toLowerCase().replace(/^on/,"");return e(J,Q,w.hitch(this,M))},this));this.own(e(J,"mouseup",w.hitch(this,"onClick")));r("ie")&&(this.own(e(this.document,"mousedown",w.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);r("webkit")&&(this._webkitListener=this.own(e(this.document,"mouseup",w.hitch(this,"onDisplayChanged")))[0],this.own(e(this.document,
"mousedown",w.hitch(this,function(M){M=M.target;!M||M!==this.document.body&&M!==this.document||this.defer("placeCursorAtEnd")}))));if(r("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(M){}this.isLoaded=!0;this.set("disabled",this.disabled);B=w.hitch(this,function(){this.setValue(g);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&h(w.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(B):B()},onKeyDown:function(g){if(g.keyCode===u.SHIFT||g.keyCode===u.ALT||g.keyCode===u.META||g.keyCode===u.CTRL)return!0;g.keyCode===u.TAB&&this.isTabIndent&&(g.stopPropagation(),g.preventDefault(),this.queryCommandEnabled(g.shiftKey?"outdent":"indent")&&this.execCommand(g.shiftKey?"outdent":"indent"));if(g.keyCode==u.TAB&&!this.isTabIndent&&!g.ctrlKey&&!g.altKey)return g.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>r("ie")&&g.keyCode===u.BACKSPACE&&"Control"===this.document.selection.type&&(g.stopPropagation(),g.preventDefault(),this.execCommand("delete"));r("ff")&&(g.keyCode===u.PAGE_UP||g.keyCode===u.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&g.preventDefault();var C=this._keyHandlers[g.keyCode],B=arguments;C&&!g.altKey&&N.some(C,function(J){if(!(J.shift^g.shiftKey||J.ctrl^(g.ctrlKey||g.metaKey)))return J.handler.apply(this,B)||g.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(g){b.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",g)},_setValueAttr:function(g){this.setValue(g)},_setDisableSpellCheckAttr:function(g){this.document?c.set(this.document.body,"spellcheck",!g):this.onLoadDeferred.then(w.hitch(this,function(){c.set(this.document.body,"spellcheck",!g)}));this._set("disableSpellCheck",g)},addKeyHandler:function(g,C,B,J){"string"==
typeof g&&(g=g.toUpperCase().charCodeAt(0));w.isArray(this._keyHandlers[g])||(this._keyHandlers[g]=[]);this._keyHandlers[g].push({shift:B||!1,ctrl:C||!1,handler:J})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(g){this.onDisplayChanged(g)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(g){(r("ie")||r("trident"))&&this.defer(function(){O.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var C=this.getValue(!0);if(C!==this.value)this.onChange(C);
this._set("value",C)},_onFocus:function(g){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!r("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>r("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(g,C){g=g.toLowerCase();"formatblock"===g?r("safari")&&void 0===C&&(g="heading"):"hilitecolor"!==g||r("mozilla")||(g="backcolor");return g},_implCommand:function(g){return"_"+this._normalizeCommand(g)+"EnabledImpl"},_qcaCache:{},
queryCommandAvailable:function(g){var C=this._qcaCache[g];return void 0!==C?C:this._qcaCache[g]=this._queryCommandAvailable(g)},_queryCommandAvailable:function(g){switch(g.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return r("ie")||r("trident")||r("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!r("webkit");default:return!1}},execCommand:function(g,C){this.focused&&this.focus();g=this._normalizeCommand(g,C);if(void 0!==C){if("heading"===g)throw Error("unimplemented");"formatblock"===
g&&(r("ie")||r("trident"))&&(C="\x3c"+C+"\x3e")}var B="_"+g+"Impl";if(this[B])var J=this[B](C);else if((C=1<arguments.length?C:null)||"createlink"!==g)J=this.document.execCommand(g,!1,C);this.onDisplayChanged();return J},queryCommandEnabled:function(g){if(this.disabled||!this._disabledOK)return!1;g=this._normalizeCommand(g);var C=this._implCommand(g);return this[C]?this[C](g):this._browserQueryCommandEnabled(g)},queryCommandState:function(g){if(this.disabled||!this._disabledOK)return!1;g=this._normalizeCommand(g);
try{return this.document.queryCommandState(g)}catch(C){return!1}},queryCommandValue:function(g){if(this.disabled||!this._disabledOK)return!1;g=this._normalizeCommand(g);if(r("ie")&&"formatblock"===g)g=this._native2LocalFormatNames[this.document.queryCommandValue(g)];else if(r("mozilla")&&"hilitecolor"===g){try{var C=this.document.queryCommandValue("styleWithCSS")}catch(B){C=!1}this.document.execCommand("styleWithCSS",!1,!0);g=this.document.queryCommandValue(g);this.document.execCommand("styleWithCSS",
!1,C)}else g=this.document.queryCommandValue(g);return g},_sCall:function(g,C){return this.selection[g].apply(this.selection,C)},placeCursorAtStart:function(){this.focus();var g=!1;if(r("mozilla"))for(var C=this.editNode.firstChild;C;){if(3===C.nodeType){if(0<C.nodeValue.replace(/^\s+|\s+$/g,"").length){g=!0;this.selection.selectElement(C);break}}else if(1===C.nodeType){g=!0;var B=C.tagName?C.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(B)?this.selection.selectElement(C):
this.selection.selectElementChildren(C);break}C=C.nextSibling}else g=!0,this.selection.selectElementChildren(this.editNode);g&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var g=!1;if(r("mozilla"))for(var C=this.editNode.lastChild;C;){if(3===C.nodeType){if(0<C.nodeValue.replace(/^\s+|\s+$/g,"").length){g=!0;this.selection.selectElement(C);break}}else if(1===C.nodeType){g=!0;this.selection.selectElement(C.lastChild||C);break}C=C.previousSibling}else g=!0,this.selection.selectElementChildren(this.editNode);
g&&this.selection.collapse(!1)},getValue:function(g){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,g):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(g){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){g=this._preFilterContent(g);var C=this.isClosed?this.domNode:this.editNode;C.innerHTML=g;this._preDomFilterContent(C)}else this.textarea.value=g;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(w.hitch(this,function(){this.setValue(g)}))},replaceValue:function(g){this.isClosed?this.setValue(g):this.window&&this.window.getSelection&&!r("mozilla")?this.setValue(g):this.window&&this.window.getSelection?(g=this._preFilterContent(g),this.execCommand("selectall"),this.execCommand("inserthtml",g),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(g);this._set("value",this.getValue(!0))},_preFilterContent:function(g){var C=
g;N.forEach(this.contentPreFilters,function(B){B&&(C=B(C))});return C},_preDomFilterContent:function(g){g=g||this.editNode;N.forEach(this.contentDomPreFilters,function(C){C&&w.isFunction(C)&&C(g)},this)},_postFilterContent:function(g,C){if(w.isString(g))var B=g;else g=g||this.editNode,this.contentDomPostFilters.length&&(C&&(g=w.clone(g)),N.forEach(this.contentDomPostFilters,function(J){g=J(g)})),B=S.getChildrenHtml(g);w.trim(B.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(B="");N.forEach(this.contentPostFilters,
function(J){B=J(B)});return B},_saveContent:function(){var g=m.byId(V._scopeName+"._editor.RichText.value");g&&(g.value&&(g.value+=this._SEPARATOR),g.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(g,C){g=g.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");C||(g=g.replace(/'/gm,"\x26#39;"));return g},getNodeHtml:function(g){b.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return S.getNodeHtml(g)},getNodeChildrenHtml:function(g){b.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return S.getChildrenHtml(g)},close:function(g){if(!this.isClosed){arguments.length||(g=!0);g&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);r("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var C=this.textarea.style;C.position="";C.left=C.top="";r("ie")&&(C.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;a.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;f.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);I._globalSaveHandler&&delete I._globalSaveHandler[this.id]},_removeMozBogus:function(g){return g.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(g){g=g.replace(/\sclass="webkit-block-placeholder"/gi,"");g=g.replace(/\sclass="apple-style-span"/gi,
"");return g=g.replace(/<meta charset="utf-8" \/>/gi,"")},_normalizeFontStyle:function(g){return g.replace(/<(\/)?strong([ >])/gi,"\x3c$1b$2").replace(/<(\/)?em([ >])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(g){return g.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(g){if(!g)return!1;
var C=9>r("ie")?this.document.selection.createRange():this.document;try{return C.queryCommandEnabled(g)}catch(B){return!1}},_createlinkEnabledImpl:function(){var g=!0;return g=r("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var g=!0;return g=r("mozilla")||r("webkit")?this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var g=
!0;return g=r("mozilla")||r("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var g=!0;r("webkit")?((g=this.window.getSelection())&&(g=g.toString()),g=!!g):g=this._browserQueryCommandEnabled("cut");return g},_copyEnabledImpl:function(){var g=!0;r("webkit")?((g=this.window.getSelection())&&(g=g.toString()),g=!!g):g=this._browserQueryCommandEnabled("copy");return g},_pasteEnabledImpl:function(){var g=!0;return r("webkit")?!0:g=this._browserQueryCommandEnabled("paste")},
_inserthorizontalruleImpl:function(g){return r("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,g)},_unlinkImpl:function(g){return this.queryCommandEnabled("unlink")&&(r("mozilla")||r("webkit"))?(g=this.selection.getAncestorElement("a"),this.selection.selectElement(g),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",!1,g)},_hilitecolorImpl:function(g){if(!this._handleTextColorOrProperties("hilitecolor",g))if(r("mozilla")){this.document.execCommand("styleWithCSS",
!1,!0);console.log("Executing color command.");var C=this.document.execCommand("hilitecolor",!1,g);this.document.execCommand("styleWithCSS",!1,!1)}else C=this.document.execCommand("hilitecolor",!1,g);return C},_backcolorImpl:function(g){r("ie")&&(g=g?g:null);var C=this._handleTextColorOrProperties("backcolor",g);C||(C=this.document.execCommand("backcolor",!1,g));return C},_forecolorImpl:function(g){r("ie")&&(g=g?g:null);var C=!1;(C=this._handleTextColorOrProperties("forecolor",g))||(C=this.document.execCommand("forecolor",
!1,g));return C},_inserthtmlImpl:function(g){g=this._preFilterContent(g);var C=!0;if(9>r("ie")){var B=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var J=B.item(0);B.length;)B.remove(B.item(0));J.outerHTML=g}else B.pasteHTML(g);B.select()}else if(8>r("trident")){var M=A.getSelection(this.window);if(M&&M.rangeCount&&M.getRangeAt){B=M.getRangeAt(0);B.deleteContents();var Q=a.create("div");Q.innerHTML=g;for(J=this.document.createDocumentFragment();g=
Q.firstChild;)var R=J.appendChild(g);B.insertNode(J);R&&(B=B.cloneRange(),B.setStartAfter(R),B.collapse(!1),M.removeAllRanges(),M.addRange(B))}}else r("mozilla")&&!g.length?this.selection.remove():C=this.document.execCommand("inserthtml",!1,g);return C},_boldImpl:function(g){var C=!1;if(r("ie")||r("trident"))this._adaptIESelection(),C=this._adaptIEFormatAreaAndExec("bold");C||(C=this.document.execCommand("bold",!1,g));return C},_italicImpl:function(g){var C=!1;if(r("ie")||r("trident"))this._adaptIESelection(),
C=this._adaptIEFormatAreaAndExec("italic");C||(C=this.document.execCommand("italic",!1,g));return C},_underlineImpl:function(g){var C=!1;if(r("ie")||r("trident"))this._adaptIESelection(),C=this._adaptIEFormatAreaAndExec("underline");C||(C=this.document.execCommand("underline",!1,g));return C},_strikethroughImpl:function(g){var C=!1;if(r("ie")||r("trident"))this._adaptIESelection(),C=this._adaptIEFormatAreaAndExec("strikethrough");C||(C=this.document.execCommand("strikethrough",!1,g));return C},_superscriptImpl:function(g){var C=
!1;if(r("ie")||r("trident"))this._adaptIESelection(),C=this._adaptIEFormatAreaAndExec("superscript");C||(C=this.document.execCommand("superscript",!1,g));return C},_subscriptImpl:function(g){var C=!1;if(r("ie")||r("trident"))this._adaptIESelection(),C=this._adaptIEFormatAreaAndExec("subscript");C||(C=this.document.execCommand("subscript",!1,g));return C},_fontnameImpl:function(g){if(r("ie")||r("trident"))var C=this._handleTextColorOrProperties("fontname",g);C||(C=this.document.execCommand("fontname",
!1,g));return C},_fontsizeImpl:function(g){if(r("ie")||r("trident"))var C=this._handleTextColorOrProperties("fontsize",g);C||(C=this.document.execCommand("fontsize",!1,g));return C},_insertorderedlistImpl:function(g){var C=!1;if(r("ie")||r("trident")||r("edge"))C=this._adaptIEList("insertorderedlist",g);C||(C=this.document.execCommand("insertorderedlist",!1,g));return C},_insertunorderedlistImpl:function(g){var C=!1;if(r("ie")||r("trident")||r("edge"))C=this._adaptIEList("insertunorderedlist",g);
C||(C=this.document.execCommand("insertunorderedlist",!1,g));return C},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(g){var C=0;if(g&&g.childNodes){var B;for(B=0;B<g.childNodes.length;B++){var J=n.position(g.childNodes[B]);C+=J.h}}return C},_isNodeEmpty:function(g,C){return 1===g.nodeType?0<g.childNodes.length?this._isNodeEmpty(g.childNodes[0],C):!0:3===g.nodeType?
""===g.nodeValue.substring(C):!1},_removeStartingRangeFromRange:function(g,C){if(g.nextSibling)C.setStart(g.nextSibling,0);else{for(g=g.parentNode;g&&null==g.nextSibling;)g=g.parentNode;g&&C.setStart(g.nextSibling,0)}return C},_adaptIESelection:function(){var g=A.getSelection(this.window);if(g&&g.rangeCount&&!g.isCollapsed){for(var C=g.getRangeAt(0),B=C.startContainer,J=C.startOffset;3===B.nodeType&&J>=B.length&&B.nextSibling;)J-=B.length,B=B.nextSibling;for(var M=null;this._isNodeEmpty(B,J)&&B!==
M;)M=B,C=this._removeStartingRangeFromRange(B,C),B=C.startContainer,J=0;g.removeAllRanges();g.addRange(C)}},_adaptIEFormatAreaAndExec:function(g){var C=A.getSelection(this.window),B=this.document,J;if(g&&C&&C.isCollapsed){if(this.queryCommandValue(g)){g=this._tagNamesForCommand(g);var M=C.getRangeAt(0);var Q=M.startContainer;if(3===Q.nodeType){var R=M.endOffset;Q.length<R&&(R=this._adjustNodeAndOffset(X,R),Q=R.node,R=R.offset)}for(;Q&&Q!==this.editNode;){var X=Q.tagName?Q.tagName.toLowerCase():"";
if(-1<N.indexOf(g,X)){var W=Q;break}Q=Q.parentNode}if(W&&(X=M.startContainer,g=B.createElement(W.tagName),a.place(g,W,"after"),X&&3===X.nodeType)){R=M.endOffset;X.length<R&&(R=this._adjustNodeAndOffset(X,R),X=R.node,R=R.offset);Q=X.nodeValue;M=B.createTextNode(Q.substring(0,R));var k=Q.substring(R,Q.length);k&&(J=B.createTextNode(k));a.place(M,X,"before");if(J){var F=B.createElement("span");F.className="ieFormatBreakerSpan";a.place(F,X,"after");a.place(J,F,"after");J=F}a.destroy(X);R=M.parentNode;
for(X=[];R!==W;){Q=R.tagName;M={tagName:Q};X.push(M);Q=B.createElement(Q);R.style&&Q.style&&R.style.cssText&&(Q.style.cssText=R.style.cssText,M.cssText=R.style.cssText);"FONT"===R.tagName&&(R.color&&(Q.color=R.color,M.color=R.color),R.face&&(Q.face=R.face,M.face=R.face),R.size&&(Q.size=R.size,M.size=R.size));R.className&&(Q.className=R.className,M.className=R.className);if(J)for(;J;)M=J.nextSibling,Q.appendChild(J),J=M;Q.tagName==R.tagName?(F=B.createElement("span"),F.className="ieFormatBreakerSpan",
a.place(F,R,"after"),a.place(Q,F,"after")):a.place(Q,R,"after");M=R;J=Q;R=R.parentNode}if(J){if(1===J.nodeType||3===J.nodeType&&J.nodeValue)g.innerHTML="";for(;J;)M=J.nextSibling,g.appendChild(J),J=M}if(X.length){M=X.pop();J=B.createElement(M.tagName);M.cssText&&J.style&&(J.style.cssText=M.cssText);M.className&&(J.className=M.className);"FONT"===M.tagName&&(M.color&&(J.color=M.color),M.face&&(J.face=M.face),M.size&&(J.size=M.size));for(a.place(J,g,"before");X.length;)M=X.pop(),W=B.createElement(M.tagName),
M.cssText&&W.style&&(W.style.cssText=M.cssText),M.className&&(W.className=M.className),"FONT"===M.tagName&&(M.color&&(W.color=M.color),M.face&&(W.face=M.face),M.size&&(W.size=M.size)),J.appendChild(W),J=W;W=B.createTextNode(".");F.appendChild(W);J.appendChild(W)}else F=B.createElement("span"),F.className="ieFormatBreakerSpan",W=B.createTextNode("."),F.appendChild(W),a.place(F,g,"before");J=A.create(this.window);J.setStart(W,0);J.setEnd(W,W.length);C.removeAllRanges();C.addRange(J);this.selection.collapse(!1);
W.parentNode.innerHTML="";g.firstChild||a.destroy(g);return!0}return!1}M=C.getRangeAt(0);if((X=M.startContainer)&&3===X.nodeType)return R=M.startOffset,X.length<R&&(R=this._adjustNodeAndOffset(X,R),X=R.node,R=R.offset),Q=X.nodeValue,M=B.createTextNode(Q.substring(0,R)),k=Q.substring(R),""!==k&&(J=B.createTextNode(Q.substring(R))),F=B.createElement("span"),W=B.createTextNode("."),F.appendChild(W),M.length?a.place(M,X,"after"):M=X,a.place(F,M,"after"),J&&a.place(J,F,"after"),a.destroy(X),J=A.create(this.window),
J.setStart(W,0),J.setEnd(W,W.length),C.removeAllRanges(),C.addRange(J),B.execCommand(g),a.place(F.firstChild,F,"before"),a.destroy(F),J.setStart(W,0),J.setEnd(W,W.length),C.removeAllRanges(),C.addRange(J),this.selection.collapse(!1),W.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(g){var C=A.getSelection(this.window);if(C.isCollapsed&&C.rangeCount&&!this.queryCommandValue(g)){var B=C.getRangeAt(0),J=B.startContainer;if(J&&3==J.nodeType&&!B.startOffset)return B="ul","insertorderedlist"===
g&&(B="ol"),g=this.document.createElement(B),B=a.create("li",null,g),a.place(g,J,"before"),B.appendChild(J),a.create("br",null,g,"after"),g=A.create(this.window),g.setStart(J,0),g.setEnd(J,J.length),C.removeAllRanges(),C.addRange(g),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(g,C){var B=A.getSelection(this.window),J=this.document,M,Q;C=C||null;if(g&&B&&B.isCollapsed&&B.rangeCount){var R=B.getRangeAt(0);if((M=R.startContainer)&&3===M.nodeType){var X=R.startOffset;
M.length<X&&(R=this._adjustNodeAndOffset(M,X),M=R.node,X=R.offset);var W=M.nodeValue;R=J.createTextNode(W.substring(0,X));""!==W.substring(X)&&(Q=J.createTextNode(W.substring(X)));W=J.createElement("span");X=J.createTextNode(".");W.appendChild(X);J=J.createElement("span");W.appendChild(J);R.length?a.place(R,M,"after"):R=M;a.place(W,R,"after");Q&&a.place(Q,W,"after");a.destroy(M);M=A.create(this.window);M.setStart(X,0);M.setEnd(X,X.length);B.removeAllRanges();B.addRange(M);if(r("webkit")){B="color";
if("hilitecolor"===g||"backcolor"===g)B="backgroundColor";l.set(W,B,C);this.selection.remove();a.destroy(J);W.innerHTML="\x26#160;";this.selection.selectElement(W);this.focus()}else this.execCommand(g,C),a.place(W.firstChild,W,"before"),a.destroy(W),M.setStart(X,0),M.setEnd(X,X.length),B.removeAllRanges(),B.addRange(M),this.selection.collapse(!1),X.parentNode.removeChild(X);return!0}}return!1},_adjustNodeAndOffset:function(g,C){for(;g.length<C&&g.nextSibling&&3===g.nextSibling.nodeType;)C-=g.length,
g=g.nextSibling;return{node:g,offset:C}},_tagNamesForCommand:function(g){return"bold"===g?["b","strong"]:"italic"===g?["i","em"]:"strikethrough"===g?["s","strike"]:"superscript"===g?["sup"]:"subscript"===g?["sub"]:"underline"===g?["u"]:[]},_stripBreakerNodes:function(g){if(this.isLoaded)return p(".ieFormatBreakerSpan",g).forEach(function(C){for(;C.firstChild;)a.place(C.firstChild,C,"before");a.destroy(C)}),g},_stripTrailingEmptyNodes:function(g){function C(B){return/^(p|div|br)$/i.test(B.nodeName)&&
0==B.children.length&&/^[\s\xA0]*$/.test(B.textContent||B.innerText||"")||3===B.nodeType&&/^[\s\xA0]*$/.test(B.nodeValue)}for(;g.lastChild&&C(g.lastChild);)a.destroy(g.lastChild);return g},_setTextDirAttr:function(g){this._set("textDir",g);this.onLoadDeferred.then(w.hitch(this,function(){this.editNode.dir=g}))}});return I})},"dijit/_editor/range":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(N,v,z){var y={getIndex:function(f,a){for(var n=[],l=[],b=f,u,w;f!=
a;){var e=0;for(u=f.parentNode;w=u.childNodes[e++];)if(w===f){--e;break}n.unshift(e);l.unshift(e-u.childNodes.length);f=u}if(0<n.length&&3==b.nodeType){for(w=b.previousSibling;w&&3==w.nodeType;)n[n.length-1]--,w=w.previousSibling;for(w=b.nextSibling;w&&3==w.nodeType;)l[l.length-1]++,w=w.nextSibling}return{o:n,r:l}},getNode:function(f,a){if(!z.isArray(f)||0==f.length)return a;var n=a;N.every(f,function(l){if(0<=l&&l<n.childNodes.length)n=n.childNodes[l];else return n=null,!1;return!0});return n},getCommonAncestor:function(f,
a,n){n=n||f.ownerDocument.body;var l=function(w){for(var e=[];w;)if(e.unshift(w),w!==n)w=w.parentNode;else break;return e};f=l(f);a=l(a);l=Math.min(f.length,a.length);for(var b=f[0],u=1;u<l;u++)if(f[u]===a[u])b=f[u];else break;return b},getAncestor:function(f,a,n){for(n=n||f.ownerDocument.body;f&&f!==n;){var l=f.nodeName.toUpperCase();if(a.test(l))return f;f=f.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(f,a,n){n=n||f.ownerDocument.body;
a=a||y.BlockTagNames;for(var l=null,b;f&&f!==n;){var u=f.nodeName.toUpperCase();!l&&a.test(u)&&(l=f);!b&&/^(?:BODY|TD|TH|CAPTION)$/.test(u)&&(b=f);f=f.parentNode}return{blockNode:l,blockContainer:b||f.ownerDocument.body}},atBeginningOfContainer:function(f,a,n){var l=!1,b=0==n;b||3!=a.nodeType||/^[\s\xA0]+$/.test(a.nodeValue.substr(0,n))&&(b=!0);if(b)for(l=!0;a&&a!==f;){if(a.previousSibling){l=!1;break}a=a.parentNode}return l},atEndOfContainer:function(f,a,n){var l=!1,b=n==(a.length||a.childNodes.length);
b||3!=a.nodeType||/^[\s\xA0]+$/.test(a.nodeValue.substr(n))&&(b=!0);if(b)for(l=!0;a&&a!==f;){if(a.nextSibling){l=!1;break}a=a.parentNode}return l},adjacentNoneTextNode:function(f,a){var n=f;f=0-f.length||0;for(a=a?"nextSibling":"previousSibling";n&&3==n.nodeType;)f+=n.length,n=n[a];return[n,f]},create:function(f){f=f||window;return f.getSelection?f.document.createRange():new c},getSelection:function(f,a){if(f.getSelection)return f.getSelection();f=new m.selection(f);a||f._getCurrentSelection();return f}};
if(!window.getSelection)var m=y.ie={cachedSelection:{},selection:function(f){this._ranges=[];this.addRange=function(a,n){this._ranges.push(a);n||a._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(a){return this._ranges[a]};this._getCurrentSelection=function(){this.removeAllRanges();var a=f.document.selection.createRange();a="CONTROL"==f.document.selection.type.toUpperCase()?new c(m.decomposeControlRange(a)):
new c(m.decomposeTextRange(a));this.addRange(a,!0),this.isCollapsed=a.collapsed}},decomposeControlRange:function(f){var a=f.item(0),n=f.item(f.length-1);f=a.parentNode;var l=n.parentNode;a=y.getIndex(a,f).o[0];n=y.getIndex(n,l).o[0]+1;return[f,a,l,n]},getEndPoint:function(f,a){var n=f.duplicate();n.collapse(!a);var l="EndTo"+(a?"End":"Start"),b=n.parentElement(),u;if(0<b.childNodes.length)N.every(b.childNodes,function(p,h){if(3!=p.nodeType)if(n.moveToElementText(p),0<n.compareEndPoints(l,f))if(u&&
3==u.nodeType){w=u;var r=!0}else return w=b,e=h,!1;else{if(h==b.childNodes.length-1)return w=b,e=b.childNodes.length,!1}else h==b.childNodes.length-1&&(w=p,r=!0);if(r&&w)return w=(p=y.adjacentNoneTextNode(w)[0])?p.nextSibling:b.firstChild,h=y.adjacentNoneTextNode(w),p=h[0],h=h[1],p?(n.moveToElementText(p),n.collapse(!1)):n.moveToElementText(b),n.setEndPoint(l,f),e=n.text.length-h,!1;u=p;return!0});else{var w=b;var e=0}a||1!=w.nodeType||e!=w.childNodes.length||(a=w.nextSibling)&&3==a.nodeType&&(w=
a,e=0);return[w,e]},setEndPoint:function(f,a,n){f=f.duplicate();var l;if(3!=a.nodeType)if(0<n){if(l=a.childNodes[n-1])if(3==l.nodeType)a=l,n=l.length;else if(l.nextSibling&&3==l.nextSibling.nodeType)a=l.nextSibling,n=0;else{f.moveToElementText(l.nextSibling?l:a);var b=l.parentNode;l=b.insertBefore(l.ownerDocument.createTextNode(" "),l.nextSibling);f.collapse(!1);b.removeChild(l)}}else f.moveToElementText(a),f.collapse(!0);3==a.nodeType&&(l=y.adjacentNoneTextNode(a),b=l[0],l=l[1],b?(f.moveToElementText(b),
f.collapse(!1),"inherit"!=b.contentEditable&&l++):(f.moveToElementText(a.parentNode),f.collapse(!0),f.move("character",1),f.move("character",-1)),n+=l,0<n&&f.move("character",n)!=n&&console.error("Error when moving!"));return f},decomposeTextRange:function(f){var a=m.getEndPoint(f),n=a[0],l=a[1],b=a[0];a=a[1];f.htmlText.length&&(f.htmlText==f.text?a=l+f.text.length:(a=m.getEndPoint(f,!0),b=a[0],a=a[1]));return[n,l,b,a]},setRange:function(f,a,n,l,b,u){a=m.setEndPoint(f,a,n);f.setEndPoint("StartToStart",
a);if(!u)var w=m.setEndPoint(f,l,b);f.setEndPoint("EndToEnd",w||a);return f}},c=y.W3CRange=v(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=this.startContainer!==this.endContainer?y.getCommonAncestor(this.startContainer,
this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(f,a){a=parseInt(a);if(this.startContainer!==f||this.startOffset!=a)delete this._cachedBookmark,this.startContainer=f,this.startOffset=a,this.endContainer?this._updateInternal():this.setEnd(f,a)},setEnd:function(f,a){a=parseInt(a);if(this.endContainer!==f||this.endOffset!=a)delete this._cachedBookmark,this.endContainer=f,this.endOffset=a,this.startContainer?
this._updateInternal():this.setStart(f,a)},setStartAfter:function(f,a){this._setPoint("setStart",f,a,1)},setStartBefore:function(f,a){this._setPoint("setStart",f,a,0)},setEndAfter:function(f,a){this._setPoint("setEnd",f,a,1)},setEndBefore:function(f,a){this._setPoint("setEnd",f,a,0)},_setPoint:function(f,a,n,l){n=y.getIndex(a,a.parentNode).o;this[f](a.parentNode,n.pop()+l)},_getIERange:function(){var f=(this._body||this.endContainer.ownerDocument.body).createTextRange();m.setRange(f,this.startContainer,
this.startOffset,this.endContainer,this.endOffset,this.collapsed);return f},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var f=this.startContainer,a=this._getIERange();3!==f.nodeType||this.startOffset||this.setStartBefore(f);a.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var f=new c([this.startContainer,this.startOffset,
this.endContainer,this.endOffset]);f._body=this._body;return f},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});z.setObject("dijit.range",y);return y})},"dijit/_editor/html":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/sniff"],function(N,v,z){var y={};v.setObject("dijit._editor.html",y);var m=y.escapeXml=function(c,f){c=c.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,
"\x26gt;").replace(/"/gm,"\x26quot;");f||(c=c.replace(/'/gm,"\x26#39;"));return c};y.getNodeHtml=function(c){var f=[];y.getNodeHtmlHelper(c,f);return f.join("")};y.getNodeHtmlHelper=function(c,f){switch(c.nodeType){case 1:var a=c.nodeName.toLowerCase();if(!a||"/"==a.charAt(0))return"";f.push("\x3c",a);var n=[],l={},b;if(z("dom-attributes-explicit")||z("dom-attributes-specified-flag"))for(var u=0;b=c.attributes[u++];){var w=b.name;"_dj"===w.substr(0,3)||z("dom-attributes-specified-flag")&&!b.specified||
w in l||(b=b.value,("src"==w||"href"==w)&&c.getAttribute("_djrealurl")&&(b=c.getAttribute("_djrealurl")),8===z("ie")&&"style"===w&&(b=b.replace("HEIGHT:","height:").replace("WIDTH:","width:")),n.push([w,b]),l[w]=b)}else{var e=(/^input$|^img$/i.test(c.nodeName)?c:c.cloneNode(!1)).outerHTML;l=e.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi);e=e.substr(0,e.indexOf("\x3e"));N.forEach(l,function(p){if(p){var h=p.indexOf("\x3d");if(0<h&&(p=p.substring(0,h),"_dj"!=p.substr(0,3)))if("src"!=p&&"href"!=p||!c.getAttribute("_djrealurl")){switch(p){case "style":var r=
c.style.cssText.toLowerCase();break;case "class":r=c.className;break;case "width":if("img"===a){(h=/width=(\S+)/i.exec(e))&&(r=h[1]);break}case "height":if("img"===a){(h=/height=(\S+)/i.exec(e))&&(r=h[1]);break}default:r=c.getAttribute(p)}null!=r&&n.push([p,r.toString()])}else n.push([p,c.getAttribute("_djrealurl")])}},this)}n.sort(function(p,h){return p[0]<h[0]?-1:p[0]==h[0]?0:1});for(l=0;b=n[l++];)f.push(" ",b[0],'\x3d"',"string"===typeof b[1]?m(b[1],!0):b[1],'"');switch(a){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":f.push(" /\x3e");
break;case "script":f.push("\x3e",c.innerHTML,"\x3c/",a,"\x3e");break;default:f.push("\x3e"),c.hasChildNodes()&&y.getChildrenHtmlHelper(c,f),f.push("\x3c/",a,"\x3e")}break;case 4:case 3:f.push(m(c.nodeValue,!0));break;case 8:f.push("\x3c!--",m(c.nodeValue,!0),"--\x3e");break;default:f.push("\x3c!-- Element not recognized - Type: ",c.nodeType," Name: ",c.nodeName,"--\x3e")}};y.getChildrenHtml=function(c){var f=[];y.getChildrenHtmlHelper(c,f);return f.join("")};y.getChildrenHtmlHelper=function(c,f){if(c)for(var a=
c.childNodes||c,n=!z("ie")||a!==c,l,b=0;l=a[b++];)n&&l.parentNode!=c||y.getNodeHtmlHelper(l,f)};return y})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u,w){var e=z("dijit._editor.plugins.LinkDialog",b,{allowUnsafeHtml:!1,linkFilter:[[/</g,"\x26lt;"]],buttonClass:u,useDefaultCommand:!1,
urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=c.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(h){N("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),c.hitch(this,function(r,d,x){var D=this;this.tag="insertImage"==this.command?"img":"a";r=c.delegate(r.getLocalization("dijit","common",this.lang),r.getLocalization("dijit._editor",
"LinkDialog",this.lang));var q=this.dropDown=this.button.dropDown=new d({title:r[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:c.hitch(this,"setValue"),onOpen:function(){D._onOpenDialog();d.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(c.hitch(D,"_onCloseDialog"),0)}});r.urlRegExp=this.urlRegExp;r.id=x.getUniqueId(this.editor.id);this._uniqueId=r.id;this._setContent(q.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
l.substitute(this.linkDialogTemplate,r));q.startup();this._urlInput=x.byId(this._uniqueId+"_urlInput");this._textInput=x.byId(this._uniqueId+"_textInput");this._setButton=x.byId(this._uniqueId+"_setButton");this.own(x.byId(this._uniqueId+"_cancelButton").on("click",c.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",c.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",c.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=c.hitch(this,function(){var H=this._urlInput.get("value");return this._urlRegExp.test(H)||this._emailRegExp.test(H)});this.own(f(q.domNode,"keydown",c.hitch(this,c.hitch(this,function(H){!H||H.keyCode!=m.ENTER||H.shiftKey||H.metaKey||H.ctrlKey||H.altKey||this._setButton.get("disabled")||(q.onExecute(),q.execute(q.get("value")))}))));h()}))},_checkAndFixInput:function(){var h=this,r=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var d=r,x=!1,D=!1;d&&1<d.length&&(d=c.trim(d),0!==d.indexOf("mailto:")&&(0<d.indexOf("/")?-1===d.indexOf("://")&&"/"!==d.charAt(0)&&d.indexOf("./")&&0!==d.indexOf("../")&&h._hostRxp.test(d)&&(x=!0):h._userAtRxp.test(d)&&(D=!0)));x&&h._urlInput.set("value","http://"+d);D&&h._urlInput.set("value","mailto:"+d);h._setButton.set("disabled",!h._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(c.hitch(this,
function(){this.own(f(this.editor.editNode,"mouseup",c.hitch(this,"_onMouseUp")));this.own(f(this.editor.editNode,"dblclick",c.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(h){this.dropDown.set({parserScope:"dojo",content:h})},_checkValues:function(h){h&&h.urlInput&&(h.urlInput=h.urlInput.replace(/"/g,"\x26quot;"));!this.allowUnsafeHtml&&h&&h.textInput&&("function"===typeof this.linkFilter?h.textInput=this.linkFilter(h.textInput):
v.forEach(this.linkFilter,function(r){h.textInput=h.textInput.replace(r[0],r[1])}));return h},_createlinkEnabledImpl:function(){return!0},setValue:function(h){this._onCloseDialog();if(9>a("ie")){var r=w.getSelection(this.editor.window).getRangeAt(0).endContainer;3===r.nodeType&&(r=r.parentNode);r&&r.nodeName&&r.nodeName.toLowerCase()!==this.tag&&(r=this.editor.selection.getSelectedElement(this.tag));r&&r.nodeName&&r.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(r),
this.editor.execCommand("unlink"))}h=this._checkValues(h);this.editor.execCommand("inserthtml",l.substitute(this.htmlTemplate,h));n("a",this.editor.document).forEach(function(d){d.innerHTML||y.has(d,"name")||d.parentNode.removeChild(d)},this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(h){if(h&&h.tagName.toLowerCase()===this.tag){var r=h.getAttribute("_djrealurl")||h.getAttribute("href");var d=h.getAttribute("target")||"_self";var x=h.textContent||
h.innerText;this.editor.selection.selectElement(h,!0)}else x=this.editor.selection.getSelectedText();return{urlInput:r||"",textInput:x||"",targetSelect:d||""}},_onOpenDialog:function(){if(a("ie")){var h=w.getSelection(this.editor.window);if(h.rangeCount){var r=h.getRangeAt(0);var d=r.endContainer;3===d.nodeType&&(d=d.parentNode);d&&d.nodeName&&d.nodeName.toLowerCase()!==this.tag&&(d=this.editor.selection.getSelectedElement(this.tag));if(!d||d.nodeName&&d.nodeName.toLowerCase()!==this.tag)(h=this.editor.selection.getAncestorElement(this.tag))&&
h.nodeName&&h.nodeName.toLowerCase()==this.tag?(d=h,this.editor.selection.selectElement(d)):r.startContainer===r.endContainer&&(h=r.startContainer.firstChild)&&h.nodeName&&h.nodeName.toLowerCase()==this.tag&&(d=h,this.editor.selection.selectElement(d))}}else d=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(d))},_onDblClick:function(h){if(h&&h.target&&(h=h.target,(h.tagName?h.tagName.toLowerCase():
"")===this.tag&&y.get(h,"href"))){var r=this.editor;this.editor.selection.selectElement(h);r.onDisplayChanged();r._updateTimer&&(r._updateTimer.remove(),delete r._updateTimer);r.onNormalizedDisplayChanged();var d=this.button;setTimeout(function(){d.set("disabled",!1);d.loadAndOpenDropDown().then(function(){d.dropDown.focus&&d.dropDown.focus()})},10)}},_onMouseUp:function(){if(a("ff")){var h=this.editor.selection.getAncestorElement(this.tag);if(h){var r=w.getSelection(this.editor.window).getRangeAt(0);
if(r.collapsed&&h.childNodes.length){var d=r.cloneRange();d.selectNodeContents(h.childNodes[h.childNodes.length-1]);d.setStart(h.childNodes[0],0);1!==r.compareBoundaryPoints(d.START_TO_START,d)?r.setStartBefore(h):-1!==r.compareBoundaryPoints(d.END_TO_START,d)&&r.setStartAfter(h)}}}}}),p=z("dijit._editor.plugins.ImgLinkDialog",[e],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(h){if(h&&h.tagName.toLowerCase()===this.tag){var r=h.getAttribute("_djrealurl")||h.getAttribute("src");var d=h.getAttribute("alt");this.editor.selection.selectElement(h,!0)}else d=this.editor.selection.getSelectedText();return{urlInput:r||"",textInput:d||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);
this.editor.onLoadDeferred.then(c.hitch(this,function(){this.own(f(this.editor.editNode,"mousedown",c.hitch(this,"_selectTag")))}))},_selectTag:function(h){h&&h.target&&(h=h.target,(h.tagName?h.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(h))},_checkValues:function(h){h&&h.urlInput&&(h.urlInput=h.urlInput.replace(/"/g,"\x26quot;"));h&&h.textInput&&(h.textInput=h.textInput.replace(/"/g,"\x26quot;"));return h},_onDblClick:function(h){if(h&&h.target&&(h=h.target,(h.tagName?
h.tagName.toLowerCase():"")===this.tag&&y.get(h,"src"))){var r=this.editor;this.editor.selection.selectElement(h);r.onDisplayChanged();r._updateTimer&&(r._updateTimer.remove(),delete r._updateTimer);r.onNormalizedDisplayChanged();var d=this.button;setTimeout(function(){d.set("disabled",!1);d.loadAndOpenDropDown().then(function(){d.dropDown.focus&&d.dropDown.focus()})},10)}}});b.registry.createLink=function(h){var r={command:"createLink",allowUnsafeHtml:"allowUnsafeHtml"in h?h.allowUnsafeHtml:!1};
"linkFilter"in h&&(r.linkFilter=h.linkFilter);return new e(r)};b.registry.insertImage=function(){return new p({command:"insertImage"})};e.ImgLinkDialog=p;return e})},"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(N,v,z,y,m,c){var f=z("dijit._editor.plugins.TextColor",m,{buttonClass:c,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;
this.inherited(arguments);var a=this;this.button.loadDropDown=function(n){function l(b){a.button.dropDown=new b({dir:a.editor.dir,ownerDocument:a.editor.ownerDocument,value:a.value,onChange:function(u){a.editor.execCommand(a.command,u)},onExecute:function(){a.editor.execCommand(a.command,this.get("value"))}});n()}"string"==typeof a.colorPicker?N([a.colorPicker],l):l(a.colorPicker)}},updateState:function(){var a=this.editor,n=this.command;if(a&&a.isLoaded&&n.length){if(this.button){var l=this.get("disabled");
this.button.set("disabled",l);if(l)return;try{var b=a.queryCommandValue(n)||""}catch(u){b=""}}""==b&&(b="#000000");"transparent"==b&&(b="#ffffff");"string"==typeof b?-1<b.indexOf("rgb")&&(b=v.fromRgb(b).toHex()):(b=((b&255)<<16|b&65280|(b&16711680)>>>16).toString(16),b="#000000".slice(0,7-b.length)+b);this.value=b;(a=this.button.dropDown)&&a.get&&b!==a.get("value")&&a.set("value",b,!1)}}});m.registry.foreColor=function(a){return new f(a)};m.registry.hiliteColor=function(a){return new f(a)};return f})},
"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,p,h,r){N=N([l,b],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,
templateString:h,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},_layerEditingCap:{},constructor:function(d,x){v.mixin(this,r.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);
this._uploadField_connect=z.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=z.connect(this._uploadField,"onfocus",v.hitch(this,function(d){p.hide(this._attachmentError)}))},destroy:function(){y.forEach(this._aeConnects,z.disconnect);z.disconnect(this._uploadField_connect);z.disconnect(this._uploadFieldFocus_connect);this.inherited(arguments)},showAttachments:function(d,x){this._attachmentList.innerHTML=this.NLS_none;
this._uploadField.value="";y.forEach(this.domNode.children,function(D,q){p.show(D)});p.hide(this._attachmentError);d&&(this._featureLayer=d.getLayer()||x)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=
this._featureLayer.getEditCapabilities({feature:d}).canUpdate,this._oid=d.attributes[this._featureLayer.objectIdField],this._getAttachments(d)):x&&x.getEditCapabilities()||(p.hide(this._uploadForm),y.forEach(this.domNode.children,function(D,q){p.hide(D)})))},_getAttachments:function(d){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,v.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){p.hide(this._attachmentError);
this._featureLayer&&this._featureLayer.addAttachment?(p.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,v.hitch(this,"_onAddAttachmentComplete"),v.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(d,x){this._tempUpload&&(p.show(this._attachmentProgress),x.addAttachment(d,this._tempUpload,v.hitch(this,"_onAddAttachmentComplete"),v.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(d,
x){p.show(this._attachmentProgress);this._featureLayer.deleteAttachments(d,[x],v.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(d){var x=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?(x=this._listHtml+this._endHtml,this._uploadForm.style.display=
"none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(x=this._listHtml+this._endHtml);var D=this._attachmentList;d=y.map(d,v.hitch(this,function(q){return e.substitute({href:q.url,name:q.name,oid:q.objectId,attid:q.id},x)}));D.innerHTML=d.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(d){p.hide(this._attachmentProgress.domNode);var x=this._attachmentList,D=this._uploadField,q=D.value,H=q.lastIndexOf("\\");
-1<H&&(q=q.substring(H+1,q.length));q=q.replace(/ /g,"_");H=a.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()});var t=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(t=this._listHtml+this._endHtml);d=e.substitute({href:this._featureLayer._url.path+"/"+d.objectId+"/attachments/"+d.attachmentId+(H?"?"+H:""),name:q,oid:d.objectId,attid:d.attachmentId},
t);x.innerHTML=x.innerHTML==this.NLS_none?d:x.innerHTML+d;this._updateConnects();D.value=""},_onAddAttachmentError:function(d){p.hide(this._attachmentProgress.domNode);if(d){var x=this.NLS_error,D=this._attachmentError;e.isDefined(d.code)&&400===d.code&&(x=this.NLS_fileNotSupported);n.set(D,"innerHTML",x);p.show(D)}},_onDeleteAttachmentComplete:function(d){p.hide(this._attachmentProgress.domNode);var x=this._attachmentList;y.every(d,function(D){return D.success})&&(m.query("#node_"+d[0].objectId+
"_"+d[0].attachmentId).orphan(),x.children&&x.children.length||(x.innerHTML=this.NLS_none))},_updateConnects:function(){y.forEach(this._aeConnects,z.disconnect);m.query(".deleteAttachment").forEach(function(d){this._aeConnects.push(z.connect(d,"onclick",v.hitch(this,"_deleteAttachment",this._oid,d.id)))},this)}});c("extend-esri")&&v.setObject("dijit.editing.AttachmentEditor",N,w);return N})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(N,v,z,y,m,c,f,a){return v("dijit.ProgressBar",[c,f],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:a,_indeterminateHighContrastImagePath:N.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(n){var l="rtl"==n.toLowerCase();z.toggle(this.domNode,"dijitProgressBarRtl",l);z.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&l);this.inherited(arguments)},update:function(n){y.mixin(this,n||{});n=this.internalProgress;var l=this.domNode,b=1;this.indeterminate?l.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(b=Math.min(parseFloat(this.progress)/100,1),this.progress=b*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),b=this.maximum?this.progress/this.maximum:0),l.setAttribute("aria-valuenow",this.progress));l.setAttribute("aria-labelledby",this.labelNode.id);l.setAttribute("aria-valuemin",0);l.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(b);z.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);z.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());n.style.width=100*b+"%";this.onChange()},_setValueAttr:function(n){this._set("value",
n);Infinity==n?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:n})},_setLabelAttr:function(n){this._set("label",n);this.update()},_setIndeterminateAttr:function(n){this._set("indeterminate",n);this.update()},report:function(n){return this.label?this.label:this.indeterminate?"\x26#160;":m.format(n,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(N,v,z,y){var m={};m={findFeatures:function(c,f,a){var n=f.objectIdField;f=v.filter(f.graphics,function(l){return v.some(c,function(b){return l.attributes[n]===b.objectId})});if(a)a(f);else return f},getSelection:function(c){var f=[];v.forEach(c,function(a){a=a.getSelectedFeatures();v.forEach(a,function(n){f.push(n)})});return f},sortFeaturesById:function(c,f){var a=v.map(c,function(n){return n.featureLayer});f.sort(function(n,l){var b=n.getLayer(),u=l.getLayer();if(!b)return-1;if(!u)return 1;
var w=v.indexOf(a,b);u=v.indexOf(a,u);w-=u;w||(b=b.objectIdField,w=n.attributes[b]-l.attributes[b]);return w});return f}};z("extend-esri")&&N.setObject("dijit.editing.Util.LayerHelper",m,y);return m})},"dojox/date/islamic":function(){define(["dojox/main","dojo/_base/lang","dojo/date","./islamic/Date"],function(N,v,z,y){var m=v.getObject("date.islamic",!0,N);m.getDaysInMonth=function(c){return c.getDaysInIslamicMonth(c.getMonth(),c.getFullYear())};m.compare=function(c,f,a){c instanceof y&&(c=c.toGregorian());
f instanceof y&&(f=f.toGregorian());return z.compare.apply(null,arguments)};m.add=function(c,f,a){var n=new y(c);switch(f){case "day":n.setDate(c.getDate()+a);break;case "weekday":var l=c.getDay();if(5>l+a&&0<l+a)n.setDate(c.getDate()+a);else{var b=f=0;5==l?(l=4,b=0<a?-1:1):6==l&&(l=4,b=0<a?-2:2);l=0<a?5-l-1:-l;var u=a-l,w=parseInt(u/5);0!=u%5&&(f=0<a?2:-2);f=f+7*w+u%5+l;n.setDate(c.getDate()+f+b)}break;case "year":n.setFullYear(c.getFullYear()+a);break;case "week":a*=7;n.setDate(c.getDate()+a);break;
case "month":c=c.getMonth();n.setMonth(c+a);break;case "hour":n.setHours(c.getHours()+a);break;case "minute":n._addMinutes(a);break;case "second":n._addSeconds(a);break;case "millisecond":n._addMilliseconds(a)}return n};m.difference=function(c,f,a){f=f||new y;a=a||"day";var n=f.getFullYear()-c.getFullYear(),l=1;switch(a){case "weekday":n=Math.round(m.difference(c,f,"day"));l=parseInt(m.difference(c,f,"week"));if(0==n%7)n=5*l;else{a=0;var b=c.getDay(),u=f.getDay();l=parseInt(n/7);f=n%7;c=new y(c);
c.setDate(c.getDate()+7*l);c=c.getDay();if(0<n)switch(!0){case 5==b:a=-1;break;case 6==b:a=0;break;case 5==u:a=-1;break;case 6==u:a=-2;break;case 5<c+f:a=-2}else if(0>n)switch(!0){case 5==b:a=0;break;case 6==b:a=1;break;case 5==u:a=2;break;case 6==u:a=1;break;case 0>c+f:a=2}n=n+a-2*l}l=n;break;case "year":l=n;break;case "month":a=f.toGregorian()>c.toGregorian()?f:c;b=f.toGregorian()>c.toGregorian()?c:f;l=a.getMonth();u=b.getMonth();if(0==n)l=a.getMonth()-b.getMonth();else for(l=12-u+l,n=b.getFullYear()+
1,a=a.getFullYear(),n;n<a;n++)l+=12;f.toGregorian()<c.toGregorian()&&(l=-l);break;case "week":l=parseInt(m.difference(c,f,"day")/7);break;case "day":l/=24;case "hour":l/=60;case "minute":l/=60;case "second":l/=1E3;case "millisecond":l*=f.toGregorian().getTime()-c.toGregorian().getTime()}return Math.round(l)};return m})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(N,v,z){var y=v("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,
_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var m=arguments.length;m?1==m?(m=arguments[0],"number"==typeof m&&(m=new Date(m)),m instanceof Date?this.fromGregorian(m):""==m?this._date=new Date(""):(this._year=m._year,this._month=m._month,this._date=m._date,this._hours=m._hours,this._minutes=m._minutes,this._seconds=m._seconds,this._milliseconds=m._milliseconds)):3<=m&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=
arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},
setDate:function(m){m=parseInt(m);if(!(0<m&&m<=this.getDaysInIslamicMonth(this._month,this._year))){var c;if(0<m)for(c=this.getDaysInIslamicMonth(this._month,this._year);m>c;m-=c,c=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(c=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=m;c=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:
this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),m+=c}this._date=m;return this},setFullYear:function(m){this._year=+m},setMonth:function(m){this._year+=Math.floor(m/12);this._month=0<m?Math.floor(m%12):Math.floor((m%12+12)%12)},setHours:function(){var m=arguments.length,c=0;1<=m&&(c=parseInt(arguments[0]));2<=m&&(this._minutes=parseInt(arguments[1]));3<=m&&(this._seconds=parseInt(arguments[2]));4==m&&(this._milliseconds=parseInt(arguments[3]));for(;24<=c;)this._date++,m=this.getDaysInIslamicMonth(this._month,
this._year),this._date>m&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=m),c-=24;this._hours=c},_addMinutes:function(m){m+=this._minutes;this.setMinutes(m);this.setHours(this._hours+parseInt(m/60));return this},_addSeconds:function(m){m+=this._seconds;this.setSeconds(m);this._addMinutes(parseInt(m/60));return this},_addMilliseconds:function(m){m+=this._milliseconds;this.setMilliseconds(m);this._addSeconds(parseInt(m/1E3));return this},setMinutes:function(m){this._minutes=
m%60;return this},setSeconds:function(m){this._seconds=m%60;return this},setMilliseconds:function(m){this._milliseconds=m%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";var m=new Date;m.setHours(this._hours);m.setMinutes(this._minutes);m.setSeconds(this._seconds);m.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+m.toTimeString()},toGregorian:function(){var m=this._year;m=Math.floor(this._date+Math.ceil(29.5*this._month)+354*
(m-1)+Math.floor((3+11*m)/30)+this._ISLAMIC_EPOCH-1-.5)+.5;var c=m-this._GREGORIAN_EPOCH,f=Math.floor(c/146097),a=this._mod(c,146097);c=Math.floor(a/36524);var n=this._mod(a,36524);a=Math.floor(n/1461);n=this._mod(n,1461);n=Math.floor(n/365);f=400*f+100*c+4*a+n;4!=c&&4!=n&&f++;c=m-(this._GREGORIAN_EPOCH+365*(f-1)+Math.floor((f-1)/4)-Math.floor((f-1)/100)+Math.floor((f-1)/400));a=this._GREGORIAN_EPOCH-1+365*(f-1)+Math.floor((f-1)/4)-Math.floor((f-1)/100)+Math.floor((f-1)/400)+Math.floor(739/12+(z.isLeapYear(new Date(f,
3,1))?-1:-2)+1);a=m<a?0:z.isLeapYear(new Date(f,3,1))?1:2;c=Math.floor((12*(c+a)+373)/367);a=this._GREGORIAN_EPOCH-1+365*(f-1)+Math.floor((f-1)/4)-Math.floor((f-1)/100)+Math.floor((f-1)/400)+Math.floor((367*c-362)/12+(2>=c?0:z.isLeapYear(new Date(f,c-1,1))?-1:-2)+1);return new Date(f,c-1,m-a+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(m){m=new Date(m);var c=m.getFullYear(),f=m.getMonth(),a=m.getDate();c=this._GREGORIAN_EPOCH-1+365*(c-1)+Math.floor((c-1)/4)+
-Math.floor((c-1)/100)+Math.floor((c-1)/400)+Math.floor((367*(f+1)-362)/12+(2>=f+1?0:z.isLeapYear(m)?-1:-2)+a);c=Math.floor(c)+.5;c-=this._ISLAMIC_EPOCH;f=Math.floor((30*c+10646)/10631);a=Math.ceil((c-29-this._yearStart(f))/29.5);a=Math.min(a,11);this._date=Math.ceil(c-this._monthStart(f,a))+1;this._month=a;this._year=f;this._hours=m.getHours();this._minutes=m.getMinutes();this._seconds=m.getSeconds();this._milliseconds=m.getMilliseconds();this._day=m.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},
_yearStart:function(m){return 354*(m-1)+Math.floor((3+11*m)/30)},_monthStart:function(m,c){return Math.ceil(29.5*c)+354*(m-1)+Math.floor((3+11*m)/30)},_civilLeapYear:function(m){return 11>(14+11*m)%30},getDaysInIslamicMonth:function(m,c){var f=0;f=29+(m+1)%2;11==m&&this._civilLeapYear(c)&&f++;return f},_mod:function(m,c){return m-c*Math.floor(m/c)}});y.getDaysInIslamicMonth=function(m){return(new y).getDaysInIslamicMonth(m.getMonth(),m.getFullYear())};return y})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),
function(N,v,z,y,m,c,f,a,n){function l(p,h,r,d,x){return x.replace(/([a-z])\1*/ig,function(D){var q=D.charAt(0);D=D.length;var H=["abbr","wide","narrow"];switch(q){case "G":var t=h.eraAbbr[0];break;case "y":t=String(p.getFullYear());break;case "M":t=p.getMonth();if(3>D){t+=1;var G=!0}else q=["months-format",H[D-3]].join("-"),t=h[q][t];break;case "d":t=p.getDate(!0);G=!0;break;case "E":t=p.getDay();3>D?(t+=1,G=!0):(q=["days-format",H[D-3]].join("-"),t=h[q][t]);break;case "a":t=12>p.getHours()?"am":
"pm";t=h["dayPeriods-format-wide-"+t];break;case "h":case "H":case "K":case "k":G=p.getHours();switch(q){case "h":t=G%12||12;break;case "H":t=G;break;case "K":t=G%12;break;case "k":t=G||24}G=!0;break;case "m":t=p.getMinutes();G=!0;break;case "s":t=p.getSeconds();G=!0;break;case "S":t=Math.round(p.getMilliseconds()*Math.pow(10,D-3));G=!0;break;case "z":if(t=y.getTimezoneName(p.toGregorian()))break;D=4;case "Z":t=p.toGregorian().getTimezoneOffset();t=[0>=t?"+":"-",f.pad(Math.floor(Math.abs(t)/60),2),
f.pad(Math.abs(t)%60,2)];4==D&&(t.splice(0,0,"GMT"),t.splice(3,0,":"));t=t.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+x);}G&&(t=f.pad(t,D));return t})}function b(p,h,r,d){var x=function(H){return H};h=h||x;r=r||x;d=d||x;var D=p.match(/(''|[^'])+/g),q="'"==p.charAt(0);z.forEach(D,function(H,t){H?(D[t]=(q?r:h)(H),q=!q):D[t]=""});return d(D.join(""))}function u(p,h,r,d){d=c.escapeString(d);m.normalizeLocale(r.locale);return d.replace(/([a-z])\1*/ig,
function(x){var D=x.charAt(0);var q=x.length,H="";r.strict?1<q&&(H="0{"+(q-1)+"}"):H="0?";switch(D){case "y":D="\\d+";break;case "M":D=2<q?"\\S+ ?\\S+":H+"[1-9]|1[0-2]";break;case "d":D="[12]\\d|"+H+"[1-9]|3[01]";break;case "E":D="\\S+";break;case "h":D=H+"[1-9]|1[0-2]";break;case "k":D=H+"\\d|1[01]";break;case "H":D=H+"\\d|1\\d|2[0-3]";break;case "K":D=H+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":D=H+"\\d|[0-5]\\d";break;case "S":D="\\d{"+q+"}";break;case "a":q=r.am||h["dayPeriods-format-wide-am"];
H=r.pm||h["dayPeriods-format-wide-pm"];r.strict?D=q+"|"+H:(D=q+"|"+H,q!=q.toLowerCase()&&(D+="|"+q.toLowerCase()),H!=H.toLowerCase()&&(D+="|"+H.toLowerCase()));break;default:D=".*"}p&&p.push(x);return"("+D+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var w=v.getObject("date.islamic.locale",!0,N);w.format=function(p,h){h=h||{};var r=m.normalizeLocale(h.locale),d=h.formatLength||"short",x=w._getIslamicBundle(r),D=[];r=v.hitch(this,l,p,x,r,h.fullYear);if("year"==h.selector)return p.getFullYear();"time"!=h.selector&&
(p=h.datePattern||x["dateFormat-"+d])&&D.push(b(p,r));"date"!=h.selector&&(h=h.timePattern||x["timeFormat-"+d])&&D.push(b(h,r));return D.join(" ")};w.regexp=function(p){return w._parseInfo(p).regexp};w._parseInfo=function(p){p=p||{};var h=m.normalizeLocale(p.locale);h=w._getIslamicBundle(h);var r=p.formatLength||"short",d=p.datePattern||h["dateFormat-"+r];r=p.timePattern||h["timeFormat-"+r];var x=[];return{regexp:b("date"==p.selector?d:"time"==p.selector?r:"undefined"==typeof r?d:d+" "+r,v.hitch(this,
u,x,h,p)),tokens:x,bundle:h}};w.parse=function(p,h){p=p.replace(/[\u200E\u200F\u202A\u202E]/g,"");h||(h={});var r=w._parseInfo(h),d=r.tokens,x=r.bundle;r=r.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,"");p=(new RegExp("^"+r+"$")).exec(p);m.normalizeLocale(h.locale);if(!p)return null;var D=[1389,0,1,0,0,0,0],q="",H=["abbr","wide","narrow"];z.every(p,function(t,G){if(!G)return!0;G=d[G-1];var T=G.length;switch(G.charAt(0)){case "y":D[0]=Number(t);break;case "M":if(2<T){if(G=x["months-format-"+H[T-3]].concat(),
h.strict||(t=t.replace(".","").toLowerCase(),G=z.map(G,function(S){return S?S.replace(".","").toLowerCase():S})),t=z.indexOf(G,t),-1==t)return!1}else t--;D[1]=Number(t);break;case "D":D[1]=0;case "d":D[2]=Number(t);break;case "a":G=h.am||x["dayPeriods-format-wide-am"];T=h.pm||x["dayPeriods-format-wide-pm"];if(!h.strict){var A=/\./g;t=t.replace(A,"").toLowerCase();G=G.replace(A,"").toLowerCase();T=T.replace(A,"").toLowerCase()}if(h.strict&&t!=G&&t!=T)return!1;q=t==T?"p":t==G?"a":"";break;case "K":24==
t&&(t=0);case "h":case "H":case "k":D[3]=Number(t);break;case "m":D[4]=Number(t);break;case "s":D[5]=Number(t);break;case "S":D[6]=Number(t)}return!0});p=+D[3];"p"===q&&12>p?D[3]=p+12:"a"===q&&12==p&&(D[3]=0);return new a(D[0],D[1],D[2],D[3],D[4],D[5],D[6])};var e=[];w.addCustomFormats=function(p,h){e.push({pkg:p,name:h})};w._getIslamicBundle=function(p){var h={};z.forEach(e,function(r){r=m.getLocalization(r.pkg,r.name,p);h=v.mixin(h,r)},this);return h};w.addCustomFormats("dojo.cldr","islamic");w.getNames=
function(p,h,r,d,x){d=w._getIslamicBundle(d);p=[p,r,h];if("standAlone"==r){r=p.join("-");var D=d[r];1==D[0]&&(D=void 0)}p[1]="format";return(D||d[p.join("-")]).concat()};w.weekDays=w.getNames("days","wide","format");w.months=w.getNames("months","wide","format");return w})},"esri/dijit/editing/Add":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(N,v,z,y,m,c){v=v(c,{declaredClass:"esri.dijit.editing.Add",type:"edit",
label:"Add Features",constructor:function(f){f=f||{};f.featureLayer?(this._featureLayer=f.featureLayer,f.addedGraphics?this._addedGraphics=f.addedGraphics:console.error("In constructor of 'esri.dijit.editing.Add', no graphics provided")):console.error("In constructor of 'esri.dijit.editing.Add', featureLayer is not provided")},updateObjectIds:function(f,a){this.updateIds(this._featureLayer,this._addedGraphics,f,a)},performUndo:function(){return this._featureLayer.applyEdits(null,null,this._addedGraphics).then(z.hitch(this,
function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var f=N.map(this._addedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,null,null).then(z.hitch(this,function(a,n,l){a=N.map(a,function(b){return b.objectId});return{oldIds:f,addedIds:a,layer:this._featureLayer,operation:this}}))}});y("extend-esri")&&z.setObject("dijit.editing.Add",v,m);return v})},"esri/dijit/editing/EditOperationBase":function(){define(["dojo/_base/array",
"dojo/_base/declare","dojo/has","../../kernel","../../OperationBase"],function(N,v,z,y,m){v=v(m,{declaredClass:"esri.EditOperationBase",updateIds:function(c,f,a,n){N.forEach(f,function(l,b){var u=l[c.objectIdField];N.forEach(a,function(w,e){u===w&&(l[c.objectIdField]=n[e])})})}});z("extend-esri")&&(y.EditOperationBase=v);return v})},"esri/dijit/editing/Update":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(N,v,z,y,m,c,f){N=v(f,{declaredClass:"esri.dijit.editing.Update",type:"edit",label:"Update Features",constructor:function(a){var n;a=a||{};if(a.featureLayer)if(this._featureLayer=a.featureLayer,a.preUpdatedGraphics){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(n=0;n<a.preUpdatedGraphics.length;n++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[n].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[n].attributes);
if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],n=0;n<a.postUpdatedGraphics.length;n++)a.postUpdatedGraphics[n].geometry?this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[n].geometry.toJson()):this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[n].geometry),this._postUpdatedGraphicsAttributes.push(z.clone(a.postUpdatedGraphics[n].attributes));else console.error("In constructor of 'esri.dijit.editing.Update', postUpdatedGraphics not provided")}else console.error("In constructor of 'esri.dijit.editing.Update', preUpdatedGraphics not provided");
else console.error("In constructor of 'esri.dijit.editing.Update', featureLayer not provided")},updateObjectIds:function(a,n){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,n);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,n)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._preUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(c.fromJson(this._preUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._preUpdatedGraphicsGeometries[a]),
this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(z.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(c.fromJson(this._postUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._postUpdatedGraphicsGeometries[a]),
this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(z.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});y("extend-esri")&&z.setObject("dijit.editing.Update",N,m);return N})},"esri/dijit/editing/Delete":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(N,v,z,y,m,c){v=v(c,{declaredClass:"esri.dijit.editing.Delete",
type:"edit",label:"Delete Features",constructor:function(f){f=f||{};f.featureLayer?(this._featureLayer=f.featureLayer,f.deletedGraphics?this._deletedGraphics=f.deletedGraphics:console.error("In constructor of 'esri.dijit.editing.Delete', no graphics provided")):console.error("In constructor of 'esri.dijit.editing.Delete', featureLayer is not provided")},updateObjectIds:function(f,a){this.updateIds(this._featureLayer,this._deletedGraphics,f,a)},performUndo:function(){var f=N.map(this._deletedGraphics,
function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,null,null).then(z.hitch(this,function(a,n,l){a=N.map(a,function(b){return b.objectId});return{oldIds:f,addedIds:a,layer:this._featureLayer,operation:this}}))},performRedo:function(){return this._featureLayer.applyEdits(null,null,this._deletedGraphics).then(z.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});y("extend-esri")&&z.setObject("dijit.editing.Delete",
v,m);return v})},"esri/dijit/editing/Cut":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(N,v,z,y,m,c,f){v=v(f,{declaredClass:"esri.dijit.editing.Cut",type:"edit",label:"Cut Features",constructor:function(a){var n;a=a||{};if(a.featureLayer)if(this._featureLayer=a.featureLayer,a.addedGraphics)if(this._addedGraphics=a.addedGraphics,a.preUpdatedGraphics){this._preUpdatedGraphicsGeometries=[];
this._preUpdatedGraphicsAttributes=[];for(n=0;n<a.preUpdatedGraphics.length;n++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[n].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[n].attributes);if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],n=0;n<a.postUpdatedGraphics.length;n++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[n].geometry.toJson()),
this._postUpdatedGraphicsAttributes.push(z.clone(a.postUpdatedGraphics[n].attributes));else console.error("In constructor of 'esri.dijit.editing.Cut', postUpdatedGraphics not provided")}else console.error("In constructor of 'esri.dijit.editing.Cut', preUpdatedGraphics not provided");else console.error("In constructor of 'esri.dijit.editing.Cut', addedGraphics for cut not provided");else console.error("In constructor of 'esri.dijit.editing.Cut', featureLayer not provided")},updateObjectIds:function(a,
n){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,n);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,n);this.updateIds(this._featureLayer,this._addedGraphics,a,n)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(c.fromJson(this._preUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,
this._postUpdatedGraphics,this._addedGraphics).then(z.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(c.fromJson(this._postUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);var n=N.map(this._addedGraphics,function(l){return l.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,
this._postUpdatedGraphics,null).then(z.hitch(this,function(l,b,u){l=N.map(l,function(w){return w.objectId});return{oldIds:n,addedIds:l,layer:this._featureLayer,operation:this}}))}});y("extend-esri")&&z.setObject("dijit.editing.Cut",v,m);return v})},"esri/dijit/editing/Union":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(N,v,z,y,m,c,f){v=v(f,{declaredClass:"esri.dijit.editing.Union",type:"edit",
label:"Union Features",constructor:function(a){a=a||{};this._featureLayer=a.featureLayer;this._deletedGraphics=a.deletedGraphics;this._preUpdatedGraphics=a.preUpdatedGraphics;this._postUpdatedGraphics=a.postUpdatedGraphics;this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];this._postUpdatedGraphicsGeometries=[];this._postUpdatedGraphicsAttributes=[];var n;for(n=0;n<a.preUpdatedGraphics.length;n++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[n].geometry.toJson()),
this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[n].attributes);for(n=0;n<a.postUpdatedGraphics.length;n++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[n].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(z.clone(a.postUpdatedGraphics[n].attributes))},updateObjectIds:function(a,n){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,n);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,n);this.updateIds(this._featureLayer,
this._deletedGraphics,a,n)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(c.fromJson(this._preUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);var n=N.map(this._deletedGraphics,function(l){return l.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,this._postUpdatedGraphics,null).then(z.hitch(this,function(l,
b,u){l=N.map(l,function(w){return w.objectId});return{oldIds:n,addedIds:l,layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(c.fromJson(this._postUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._deletedGraphics).then(z.hitch(this,function(){return{layer:this._featureLayer,
operation:this}}))}});y("extend-esri")&&z.setObject("dijit.editing.Union",v,m);return v})},"esri/dijit/editing/toolbars/Drawing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/_CssStateMixin ../Util ./ToolbarBase ../tools/ButtonToolBase ../tools/Cut ../tools/Union ../tools/Reshape ../tools/Editing ../tools/EditingTools ../tools/Selection ../tools/SelectionTools ../../../kernel".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,p,h,r){N=N([a,
c],{declaredClass:"esri.dijit.editing.toolbars.Drawing",onShowAttributeInspector:function(){},_activateTool:function(d,x){this._settings.editor._activeTool=d;"EDITING"!==d&&this._settings.templatePicker.clearSelection();"ATTRIBUTES"!==d&&this._settings.editor._hideAttributeInspector();"CLEAR"!==d&&this.inherited(arguments)},_initializeToolbar:function(){z.forEach(this._settings.layers,function(d){this._tbConnects.push(y.connect(d,"onSelectionComplete",this,"_updateUI"))},this)},activateEditing:function(d,
x){this._tools.EDITING._activateTool(d,x.geometryType);this._activeTool=this._tools.EDITING;this._activeTool.setChecked(!0)},_updateUI:function(){this._settings.undoManager&&(this._tools.UNDO.set("disabled",!1===this._settings.undoManager.canUndo),this._tools.REDO.set("disabled",!1===this._settings.undoManager.canRedo));this._selectedFeatures=f.getSelection(this._settings.layers);var d=this._selectedFeatures.length;this._tools.DELETE&&this._tools.DELETE.set("disabled",0>=d);this._tools.CLEAR&&this._tools.CLEAR.set("disabled",
0>=d);this._tools.ATTRIBUTES&&this._tools.ATTRIBUTES.set("disabled",0>=d);this._tools.UNION&&this._tools.UNION.set("disabled",2>d)},_toolFinished:function(d){if("ATTRIBUTES"===d&&this._selectedFeatures&&this._selectedFeatures.length)this.onShowAttributeInspector(this._selectedFeatures[0]);if("SELECT"===d||"CUT"===d||"RESHAPING"===d||"EDITING"===d)this._activeTool.deactivate(),this._activeTool.setChecked(!1),this._activeTool=null;if("DELETE"===d)this.onDelete();this._settings.editor._activeTool=null;
this._updateUI()},_createTools:function(){this._tools.SELECT=new p({settings:this._settings,onClick:v.hitch(this,"_activateTool","SELECT",!0),onFinished:v.hitch(this,"_toolFinished","SELECT")});this.addChild(this._tools.SELECT);this._tools.CLEAR=new n(v.mixin(h.selectClear,{settings:this._settings,onClick:v.hitch(this._settings.editor,"_clearSelection",!1)}));this.addChild(this._tools.CLEAR);this._createSeparator();this._tools.ATTRIBUTES=new n(v.mixin(e.attributes,{settings:this._settings,onClick:v.hitch(this,
"_toolFinished","ATTRIBUTES")}));this.addChild(this._tools.ATTRIBUTES);this._createSeparator();this._tools.EDITING=new w({settings:this._settings,onClick:v.hitch(this,"_activateTool","EDITING",!0),onApplyEdits:v.hitch(this,"onApplyEdits"),onFinished:v.hitch(this,"_toolFinished","EDITING")});this.addChild(this._tools.EDITING);this._tools.DELETE=new n(v.mixin(e.del,{settings:this._settings,onClick:v.hitch(this,"_toolFinished","DELETE")}));this.addChild(this._tools.DELETE);this._settings.toolbarOptions&&
((this._settings.toolbarOptions.cutVisible||this._settings.toolbarOptions.mergeVisible||this._settings.toolbarOptions.reshapeVisible)&&this._createSeparator(),this._settings.toolbarOptions.cutVisible&&(this._tools.CUT=new l({settings:this._settings,onFinished:v.hitch(this,"_toolFinished","CUT"),onClick:v.hitch(this,"_activateTool","CUT",!0),onApplyEdits:v.hitch(this,"onApplyEdits")}),this.addChild(this._tools.CUT)),this._settings.toolbarOptions.mergeVisible&&(this._tools.UNION=new b({settings:this._settings,
onFinished:v.hitch(this,"_toolFinished","UNION"),onApplyEdits:v.hitch(this,"onApplyEdits")}),this.addChild(this._tools.UNION)),this._settings.toolbarOptions.reshapeVisible&&(this._tools.RESHAPING=new u({settings:this._settings,onClick:v.hitch(this,"_activateTool","RESHAPING",!0),onFinished:v.hitch(this,"_toolFinished","RESHAPING"),onApplyEdits:v.hitch(this,"onApplyEdits")}),this.addChild(this._tools.RESHAPING)));this._settings.enableUndoRedo&&(this._createSeparator(),this._tools.UNDO=new n(v.mixin(e.undo,
{settings:this._settings,disabled:!0,onClick:v.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._undo()})})),this.addChild(this._tools.UNDO),this._tools.REDO=new n(v.mixin(e.redo,{settings:this._settings,disabled:!0,onClick:v.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._redo()})})),this.addChild(this._tools.REDO))}});m("extend-esri")&&v.setObject("dijit.editing.toolbars.Drawing",
N,r);return N})},"esri/dijit/editing/toolbars/ToolbarBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/Toolbar dijit/ToolbarSeparator ../../../kernel ../../../lang".split(" "),function(N,v,z,y,m,c,f,a,n){N=N([c],{declaredClass:"esri.dijit.editing.toolbars.ToolbarBase",_enabled:!0,graphicsAdded:function(){},drawEnd:function(){},onApplyEdits:function(){},onDelete:function(){},constructor:function(l,b){l&&l.settings&&(this._tools=[],this._tbConnects=
[],this._initialize(l.settings))},postCreate:function(){this._createTools();this.deactivate()},destroy:function(){var l,b=this._tools;for(l in b)b.hasOwnProperty(l)&&n.isDefined(this._tools[l])&&this._tools[l].destroy();z.forEach(this._tbConnects,y.disconnect);this.inherited(arguments)},activate:function(l){this._enabled=!0},deactivate:function(){var l;this._enabled=!1;this._geometryType=this._layer=null;var b=this._tools;for(l in b)b.hasOwnProperty(l)&&(this._tools[l].deactivate(),this._tools[l].setChecked(!1))},
isEnabled:function(){return this._enabled},setActiveSymbol:function(l){this._activeSymbol=l},_getSymbol:function(){},_createTools:function(){},_initialize:function(l){this._settings=l;this._toolbar=l.drawToolbar;this._editToolbar=l.editToolbar;this._initializeToolbar()},_activateTool:function(l,b){this._activeTool&&this._activeTool.deactivate();!0===b&&this._activeTool==this._tools[l]?(this._activeTool.setChecked(!1),this._activeTool=null):(this._activeTool=this._tools[l],this._activeTool.setChecked(!0),
this._activeTool.activate(null))},_createSeparator:function(){this.addChild(new f)}});m("extend-esri")&&v.setObject("dijit.editing.toolbars.ToolbarBase",N,a);return N})},"esri/dijit/editing/tools/ButtonToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/Button ./ToolBase ../../../kernel".split(" "),function(N,v,z,y,m,c){N=N([y,m],{declaredClass:"esri.dijit.editing.tools.ButtonToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},
destroy:function(){y.prototype.destroy.apply(this,arguments);m.prototype.destroy.apply(this,arguments)}});z("extend-esri")&&v.setObject("dijit.editing.tools.ButtonToolBase",N,c);return N})},"esri/dijit/editing/tools/ToolBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../../kernel","dojo/i18n!../../../nls/jsapi"],function(N,v,z,y,m){N=N(null,{declaredClass:"esri.dijit.editing.tools.ToolBase",_enabled:!0,showLabel:!1,constructor:function(c,f){c=c||{};v.mixin(this,c);this.label=
this._label?m.widgets.editor.tools[this._label]:"";this._settings=c.settings;this._toolbar=c.settings.drawToolbar;this._editToolbar=c.settings.editToolbar;this._initializeTool()},onFinished:function(){},onDrawEnd:function(){},onApplyEdits:function(){},postCreate:function(){this.deactivate();this.inherited(arguments)},destroy:function(){},activate:function(c){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this._enabled&&(this._checked=!0,this._layer=c,this._toolbar&&
this._drawType&&this._toolbar.activate(this._drawType))},deactivate:function(){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this.setChecked(!1);this._updateUI()},setEnabled:function(c){this._enabled=c;this._updateUI()},setChecked:function(c){this._checked=c},enable:function(c){this._updateUI()},isEnabled:function(){return this._enabled},getToolName:function(){return this._toolName},_initializeTool:function(){},_updateUI:function(){this.disabled=!this._enabled;
this.attr("iconClass",this._enabled?this._enabledIcon:this._disabledIcon)}});z("extend-esri")&&v.setObject("dijit.editing.tools.ToolBase",N,y);return N})},"esri/dijit/editing/tools/Cut":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u,
w,e){N=N([w],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:b.POLYLINE,_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(y.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);z.forEach(this._cutConnects,y.disconnect);this._cutConnects=[];this._edits=[]},_onDrawEnd:function(p){var h=this._cutLayers=
z.filter(this._settings.layers,function(d){return"esriGeometryPolygon"===d.geometryType||"esriGeometryPolyline"===d.geometryType&&d.visible&&d._isMapAtVisibleScale()});this._cutConnects=this._cutConnects.concat(z.map(h,v.hitch(this,function(d){return y.connect(d,"onEditsComplete",v.hitch(this,function(x,D,q){if(this._settings.undoRedoManager){var H=this._settings.undoRedoManager;z.forEach(this._edits,v.hitch(this,function(t){H.add(new u({featureLayer:t.layer,addedGraphics:t.adds,preUpdatedGraphics:t.preUpdates,
postUpdatedGraphics:t.updates}))}),this)}this.onFinished()}))})));var r=new n;r.geometry=p;z.forEach(h,function(d,x){this._settings.editor._selectionHelper.selectFeatures([d],r,l.SELECTION_NEW,v.hitch(this,"_cutFeatures",d,r))},this)},_cutFeatures:function(p,h,r){if(r&&r.length){this._edits=[];var d=[];d.push(this._settings.geometryService.cut(f.getGeometries(r),h.geometry,v.hitch(this,"_cutHandler",p,r)));(new c(d)).addCallback(v.hitch(this,function(){this.onApplyEdits(this._edits)}))}},_cutHandler:function(p,
h,r){var d=[],x=[],D=z.map(h,function(t){return new a(v.clone(t.toJson()))}),q,H;z.forEach(r.cutIndexes,function(t,G){q!=t?(q=t,1<z.filter(r.cutIndexes,function(T){return T===t}).length&&x.push(h[t].setGeometry(r.geometries[G]))):(H=new a(r.geometries[G],null,v.mixin({},h[t].attributes),null),H.attributes[h[0].getLayer().objectIdField]=null,d.push(H))},this);this._edits.push({layer:p,adds:d,updates:x,preUpdates:D})}});m("extend-esri")&&v.setObject("dijit.editing.tools.Cut",N,e);return N})},"esri/dijit/editing/tools/ToggleToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/ToggleButton ./ToolBase ../../../kernel".split(" "),
function(N,v,z,y,m,c){N=N([y,m],{declaredClass:"esri.dijit.editing.tools.ToggleToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){y.prototype.destroy.apply(this,arguments);m.prototype.destroy.apply(this,arguments)},setChecked:function(f){y.prototype.setChecked.apply(this,arguments)}});z("extend-esri")&&v.setObject("dijit.editing.tools.ToggleToolBase",N,c);return N})},"esri/dijit/editing/tools/Union":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../graphicsUtils ../../../graphic ../../../toolbars/draw ../Union ./ButtonToolBase ../../../kernel".split(" "),
function(N,v,z,y,m,c,f,a,n,l){N=N([n],{declaredClass:"esri.dijit.editing.tools.Union",id:"btnFeatureUnion",_enabledIcon:"toolbarIcon unionIcon",_disabledIcon:"toolbarIcon unionIcon",_drawType:f.POLYLINE,_enabled:!0,_label:"NLS_unionLbl",_onClick:function(b){this._settings.editor._activeTool="UNION";b=z.filter(this._settings.layers,function(e){return"esriGeometryPolygon"===e.geometryType&&e.visible&&e._isMapAtVisibleScale()});var u=[],w=0;z.forEach(b,function(e,p){var h=e.getSelectedFeatures();2<=
h.length&&(w++,this._settings.geometryService.union(m.getGeometries(h),v.hitch(this,function(r){var d=h.shift(),x=[],D=[];x.push(new c(d.toJson()));D.push(d.setGeometry(r));u.push({layer:e,updates:D,deletes:h,preUpdates:x});w--;if(0>=w)this.onApplyEdits(u,v.hitch(this,function(){if(this._settings.undoRedoManager){var q=this._settings.undoRedoManager;z.forEach(this._edits,v.hitch(this,function(H){q.add(new a({featureLayer:H.layer,deletedGraphics:H.deletes,preUpdatedGraphics:H.preUpdates,postUpdatedGraphics:H.updates}))}),
this)}this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()}))})))},this)}});y("extend-esri")&&v.setObject("dijit.editing.tools.Union",N,l);return N})},"esri/dijit/editing/tools/Reshape":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has ../../../graphic ../../../layers/FeatureLayer ../../../tasks/query ../../../toolbars/draw ./ToggleToolBase ../../../kernel".split(" "),function(N,v,z,y,m,c,f,a,n,l,b){N=N([l],{declaredClass:"esri.dijit.editing.tools.Reshape",
id:"btnFeatureReshape",_enabledIcon:"toolbarIcon reshapeIcon",_disabledIcon:"toolbarIcon reshapeIcon",_drawType:n.POLYLINE,_enabled:!0,_label:"NLS_reshapeLbl",activate:function(){y.disconnect(this._rConnect);this._rConnect=y.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd");this.inherited(arguments)},deactivate:function(){this.inherited(arguments);y.disconnect(this._rConnect);delete this._rConnect},_onDrawEnd:function(u){var w=this._settings.layers,e=new a;e.geometry=u;u=this._reshapeLayers=z.filter(w,
function(p){return"esriGeometryPolygon"===p.geometryType||"esriGeometryPolyline"});this._settings.editor._selectionHelper.selectFeatures(u,e,f.SELECTION_NEW,v.hitch(this,"_reshape",e))},_reshape:function(u,w){if(1===w.length){var e=[],p=[],h=[],r=w[0],d=r.getLayer();this._settings.geometryService.reshape(r.geometry,u.geometry,v.hitch(this,function(x){"polyline"===x.type&&x.paths&&0===x.paths.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):"polygon"===x.type&&x.rings&&
0===x.rings.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):(h.push(new c(r.toJson())),p.push(r.setGeometry(x)),e.push({layer:d,updates:p,preUpdates:h}),this.onApplyEdits(e,v.hitch(this,function(){this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()})))}))}}});m("extend-esri")&&v.setObject("dijit.editing.tools.Reshape",N,b);return N})},"esri/dijit/editing/tools/Editing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../layers/FeatureTemplate ./Edit ./EditingTools ./DropDownToolBase ../../../kernel ../../../lang".split(" "),
function(N,v,z,y,m,c,f,a,n,l){N=N([a],{declaredClass:"esri.dijit.editing.tools.Editing",_enabled:!1,deactivate:function(){this._enabled&&(this._enabled=!1,this.inherited(arguments),this._settings.templatePicker.clearSelection())},onItemClicked:function(b,u){this.inherited(arguments);this._activeTool===this._tools.AUTOCOMPLETE&&(this._settings.editor._drawingTool=m.TOOL_AUTO_COMPLETE_POLYGON)},_activateTool:function(b,u){var w;this.enable(u);for(w in this._tools)this._tools.hasOwnProperty(w)&&(this.dropDown.removeChild(this._tools[w]),
!0===this._tools[w]._enabled&&this.dropDown.addChild(this._tools[w]));if(this._geometryType!==u||!1===this._activeTool._enabled)this._activeTool=this._tools[b.toUpperCase()];this._geometryType=u;this._activeTool.activate();this._activeTool.setChecked(!0);this._updateUI()},_initializeTool:function(b){this.inherited(arguments);this._initializeTools()},_initializeTools:function(){var b=this._settings.layers,u=this._settings.editor,w=!1,e=!1,p=!1,h=this._toolTypes=[],r;z.forEach(b,function(d){r=d.geometryType;
w=w||"esriGeometryPoint"===r;e=e||"esriGeometryPolyline"===r;p=p||"esriGeometryPolygon"===r;h=h.concat(z.map(this._getTemplatesFromLayer(d),v.hitch(this,function(x){return u._toDrawTool(x.drawingTool,d)})))},this);b=this._settings.createOptions;w&&this._toolTypes.push("point");e&&(this._toolTypes=this._toolTypes.concat(b.polylineDrawTools));p&&(this._toolTypes=this._toolTypes.concat(b.polygonDrawTools));this._toolTypes=this._toUnique(this._toolTypes.concat(h))},_toUnique:function(b){var u={};return z.filter(b,
function(w){return u[w]?!1:u[w]=!0})},_getTemplatesFromLayer:function(b){var u=b.templates||[];z.forEach(b.types,function(w){u=u.concat(w.templates)});return z.filter(u,l.isDefined)},_createTools:function(){z.forEach(this._toolTypes,this._createTool,this);this.inherited(arguments)},_createTool:function(b){var u=v.mixin(f[b],{settings:this._settings,onClick:v.hitch(this,"onItemClicked",f[b].id)});this._tools[b.toUpperCase()]=new c(u)}});y("extend-esri")&&v.setObject("dijit.editing.tools.Editing",N,
n);return N})},"esri/dijit/editing/tools/Edit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","./MenuItemBase","../../../kernel"],function(N,v,z,y,m){N=N([y],{declaredClass:"esri.dijit.editing.tools.Edit",enable:function(c){this._enabled=c===this._geomType;this.inherited(arguments)}});z("extend-esri")&&v.setObject("dijit.editing.tools.Edit",N,m);return N})},"esri/dijit/editing/tools/MenuItemBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/MenuItem ./ToolBase ../../../kernel".split(" "),
function(N,v,z,y,m,c){N=N([y,m],{declaredClass:"esri.dijit.editing.tools.MenuItemBase",destroy:function(){y.prototype.destroy.apply(this,arguments);m.prototype.destroy.apply(this,arguments)}});z("extend-esri")&&v.setObject("dijit.editing.tools.MenuItemBase",N,c);return N})},"esri/dijit/editing/tools/EditingTools":function(){define(["dojo/_base/lang","dojo/has","../../../toolbars/draw","../../../kernel"],function(N,v,z,y){z={point:{id:"esriPointTool",_enabledIcon:"toolbarIcon pointIcon",_disabledIcon:"toolbarIcon pointIconDisabled",
_drawType:z.POINT,_geomType:"esriGeometryPoint",_label:"NLS_pointLbl"},polyline:{id:"toolDrawFreehandPolyline",_enabledIcon:"toolbarIcon polylineIcon",_disabledIcon:"toolbarIcon polylineIconDisabled",_drawType:z.POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_polylineLbl"},freehandpolyline:{id:"toolDrawPolyline",_enabledIcon:"toolbarIcon freehandPolylineIcon",_disabledIcon:"toolbarIcon freehandPolylineIcon",_drawType:z.FREEHAND_POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_freehandPolylineLbl"},
polygon:{id:"toolDrawPolygon",_enabledIcon:"toolbarIcon polygonIcon",_disabledIcon:"toolbarIcon polygonIconDisabled",_drawType:z.POLYGON,_geomType:"esriGeometryPolygon",_label:"NLS_polygonLbl"},freehandpolygon:{id:"toolDrawFreehandPolygon",_enabledIcon:"toolbarIcon freehandPolygonIcon",_disabledIcon:"toolbarIcon freehandPolygonIconDisabled",_drawType:z.FREEHAND_POLYGON,_label:"NLS_freehandPolygonLbl",_geomType:"esriGeometryPolygon"},autocomplete:{id:"btnFeatureAutoComplete",_enabledIcon:"toolbarIcon autoCompleteIcon",
_disabledIcon:"toolbarIcon autoCompleteIcon",_drawType:z.POLYGON,_label:"NLS_autoCompleteLbl",_geomType:"esriGeometryPolygon"},rectangle:{id:"toolDrawRect",_enabledIcon:"toolbarIcon rectangleIcon",_disabledIcon:"toolbarIcon rectangleIcon",_drawType:z.RECTANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_rectangleLbl"},arrow:{id:"toolDrawArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:z.ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLbl"},uparrow:{id:"toolDrawArrowUp",
_enabledIcon:"toolbarIcon arrowUpIcon",_disabledIcon:"toolbarIcon arrowUpIcon",_drawType:z.UP_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowUpLbl"},downarrow:{id:"toolDrawDownArrow",_enabledIcon:"toolbarIcon arrowDownIcon",_disabledIcon:"toolbarIcon arrowDownIcon",_drawType:z.DOWN_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowDownLbl"},leftarrow:{id:"toolDrawLeftArrow",_enabledIcon:"toolbarIcon arrowLeftIcon",_disabledIcon:"toolbarIcon arrowLeftIcon",_drawType:z.LEFT_ARROW,_geomType:"esriGeometryPolygon",
_label:"NLS_arrowLeftLbl"},rightarrow:{id:"toolDrawRightArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:z.RIGHT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowRightLbl"},circle:{id:"toolDrawCircle",_enabledIcon:"toolbarIcon circleIcon",_disabledIcon:"toolbarIcon circleIcon",_drawType:z.CIRCLE,_geomType:"esriGeometryPolygon",_label:"NLS_circleLbl"},ellipse:{id:"toolDrawEllipse",_enabledIcon:"toolbarIcon ellipseIcon",_disabledIcon:"toolbarIcon ellipseIcon",
_drawType:z.ELLIPSE,_geomType:"esriGeometryPolygon",_label:"NLS_ellipseLbl"},triangle:{id:"toolDrawTriangle",_enabledIcon:"toolbarIcon triangleIcon",_disabledIcon:"toolbarIcon triangleIcon",_drawType:z.TRIANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_triangleLbl"},attributes:{id:"btnAttributes",_enabledIcon:"toolbarIcon attributesIcon",_disabledIcon:"toolbarIcon attributesIcon",_enabled:!1,_label:"NLS_attributesLbl"},del:{id:"btnDelete2",_enabledIcon:"toolbarIcon deleteFeatureIcon",_disabledIcon:"toolbarIcon deleteFeatureIcon",
_enabled:!1,_label:"NLS_deleteLbl"},undo:{id:"btnUndo",_enabledIcon:"dijitEditorIcon dijitEditorIconUndo",_disabledIcon:"dijitEditorIcon dijitEditorIconUndo",_enabled:!1,_label:"NLS_undoLbl"},redo:{id:"btnRedo",_enabledIcon:"dijitEditorIcon dijitEditorIconRedo",_disabledIcon:"dijitEditorIcon dijitEditorIconRedo",_enabled:!1,_label:"NLS_redoLbl"}};v("extend-esri")&&N.setObject("dijit.editing.tools.EditingTools",z,y);return z})},"esri/dijit/editing/tools/DropDownToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-style dijit/registry dijit/Menu dijit/form/ComboButton ./ToolBase ../../../kernel ../../../lang".split(" "),
function(N,v,z,y,m,c,f,a,n,l){N=N([f,a],{declaredClass:"esri.dijit.editing.tools.DropDownToolBase",_enabled:!1,_checked:!1,postCreate:function(){this._tools=[];this._createTools();this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){var b,u=this._tools;for(b in u)u.hasOwnProperty(b)&&l.isDefined(u[b])&&u[b].destroy();this.inherited(arguments)},_createTools:function(){var b,u=new c;this.dropDown=u;for(b in this._tools)this._tools.hasOwnProperty(b)&&u.addChild(this._tools[b]);
this._activeTool=u.getChildren()[0];this._updateUI()},activate:function(b){this.inherited(arguments);this._activeTool?this._activeTool.activate():this._activateDefaultTool()},deactivate:function(){this.inherited(arguments);this._activeTool&&this._activeTool.deactivate()},enable:function(b){for(var u in this._tools)this._tools.hasOwnProperty(u)&&this._tools[u].enable(b);this.setEnabled(!0);this.inherited(arguments)},setChecked:function(b){this._checked=b;this._updateUI()},_onDrawEnd:function(b){},
onLayerChange:function(b,u,w){this._activeTool=null;this._activeType=u;this._activeTemplate=w;this._activeLayer=b},onItemClicked:function(b,u){this._activeTool&&this._activeTool.deactivate();this._activeTool=m.byId(b);!1===this._checked?this._onClick():(this._updateUI(),this._activeTool&&(this._activeTool.activate(),this._activeTool.setChecked(!0)))},_onClick:function(b){!1!==this._enabled&&(this._checked=!this._checked,this.inherited(arguments))},_updateUI:function(){this.attr("disabled",!this._enabled);
y.set(this.focusNode,{outline:"none"});y.set(this.titleNode,{padding:"0px",border:"none"});this._checked?y.set(this.titleNode,{backgroundColor:"#D4DFF2",border:"1px solid #316AC5"}):y.set(this.titleNode,{backgroundColor:"",border:""});this._activeTool&&(this.attr("iconClass",this._checked?this._activeTool._enabledIcon:this._activeTool._disabledIcon),this.attr("label",this._activeTool.label))}});z("extend-esri")&&v.setObject("dijit.editing.tools.DropDownToolBase",N,n);return N})},"esri/dijit/editing/tools/Selection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol ./Edit ./SelectionTools ./DropDownToolBase ../../../kernel".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w){N=N([u],{declaredClass:"esri.dijit.editing.tools.Selection",_enabled:!0,activate:function(){this.inherited(arguments);this._sConnect=y.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd")},deactivate:function(){this.inherited(arguments);y.disconnect(this._sConnect);delete this._sConnect},_initializeTool:function(){this._createSymbols();this._initializeLayers();this._toolTypes=["select","selectadd","selectremove"]},_onDrawEnd:function(e){this.inherited(arguments);
this._settings.editor._hideAttributeInspector();var p=this._settings.layers;this._selectMethod=this._activeTool._selectMethod;this._settings.editor._selectionHelper.selectFeaturesByGeometry(p,e,this._selectMethod,v.hitch(this,"onFinished"))},_createSymbols:function(){this._pointSelectionSymbol=new f(f.STYLE_CIRCLE,10,new a(a.STYLE_SOLID,new m([0,0,0]),1),new m([255,0,0,.5]));this._polylineSelectionSymbol=new a(a.STYLE_SOLID,new m([0,200,255]),2);this._polygonSelectionSymbol=new n(n.STYLE_SOLID,new a(a.STYLE_SOLID,
new m([0,0,0]),1),new m([0,200,255,.5]))},_initializeLayers:function(){z.forEach(this._settings.layers,this._setSelectionSymbol,this)},_setSelectionSymbol:function(e){var p=null;switch(e.geometryType){case "esriGeometryPoint":p=this._pointSelectionSymbol;break;case "esriGeometryPolyline":p=this._polylineSelectionSymbol;break;case "esriGeometryPolygon":p=this._polygonSelectionSymbol}e.setSelectionSymbol(e._selectionSymbol||p)},_createTools:function(){z.forEach(this._toolTypes,this._createTool,this);
this.inherited(arguments)},_createTool:function(e){var p=v.mixin(b[e],{settings:this._settings,onClick:v.hitch(this,"onItemClicked",b[e].id)});this._tools[e.toUpperCase()]=new l(p)}});c("extend-esri")&&v.setObject("dijit.editing.tools.Selection",N,w);return N})},"esri/dijit/editing/tools/SelectionTools":function(){define(["dojo/_base/lang","dojo/has","../../../layers/FeatureLayer","../../../toolbars/draw","../../../kernel"],function(N,v,z,y,m){z={select:{id:"btnNewSelection",_enabledIcon:"toolbarIcon newSelectionIcon",
_disabledIcon:"toolbarIcon newSelectionIcon",_drawType:y.EXTENT,_selectMethod:z.SELECTION_NEW,_label:"NLS_selectionNewLbl"},selectadd:{id:"btnAddToSelection",_enabledIcon:"toolbarIcon addToSelectionIcon",_disabledIcon:"toolbarIcon addToSelectionIcon",_drawType:y.EXTENT,_selectMethod:z.SELECTION_ADD,_label:"NLS_selectionAddLbl"},selectremove:{id:"btnSubtractFromSelection",_enabledIcon:"toolbarIcon removeFromSelectionIcon",_disabledIcon:"toolbarIcon removeFromSelectionIcon",_drawType:y.EXTENT,_selectMethod:z.SELECTION_SUBTRACT,
_label:"NLS_selectionRemoveLbl"},selectClear:{id:"btnClearSelection",_enabledIcon:"toolbarIcon clearSelectionIcon",_disabledIcon:"toolbarIcon clearSelectionIcon",_enabled:!1,_label:"NLS_selectionClearLbl"}};v("extend-esri")&&N.setObject("dijit.editing.tools.SelectionTools",z,m);return z})},"esri/dijit/editing/SelectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dojo/DeferredList ../../geometry/Extent ../../geometry/Point ../../geometry/ScreenPoint ../../layers/FeatureLayer ../../tasks/query ../../kernel".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u){N=N(null,{declaredClass:"esri.dijit.editing.SelectionHelper",constructor:function(w){this._settings=w||{};this._sConnects=[];this._mapServiceCount=0;this._map=this._settings.map;this._tolerance=this._settings.singleSelectionTolerance;this._initMapServiceInfos(this._settings.layers)},destroy:function(){for(var w in this._sConnects)this._sConnects.hasOwnProperty(w)&&z.disconnect(this._sConnects[w])},selectFeatures:function(w,e,p,h){p===l.SELECTION_NEW&&(this._resetMapServiceInfos(),
this.getSelection(w));var r=[];y.forEach(w,function(d){if(!0===d.visible&&!0===d._isMapAtVisibleScale()){var x=p;d._isSelOnly&&x===l.SELECTION_NEW&&(x=l.SELECTION_ADD);r.push(d.selectFeatures(e,x))}});(new c(r)).addCallback(v.hitch(this,function(d){var x=[];y.forEach(d,function(D,q){y.forEach(D[1],function(H){(H=w[q]._mode._getFeature(H.attributes[w[q].objectIdField])||null)&&x.push(H)},this)},this);this._mapServiceCount?((d=p===l.SELECTION_SUBTRACT)?(this._resetMapServiceInfos(),this._createLayerDefs(this._getLayerInfosFromSelection(w))):
this._createLayerDefs(this._getLayerInfosFromFeatures(x)),this._updateLayerDefs(this._mapServiceInfos,!1,!(x&&x.length||d),v.hitch(this,h,x))):h(x)}))},selectFeaturesByGeometry:function(w,e,p,h){var r=e;-1!==e.declaredClass.indexOf("Extent")&&e.xmax===e.xmin&&e.ymax===e.ymin&&(r=new a(e.xmax,e.ymax,e.spatialReference));r=-1!==r.declaredClass.indexOf("Point")?this._extentFromPoint(r):r;e=new b;e.geometry=r;this.selectFeatures(w,e,p,h)},clearSelection:function(w){y.forEach(this._nonSelOnlyLayers,function(p){p.clearSelection&&
p.clearSelection()});if(this._mapServiceCount){this._resetMapServiceInfos();var e=this._getLayerInfosFromSelection(this._settings.layers);y.some(e,function(p){return p.oids&&p.oids.length})&&(this._createLayerDefs(e),this._updateLayerDefs(this._mapServiceInfos,!0,w||!1))}},findMapService:function(w){var e=this._map,p=e.layerIds;w=w&&w._url&&w._url.path?w._url.path.toLowerCase():"";var h;for(h in p)if(p.hasOwnProperty(h)){var r=e.getLayer(p[h]);var d=r._url?r._url.path?r._url.path.toLowerCase().replace("mapserver",
"featureserver"):r._url.toLowerCase().replace("mapserver","featureserver"):"";if(w.substr(0,d.length)===d&&"esri.layers.ArcGISDynamicMapServiceLayer"===r.declaredClass)return r}},getSelection:function(w){var e=[];y.forEach(w,function(p){p._isSelOnly&&e.push(this._createLayerInfo(p))},this);y.forEach(e,function(p){var h=this._createMapServiceInfo(this.findMapService(p.layer));h&&(h.layerInfos[p.layer.layerId]=p)},this)},_initMapServiceInfos:function(w){this._nonSelOnlyLayers=[];this._mapServiceInfos=
[];y.forEach(w,function(e){var p=this.findMapService(e);p?(this._mapServiceCount++,this._createMapServiceInfo(p),p&&p.setDisableClientCaching(!0)):this._nonSelOnlyLayers.push(e)},this)},_createMapServiceInfo:function(w){if(!w)return null;var e=this._mapServiceInfos,p=e[w.id];p||(p=e[w.id]={mapService:w,layerInfos:[],layerDefs:v.mixin([],w.layerDefinitions||[]),origLayerDefs:v.mixin([],w.layerDefinitions||[])});return p},_resetMapServiceInfo:function(w){y.forEach(w.layerInfos,this._resetLayerInfo);
w.layerDefs=v.mixin([],w.origLayerDefs||[])},_resetMapServiceInfos:function(){var w=this._mapServiceInfos,e;for(e in w)w.hasOwnProperty(e)&&this._resetMapServiceInfo(w[e])},_createLayerInfo:function(w,e){var p=w.objectIdField;e=e?[]:w.getSelectedFeatures();return{layer:w,selectedFeatures:e||[],oids:y.map(e,function(h){return h.attributes[p]})}},_resetLayerInfo:function(w){w&&(w.selectedFeatures=[],w.oids=[])},_updateLayerDefs:function(w,e,p,h){for(var r in w)if(w.hasOwnProperty(r)){var d=w[r],x=d.mapService,
D=d.layerDefs=e?v.mixin([],d.origLayerDefs||[]):d.layerDefs;D?(p?h&&h():this._sConnects[x.id]=z.connect(x,"onUpdateEnd",v.hitch(this,"_onMapServiceUpdate",d,e,h)),x.setLayerDefinitions(D,p||!1)):h&&h()}},_onMapServiceUpdate:function(w,e,p){z.disconnect(this._sConnects[w.mapService.id]);y.forEach(w.layerInfos,function(h){if(e)h&&h.layer.clearSelection();else{var r=new b;r.objectIds=h?h.oids:[];r.objectIds.length&&h.layer.selectFeatures(r,l.SELECTION_SUBTRACT)}},this);e&&this._resetMapServiceInfo(w);
p&&p()},_createLayerDefs:function(w){y.forEach(w,function(e){var p=e.layer,h=this._createMapServiceInfo(this.findMapService(e.layer));if(h){h=h.layerDefs;var r=p.layerId,d='("'+p.objectIdField+'" NOT IN (',x=e.oids;x&&x.length&&(y.forEach(e.oids,function(D,q){x=!0;q&&(d+=",");d+="'"+D+"'"}),d+="))",h[r]=h.length&&h[r]&&h[r].length?h[r]+(" AND"+d):d)}},this)},_getLayerInfosFromFeatures:function(w){var e=[];y.forEach(w,function(h){var r=h.getLayer();r&&r._isSelOnly&&(e[r.id]||(e[r.id]=this._createLayerInfo(r,
!0)),e[r.id].selectedFeatures.push(h),e[r.id].oids.push(h.attributes[r.objectIdField]))},this);w=[];for(var p in e)e.hasOwnProperty(p)&&w.push(e[p]);return w},_getLayerInfosFromSelection:function(w){var e=[];y.forEach(w,function(p){p._isSelOnly&&e.push(this._createLayerInfo(p,!1))},this);return e},_extentFromPoint:function(w){var e=this._tolerance,p=this._map,h=p.toScreen(w);w=new n(h.x-e,h.y+e);e=new n(h.x+e,h.y-e);w=p.toMap(w);e=p.toMap(e);return new f(w.x,w.y,e.x,e.y,p.spatialReference)}});m("extend-esri")&&
v.setObject("dijit.editing.SelectionHelper",N,u);return N})},"esri/dijit/editing/TemplatePicker":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/_base/array dojo/_base/json dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/_Widget dijit/_Templated dojo/data/ItemFileReadStore dojox/grid/DataGrid dojox/gfx ../../layers/FeatureLayer ../../symbols/SimpleMarkerSymbol ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ./TemplatePickerItem ../../kernel ../../lang ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi dojo/text!./templates/TemplatePicker.html".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,p,h,r,d,x,D,q,H,t,G,T,A,S,O,V,I,g){var C=N([V,p,h],{declaredClass:"esri.dijit.editing.TemplatePicker",widgetsInTemplate:!0,templateString:g,featureLayers:null,items:null,grouping:!0,showTooltip:!1,maxLabelLength:0,rows:4,_rows:0,columns:3,surfaceWidth:30,surfaceHeight:30,emptyMessage:"",useLegend:!0,legendCache:{},_uniqueId:{id:0},_assumedCellWidth:90,_initialAutoWidth:300,_initialAutoHeight:200,_ieTimer:150,constructor:function(B,J){B=B||{};B.items||B.featureLayers||
console.error("TemplatePicker: please provide 'featureLayers' or 'items' parameter in the constructor");this._dojo14x=4<=f.version.minor;this._itemWidgets={};B.featureLayers&&B.featureLayers.length&&(this._flChanged=1);this._nls=I.widgets.templatePicker;this.emptyMessage=B.emptyMessage||this._nls&&this._nls.creationDisabled||""},postMixInProperties:function(){this.inherited(arguments);this._preprocess()},startup:function(){this.inherited(arguments);if("auto"===this.rows&&"auto"===this.columns){var B=
w.getContentBox(this.domNode);B.w||(this.domNode.style.width=this._initialAutoWidth+"px");if(!B.h||1>=B.h)this.domNode.style.height=this._initialAutoHeight+"px";B=w.getContentBox(this.domNode);this._columns=Math.floor(B.w/this._assumedCellWidth)||1}this._applyGridPatches();this._setGridLayout();z.connect(this.grid,"onRowClick",this,this._rowClicked);this._setGridData();this._toggleTooltip();9>a("ie")&&(this._repaintItems=v.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},
destroy:function(){this.showTooltip=!1;this._toggleTooltip();this._clearLegendInfo();this.featureLayers=this.items=this.grid=this._flItems=this._itItems=this._groupRowIndices=this._selectedCell=this._selectedInfo=this._selectedItem=null;this.inherited(arguments)},getSelected:function(){return this._selectedCell?this._selectedItem:null},clearSelection:function(){var B=this._selectedCell,J=this._selectedInfo;B&&this._rowClicked({cellNode:B,rowIndex:J.selRow,cellIndex:J.selCol})},update:function(B){B=
"auto"===this.rows&&"auto"===this.columns&&B?!0:!1;var J=this.grid;if(B){var M=this.domNode;var Q=f.query("#"+M.id+".templatePicker div.item")[0];M=w.getContentBox(M);Q=(Q=Q&&Q.parentNode)?y.coords(Q).w:this._assumedCellWidth;this._columns=(this._columns=Math.floor((M.w-J.views.views[0].getScrollbarWidth())/Q))||1}Q=this._rows;this._preprocess();var R=this._rows;this._setGridLayout();this._setGridData();R!==Q&&J.set("autoHeight",this._rows,!1);B?(J._resize({w:M.w,h:M.h}),J.viewsHeaderNode.style.display=
"none"):J.update();this._toggleTooltip();var X=this,W=this.getSelected();W&&J.store.fetch({onComplete:function(k){var F=(k=X._locate(W,X._selectedInfo,k))&&J.views.views[0].getCellNode(k[0],k[1]);F&&X._rowClicked({cellNode:F,rowIndex:k[0],cellIndex:k[1]},!0)}});9>a("ie")&&setTimeout(this._repaintItems,this._ieTimer);B=this.featureLayers;M=this.items;B&&B.length||M&&M.length||!J||!this.emptyMessage||J.showMessage(this.emptyMessage)},_eventMap:{"selection-change":!0},onSelectionChange:function(){},
_setUseLegendAttr:function(B){var J=this.useLegend;this._started&&J===B||(B?this._flChanged=1:this._clearLegendInfo());this.useLegend=B},_setFeatureLayersAttr:function(B){var J=this.featureLayers;this._started&&J===B||(this._flChanged=1);this.featureLayers=B},_adjustRowsCols:function(B){if("auto"===this.rows&&"auto"===this.columns)this._started||(this._rows=!1,this._columns=null,this._autoWidth=!1);else{var J=0;this._rows=this.rows;this._columns=this.columns;"auto"===this.rows?(this.featureLayers?
this.grouping?(J=B.length,m.forEach(B,function(M){J+=Math.ceil(M.length/this.columns)},this)):(m.forEach(B,function(M){J+=M.length},this),J=Math.ceil(J/this.columns)):J=Math.ceil(B.length/this.columns),this._rows=J):"auto"===this.columns&&(this.featureLayers?this.grouping?J=3:(m.forEach(B,function(M){J+=M.length},this),J=Math.ceil(J/this.rows)):J=Math.ceil(B.length/this.rows),this._columns=J)}},_preprocess:function(){this.items&&(this.grouping=!1);this._autoWidth=!1;if("auto"===this.rows||"auto"===
this.columns)this._autoWidth=!0;if(this.featureLayers)if(this.useLegend&&this._flChanged&&(this._legendIndices=[],this._loadingIndices=[],this._legendSymbols={},this._ignoreLegends(),this._loadingLegends=[],clearTimeout(this._legendTimer),this._legendTimer=null,this._processSelectionLayers(),this._flChanged=0),m.every(this.featureLayers,function(M){return M.loaded})){this.featureLayers=m.filter(this.featureLayers,function(M){return!(M.hasZ&&!M.enableZDefaults)});var B=this._flItems=this._getItemsFromLayers(this.featureLayers);
this._adjustRowsCols(B)}else{var J=this.featureLayers.length;m.forEach(this.featureLayers,function(M){if(M.loaded)J--;else var Q=z.connect(M,"onLoad",this,function(){z.disconnect(Q);Q=null;J--;J||this.update()})},this)}else B=this._itItems=this._getItemsFromItems(this.items),this._adjustRowsCols(B)},_processSelectionLayers:function(){var B,J,M,Q,R,X,W,k={};m.forEach(this.featureLayers,function(F,L){F.mode===D.MODE_SELECTION&&F._map&&F.url&&F._params.drawMode&&!F.source&&(J=v.trim(F._url.path).replace(/\/(MapServer|FeatureServer).*/ig,
"/MapServer").replace(/^https?:\/\//ig,"").toLowerCase(),M=k[J]=k[J]||{},Q=M.featureLayers=M.featureLayers||{},X=M.indices=M.indices||[],Q[L]=F,X.push(L),B=F._map)});B&&m.forEach(B.layerIds,function(F){(F=B.getLayer(F))&&F.url&&(F.getImageUrl||F.getTileUrl)&&F.loaded&&10.1<=F.version&&(J=v.trim(F._url.path).replace(/(\/MapServer).*/ig,"$1"),R=J.replace(/^https?:\/\//ig,"").toLowerCase(),k[R]&&!k[R].mapServiceUrl&&(M=k[R],M.mapServiceUrl=J,M.mapServiceLayer=F,this._legendIndices=this._legendIndices.concat(M.indices),
W=this._fetchLegend({pickerInstance:this,info:M},R),W.then?(this._loadingIndices=this._loadingIndices.concat(M.indices),this._loadingLegends.push(W)):this._processLegendResponse(W,M)))},this)},_fetchLegend:function(B,J){var M=C.prototype,Q=M.legendCache[J];Q?Q.then&&Q._contexts.push(B):(Q=M.legendCache[J]=O({url:B.info.mapServiceUrl+"/legend",content:{f:"json"},callbackParamName:"callback"}),Q._contexts=[B],Q.addBoth(function(R){if(!Q.canceled){M.legendCache[J]=R;var X=Q._contexts;Q._contexts=null;
m.forEach(X,function(W){var k=W.pickerInstance;W=W.info;if(!k._destroyed){m.forEach(W.indices,function(L){F=m.indexOf(k._loadingIndices,L);-1<F&&k._loadingIndices.splice(F,1)});var F=m.indexOf(k._loadingLegends,Q);-1<F&&k._loadingLegends.splice(F,1);k._processLegendResponse(R,W)}})}}));return Q},_clearLegendInfo:function(){clearTimeout(this._legendTimer);this._ignoreLegends();this._legendIndices=this._loadingIndices=this._legendSymbols=this._loadingLegends=this._legendTimer=null},_ignoreLegends:function(){this._loadingLegends&&
m.forEach(this._loadingLegends,function(B){var J=-1;m.some(B._contexts,function(M,Q){M.pickerInstance===this&&(J=Q);return-1<J},this);-1<J&&B._contexts.splice(J,1)},this)},_processLegendResponse:function(B,J){if(!B||B instanceof Error){var M;m.forEach(J.indices,function(R){M=m.indexOf(this._legendIndices,R);-1<M&&this._legendIndices.splice(M,1)},this)}else m.forEach(J.indices,function(R){var X=J.featureLayers[R].layerId,W,k=J.mapServiceUrl+"/"+X+"/images/",F=J.mapServiceLayer._getToken(),L,E;if(!this._legendSymbols[R]){var K=
null;m.some(B.layers,function(U){U.layerId==X&&(K=U);return!!K});if(K){var P=this._legendSymbols[R]={};m.forEach(K.legend,function(U){if((L=U.values)&&L.length)for(W=0;W<L.length;W++)P[L[W]]=U;else P.defaultSymbol=U;(E=U.url)&&!U._fixed&&(U._fixed=1,-1===E.search(/https?:/)&&(U.url=k+E),F&&-1!==U.url.search(/https?:/)&&(U.url+=(-1<U.url.indexOf("?")?"\x26":"?")+"token\x3d"+F))})}}},this);var Q=this;Q._started&&!Q._legendTimer&&(Q._legendTimer=setTimeout(function(){clearTimeout(Q._legendTimer);Q._legendTimer=
null;Q._destroyed||Q.update()},0))},_applyGridPatches:function(){var B=this.grid,J=B.adaptWidth,M,Q,R;B.adaptWidth=function(){M=this.views.views;for(Q=0;R=M[Q];Q++)e.set(R.headerNode,"display","block");J.apply(this,arguments);for(Q=0;R=M[Q];Q++)e.set(R.headerNode,"display","none")};if(this._dojo14x){if("auto"!==this.rows&&"auto"!==this.columns)var X=z.connect(B,"_onFetchComplete",this,function(){z.disconnect(X);this.grid.set("autoHeight",this._rows)});z.connect(B,"_onDelete",this,this._destroyItems);
z.connect(B,"_clearData",this,this._destroyItems);z.connect(B,"destroy",this,this._destroyItems);(B=B.focus)&&B.findAndFocusGridCell&&(B.findAndFocusGridCell=function(){return!1})}},_setGridLayout:function(){var B=function(X){return function(W,k){return this._cellGet(X,W,k)}},J=v.hitch(this,this._cellFormatter),M=[],Q=this._columns,R;for(R=0;R<Q;R++)M.push({field:"cell"+R,get:v.hitch(this,B(R)),formatter:J});B={cells:[M]};this.grouping&&(Q={field:"groupName",colSpan:Q,get:v.hitch(this,this._cellGetGroup),
formatter:v.hitch(this,this._cellGroupFormatter)},B.cells.push([Q]));Q=this.grid;J=d.prototype.rowsPerPage;Q.set("rowsPerPage",this._rows>J?this._rows:J);Q.set("structure",B)},_setGridData:function(){var B=[];if(this.grouping){this._groupRowIndices=[];var J,M,Q=this._columns;m.forEach(this._flItems,function(X,W){B.push({});W=0===W?0:J+M+1;this._groupRowIndices.push(W);J=W;M=Math.ceil(X.length/Q);B=B.concat(this._getStoreItems(X))},this)}else this.featureLayers?(m.forEach(this._flItems,function(X){B=
B.concat(X)}),B=this._getStoreItems(B)):B=this._getStoreItems(this._itItems);var R=new r({data:{items:B}});this.grid.setStore(R)},_toggleTooltip:function(){if(this.showTooltip){if(!this.tooltip){this.tooltip=u.create("div",{"class":"esriMapTooltip"},this.domNode);this.tooltip.style.display="none";this.tooltip.style.position="fixed";var B=this.grid;this._mouseOverConnect=z.connect(B,"onCellMouseOver",this,this._cellMouseOver);this._mouseOutConnect=z.connect(B,"onCellMouseOut",this,this._cellMouseOut)}}else this.tooltip&&
(z.disconnect(this._mouseOverConnect),z.disconnect(this._mouseOutConnect),u.destroy(this.tooltip),this.tooltip=null)},_rowClicked:function(B,J){var M=B.cellNode,Q=B.rowIndex;B=B.cellIndex;var R=this._getCellInfo(M,Q,B);if(R){var X=this.grid.store;if(!X.getValue(R,"loadingCell")&&(this._selectedCell&&b.remove(this._selectedCell,"selectedItem"),M!==this._selectedCell?(b.add(M,"selectedItem"),this._selectedCell=M,this._selectedItem={featureLayer:X.getValue(R,"layer"),type:X.getValue(R,"type"),template:X.getValue(R,
"template"),symbolInfo:X.getValue(R,"symbolInfo"),item:this._getItem(R)},this._selectedInfo={selRow:Q,selCol:B,index1:X.getValue(R,"index1"),index2:X.getValue(R,"index2"),index:X.getValue(R,"index")}):this._selectedCell=this._selectedInfo=this._selectedItem=null,!J))this.onSelectionChange()}},_locate:function(B,J,M){var Q=this.grid.store,R=Array(this._columns),X,W=J.index1,k=J.index2,F=J.index,L=B.item;m.some(M,function(E,K){return m.some(R,function(P,U){return(P=Q.getValue(E,"cell"+U))&&(L?F===Q.getValue(P,
"index"):W===Q.getValue(P,"index1")&&k===Q.getValue(P,"index2"))?(X=[K,U],!0):!1})});return X},_getCellInfo:function(B,J,M){if(B)return B=this.grid,J=B.getItem(J),B.store.getValue(J,"cell"+M)},_getItem:function(B){var J=this.items;if(J)return J[this.grid.store.getValue(B,"index")]},_cellMouseOver:function(B){var J=this.tooltip,M=B.cellNode,Q=this._getCellInfo(M,B.rowIndex,B.cellIndex);if(J&&Q){var R=this.grid.store;B=R.getValue(Q,"template");var X=R.getValue(Q,"type"),W=R.getValue(Q,"symbolInfo");
R=R.getValue(Q,"layer");B=(Q=this._getItem(Q))&&Q.label+(Q.description?": "+Q.description:"")||B&&B.name+(B.description?": "+B.description:"")||X&&X.name||W&&W.label+(W.description?": "+W.description:"")||(R&&R.name+": ")+"Default";J.style.display="none";J.innerHTML=B;M=y.coords(M.firstChild);e.set(J,{left:M.x+"px",top:M.y+M.h+5+"px"});J.style.display=""}},_cellMouseOut:function(){var B=this.tooltip;B&&(B.style.display="none")},_destroyItems:function(){var B=this._itemWidgets,J;for(J in B)B[J]&&(B[J].destroy(),
delete B[J])},_repaintItems:function(){var B=this._itemWidgets,J;for(J in B){var M=B[J];M&&M._repaint(M._surface)}},_getStoreItems:function(B){var J=this._uniqueId;B=m.map(B,function(E){return v.mixin({surfaceId:"tpick-surface-"+J.id++},E)});for(var M=B.length,Q=0,R={},X=0,W,k=[],F=!0,L=this._columns;Q<M;)F=!0,W="cell"+X,R[W]=B[Q],Q++,X++,0===X%L&&(F=!1,k.push(R),R={},X=0);F&&M&&k.push(R);return k},_getItemsFromLayers:function(B){var J=[];m.forEach(B,function(M,Q){J.push(this._getItemsFromLayer(M,
Q))},this);return J},_getItemsFromLayer:function(B,J){var M=[];if(this.useLegend&&-1<m.indexOf(this._loadingIndices,J))return[{label:this._nls&&this._nls.loading||"",symbol:null,layer:B,type:null,template:null,index1:J,index2:0,loadingCell:1}];var Q=[];Q=Q.concat(B.templates);m.forEach(B.types,function(k){var F=k.templates;m.forEach(F,function(L){L._type_=k});Q=Q.concat(F)});Q=m.filter(Q,S.isDefined);var R=B.renderer;if(R){var X=R.declaredClass.replace("esri.renderer.","");if(0<Q.length)m.forEach(Q,
function(k){var F=k.prototype;if(F){var L;if(L=this._isUnclassedRenderer(R)?R.infos[0].symbol:R.valueExpression?this._createSimpleSymbol(B):R.getSymbol(F)||this._createSimpleSymbol(B)){var E=null,K;if(!(9>l("ie"))&&k.thumbnail&&k.thumbnail.imageData)E=new H(k.thumbnail);else if(this.useLegend&&-1<m.indexOf(this._legendIndices,J)){if(K=this._legendSymbols&&this._legendSymbols[J])switch(X){case "SimpleRenderer":E=K.defaultSymbol;break;case "UniqueValueRenderer":m.some(R.infos,function(P){P.symbol===
L&&(E=K[P.value]);return!!E});break;case "ClassBreaksRenderer":m.some(R.infos,function(P){P.symbol===L&&(E=K[P.maxValue]);return!!E})}E&&(F=c.fromJson(c.toJson(H.defaultProps)),F.url=E.url,F.imageData=E.imageData,F.contentType=E.contentType,F.width=E.width,F.height=E.height,S.isDefined(F.width)&&S.isDefined(F.height)||(F.width=15,F.height=15),E=new H(F))}M.push({label:this._trimLabel(k.name),symbol:E||L,legendOverride:!!E,layer:B,type:k._type_,template:k,index1:J,index2:M.length})}else switch(X){case "HeatmapRenderer":M.push({label:this._trimLabel(k.name),
symbol:new q,legendOverride:!!E,layer:B,type:k._type_,template:k,index1:J,index2:M.length})}}delete k._type_},this);else{var W=[];"TemporalRenderer"===X&&(R=R.observationRenderer)&&(X=R.declaredClass.replace("esri.renderer.",""));switch(X){case "SimpleRenderer":W=[{symbol:R.symbol,label:R.label,description:R.description}];break;case "UniqueValueRenderer":case "ClassBreaksRenderer":W=R.infos}M=m.map(W,function(k,F){return{label:this._trimLabel(k.label),description:k.description,symbolInfo:v.mixin({constructor:function(){}},
k),symbol:k.symbol,layer:B,index1:J,index2:F}},this)}}return M},_isUnclassedRenderer:function(B){return!!((B.hasVisualVariables("sizeInfo",!1)||B.hasVisualVariables("colorInfo",!1)||B.hasVisualVariables("opacityInfo",!1))&&B.addBreak&&B.infos&&1===B.infos.length)},_createSimpleSymbol:function(B){switch(B.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":var J=new q;break;case "esriGeometryPolyline":J=new G;break;case "esriGeometryPolygon":J=new t;break;default:B.hasXYFootprint&&
B.hasXYFootprint()&&(J=new t)}return J},_getItemsFromItems:function(B){return m.map(B,function(J,M){J=v.mixin({index:M},J);J.label=this._trimLabel(J.label);return J},this)},_trimLabel:function(B){var J=this.maxLabelLength;J&&B&&B.length>J&&(B=B.substr(0,J)+"...");return B||""},_cellGet:function(B,J,M){return M?this.grid.store.getValue(M,"cell"+B):""},_cellFormatter:function(B){if(B){var J=this._itemWidgets,M=this.grid.store,Q=M.getValue(B,"surfaceId"),R=J[Q];R||(R=J[Q]=new T({id:Q,label:M.getValue(B,
"label"),symbol:M.getValue(B,"symbol"),legendOverride:M.getValue(B,"legendOverride"),surfaceWidth:this.surfaceWidth,surfaceHeight:this.surfaceHeight,template:M.getValue(B,"template")}));return R||""}return""},_cellGetGroup:function(B,J){if(!this._groupRowIndices)return"";B=m.indexOf(this._groupRowIndices,B);return J&&-1!==B?(J=this.featureLayers[B])&&(this.groupLabelFunction?this.groupLabelFunction(J):J.name)||"":""},_cellGroupFormatter:function(B){return B?"\x3cdiv class\x3d'groupLabel'\x3e"+B+"\x3c/div\x3e":
""}});a("extend-esri")&&v.setObject("dijit.editing.TemplatePicker",C,A);return C})},"dojox/grid/DataGrid":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/json dojo/_base/sniff dojo/_base/declare ./_Grid ./DataSelection dojo/_base/html dojo/has dojo/has!dojo-bidi?./bidi/_BidiMixin".split(" "),function(N,v,z,y,m,c,f,a,n){var l=c("dojox.grid.DataGrid",f,{store:null,query:null,queryOptions:null,fetchText:"...",sortFields:null,updateDelay:1,items:null,_store_connects:null,_by_idty:null,
_by_idx:null,_cache:null,_pages:null,_pending_requests:null,_bop:-1,_eop:-1,_requests:0,rowCount:0,_isLoaded:!1,_isLoading:!1,keepSelection:!1,postCreate:function(){this._pages=[];this._store_connects=[];this._by_idty={};this._by_idx=[];this._cache=[];this._pending_requests={};this._setStore(this.store);this.inherited(arguments)},destroy:function(){this.selection.destroy();this.inherited(arguments)},createSelection:function(){this.selection=new a(this)},get:function(b,u){if(u&&"_item"==this.field&&
!this.fields)return u;if(u&&this.fields){var w=[],e=this.grid.store;v.forEach(this.fields,function(p){w=w.concat(e.getValues(u,p))});return w}return u||"string"!==typeof b?u?this.field?"_item"==this.field?u:this.grid.store.getValue(u,this.field):this.value:this.defaultValue:this.inherited(arguments)},_checkUpdateStatus:function(){if(0<this.updateDelay){var b=!1;this._endUpdateDelay&&(clearTimeout(this._endUpdateDelay),delete this._endUpdateDelay,b=!0);this.updating||(this.beginUpdate(),b=!0);if(b){var u=
this;this._endUpdateDelay=setTimeout(function(){delete u._endUpdateDelay;u.endUpdate()},this.updateDelay)}}},_onSet:function(b,u,w,e){this._checkUpdateStatus();b=this.getItemIndex(b);-1<b&&this.updateRow(b)},_createItem:function(b,u){u=this._hasIdentity?this.store.getIdentity(b):y.toJson(this.query)+":idx:"+u+":sort:"+y.toJson(this.getSortProps());return this._by_idty[u]={idty:u,item:b}},_addItem:function(b,u,w){this._by_idx[u]=this._createItem(b,u);w||this.updateRow(u)},_onNew:function(b,u){this._checkUpdateStatus();
u=this.get("rowCount");this._addingItem=!0;this.updateRowCount(u+1);this._addingItem=!1;this._addItem(b,u);this.showMessage()},_onDelete:function(b){this._checkUpdateStatus();b=this._getItemIndex(b,!0);if(0<=b){this._pages=[];this._eop=this._bop=-1;var u=this._by_idx[b];this._by_idx.splice(b,1);delete this._by_idty[u.idty];this.updateRowCount(this.get("rowCount")-1);0===this.get("rowCount")&&this.showMessage(this.noDataMessage)}this.selection.isSelected(b)&&(this.selection.deselect(b),this.selection.selected.splice(b,
1))},_onRevert:function(){this._refresh()},setStore:function(b,u,w){this._requestsPending(0)||(this._setQuery(u,w),this._setStore(b),this._refresh(!0))},setQuery:function(b,u){this._requestsPending(0)||(this._setQuery(b,u),this._refresh(!0))},setItems:function(b){this.items=b;this._setStore(this.store);this._refresh(!0)},_setQuery:function(b,u){this.query=b;this.queryOptions=u||this.queryOptions},_setStore:function(b){this.store&&this._store_connects&&v.forEach(this._store_connects,this.disconnect,
this);if(this.store=b){b=this.store.getFeatures();var u=[];this._canEdit=!!b["dojo.data.api.Write"]&&!!b["dojo.data.api.Identity"];this._hasIdentity=!!b["dojo.data.api.Identity"];b["dojo.data.api.Notification"]&&!this.items&&(u.push(this.connect(this.store,"onSet","_onSet")),u.push(this.connect(this.store,"onNew","_onNew")),u.push(this.connect(this.store,"onDelete","_onDelete")));this._canEdit&&u.push(this.connect(this.store,"revert","_onRevert"));this._store_connects=u}},_onFetchBegin:function(b,
u){this.scroller&&(this.rowCount!=b&&(u.isRender?(this.scroller.init(b,this.keepRows,this.rowsPerPage),this.rowCount=b,this._setAutoHeightAttr(this.autoHeight,!0),this._skipRowRenormalize=!0,this.prerender(),this._skipRowRenormalize=!1):this.updateRowCount(b)),b?this.showMessage():(this.views.render(),this._resize(),this.showMessage(this.noDataMessage),this.focus.initFocusView()))},_onFetchComplete:function(b,u){this.scroller&&(b&&0<b.length&&(v.forEach(b,function(w,e){this._addItem(w,u.start+e,!0)},
this),this.updateRows(u.start,b.length),u.isRender?(this.setScrollTop(0),this.postrender()):this._lastScrollTop&&this.setScrollTop(this._lastScrollTop),m("ie")&&n.setSelectable(this.domNode,this.selectable)),delete this._lastScrollTop,this._isLoaded||(this._isLoading=!1,this._isLoaded=!0),this._pending_requests[u.start]=!1)},_onFetchError:function(b,u){console.log(b);delete this._lastScrollTop;this._isLoaded||(this._isLoading=!1,this._isLoaded=!0,this.showMessage(this.errorMessage));this._pending_requests[u.start]=
!1;this.onFetchError(b,u)},onFetchError:function(b,u){},_fetch:function(b,u){b=b||0;if(this.store&&!this._pending_requests[b]){this._isLoaded||this._isLoading||(this._isLoading=!0,this.showMessage(this.loadingMessage));this._pending_requests[b]=!0;try{if(this.items){var w=this.items,e=this.store;this.rowsPerPage=w.length;var p={start:b,count:this.rowsPerPage,isRender:u};this._onFetchBegin(w.length,p);var h=0;v.forEach(w,function(d){e.isItemLoaded(d)||h++});if(0===h)this._onFetchComplete(w,p);else{var r=
function(d){h--;0===h&&this._onFetchComplete(w,p)};v.forEach(w,function(d){e.isItemLoaded(d)||e.loadItem({item:d,onItem:r,scope:this})},this)}}else this.store.fetch({start:b,count:this.rowsPerPage,query:this.query,sort:this.getSortProps(),queryOptions:this.queryOptions,isRender:u,onBegin:z.hitch(this,"_onFetchBegin"),onComplete:z.hitch(this,"_onFetchComplete"),onError:z.hitch(this,"_onFetchError")})}catch(d){this._onFetchError(d,{start:b,count:this.rowsPerPage})}}},_clearData:function(){this.updateRowCount(0);
this._by_idty={};this._by_idx=[];this._pages=[];this._bop=this._eop=-1;this._isLoading=this._isLoaded=!1},getItem:function(b){var u=this._by_idx[b];return!u||u&&!u.item?(this._preparePage(b),null):u.item},getItemIndex:function(b){return this._getItemIndex(b,!1)},_getItemIndex:function(b,u){if(!u&&!this.store.isItem(b))return-1;u=this._hasIdentity?this.store.getIdentity(b):null;for(var w=0,e=this._by_idx.length;w<e;w++){var p=this._by_idx[w];if(p&&(u&&p.idty==u||p.item===b))return w}return-1},filter:function(b,
u){this.query=b;u&&this._clearData();this._fetch()},_getItemAttr:function(b,u){return(b=this.getItem(b))?this.store.getValue(b,u):this.fetchText},_render:function(){this.domNode.parentNode&&(this.scroller.init(this.get("rowCount"),this.keepRows,this.rowsPerPage),this.prerender(),this._fetch(0,!0))},_requestsPending:function(b){return this._pending_requests[b]},_rowToPage:function(b){return this.rowsPerPage?Math.floor(b/this.rowsPerPage):b},_pageToRow:function(b){return this.rowsPerPage?this.rowsPerPage*
b:b},_preparePage:function(b){(b<this._bop||b>=this._eop)&&!this._addingItem&&(b=this._rowToPage(b),this._needPage(b),this._bop=b*this.rowsPerPage,this._eop=this._bop+(this.rowsPerPage||this.get("rowCount")))},_needPage:function(b){this._pages[b]||(this._pages[b]=!0,this._requestPage(b))},_requestPage:function(b){b=this._pageToRow(b);0<Math.min(this.rowsPerPage,this.get("rowCount")-b)&&(this._requests++,this._requestsPending(b)||setTimeout(z.hitch(this,"_fetch",b,!1),1))},getCellName:function(b){return b.field},
_refresh:function(b){this._clearData();this._fetch(0,b)},sort:function(){this.edit.apply();this._lastScrollTop=this.scrollTop;this._refresh()},canSort:function(){return!this._isLoading},getSortProps:function(){var b=this.getCell(this.getSortIndex());if(b){var u=b.sortDesc,w=!(0<this.sortInfo);return[{attribute:b.field,descending:"undefined"==typeof u?w:w?!u:u}]}return this.sortFields?this.sortFields:null},styleRowState:function(b){if(this.store&&this.store.getState){for(var u=this.store.getState(b.index),
w="",e=0,p=["inflight","error","inserting"],h;h=p[e];e++)if(u[h]){w=" dojoxGridRow-"+h;break}b.customClasses+=w}},onStyleRow:function(b){this.styleRowState(b);this.inherited(arguments)},canEdit:function(b,u){return this._canEdit},_copyAttr:function(b,u){b=this.getItem(b);return this.store.getValue(b,u)},doStartEdit:function(b,u){this._cache[u]||(this._cache[u]=this._copyAttr(u,b.field));this.onStartEdit(b,u)},doApplyCellEdit:function(b,u,w){this.store.fetchItemByIdentity({identity:this._by_idx[u].idty,
onItem:z.hitch(this,function(e){var p=this.store.getValue(e,w);"number"==typeof p?b=isNaN(b)?b:parseFloat(b):"boolean"==typeof p?b="true"==b?!0:"false"==b?!1:b:p instanceof Date&&(p=new Date(b),b=isNaN(p.getTime())?b:p);this.store.setValue(e,w,b);this.onApplyCellEdit(b,u,w)})})},doCancelEdit:function(b){this._cache[b]&&(this.updateRow(b),delete this._cache[b]);this.onCancelEdit.apply(this,arguments)},doApplyEdit:function(b,u){this.onApplyEdit(b)},removeSelectedRows:function(){if(this._canEdit){this.edit.apply();
var b=z.hitch(this,function(u){u.length&&(v.forEach(u,this.store.deleteItem,this.store),this.selection.clear())});this.allItemsSelected?this.store.fetch({query:this.query,queryOptions:this.queryOptions,onComplete:b}):b(this.selection.getSelected())}}});l.cell_markupFactory=function(b,u,w){var e=z.trim(n.attr(u,"field")||"");e&&(w.field=e);w.field=w.field||w.name;if(e=z.trim(n.attr(u,"fields")||""))w.fields=e.split(",");b&&b(u,w)};l.markupFactory=function(b,u,w,e){return f.markupFactory(b,u,w,z.partial(l.cell_markupFactory,
e))};return l})},"dojox/grid/_Grid":function(){define("dojo/_base/kernel ../main dojo/_base/declare ./_Events ./_Scroller ./_Layout ./_View ./_ViewManager ./_RowManager ./_FocusManager ./_EditManager ./Selection ./_RowSelector ./util dijit/_Widget dijit/_TemplatedMixin dijit/CheckedMenuItem dojo/text!./resources/_Grid.html dojo/string dojo/_base/array dojo/_base/lang dojo/_base/sniff dojox/html/metrics dojo/_base/html dojo/query dojo/dnd/common dojo/i18n!dijit/nls/loading".split(" "),function(N,v,
z,y,m,c,f,a,n,l,b,u,w,e,p,h,r,d,x,D,q,H,t,G,T){N.isCopyKey||(N.isCopyKey=N.dnd.getCopyKeyState);z=z("dojox.grid._Grid",[p,h,y],{templateString:d,classTag:"dojoxGrid",rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:!1,initialWidth:"",autoHeight:"",rowHeight:0,autoRender:!0,defaultHeight:"15em",height:"",structure:null,elasticView:-1,singleClickEdit:!1,selectionMode:"extended",rowSelector:"",columnReordering:!1,headerMenu:null,placeholderLabel:"GridColumns",selectable:!1,_click:null,loadingMessage:"\x3cspan class\x3d'dojoxGridLoading'\x3e${loadingState}\x3c/span\x3e",
errorMessage:"\x3cspan class\x3d'dojoxGridError'\x3e${errorState}\x3c/span\x3e",noDataMessage:"",escapeHTMLInData:!0,formatterScope:null,editable:!1,summary:"",_setSummaryAttr:"domNode",sortInfo:0,_placeholders:null,_layoutClass:c,buildRendering:function(){this.inherited(arguments);this.domNode.getAttribute("tabIndex")||(this.domNode.tabIndex="0");this.createScroller();this.createLayout();this.createViews();this.createManagers();this.createSelection();this.connect(this.selection,"onSelected","onSelected");
this.connect(this.selection,"onDeselected","onDeselected");this.connect(this.selection,"onChanged","onSelectionChanged");t.initOnFontResize();this.connect(t,"onFontResize","textSizeChanged");e.funnelEvents(this.domNode,this,"doKeyEvent",e.keyEvents);"none"!=this.selectionMode&&this.domNode.setAttribute("aria-multiselectable","single"==this.selectionMode?"false":"true");G.addClass(this.domNode,this.classTag);this.isLeftToRight()||G.addClass(this.domNode,this.classTag+"Rtl");0<this.rowHeight&&G.addClass(this.viewsNode,
this.classTag+"FixedRowHeight")},postMixInProperties:function(){this.inherited(arguments);var A=N.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=x.substitute(this.loadingMessage,A);this.errorMessage=x.substitute(this.errorMessage,A);this.srcNodeRef&&this.srcNodeRef.style.height&&(this.height=this.srcNodeRef.style.height);this._setAutoHeightAttr(this.autoHeight,!0);this.lastScrollTop=this.scrollTop=0},postCreate:function(){this._placeholders=[];this._setHeaderMenuAttr(this.headerMenu);
this._setStructureAttr(this.structure);this._click=[];this.inherited(arguments);this.domNode&&this.autoWidth&&this.initialWidth&&(this.domNode.style.width=this.initialWidth);this.domNode&&!this.editable&&G.attr(this.domNode,"aria-readonly","true")},destroy:function(){this.domNode.onReveal=null;this.domNode.onSizeChange=null;delete this._click;this.scroller&&(this.scroller.destroy(),delete this.scroller);this.edit.destroy();delete this.edit;this.views.destroyViews();this.focus&&(this.focus.destroy(),
delete this.focus);this.headerMenu&&this._placeholders.length&&(D.forEach(this._placeholders,function(A){A.unReplace(!0)}),this.headerMenu.unBindDomNode(this.viewsHeaderNode));this.inherited(arguments)},_setAutoHeightAttr:function(A,S){"string"==typeof A&&(A=A&&"false"!=A?"true"==A?!0:window.parseInt(A,10):!1);"number"==typeof A&&(isNaN(A)&&(A=!1),0>A?A=!0:0===A&&(A=!1));this.autoHeight=A;this._autoHeight="boolean"==typeof A?A:"number"==typeof A?A>=this.get("rowCount"):!1;this._started&&!S&&this.render()},
_getRowCountAttr:function(){return this.updating&&this.invalidated&&void 0!=this.invalidated.rowCount?this.invalidated.rowCount:this.rowCount},textSizeChanged:function(){this.render()},sizeChange:function(){this.update()},createManagers:function(){this.rows=new n(this);this.focus=new l(this);this.edit=new b(this)},createSelection:function(){this.selection=new u(this)},createScroller:function(){this.scroller=new m;this.scroller.grid=this;this.scroller.renderRow=q.hitch(this,"renderRow");this.scroller.removeRow=
q.hitch(this,"rowRemoved")},createLayout:function(){this.layout=new this._layoutClass(this);this.connect(this.layout,"moveColumn","onMoveColumn")},onMoveColumn:function(){this.update()},onResizeColumn:function(A){},createViews:function(){this.views=new a(this);this.views.createView=q.hitch(this,"createView")},createView:function(A,S){A=new (q.getObject(A))({grid:this,index:S});this.viewsNode.appendChild(A.domNode);this.viewsHeaderNode.appendChild(A.headerNode);this.views.addView(A);G.attr(this.domNode,
"align",this.isLeftToRight()?"left":"right");return A},buildViews:function(){for(var A=0,S;S=this.layout.structure[A];A++)this.createView(S.type||v._scopeName+".grid._View",A).setStructure(S);this.scroller.setContentNodes(this.views.getContentNodes())},_setStructureAttr:function(A){A&&q.isString(A)&&(N.deprecated("dojox.grid._Grid.set('structure', 'objVar')","use dojox.grid._Grid.set('structure', objVar) instead","2.0"),A=q.getObject(A));this.structure=A;if(!A)if(this.layout.structure)A=this.layout.structure;
else return;this.views.destroyViews();this.focus.focusView=null;A!==this.layout.structure&&this.layout.setStructure(A);this._structureChanged()},setStructure:function(A){N.deprecated("dojox.grid._Grid.setStructure(obj)","use dojox.grid._Grid.set('structure', obj) instead.","2.0");this._setStructureAttr(A)},getColumnTogglingItems:function(){var A=[];var S=D.map(this.layout.cells,function(O){O.menuItems||(O.menuItems=[]);var V=this,I=new r({label:O.name,checked:!O.hidden,_gridCell:O,onChange:function(g){if(V.layout.setColumnVisibility(this._gridCell.index,
g)){var C=this._gridCell.menuItems;1<C.length&&D.forEach(C,function(B){B!==this&&B.setAttribute("checked",g)},this);g=D.filter(V.layout.cells,function(B){1<B.menuItems.length?D.forEach(B.menuItems,"item.set('disabled', false);"):B.menuItems[0].set("disabled",!1);return!B.hidden});1==g.length&&D.forEach(g[0].menuItems,"item.set('disabled', true);")}},destroy:function(){var g=D.indexOf(this._gridCell.menuItems,this);this._gridCell.menuItems.splice(g,1);delete this._gridCell;r.prototype.destroy.apply(this,
arguments)}});O.menuItems.push(I);O.hidden||A.push(I);return I},this);1==A.length&&A[0].set("disabled",!0);return S},_setHeaderMenuAttr:function(A){this._placeholders&&this._placeholders.length&&(D.forEach(this._placeholders,function(S){S.unReplace(!0)}),this._placeholders=[]);this.headerMenu&&this.headerMenu.unBindDomNode(this.viewsHeaderNode);if(this.headerMenu=A)this.headerMenu.bindDomNode(this.viewsHeaderNode),this.headerMenu.getPlaceholders&&(this._placeholders=this.headerMenu.getPlaceholders(this.placeholderLabel))},
setHeaderMenu:function(A){N.deprecated("dojox.grid._Grid.setHeaderMenu(obj)","use dojox.grid._Grid.set('headerMenu', obj) instead.","2.0");this._setHeaderMenuAttr(A)},setupHeaderMenu:function(){this._placeholders&&this._placeholders.length&&D.forEach(this._placeholders,function(A){A._replaced&&A.unReplace(!0);A.replace(this.getColumnTogglingItems())},this)},_fetch:function(A){this.setScrollTop(0)},getItem:function(A){return null},showMessage:function(A){A?(this.messagesNode.innerHTML=A,this.messagesNode.style.display=
""):(this.messagesNode.innerHTML="",this.messagesNode.style.display="none")},_structureChanged:function(){this.buildViews();this.autoRender&&this._started&&this.render()},hasLayout:function(){return this.layout.cells.length},resize:function(A,S){this._pendingChangeSize=A;this._pendingResultSize=S;this.sizeChange()},_getPadBorder:function(){return this._padBorder=this._padBorder||G._getPadBorderExtents(this.domNode)},_getHeaderHeight:function(){var A=this.viewsHeaderNode.style,S="none"==A.display?
0:this.views.measureHeader();A.height=S+"px";this.views.normalizeHeaderNodeHeight();return S},_resize:function(A,S){A=A||this._pendingChangeSize;S=S||this._pendingResultSize;delete this._pendingChangeSize;delete this._pendingResultSize;if(this.domNode){var O=this.domNode.parentNode;if(O&&1==O.nodeType&&this.hasLayout()&&"hidden"!=O.style.visibility&&"none"!=O.style.display){var V=this._getPadBorder(),I=void 0;if(this._autoHeight)this.domNode.style.height="auto";else if("number"==typeof this.autoHeight){var g=
I=this._getHeaderHeight();g+=this.scroller.averageRowHeight*this.autoHeight;this.domNode.style.height=g+"px"}else this.domNode.clientHeight<=V.h&&(O==document.body?this.domNode.style.height=this.defaultHeight:this.height?this.domNode.style.height=this.height:this.fitTo="parent");S&&(A=S);!this._autoHeight&&A?(G.marginBox(this.domNode,A),this.height=this.domNode.style.height,delete this.fitTo):"parent"==this.fitTo&&(g=this._parentContentBoxHeight=0<this._parentContentBoxHeight?this._parentContentBoxHeight:
G._getContentBox(O).h,this.domNode.style.height=Math.max(0,g)+"px");A=D.some(this.views.views,function(C){return C.flexCells});this._autoHeight||0!==(g||G._getContentBox(this.domNode).h)?(this.viewsHeaderNode.style.display="block",A||void 0!==I||(I=this._getHeaderHeight())):this.viewsHeaderNode.style.display="none";A&&(I=void 0);this.adaptWidth();this.adaptHeight(I);this.postresize()}}},adaptWidth:function(){var A=!this.initialWidth&&this.autoWidth,S=A?0:this.domNode.clientWidth||this.domNode.offsetWidth-
this._getPadBorder().w;S=this.views.arrange(1,S);this.views.onEach("adaptWidth");A&&(this.domNode.style.width=S+"px")},adaptHeight:function(A){A=void 0===A?this._getHeaderHeight():A;var S=this._autoHeight?-1:Math.max(this.domNode.clientHeight-A,0)||0;this.views.onEach("setSize",[0,S]);this.views.onEach("adaptHeight");if(!this._autoHeight){var O=0,V=0,I=D.filter(this.views.views,function(g){(g=g.hasHScrollbar())?O++:V++;return!g});0<O&&0<V&&D.forEach(I,function(g){g.adaptHeight(!0)})}!0===this.autoHeight||
-1!=S||"number"==typeof this.autoHeight&&this.autoHeight>=this.get("rowCount")?this.scroller.windowHeight=S:this.scroller.windowHeight=Math.max(this.domNode.clientHeight-A,0)},startup:function(){this._started||(this.inherited(arguments),this.autoRender&&this.render())},render:function(){this.domNode&&this._started&&(this.hasLayout()?(this.update=this.defaultUpdate,this._render()):this.scroller.init(0,this.keepRows,this.rowsPerPage))},_render:function(){this.scroller.init(this.get("rowCount"),this.keepRows,
this.rowsPerPage);this.prerender();this.setScrollTop(0);this.postrender()},prerender:function(){this.keepRows=this._autoHeight?0:this.keepRows;this.scroller.setKeepInfo(this.keepRows);this.views.render();this._resize()},postrender:function(){this.postresize();this.focus.initFocusView();G.setSelectable(this.domNode,this.selectable)},postresize:function(){if(this._autoHeight){var A=Math.max(this.views.measureContent())+"px";this.viewsNode.style.height=A}},renderRow:function(A,S){this.views.renderRow(A,
S,this._skipRowRenormalize)},rowRemoved:function(A){this.views.rowRemoved(A)},invalidated:null,updating:!1,beginUpdate:function(){this.invalidated=[];this.updating=!0},endUpdate:function(){this.updating=!1;var A=this.invalidated,S;if(A.all)this.update();else if(void 0!=A.rowCount)this.updateRowCount(A.rowCount);else for(S in A)this.updateRow(Number(S));this.invalidated=[]},defaultUpdate:function(){this.domNode&&(this.updating?this.invalidated.all=!0:(this.lastScrollTop=this.scrollTop,this.prerender(),
this.scroller.invalidateNodes(),this.setScrollTop(this.lastScrollTop),this.postrender()))},update:function(){this.render()},updateRow:function(A){A=Number(A);this.updating?this.invalidated[A]=!0:(this.views.updateRow(A),this.scroller.rowHeightChanged(A))},updateRows:function(A,S){A=Number(A);S=Number(S);var O;if(this.updating)for(O=0;O<S;O++)this.invalidated[O+A]=!0;else{for(O=0;O<S;O++)this.views.updateRow(O+A,this._skipRowRenormalize);this.scroller.rowHeightChanged(A)}},updateRowCount:function(A){this.updating?
this.invalidated.rowCount=A:(this.rowCount=A,this._setAutoHeightAttr(this.autoHeight,!0),this.layout.cells.length&&this.scroller.updateRowCount(A),this.layout.cells.length&&this.setScrollTop(this.scrollTop),this._resize())},updateRowStyles:function(A){this.views.updateRowStyles(A)},getRowNode:function(A){if(!this.focus.focusView||this.focus.focusView instanceof w)for(var S=0,O;O=this.views.views[S];S++){if(!(O instanceof w))return O.rowNodes[A]}else return this.focus.focusView.rowNodes[A];return null},
rowHeightChanged:function(A){this.views.renormalizeRow(A);this.scroller.rowHeightChanged(A)},fastScroll:!0,delayScroll:!1,scrollRedrawThreshold:H("ie")?100:50,scrollTo:function(A){if(this.fastScroll){var S=Math.abs(this.lastScrollTop-A);this.lastScrollTop=A;if(S>this.scrollRedrawThreshold||this.delayScroll){this.delayScroll=!0;this.scrollTop=A;this.views.setScrollTop(A);this._pendingScroll&&window.clearTimeout(this._pendingScroll);var O=this;this._pendingScroll=window.setTimeout(function(){delete O._pendingScroll;
O.finishScrollJob()},200)}else this.setScrollTop(A)}else this.setScrollTop(A)},finishScrollJob:function(){this.delayScroll=!1;this.setScrollTop(this.scrollTop)},setScrollTop:function(A){this.scroller.scroll(this.views.setScrollTop(A))},scrollToRow:function(A){this.setScrollTop(this.scroller.findScrollTop(A)+1)},styleRowNode:function(A,S){S&&this.rows.styleRowNode(A,S)},_mouseOut:function(A){this.rows.setOverRow(-2)},getCell:function(A){return this.layout.cells[A]},setCellWidth:function(A,S){this.getCell(A).unitWidth=
S},getCellName:function(A){return"Cell "+A.index},canSort:function(A){},sort:function(){},getSortAsc:function(A){A=void 0==A?this.sortInfo:A;return 0<A},getSortIndex:function(A){A=void 0==A?this.sortInfo:A;return Math.abs(A)-1},setSortIndex:function(A,S){var O=A+1;void 0!=S?O*=S?1:-1:this.getSortIndex()==A&&(O=-this.sortInfo);this.setSortInfo(O)},setSortInfo:function(A){this.canSort(A)&&(this.sortInfo=A,this.sort(),this.update())},doKeyEvent:function(A){A.dispatch="do"+A.type;this.onKeyEvent(A)},
_dispatch:function(A,S){return A in this?this[A](S):!1},dispatchKeyEvent:function(A){this._dispatch(A.dispatch,A)},dispatchContentEvent:function(A){this.edit.dispatchEvent(A)||A.sourceView.dispatchContentEvent(A)||this._dispatch(A.dispatch,A)},dispatchHeaderEvent:function(A){A.sourceView.dispatchHeaderEvent(A)||this._dispatch("doheader"+A.type,A)},dokeydown:function(A){this.onKeyDown(A)},doclick:function(A){if(A.cellNode)this.onCellClick(A);else this.onRowClick(A)},dodblclick:function(A){if(A.cellNode)this.onCellDblClick(A);
else this.onRowDblClick(A)},docontextmenu:function(A){if(A.cellNode)this.onCellContextMenu(A);else this.onRowContextMenu(A)},doheaderclick:function(A){if(A.cellNode)this.onHeaderCellClick(A);else this.onHeaderClick(A)},doheaderdblclick:function(A){if(A.cellNode)this.onHeaderCellDblClick(A);else this.onHeaderDblClick(A)},doheadercontextmenu:function(A){if(A.cellNode)this.onHeaderCellContextMenu(A);else this.onHeaderContextMenu(A)},doStartEdit:function(A,S){this.onStartEdit(A,S)},doApplyCellEdit:function(A,
S,O){this.onApplyCellEdit(A,S,O)},doCancelEdit:function(A){this.onCancelEdit(A)},doApplyEdit:function(A){this.onApplyEdit(A)},addRow:function(){this.updateRowCount(this.get("rowCount")+1)},removeSelectedRows:function(){this.allItemsSelected?this.updateRowCount(0):this.updateRowCount(Math.max(0,this.get("rowCount")-this.selection.getSelected().length));this.selection.clear()}});z.markupFactory=function(A,S,O,V){var I=function(g){g=G.attr(g,"width")||"auto";"auto"!=g&&"em"!=g.slice(-2)&&"%"!=g.slice(-1)&&
(g=parseInt(g,10)+"px");return g};A.structure||"table"!=S.nodeName.toLowerCase()||(A.structure=T("\x3e colgroup",S).map(function(g){var C=G.attr(g,"span");C={noscroll:"true"==G.attr(g,"noscroll")?!0:!1,__span:C?parseInt(C,10):1,cells:[]};G.hasAttr(g,"width")&&(C.width=I(g));return C}),A.structure.length||A.structure.push({__span:Infinity,cells:[]}),T("thead \x3e tr",S).forEach(function(g,C){var B=0,J=0,M,Q=null;T("\x3e th",g).map(function(R){Q?B>=M+Q.__span&&(J++,M+=Q.__span,Q=A.structure[J]):(M=
0,Q=A.structure[0]);var X={name:q.trim(G.attr(R,"name")||R.innerHTML),colSpan:parseInt(G.attr(R,"colspan")||1,10),type:q.trim(G.attr(R,"cellType")||""),id:q.trim(G.attr(R,"id")||"")};B+=X.colSpan;var W=G.attr(R,"rowspan");W&&(X.rowSpan=W);G.hasAttr(R,"width")&&(X.width=I(R));G.hasAttr(R,"relWidth")&&(X.relWidth=window.parseInt(G.attr(R,"relWidth"),10));G.hasAttr(R,"hidden")&&(X.hidden="true"==G.attr(R,"hidden")||!0===G.attr(R,"hidden"));V&&V(R,X);X.type=X.type?q.getObject(X.type):v.grid.cells.Cell;
X.type&&X.type.markupFactory&&X.type.markupFactory(R,X);Q.cells[C]||(Q.cells[C]=[]);Q.cells[C].push(X)})}));return new O(A,S)};return z})},"dojox/grid/_Events":function(){define(["dojo/keys","dojo/dom-class","dojo/_base/declare","dojo/_base/event","dojo/_base/sniff"],function(N,v,z,y,m){return z("dojox.grid._Events",null,{cellOverClass:"dojoxGridCellOver",onKeyEvent:function(c){this.dispatchKeyEvent(c)},onContentEvent:function(c){this.dispatchContentEvent(c)},onHeaderEvent:function(c){this.dispatchHeaderEvent(c)},
onStyleRow:function(c){c.customClasses+=(c.odd?" dojoxGridRowOdd":"")+(c.selected?" dojoxGridRowSelected":"")+(c.over?" dojoxGridRowOver":"");this.focus.styleRow(c);this.edit.styleRow(c)},onKeyDown:function(c){if(!c.altKey&&!c.metaKey)switch(c.keyCode){case N.ESCAPE:this.edit.cancel();break;case N.ENTER:if(!this.edit.isEditing()){var f=this.focus.getHeaderIndex();if(0<=f){this.setSortIndex(f);break}else this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(c),c.shiftKey);y.stop(c)}c.shiftKey||
(f=this.edit.isEditing(),this.edit.apply(),f||this.edit.setEditCell(this.focus.cell,this.focus.rowIndex));this.edit.isEditing()||((this.focus.focusView||this.views.views[0]).content.decorateEvent(c),this.onRowClick(c),y.stop(c));break;case N.SPACE:this.edit.isEditing()||(f=this.focus.getHeaderIndex(),0<=f?this.setSortIndex(f):(this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(c),c.shiftKey),this.focus._focusifyCellNode(!0),this.focus.setFocusCell(this.focus.cell,this.focus.rowIndex),y.stop(c)));
break;case N.TAB:this.focus[c.shiftKey?"previousKey":"nextKey"](c);break;case N.LEFT_ARROW:case N.RIGHT_ARROW:if(!this.edit.isEditing()){var a=c.keyCode;y.stop(c);f=this.focus.getHeaderIndex();0<=f&&c.shiftKey&&c.ctrlKey?this.focus.colSizeAdjust(c,f,5*(a==N.LEFT_ARROW?-1:1)):(c=a==N.LEFT_ARROW?1:-1,this.isLeftToRight()&&(c*=-1),this.focus.move(0,c))}break;case N.UP_ARROW:this.edit.isEditing()||0===this.focus.rowIndex||(y.stop(c),this.focus.move(-1,0));break;case N.DOWN_ARROW:this.edit.isEditing()||
this.focus.rowIndex+1==this.rowCount||(y.stop(c),this.focus.move(1,0));break;case N.PAGE_UP:this.edit.isEditing()||0===this.focus.rowIndex||(y.stop(c),this.focus.rowIndex!=this.scroller.firstVisibleRow+1?this.focus.move(this.scroller.firstVisibleRow-this.focus.rowIndex,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex-1)),this.focus.move(this.scroller.firstVisibleRow-this.scroller.lastVisibleRow+1,0)));break;case N.PAGE_DOWN:this.edit.isEditing()||this.focus.rowIndex+1==this.rowCount||
(y.stop(c),this.focus.rowIndex!=this.scroller.lastVisibleRow-1?this.focus.move(this.scroller.lastVisibleRow-this.focus.rowIndex-1,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex+1)),this.focus.move(this.scroller.lastVisibleRow-this.scroller.firstVisibleRow-1,0)))}},onMouseOver:function(c){-1==c.rowIndex?this.onHeaderCellMouseOver(c):this.onCellMouseOver(c)},onMouseOut:function(c){-1==c.rowIndex?this.onHeaderCellMouseOut(c):this.onCellMouseOut(c)},onMouseDown:function(c){-1==
c.rowIndex?this.onHeaderCellMouseDown(c):this.onCellMouseDown(c)},onMouseOverRow:function(c){this.rows.isOver(c.rowIndex)||(this.rows.setOverRow(c.rowIndex),-1==c.rowIndex?this.onHeaderMouseOver(c):this.onRowMouseOver(c))},onMouseOutRow:function(c){if(this.rows.isOver(-1))this.onHeaderMouseOut(c);else this.rows.isOver(-2)||(this.rows.setOverRow(-2),this.onRowMouseOut(c))},onMouseDownRow:function(c){if(-1!=c.rowIndex)this.onRowMouseDown(c)},onCellMouseOver:function(c){c.cellNode&&v.add(c.cellNode,
this.cellOverClass)},onCellMouseOut:function(c){c.cellNode&&v.remove(c.cellNode,this.cellOverClass)},onCellMouseDown:function(c){},onCellClick:function(c){this._click[0]=this._click[1];this._click[1]=c;this.edit.isEditCell(c.rowIndex,c.cellIndex)||this.focus.setFocusCell(c.cell,c.rowIndex);1<this._click.length&&null==this._click[0]&&this._click.shift();this.onRowClick(c)},onCellDblClick:function(c){var f=1<this._click.length&&m("ie")?this._click[1]:1<this._click.length&&this._click[0].rowIndex!=this._click[1].rowIndex?
this._click[0]:c;this.focus.setFocusCell(f.cell,f.rowIndex);this.edit.setEditCell(f.cell,f.rowIndex);this.onRowDblClick(c)},onCellContextMenu:function(c){this.onRowContextMenu(c)},onCellFocus:function(c,f){this.edit.cellFocus(c,f)},onRowClick:function(c){this.edit.rowClick(c);this.selection.clickSelectEvent(c)},onRowDblClick:function(c){},onRowMouseOver:function(c){},onRowMouseOut:function(c){},onRowMouseDown:function(c){},onRowContextMenu:function(c){y.stop(c)},onHeaderMouseOver:function(c){},onHeaderMouseOut:function(c){},
onHeaderCellMouseOver:function(c){c.cellNode&&v.add(c.cellNode,this.cellOverClass)},onHeaderCellMouseOut:function(c){c.cellNode&&v.remove(c.cellNode,this.cellOverClass)},onHeaderCellMouseDown:function(c){},onHeaderClick:function(c){},onHeaderCellClick:function(c){this.setSortIndex(c.cell.index);this.onHeaderClick(c)},onHeaderDblClick:function(c){},onHeaderCellDblClick:function(c){this.onHeaderDblClick(c)},onHeaderCellContextMenu:function(c){this.onHeaderContextMenu(c)},onHeaderContextMenu:function(c){this.headerMenu||
y.stop(c)},onStartEdit:function(c,f){},onApplyCellEdit:function(c,f,a){},onCancelEdit:function(c){},onApplyEdit:function(c){},onCanSelect:function(c){return!0},onCanDeselect:function(c){return!0},onSelected:function(c){this.updateRowStyles(c)},onDeselected:function(c){this.updateRowStyles(c)},onSelectionChanged:function(){}})})},"dojox/grid/_Scroller":function(){define(["dijit/registry","dojo/_base/declare","dojo/_base/lang","./util","dojo/_base/html"],function(N,v,z,y,m){var c=function(a){a&&dojo.forEach(N.toArray(),
function(n){n.domNode&&m.isDescendant(n.domNode,a,!0)&&n.destroy()})},f=function(a,n){for(var l=[],b=0,u;u=a.childNodes[b];){b++;var w=m.byId(u);(w&&w.tagName?w.tagName.toLowerCase():"")==n&&l.push(u)}return l};return v("dojox.grid._Scroller",null,{constructor:function(a){this.setContentNodes(a);this.pageHeights=[];this.pageNodes=[];this.stack=[]},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,
lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(a,n,l){switch(arguments.length){case 3:this.rowsPerPage=l;case 2:this.keepRows=n;case 1:this.rowCount=a}this.defaultPageHeight=(0<this.grid.rowHeight?this.grid.rowHeight:this.defaultRowHeight)*this.rowsPerPage;this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);this.setKeepInfo(this.keepRows);this.invalidate();this.scrollboxNode&&(this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=z.hitch(this,
"onscroll"))},_getPageCount:function(a,n){return a?Math.ceil(a/n)||1:0},destroy:function(){this.invalidateNodes();delete this.contentNodes;delete this.contentNode;delete this.scrollboxNode},setKeepInfo:function(a){this.keepPages=(this.keepRows=a)?Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2):this.keepPages},setContentNodes:function(a){this.colCount=(this.contentNodes=a)?this.contentNodes.length:0;this.pageNodes=[];for(a=0;a<this.colCount;a++)this.pageNodes[a]=[]},getDefaultNodes:function(){return this.pageNodes[0]||
[]},invalidate:function(){this._invalidating=!0;this.invalidateNodes();this.pageHeights=[];this.height=this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0;this.resize();this._invalidating=!1},updateRowCount:function(a){this.invalidateNodes();this.rowCount=a;a=this.pageCount;0===a&&(this.height=1);this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);if(this.pageCount<a)for(--a;a>=this.pageCount;a--)this.height-=this.getPageHeight(a),delete this.pageHeights[a];
else this.pageCount>a&&(this.height+=this.defaultPageHeight*(this.pageCount-a-1)+this.calcLastPageHeight());this.resize()},pageExists:function(a){return!!this.getDefaultPageNode(a)},measurePage:function(a){return this.grid.rowHeight?((a+1)*this.rowsPerPage>this.rowCount?this.rowCount-a*this.rowsPerPage:this.rowsPerPage)*this.grid.rowHeight:(a=this.getDefaultPageNode(a))&&a.innerHTML?a.offsetHeight:void 0},positionPage:function(a,n){for(var l=0;l<this.colCount;l++)this.pageNodes[l][a].style.top=n+
"px"},repositionPages:function(a){for(var n=this.getDefaultNodes(),l=0,b=0;b<this.stack.length;b++)l=Math.max(this.stack[b],l);var u=(b=n[a])?this.getPageNodePosition(b)+this.getPageHeight(a):0;for(a+=1;a<=l;a++){if(b=n[a]){if(this.getPageNodePosition(b)==u)break;this.positionPage(a,u)}u+=this.getPageHeight(a)}},installPage:function(a){for(var n=0;n<this.colCount;n++)this.contentNodes[n].appendChild(this.pageNodes[n][a])},preparePage:function(a,n){n=n?this.popPage():null;for(var l=0;l<this.colCount;l++){var b=
this.pageNodes[l],u=null===n?this.createPageNode():this.invalidatePageNode(n,b);u.pageIndex=a;b[a]=u}},renderPage:function(a){var n=[],l;for(l=0;l<this.colCount;l++)n[l]=this.pageNodes[l][a];l=0;for(a*=this.rowsPerPage;l<this.rowsPerPage&&a<this.rowCount;l++,a++)this.renderRow(a,n)},removePage:function(a){var n=0;for(a*=this.rowsPerPage;n<this.rowsPerPage;n++,a++)this.removeRow(a)},destroyPage:function(a){for(var n=0;n<this.colCount;n++){var l=this.invalidatePageNode(a,this.pageNodes[n]);l&&m.destroy(l)}},
pacify:function(a){},pacifying:!1,pacifyTicks:200,setPacifying:function(a){this.pacifying!=a&&(this.pacifying=a,this.pacify(this.pacifying))},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var a=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;this.setPacifying(!0);this.startPacify();return a},endPacify:function(){this.setPacifying(!1)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight);for(var a=0;a<this.colCount;a++)y.setStyleHeightPx(this.contentNodes[a],
Math.max(1,this.height));a=!this._invalidating;if(!a){var n=this.grid.get("autoHeight");"number"==typeof n&&n<=Math.min(this.rowsPerPage,this.rowCount)&&(a=!0)}a&&this.needPage(this.page,this.pageTop);a=this.page<this.pageCount-1?this.rowsPerPage:this.rowCount%this.rowsPerPage||this.rowsPerPage;n=this.getPageHeight(this.page);this.averageRowHeight=0<n&&0<a?n/a:0},calcLastPageHeight:function(){if(!this.pageCount)return 0;var a=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;
return this.pageHeights[this.pageCount-1]=a},updateContentHeight:function(a){this.height+=a;this.resize()},updatePageHeight:function(a,n,l){if(this.pageExists(a)){var b=this.getPageHeight(a),u=this.measurePage(a);void 0===u&&(u=b);this.pageHeights[a]=u;if(b!=u){this.updateContentHeight(u-b);var w=this.grid.get("autoHeight");"number"==typeof w&&w>this.rowCount||!0===w&&!n?l?(n=this.grid.viewsNode.style,n.height=parseInt(n.height)+u-b+"px",this.repositionPages(a)):this.grid.sizeChange():this.repositionPages(a)}return u}return 0},
rowHeightChanged:function(a,n){this.updatePageHeight(Math.floor(a/this.rowsPerPage),!1,n)},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var a=document.createElement("div");m.attr(a,"role","presentation");a.style.position="absolute";a.style[this.grid.isLeftToRight()?"left":"right"]="0";return a},getPageHeight:function(a){a=this.pageHeights[a];return void 0!==a?a:this.defaultPageHeight},pushPage:function(a){return this.stack.push(a)},
popPage:function(){return this.stack.shift()},findPage:function(a){for(var n=0,l=0,b=0;n<this.pageCount&&!(b=this.getPageHeight(n),l+b>=a);n++,l+=b);this.page=n;this.pageTop=l},buildPage:function(a,n,l){this.preparePage(a,n);this.positionPage(a,l);this.installPage(a);this.renderPage(a);this.pushPage(a)},needPage:function(a,n){var l=this.getPageHeight(a);this.pageExists(a)?this.positionPage(a,n):(this.buildPage(a,!this.grid._autoHeight&&this.keepPages&&this.stack.length>=this.keepPages,n),l=this.updatePageHeight(a,
!0));return l},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(a){this.grid.scrollTop=a;if(this.colCount){this.startPacify();this.findPage(a);for(var n=this.height,l=this.getScrollBottom(a),b=this.page,u=this.pageTop;b<this.pageCount&&(0>l||u<l);b++)u+=this.needPage(b,u);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,a);this.lastVisibleRow=this.getLastVisibleRow(b-1,u,l);n!=this.height&&this.repositionPages(b-1);this.endPacify()}},getScrollBottom:function(a){return 0<=
this.windowHeight?a+this.windowHeight:-1},processNodeEvent:function(a,n){for(var l=a.target;l&&l!=n&&l.parentNode&&l.parentNode.parentNode!=n;)l=l.parentNode;if(!l||!l.parentNode||l.parentNode.parentNode!=n)return!1;a.topRowIndex=l.parentNode.pageIndex*this.rowsPerPage;n=a.topRowIndex;a:{var b=0;for(var u,w=l.parentNode;u=w.childNodes[b++];)if(u==l){--b;break a}b=-1}a.rowIndex=n+b;a.rowTarget=l;return!0},processEvent:function(a){return this.processNodeEvent(a,this.contentNode)},renderRow:function(a,
n){},removeRow:function(a){},getDefaultPageNode:function(a){return this.getDefaultNodes()[a]},positionPageNode:function(a,n){},getPageNodePosition:function(a){return a.offsetTop},invalidatePageNode:function(a,n){var l=n[a];l&&(delete n[a],this.removePage(a,l),c(l),l.innerHTML="");return l},getPageRow:function(a){return a*this.rowsPerPage},getLastPageRow:function(a){return Math.min(this.rowCount,this.getPageRow(a+1))-1},getFirstVisibleRow:function(a,n,l){if(!this.pageExists(a))return 0;var b=this.getPageRow(a),
u=this.getDefaultNodes();a=f(u[a],"div");u=0;for(var w=a.length;u<w&&n<l;u++,b++)n+=a[u].offsetHeight;return b?b-1:b},getLastVisibleRow:function(a,n,l){if(!this.pageExists(a))return 0;var b=this.getDefaultNodes(),u=this.getLastPageRow(a);a=f(b[a],"div");for(b=a.length-1;0<=b&&n>l;b--,u--)n-=a[b].offsetHeight;return u+1},findTopRow:function(a){var n=this.getDefaultNodes();n=f(n[this.page],"div");for(var l=0,b=n.length,u=this.pageTop,w;l<b;l++)if(w=n[l].offsetHeight,u+=w,u>=a)return this.offset=w-(u-
a),l+this.page*this.rowsPerPage;return-1},findScrollTop:function(a){var n=Math.floor(a/this.rowsPerPage),l=0,b;for(b=0;b<n;b++)l+=this.getPageHeight(b);this.pageTop=l;this.page=n;this.needPage(n,this.pageTop);b=this.getDefaultNodes();var u=f(b[n],"div");n=a-this.rowsPerPage*n;b=0;for(a=u.length;b<a&&b<n;b++)l+=u[b].offsetHeight;return l},dummy:0})})},"dojox/grid/util":function(){define(["../main","dojo/_base/lang","dojo/dom","dojo/_base/sniff"],function(N,v,z,y){var m=v.getObject("grid.util",!0,N);
m.na="...";m.rowIndexTag="gridRowIndex";m.gridViewTag="gridView";m.fire=function(c,f,a){function n(p,h){if(null==p)return null;var r=h?"Width":"Height";return p["scroll"+r]>p["client"+r]?p:n(p.parentNode,h)}var l;if(y("webkit")&&"focus"==f){var b=c.domNode?c.domNode:c;if(l=n(b,!1))var u=l.scrollTop;if(b=n(b,!0))var w=b.scrollLeft}var e=c&&f&&c[f];c=e&&(a?e.apply(c,a):c[f]());y("webkit")&&"focus"==f&&(l&&(l.scrollTop=u),b&&(b.scrollLeft=w));return c};m.setStyleHeightPx=function(c,f){if(0<=f){var a=
c.style;f+="px";c&&a.height!=f&&(a.height=f)}};m.mouseEvents="mouseover mouseout mousedown mouseup click dblclick contextmenu".split(" ");m.keyEvents=["keyup","keydown","keypress"];m.funnelEvents=function(c,f,a,n){n=n?n:m.mouseEvents.concat(m.keyEvents);for(var l=0,b=n.length;l<b;l++)f.connect(c,"on"+n[l],a)};m.removeNode=function(c){(c=z.byId(c))&&c.parentNode&&c.parentNode.removeChild(c);return c};m.arrayCompare=function(c,f){for(var a=0,n=c.length;a<n;a++)if(c[a]!=f[a])return!1;return c.length==
f.length};m.arrayInsert=function(c,f,a){c.length<=f?c[f]=a:c.splice(f,0,a)};m.arrayRemove=function(c,f){c.splice(f,1)};m.arraySwap=function(c,f,a){var n=c[f];c[f]=c[a];c[a]=n};return m})},"dojox/grid/_Layout":function(){define("dojo/_base/kernel ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/dom-geometry ./cells ./_RowSelector".split(" "),function(N,v,z,y,m,c){return z("dojox.grid._Layout",null,{constructor:function(f){this.grid=f},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(f,
a,n,l,b){var u=this.structure[f].cells[0],w=this.structure[a].cells[0],e=null,p=e=0;f=0;for(var h;h=u[f];f++)if(h.index==n){e=f;break}e=u.splice(e,1)[0];e.view=this.grid.views.views[a];f=0;for(h=null;h=w[f];f++)if(h.index==l){p=f;break}b||(p+=1);w.splice(p,0,e);if(n=this.grid.getCell(this.grid.getSortIndex()))n._currentlySorted=this.grid.getSortAsc();this.cells=[];for(f=n=0;a=this.structure[f];f++)for(l=0;b=a.cells[l];l++)for(u=0;h=b[u];u++)h.index=n,this.cells.push(h),"_currentlySorted"in h&&(w=
n+1,w*=h._currentlySorted?1:-1,this.grid.sortInfo=w,delete h._currentlySorted),n++;y.forEach(this.cells,function(r){var d=r.markup[2].split(" ");parseInt(d[1].substring(5))!=r.index&&(d[1]='idx\x3d"'+r.index+'"',r.markup[2]=d.join(" "))});this.grid.setupHeaderMenu()},setColumnVisibility:function(f,a){f=this.cells[f];if(f.hidden==a){f.hidden=!a;a=f.view;var n=a.viewWidth;n&&"auto"!=n&&(a._togglingColumn=c.getMarginBox(f.getHeaderNode()).w||0);a.update();return!0}return!1},addCellDef:function(f,a,n){var l=
this,b=function(u){var w=0;1<u.colSpan?w=0:(w=u.width||l._defaultCellProps.width||l.defaultWidth,isNaN(w)||(w+="em"));return w};f={grid:this.grid,subrow:f,layoutIndex:a,index:this.cells.length};if(n&&n instanceof v.grid.cells._Base)return a=m.clone(n),f.unitWidth=b(a._props),a=m.mixin(a,this._defaultCellProps,n._props,f);a=n.type||n.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||v.grid.cells.Cell;m.isString(a)&&(a=m.getObject(a));f.unitWidth=b(n);return new a(m.mixin({},this._defaultCellProps,
n,f))},addRowDef:function(f,a){for(var n=[],l=0,b=0,u=!0,w=0,e;e=a[w];w++)e=this.addCellDef(f,w,e),n.push(e),this.cells.push(e),u&&e.relWidth?l+=e.relWidth:e.width&&(e=e.width,"string"==typeof e&&"%"==e.slice(-1)?b+=window.parseInt(e,10):"auto"==e&&(u=!1));l&&u&&y.forEach(n,function(p){p.relWidth&&(p.width=p.unitWidth=p.relWidth/l*(100-b)+"%")});return n},addRowsDef:function(f){var a=[];if(m.isArray(f))if(m.isArrayLike(f[0]))for(var n=0,l;f&&(l=f[n]);n++)a.push(this.addRowDef(n,l));else a.push(this.addRowDef(0,
f));return a},addViewDef:function(f){this._defaultCellProps=f.defaultCell||{};f.width&&"auto"==f.width&&delete f.width;return m.mixin({},f,{cells:this.addRowsDef(f.rows||f.cells)})},setStructure:function(f){this.fieldIndex=0;this.cells=[];var a=this.structure=[];if(this.grid.rowSelector){var n={type:v._scopeName+".grid._RowSelector"};if(m.isString(this.grid.rowSelector)){var l=this.grid.rowSelector;"false"==l?n=null:"true"!=l&&(n.width=l)}else this.grid.rowSelector||(n=null);n&&a.push(this.addViewDef(n))}var b=
function(p){return"name"in p||"field"in p||"get"in p};n=function(p){return m.isArray(p)&&(m.isArray(p[0])||b(p[0]))?!0:!1};l=function(p){return null!==p&&m.isObject(p)&&("cells"in p||"rows"in p||"type"in p&&!b(p))};if(m.isArrayLike(f)){for(var u=!1,w=0,e;e=f[w];w++)if(l(e)){u=!0;break}if(u)for(w=0;e=f[w];w++)n(e)?a.push(this.addViewDef({cells:e})):l(e)&&a.push(this.addViewDef(e));else a.push(this.addViewDef({cells:f}))}else l(f)&&a.push(this.addViewDef(f));this.cellCount=this.cells.length;this.grid.setupHeaderMenu()}})})},
"dojox/grid/cells":function(){define(["../main","./cells/_base"],function(N){return N.grid.cells})},"dojox/grid/cells/_base":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/event dojo/_base/connect dojo/_base/array dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dijit/_Widget ../util".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u){var w=v("dojox.grid._DeferredTextWidget",b,{deferred:null,_destroyOnRemove:!0,postCreate:function(){this.deferred&&this.deferred.addBoth(z.hitch(this,
function(d){this.domNode&&(this.domNode.innerHTML=d)}))}}),e=function(){setTimeout(z.hitch.apply(N,arguments),0)},p=v("dojox.grid.cells._Base",null,{styles:"",classes:"",editable:!1,alwaysEditing:!1,formatter:null,defaultValue:"...",value:null,hidden:!1,noresize:!1,draggable:!0,_valueProp:"value",_formatPending:!1,constructor:function(d){this._props=d||{};z.mixin(this,d);void 0===this.draggable&&(this.draggable=!0)},_defaultFormat:function(d,x){var D=this.grid.formatterScope||this,q=this.formatter;
q&&D&&"string"==typeof q&&(q=this.formatter=D[q]);d=d!=this.defaultValue&&q?q.apply(D,x):d;if("undefined"==typeof d)return this.defaultValue;d&&d.addBoth&&(d=new w({deferred:d},l.create("span",{innerHTML:this.defaultValue})));return d&&d.declaredClass&&d.startup?"\x3cdiv class\x3d'dojoxGridStubNode' linkWidget\x3d'"+d.id+"' cellIdx\x3d'"+this.index+"'\x3e"+this.defaultValue+"\x3c/div\x3e":d},format:function(d,x){var D=this.grid.edit.info;(x=this.get?this.get(d,x):this.value||this.defaultValue)&&x.replace&&
this.grid.escapeHTMLInData&&(x=x.replace(/&(?![a-z0-9]{1,8};)/ig,"\x26amp;").replace(/</g,"\x26lt;"));return this.editable&&(this.alwaysEditing||D.rowIndex==d&&D.cell==this)?this.formatEditing(D.value?D.value:x,d):this._defaultFormat(x,[x,d,this])},formatEditing:function(d,x){},getNode:function(d){return this.view.getCellNode(d,this.index)},getHeaderNode:function(){return this.view.getHeaderCellNode(this.index)},getEditNode:function(d){return(this.getNode(d)||0).firstChild||0},canResize:function(){var d=
this.unitWidth;return d&&"auto"!==d},isFlex:function(){var d=this.unitWidth;return d&&z.isString(d)&&("auto"==d||"%"==d.slice(-1))},applyEdit:function(d,x){this.getNode(x)&&this.grid.edit.applyCellEdit(d,this,x)},cancelEdit:function(d){this.grid.doCancelEdit(d)},_onEditBlur:function(d){this.grid.edit.isEditCell(d,this.index)&&this.grid.edit.apply()},registerOnBlur:function(d,x){this.commitOnBlur&&m.connect(d,"onblur",function(D){setTimeout(z.hitch(this,"_onEditBlur",x),250)})},needFormatNode:function(d,
x){this._formatPending=!0;e(this,"_formatNode",d,x)},cancelFormatNode:function(){this._formatPending=!1},_formatNode:function(d,x){this._formatPending&&(this._formatPending=!1,f("ie")||a.setSelectable(this.grid.domNode,!0),this.formatNode(this.getEditNode(x),d,x))},formatNode:function(d,x,D){f("ie")?e(this,"focus",D,d):this.focus(D,d)},dispatchEvent:function(d,x){if(d in this)return this[d](x)},getValue:function(d){return this.getEditNode(d)[this._valueProp]},setValue:function(d,x){(d=this.getEditNode(d))&&
(d[this._valueProp]=x)},focus:function(d,x){d=x||this.getEditNode(d);try{u.fire(d,"focus"),u.fire(d,"select")}catch(D){}},save:function(d){this.value=this.value||this.getValue(d)},restore:function(d){this.setValue(d,this.value)},_finish:function(d){a.setSelectable(this.grid.domNode,!1);this.cancelFormatNode()},apply:function(d){this.applyEdit(this.getValue(d),d);this._finish(d)},cancel:function(d){this.cancelEdit(d);this._finish(d)}});p.markupFactory=function(d,x){var D=z.trim(n.get(d,"formatter")||
"");D&&(x.formatter=z.getObject(D)||D);if(D=z.trim(n.get(d,"get")||""))x.get=z.getObject(D);D=function(q,H,t){var G=z.trim(n.get(d,q)||"");G&&(H[t||q]="false"!=G.toLowerCase())};D("sortDesc",x);D("editable",x);D("alwaysEditing",x);D("noresize",x);D("draggable",x);if(D=z.trim(n.get(d,"loadingText")||n.get(d,"defaultValue")||""))x.defaultValue=D;D=function(q,H,t){var G=z.trim(n.get(d,q)||"")||void 0;G&&(H[t||q]=G)};D("styles",x);D("headerStyles",x);D("cellStyles",x);D("classes",x);D("headerClasses",
x);D("cellClasses",x)};var h=p.Cell=v("dojox.grid.cells.Cell",p,{constructor:function(){this.keyFilter=this.keyFilter},keyFilter:null,formatEditing:function(d,x){this.needFormatNode(d,x);d&&d.replace&&(d=d.replace(/"/g,"\x26quot;"));return'\x3cinput class\x3d"dojoxGridInput" type\x3d"text" value\x3d"'+d+'"\x3e'},formatNode:function(d,x,D){this.inherited(arguments);this.registerOnBlur(d,D)},doKey:function(d){this.keyFilter&&-1==String.fromCharCode(d.charCode).search(this.keyFilter)&&y.stop(d)},_finish:function(d){this.inherited(arguments);
var x=this.getEditNode(d);try{u.fire(x,"blur")}catch(D){}}});h.markupFactory=function(d,x){p.markupFactory(d,x);if(d=z.trim(n.get(d,"keyFilter")||""))x.keyFilter=new RegExp(d)};(p.RowIndex=v("dojox.grid.cells.RowIndex",h,{name:"Row",postscript:function(){this.editable=!1},get:function(d){return d+1}})).markupFactory=function(d,x){h.markupFactory(d,x)};(p.Select=v("dojox.grid.cells.Select",h,{options:null,values:null,returnIndex:-1,constructor:function(d){this.values=this.values||this.options},formatEditing:function(d,
x){this.needFormatNode(d,x);x=['\x3cselect class\x3d"dojoxGridSelect"\x3e'];for(var D=0,q,H;void 0!==(q=this.options[D])&&void 0!==(H=this.values[D]);D++)H=H.replace?H.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):H,q=q.replace?q.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):q,x.push("\x3coption",d==H?" selected":"",' value\x3d"'+H+'"',"\x3e",q,"\x3c/option\x3e");x.push("\x3c/select\x3e");return x.join("")},_defaultFormat:function(d,x){var D=this.inherited(arguments);if(!this.formatter&&this.values&&
this.options){var q=c.indexOf(this.values,D);0<=q&&(D=this.options[q])}return D},getValue:function(d){var x=this.getEditNode(d);if(x)return d=x.selectedIndex,x=x.options[d],-1<this.returnIndex?d:x.value||x.innerHTML}})).markupFactory=function(d,x){h.markupFactory(d,x);var D=z.trim(n.get(d,"options")||"");if(D){var q=D.split(",");q[0]!=D&&(x.options=q)}if(d=z.trim(n.get(d,"values")||""))D=d.split(","),D[0]!=d&&(x.values=D)};var r=p.AlwaysEdit=v("dojox.grid.cells.AlwaysEdit",h,{alwaysEditing:!0,_formatNode:function(d,
x){this.formatNode(this.getEditNode(x),d,x)},applyStaticValue:function(d){var x=this.grid.edit;x.applyCellEdit(this.getValue(d),this,d);x.start(this,d,!0)}});r.markupFactory=function(d,x){h.markupFactory(d,x)};(p.Bool=v("dojox.grid.cells.Bool",r,{_valueProp:"checked",formatEditing:function(d,x){return'\x3cinput class\x3d"dojoxGridInput" type\x3d"checkbox"'+(d?' checked\x3d"checked"':"")+' style\x3d"width: auto" /\x3e'},doclick:function(d){"INPUT"==d.target.tagName&&this.applyStaticValue(d.rowIndex)}})).markupFactory=
function(d,x){r.markupFactory(d,x)};return p})},"dojox/grid/_RowSelector":function(){define(["dojo/_base/declare","./_View"],function(N,v){return N("dojox.grid._RowSelector",v,{defaultWidth:"2em",noscroll:!0,padBorderWidth:2,buildRendering:function(){this.inherited("buildRendering",arguments);this.scrollboxNode.style.overflow="hidden";this.headerNode.style.visibility="hidden"},getWidth:function(){return this.viewWidth||this.defaultWidth},buildRowContent:function(z,y){y.innerHTML='\x3ctable class\x3d"dojoxGridRowbarTable" style\x3d"width:'+
(this.contentWidth||0)+'px;height:1px;" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctr\x3e\x3ctd class\x3d"dojoxGridRowbarInner"\x3e\x26nbsp;\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e'},renderHeader:function(){},updateRow:function(){},resize:function(){this.adaptHeight()},adaptWidth:function(){!("contentWidth"in this)&&this.contentNode&&0<this.contentNode.offsetWidth&&(this.contentWidth=this.contentNode.offsetWidth-this.padBorderWidth)},doStyleRowNode:function(z,y){var m=
["dojoxGridRowbar dojoxGridNonNormalizedCell"];this.grid.rows.isOver(z)&&m.push("dojoxGridRowbarOver");this.grid.selection.isSelected(z)&&m.push("dojoxGridRowbarSelected");y.className=m.join(" ")},domouseover:function(z){this.grid.onMouseOverRow(z)},domouseout:function(z){if(!this.isIntraRowEvent(z))this.grid.onMouseOutRow(z)}})})},"dojox/grid/_View":function(){define("dojo dijit/registry ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/connect dojo/_base/sniff dojo/query dojo/_base/window dojo/text!./resources/View.html dojo/dnd/Source dijit/_Widget dijit/_TemplatedMixin dojox/html/metrics ./util dojo/_base/html ./_Builder dojo/dnd/Avatar dojo/dnd/Manager".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,p,h,r,d,x,D){b=y("dojox.grid._View",[w,e],{defaultWidth:"18em",viewWidth:"",templateString:b,classTag:"dojoxGrid",marginBottom:0,rowPad:2,_togglingColumn:-1,_headerBuilderClass:d._HeaderBuilder,_contentBuilderClass:d._ContentBuilder,postMixInProperties:function(){this.rowNodes={}},postCreate:function(){this.connect(this.scrollboxNode,"onscroll","doscroll");h.funnelEvents(this.contentNode,this,"doContentEvent","mouseover mouseout click dblclick contextmenu mousedown".split(" "));
h.funnelEvents(this.headerNode,this,"doHeaderEvent","dblclick mouseover mouseout mousemove mousedown click contextmenu".split(" "));this.content=new this._contentBuilderClass(this);this.header=new this._headerBuilderClass(this);this.grid.isLeftToRight()||(this.headerNodeContainer.style.width="")},destroy:function(){r.destroy(this.headerNode);delete this.headerNode;for(var t in this.rowNodes)this._cleanupRowWidgets(this.rowNodes[t]),r.destroy(this.rowNodes[t]);this.rowNodes={};this.source&&this.source.destroy();
this.inherited(arguments)},focus:function(){a("ie")||a("webkit")||a("opera")?this.hiddenFocusNode.focus():this.scrollboxNode.focus()},setStructure:function(t){t=this.structure=t;t.width&&!isNaN(t.width)?this.viewWidth=t.width+"em":this.viewWidth=t.width||(t.noscroll?"auto":this.viewWidth);this._onBeforeRow=t.onBeforeRow||function(){};this._onAfterRow=t.onAfterRow||function(){};if(this.noscroll=t.noscroll)this.scrollboxNode.style.overflow="hidden";this.simpleStructure=1==t.cells.length;this.testFlexCells();
this.updateStructure()},_cleanupRowWidgets:function(t){t&&m.forEach(n("[widgetId]",t).map(v.byNode),function(G){G._destroyOnRemove?(G.destroy(),delete G):G.domNode&&G.domNode.parentNode&&G.domNode.parentNode.removeChild(G.domNode)})},onBeforeRow:function(t,G){this._onBeforeRow(t,G);0<=t&&this._cleanupRowWidgets(this.getRowNode(t))},onAfterRow:function(t,G,T){this._onAfterRow(t,G,T);var A=this.grid;m.forEach(n(".dojoxGridStubNode",T),function(S){if(S&&S.parentNode){var O=S.getAttribute("linkWidget"),
V=window.parseInt(r.attr(S,"cellIdx"),10);A.getCell(V);(O=v.byId(O))?(S.parentNode.replaceChild(O.domNode,S),O._started||O.startup(),N.destroy(S)):S.innerHTML=""}},this)},testFlexCells:function(){this.flexCells=!1;for(var t=0,G;G=this.structure.cells[t];t++)for(var T=0,A;A=G[T];T++)A.view=this,this.flexCells=this.flexCells||A.isFlex();return this.flexCells},updateStructure:function(){this.header.update();this.content.update()},getScrollbarWidth:function(){var t=this.hasVScrollbar(),G=r.style(this.scrollboxNode,
"overflow");this.noscroll||!G||"hidden"==G?t=!1:"scroll"==G&&(t=!0);return t?p.getScrollbar().w:0},getColumnsWidth:function(){var t=this.headerContentNode;return t&&t.firstChild?t.firstChild.offsetWidth||r.style(t.firstChild,"width"):0},setColumnsWidth:function(t){this.headerContentNode.firstChild.style.width=t+"px";this.viewWidth&&(this.viewWidth=t+"px")},getWidth:function(){return this.viewWidth||this.getColumnsWidth()+this.getScrollbarWidth()+"px"},getContentWidth:function(){return Math.max(0,
r._getContentBox(this.domNode).w-this.getScrollbarWidth())+"px"},render:function(){this.scrollboxNode.style.height="";this.renderHeader();0<=this._togglingColumn&&(this.setColumnsWidth(this.getColumnsWidth()-this._togglingColumn),this._togglingColumn=-1);var t=this.grid.layout.cells,G=c.hitch(this,function(A,S){!this.grid.isLeftToRight()&&(S=!S);S=S?-1:1;A=this.header.getCellNodeIndex(A)+S;for(var O=t[A];O&&O.getHeaderNode()&&"none"==O.getHeaderNode().style.display;)A+=S,O=t[A];return O?O.getHeaderNode():
null});if(this.grid.columnReordering&&this.simpleStructure){this.source&&this.source.destroy();this.bottomMarker&&r.destroy(this.bottomMarker);this.bottomMarker=r.byId("dojoxGrid_bottomMarker");this.topMarker&&r.destroy(this.topMarker);this.topMarker=r.byId("dojoxGrid_topMarker");this.bottomMarker||(this.bottomMarker=r.create("div",{id:"dojoxGrid_bottomMarker","class":"dojoxGridColPlaceBottom"},l.body()),this._hide(this.bottomMarker),this.topMarker=r.create("div",{id:"dojoxGrid_topMarker","class":"dojoxGridColPlaceTop"},
l.body()),this._hide(this.topMarker));this.arrowDim=r.contentBox(this.bottomMarker);var T=r.contentBox(this.headerContentNode.firstChild.rows[0]).h;this.source=new u(this.headerContentNode.firstChild.rows[0],{horizontal:!0,accept:["gridColumn_"+this.grid.id],viewIndex:this.index,generateText:!1,onMouseDown:c.hitch(this,function(A){this.header.decorateEvent(A);if((this.header.overRightResizeArea(A)||this.header.overLeftResizeArea(A))&&this.header.canResize(A)&&!this.header.moveable)this.header.beginColumnResize(A);
else{if(this.grid.headerMenu)this.grid.headerMenu.onCancel(!0);A.button===(9>a("ie")?1:0)&&u.prototype.onMouseDown.call(this.source,A)}}),onMouseOver:c.hitch(this,function(A){var S=this.source;S._getChildByEvent(A)&&u.prototype.onMouseOver.apply(S,arguments)}),_markTargetAnchor:c.hitch(this,function(A){var S=this.source;if(S.current!=S.targetAnchor||S.before!=A){S.targetAnchor&&G(S.targetAnchor,S.before)&&S._removeItemClass(G(S.targetAnchor,S.before),S.before?"After":"Before");u.prototype._markTargetAnchor.call(S,
A);var O=A?S.targetAnchor:G(S.targetAnchor,S.before);A=0;O||(O=S.targetAnchor,A=r.contentBox(O).w+this.arrowDim.w/2+2);O=r.position(O,!0);A=Math.floor(O.x-this.arrowDim.w/2+A);r.style(this.bottomMarker,"visibility","visible");r.style(this.topMarker,"visibility","visible");r.style(this.bottomMarker,{left:A+"px",top:T+O.y+"px"});r.style(this.topMarker,{left:A+"px",top:O.y-this.arrowDim.h+"px"});S.targetAnchor&&G(S.targetAnchor,S.before)&&S._addItemClass(G(S.targetAnchor,S.before),S.before?"After":"Before")}}),
_unmarkTargetAnchor:c.hitch(this,function(){var A=this.source;A.targetAnchor&&(A.targetAnchor&&G(A.targetAnchor,A.before)&&A._removeItemClass(G(A.targetAnchor,A.before),A.before?"After":"Before"),this._hide(this.bottomMarker),this._hide(this.topMarker),u.prototype._unmarkTargetAnchor.call(A))}),destroy:c.hitch(this,function(){f.disconnect(this._source_conn);f.unsubscribe(this._source_sub);u.prototype.destroy.call(this.source);this.bottomMarker&&(r.destroy(this.bottomMarker),delete this.bottomMarker);
this.topMarker&&(r.destroy(this.topMarker),delete this.topMarker)}),onDndCancel:c.hitch(this,function(){u.prototype.onDndCancel.call(this.source);this._hide(this.bottomMarker);this._hide(this.topMarker)})});this._source_conn=f.connect(this.source,"onDndDrop",this,"_onDndDrop");this._source_sub=f.subscribe("/dnd/drop/before",this,"_onDndDropBefore");this.source.startup()}},_hide:function(t){r.style(t,{top:"-10000px",visibility:"hidden"})},_onDndDropBefore:function(t,G,T){D.manager().target===this.source&&
(this.source._targetNode=this.source.targetAnchor,this.source._beforeTarget=this.source.before,G=this.grid.views.views,t=G[t.viewIndex],G=G[this.index],G!=t&&(t.convertColPctToFixed(),G.convertColPctToFixed()))},_onDndDrop:function(t,G,T){if(D.manager().target!==this.source)D.manager().source===this.source&&(this._removingColumn=!0);else{this._hide(this.bottomMarker);this._hide(this.topMarker);T=r.marginBox(G[0]).w;if(t.viewIndex!==this.index){var A=this.grid.views.views,S=A[t.viewIndex];A=A[this.index];
S.viewWidth&&"auto"!=S.viewWidth&&S.setColumnsWidth(S.getColumnsWidth()-T);A.viewWidth&&"auto"!=A.viewWidth&&A.setColumnsWidth(A.getColumnsWidth())}T=this.source._targetNode;S=this.source._beforeTarget;!this.grid.isLeftToRight()&&(S=!S);A=this.grid.layout;var O=this.index;delete this.source._targetNode;delete this.source._beforeTarget;var V=A.moveColumn;t=t.viewIndex;G=(G=G[0])?r.attr(G,"idx"):null;V.call(A,t,O,G,T?r.attr(T,"idx"):null,S)}},renderHeader:function(){this.headerContentNode.innerHTML=
this.header.generateHtml(this._getHeaderContent);this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);h.fire(this,"onAfterRow",[-1,this.structure.cells,this.headerContentNode])},_getHeaderContent:function(t){var G=t.name||t.grid.getCellName(t);/^\s+$/.test(G)&&(G="\x26nbsp;");var T=['\x3cdiv class\x3d"dojoxGridSortNode'];t.index!=t.grid.getSortIndex()?T.push('"\x3e'):T=T.concat([" ",0<t.grid.sortInfo?"dojoxGridSortUp":"dojoxGridSortDown",
'"\x3e\x3cdiv class\x3d"dojoxGridArrowButtonChar"\x3e',0<t.grid.sortInfo?"\x26#9650;":"\x26#9660;",'\x3c/div\x3e\x3cdiv class\x3d"dojoxGridArrowButtonNode" role\x3d"presentation"\x3e\x3c/div\x3e','\x3cdiv class\x3d"dojoxGridColCaption"\x3e']);T=T.concat([G,"\x3c/div\x3e\x3c/div\x3e"]);return T.join("")},resize:function(){this.adaptHeight();this.adaptWidth()},hasHScrollbar:function(t){var G=this._hasHScroll||!1;if(void 0==this._hasHScroll||t)this.noscroll?this._hasHScroll=!1:(t=r.style(this.scrollboxNode,
"overflow"),this._hasHScroll="hidden"==t?!1:"scroll"==t?!0:this.scrollboxNode.offsetWidth-this.getScrollbarWidth()<this.contentNode.offsetWidth);G!==this._hasHScroll&&this.grid.update();return this._hasHScroll},hasVScrollbar:function(t){var G=this._hasVScroll||!1;if(void 0==this._hasVScroll||t)this.noscroll?this._hasVScroll=!1:(t=r.style(this.scrollboxNode,"overflow"),this._hasVScroll="hidden"==t?!1:"scroll"==t?!0:this.scrollboxNode.scrollHeight>this.scrollboxNode.clientHeight);G!==this._hasVScroll&&
this.grid.update();return this._hasVScroll},convertColPctToFixed:function(){var t=!1;this.grid.initialWidth="";var G=n("th",this.headerContentNode),T=m.map(G,function(A,S){var O=A.style.width;r.attr(A,"vIdx",S);if(O&&"%"==O.slice(-1))t=!0;else if(O&&"px"==O.slice(-2))return window.parseInt(O,10);return r.contentBox(A).w});return t?(m.forEach(this.grid.layout.cells,function(A,S){if(A.view==this&&(A=A.view.getHeaderCellNode(A.index))&&r.hasAttr(A,"vIdx")){var O=window.parseInt(r.attr(A,"vIdx"));this.setColWidth(S,
T[O]);r.removeAttr(A,"vIdx")}},this),!0):!1},adaptHeight:function(t){if(!this.grid._autoHeight){var G=this.domNode.style.height&&parseInt(this.domNode.style.height.replace(/px/,""),10)||this.domNode.clientHeight;if(!t&&(t=this.noscroll))a:{for(var T=0;T<this.grid.views.views.length;++T)if(t=this.grid.views.views[T],t!==this&&t.hasHScrollbar()){t=!0;break a}t=!1}t&&(G-=p.getScrollbar().h);h.setStyleHeightPx(this.scrollboxNode,G)}this.hasVScrollbar(!0)},adaptWidth:function(){this.flexCells&&(this.contentWidth=
this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);var t=this.scrollboxNode.offsetWidth-this.getScrollbarWidth();this._removingColumn?(t=Math.min(t,this.getColumnsWidth())+"px",this._removingColumn=!1):t=Math.max(t,this.getColumnsWidth())+"px";this.contentNode.style.width=t;this.hasHScrollbar(!0)},setSize:function(t,G){var T=this.domNode.style,A=this.headerNode.style;t&&(T.width=t,A.width=t);T.height=0<=G?G+"px":""},renderRow:function(t){var G=this.createRowNode(t);
this.buildRow(t,G);return G},createRowNode:function(t){var G=document.createElement("div");G.className=this.classTag+"Row";this instanceof z.grid._RowSelector?r.attr(G,"role","presentation"):(r.attr(G,"role","row"),"none"!=this.grid.selectionMode&&G.setAttribute("aria-selected","false"));G[h.gridViewTag]=this.id;G[h.rowIndexTag]=t;return this.rowNodes[t]=G},buildRow:function(t,G){this.buildRowContent(t,G);this.styleRow(t,G)},buildRowContent:function(t,G){G.innerHTML=this.content.generateHtml(t,t);
this.flexCells&&this.contentWidth&&(G.firstChild.style.width=this.contentWidth);h.fire(this,"onAfterRow",[t,this.structure.cells,G])},rowRemoved:function(t){0<=t&&this._cleanupRowWidgets(this.getRowNode(t));this.grid.edit.save(this,t);delete this.rowNodes[t]},getRowNode:function(t){return this.rowNodes[t]},getCellNode:function(t,G){if(t=this.getRowNode(t))return this.content.getCellNode(t,G)},getHeaderCellNode:function(t){if(this.headerContentNode)return this.header.getCellNode(this.headerContentNode,
t)},styleRow:function(t,G){var T=void 0==G.style.cssText?G.getAttribute("style"):G.style.cssText;G._style=T;this.styleRowNode(t,G)},styleRowNode:function(t,G){G&&this.doStyleRowNode(t,G)},doStyleRowNode:function(t,G){this.grid.styleRowNode(t,G)},updateRow:function(t){var G=this.getRowNode(t);G&&(G.style.height="",this.buildRow(t,G));return G},updateRowStyles:function(t){this.styleRowNode(t,this.getRowNode(t))},lastTop:0,firstScroll:0,_nativeScroll:!1,doscroll:function(t){if(13<=a("ff")||a("chrome"))this._nativeScroll=
!0;t=this.grid.isLeftToRight();if(2>this.firstScroll){if(!t&&1==this.firstScroll||t&&0===this.firstScroll){var G=r.marginBox(this.headerNodeContainer);a("ie")?this.headerNodeContainer.style.width=G.w+this.getScrollbarWidth()+"px":a("mozilla")&&(this.headerNodeContainer.style.width=G.w-this.getScrollbarWidth()+"px",this.scrollboxNode.scrollLeft=t?this.scrollboxNode.clientWidth-this.scrollboxNode.scrollWidth:this.scrollboxNode.scrollWidth-this.scrollboxNode.clientWidth)}this.firstScroll++}this.headerNode.scrollLeft=
this.scrollboxNode.scrollLeft;t=this.scrollboxNode.scrollTop;t!==this.lastTop&&this.grid.scrollTo(t);this._nativeScroll=!1},setScrollTop:function(t){this.lastTop=t;this._nativeScroll||(this.scrollboxNode.scrollTop=t);return this.scrollboxNode.scrollTop},doContentEvent:function(t){if(this.content.decorateEvent(t))this.grid.onContentEvent(t)},doHeaderEvent:function(t){if(this.header.decorateEvent(t))this.grid.onHeaderEvent(t)},dispatchContentEvent:function(t){return this.content.dispatchEvent(t)},dispatchHeaderEvent:function(t){return this.header.dispatchEvent(t)},
setColWidth:function(t,G){this.grid.setCellWidth(t,G+"px")},update:function(){if(this.domNode){this.content.update();this.grid.update();var t=this.scrollboxNode.scrollLeft;this.scrollboxNode.scrollLeft=t;this.headerNode.scrollLeft=t}}});var q=y("dojox.grid._GridAvatar",x,{construct:function(){var t=l.doc,G=t.createElement("table");G.cellPadding=G.cellSpacing="0";G.className="dojoxGridDndAvatar";G.style.position="absolute";G.style.zIndex=1999;G.style.margin="0px";var T=t.createElement("tbody"),A=t.createElement("tr"),
S=t.createElement("td"),O=t.createElement("td");A.className="dojoxGridDndAvatarItem";O.className="dojoxGridDndAvatarItemImage";O.style.width="16px";var V=this.manager.source;if(V.creator)V=V._normalizedCreator(V.getItem(this.manager.nodes[0].id).data,"avatar").node;else if(V=this.manager.nodes[0].cloneNode(!0),"tr"==V.tagName.toLowerCase()){var I=t.createElement("table");var g=t.createElement("tbody");g.appendChild(V);I.appendChild(g);V=I}else"th"==V.tagName.toLowerCase()&&(I=t.createElement("table"),
g=t.createElement("tbody"),t=t.createElement("tr"),I.cellPadding=I.cellSpacing="0",t.appendChild(V),g.appendChild(t),I.appendChild(g),V=I);V.id="";S.appendChild(V);A.appendChild(O);A.appendChild(S);r.style(A,"opacity",.9);T.appendChild(A);G.appendChild(T);this.node=G;G=D.manager();this.oldOffsetY=G.OFFSET_Y;G.OFFSET_Y=1},destroy:function(){D.manager().OFFSET_Y=this.oldOffsetY;this.inherited(arguments)}}),H=D.manager().makeAvatar;D.manager().makeAvatar=function(){return void 0===this.source.viewIndex||
r.hasClass(l.body(),"dijit_a11y")?H.call(D.manager()):new q(this)};return b})},"dojox/html/metrics":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/sniff dojo/ready dojo/_base/unload dojo/_base/window dojo/dom-geometry".split(" "),function(N,v,z,y,m,c,f){var a=v.getObject("dojox.html.metrics",!0),n=v.getObject("dojox");a.getFontMeasurements=function(){var p={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0};if(z("ie")){var h=
c.doc.documentElement.style.fontSize||"";h||(c.doc.documentElement.style.fontSize="100%")}var r=c.doc.createElement("div"),d=r.style;d.position="absolute";d.left="-100px";d.top="0";d.width="30px";d.height="1000em";d.borderWidth="0";d.margin="0";d.padding="0";d.outline="0";d.lineHeight="1";d.overflow="hidden";c.body().appendChild(r);for(var x in p)d.fontSize=x,p[x]=16*Math.round(12*r.offsetHeight/16)/12/1E3;z("ie")&&(c.doc.documentElement.style.fontSize=h);c.body().removeChild(r);r=null;return p};
var l=null;a.getCachedFontMeasurements=function(p){if(p||!l)l=a.getFontMeasurements();return l};var b=null,u={};a.getTextBox=function(p,h,r){if(b)var d=b;else{d=b=c.doc.createElement("div");d.style.whiteSpace="nowrap";var x=c.doc.createElement("div");x.appendChild(d);var D=x.style;D.overflow="scroll";D.position="absolute";D.left="0px";D.top="-10000px";D.width="1px";D.height="1px";D.visibility="hidden";D.borderWidth="0";D.margin="0";D.padding="0";D.outline="0";c.body().appendChild(x)}d.className="";
D=d.style;D.borderWidth="0";D.margin="0";D.padding="0";D.outline="0";if(1<arguments.length&&h)for(var q in h)q in u||(D[q]=h[q]);2<arguments.length&&r&&(d.className=r);d.innerHTML=p;D=f.position(d);D.w=d.parentNode.scrollWidth;return D};var w=16,e=16;a.getScrollbar=function(){return{w:w,h:e}};a._fontResizeNode=null;a.initOnFontResize=function(p){var h=a._fontResizeNode=c.doc.createElement("iframe");p=h.style;p.position="absolute";p.width="5em";p.height="10em";p.top="-10000px";p.display="none";z("ie")?
h.onreadystatechange=function(){"complete"==h.contentWindow.document.readyState&&(h.onresize=h.contentWindow.parent[n._scopeName].html.metrics._fontresize)}:h.onload=function(){h.contentWindow.onresize=h.contentWindow.parent[n._scopeName].html.metrics._fontresize};h.setAttribute("src","javascript:'\x3chtml\x3e\x3chead\x3e\x3cscript\x3eif(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}\x3c/script\x3e\x3c/head\x3e\x3cbody\x3e\x3c/body\x3e\x3c/html\x3e'");c.body().appendChild(h);a.initOnFontResize=
function(){}};a.onFontResize=function(){};a._fontresize=function(){a.onFontResize()};m.addOnUnload(function(){var p=a._fontResizeNode;p&&(z("ie")&&p.onresize?p.onresize=null:p.contentWindow&&p.contentWindow.onresize&&(p.contentWindow.onresize=null),a._fontResizeNode=null)});y(function(){try{var p=c.doc.createElement("div");p.style.cssText="top:0;left:0;width:100px;height:100px;overflow:scroll;position:absolute;visibility:hidden;";c.body().appendChild(p);w=p.offsetWidth-p.clientWidth;e=p.offsetHeight-
p.clientHeight;c.body().removeChild(p);delete p}catch(h){}"fontSizeWatch"in N.config&&N.config.fontSizeWatch&&a.initOnFontResize()});return a})},"dojox/grid/_Builder":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/window dojo/_base/event dojo/_base/sniff dojo/_base/connect dojo/dnd/Moveable dojox/html/metrics ./util dojo/_base/html dojo/dom-geometry".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u){var w=N.grid,e=function(q,H){return q&&((q.rows||0)[H]||q.childNodes[H])},p=function(q){for(;q&&
"TABLE"!=q.tagName;q=q.parentNode);return q},h=function(q){var H=q.toUpperCase();return function(t){return t.tagName!=H}},r=l.rowIndexTag,d=l.gridViewTag,x=w._Builder=z.extend(function(q){q&&(this.view=q,this.grid=q.grid)},{view:null,_table:'\x3ctable class\x3d"dojoxGridRowTable" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"',getTableArray:function(){var q=[this._table];this.view.viewWidth&&q.push([' style\x3d"width:',this.view.viewWidth,';"'].join(""));q.push("\x3e");
return q},generateCellMarkup:function(q,H,t,G){var T=[];if(G){var A=q.index!=q.grid.getSortIndex()?"":0<q.grid.sortInfo?'aria-sort\x3d"ascending"':'aria-sort\x3d"descending"';q.id||(q.id=this.grid.id+"Hdr"+q.index);A=['\x3cth tabIndex\x3d"-1" aria-readonly\x3d"true" role\x3d"columnheader"',A,' id\x3d"',q.id,'"']}else A=['\x3ctd tabIndex\x3d"-1" role\x3d"gridcell"',this.grid.editable&&!q.editable?'aria-readonly\x3d"true"':""];q.colSpan&&A.push(' colspan\x3d"',q.colSpan,'"');q.rowSpan&&A.push(' rowspan\x3d"',
q.rowSpan,'"');A.push(' class\x3d"dojoxGridCell ');q.classes&&A.push(q.classes," ");t&&A.push(t," ");T.push(A.join(""));T.push("");A=['" idx\x3d"',q.index,'" style\x3d"'];H&&";"!=H[H.length-1]&&(H+=";");A.push(q.styles,H||"",q.hidden?"display:none;":"");q.unitWidth&&A.push("width:",q.unitWidth,";");T.push(A.join(""));T.push("");A=['"'];q.attrs&&A.push(" ",q.attrs);A.push("\x3e");T.push(A.join(""));T.push("");T.push(G?"\x3c/th\x3e":"\x3c/td\x3e");return T},isCellNode:function(q){return!(!q||q==y.doc||
!b.attr(q,"idx"))},getCellNodeIndex:function(q){return q?Number(b.attr(q,"idx")):-1},getCellNode:function(q,H){for(var t=0,G;(G=e(q.firstChild,t))&&G.cells;t++)for(var T=0,A;A=G.cells[T];T++)if(this.getCellNodeIndex(A)==H)return A;return null},findCellTarget:function(q,H){for(;q&&(!this.isCellNode(q)||q.offsetParent&&d in q.offsetParent.parentNode&&q.offsetParent.parentNode[d]!=this.view.id)&&q!=H;)q=q.parentNode;return q!=H?q:null},baseDecorateEvent:function(q){q.dispatch="do"+q.type;q.grid=this.grid;
q.sourceView=this.view;q.cellNode=this.findCellTarget(q.target,q.rowNode);q.cellIndex=this.getCellNodeIndex(q.cellNode);q.cell=0<=q.cellIndex?this.grid.getCell(q.cellIndex):null},findTarget:function(q,H){for(;q&&q!=this.domNode&&(!(H in q)||d in q&&q[d]!=this.view.id);)q=q.parentNode;return q!=this.domNode?q:null},findRowTarget:function(q){return this.findTarget(q,r)},isIntraNodeEvent:function(q){try{return q.cellNode&&q.relatedTarget&&b.isDescendant(q.relatedTarget,q.cellNode)}catch(H){return!1}},
isIntraRowEvent:function(q){try{var H=q.relatedTarget&&this.findRowTarget(q.relatedTarget);return!H&&-1==q.rowIndex||H&&q.rowIndex==H.gridRowIndex}catch(t){return!1}},dispatchEvent:function(q){return q.dispatch in this?this[q.dispatch](q):!1},domouseover:function(q){q.cellNode&&q.cellNode!=this.lastOverCellNode&&(this.lastOverCellNode=q.cellNode,this.grid.onMouseOver(q));this.grid.onMouseOverRow(q)},domouseout:function(q){if(q.cellNode&&q.cellNode==this.lastOverCellNode&&!this.isIntraNodeEvent(q,
this.lastOverCellNode)&&(this.lastOverCellNode=null,this.grid.onMouseOut(q),!this.isIntraRowEvent(q)))this.grid.onMouseOutRow(q)},domousedown:function(q){if(q.cellNode)this.grid.onMouseDown(q);this.grid.onMouseDownRow(q)},_getTextDirStyle:function(q,H,t){return""}});N=w._ContentBuilder=z.extend(function(q){x.call(this,q)},x.prototype,{update:function(){this.prepareHtml()},prepareHtml:function(){for(var q=this.grid.get,H=this.view.structure.cells,t=0,G;G=H[t];t++)for(var T=0,A;A=G[T];T++)A.get=A.get||
void 0==A.value&&q,A.markup=this.generateCellMarkup(A,A.cellStyles,A.cellClasses,!1),!this.grid.editable&&A.editable&&(this.grid.editable=!0)},generateHtml:function(q,H){q=this.getTableArray();var t=this.view.structure.cells,G=this.grid.getItem(H);l.fire(this.view,"onBeforeRow",[H,t]);for(var T=0,A;A=t[T];T++)if(!A.hidden&&!A.header){q.push(A.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var S=0,O,V,I;O=A[S];S++){V=O.markup;var g=O.customClasses=[];I=O.customStyles=[];V[5]=
O.format(H,G);V[1]=g.join(" ");V[3]=I.join(";");(g=O.textDir||this.grid.textDir)&&(V[3]+=this._getTextDirStyle(g,O,H));q.push.apply(q,V)}q.push("\x3c/tr\x3e")}q.push("\x3c/table\x3e");return q.join("")},decorateEvent:function(q){q.rowNode=this.findRowTarget(q.target);if(!q.rowNode)return!1;q.rowIndex=q.rowNode[r];this.baseDecorateEvent(q);q.cell=this.grid.getCell(q.cellIndex);return!0}});var D=w._HeaderBuilder=z.extend(function(q){this.moveable=null;x.call(this,q)},x.prototype,{_skipBogusClicks:!1,
overResizeWidth:4,minColWidth:1,update:function(){this.tableMap?this.tableMap.mapRows(this.view.structure.cells):this.tableMap=new w._TableMap(this.view.structure.cells)},generateHtml:function(q,H){var t,G=this.getTableArray(),T=this.view.structure.cells;l.fire(this.view,"onBeforeRow",[-1,T]);for(var A=0,S;S=T[A];A++)if(!S.hidden){G.push(S.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var O=0,V,I;V=S[O];O++)V.customClasses=[],V.customStyles=[],this.view.simpleStructure&&(V.draggable&&
(V.headerClasses?-1==V.headerClasses.indexOf("dojoDndItem")&&(V.headerClasses+=" dojoDndItem"):V.headerClasses="dojoDndItem"),V.attrs?-1==V.attrs.indexOf("dndType\x3d'gridColumn_")&&(V.attrs+=" dndType\x3d'gridColumn_"+this.grid.id+"'"):V.attrs="dndType\x3d'gridColumn_"+this.grid.id+"'"),I=this.generateCellMarkup(V,V.headerStyles,V.headerClasses,!0),I[5]=void 0!=H?H:q(V),I[3]=V.customStyles.join(";"),(t=V.textDir||this.grid.textDir)&&(I[3]+=this._getTextDirStyle(t,V,H)),I[1]=V.customClasses.join(" "),
G.push(I.join(""));G.push("\x3c/tr\x3e")}G.push("\x3c/table\x3e");return G.join("")},getCellX:function(q){var H=h("th");for(var t=q.target;t&&H(t);t=t.parentNode);(H=t)?(H=u.position(H),q=q.clientX-H.x):q=q.layerX;return q},decorateEvent:function(q){this.baseDecorateEvent(q);q.rowIndex=-1;q.cellX=this.getCellX(q);return!0},prepareResize:function(q,H){do{var t=q.cellIndex;q.cellNode=t?q.cellNode.parentNode.cells[t+H]:null;q.cellIndex=q.cellNode?this.getCellNodeIndex(q.cellNode):-1}while(q.cellNode&&
"none"==q.cellNode.style.display);return!!q.cellNode},canResize:function(q){if(!q.cellNode||1<q.cellNode.colSpan)return!1;q=this.grid.getCell(q.cellIndex);return!q.noresize&&q.canResize()},overLeftResizeArea:function(q){if(b.hasClass(y.body(),"dojoDndMove"))return!1;if(c("ie")){var H=q.target;if(b.hasClass(H,"dojoxGridArrowButtonNode")||b.hasClass(H,"dojoxGridArrowButtonChar")||b.hasClass(H,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?0<q.cellIndex&&0<q.cellX&&q.cellX<this.overResizeWidth&&
this.prepareResize(q,-1):q.cellNode&&0<q.cellX&&q.cellX<this.overResizeWidth},overRightResizeArea:function(q){if(b.hasClass(y.body(),"dojoDndMove"))return!1;if(c("ie")){var H=q.target;if(b.hasClass(H,"dojoxGridArrowButtonNode")||b.hasClass(H,"dojoxGridArrowButtonChar")||b.hasClass(H,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?q.cellNode&&q.cellX>=q.cellNode.offsetWidth-this.overResizeWidth:0<q.cellIndex&&q.cellX>=q.cellNode.offsetWidth-this.overResizeWidth&&this.prepareResize(q,
-1)},domousemove:function(q){if(!this.moveable){var H=this.overRightResizeArea(q)?"dojoxGridColResize":this.overLeftResizeArea(q)?"dojoxGridColResize":"";H&&!this.canResize(q)&&(H="dojoxGridColNoResize");b.toggleClass(q.sourceView.headerNode,"dojoxGridColNoResize","dojoxGridColNoResize"==H);b.toggleClass(q.sourceView.headerNode,"dojoxGridColResize","dojoxGridColResize"==H);H&&m.stop(q)}},domousedown:function(q){this.moveable||((this.overRightResizeArea(q)||this.overLeftResizeArea(q))&&this.canResize(q)?
this.beginColumnResize(q):(this.grid.onMouseDown(q),this.grid.onMouseOverRow(q)))},doclick:function(q){return this._skipBogusClicks?(m.stop(q),!0):!1},colResizeSetup:function(q,H){var t=b.contentBox(q.sourceView.headerNode);if(H){this.lineDiv=document.createElement("div");H=b.position(q.sourceView.headerNode,!0);var G=b.contentBox(q.sourceView.domNode),T=q.pageX;!this.grid.isLeftToRight()&&8>c("ie")&&(T-=n.getScrollbar().w);b.style(this.lineDiv,{top:H.y+"px",left:T+"px",height:G.h+t.h+"px"});b.addClass(this.lineDiv,
"dojoxGridResizeColLine");this.lineDiv._origLeft=T;y.body().appendChild(this.lineDiv)}H=[];G=this.tableMap.findOverlappingNodes(q.cellNode);T=0;for(var A;A=G[T];T++)H.push({node:A,index:this.getCellNodeIndex(A),width:A.offsetWidth});G=q.sourceView;A=this.grid.isLeftToRight()?1:-1;var S=q.grid.views.views;T=[];for(var O=G.idx+A,V;V=S[O];O+=A)T.push({node:V.headerNode,left:window.parseInt(V.headerNode.style.left)});A=G.headerContentNode.firstChild;return{scrollLeft:q.sourceView.headerNode.scrollLeft,
view:G,node:q.cellNode,index:q.cellIndex,w:b.contentBox(q.cellNode).w,vw:t.w,table:A,tw:b.contentBox(A).w,spanners:H,followers:T}},beginColumnResize:function(q){this.moverDiv=document.createElement("div");b.style(this.moverDiv,{position:"absolute",left:0});y.body().appendChild(this.moverDiv);b.addClass(this.grid.domNode,"dojoxGridColumnResizing");var H=this.moveable=new a(this.moverDiv),t=this.colResizeSetup(q,!0);H.onMove=z.hitch(this,"doResizeColumn",t);f.connect(H,"onMoveStop",z.hitch(this,function(){this.endResizeColumn(t);
t.node.releaseCapture&&t.node.releaseCapture();this.moveable.destroy();delete this.moveable;this.moveable=null;b.removeClass(this.grid.domNode,"dojoxGridColumnResizing")}));q.cellNode.setCapture&&q.cellNode.setCapture();H.onMouseDown(q)},doResizeColumn:function(q,H,t){var G=t.l;G={deltaX:G,w:q.w+(this.grid.isLeftToRight()?G:-G),vw:q.vw+G,tw:q.tw+G};this.dragRecord={inDrag:q,mover:H,leftTop:t};G.w>=this.minColWidth&&(H?b.style(this.lineDiv,"left",this.lineDiv._origLeft+G.deltaX+"px"):this.doResizeNow(q,
G))},endResizeColumn:function(q){if(this.dragRecord){var H=this.dragRecord.leftTop;H=this.grid.isLeftToRight()?H.l:-H.l;H+=Math.max(q.w+H,this.minColWidth)-(q.w+H);c("webkit")&&q.spanners.length&&(H+=b._getPadBorderExtents(q.spanners[0].node).w);this.doResizeNow(q,{deltaX:H,w:q.w+H,vw:q.vw+H,tw:q.tw+H});delete this.dragRecord}b.destroy(this.lineDiv);b.destroy(this.moverDiv);b.destroy(this.moverDiv);delete this.moverDiv;this._skipBogusClicks=!0;q.view.update();this._skipBogusClicks=!1;this.grid.onResizeColumn(q.index)},
doResizeNow:function(q,H){q.view.convertColPctToFixed();if(q.view.flexCells&&!q.view.testFlexCells()){var t=p(q.node);t&&(t.style.width="")}var G;for(t=0;G=q.spanners[t];t++){var T=G.width+H.deltaX;0<T&&(G.node.style.width=T+"px",q.view.setColWidth(G.index,T))}if(this.grid.isLeftToRight()||!c("ie"))for(t=0;G=q.followers[t];t++)T=G.left+H.deltaX,G.node.style.left=T+"px";q.node.style.width=H.w+"px";q.view.setColWidth(q.index,H.w);q.view.headerNode.style.width=H.vw+"px";q.view.setColumnsWidth(H.tw);
this.grid.isLeftToRight()||(q.view.headerNode.scrollLeft=q.scrollLeft+H.deltaX)}});w._TableMap=z.extend(function(q){this.mapRows(q)},{map:null,mapRows:function(q){if(q.length){this.map=[];for(var H,t=0;H=q[t];t++)this.map[t]=[];for(t=0;H=q[t];t++)for(var G=0,T=0,A,S;A=H[G];G++){for(;this.map[t][T];)T++;this.map[t][T]={c:G,r:t};S=A.rowSpan||1;A=A.colSpan||1;for(var O=0;O<S;O++)for(var V=0;V<A;V++)this.map[t+O][T+V]=this.map[t][T];T+=A}}},dumpMap:function(){for(var q=0,H;H=this.map[q];q++)for(var t=
0;H[t];t++);},getMapCoords:function(q,H){for(var t=0,G;G=this.map[t];t++)for(var T=0,A;A=G[T];T++)if(A.c==H&&A.r==q)return{j:t,i:T};return{j:-1,i:-1}},getNode:function(q,H,t){return(q=q&&q.rows[H])&&q.cells[t]},_findOverlappingNodes:function(q,H,t){var G=[];H=this.getMapCoords(H,t);t=0;for(var T;T=this.map[t];t++)t!=H.j&&(T=(T=T[H.i])?this.getNode(q,T.r,T.c):null)&&G.push(T);return G},findOverlappingNodes:function(q){var H=this._findOverlappingNodes,t=p(q);var G=q.parentNode;G=0<=G.rowIndex?G.rowIndex:
v.indexOf(G.parentNode.childNodes,G);return H.call(this,t,G,0<=q.cellIndex?q.cellIndex:v.indexOf(q.parentNode.cells,q))}});return{_Builder:x,_HeaderBuilder:D,_ContentBuilder:N}})},"dojox/grid/_ViewManager":function(){define(["dojo/_base/declare","dojo/_base/sniff","dojo/dom-class"],function(N,v,z){return N("dojox.grid._ViewManager",null,{constructor:function(y){this.grid=y},defaultWidth:200,views:[],resize:function(){this.onEach("resize")},render:function(){this.onEach("render")},addView:function(y){y.idx=
this.views.length;this.views.push(y)},destroyViews:function(){for(var y=0,m;m=this.views[y];y++)m.destroy();this.views=[]},getContentNodes:function(){for(var y=[],m=0,c;c=this.views[m];m++)y.push(c.contentNode);return y},forEach:function(y){for(var m=0,c;c=this.views[m];m++)y(c,m)},onEach:function(y,m){m=m||[];for(var c=0,f;f=this.views[c];c++)y in f&&f[y].apply(f,m)},normalizeHeaderNodeHeight:function(){for(var y=[],m=0,c;c=this.views[m];m++)c.headerContentNode.firstChild&&y.push(c.headerContentNode);
this.normalizeRowNodeHeights(y)},normalizeRowNodeHeights:function(y){var m=0,c=[];if(this.grid.rowHeight)m=this.grid.rowHeight;else{if(1>=y.length)return;for(var f=0,a;a=y[f];f++)z.contains(a,"dojoxGridNonNormalizedCell")||(c[f]=a.firstChild.offsetHeight,m=Math.max(m,c[f]));m=0<=m?m:0;(v("mozilla")||8<v("ie"))&&m&&m++}for(f=0;a=y[f];f++)c[f]!=m&&(a.firstChild.style.height=m+"px")},resetHeaderNodeHeight:function(){for(var y=0,m;m=this.views[y];y++)if(m=m.headerContentNode.firstChild)m.style.height=
""},renormalizeRow:function(y){for(var m=[],c=0,f,a;(f=this.views[c])&&(a=f.getRowNode(y));c++)a.firstChild.style.height="",m.push(a);this.normalizeRowNodeHeights(m)},getViewWidth:function(y){return this.views[y].getWidth()||this.defaultWidth},measureHeader:function(){this.resetHeaderNodeHeight();this.forEach(function(m){m.headerContentNode.style.height=""});var y=0;this.forEach(function(m){y=Math.max(m.headerNode.offsetHeight,y)});return y},measureContent:function(){var y=0;this.forEach(function(m){y=
Math.max(m.domNode.offsetHeight,y)});return y},findClient:function(y){y=this.grid.elasticView||-1;if(0>y)for(var m=1,c;c=this.views[m];m++)if(c.viewWidth){for(m=1;c=this.views[m];m++)if(!c.viewWidth){y=m;break}break}0>y&&(y=Math.floor(this.views.length/2));return y},arrange:function(y,m){var c,f,a=this.views.length,n=this,l=0>=m?a:this.findClient(),b=function(e,p){var h=e.domNode.style,r=e.headerNode.style;n.grid.isLeftToRight()?(h.left=p+"px",r.left=p+"px"):(h.right=p+"px",4>v("ff")?r.right=p+e.getScrollbarWidth()+
"px":r.right=p+"px",v("webkit")||"auto"==r.width||(r.width=parseInt(r.width,10)-e.getScrollbarWidth()+"px"));h.top="0px";r.top=0};for(c=0;(f=this.views[c])&&c<l;c++){var u=this.getViewWidth(c);f.setSize(u,0);b(f,y);u=f.headerContentNode&&f.headerContentNode.firstChild?f.getColumnsWidth()+f.getScrollbarWidth():f.domNode.offsetWidth;y+=u}c++;for(var w=a-1;(f=this.views[w])&&c<=w;w--)u=this.getViewWidth(w),f.setSize(u,0),u=f.domNode.offsetWidth,m-=u,b(f,m);l<a&&(f=this.views[l],u=Math.max(1,m-y),f.setSize(u+
"px",0),b(f,y));return y},renderRow:function(y,m,c){for(var f=[],a=0,n,l;(n=this.views[a])&&(l=m[a]);a++)n=n.renderRow(y),l.appendChild(n),f.push(n);c||this.normalizeRowNodeHeights(f)},rowRemoved:function(y){this.onEach("rowRemoved",[y])},updateRow:function(y,m){for(var c=0,f;f=this.views[c];c++)f.updateRow(y);m||this.renormalizeRow(y)},updateRowStyles:function(y){this.onEach("updateRowStyles",[y])},setScrollTop:function(y){for(var m=y,c=0,f;f=this.views[c];c++)m=f.setScrollTop(y),v("ie")&&f.headerNode&&
f.scrollboxNode&&(f.headerNode.scrollLeft=f.scrollboxNode.scrollLeft);return m},getFirstScrollingView:function(){for(var y=0,m;m=this.views[y];y++)if(m.hasHScrollbar()||m.hasVScrollbar())return m;return null}})})},"dojox/grid/_RowManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class"],function(N,v,z){return N("dojox.grid._RowManager",null,{constructor:function(y){this.grid=y},linesToEms:2,overRow:-2,prepareStylingRow:function(y,m){return{index:y,node:m,odd:!!(y&1),selected:!!this.grid.selection.isSelected(y),
over:this.isOver(y),customStyles:"",customClasses:"dojoxGridRow"}},styleRowNode:function(y,m){y=this.prepareStylingRow(y,m);this.grid.onStyleRow(y);this.applyStyles(y)},applyStyles:function(y){y.node.className=y.customClasses;var m=y.node.style.height,c=y.node,f=y.customStyles+";"+(y.node._style||"");void 0==c.style.cssText?c.setAttribute("style",f):c.style.cssText=f;y.node.style.height=m},updateStyles:function(y){this.grid.updateRowStyles(y)},setOverRow:function(y){var m=this.overRow;this.overRow=
y;m!=this.overRow&&(v.isString(m)||0<=m)&&this.updateStyles(m);this.updateStyles(this.overRow)},isOver:function(y){return this.overRow==y&&!z.contains(this.grid.domNode,"dojoxGridColumnResizing")}})})},"dojox/grid/_FocusManager":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/declare dojo/_base/connect dojo/_base/event dojo/_base/sniff dojo/query ./util dojo/_base/html".split(" "),function(N,v,z,y,m,c,f,a,n){return z("dojox.grid._FocusManager",null,{constructor:function(l){this.grid=
l;this.cell=null;this.rowIndex=-1;this._connects=[];this._headerConnects=[];this.headerMenu=this.grid.headerMenu;this._connects.push(y.connect(this.grid.domNode,"onfocus",this,"doFocus"));this._connects.push(y.connect(this.grid.domNode,"onblur",this,"doBlur"));this._connects.push(y.connect(this.grid.domNode,"mousedown",this,"_mouseDown"));this._connects.push(y.connect(this.grid.domNode,"mouseup",this,"_mouseUp"));this._connects.push(y.connect(this.grid.domNode,"oncontextmenu",this,"doContextMenu"));
this._connects.push(y.connect(this.grid.lastFocusNode,"onfocus",this,"doLastNodeFocus"));this._connects.push(y.connect(this.grid.lastFocusNode,"onblur",this,"doLastNodeBlur"));this._connects.push(y.connect(this.grid,"_onFetchComplete",this,"_delayedCellFocus"));this._connects.push(y.connect(this.grid,"postrender",this,"_delayedHeaderFocus"))},destroy:function(){N.forEach(this._connects,y.disconnect);N.forEach(this._headerConnects,y.disconnect);delete this.grid;delete this.cell},_colHeadNode:null,
_colHeadFocusIdx:null,_contextMenuBindNode:null,tabbingOut:!1,focusClass:"dojoxGridCellFocus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView()||this.focusView||this.grid.views.views[0];this._initColumnHeaders()},isFocusCell:function(l,b){return this.cell==l&&this.rowIndex==b},isLastFocusCell:function(){return this.cell?this.rowIndex==this.grid.rowCount-1&&this.cell.index==this.grid.layout.cellCount-1:!1},isFirstFocusCell:function(){return this.cell?0===
this.rowIndex&&0===this.cell.index:!1},isNoFocusCell:function(){return 0>this.rowIndex||!this.cell},isNavHeader:function(){return!!this._colHeadNode},getHeaderIndex:function(){return this._colHeadNode?N.indexOf(this._findHeaderCells(),this._colHeadNode):-1},_focusifyCellNode:function(l){var b=this.cell&&this.cell.getNode(this.rowIndex);if(b&&(n.toggleClass(b,this.focusClass,l),l)){l=this.scrollIntoView();try{if(c("webkit")||!this.grid.edit.isEditing())a.fire(b,"focus"),l&&(this.cell.view.scrollboxNode.scrollLeft=
l)}catch(u){}}},_delayedCellFocus:function(){if(!this.isNavHeader()&&this.grid.focused){var l=this.cell&&this.cell.getNode(this.rowIndex);if(l)try{this.grid.edit.isEditing()||(n.toggleClass(l,this.focusClass,!0),this._colHeadNode&&this.blurHeader(),a.fire(l,"focus"))}catch(b){}}},_delayedHeaderFocus:function(){this.isNavHeader()&&this.focusHeader()},_initColumnHeaders:function(){N.forEach(this._headerConnects,y.disconnect);this._headerConnects=[];for(var l=this._findHeaderCells(),b=0;b<l.length;b++)this._headerConnects.push(y.connect(l[b],
"onfocus",this,"doColHeaderFocus")),this._headerConnects.push(y.connect(l[b],"onblur",this,"doColHeaderBlur"))},_findHeaderCells:function(){for(var l=f("th",this.grid.viewsHeaderNode),b=[],u=0;u<l.length;u++){var w=l[u],e=n.hasAttr(w,"tabIndex"),p=n.attr(w,"tabIndex");e&&0>p&&b.push(w)}return b},_setActiveColHeader:function(l,b,u){this.grid.domNode.setAttribute("aria-activedescendant",l.id);null!=u&&0<=u&&u!=b&&n.toggleClass(this._findHeaderCells()[u],this.focusClass,!1);n.toggleClass(l,this.focusClass,
!0);this._colHeadNode=l;this._colHeadFocusIdx=b;this._scrollHeader(this._colHeadFocusIdx)},scrollIntoView:function(){var l=this.cell?this._scrollInfo(this.cell):null;if(!l||!l.s)return null;var b=this.grid.scroller.findScrollTop(this.rowIndex);l.n&&l.sr&&(l.n.offsetLeft+l.n.offsetWidth>l.sr.l+l.sr.w?l.s.scrollLeft=l.n.offsetLeft+l.n.offsetWidth-l.sr.w:l.n.offsetLeft<l.sr.l&&(l.s.scrollLeft=l.n.offsetLeft));l.r&&l.sr&&(b+l.r.offsetHeight>l.sr.t+l.sr.h?this.grid.setScrollTop(b+l.r.offsetHeight-l.sr.h):
b<l.sr.t&&this.grid.setScrollTop(b));return l.s.scrollLeft},_scrollInfo:function(l,b){if(l){var u=l.view.scrollboxNode,w={w:u.clientWidth,l:u.scrollLeft,t:u.scrollTop,h:u.clientHeight},e=l.view.getRowNode(this.rowIndex);return{c:l,s:u,sr:w,n:b?b:l.getNode(this.rowIndex),r:e}}return null},_scrollHeader:function(l){var b=null;if(this._colHeadNode){var u=this.grid.getCell(l);if(!u)return;b=this._scrollInfo(u,u.getNode(0))}b&&b.s&&b.sr&&b.n&&(b.n.offsetLeft+b.n.offsetWidth>b.sr.l+b.sr.w?b.s.scrollLeft=
b.n.offsetLeft+b.n.offsetWidth-b.sr.w:b.n.offsetLeft<b.sr.l?b.s.scrollLeft=b.n.offsetLeft:7>=c("ie")&&u&&u.view.headerNode&&(u.view.headerNode.scrollLeft=b.s.scrollLeft))},_isHeaderHidden:function(){var l=this.focusView;if(!l)for(var b=0,u;u=this.grid.views.views[b];b++)if(u.headerNode){l=u;break}return l&&"none"==n.getComputedStyle(l.headerNode).display},colSizeAdjust:function(l,b,u){var w=this._findHeaderCells(),e=this.focusView;if(!e||!e.header.tableMap.map)for(var p=0,h;h=this.grid.views.views[p];p++)if(h.header.tableMap.map){e=
h;break}p=w[b];!e||b==w.length-1&&0===b||(e.content.baseDecorateEvent(l),l.cellNode=p,l.cellIndex=e.content.getCellNodeIndex(l.cellNode),l.cell=0<=l.cellIndex?this.grid.getCell(l.cellIndex):null,e.header.canResize(l)&&(b={l:u},l=e.header.colResizeSetup(l,!1),e.header.doResizeColumn(l,null,b),e.update()))},styleRow:function(l){},setFocusIndex:function(l,b){this.setFocusCell(this.grid.getCell(b),l)},setFocusCell:function(l,b){l&&!this.isFocusCell(l,b)&&(this.tabbingOut=!1,this._colHeadNode&&this.blurHeader(),
this._colHeadNode=this._colHeadFocusIdx=null,this.focusGridView(),this._focusifyCellNode(!1),this.cell=l,this.rowIndex=b,this._focusifyCellNode(!0));if(c("opera"))setTimeout(v.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1);else this.grid.onCellFocus(this.cell,this.rowIndex)},next:function(){if(this.cell){var l=this.rowIndex,b=this.cell.index+1,u=this.grid.layout.cellCount-1,w=this.grid.rowCount-1;b>u&&(b=0,l++);l>w&&(b=u,l=w);if(this.grid.edit.isEditing()&&(u=this.grid.getCell(b),!this.isLastFocusCell()&&
(!u.editable||this.grid.canEdit&&!this.grid.canEdit(u,l)))){this.cell=u;this.rowIndex=l;this.next();return}this.setFocusIndex(l,b)}},previous:function(){if(this.cell){var l=this.rowIndex||0,b=(this.cell.index||0)-1;0>b&&(b=this.grid.layout.cellCount-1,l--);0>l&&(b=l=0);if(this.grid.edit.isEditing()){var u=this.grid.getCell(b);if(!this.isFirstFocusCell()&&!u.editable){this.cell=u;this.rowIndex=l;this.previous();return}}this.setFocusIndex(l,b)}},move:function(l,b){var u=0>b?-1:1;if(this.isNavHeader()){l=
this._findHeaderCells();var w=currentIdx=N.indexOf(l,this._colHeadNode);for(currentIdx+=b;0<=currentIdx&&currentIdx<l.length&&"none"==l[currentIdx].style.display;)currentIdx+=u;0<=currentIdx&&currentIdx<l.length&&this._setActiveColHeader(l[currentIdx],currentIdx,w)}else if(this.cell){var e=this.grid.scroller;w=this.rowIndex;var p=this.grid.rowCount-1,h=Math.min(p,Math.max(0,w+l));l&&(0<l?h>e.getLastPageRow(e.page)&&this.grid.setScrollTop(this.grid.scrollTop+e.findScrollTop(h)-e.findScrollTop(w)):
0>l&&h<=e.getPageRow(e.page)&&this.grid.setScrollTop(this.grid.scrollTop-e.findScrollTop(w)-e.findScrollTop(h)));e=this.grid.layout.cellCount-1;for(var r=this.cell.index,d=Math.min(e,Math.max(0,r+b)),x=this.grid.getCell(d);0<=d&&d<e&&x&&!0===x.hidden;)d+=u,x=this.grid.getCell(d);x&&!0!==x.hidden||(d=r);u=x.getNode(h);!u&&l?0<=h+l&&h+l<=p&&this.move(0<l?++l:--l,b):u&&"none"!==n.style(u,"display")||!b?(this.setFocusIndex(h,d),l&&this.grid.updateRow(w)):0<=d+b&&d+b<=e&&this.move(l,0<b?++b:--b)}},previousKey:function(l){this.grid.edit.isEditing()?
(m.stop(l),this.previous()):this.isNavHeader()||this._isHeaderHidden()?(this.tabOut(this.grid.domNode),null!=this._colHeadFocusIdx&&(n.toggleClass(this._findHeaderCells()[this._colHeadFocusIdx],this.focusClass,!1),this._colHeadFocusIdx=null),this._focusifyCellNode(!1)):(this.grid.domNode.focus(),m.stop(l))},nextKey:function(l){l.target===this.grid.domNode&&null==this._colHeadFocusIdx?(this.focusHeader(),m.stop(l)):this.isNavHeader()?(this.blurHeader(),this.findAndFocusGridCell()||this.tabOut(this.grid.lastFocusNode),
this._colHeadNode=this._colHeadFocusIdx=null):this.grid.edit.isEditing()?(m.stop(l),this.next()):this.tabOut(this.grid.lastFocusNode)},tabOut:function(l){this.tabbingOut=!0;l.focus()},focusGridView:function(){a.fire(this.focusView,"focus")},focusGrid:function(l){this.focusGridView();this._focusifyCellNode(!0)},findAndFocusGridCell:function(){var l=!0,b=0===this.grid.rowCount;this.isNoFocusCell()&&!b?(b=0,this.grid.getCell(b).hidden&&(b=this.isNavHeader()?this._colHeadFocusIdx:0),this.setFocusIndex(0,
b)):this.cell&&!b?(this.focusView&&!this.focusView.rowNodes[this.rowIndex]&&this.grid.scrollToRow(this.rowIndex),this.focusGrid()):l=!1;this._colHeadNode=this._colHeadFocusIdx=null;return l},focusHeader:function(){var l=this._findHeaderCells(),b=this._colHeadFocusIdx;this._isHeaderHidden()?this.findAndFocusGridCell():this._colHeadFocusIdx||(this.isNoFocusCell()?this._colHeadFocusIdx=0:this._colHeadFocusIdx=this.cell.index);for(this._colHeadNode=l[this._colHeadFocusIdx];this._colHeadNode&&0<=this._colHeadFocusIdx&&
this._colHeadFocusIdx<l.length&&"none"==this._colHeadNode.style.display;)this._colHeadFocusIdx++,this._colHeadNode=l[this._colHeadFocusIdx];this._colHeadNode&&"none"!=this._colHeadNode.style.display?(this.headerMenu&&this._contextMenuBindNode!=this.grid.domNode&&(this.headerMenu.unBindDomNode(this.grid.viewsHeaderNode),this.headerMenu.bindDomNode(this.grid.domNode),this._contextMenuBindNode=this.grid.domNode),this._setActiveColHeader(this._colHeadNode,this._colHeadFocusIdx,b),this._scrollHeader(this._colHeadFocusIdx),
this._focusifyCellNode(!1)):this.findAndFocusGridCell()},blurHeader:function(){n.removeClass(this._colHeadNode,this.focusClass);n.removeAttr(this.grid.domNode,"aria-activedescendant");if(this.headerMenu&&this._contextMenuBindNode==this.grid.domNode){var l=this.grid.viewsHeaderNode;this.headerMenu.unBindDomNode(this.grid.domNode);this.headerMenu.bindDomNode(l);this._contextMenuBindNode=l}},doFocus:function(l){l&&l.target!=l.currentTarget?m.stop(l):this._clickFocus||(this.tabbingOut||this.focusHeader(),
this.tabbingOut=!1,m.stop(l))},doBlur:function(l){m.stop(l)},doContextMenu:function(l){this.headerMenu||m.stop(l)},doLastNodeFocus:function(l){this.tabbingOut?this._focusifyCellNode(!1):0<this.grid.rowCount?(this.isNoFocusCell()&&this.setFocusIndex(0,0),this._focusifyCellNode(!0)):this.focusHeader();this.tabbingOut=!1;m.stop(l)},doLastNodeBlur:function(l){m.stop(l)},doColHeaderFocus:function(l){this._setActiveColHeader(l.target,n.attr(l.target,"idx"),this._colHeadFocusIdx);this._scrollHeader(this.getHeaderIndex());
m.stop(l)},doColHeaderBlur:function(l){n.toggleClass(l.target,this.focusClass,!1)},_mouseDown:function(l){this._clickFocus=dojo.some(this.grid.views.views,function(b){return b.scrollboxNode===l.target})},_mouseUp:function(l){this._clickFocus=!1}})})},"dojox/grid/_EditManager":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/connect dojo/_base/sniff ./util".split(" "),function(N,v,z,y,m,c){return z("dojox.grid._EditManager",null,{constructor:function(f){this.grid=f;
this.connections=m("ie")?[y.connect(document.body,"onfocus",N.hitch(this,"_boomerangFocus"))]:[];this.connections.push(y.connect(this.grid,"onBlur",this,"apply"));this.connections.push(y.connect(this.grid,"prerender",this,"_onPreRender"))},info:{},destroy:function(){v.forEach(this.connections,y.disconnect)},cellFocus:function(f,a){this.grid.singleClickEdit||this.isEditRow(a)?this.setEditCell(f,a):this.apply();(this.isEditing()||f&&f.editable&&f.alwaysEditing)&&this._focusEditor(f,a)},rowClick:function(f){this.isEditing()&&
!this.isEditRow(f.rowIndex)&&this.apply()},styleRow:function(f){f.index==this.info.rowIndex&&(f.customClasses+=" dojoxGridRowEditing")},dispatchEvent:function(f){var a=f.cell;return(a=a&&a.editable?a:0)&&a.dispatchEvent(f.dispatch,f)},isEditing:function(){return void 0!==this.info.rowIndex},isEditCell:function(f,a){return this.info.rowIndex===f&&this.info.cell.index==a},isEditRow:function(f){return this.info.rowIndex===f},setEditCell:function(f,a){!this.isEditCell(a,f.index)&&this.grid.canEdit&&this.grid.canEdit(f,
a)&&this.start(f,a,this.isEditRow(a)||f.editable)},_focusEditor:function(f,a){c.fire(f,"focus",[a])},focusEditor:function(){this.isEditing()&&this._focusEditor(this.info.cell,this.info.rowIndex)},_boomerangWindow:500,_shouldCatchBoomerang:function(){return this._catchBoomerang>(new Date).getTime()},_boomerangFocus:function(){this._shouldCatchBoomerang()&&(this.grid.focus.focusGrid(),this.focusEditor(),this._catchBoomerang=0)},_doCatchBoomerang:function(){m("ie")&&(this._catchBoomerang=(new Date).getTime()+
this._boomerangWindow)},start:function(f,a,n){this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.isEditing()&&!this.isEditRow(a)&&(this.applyRowEdit(),this.grid.updateRow(a)),n?(this.info={cell:f,rowIndex:a},this.grid.doStartEdit(f,a),this.grid.updateRow(a)):this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._focusEditor(f,a),this._doCatchBoomerang())},_editorDo:function(f){var a=this.info.cell;if(a&&a.editable)a[f](this.info.rowIndex)},editorApply:function(){this._editorDo("apply")},
editorCancel:function(){this._editorDo("cancel")},applyCellEdit:function(f,a,n){this.grid.canEdit(a,n)&&this.grid.doApplyCellEdit(f,n,a.field)},applyRowEdit:function(){this.grid.doApplyEdit(this.info.rowIndex,this.info.cell.field)},apply:function(){this.isEditing()&&this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.applyRowEdit(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},cancel:function(){this.isEditing()&&(this.grid.beginUpdate(),
this.editorCancel(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},save:function(f,a){var n=this.info.cell;!this.isEditRow(f)||a&&n.view!=a||!n.editable||n.save(n,this.info.rowIndex)},restore:function(f,a){var n=this.info.cell;this.isEditRow(a)&&n.view==f&&n.editable&&n.restore(this.info.rowIndex)},_isValidInput:function(){var f=(this.info.cell||{}).widget;if(!f||!f.isValid)return!0;f.focused=!0;return f.isValid(!0)},_onPreRender:function(){this.isEditing()&&
(this.info.value=this.info.cell.getValue())}})})},"dojox/grid/Selection":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-attr"],function(N,v,z,y){return N("dojox.grid.Selection",null,{constructor:function(m){this.grid=m;this.selected=[];this.setMode(m.selectionMode)},mode:"extended",selected:null,updating:0,selectedIndex:-1,rangeStartIndex:-1,setMode:function(m){this.selected.length&&this.deselectAll();this.mode="extended"!=m&&"multiple"!=m&&"single"!=m&&"none"!=
m?"extended":m},onCanSelect:function(m){return this.grid.onCanSelect(m)},onCanDeselect:function(m){return this.grid.onCanDeselect(m)},onSelected:function(m){},onDeselected:function(m){},onChanging:function(){},onChanged:function(){},isSelected:function(m){return"none"==this.mode?!1:this.selected[m]},getFirstSelected:function(){if(!this.selected.length||"none"==this.mode)return-1;for(var m=0,c=this.selected.length;m<c;m++)if(this.selected[m])return m;return-1},getNextSelected:function(m){if("none"==
this.mode)return-1;m+=1;for(var c=this.selected.length;m<c;m++)if(this.selected[m])return m;return-1},getSelected:function(){for(var m=[],c=0,f=this.selected.length;c<f;c++)this.selected[c]&&m.push(c);return m},getSelectedCount:function(){for(var m=0,c=0;c<this.selected.length;c++)this.selected[c]&&m++;return m},_beginUpdate:function(){if(0===this.updating)this.onChanging();this.updating++},_endUpdate:function(){this.updating--;if(0===this.updating)this.onChanged()},select:function(m){"none"!=this.mode&&
("multiple"!=this.mode?(this.deselectAll(m),this.addToSelection(m)):this.toggleSelect(m))},addToSelection:function(m){if("none"!=this.mode)if(z.isArray(m))v.forEach(m,this.addToSelection,this);else if(m=Number(m),this.selected[m])this.selectedIndex=m;else if(!1!==this.onCanSelect(m)){this.selectedIndex=m;var c=this.grid.getRowNode(m);c&&y.set(c,"aria-selected","true");this._beginUpdate();this.selected[m]=!0;this.onSelected(m);this._endUpdate()}},deselect:function(m){if("none"!=this.mode)if(z.isArray(m))v.forEach(m,
this.deselect,this);else if(m=Number(m),this.selectedIndex==m&&(this.selectedIndex=-1),this.selected[m]&&!1!==this.onCanDeselect(m)){var c=this.grid.getRowNode(m);c&&y.set(c,"aria-selected","false");this._beginUpdate();delete this.selected[m];this.onDeselected(m);this._endUpdate()}},setSelected:function(m,c){this[c?"addToSelection":"deselect"](m)},toggleSelect:function(m){z.isArray(m)?v.forEach(m,this.toggleSelect,this):this.setSelected(m,!this.selected[m])},_range:function(m,c,f){var a=0<=m?m:c;
m=c;a>m&&(m=a,a=c);for(c=a;c<=m;c++)f(c)},selectRange:function(m,c){this._range(m,c,z.hitch(this,"addToSelection"))},deselectRange:function(m,c){this._range(m,c,z.hitch(this,"deselect"))},insert:function(m){this.selected.splice(m,0,!1);this.selectedIndex>=m&&this.selectedIndex++},remove:function(m){this.selected.splice(m,1);this.selectedIndex>=m&&this.selectedIndex--},deselectAll:function(m){for(var c in this.selected)c!=m&&!0===this.selected[c]&&this.deselect(c)},clickSelect:function(m,c,f){if("none"!=
this.mode){this._beginUpdate();if("extended"!=this.mode)this.select(m);else{if(!f||0>this.rangeStartIndex)this.rangeStartIndex=m;c||this.deselectAll(m);f?this.selectRange(this.rangeStartIndex,m):c?this.toggleSelect(m):this.addToSelection(m)}this._endUpdate()}},clickSelectEvent:function(m){this.clickSelect(m.rowIndex,dojo.isCopyKey(m),m.shiftKey)},clear:function(){this._beginUpdate();this.deselectAll();this._endUpdate()}})})},"dojox/grid/DataSelection":function(){define(["dojo/_base/declare","./_SelectionPreserver",
"./Selection"],function(N,v,z){return N("dojox.grid.DataSelection",z,{constructor:function(y){y.keepSelection&&(this.preserver=new v(this))},destroy:function(){this.preserver&&this.preserver.destroy()},getFirstSelected:function(){var y=z.prototype.getFirstSelected.call(this);return-1==y?null:this.grid.getItem(y)},getNextSelected:function(y){y=this.grid.getItemIndex(y);y=z.prototype.getNextSelected.call(this,y);return-1==y?null:this.grid.getItem(y)},getSelected:function(){for(var y=[],m=0,c=this.selected.length;m<
c;m++)this.selected[m]&&y.push(this.grid.getItem(m));return y},addToSelection:function(y){if("none"!=this.mode){var m=null;m="number"==typeof y||"string"==typeof y?y:this.grid.getItemIndex(y);z.prototype.addToSelection.call(this,m)}},deselect:function(y){if("none"!=this.mode){var m=null;m="number"==typeof y||"string"==typeof y?y:this.grid.getItemIndex(y);z.prototype.deselect.call(this,m)}},deselectAll:function(y){var m=null;y||"number"==typeof y?(m="number"==typeof y||"string"==typeof y?y:this.grid.getItemIndex(y),
z.prototype.deselectAll.call(this,m)):this.inherited(arguments)}})})},"dojox/grid/_SelectionPreserver":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array"],function(N,v,z,y){return N("dojox.grid._SelectionPreserver",null,{constructor:function(m){this.selection=m;var c=this.grid=m.grid;this.reset();this._connects=[v.connect(c,"_setStore",this,"reset"),v.connect(c,"_addItem",this,"_reSelectById"),v.connect(m,"onSelected",z.hitch(this,"_selectById",!0)),
v.connect(m,"onDeselected",z.hitch(this,"_selectById",!1)),v.connect(m,"deselectAll",this,"reset")]},destroy:function(){this.reset();y.forEach(this._connects,v.disconnect);delete this._connects},reset:function(){this._selectedById={}},_reSelectById:function(m,c){m&&this.grid._hasIdentity&&(this.selection.selected[c]=this._selectedById[this.grid.store.getIdentity(m)])},_selectById:function(m,c){if("none"!=this.selection.mode&&this.grid._hasIdentity){var f=c,a=this.grid;if("number"==typeof c||"string"==
typeof c)f=(c=a._by_idx[c])&&c.item;f&&(this._selectedById[a.store.getIdentity(f)]=!!m);return f}}})})},"esri/dijit/editing/TemplatePickerItem":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/sniff dojo/dom-style dijit/_Widget dijit/_Templated dojox/gfx ../../symbols/jsonUtils ../../kernel".split(" "),function(N,v,z,y,m,c,f,a,n,l,b){N=N([f,a],{declaredClass:"esri.dijit.editing.TemplatePickerItem",templateString:"\x3cdiv class\x3d'item' style\x3d'text-align: center;'\x3e\x3cdiv class\x3d'itemSymbol' dojoAttachPoint\x3d'_surfaceNode'\x3e\x3c/div\x3e\x3cdiv class\x3d'itemLabel'\x3e${label}\x3c/div\x3e\x3c/div\x3e",
startup:function(){this._started||(this.inherited(arguments),this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template))},_draw:function(u,w,e,p,h){if(w&&"textsymbol"!==w.type){u=n.createSurface(u,e,p);if(9>y("ie")){var r=u.getEventSource();c.set(r,"position","relative");c.set(r.parentNode,"position","relative")}w=!this.legendOverride&&this._getDrawingToolShape(w,h)||l.getShapeDescriptors(w);try{var d=u.createShape(w.defaultShape).setFill(w.fill).setStroke(w.stroke)}catch(q){u.clear();
u.destroy();return}var x=d.getBoundingBox();w=x.width;h=x.height;r=-(x.x+w/2);x=-(x.y+h/2);var D=u.getDimensions();r={dx:r+D.width/2,dy:x+D.height/2};if(w>e||h>p)x=w/e>h/p,e=((x?e:p)-5)/(x?w:h),v.mixin(r,{xx:e,yy:e});d.applyTransform(r);return u}},_getDrawingToolShape:function(u,w){switch(w?w.drawingTool||null:null){case "esriFeatureEditToolArrow":w={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolLeftArrow":w={type:"path",path:"M -15,1 L -8,8 L -8,5 L 10,5 L 10,-2 L -8,-2 L -8,-5 L -15,1 E"};
break;case "esriFeatureEditToolRightArrow":w={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolUpArrow":w={type:"path",path:"M 1,-10 L 8,-3 L 5,-3 L 5,15 L -2,15 L -2,-3 L -5,-3 L 1,-10 E"};break;case "esriFeatureEditToolDownArrow":w={type:"path",path:"M 1,15 L 8,8 L 5,8 L 5,-10 L -2,-10 L -2,8 L -5,8 L 1,15 E"};break;case "esriFeatureEditToolTriangle":w={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":w=
{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":w={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":w={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;case "esriFeatureEditToolFreehand":w="simplelinesymbol"===u.type||"cartographiclinesymbol"===u.type?{type:"path",path:"m -11, -7c-1.5,-3.75 7.25,-9.25 12.5,-7c5.25,2.25 6.75,9.75 3.75,12.75c-3,3 -3.25,2.5 -9.75,5.25c-6.5,2.75 -7.25,14.25 2,15.25c9.25,1 11.75,-4 13.25,-6.75c1.5,-2.75 3.5,-11.75 12,-6.5"}:
{type:"path",path:"M 10,-13 c3.1,0.16667 4.42564,2.09743 2.76923,3.69231c-2.61025,2.87179 -5.61025,5.6718 -6.14358,6.20513c-0.66667,0.93333 -0.46667,1.2 -0.53333,1.93333c-0.00001,0.86666 0.6,1.66667 1.13334,2c1.03077,0.38462 2.8,0.93333 3.38974,1.70769c0.47693,0.42564 0.87693,0.75897 1.41026,1.75897c0.13333,1.06667 -0.46667,2.86667 -1.8,3.8c-0.73333,0.73333 -3.86667,2.66666 -4.86667,3.13333c-0.93333,0.8 -7.4,3.2 -7.6,3.06667c-1.06667,0.46667 -4.73333,1.13334 -5.2,1.26667c-1.6,0.33334 -4.6,0.4 -6.25128,0.05128c-1.41539,-0.18462 -2.34872,-2.31796 -1.41539,-4.45129c0.93333,-1.73333 1.86667,-3.13333 2.64615,-3.85641c1.28718,-1.47692 2.57437,-2.68204 3.88718,-3.54359c0.88718,-1.13845 1.8,-1.33333 2.26666,-2.45641c0.33334,-0.74359 0.37949,-1.7641 0.06667,-2.87692c-0.66666,-1.46666 -1.66666,-1.86666 -2.98975,-2.2c-1.27692,-0.26666 -2.12307,-0.64102 -3.27692,-1.46666c-0.66667,-1.00001 -1.01538,-3.01539 0.73333,-4.06667c1.73333,-1.2 3.6,-1.93333 4.93333,-2.2c1.33333,-0.46667 4.84104,-1.09743 5.84103,-1.23076c1.60001,-0.46667 6.02564,-0.50257 7.29231,-0.56924z"};
break;default:return null}return{defaultShape:w,fill:u.getFill(),stroke:u.getStroke()}},_repaint:function(u){u?(u.getStroke&&u.setStroke&&u.setStroke(u.getStroke()),u.getFill&&u.setFill&&u.setFill(u.getFill()),u.children&&v.isArray(u.children)&&z.forEach(u.children,this._repaint,this)):this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template)},destroy:function(){this._surface&&(this._surface.destroy(),delete this._surface);this.inherited(arguments)}});
y("extend-esri")&&v.setObject("dijit.editing.TemplatePickerItem",N,b);return N})},"widgets/Edit/utils":function(){define(["dojo/_base/lang","dojo/_base/array","jimu/utils"],function(N,v,z){function y(c,f){var a=null;c&&c.fields&&v.some(c.fields,function(n){if(n.name.toLowerCase()===f.toLowerCase())return a=n,!0});return a}function m(c,f,a){var n=null;if(c&&c.attributes)for(var l in c.attributes)if(c.attributes.hasOwnProperty(l)&&"function"!==typeof c.attributes[l]&&l.toLowerCase()===f.toLowerCase()){n=
a?c.attributes[l]=a:c.attributes[l];break}return n}return{getFieldInfosFromWebmap:function(c,f){var a=null;(c=f.getLayerInfoByTopLayerId(c))&&(c=c.getPopupInfo())&&c.fieldInfos&&(a=N.clone(c.fieldInfos));a&&v.forEach(a,function(n){n.format&&n.format.dateFormat&&(n.format.dateFormat.toLowerCase&&0>n.format.dateFormat.toLowerCase().indexOf("time")?n.format.time=!1:n.format.time=!0)});return a},getEditCapabilities:function(c,f,a){var n={};a=c.getEditCapabilities(a);n.canCreate=a.canCreate;n.canDelete=
a.canDelete;n.canUpdateGeometry=c.allowGeometryUpdates;f&&(n.canCreate=f.allowCreate&&n.canCreate,n.canDelete=f.allowDelete&&n.canDelete,n.canUpdateGeometry=!f.disableGeometryUpdate&&n.canUpdateGeometry);return n},getLocaleDateTime:function(c){return z.localizeDate(new Date(c),{fullYear:!0,formatLength:"medium"})},getAttrByFieldKey:function(c,f){return m(c,f)},setAttrByFieldKey:function(c,f,a){return m(c,f,a)},ignoreCaseToGetFieldKey:function(c,f){var a=null;if(c=y(c,f))a=c.name;return a},ignoreCaseToGetFieldObject:function(c,
f){return y(c,f)}}})},"widgets/Edit/FilterEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html jimu/utils dojo/dom-construct dijit/_TemplatedMixin dijit/_WidgetBase".split(" "),function(N,v,z,y,m,c,f,a){return N([a,f],{name:"FilterEditor",baseClass:"jimu-widget-FilterEditor",declaredClass:"jimu.dijit.FilterEditor",templateString:"\x3cdiv style\x3d'width:100%'\x3e\x3cdiv data-dojo-attach-point\x3d'filterEditorDiv'\x3e\x3c/div\x3e\x3c/div\x3e",_settings:null,
_editWidget:null,_origGetItemsFromLayerFunc:null,postCreate:function(){this.nls=this._editWidget.nls;this._createFilterTool()},_createFilterTool:function(){var n=c.create("label",{innerHTML:this.nls.featureLayers});c.place(n,this.filterEditorDiv);this._createLayerFilter();this._createTemplateFilter()},_createLayerFilter:function(){this.selectDropDown=c.create("select",{"class":"jimu-input flDropDown"});c.place(this.selectDropDown,this.filterEditorDiv);this.selectDropDown.onchange=v.hitch(this,function(){this._onLayerFilterChanged()});
var n=c.create("option",{value:"all",innerHTML:window.jimuNls.common.all});c.place(n,this.selectDropDown);for(n=0;n<this._editWidget._layerObjectsParaForTempaltePicker.length;n++){var l=this._editWidget._layerObjectsParaForTempaltePicker[n];l=c.create("option",{value:l.id,innerHTML:m.sanitizeHTML(l.name)});c.place(l,this.selectDropDown)}},_createTemplateFilter:function(){this.filterTextBox=c.create("input",{"class":"jimu-input searchtextbox",type:"text",placeholder:this.nls.searchTemplates},this.filterEditorDiv);
this.filterTextBox.onkeyup=v.hitch(this,function(){this._onTempalteFilterChanged()});var n=this._editWidget.editor.templatePicker;this._origGetItemsFromLayerFunc=n._getItemsFromLayer;n._getItemsFromLayer=v.hitch(this,function(){var l=this._origGetItemsFromLayerFunc.apply(n,arguments);var b=this.filterTextBox.value;b&&(l=z.filter(l,function(u){var w=!1,e=new RegExp(b,"ig");u.hasOwnProperty("label")&&u.label.match(e)&&0<u.label.match(e).length&&(w=!0);u.hasOwnProperty("template")&&u.template.hasOwnProperty("name")&&
u.template.name.match(e)&&0<u.template.name.match(e).length&&(w=!0);return w}));0===l.length&&(this._editWidget.editor.templatePicker.grid.noDataMessage=this.nls.noAvailableTempaltes);return l})},show:function(){y.setStyle(this.domNode,"display","block")},hide:function(){y.setStyle(this.domNode,"display","none")},selectLayerFilterByValue:function(n){z.forEach(this.selectDropDown.options,function(l,b){l.value===n&&(this.selectDropDown.selectedIndex=b)},this)},setTemplateFilter:function(n){this.filterTextBox.value=
n},disableLayerFilter:function(){y.setAttr(this.selectDropDown,"disabled",!0)},enableLayerFilter:function(){y.setAttr(this.selectDropDown,"disabled",!1)},update:function(){var n;for(n=this.selectDropDown.options.length-1;0<=n;n--)"all"!==this.selectDropDown.options[n].value&&this.selectDropDown.remove(n);for(n=0;n<this._editWidget._layerObjectsParaForTempaltePicker.length;n++){var l=this._editWidget._layerObjectsParaForTempaltePicker[n];l=c.create("option",{value:l.id,innerHTML:m.sanitizeHTML(l.name)});
c.place(l,this.selectDropDown)}this._editWidget.editor.templatePicker.attr("grouping",!0);this.setTemplateFilter("")},_onLayerFilterChanged:function(n){var l=this._editWidget.editor.templatePicker;l.clearSelection();var b=this.selectDropDown.options[this.selectDropDown.selectedIndex].text;""!==b&&("All"===b?(l.attr("featureLayers",this._editWidget._layerObjectsParaForTempaltePicker),""===this.filterTextBox.value?l.attr("grouping",!0):l.attr("grouping",!1)):(b=this._editWidget.map.getLayer(this.selectDropDown.value),
l.attr("featureLayers",[b]),l.attr("grouping",!1)),n&&l.attr("grouping",!0),l.update(!0))},_onTempalteFilterChanged:function(n){var l=this.selectDropDown.options[this.selectDropDown.selectedIndex].text,b=this.filterTextBox.value;this._editWidget.editor.templatePicker.clearSelection();"All"===l&&""===b?this._editWidget.editor.templatePicker.attr("grouping",!0):this._editWidget.editor.templatePicker.attr("grouping",!1);n&&this._editWidget.editor.templatePicker.attr("grouping",!0);this._editWidget.editor.templatePicker.update(!0)}})})},
"widgets/Edit/RelatedRecordsEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Deferred dojo/query ./utils dijit/form/Button dijit/_TemplatedMixin dijit/_WidgetBase esri/undoManager esri/OperationBase esri/graphic esri/tasks/query esri/tasks/QueryTask esri/tasks/RelationshipQuery esri/layers/FeatureLayer esri/dijit/AttributeInspector esri/dijit/Popup esri/dijit/PopupTemplate jimu/utils jimu/portalUrlUtils jimu/SelectionManager jimu/ConfigManager jimu/dijit/DropdownMenu jimu/dijit/LoadingIndicator jimu/LayerInfos/LayerInfos".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,p,h,r,d,x,D,q,H,t,G,T,A,S,O){var V=N([b,l],{baseClass:"related-records-editor",templateString:"\x3cdiv\x3e\x3cdiv class\x3d'operation-box' data-dojo-attach-point\x3d'operationBox'\x3e\x3cdiv class\x3d'previos-btn feature-action' data-dojo-attach-point\x3d'previouBtn'data-dojo-attach-event\x3d'click:_onPreviouBtnClick'\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-title' data-dojo-attach-point\x3d'operationTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'add-new-btn' data-dojo-attach-point\x3d'addNewBtn'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'content-box' data-dojo-attach-point\x3d'contentBox'\x3e\x3c/div\x3e\x3c/div\x3e",
editorATI:null,originalFeature:null,originalLayer:null,originalJimuLayerInfo:null,layerInfosObj:null,undoManager:null,refDomNode:null,_temporaryData:null,tableInfosParam:null,postCreate:function(){this._init();y.place(this.domNode,this.refDomNode,"after");window.isRTL?y.addClass(this.previouBtn,"icon-arrow-forward"):y.addClass(this.previouBtn,"icon-arrow-back");this.loading=(new S({hidden:!0})).placeAt(this.domNode);this._clearPage();this.showFirstPage({feature:this.originalFeature,oriJimuLayerInfo:this.originalJimuLayerInfo})},
_init:function(){this.refDomNode=this.editorATI.domNode;this.originalLayer=this.originalFeature.getLayer();this.layerInfosObj=O.getInstanceSync();this.originalJimuLayerInfo=this.layerInfosObj.getLayerOrTableInfoById(this.originalLayer.id);this.undoManager=new u;this._temporaryData={eventHandles:[],dijits:[]};this._tempPopup=new D({},y.create("div"));this._tempPopup.show()},destroy:function(){this._clearPage();this._tempPopup.destroy();this.inherited(arguments)},_getRelatedTableInfoArray:function(I){var g=
new c,C=[];I.getRelatedTableInfoArray("esriRelRoleOrigin").then(v.hitch(this,function(B){z.forEach(B,function(J){this._findTableInfoFromTableInfosParam(J)&&C.push(J)},this);g.resolve(C)}));return g},_getRelatedRecordsByQuery:function(I){var g=new c,C=new p,B=new h(I.destJimuLayerInfo.getUrl()),J=I.destJimuLayerInfo.layerObject.relationships.keyField,M=I.oriJimuLayerInfo.layerObject.objectIdField;C.where=J?J+" \x3d "+I.feature.attributes[J]:M+" \x3d "+I.feature.attributes[M];C.outFields=["*"];B.execute(C,
v.hitch(this,function(Q){g.resolve(Q)}));return g},_getRelatedRecordsByRelatedQuery:function(I){return I.oriJimuLayerInfo.getRelatedRecords(I.feature,I.destJimuLayerInfo,I.relationshipIndex)},_getOriRelationshipByDestLayer:function(I){var g=null;g=z.filter(I.oriJimuLayerInfo.layerObject.relationships,function(C){if(C.relatedTableId===I.destJimuLayerInfo.layerObject.layerId)return!0},this);return g=g[I.relationshipIndex]?g[I.relationshipIndex]:g[0]},_getDestRelationshipByDestLayer:function(I){var g=
null;g=z.filter(I.destJimuLayerInfo.layerObject.relationships,function(C){if(C.relatedTableId===I.oriJimuLayerInfo.layerObject.layerId)return!0},this);return g=g[I.relationshipIndex]?g[I.relationshipIndex]:g[0]},_createATI:function(I){var g=I.destJimuLayerInfo;var C=null,B=this._findTableInfoFromTableInfosParam(g);if(B){C=new V.ATI({layerInfos:[B],hideNavButtons:!0},y.create("div"));C.startup();this._temporaryData.dijits.push(C);var J=this._findTableInfoFromTableInfosParam(g);(J=a.getEditCapabilities(g.layerObject,
J).canDelete)||f(".atiButton.atiDeleteButton",C.domNode).addClass("hidden")}this._editWidget._configEditor.usingSaveButton&&(g=C.addButton(this.nls.save,"save-button related-record disable","after"),g=m(g,"click",v.hitch(this,this._onSaveBtnClick,I,C)),this._temporaryData.eventHandles.push(g));g=C.addButton(this.nls.close,"close-button related-record","before");g=m(g,"click",v.hitch(this,this._onCloseBtnClick));this._temporaryData.eventHandles.push(g);J&&(g=m(C,"delete",v.hitch(this,this._onDeleteBtnClick,
I)),this._temporaryData.eventHandles.push(g));g=m(C,"attribute-change",v.hitch(this,this._onAttributeChange,I));this._temporaryData.eventHandles.push(g);return C},_findTableInfoFromTableInfosParam:function(I){var g=null;z.some(this.tableInfosParam,function(C){if(C.featureLayer.id===I.id)return g=C,!0},this);return g},_keepReferentialIntegrity:function(I){var g=this._getOriRelationshipByDestLayer(I),C=this._getDestRelationshipByDestLayer(I),B={key:"",value:"",hasRelationshipTable:!1,originKeyFieldInRelationshipTable:"",
originValueInRelationshipTable:"",destKeyFieldInRelationshipTable:"",destValueInRelationshipTable:""};if(g.keyField&&C&&C.keyField){var J=a.ignoreCaseToGetFieldKey(I.oriJimuLayerInfo.layerObject,g.keyField);var M=a.ignoreCaseToGetFieldKey(I.destJimuLayerInfo.layerObject,C.keyField);J&&M&&(B.key=M,B.value=I.feature.attributes[J])}else g.keyField&&(J=a.ignoreCaseToGetFieldKey(I.oriJimuLayerInfo.layerObject,g.keyField))&&(B.key=J,B.value=I.feature.attributes[J]);g&&null!=g.relationshipTableId&&C&&null!=
C.relationshipTableId&&(B.hasRelationshipTable=!0,B.originKeyFieldInRelationshipTable=g.keyFieldInRelationshipTable,B.destKeyFieldInRelationshipTable=C.keyFieldInRelationshipTable,B.originValueInRelationshipTable=I.feature.attributes[J],I.relatedFeature&&(B.destValueInRelationshipTable=I.relatedFeature.attributes[M||J]));return B},_prepareNewRelatedRecord:function(I){var g=this._getTemplateFromLayerObject(I.destJimuLayerInfo.layerObject);g=v.mixin({},g?g.prototype.attributes:{});I=this._keepReferentialIntegrity(I);
I.hasRelationshipTable||(g[I.key]=I.value);return new e(null,null,g,null)},_prepareNewRelationshipRecord:function(I,g){var C=null,B={};I=this._keepReferentialIntegrity(this._createOperationData(I.feature,I.oriJimuLayerInfo,I.destJimuLayerInfo,g,I.relationshipIndex));I.hasRelationshipTable&&(B[I.originKeyFieldInRelationshipTable]=I.originValueInRelationshipTable,B[I.destKeyFieldInRelationshipTable]=I.destValueInRelationshipTable,C=new e(null,null,B,null));return C},_prepareRelationshipTableInfo:function(I){var g=
this._getOriRelationshipByDestLayer(I).relationshipTableId,C=null;if(null==g)return null;I=I.oriJimuLayerInfo.layerObject;var B=I.url.lastIndexOf("/"),J=I.url.slice(0,B)+"/"+g.toString();z.some(this.tableInfosParam,function(M){if(v.getObject("featureLayer.url",!1,M)&&t.removeProtocol(J.toString().toLowerCase()).replace(/\/+/g,"/")===t.removeProtocol(M.featureLayer.url.toString().toLowerCase()).replace(/\/+/g,"/"))return C=this.layerInfosObj.getLayerOrTableInfoById(M.featureLayer.id),!0},this);return C},
_addNewRelationshipReocrd:function(I,g){var C=new c,B=null;(I=this._prepareNewRelationshipRecord(g,I))&&(B=this._prepareRelationshipTableInfo(g));B&&B.layerObject?B.layerObject.applyEdits([I],null,null,v.hitch(this,function(){C.resolve()}),v.hitch(this,function(){console.warn("Failed to add relationship record.");C.resolve()})):C.resolve();return C},_addNewRelatedRecord:function(I,g){var C=new c,B=g.destJimuLayerInfo.layerObject;B.applyEdits([I],null,null,v.hitch(this,function(J){var M=J[0];if(M.success&&
M.objectId){J=new p;var Q=new h(B.url);J.where=B.objectIdField+" \x3d "+M.objectId;J.outFields=["*"];Q.execute(J,v.hitch(this,function(R){var X=R.features[0];X||(I.attributes[B.objectIdField]=M.objectId,X=I);this._addNewRelationshipReocrd(X,g).then(v.hitch(this,function(){C.resolve(X)}))}),v.hitch(this,function(){C.reject()}))}else C.reject()}),v.hitch(this,function(){C.reject()}));return C},_deleteRelatedRecord:function(I){var g=new c;I.destJimuLayerInfo.layerObject.applyEdits(null,null,[I.relatedFeature],
v.hitch(this,function(){g.resolve()}),v.hitch(this,function(){g.reject()}));return g},_updateRelatedRecordOnSave:function(I){this.loading.show();this._updateRelatedRecord(I).then(v.hitch(this,function(){this.loading.hide()}),v.hitch(this,function(){this.loading.hide()}))},_updateRelatedRecordOnClient:function(I,g){this._editWidget._startEditingSession();I.relatedFeature.attributes[g.fieldName]=g.fieldValue;var C=g.target;C&&C.updateCurrentSelectdFeature&&C.updateCurrentSelectdFeature([I.relatedFeature],
I.destJimuLayerInfo.layerObject,g.fieldName,g.fieldValue)},_updateRelatedRecordDirectly:function(I,g){this.loading.show();I.relatedFeature.attributes[g.fieldName]=g.fieldValue;this._updateRelatedRecord(I).then(v.hitch(this,function(){this.loading.hide();var C=g.target;C&&C.updateCurrentSelectdFeature&&C.updateCurrentSelectdFeature([I.relatedFeature],I.destJimuLayerInfo.layerObject,g.fieldName,g.fieldValue)}),v.hitch(this,function(){this.loading.hide()}))},_updateRelatedRecord:function(I){var g=new c;
I.destJimuLayerInfo.layerObject.applyEdits(null,[I.relatedFeature],null,v.hitch(this,function(){g.resolve()}),v.hitch(this,function(){g.reject()}));return g},_getDisplayTitleOfRelatedRecord:function(I,g,C){var B=I.getInfoTemplate();return(I="popupTitle"===C&&B?"function"===typeof B.title?B.title(g):B.title:this._getDisplayTitleFromPopup(I,g,C))?I:""},_getDisplayTitleFromPopup:function(I,g,C){(I=this._getPopupTemplateWithOnlyDisplayField(I,C))?(g.setInfoTemplate(I),this._tempPopup.setFeatures([g]),
C=(C=f("td.attrValue",this._tempPopup.domNode)[0])&&C.innerHTML,g.setInfoTemplate(null)):C=a.getAttrByFieldKey(g,C);return C},_getPopupTemplateWithOnlyDisplayField:function(I,g){I=I._getCustomPopupInfo(I.layerObject,[g]);return new q(I)},_getTemplateFromLayerObject:function(I){var g=null;I.templates&&I.templates[0]?g=I.templates[0]:I.types&&I.types[0]&&I.types[0].templates[0]&&(g=I.types[0].templates[0]);return g},showRelatedRecords:function(I){this._changeRefDomNode();var g=v.getObject("_wabProperties.originalLayerName",
!1,I.destJimuLayerInfo.layerObject)||I.destJimuLayerInfo.title;this._setOperationTitle(g);this._clearPage();this.loading.show();this._getRelatedRecordsByRelatedQuery(I).then(v.hitch(this,function(C){var B=I.oriJimuLayerInfo.getOriRelationshipByDestLayer(I.oriJimuLayerInfo.layerObject,I.destJimuLayerInfo.layerObject);B&&B.cardinality&&B.cardinality.toLowerCase&&0<=B.cardinality.toLowerCase().indexOf("onetoone")&&1<=C.length?this._hideAddNewBtn():this._showAddNewBtn(I);0<C.length?this._setTitle(window.jimuNls.popup.relatedRecords):
this._setTitle(window.jimuNls.popup.noRelatedRecotds,"font-normal");var J=this._showFieldSelector(I.destJimuLayerInfo);z.forEach(C,function(M,Q){M._layer=I.destJimuLayerInfo.layerObject;var R=this._getDisplayTitleOfRelatedRecord(I.destJimuLayerInfo,M,J);Q=y.create("div",{"class":"item record-item enable "+(0===Q%2?"oddLine":"evenLine"),innerHTML:H.sanitizeHTML(R)},this.contentBox);Q.relatedRecord=M;Q=m(Q,"click",v.hitch(this,function(){this._addOperation(V.OPERATION_SHOW_RELATED_RECORDS,I);this.showInspector(this._createOperationData(I.feature,
I.oriJimuLayerInfo,I.destJimuLayerInfo,M,I.relationshipIndex))}));this._temporaryData.eventHandles.push(Q)},this);this.loading.hide()}))},showInspector:function(I){var g=!1;this._changeRefDomNode();var C=I.destJimuLayerInfo.layerObject,B=v.getObject("_wabProperties.originalLayerName",!1,C)||I.destJimuLayerInfo.title;C=v.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,C);var J=this._getDisplayTitleOfRelatedRecord(I.destJimuLayerInfo,I.relatedFeature,C);"popupTitle"!==C&&(J=
B+": "+J);this._setOperationTitle(J);this._clearPage();(J=this._createATI(I))&&y.place(J.domNode,this.contentBox);B=I.destJimuLayerInfo.layerObject.objectIdField;C=I.relatedFeature.attributes[B];null===C||void 0===C?(I.destJimuLayerInfo.layerObject.clearSelection(),J.showFeature(I.relatedFeature,I.destJimuLayerInfo.layerObject),g=!0,f(".atiButton.atiDeleteButton",J.domNode).addClass("disable"),this._editWidget._startEditingSession()):(this.loading.show(),J=new p,J.where=B+" \x3d "+C,I.destJimuLayerInfo.layerObject.selectFeatures(J,
d.SELECTION_NEW,v.hitch(this,function(){this.loading.hide();var M=I.destJimuLayerInfo.layerObject.getSelectedFeatures();M&&M[0]&&M[0].geometry&&this._activeGraphicEdit(M[0],I.oriJimuLayerInfo)})));this.showRelatedTables(this._createOperationData(I.relatedFeature,I.destJimuLayerInfo,null,null,null),I,g)},showRelatedTables:function(I,g,C){this._getRelatedTableInfoArray(I.oriJimuLayerInfo).then(v.hitch(this,function(B){0<B.length&&this._setTitle(window.jimuNls.popup.relatedTables);var J={};z.forEach(B,
function(Q){void 0===J[Q.id]?J[Q.id]=0:J[Q.id]++},this);var M={};z.forEach(B,function(Q,R){void 0===M[Q.id]?M[Q.id]=0:M[Q.id]++;var X=0===R%2?"oddLine ":"evenLine ",W=C?"disable ":"enable ";R='\x3cdiv title\x3d"'+Q.title+'"\x3e'+H.sanitizeHTML(Q.title)+"\x3c/div\x3e";X=y.create("div",{"class":"item table-item "+X+W,innerHTML:R},this.contentBox);var k=M[Q.id];0<J[Q.id]&&(W=I.oriJimuLayerInfo.getOriRelationshipByDestLayer(I.oriJimuLayerInfo.layerObject,Q.layerObject,k),W=W.name||W.id,W='\x3cdiv class\x3d"relationshipName" title\x3d"'+
W+'"\x3e('+H.sanitizeHTML(W)+")\x3c/div\x3e",X.innerHTML=R+W);C||(R=m(X,"click",v.hitch(this,function(){if(this._editWidget._configEditor.usingSaveButton)var F=this._editWidget._popupConfirmDialog();else F=new c,F.resolve(!0);F.then(v.hitch(this,function(L){L&&Q.getLayerObject().then(v.hitch(this,function(){g?this._addOperation(V.OPERATION_SHOW_INSPECTOR,g):this._addOperation(V.OPERATION_FIRST,I);this.showRelatedRecords(this._createOperationData(I.feature,I.oriJimuLayerInfo,Q,null,k))}))}))})),this._temporaryData.eventHandles.push(R))},
this)}))},showFirstPage:function(I,g){this._clearPage();this._revertRefDomNode();this.showRelatedTables(I);g&&(z.forEach(this._editWidget._jimuLayerInfos.getLayerInfoArray(),function(C){C.layerObject&&C.layerObject.clearSelection&&C.id!==this.originalJimuLayerInfo.id&&G.getInstance().clearSelection(C.layerObject)},this),this.originalFeature.setSymbol(this.originalLayer.getSelectionSymbol()),this._activeGraphicEdit(this.originalFeature))},_activeGraphicEdit:function(I,g){g&&(g.id===this.originalJimuLayerInfo.id?
this.originalFeature.setSymbol(null,!0):G.getInstance().clearSelection(g.layerObject));var C;this._editWidget.editor._editVertices=!0;this._editWidget.editor._activateEditToolbar(I);I.geometry&&(C="point"===I.geometry.type?I.geometry:I.geometry.getExtent().getCenter());this._editWidget.map.infoWindow.show(C)},_createOperationData:function(I,g,C,B,J){return{feature:I,oriJimuLayerInfo:g,destJimuLayerInfo:C,relatedFeature:B,relationshipIndex:J||0}},_addOperation:function(I,g){this.undoManager.add(new V.Operation(I,
g,this))},_onPreviouBtnClick:function(){if(this._editWidget._configEditor.usingSaveButton)var I=this._editWidget._popupConfirmDialog();else I=new c,I.resolve(!0);I.then(v.hitch(this,function(g){g&&this.undoManager.undo()}))},_onAddNewBtnClick:function(I){var g=I.destJimuLayerInfo.layerObject,C=this._prepareNewRelatedRecord(I),B=this._keepReferentialIntegrity(I);"Table"!==g.type?this._editWidget._startEditingRelatedGraphic(I,B):this._editWidget._configEditor.usingSaveButton?(this._addOperation(V.OPERATION_SHOW_RELATED_RECORDS,
I),this.showInspector(this._createOperationData(I.feature,I.oriJimuLayerInfo,I.destJimuLayerInfo,C,I.relationshipIndex))):(this.loading.show(),this._addNewRelatedRecord(C,I).then(v.hitch(this,function(J){this.loading.hide();this._addOperation(V.OPERATION_SHOW_RELATED_RECORDS,I);this.showInspector(this._createOperationData(I.feature,I.oriJimuLayerInfo,I.destJimuLayerInfo,J,I.relationshipIndex))}),v.hitch(this,function(){this.loading.hide()})))},_onCloseBtnClick:function(){this._editWidget.editPopup.hide()},
_onDeleteBtnClick:function(I){var g=I.relatedFeature.attributes[I.destJimuLayerInfo.layerObject.objectIdField];null!==g&&void 0!==g&&(this._editWidget._configEditor.usingSaveButton&&this._editWidget._stopEditingSession(),this.loading.show(),this._deleteRelatedRecord(I).then(v.hitch(this,function(){this.loading.hide();this._onPreviouBtnClick()}),v.hitch(this,function(){this.loading.hide()})))},_onSaveBtnClick:function(I){if(this._editWidget._isEditingSession){var g=I.relatedFeature.attributes[I.destJimuLayerInfo.layerObject.objectIdField];
null===g||void 0===g?(g=I.relatedFeature,this.loading.show(),this._addNewRelatedRecord(g,I).then(v.hitch(this,function(C){this.loading.hide();this.showInspector(this._createOperationData(I.feature,I.oriJimuLayerInfo,I.destJimuLayerInfo,C,I.relationshipIndex))}),v.hitch(this,function(){this.loading.hide()}))):this._updateRelatedRecordOnSave(I);this._editWidget._stopEditingSession()}},_onAttributeChange:function(I,g){this._editWidget._configEditor.usingSaveButton?this._updateRelatedRecordOnClient(I,
g):this._updateRelatedRecordDirectly(I,g)},_clearPage:function(){y.empty(this.contentBox);y.setStyle(this.addNewBtn,"display","none");z.forEach(this._temporaryData.eventHandles,function(I){I&&I.remove&&I.remove()},this);this._temporaryData.eventHandles=[];z.forEach(this._temporaryData.dijits,function(I){I&&I.destroy&&I.destroy()},this);this._temporaryData.dijits=[]},_changeRefDomNode:function(){y.setStyle(this.refDomNode,"display","none");y.setStyle(this.operationBox,"display","block");y.addClass(this.domNode,
"fix-height-mode");this.previouBtn.title=window.jimuNls.common.back;this.addNewBtn.title=window.jimuNls.common.newText;this.undoManager.peekUndo()?y.setStyle(this.previouBtn,"display","block"):y.setStyle(this.previouBtn,"display","none")},_revertRefDomNode:function(){y.setStyle(this.refDomNode,"display","block");y.setStyle(this.operationBox,"display","none");y.removeClass(this.domNode,"fix-height-mode")},_showAddNewBtn:function(I){var g=I.destJimuLayerInfo.layerObject,C=this._findTableInfoFromTableInfosParam(I.destJimuLayerInfo);
a.getEditCapabilities&&a.getEditCapabilities(g,C).canCreate&&(y.setStyle(this.addNewBtn,"display","block"),I=m(this.addNewBtn,"click",v.hitch(this,this._onAddNewBtnClick,I)),this._temporaryData.eventHandles.push(I))},_hideAddNewBtn:function(){y.setStyle(this.addNewBtn,"display","none")},_setTitle:function(I,g){I&&y.create("div",{"class":"title-box "+(g?g:""),innerHTML:H.sanitizeHTML(I)},this.contentBox)},_setOperationTitle:function(I){y.setAttr(this.operationTitle,"innerHTML",H.sanitizeHTML(I));y.setAttr(this.operationTitle,
"title",I)},_showFieldSelector:function(I){var g="objecid",C=f(".title-box",this.contentBox)[0],B=I.layerObject,J=[];if(!C||!I)return g;var M=I.getPopupInfo();M&&M.title&&J.push({label:window.jimuNls.popup.saveAsPopupTitle,value:"popupTitle"});var Q=this._findTableInfoFromTableInfosParam(I);Q&&Q.fieldInfos&&z.forEach(Q.fieldInfos,function(W){"globalid"!==W.fieldName.toLowerCase()&&"shape"!==W.fieldName.toLowerCase()&&J.push({label:W.label||W.fieldName,value:W.fieldName})});C=(new A({items:J})).placeAt(C);
C.domNode.title=window.jimuNls.popup.chooseFieldTip;Q=v.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,B);var R=a.ignoreCaseToGetFieldObject(I.layerObject,I.layerObject.displayField||I.layerObject.objectIdField),X=T.getInstance().getAppConfig();Q?g=Q:"2.3"===X.configWabVersion&&R&&R.name?g=R.name:M&&M.title?g="popupTitle":R&&R.name?g=R.name:0<J.length&&(g=J[0].value);g&&(C.setHighlightValue(g),v.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",g,B));this._temporaryData.dijits.push(C);
I=m(C,"click-item",v.hitch(this,function(W,k){f(".item.record-item",this.contentBox).forEach(v.hitch(this,function(F){v.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",k,B);var L=this._getDisplayTitleOfRelatedRecord(W,F.relatedRecord,k);F.innerHTML=H.sanitizeHTML(L)}))},I));this._temporaryData.eventHandles.push(I);return g}});V.Operation=N([w],{constructor:function(I,g,C){this.operationName=I;this.operationData=g;this.relatedRecordsEditor=C},performUndo:function(){switch(this.operationName){case V.OPERATION_SHOW_RELATED_TABLES:return this.relatedRecordsEditor.showRelatedTables(this.operationData);
case V.OPERATION_SHOW_RELATED_RECORDS:return this.relatedRecordsEditor.showRelatedRecords(this.operationData);case V.OPERATION_SHOW_INSPECTOR:return this.relatedRecordsEditor.showInspector(this.operationData);default:return this.relatedRecordsEditor.showFirstPage(this.operationData,!0)}}});V.ATI=N([x],{constructor:function(){this._aiConnects=[];this._selection=[];this._toolTips=[]},addButton:function(I,g,C){C=C?C:"before";I=new n({label:I,"class":" atiButton "+g},y.create("div"));y.place(I.domNode,
this.deleteBtn.domNode,C);return I},updateCurrentSelectdFeature:function(I,g,C,B){this._selection&&this._selection[0]&&C&&(this._selection[0].attributes[C]=B,g.ownershipBasedAccessControlForFeatures=!0,this.refresh(),g.ownershipBasedAccessControlForFeatures=!1)},_getFields:function(I){return I.fields}});v.mixin(V,{OPERATION_SHOW_RELATED_TABLES:"showRelatedTables",OPERATION_SHOW_RELATED_RECORDS:"showRelatedRecords",OPERATION_SHOW_INSPECTOR:"showInspector",OPERATION_FIRST:"first"});return V})},"widgets/Edit/_build-generate_module":function(){define(["dojo/text!./Widget.html",
"dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dojox/grid/resources/View.html":'\x3cdiv class\x3d"dojoxGridView" role\x3d"presentation"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridHeader" dojoAttachPoint\x3d"headerNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"headerNodeContainer" style\x3d"width:9000em" role\x3d"presentation"\x3e\r\n\t\t\t\x3cdiv dojoAttachPoint\x3d"headerContentNode" role\x3d"row"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" dojoAttachPoint\x3d"hiddenFocusNode" aria-hidden\x3d"true" /\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" aria-hidden\x3d"true" /\x3e\r\n\t\x3cdiv class\x3d"dojoxGridScrollbox" dojoAttachPoint\x3d"scrollboxNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dojoxGridContent" dojoAttachPoint\x3d"contentNode" hidefocus\x3d"hidefocus" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dojox/grid/resources/_Grid.html":'\x3cdiv hidefocus\x3d"hidefocus" role\x3d"grid" dojoAttachEvent\x3d"onmouseout:_mouseOut"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterHeader" dojoAttachPoint\x3d"viewsHeaderNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterView" dojoAttachPoint\x3d"viewsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterMessages" style\x3d"display: none;" dojoAttachPoint\x3d"messagesNode"\x3e\x3c/div\x3e\r\n\t\x3cspan dojoAttachPoint\x3d"lastFocusNode" tabindex\x3d"0"\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/TemplatePicker.html":'\x3cdiv class\x3d"templatePicker"\x3e\r\n\r\n  \x3ctable dojoType\x3d"dojox.grid.DataGrid" noDataMessage\x3d"${emptyMessage}" selectionMode\x3d"none" autoHeight\x3d"${_rows}" autoWidth\x3d"${_autoWidth}"\r\n         query\x3d"{ query: \'*\' }" dojoAttachPoint\x3d"grid" class\x3d"grid"\x3e\r\n  \x3c/table\x3e\r\n  \r\n\x3c/div\x3e',"url:esri/dijit/editing/templates/Editor.html":'\x3cdiv class\x3d"esriEditor"\x3e\r\n    \x3cdiv class\x3d"esriTemplatePicker" dojoAttachPoint\x3d"templatePickerDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriDrawingToolbar" dojoAttachPoint\x3d"drawingToolbarDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"progressBar" dojoAttachPoint\x3d"progressBar" indeterminate\x3d"true" dojoType\x3d"dijit.ProgressBar" /\x3e\r\n\x3c/div\x3e',
"url:widgets/Edit/Widget.html":'\x3cdiv style\x3d"width:100%; height:100%; min-width:280px;min-width:240px;"\x3e\r\n  \x3cdiv class\x3d"edit-related-graphic-part disable" data-dojo-attach-point\x3d"editRelatedGraphicPart"\x3e\r\n    \x3cdiv class\x3d"title"\x3e${nls.editRelatedFeature}\x3c/div\x3e\r\n    \x3cdiv class\x3d"btn" data-dojo-attach-event\x3d"click:_stopEditingRelatedGraphic"\x3e${nls.done}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"editWidgetTitle"\x3e\r\n    ${nls.title}\x3cbr\x3e\x3cbr\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/Edit/css/style.css":'.jimu-widget-edit-infoWindow .related-records-editor {}.jimu-widget-edit-infoWindow .related-records-editor.fix-height-mode{height: 235px;}.jimu-widget-edit-infoWindow.esriPopupMaximized .related-records-editor.fix-height-mode{height: 100%;}.jimu-widget-edit-infoWindow .related-records-editor .operation-box {border-bottom: 1px solid #DDDDDD; height: 28px; line-height: 18px; text-align: center; position: absolute; left: 0; right: 0; font-family: "Avenir Heavy"; font-size: 16px;}.jimu-widget-edit-infoWindow .related-records-editor .previos-btn{float: left; cursor: pointer; height: 100%; line-height: 17px; margin-left: 20px;}.jimu-rtl .jimu-widget-edit-infoWindow .related-records-editor .previos-btn{float: right; margin-right: 20px; margin-left: auto;}.jimu-widget-edit-infoWindow .related-records-editor .operation-title{display: inline-block; max-width: 80%; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;}.jimu-widget-edit-infoWindow .related-records-editor .add-new-btn{display: none; float: right; cursor: pointer; margin-right: 20px; background-image: url("images/add_normal.svg"); background-repeat: no-repeat; width: 16px; height: 16px;}.jimu-rtl .jimu-widget-edit-infoWindow .related-records-editor .add-new-btn{float: left; margin-right: auto; margin-left: 20px;}.jimu-widget-edit-infoWindow .related-records-editor .add-new-btn:hover{background-image: url("images/add_hover.svg");}.jimu-widget-edit-infoWindow .related-records-editor.fix-height-mode .content-box{position: absolute; top: 45px; bottom: 0; left: 10px; right: 0px; overflow-y: auto; overflow-x: hidden;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .title-box{font-family: "Avenir Heavy"; height: 34px; line-height: 34px; padding-left: 10px; padding-right: 10px;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .title-box.font-normal{font-weight: normal; color: #666666;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item{position: relative; min-height: 30px; line-height: 30px; width: 100%; background-color: #ffffff; color: #000000; padding-left: 10px; padding-right: 30px; background-image: url("images/edit_default.svg"); background-repeat: no-repeat; background-position: right 10px center; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item div{white-space: nowrap; text-overflow: ellipsis; overflow: hidden;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item .relationshipName{opacity: 0.5;}.jimu-rtl .jimu-widget-edit-infoWindow .related-records-editor .content-box .item{background-position: left 10px center; padding-left: 30px; padding-right: 10px;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item.disable{opacity: 0.4;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item.oddLine{background-color: #f3f3f3;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item.enable:hover{cursor: pointer; border-color: rgba(0, 0, 0, 1.0); font-family: "Avenir Heavy"; background-image: url("images/edit_hover.svg");}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item .edit-icon{position: absolute; right: 5px; top: 7px;}.jimu-rtl .jimu-widget-edit-infoWindow .related-records-editor .content-box .item .edit-icon{right: auto; left: 10px;}.jimu-widget-edit-infoWindow .related-records-editor .esriAttributeInspector{padding-right: 2px;}.jimu-widget-edit-infoWindow .related-records-editor .esriAttributeInspector .atiLayerName{display: none;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .title-box .jimu-dijit-dropdownmenu{float: right; right: 2px; top: 6px;}.jimu-rtl .jimu-widget-edit-infoWindow .related-records-editor .content-box .title-box .jimu-dijit-dropdownmenu{float: left; left: 2px; right: auto;}.jimu-widget-edit-infoWindow .related-records-editor .esriAttributeInspector .atiButton.atiDeleteButton.hidden{display: none !important;}.jimu-widget-FilterEditor {}.jimu-widget-FilterEditor .flDropDown {width: 100%; -webkit-appearance: menulist-button; height: 30px; border-radius: 4px; border: 1px solid #b9b9b9; color: #838383; margin-top: 2px; margin-bottom: 10px;}.jimu-widget-FilterEditor .searchtextbox {border: 1px solid #b9b9b9; color: #838383; width: 100%; padding: 5px; margin-bottom: 1px; border-radius: 4px 4px 0px 0px;}.jimu-widget-FilterEditor .searchtextbox:focus {border: 1px solid #838383;}.jimu-widget-FilterEditor .searchtextbox:hover {border: 1px solid #838383;}.jimu-widget-FilterEditor .jimu-input {font-size: 12px; height: auto;}.jimu-widget-edit {position: relative;}.jimu-widget-edit .edit-related-graphic-part{overflow: hidden; font-size: 14px;}.jimu-widget-edit .edit-related-graphic-part.disable{display: none;}.jimu-widget-edit .edit-related-graphic-part .title{float: left; max-width: 220px; height: 40px; line-height: 14px; padding-top: 5px;}.jimu-rtl .jimu-widget-edit .edit-related-graphic-part .title{float: right;}.jimu-widget-edit .edit-related-graphic-part .btn{float: right; min-width: 90px; max-width: 110px; cursor: pointer; background-color: #009966; color: #ffffff; height: 30px; line-height: 30px; text-align: center;}.jimu-rtl .jimu-widget-edit .edit-related-graphic-part .btn{float: left;}.jimu-widget-edit .templatePicker {position: absolute; width: 100%; bottom: 53px;}.jimu-widget-edit .dojoxGridRow {border: 0;}.jimu-widget-edit .dojoxGridScrollbox {overflow-x: hidden;}.jimu-widget-edit .templatePicker .grid .dojoxGridCell {border: 0px solid #FFFFFF;}.jimu-widget-edit .esriEditor {position: absolute; bottom: 0; height: 30px; width: 100%;}.jimu-widget-edit .esriDrawingToolbar {position: absolute; right: 0; left: 0; bottom: 0; min-height: 50px;}.jimu-widget-edit-infoWindow .esriAttributeInspector {width: 100%;}.jimu-widget-edit-infoWindow .esriAttributeInspector .atiAttributes table {width: 100%;}.jimu-widget-edit-infoWindow .esriAttributeInspector .atiLabel {}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitTextBox {width: 100%; border-color: #dddddd; margin: 3px auto;}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitInputField {}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitTextBox .dijitInputInner {}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitTextBoxFocused {border-color: #afafaf !important; box-shadow: 0 0 0 #ffffff !important;}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitTextBoxHover{background-color: #ffffff; background-image: none; border-color: #afafaf !important;}.jimu-widget-edit-infoWindow .esriAttributeInspector .atiRichTextField{}.jimu-widget-edit-infoWindow .esriAttributeInspector div.dijitEditorIFrameContainer {height: 78px;}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitTextBox.dijitTextArea {height: 32px;}.jimu-widget-edit-infoWindow .esriAttributeInspector .atiButtons {padding-top: 10px; height: 35px;}.jimu-widget-edit-infoWindow .esriAttributeInspector .atiButton {margin: 0 0 0 10px; float: none; width: auto; float: right;}.jimu-rtl .jimu-widget-edit-infoWindow .esriAttributeInspector .atiButton {margin: 0 10px 0 0px; float: left;}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitButtonNode{border: 1px solid #979797; color: #000000; border-radius: 0px; background-color: #ffffff; background-image: none;}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitButtonText{height: 22px; min-width: 60px; line-height: 22px;}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitButtonNode:hover{border: 1px solid #555555; font-family: "Avenir Heavy";}.jimu-widget-edit-infoWindow .esriAttributeInspector .atiButton.disable .dijitButtonNode{border: 1px solid #ccc; color: #ccc; font-family: "inherit";}.jimu-widget-edit-infoWindow .jimu-popup{}.jimu-widget-edit-infoWindow .jimu-popup .title{display: none;}.jimu-widget-edit-infoWindow .jimu-popup .content{line-height: 16px;}.jimu-widget-edit-infoWindow .jimu-popup .jimu-btn{border: 1px solid #979797; color: #000000; border-radius: 0px; background-color: #ffffff; background-image: none; line-height: 27px;}.jimu-widget-edit-infoWindow .jimu-popup .jimu-btn:hover{border: 1px solid #555555; font-family: "Avenir Heavy";}',
"*now":function(N){N(['dojo/i18n!*preload*widgets/Edit/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/i18n!esri/nls/jsapi dojo/on dojo/query dojo/json dojo/Deferred dojo/aspect dojo/promise/all dijit/_WidgetsInTemplateMixin jimu/BaseWidget jimu/MapManager jimu/PanelManager jimu/LayerInfos/LayerInfos jimu/dijit/LoadingIndicator jimu/dijit/Popup jimu/portalUrlUtils jimu/SelectionManager jimu/Role esri/dijit/editing/Editor esri/dijit/editing/Util esri/dijit/Popup esri/dijit/editing/TemplatePicker esri/geometry/Extent esri/geometry/Point esri/symbols/SimpleMarkerSymbol esri/renderers/jsonUtils esri/renderers/SimpleRenderer esri/graphic esri/domUtils esri/tasks/query esri/tasks/QueryTask dijit/form/Button ./utils ./FilterEditor ./RelatedRecordsEditor".split(" "),function(N,
v,z,y,m,c,f,a,n,l,b,u,w,e,p,h,r,d,x,D,q,H,t,G,T,A,S,O,V,I,g,C,B,J,M,Q,R,X){var W=N([w,u],{name:"Edit",baseClass:"jimu-widget-edit",editor:null,_defaultStartStr:"",_defaultAddPointStr:"",_mapInfoStorage:null,_jimuLayerInfos:null,editPopup:null,_configEditor:null,_layerObjectsParaForTempaltePicker:null,_createOverDef:null,_releaseEventArrayAfterActive:null,_releaseEventArrayAfterClose:null,_releaseEventArrayAfterDestory:null,_canCreateLayersAreAllInvisibleFlag:null,_layerInfoParamArrayUseForRervertRenderre:null,
layerInfosParam:null,tableInfosParam:null,layerInfosParamClone:null,tableInfosParamClone:null,_tableInfoParamDef:null,_hasEditPrivilege:null,_panelManager:null,_originalCloasePanel:null,_changedTemplatesOfTemplatePicker:null,_releaseEventArrayAfterEditingRelatedGraphic:null,_isInEditingRelatedGraphicSession:null,_needToRequeryFeatureArray:null,_isEditableLayerStore:null,_layerInfosInConfig:null,_settingsParam:null,_temporaryDataForEditingRelatedGraphicSession:null,_layerInfosChangedWhenEditingSessionFlag:null,
_newAddedLayersWhileEditWidgetIsClosed:null,postMixInProperties:function(){this.nls.done=window.jimuNls.common.done},startup:function(){this.inherited(arguments);this.editPopup=new W.EditPopup(null,y.create("div",{"class":"jimu-widget-edit-infoWindow"},null,this.map.root));this.loading=new r({hidden:!0});this.loading.placeAt(this.domNode);this._prepareCreating()},destroy:function(){this._worksAfterDestory();this.inherited(arguments)},_refresh:function(){this.onClose();this._worksAfterDestory();this._prepareCreating();
this.onOpen()},onOpen:function(){this._newAddedLayersWhileEditWidgetIsClosed&&0<this._newAddedLayersWhileEditWidgetIsClosed.length?this._refresh():("active"!==this.state&&this.widgetManager.activateWidget(this),this.editor&&this._settingsParam&&(this._changeToServiceRenderer(this._settingsParam),this._onLayerInfosChanged()),this._bindEventAfterOpen())},onClose:function(){this._revertToLayerRenderer();this._releaseEventAfterClose()},_prepareCreating:function(){this._init();this.loading.show();this._asyncPrepareDataAtStart().then(v.hitch(this,
function(){if("BoxTheme"===this.appConfig.theme.name){var k=1050;this.loading.show()}else k=1;setTimeout(v.hitch(this,function(){this.loading.hidden||this.loading.hide();this.widgetManager.activateWidget(this);this._createEditor()}),k);this._getTableInfosParam().then(v.hitch(this,function(F){this.tableInfosParam=F;this.tableInfosParamClone=this._cloneLayerOrTableInfosParam(this.tableInfosParam);this._tableInfoParamDef.resolve()}));this.loading.hide()}),v.hitch(this,function(){this.loading.hide()}))},
_init:function(){this._mapInfoStorage={resetInfoWindow:null,snappingTolerance:null,editorATIonLayerSelectionChange:null};this._editorMapClickHandlers=[];this._layerObjectsParaForTempaltePicker=[];this._configEditor=v.clone(this.config.editor);this._releaseEventArrayAfterActive=[];this._releaseEventArrayAfterClose=[];this._releaseEventArrayAfterDestory=[];this._canCreateLayersAreAllInvisibleFlag=!1;this._layerInfoParamArrayUseForRervertRenderre=[];this._createOverDef=new n;this._tableInfoParamDef=
new n;this._hasEditPrivilege=!0;this._panelManager=p.getInstance();this._changedTemplatesOfTemplatePicker=[];this._releaseEventArrayAfterEditingRelatedGraphic=[];this._isInEditingRelatedGraphicSession=!1;this._needToRequeryFeatureArray=[];this._jimuLayerInfos=h.getInstanceSync(this.map,this.map.itemInfo);this._isEditableLayerStore={};this._layerInfosInConfig=this._getLayerInfosInConfig();this._temporaryDataForEditingRelatedGraphicSession={};this._layerInfosChangedWhenEditingSessionFlag=!1;this._newAddedLayersWhileEditWidgetIsClosed=
[]},_initEditPrivilege:function(k){this._hasEditPrivilege=!0;if(k){var F=new q({id:k.roleId?k.roleId:k.role,role:k.role});k.privileges&&F.setPrivileges(k.privileges);this._hasEditPrivilege=F.canEditFeatures()}return this._hasEditPrivilege},beginEditingByFeatures:function(k,F){if(F){var L=null,E=k[0],K=E&&E.geometry||F._wabProperties&&F._wabProperties.popupInfo.originalFeature.geometry;K&&(L="point"===K.type?K:K.getExtent().getCenter());this._createOverDef.then(v.hitch(this,function(){"active"!==this.state&&
this.widgetManager.activateWidget(this);z.forEach(this._jimuLayerInfos.getLayerInfoArray(),function(Y){Y.layerObject&&Y.layerObject.clearSelection&&D.getInstance().clearSelection(Y.layerObject)},this);if(E&&E.geometry)D.getInstance().setSelection(F,k).then(v.hitch(this,function(){var Y=F.getSelectedFeatures();this.editor._updatePopupButtons(Y);this.editor._onEditFeature(Y,L)}));else{this.editPopup.show(L);var P=v.getObject("_wabProperties.popupInfo.originalFeature",!1,F),U=v.getObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",
!1,F);this._createRelatedRecordsEditor(P).then(v.hitch(this,function(){!U&&E?this._relatedRecordsEditor.showInspector(this._relatedRecordsEditor._createOperationData(null,null,this._jimuLayerInfos.getTableInfoById(F.id),E)):this._relatedRecordsEditor.showRelatedRecords(this._relatedRecordsEditor._createOperationData(U.feature,U.oriJimuLayerInfo,U.destJimuLayerInfo))}))}}))}},onActive:function(){this._hasEditPrivilege&&(this.disableWebMapPopup(),this._bindEventAfterActive(),this._configEditor.usingSaveButton&&
(this._originalCloasePanel=this._panelManager.closePanel,this._panelManager.closePanel=this._wrapExistFunctionWithConfirmDialog(this._panelManager,this._originalCloasePanel)))},onDeActive:function(){this._hasEditPrivilege&&(this.enableWebMapPopup(),this._releaseEventAfterActive(),this.editor&&this.editor.templatePicker&&this.editor.templatePicker.clearSelection(),this._configEditor.usingSaveButton&&(this._panelManager.closePanel=this._originalCloasePanel),z.forEach(this._needToRequeryFeatureArray,
function(k){this._requeryFeature(k)},this),this._needToRequeryFeatureArray=[])},disableWebMapPopup:function(){var k=e.getInstance();k.disableWebMapPopup();this.map.infoWindow.hide();this.map.setInfoWindow(this.editPopup);this._enableMapClickHandler();null===this._mapInfoStorage.resetInfoWindow&&(this._mapInfoStorage.resetInfoWindow=k.resetInfoWindow,this.own(c(this.map.infoWindow,"show",v.hitch(this,function(){window.appInfo.isRunInMobile&&(this.map.infoWindow.maximize(),setTimeout(v.hitch(this,function(){y.addClass(this.editPopup.domNode,
"esriPopupMaximized")}),1))}))));k.resetInfoWindow=v.hitch(this,function(){});this.map.snappingManager&&void 0!==this._configEditor.snappingTolerance&&(this._mapInfoStorage.snappingTolerance=this.map.snappingManager.tolerance,this.map.snappingManager.tolerance=this._configEditor.snappingTolerance)},enableWebMapPopup:function(){var k=e.getInstance(),F=k.getMapInfoWindow();this._mapInfoStorage.resetInfoWindow&&(this.map.setInfoWindow(F.bigScreen),k.isMobileInfoWindow=!1,k.resetInfoWindow=v.hitch(k,
this._mapInfoStorage.resetInfoWindow),this._mapInfoStorage.resetInfoWindow=null,k.resetInfoWindow(),this._disableMapClickHandler(),this.editPopup.hide(),this._isEditingSession||this.editor._clearSelection(),k.enableWebMapPopup());this.map.snappingManager&&null!==this._mapInfoStorage.snappingTolerance&&(this.map.snappingManager.tolerance=this._mapInfoStorage.snappingTolerance)},_enableMapClickHandler:function(){this.editor&&(this._editorMapClickHandlers.push(this.editor._mapClickHandler),this.editor._enableMapClickHandler(),
this._editorMapClickHandlers.push(this.editor._mapClickHandler))},_disableMapClickHandler:function(){this.editor&&(this.editor._disableMapClickHandler(),z.forEach(this._editorMapClickHandlers,function(k){k&&k.remove&&k.remove()},this),this._editorMapClickHandlers=[])},_cloneLayerOrTableInfosParam:function(k){var F=[];z.forEach(k,function(L){var E=L.featureLayer;L.featureLayer=null;var K=v.clone(L);K.featureLayer=E;L.featureLayer=E;F.push(K)},this);return F},_isTemporaryFeatureForAddOnlyMode:function(k){k=
k.getLayer();this._jimuLayerInfos.getLayerOrTableInfoById(k&&k.id)},_getDefaultFieldInfos:function(k){(k=Q.getFieldInfosFromWebmap(k,this._jimuLayerInfos))&&(k=z.filter(k,function(F){return F.visible||F.isEditable}));return k},_getDefaultLayerInfoById:function(k){var F={featureLayer:{}};F.featureLayer.id=k;F.allowCreate=!0;F.allowDelete=!0;F.disableGeometryUpdate=!1;(k=this._getDefaultFieldInfos(k))&&0<k.length&&(F.fieldInfos=k);return F},_getDefaultTableInfos:function(){var k=[],F=this._jimuLayerInfos.getTableInfoArray();
z.forEach(F,function(L){L=this._getDefaultLayerInfoById(L.id);k.push(L)},this);return k},_getDefaultLayerInfos:function(){for(var k=[],F=this.map.graphicsLayerIds.length-1;0<=F;F--){var L=this.map.getLayer(this.map.graphicsLayerIds[F]);"Feature Layer"===L.type&&L.url&&(L=this._getDefaultLayerInfoById(L.id),k.push(L))}return k},_asyncPrepareDataAtStart:function(){var k=[];z.forEach(this._layerInfosInConfig,function(F){var L=this._jimuLayerInfos.getLayerInfoByTopLayerId(F.featureLayer.id);L&&(L=L.isEditable(),
L._layerInfoInConfig=F,k.push(L))},this);return b(k).then(v.hitch(this,function(F){z.forEach(F,function(L,E){E=k[E]._layerInfoInConfig;this._isEditableLayerStore[E&&E.featureLayer&&E.featureLayer.id]=L},this)}))},_getLayerInfosInConfig:function(){return this._configEditor.honorSettingOfWebmap?this._getDefaultLayerInfos():this._configEditor.layerInfos?0<this._configEditor.layerInfos.length?this._converConfiguredLayerInfos(this._configEditor.layerInfos):this._getDefaultLayerInfos():[]},_converConfiguredLayerInfos:function(k){function F(L,
E){for(var K=null,P=0;P<L.graphicsLayerIds.length;P++){var U=L.getLayer(L.graphicsLayerIds[P]);if(U&&U.url&&x.removeProtocol(U.url.toLowerCase())===x.removeProtocol(E.toLowerCase())){K=U;break}}return K}z.forEach(k,function(L){if(!L.featureLayer.id&&L.featureLayer.url){var E=F(this.map,L.featureLayer.url);E&&(L.featureLayer.id=E.id)}var K=[],P=Q.getFieldInfosFromWebmap(L.featureLayer.id,this._jimuLayerInfos);z.forEach(L.fieldInfos,function(U){var Y=null;if(P)for(var Z=0;Z<P.length;Z++)if(U.fieldName===
P[Z].fieldName){P[Z].label=U.label;P[Z].isEditableSettingInWebmap=P[Z].isEditable;P[Z].isEditable=U.isEditable;Y=P[Z];break}if(void 0===U.visible)Y?(Y.isEditable||Y.isEditableSettingInWebmap||Y.visible)&&K.push(Y):K.push(U);else if(U.visible||U.isEditable)Y?K.push(Y):K.push(U)},this);0!==K.length&&(L.fieldInfos=K)},this);return k},_getLayerInfoOrTableInfoParamById:function(k){var F=null;z.some(this.layerInfosParam.concat(this.tableInfosParam),function(L){if(L.featureLayer.id===k)return F=L,!0});return F},
_getLayerInfosParam:function(){var k=[];z.forEach(this._layerInfosInConfig,function(F){var L=F.featureLayer.id,E=this.map.getLayer(L);E&&this._isEditableLayerStore[L]&&(F.featureLayer=E,k.push(F))},this);this.layerInfosParam=k;this.layerInfosParamClone=this._cloneLayerOrTableInfosParam(this.layerInfosParam);return k},_setTemplatePickerLayerObjectsParam:function(k){k&&(this._layerObjectsParaForTempaltePicker=k)},_obtainTemplatePickerLayerObjectsParam:function(k){this._layerObjectsParaForTempaltePicker=
[];var F=[];z.forEach(this._jimuLayerInfos.getLayerInfoArray(),function(L){z.some(k,function(E){return E.featureLayer&&L.id===E.featureLayer.id?(F.push(E),!0):!1},this)},this);z.forEach(F,function(L){if(L.featureLayer){var E=this._jimuLayerInfos.getLayerInfoByTopLayerId(L.featureLayer.id);E&&E.isShowInMap()&&E.isInScale()&&Q.getEditCapabilities(E.layerObject,L).canCreate&&this._layerObjectsParaForTempaltePicker.push(L.featureLayer);!this._canCreateLayersAreAllInvisibleFlag&&this._isEditableLayerStore[L.featureLayer.id]&&
Q.getEditCapabilities(E.layerObject,L).canCreate&&!L.featureLayer.visible&&(this._canCreateLayersAreAllInvisibleFlag=!0)}},this);return this._layerObjectsParaForTempaltePicker},_getTemplatePicker:function(k){k=this._obtainTemplatePickerLayerObjectsParam(k);k=new T({featureLayers:k,grouping:!0,rows:"auto",columns:"auto",style:(this._configEditor.toolbarVisible?"":"bottom: 0px")+";"+(this._configEditor.useFilterEdit?"top: "+W.TOP_WITH_TEMPLATE_FILTER:"top: "+W.TOP)},y.create("div",{},this.domNode));
k.startup();return k},_getSettingsParam:function(){var k={map:this.map,createOptions:{polygonDrawTools:[H.CREATE_TOOL_ARROW,H.CREATE_TOOL_AUTOCOMPLETE,H.CREATE_TOOL_CIRCLE,H.CREATE_TOOL_ELLIPSE,H.CREATE_TOOL_RECTANGLE,H.CREATE_TOOL_TRIANGLE,H.CREATE_TOOL_POLYGON,H.CREATE_TOOL_FREEHAND_POLYGON],polylineDrawTools:[H.CREATE_TOOL_POLYLINE,H.CREATE_TOOL_FREEHAND_POLYLINE]}},F;for(F in this._configEditor)k[F]=this._configEditor[F];k.layerInfos=this._getLayerInfosParam();k.templatePicker=this._getTemplatePicker(k.layerInfos);
void 0!==this._configEditor.popupTolerance&&(k.singleSelectionTolerance=this._configEditor.popupTolerance);return k},_createEditor:function(){var k={settings:this._getSettingsParam()};this._settingsParam=k.settings;this._worksBeforeCreate(k.settings);this.editor=new H(k,y.create("div",{},this.domNode));this.editor.startup();this._worksAfterCreate(k.settings)},_addButtonToInspector:function(){var k=new M({label:this.nls.close,"class":" atiButton close-button"},y.create("div"));y.place(k.domNode,this.editor.attributeInspector.deleteBtn.domNode,
"before");this.own(c(k,"click",v.hitch(this,function(){this.editPopup.hide()})));if(this._configEditor.usingSaveButton){k=new M({label:window.jimuNls.common.save,"class":" atiButton save-button disable"},y.create("div"));y.place(k.domNode,this.editor.attributeInspector.deleteBtn.domNode,"after");var F=this.editor.attributeInspector;this.own(c(k,"click",v.hitch(this,function(){if(this._isEditingSession){var E=F._currentFeature&&F._currentFeature._wabSetTemporaryAttributes,K=F._currentFeature,P=K&&
K.getLayer(),U=new g(v.clone(K.toJson()));if(P){for(var Y in E)E.hasOwnProperty(Y)&&"function"!==typeof E[Y]&&(K.attributes[Y]=E[Y]);E=new g;E.setAttributes(K.attributes);this.editor._applyEdits([{layer:P,updates:[E],preUpdates:[U]}],v.hitch(this,function(){this._stopEditingSession()}),!0)}}})));var L=this;F.onAttributeChange=v.hitch(F,function(E,K,P){L._startEditingSession();F._currentFeature._wabSetTemporaryAttributes[K]=P;F._currentFeature.attributes[K]=P});this.editPopup.hideWidthConfirmDialog=
this._wrapExistFunctionWithConfirmDialog(this.editPopup,this.editPopup.hideWidthConfirmDialog);this.editor.attributeInspector.next=this._wrapExistFunctionWithConfirmDialog(this.editor.attributeInspector,this.editor.attributeInspector.next);this.editor.attributeInspector.previous=this._wrapExistFunctionWithConfirmDialog(this.editor.attributeInspector,this.editor.attributeInspector.previous);this.own(l.before(this.editor,"_deleteFeature",v.hitch(this,function(){this._configEditor.usingSaveButton&&this._stopEditingSession()})))}},
_startEditingSession:function(){var k=this.editor.attributeInspector;k._currentFeature&&!k._currentFeature._wabSetTemporaryAttributes&&(k._currentFeature._wabSetTemporaryAttributes={});this._isEditingSession||(this._isEditingSession=!0,this._disableMapClickHandler(),this._temporatyMapClickHandle=c(this.map,"click",v.hitch(this,function(){this.editPopup.hide("clear-selection")})),window.onbeforeunload=v.hitch(this,function(){return""}));f(".atiButton.save-button",this.editPopup.domNode).removeClass("disable")},
_stopEditingSession:function(){if(this.editor){var k=this.editor.attributeInspector;k._currentFeature&&k._currentFeature._wabSetTemporaryAttributes&&(k._currentFeature._wabSetTemporaryAttributes=null);this._isEditingSession&&(this._isEditingSession=!1,"active"===this.state?this._enableMapClickHandler():(this.editor._clearSelection(),this.editPopup.hide()),this._temporatyMapClickHandle&&this._temporatyMapClickHandle.remove(),window.onbeforeunload=null);f(".atiButton.save-button",this.editPopup.domNode).addClass("disable")}},
_wrapExistFunctionWithConfirmDialog:function(k,F){return v.hitch(this,function(L){if(this._isEditingSession){if(!this.editPopup.jimuPopup){var E=arguments;this._popupConfirmDialog(v.hitch(this,function(){F.apply(k,E);"clear-selection"===L&&this.editor._clearSelection()}),null)}}else F.apply(k,arguments)})},_popupConfirmDialog:function(k,F){var L=new n,E=f(".esriPopupWrapper",this.editPopup.domNode)[0];this._isEditingSession&&!this.editPopup.jimuPopup&&E?this.editPopup.jimuPopup=new d({content:window.jimuNls.popup.leaveConfirm,
container:E,width:400,height:175,buttons:[{label:window.jimuNls.common.leave,onClick:v.hitch(this,function(){this.editPopup.jimuPopup.close();this.editPopup.jimuPopup=null;this._stopEditingSession();this._refreshAttributeInspector();k&&k();L.resolve(!0)})},{label:window.jimuNls.common.stay,classNames:["jimu-btn-cancle"],onClick:v.hitch(this,function(){this.editPopup.jimuPopup.close();this.editPopup.jimuPopup=null;F&&F();L.resolve(!1)})}]}):L.resolve(!0);return L},_addFilterEditor:function(k){this._configEditor.useFilterEdit&&
(this._filterEditor=new R({_settings:k,_editWidget:this},y.create("div",{},this.domNode)))},_worksBeforeCreate:function(k){var F="\x3cbr/\x3e("+this.nls.pressStr+"\x3cb\x3e"+this.nls.ctrlStr+"\x3c/b\x3e "+this.nls.snapStr+")";this._defaultStartStr=m.toolbars.draw.start;this._defaultAddPointStr=m.toolbars.draw.addPoint;m.toolbars.draw.start+=F;m.toolbars.draw.addPoint+=F;this._changeToServiceRenderer(k)},_worksAfterCreate:function(k){this._addButtonToInspector();this._configEditor.toolbarVisible&&
this._disableDeleteBtnInToolbar();this.editPopup.resize(500,251);this.editor.templatePicker.update(!0);this._addFilterEditor(k);this._bindEventsAfterCreate(k);this._changeMessageForTemplatePicker();this.ATILoading=(new r({hidden:!0})).placeAt(this.editor.attributeInspector.domNode);this.editor.own(l.before(this.editor._selectionHelper,"selectFeatures",v.hitch(this.editor._selectionHelper,function(E,K,P,U){return[z.filter(E,function(Y){if(!0===Y.visible&&!0===Y._isMapAtVisibleScale())return!0}),K,
P,U]})));var F=k=null,L=t.getSelection(this._settingsParam.layers);L&&L.length&&(k=L[0],F=k.getLayer());F&&D.getInstance().addFeaturesToSelection(F,[k]);this._createOverDef.resolve()},_worksAfterDestory:function(){this._stopEditingRelatedGraphic();m.toolbars.draw.start=this._defaultStartStr;m.toolbars.draw.addPoint=this._defaultAddPointStr;this._filterEditor&&this._filterEditor.destroy();this._releaseEventAfterDestory();this.editor&&this.editor.destroy();this.editor=null},_bindEventsAfterCreate:function(k){this.own(c(this.editor.editToolbar,
"graphic-move-stop",v.hitch(this,this._onGraphicMoveStop)));this.own(c(this.editor.attributeInspector,"next",v.hitch(this,this._onNextOfEditorATI)));var F=c(this.editPopup,"show",v.hitch(this,this._onEditorPopupShow));this._releaseEventArrayAfterDestory.push(F);F=c(this.editPopup,"hide",v.hitch(this,this._onEditorPopupHide));this._releaseEventArrayAfterDestory.push(F);z.forEach(k.layerInfos,function(L){F=c(L.featureLayer,"selection-complete",v.hitch(this,this._onLayerSelectionChange));this._releaseEventArrayAfterDestory.push(F)},
this);F=l.before(this.editor.templatePicker.grid,"onRowClick",v.hitch(this,function(){"active"!==this.state&&this.widgetManager.activateWidget(this)}));this._releaseEventArrayAfterDestory.push(F);k=c(this.editor.templatePicker,"selection-change",v.hitch(this,function(){this.editor.templatePicker&&!this.editor.templatePicker.getSelected()&&this._layerInfosChangedWhenEditingSessionFlag&&(this._layerInfosChangedWhenEditingSessionFlag=!1,this._isInEditingRelatedGraphicSession||this._onLayerInfosChanged())}));
this._releaseEventArrayAfterDestory.push(k);F=l.before(this.editor,"_activateDrawToolbar",v.hitch(this,function(){this.editor&&this.editor.drawingToolbar&&this.editor.drawingToolbar._tools&&this.editor.drawingToolbar._tools.EDITING&&(this.editor.drawingToolbar._tools.EDITING._geometryType=null);return arguments}));this._releaseEventArrayAfterDestory.push(F);F=c(this._jimuLayerInfos,"layerInfosChanged",v.hitch(this,this._onLayerAddedOrRemoved));this._releaseEventArrayAfterDestory.push(F)},_releaseEventAfterDestory:function(){z.forEach(this._releaseEventArrayAfterDestory,
function(k){k.remove()},this);this._releaseEventArrayAfterDestory=[]},_bindEventAfterActive:function(){var k=l.before(this.map,"onClick",v.hitch(this,this._beforeMapClick));this._releaseEventArrayAfterActive.push(k)},_releaseEventAfterActive:function(){z.forEach(this._releaseEventArrayAfterActive,function(k){k.remove()},this);this._releaseEventArrayAfterActive=[]},_bindEventAfterOpen:function(){var k=c(this._jimuLayerInfos,"layerInfosIsShowInMapChanged",v.hitch(this,this._onLayerInfosChanged));this._releaseEventArrayAfterClose.push(k);
k=c(this._jimuLayerInfos,"layerInfosReorder",v.hitch(this,this._onLayerInfosChanged));this._releaseEventArrayAfterClose.push(k);k=c(this.map,"zoom-end",v.hitch(this,this._onLayerInfosChanged));this._releaseEventArrayAfterClose.push(k)},_releaseEventAfterClose:function(){z.forEach(this._releaseEventArrayAfterClose,function(k){k.remove()},this);this._releaseEventArrayAfterClose=[]},_onLayerAddedOrRemoved:function(k,F){var L=this._configEditor.layerInfos&&0===this._configEditor.layerInfos.length;L=this._configEditor.honorSettingOfWebmap||
L;F===h.ADDED&&L?z.some(this._jimuLayerInfos.getLayerInfoArrayOfWebmap(),function(E){return E.id===k.id?!0:!1})||k.isEditable().then(v.hitch(this,function(E){E&&("opened"===this.state||"active"===this.state?this._refresh():this._newAddedLayersWhileEditWidgetIsClosed.push(k.id))})):F===h.REMOVED&&this._onLayerInfosChanged()},_onLayerInfosChanged:function(){if(this.editor.templatePicker&&this.editor.templatePicker.getSelected())this._layerInfosChangedWhenEditingSessionFlag=!0;else{var k=[];this._isInEditingRelatedGraphicSession?
this._startEditingRelatedGraphic(this._temporaryDataForEditingRelatedGraphicSession.currentOperationData,this._temporaryDataForEditingRelatedGraphicSession.currentIntegrityField,!0,!0):(k=this._obtainTemplatePickerLayerObjectsParam(this._settingsParam.layerInfos),this._update(k))}},_changeToServiceRenderer:function(k){z.forEach(k.layerInfos,function(F){var L=F.featureLayer.renderer,E=a.parse(F.featureLayer._json).drawingInfo.renderer,K=null;K=null;"esri.renderer.HeatmapRenderer"===L.declaredClass&&
(K=V.fromJson(E),K="esri.renderer.HeatmapRenderer"===K.declaredClass?new I(new O({size:5})):K,F._layerRenderer=L,this._layerInfoParamArrayUseForRervertRenderre.push(F),F.featureLayer.setRenderer(K),F.featureLayer.redraw())},this)},_revertToLayerRenderer:function(){z.forEach(this._layerInfoParamArrayUseForRervertRenderre,function(k){k._layerRenderer&&(k.featureLayer.setRenderer(k._layerRenderer),k.featureLayer.redraw())},this);this._layerInfoParamArrayUseForRervertRenderre=[]},_requeryFeature:function(k,
F){var L=k&&k.getLayer&&k.getLayer();if(L&&!this._isTemporaryFeatureForAddOnlyMode(k)){var E=new J(L.url),K=new B;L=k.attributes[L.objectIdField];K.objectIds=[L];K.outSpatialReference=this.map.spatialReference;K.returnGeometry=!1;K.outFields=["*"];F&&this.ATILoading.show();L&&E.execute(K).then(v.hitch(this,function(P){if(P&&P.features&&P.features[0]){P=P.features[0];for(var U in k.attributes)k.attributes.hasOwnProperty(U)&&"function"!==typeof k.attributes[U]&&k.attributes[U]!==P.attributes[U]&&(k.attributes[U]=
P.attributes[U]);this._refreshAttributeInspector()}F&&this.ATILoading.hide()}),v.hitch(this,function(){F&&this.ATILoading.hide()}))}},_pushToNeedRequeryFeatureArray:function(k){var F=k&&k.getLayer&&k.getLayer();if(F){var L=k.attributes[F.objectIdField];z.some(this._needToRequeryFeatureArray,function(E){var K=E.getLayer();E=E.attributes[K.objectIdField];if(F.id===K.id&&L===E)return!0},this)||this._needToRequeryFeatureArray.push(k)}},_updateSelectedFeature:function(k){k&&(k.getLayer().applyEdits(null,
[k]),this.editor._clearSelection())},_autoApplyEditWhenGeometryIsModified:function(){var k=this.editor.editToolbar.getCurrentState(),F=k&&k.graphic;this._configEditor.autoApplyEditWhenGeometryIsMoved&&(this._checkStickyMoveTolerance()?this._updateSelectedFeature(F):k.isModified&&"point"!==F.geometry.type&&this._updateSelectedFeature(F))},_checkStickyMoveTolerance:function(){var k=!0,F=this.editor.editToolbar.getCurrentState();if(F=F&&F.graphic)this._isOutStickyMoveToleranceCheckedByMoveTrack(F)||
(this._revertGraphicPosition(F),k=!1),delete F._moveTrack,delete F._originalGeometryAtMoveStart;return k},_isOutStickyMoveToleranceCheckedByOriginalGeometry:function(k){var F=!0;if("point"===k.geometry.type){var L=k._originalGeometryAtMoveStart;var E=k.geometry}else k.geometry.getExtent&&k._originalGeometryAtMoveStart.getExtent&&(L=k._originalGeometryAtMoveStart.getExtent().getCenter(),E=k.geometry.getExtent().getCenter());if(this._configEditor.stickyMoveTolerance&&L&&E){var K=this.map.extent.getWidth();
K/=this.map.width;K*=this._configEditor.stickyMoveTolerance;k=new A(0,0,K,K,k.spatialReference);k=k.centerAt(L);k.contains(E)&&(F=!1)}return F},_isOutStickyMoveToleranceCheckedByMoveTrack:function(k){var F=!0;var L=k._moveTrack;var E;L&&(E=new S(L.x,L.y,k.spatialReference));this._configEditor.stickyMoveTolerance&&E&&(L=this.map.extent.getWidth(),L/=this.map.width,L*=this._configEditor.stickyMoveTolerance,k=new A(-L/2,-L/2,L,L,k.spatialReference),k.contains(E)&&(F=!1));return F},_revertGraphicPosition:function(k){var F=
k._moveTrack;if(F){switch(k.geometry.type){case "point":k.geometry.x-=F.x;k.geometry.y+=F.y;break;case "polygon":z.forEach(k.geometry.rings,function(L){z.forEach(L,function(E){E[0]-=F.x;E[1]+=F.y})});break;case "polyline":z.forEach(k.geometry.paths,function(L){z.forEach(L,function(E){E[0]-=F.x;E[1]+=F.y})});break;case "multiPoint":z.forEach(k.geometry.points,function(L){L[0]-=F.x;L[1]+=F.y});break;default:return}this._configEditor.autoApplyEditWhenGeometryIsMoved||z.forEach(this.editor.editToolbar._getAffectedTools("MOVE"),
function(L){L.suspend()},this);this.editor._clearSelection();k.draw()}},_recordsSelectedFeatureInfoWhenMoveStart:function(k){(k=k&&k.graphic)&&k.geometry&&(k._originalGeometryAtMoveStart=v.clone(k.geometry))},_recordsSelectedFeatureInfoWhenMoveStop:function(k){var F=k&&k.graphic;k=k&&k.transform;var L=this.map.extent.getWidth()/this.map.width;F&&k&&(F._moveTrack||(F._moveTrack={x:0,y:0}),F._moveTrack.x+=k.dx*L,F._moveTrack.y+=k.dy*L)},_getSelectionFeatuers:function(){var k=[];z.forEach(this.layerInfosParam,
function(F){F=F.featureLayer.getSelectedFeatures();k=k.concat(F)});return k},_getEditCapabilitiesByFeature:function(k){var F={},L=k&&k.getLayer&&k.getLayer();if(L&&L.isEditable&&L.isEditable()){var E=this._getLayerInfoOrTableInfoParamById(L.id);L&&(F=Q.getEditCapabilities(L,E,{feature:k}))}return F},_createRelatedRecordsEditor:function(k){if(k&&!this._isTemporaryFeatureForAddOnlyMode(k)){var F=y.create("div",{style:"position: relative"});y.place(F,this.editor.attributeInspector.domNode,"after");var L=
(new r({})).placeAt(F);return this._tableInfoParamDef.then(v.hitch(this,function(){try{this._relatedRecordsEditor&&(this._relatedRecordsEditor.destroy(),this._relatedRecordsEditor=null),this._relatedRecordsEditor=new X({originalFeature:k,editorATI:this.editor.attributeInspector,tableInfosParam:this.layerInfosParamClone.concat(this.tableInfosParamClone),nls:v.mixin(v.clone(this.nls),window.jimuNls.common),_editWidget:this}),L.destroy()}catch(E){console.warn(E.message),L.destroy(),this._enableToAnswerEventForEditorATI()}}))}},
_disableToAnswerEventForEditorATI:function(){this._mapInfoStorage.editorATIonLayerSelectionChange||(this._mapInfoStorage.editorATIonLayerSelectionChange=this.editor.attributeInspector.onLayerSelectionChange,this.editor.attributeInspector.onLayerSelectionChange=v.hitch(this,function(){}));this._mapInfoStorage.editorATIonLayerSelectionClear||(this._mapInfoStorage.editorATIonLayerSelectionClear=this.editor.attributeInspector.onLayerSelectionClear,this.editor.attributeInspector.onLayerSelectionClear=
v.hitch(this,function(){}))},_enableToAnswerEventForEditorATI:function(){this._mapInfoStorage.editorATIonLayerSelectionChange&&(this.editor.attributeInspector.onLayerSelectionChange=v.hitch(this.editor.attributeInspector,this._mapInfoStorage.editorATIonLayerSelectionChange),this._mapInfoStorage.editorATIonLayerSelectionChange=null);this._mapInfoStorage.editorATIonLayerSelectionClear&&(this.editor.attributeInspector.onLayerSelectionClear=v.hitch(this.editor.attributeInspector,this._mapInfoStorage.editorATIonLayerSelectionClear),
this._mapInfoStorage.editorATIonLayerSelectionClear=null)},_getTableInfosParam:function(){var k=[],F=[];var L=this._configEditor.honorSettingOfWebmap?this._getDefaultTableInfos():this._configEditor.tableInfos?0<this._configEditor.tableInfos.length?this._converConfiguredLayerInfos(this._configEditor.tableInfos):this._getDefaultTableInfos():[];z.forEach(L,function(E){var K=this._jimuLayerInfos.getTableInfoById(E.featureLayer.id);K&&(E.jimuTableInfo=K,k.push(K.getLayerObject()))},this);return b(k).then(v.hitch(this,
function(){z.forEach(L,function(E){if(E.jimuTableInfo){var K=E.jimuTableInfo.layerObject,P=E.jimuTableInfo.getCapabilitiesOfWebMap();P=P&&-1===P.toLowerCase().indexOf("editing")?!1:!0;K&&K.visible&&K.isEditable&&K.isEditable()&&P&&(E.featureLayer=E.jimuTableInfo.layerObject,delete E.jimuTableInfo,F.push(E))}},this);return F}))},_startEditingRelatedGraphic:function(k,F,L,E){this._stopEditingRelatedGraphic();this._temporaryDataForEditingRelatedGraphicSession.currentOperationData=k;this._temporaryDataForEditingRelatedGraphicSession.currentIntegrityField=
F;this._isInEditingRelatedGraphicSession=!0;var K=k.destJimuLayerInfo,P=k.destJimuLayerInfo.layerObject;L||(this.editPopup.hide(),this.editor._clearSelection());y.removeClass(this.editRelatedGraphicPart,"disable");y.setStyle(this.editor.templatePicker.domNode,"top",this._configEditor.useFilterEdit?W.TOP_WITH_TEMPLATE_FILTER_AND_EDIT_RG:W.TOP_WITH_EDIT_RG);L=[];K.isShowInMap()&&K.isInScale()&&(L=[P]);this._setTemplatePickerLayerObjectsParam(L);this._update(L);this._filterEditor&&(this._filterEditor.selectLayerFilterByValue(P.id),
this._filterEditor.disableLayerFilter());F.hasRelationshipTable?(K=c(P,"edits-complete",v.hitch(this,function(Y){if(Y&&Y.adds&&1===Y.adds.length){var Z=Y.adds[0],aa=null;z.some(P.graphics,function(ca){if(ca.attributes[P.objectIdField]===Z.objectId)return aa=ca,!0});aa&&this._relatedRecordsEditor._addNewRelationshipReocrd(aa,k)}})),this._releaseEventArrayAfterEditingRelatedGraphic.push(K)):(K=c(this.editor.templatePicker,"selection-change",v.hitch(this,function(){var Y=this.editor.templatePicker.getSelected();
(Y=Y&&Y.template)&&!v.getObject("_wabProperties.originalInterityField",!1,Y)&&Y.prototype&&Y.prototype.attributes&&(v.setObject("_wabProperties.originalInterityField.key",F.key,Y),v.setObject("_wabProperties.originalInterityField.value",F.value,Y),Y.prototype.attributes[F.key]=F.value,this._changedTemplatesOfTemplatePicker.push(Y))})),this._releaseEventArrayAfterEditingRelatedGraphic.push(K));if(!E){E=f(".itemSymbol",this.editor.templatePicker.domNode);if(E&&0<E.length)var U=(U=E[0])&&U.parentNode&&
U.parentNode.parentNode;U&&this.editor.templatePicker._rowClicked({cellNode:U,rowIndex:1,cellIndex:0})}},_stopEditingRelatedGraphic:function(){this._isInEditingRelatedGraphicSession&&(this._temporaryDataForEditingRelatedGraphicSession={},y.addClass(this.editRelatedGraphicPart,"disable"),y.setStyle(this.editor.templatePicker.domNode,"top",this._configEditor.useFilterEdit?W.TOP_WITH_TEMPLATE_FILTER:W.TOP),z.forEach(this._releaseEventArrayAfterEditingRelatedGraphic,function(k){k&&k.remove&&k.remove()},
this),this._releaseEventArrayAfterEditingRelatedGraphic=[],z.forEach(this._changedTemplatesOfTemplatePicker,function(k){if(v.getObject("_wabProperties.originalInterityField",!1,k)&&k.prototype&&k.prototype.attributes){var F=v.getObject("_wabProperties.originalInterityField.key",!1,k),L=v.getObject("_wabProperties.originalInterityField.value",!1,k);k.prototype.attributes[F]=L}},this),this._changedTemplatesOfTemplatePicker=[],this._filterEditor&&this._filterEditor.enableLayerFilter(),this.editor.templatePicker.clearSelection(),
this._isInEditingRelatedGraphicSession=!1,this._onLayerInfosChanged())},_changeMessageForTemplatePicker:function(){if(this.editor&&0===this.editor.templatePicker.featureLayers.length){var k=f("[class~\x3ddojoxGridMasterMessages]",this.editor.templatePicker.domNode);k&&k[0]&&(k[0].innerHTML=this._canCreateLayersAreAllInvisibleFlag?this.nls.noCanCreateLayerAreCurrentlyVisible:window.jimuNls.noEditableLayers)}},_refreshAttributeInspector:function(){this.editor&&this.editor.attributeInspector&&this.editor.attributeInspector.refresh();
this.editPopup.isShowing&&this._updateDeleteButtonInPopup(this.editor&&this.editor.attributeInspector&&this.editor.attributeInspector._currentFeature)},_updateOperationalButtons:function(k){this._updateDeleteButtonInPopup(k);this._updateGeometryOperationButtons(k)},_updateDeleteButtonInPopup:function(k){this._getEditCapabilitiesByFeature(k).canDelete?this._enableDeleBtnInPopup():this._disableDeleteBtnInPopup()},_disableDeleteBtnInToolbar:function(){this._configEditor.toolbarVisible&&f("[class~\x3ddeleteFeatureIcon]",
this.editor.domNode).style("display","none")},_enableDeleBtnInToolbar:function(){this._configEditor.toolbarVisible&&f("[class~\x3ddeleteFeatureIcon]",this.editor.domNode).style("display","inline-block")},_disableDeleteBtnInPopup:function(){f(".atiButton.atiDeleteButton",this.editPopup.domNode).style("display","none")},_enableDeleBtnInPopup:function(){f(".atiButton.atiDeleteButton",this.editPopup.domNode).style("display","block")},_updateGeometryOperationButtons:function(k){var F=k&&k.getLayer&&k.getLayer();
k=this._getEditCapabilitiesByFeature(k);!F||k.canUpdateGeometry?this._enableGeometryOperationButtons():this._disableGeometryOperationButtons()},_disableGeometryOperationButtons:function(){this._configEditor.toolbarVisible&&(f("[widgetid\x3dbtnFeatureCut]",this.editor.domNode).style("display","none"),f("[widgetid\x3dbtnFeatureUnion]",this.editor.domNode).style("display","none"),f("[widgetid\x3dbtnFeatureReshape]",this.editor.domNode).style("display","none"),(this._configEditor.toolbarOptions.mergeVisible||
this._configEditor.toolbarOptions.cutVisible||this._configEditor.toolbarOptions.reshapeVisible)&&f("[widgetid^\x3ddijit_ToolbarSeparator]",this.editor.domNode).last().style("display","none"))},_enableGeometryOperationButtons:function(){this._configEditor.toolbarVisible&&(f("[widgetid\x3dbtnFeatureCut]",this.editor.domNode).style("display","inline-block"),f("[widgetid\x3dbtnFeatureUnion]",this.editor.domNode).style("display","inline-block"),f("[widgetid\x3dbtnFeatureReshape]",this.editor.domNode).style("display",
"inline-block"),(this._configEditor.toolbarOptions.mergeVisible||this._configEditor.toolbarOptions.cutVisible||this._configEditor.toolbarOptions.reshapeVisible)&&f("[widgetid^\x3ddijit_ToolbarSeparator]",this.editor.domNode).last().style("display","inline-block"))},_updateDeleteButtonInToolbarBySelectionFeatures:function(){var k=!0,F=this._getSelectionFeatuers();0===F.length?k=!1:z.some(F,function(L){if(!this._getEditCapabilitiesByFeature(L).canDelete)return k=!1,!0},this);k?this._enableDeleBtnInToolbar():
this._disableDeleteBtnInToolbar()},_update:function(k){this.editor&&(k&&(this._filterEditor&&this._filterEditor.update(),this.editor.templatePicker.featureLayers=k),this.editor.templatePicker.clearSelection(),this.editor.templatePicker.update(!0),this._changeMessageForTemplatePicker())},resize:function(){this._update()},onNormalize:function(){setTimeout(v.hitch(this,this._update),100)},onMinimize:function(){},onMaximize:function(){setTimeout(v.hitch(this,this._update),100)},reClickMap:function(k){this._createOverDef.then(v.hitch(this,
function(){this.map.onClick(k)}))},_onGraphicMoveStart:function(k){this._recordsSelectedFeatureInfoWhenMoveStart(k)},_onGraphicMoveStop:function(k){this._recordsSelectedFeatureInfoWhenMoveStop(k);this._autoApplyEditWhenGeometryIsModified(k)},_onGraphicChangeStop:function(k){this._autoApplyEditWhenGeometryIsModified(k)},_beforeMapClick:function(){this._configEditor.autoApplyEditWhenGeometryIsMoved||this._checkStickyMoveTolerance()},_onEditorPopupShow:function(){var k=this.editor.attributeInspector._currentFeature;
this._disableToAnswerEventForEditorATI();this._createRelatedRecordsEditor(k);this._pushToNeedRequeryFeatureArray(k);this._requeryFeature(k,!0);this._updateOperationalButtons(k)},_onEditorPopupHide:function(){this._enableToAnswerEventForEditorATI()},_onNextOfEditorATI:function(k){this._createRelatedRecordsEditor(k.feature);this._pushToNeedRequeryFeatureArray(k.feature);this._requeryFeature(k.feature,!0);this._updateOperationalButtons(k.feature)},_onLayerSelectionChange:function(){this._updateDeleteButtonInToolbarBySelectionFeatures()}});
W.EditPopup=N([G],{preamble:function(){this.originalHide=v.hitch(this,this.hide);this.hide=v.hitch(this,function(k){this.hideWidthConfirmDialog(k)});C.setScrollable&&(this.originalSetScrollableDomUtils=C.setScrollable,C.setScrollable=function(){return[{remove:function(){}},{remove:function(){}}]})},constructor:function(){C.setScrollable=this.originalSetScrollableDomUtils},hideWidthConfirmDialog:function(k){this.originalHide()}});v.mixin(W,{TOP:"18px",TOP_WITH_TEMPLATE_FILTER:"115px",TOP_WITH_EDIT_RG:"53px",
TOP_WITH_TEMPLATE_FILTER_AND_EDIT_RG:"155px"});return W});