// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/ParcelDrafter/PlanSettings":function(){define("dojo/_base/declare dojo/_base/array jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!./PlanSettings.html dojo/_base/lang dojo/Evented dojo/dom-class dojo/query ./utils jimu/utils libs/storejs/store jimu/dijit/formSelect".split(" "),function(E,d,h,l,m,f,n,e,v,B,w,k){return E([h,l,n],{baseClass:"jimu-widget-ParcelDrafter-PlanSettings",templateString:m,selectedPlanSettings:{},planSettingsOptions:f.clone(B.planSettingsOptions),
planSettingsKey:null,constructor:function(p){f.mixin(this,p)},startup:function(){var p=this._retriveFromLocalCache();p||(p={areaUnits:this.planSettingsOptions.areaUnits[1],circularCurveParameters:this.planSettingsOptions.circularCurveParameters[0],directionOrAngleType:this.planSettingsOptions.directionOrAngleType[0],directionOrAngleUnits:this.planSettingsOptions.directionOrAngleUnits[0],distanceAndLengthUnits:this.planSettingsOptions.distanceAndLengthUnits[1]});this._loadOptionsForDropDown(this.directionOrAngleType,
this.planSettingsOptions.directionOrAngleType,p.directionOrAngleType);this._loadOptionsForDropDown(this.directionOrAngleUnits,this.planSettingsOptions.directionOrAngleUnits,p.directionOrAngleUnits);this._loadOptionsForDropDown(this.distanceAndLengthUnits,this.planSettingsOptions.distanceAndLengthUnits,p.distanceAndLengthUnits);this._loadOptionsForDropDown(this.areaUnits,this.planSettingsOptions.areaUnits,p.areaUnits);this._loadOptionsForDropDown(this.circularCurveParameters,this.planSettingsOptions.circularCurveParameters,
p.circularCurveParameters);this.onPlansettingsChanged()},postCreate:function(){this.inherited(arguments);this.planSettingsKey=this.getKey();this.selectedPlanSettings={};this.planSettingsOptions=f.clone(B.planSettingsOptions);e.add(this.domNode,"esriCTPlanSettingsContainer esriCTFullWidth");setTimeout(f.hitch(this,this._setBackgroundColorForDartTheme),500)},postMixInProperties:function(){this.inherited(arguments);this.isRenderIdForAttrs=!0},_setBackgroundColorForDartTheme:function(){var p;if("DartTheme"===
this.appConfig.theme.name){var M=v(".dijitSelect .dijitButtonContents",this.planSettingsNode);var z=v(".dijitSelect .dijitArrowButton",this.planSettingsNode);for(p=0;p<M.length&&p<z.length;p++)e.add(M[p],"dijitButtonContentsDartTheme"),e.add(z[p],"dijitArrowButtonDartTheme")}},_loadOptionsForDropDown:function(p,M,z){var r=[],t;d.forEach(M,f.hitch(this,function(A){t={value:A,label:this.nls.planSettings[A]||window.jimuNls.units[A]};z===A&&(t.selected=!0);r.push(t)}));p.addOption(r)},_isSettingsChanged:function(){var p=
!1;this.selectedPlanSettings.directionOrAngleType!==this.directionOrAngleType.get("value")?p=!0:this.selectedPlanSettings.directionOrAngleUnits!==this.directionOrAngleUnits.get("value")?p=!0:this.selectedPlanSettings.distanceAndLengthUnits!==this.distanceAndLengthUnits.get("value")?p=!0:this.selectedPlanSettings.areaUnits!==this.areaUnits.get("value")?p=!0:this.selectedPlanSettings.circularCurveParameters!==this.circularCurveParameters.get("value")&&(p=!0);return p},onClose:function(){if(this._isSettingsChanged())this.onPlansettingsChanged()},
onPlansettingsChanged:function(){this.selectedPlanSettings={directionOrAngleType:this.directionOrAngleType.get("value"),directionOrAngleUnits:this.directionOrAngleUnits.get("value"),distanceAndLengthUnits:this.distanceAndLengthUnits.get("value"),areaUnits:this.areaUnits.get("value"),circularCurveParameters:this.circularCurveParameters.get("value")};this._saveToLocalCache(this.selectedPlanSettings);this.emit("planSettingsChanged",this.selectedPlanSettings)},_saveToLocalCache:function(p){try{k.set(this.planSettingsKey,
p)}catch(M){console.log("ParcelDrafter: Error in storeing settings to local cache.")}},_retriveFromLocalCache:function(){var p=null;try{p=k.get(this.planSettingsKey)}catch(M){console.log("ParcelDrafter: Error in retriving settings from local cache.")}return p},getKey:function(){return"ParcelDrafterPlanSettings."+encodeURIComponent(w.getAppIdFromUrl())+"."+this.widgetId},updateLastNodeInPlanSetting:function(){w.initLastFocusNode(this.widgetDomNode,this.circularCurveParameters.domNode)}})})},"widgets/ParcelDrafter/utils":function(){define([],
function(){var E={bearingFieldPlaces:2,planSettingsOptions:{directionOrAngleType:["northAzimuth","southAzimuth","quadrantBearing"],directionOrAngleUnits:["decimalDegree","degreeMinuteSeconds"],distanceAndLengthUnits:["uSSurveyFeet","feet","meters"],areaUnits:["squareUSSurveyFeet","squareFeet","acres","squareMeters"],circularCurveParameters:["radiusAndChordLength","radiusAndArcLength"]},getQuadrant:function(d){return{"-1":"NE","-2":"SE","-3":"SW","-4":"NW"}[d]},getQuadrantShortcut:function(d){d=d.toUpperCase();
return{NE:"-1",SE:"-2",SW:"-3",NW:"-4"}[d]},getQuadrantShortcutFromDD:function(d){var h;0<=d&&90>=d?h="-1":90<d&&180>=d?h="-2":180<d&&270>d?h="-3":270<=d&&360>d&&(h="-4");return h},getQuadrantAngleFromNADD:function(d){d=E.getQuadrantAngleAndShortcut(d);return d.quadrant.charAt(0)+d.quadrantAngle+d.quadrant.charAt(1)},getSouthAzimuthFromNorthAzimuth:function(d){var h;180<d?h=d-180:180>d?h=d+180:180===d&&(h=0);return h},DMStoDD:function(d){var h=Math.abs(parseFloat(d.degree));var l=parseFloat(d.minutes);
var m=parseFloat(d.seconds);h=h+l/60+m/3600;d.isNegative&&(h*=-1);return h},DDtoDMS:function(d){var h=3600*d.angle;d=Math.round(h%60);d=60==d?0:d;var l=(h-d)/60;h=Math.round(l%60);h=60==h?0:h;return{degree:Math.round((l-h)/60),minutes:h,seconds:d}},getBearingObjForFormat0:function(d){var h;var l={};l.degree=parseInt(d[1],10);l.minutes=parseInt(d[2]||0,10);l.seconds=parseInt(d[3]||0,10);l.quadrant=E.getQuadrant("-"+d[4]);l.quadrantShortcut="-"+d[4];"string"===typeof d[1]&&(h="-"===d[1].charAt(0));
l.decimalDegrees=E.DMStoDD({degree:l.degree,minutes:l.minutes,seconds:l.seconds,isNegative:h});return l},getBearingObjForFormat1:function(d){var h;var l={};l.degree=parseInt(d[2],10);l.minutes=parseInt(d[3]||0,10);l.seconds=parseInt(d[4]||0,10);l.quadrant=d[1]+d[5];l.quadrantShortcut=E.getQuadrantShortcut(d[1]+d[5]);"string"===typeof d[2]&&(h="-"===d[2].charAt(0));l.decimalDegrees=E.DMStoDD({degree:l.degree,minutes:l.minutes,seconds:l.seconds,isNegative:h});return l},getBearingObjForFormat2:function(d){var h;
var l={};l.degree=parseInt(d[2],10);l.minutes=parseInt(d[3]||0,10);l.seconds=parseInt(d[4]||0,10);l.quadrant=d[1]+d[5];l.quadrantShortcut=E.getQuadrantShortcut(d[1]+d[5]);"string"===typeof d[2]&&(h="-"===d[2].charAt(0));l.decimalDegrees=E.DMStoDD({degree:l.degree,minutes:l.minutes,seconds:l.seconds,isNegative:h});return l},getBearingObjForFormat3:function(d){var h;var l={};l.degree=parseInt(d[1],10);l.minutes=parseInt(d[2]||0,10);l.seconds=parseInt(d[3]||0,10);"string"===typeof d[1]&&(h="-"===d[1].charAt(0));
l.decimalDegrees=E.DMStoDD({degree:l.degree,minutes:l.minutes,seconds:l.seconds,isNegative:h});l.quadrantShortcut=E.getQuadrantShortcutFromDD(l.decimalDegrees);l.quadrant=E.getQuadrant(l.quadrantShortcut);return l},getBearingObjForFormat4:function(d){var h=E.DDtoDMS({angle:d[1]});var l={};l.degree=h.degree;l.minutes=h.minutes;l.seconds=h.seconds;l.decimalDegrees=d[1];l.quadrantShortcut=E.getQuadrantShortcutFromDD(l.decimalDegrees);l.quadrant=E.getQuadrant(l.quadrantShortcut);return l},getBearingObjForFormat5:function(d){var h;
var l={};l.degree=parseInt(d[1],10);l.minutes=parseInt(d[2]||0,10);l.seconds=parseInt(d[3]||0,10);"string"===typeof d[1]&&(h="-"===d[1].charAt(0));l.decimalDegrees=E.DMStoDD({degree:l.degree,minutes:l.minutes,seconds:l.seconds,isNegative:h});l.quadrantShortcut=E.getQuadrantShortcutFromDD(l.decimalDegrees);l.quadrant=E.getQuadrant(l.quadrantShortcut);return l},getBearingObjForFormat6:function(d){var h;var l={};l.degree=parseInt(d[1],10);l.minutes=parseInt(d[2]||0,10);l.seconds=parseInt(d[3]||0,10);
l.quadrantShortcut=d[4];l.quadrant=E.getQuadrant(l.quadrantShortcut);"string"===typeof d[1]&&(h="-"===d[1].charAt(0));l.decimalDegrees=E.DMStoDD({degree:l.degree,minutes:l.minutes,seconds:l.seconds,isNegative:h});return l},getBearingObjForFormat7:function(d){var h={};h.decimalDegrees=d[2];var l=E.DDtoDMS({angle:h.decimalDegrees});h.degree=parseInt(l.degree,10);h.minutes=parseInt(l.minutes||0,10);h.seconds=parseInt(l.seconds||0,10);h.quadrant=d[1]+d[3];h.quadrantShortcut=E.getQuadrantShortcut(h.quadrant);
return h},getBearingObjForFormat8:function(d){var h={};h.decimalDegrees=d[1];var l=E.DDtoDMS({angle:h.decimalDegrees});h.degree=parseInt(l.degree,10);h.minutes=parseInt(l.minutes||0,10);h.seconds=parseInt(l.seconds||0,10);h.quadrantShortcut=d[2];h.quadrant=E.getQuadrant(h.quadrantShortcut);return h},getQuadrantAngleAndShortcut:function(d){var h={};0<=d&&90>=d?(h.quadrantAngle=d,h.quadrant="NE"):90<d&&180>=d?(h.quadrantAngle=180-d,h.quadrant="SE"):180<d&&270>d?(h.quadrantAngle=d-180,h.quadrant="SW"):
270<=d&&360>d&&(h.quadrantAngle=360-d,h.quadrant="NW");return h},roundSeconds:function(d){d=Number(d);return 10>d?"0"+d:d},showFixedPlacesAfterDecimal:function(d,h){var l=0;h||(h=2);d=d.toString();l=d.indexOf(".");0<l&&(d=d.slice(0,l+h+1));return Number(d)},honourPopupRounding:function(d,h){if(isNaN(d)||null===d)d=4;var l=Math.pow(10,d);h=Math.round(h*l)/l;return h=h.toFixed(d)},convertBearingToOutputFormats:function(d){var h={};var l={};360===d.degree&&(d.degree=0);h=d.decimalDegrees;360===h&&(h=
0);l.naDD=h;l.naDDRound=E.honourPopupRounding(E.bearingFieldPlaces,h);360===Number(l.naDDRound)&&(l.naDDRound=0);var m=10>d.minutes?"0"+d.minutes:d.minutes;var f=d.seconds;0<Number(m)&&0<Number(E.roundSeconds(f))?l.naDMS=d.degree+"-"+m+"-"+E.roundSeconds(f):0===Number(m)&&0<Number(E.roundSeconds(f))?l.naDMS=d.degree+"-"+m+"-"+E.roundSeconds(f):0<Number(m)&&0===Number(E.roundSeconds(f))?l.naDMS=d.degree+"-"+m+"-00":0===Number(m)&&0===Number(E.roundSeconds(f))&&(l.naDMS=d.degree+"-00-00");d=E.getQuadrantAngleAndShortcut(h);
l.qb3DD=d.quadrant.charAt(0)+d.quadrantAngle+d.quadrant.charAt(1);l.qb3DDRound=d.quadrant.charAt(0)+E.honourPopupRounding(E.bearingFieldPlaces,d.quadrantAngle)+d.quadrant.charAt(1);m=E.DDtoDMS({angle:d.quadrantAngle});f=10>m.minutes?"0"+m.minutes:m.minutes;var n=m.seconds;0<Number(f)&&0<Number(E.roundSeconds(n))?l.qb3DMS=d.quadrant.charAt(0)+m.degree+"-"+f+"-"+E.roundSeconds(n)+d.quadrant.charAt(1):0===Number(f)&&0<Number(E.roundSeconds(n))?l.qb3DMS=d.quadrant.charAt(0)+m.degree+"-"+f+"-"+E.roundSeconds(n)+
d.quadrant.charAt(1):0<Number(f)&&0===Number(E.roundSeconds(n))?l.qb3DMS=d.quadrant.charAt(0)+m.degree+"-"+f+"-00"+d.quadrant.charAt(1):0===Number(f)&&0===Number(E.roundSeconds(n))&&(l.qb3DMS=d.quadrant.charAt(0)+m.degree+"-00-00"+d.quadrant.charAt(1));h=E.getSouthAzimuthFromNorthAzimuth(h);360===h&&(h=0);l.saDD=h;l.saDDRound=E.honourPopupRounding(E.bearingFieldPlaces,h);360===Number(l.saDDRound)&&(l.saDDRound=0);h=E.DDtoDMS({angle:h});360===h.degree&&(h.degree=0);d=10>h.minutes?"0"+h.minutes:h.minutes;
m=h.seconds;0<Number(d)&&0<Number(E.roundSeconds(m))?l.saDMS=h.degree+"-"+d+"-"+E.roundSeconds(m):0===Number(d)&&0<Number(E.roundSeconds(m))?l.saDMS=h.degree+"-"+d+"-"+E.roundSeconds(m):0<Number(d)&&0===Number(E.roundSeconds(m))?l.saDMS=h.degree+"-"+d+"-00":0===Number(d)&&0===Number(E.roundSeconds(m))&&(l.saDMS=h.degree+"-00-00");return l},getBearingDetailsOfRequiredFormat:function(d,h){var l={};switch(h){case 0:l=E.getBearingObjForFormat0(d);break;case 1:l=E.getBearingObjForFormat1(d);break;case 2:l=
E.getBearingObjForFormat2(d);break;case 3:l=E.getBearingObjForFormat3(d);break;case 4:l=E.getBearingObjForFormat4(d);break;case 5:l=E.getBearingObjForFormat5(d);break;case 6:l=E.getBearingObjForFormat6(d);break;case 7:l=E.getBearingObjForFormat7(d);break;case 8:l=E.getBearingObjForFormat8(d)}return E.convertBearingToOutputFormats(l)},getBearingFormatArr:function(){var d=[];d.push({regex:/^((?:\-)?(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0))(?:\-(0|[0-5]?\d)\-(0|[0-5]\d))?\-([1-4])$/,type:"degreeMinuteSeconds"});
d.push({regex:/^([nNsS])((?:\-)?(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0))(?:\-(0|[0-5]?\d)\-(0|[0-5]\d))?([eEwW])$/,type:"degreeMinuteSeconds"});d.push({regex:/^([nNsS])((?:\-)?(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0))(?:\.([0-5]\d)(?:([0-5]\d))?)?([eEwW])$/,type:"degreeMinuteSeconds"});d.push({regex:/^((?:\-)?(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0))(?:\.([0-5]\d)(?:([0-5]\d))?)?$/,type:"degreeMinuteSeconds"});d.push({regex:/^((?:(?:\-?)(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0)(?:\.\d+)?)|(?:\-?)(?:\.\d+))$/,type:"decimalDegree"});
d.push({regex:/^((?:\-)?(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0))(?:\-(0|[0-5]?\d)\-((?:[0-5]\d)))?$/,type:"degreeMinuteSeconds"});d.push({regex:/^((?:\-)?(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0))(?:\.([0-5]\d)(?:([0-5]\d))?)?(\-[1-4])$/,type:"degreeMinuteSeconds"});d.push({regex:/^([nNsS])((?:(?:\-?)(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0)(?:\.\d+)?)|(?:\-?)(?:\.\d+))([eEwW])$/,type:"decimalDegree"});d.push({regex:/^((?:(?:\-?)(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0)(?:\.\d+)?)|(?:\-?)(?:\.\d+))(\-[1-4])$/,type:"decimalDegree"});
return d},getNorthAzimuthAngle:function(d,h){h=h.toUpperCase();d=Number(d);switch(h){case "-1":case "NE":return(d+360)%360;case "-2":case "SE":return(540-d)%360;case "-3":case "SW":return(540+d)%360;case "-4":case "NW":return(360-d)%360}},convertBearingToNorthAzimuth:function(d,h,l){switch(h){case 0:h=E.getBearingObjForFormat0(d);h=E.getNorthAzimuthAngle(h.decimalDegrees,"-"+d[4]);h=E.DDtoDMS({angle:h});d[1]=h.degree;d[2]=h.minutes;d[3]=h.seconds;break;case 1:h=E.getBearingObjForFormat1(d);h=E.getNorthAzimuthAngle(h.decimalDegrees,
d[1]+d[5]);h=E.DDtoDMS({angle:h});d[2]=h.degree;d[3]=h.minutes;d[4]=h.seconds;break;case 2:h=E.getBearingObjForFormat2(d);h=E.getNorthAzimuthAngle(h.decimalDegrees,d[1]+d[5]);h=E.DDtoDMS({angle:h});d[2]=h.degree;d[3]=h.minutes;d[4]=h.seconds;break;case 3:"northAzimuth"===l.directionOrAngleType||"quadrantBearing"===l.directionOrAngleType?(h=E.getBearingObjForFormat3(d),h=E.getNorthAzimuthAngle(h.decimalDegrees,"-1"),h=E.DDtoDMS({angle:h}),d[1]=h.degree,d[2]=h.minutes,d[3]=h.seconds):"southAzimuth"===
l.directionOrAngleType&&(h=E.getBearingObjForFormat3(d),h=E.getNorthAzimuthAngle(h.decimalDegrees,"-3"),h=E.DDtoDMS({angle:h}),d[1]=h.degree,d[2]=h.minutes,d[3]=h.seconds);break;case 4:"northAzimuth"===l.directionOrAngleType||"quadrantBearing"===l.directionOrAngleType?d[1]=E.getNorthAzimuthAngle(d[1],"-1"):"southAzimuth"===l.directionOrAngleType&&(d[1]=E.getNorthAzimuthAngle(d[1],"-3"));break;case 5:"northAzimuth"===l.directionOrAngleType?(h=E.getBearingObjForFormat5(d),h=E.getNorthAzimuthAngle(h.decimalDegrees,
"-1"),h=E.DDtoDMS({angle:h}),d[1]=h.degree,d[2]=h.minutes,d[3]=h.seconds):"southAzimuth"===l.directionOrAngleType?(h=E.getBearingObjForFormat5(d),h=E.getNorthAzimuthAngle(h.decimalDegrees,"-3"),h=E.DDtoDMS({angle:h}),d[1]=h.degree,d[2]=h.minutes,d[3]=h.seconds):"quadrantBearing"===l.directionOrAngleType&&(d=null);break;case 6:h=E.getBearingObjForFormat6(d);h=E.getNorthAzimuthAngle(h.decimalDegrees,d[4]);h=E.DDtoDMS({angle:h});d[1]=h.degree;d[2]=h.minutes;d[3]=h.seconds;break;case 7:d[2]=E.getNorthAzimuthAngle(d[2],
d[1]+d[3]);break;case 8:d[1]=E.getNorthAzimuthAngle(d[1],d[2])}return d},categorizeBearingFormat:function(d,h){var l,m;d=d.toString();var f=E.getBearingFormatArr();for(m=0;m<f.length;m++)if(f[m].type===h.directionOrAngleUnits&&(l=f[m].regex.exec(d.trim()))&&0<l.length){l=E.convertBearingToNorthAzimuth(l,m,h);break}if(!l)for(m=0;m<f.length;m++)if(f[m].type!==h.directionOrAngleUnits&&(l=f[m].regex.exec(d.trim()))&&0<l.length){l=E.convertBearingToNorthAzimuth(l,m,h);break}return l?E.getBearingDetailsOfRequiredFormat(l,
m):null},metersToUSSurveyFeet:function(d){d=Number(d);return 3.28083333333*d},usSurveyFeetToMeters:function(d){d=Number(d);return.304800609601*d},feetToUSSurveyFeet:function(d){d=Number(d);return E.metersToUSSurveyFeet(.3048*d)},feetToMeters:function(d){d=Number(d);return.3048*d},usSurveyFeetToFeet:function(d){d=Number(d);return 1.000001999999281*d},metersToFeet:function(d){d=Number(d);return 3.280839895*d},getLengthObjForFormat0:function(d,h){var l={};"feet"===h?(l.feet=Number(d[0]),l.feetRound=
Math.round(1E4*l.feet)/1E4,l.uSSurveyFeet=E.feetToUSSurveyFeet(d[0]),l.uSSurveyFeetRound=Math.round(1E4*l.uSSurveyFeet)/1E4,l.meters=E.feetToMeters(d[0]),l.metersRound=Math.round(1E4*l.meters)/1E4):"uSSurveyFeet"===h?(l.uSSurveyFeet=Number(d[0]),l.uSSurveyFeetRound=Math.round(1E4*l.uSSurveyFeet)/1E4,l.meters=E.usSurveyFeetToMeters(d[0]),l.metersRound=Math.round(1E4*l.meters)/1E4,l.feet=E.usSurveyFeetToFeet(l.uSSurveyFeet),l.feetRound=Math.round(1E4*l.feet)/1E4):"meters"===h&&(l.uSSurveyFeet=E.metersToUSSurveyFeet(d[0]),
l.uSSurveyFeetRound=Math.round(1E4*l.uSSurveyFeet)/1E4,l.meters=Number(d[0]),l.metersRound=Math.round(1E4*l.meters)/1E4,l.feet=E.metersToFeet(l.meters),l.feetRound=Math.round(1E4*l.feet)/1E4);return l},getLengthObjForFormat3:function(d){var h={};h.uSSurveyFeet=Number(d[2]);h.uSSurveyFeetRound=Math.round(1E4*h.uSSurveyFeet)/1E4;h.meters=E.usSurveyFeetToMeters(d[2]);h.metersRound=Math.round(1E4*h.meters)/1E4;h.feet=E.usSurveyFeetToFeet(h.uSSurveyFeet);h.feetRound=Math.round(1E4*h.feet)/1E4;return h},
getLengthObjForFormat2:function(d){var h={};h.uSSurveyFeet=E.metersToUSSurveyFeet(d[2]);h.uSSurveyFeetRound=Math.round(1E4*h.uSSurveyFeet)/1E4;h.meters=Number(d[2]);h.metersRound=Math.round(1E4*h.meters)/1E4;h.feet=E.metersToFeet(h.meters);h.feetRound=Math.round(1E4*h.feet)/1E4;return h},getLengthObjForFormat1:function(d){var h={};h.feet=Number(d[2]);h.feetRound=Math.round(1E4*h.feet)/1E4;h.uSSurveyFeet=E.feetToUSSurveyFeet(d[2]);h.uSSurveyFeetRound=Math.round(1E4*h.uSSurveyFeet)/1E4;h.meters=E.feetToMeters(d[2]);
h.metersRound=Math.round(1E4*h.meters)/1E4;return h},categorizeLengthFormat:function(d,h){var l,m;var f=[];d=d.toString();f.push(/^((\-?)((0?|([1-9]\d*))(\.\d+)?))$/);f.push(/^(((\-?)((0?|([1-9]\d*))(\.\d+)?))(ft|FT|fT|Ft))$/);f.push(/^(((\-?)((0?|([1-9]\d*))(\.\d+)?))(m|M))$/);f.push(/^(((\-?)((0?|([1-9]\d*))(\.\d+)?))(FTUS|FTUs|FTuS|FTus|FtUS|FtUs|FtuS|Ftus|fTUS|fTUs|fTuS|fTus|ftUS|ftUs|ftuS|ftus))$/);for(m=0;m<f.length&&!((l=f[m].exec(d.trim()))&&0<l.length);m++);l?(d=E.getLengthOfRequiredFormat(l,
m,h))&&isNaN(d.meters)&&(d=null):d=null;return d},getLengthOfRequiredFormat:function(d,h,l){var m={};switch(h){case 0:m=E.getLengthObjForFormat0(d,l);break;case 1:m=E.getLengthObjForFormat1(d);break;case 2:m=E.getLengthObjForFormat2(d);break;case 3:m=E.getLengthObjForFormat3(d)}return m}};return E})},"widgets/ParcelDrafter/XYInput":function(){define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!./XYInput.html dojo/on dojo/_base/lang dojo/Evented esri/geometry/Point dojo/keys jimu/utils dojo/dom-attr dojo/dom-class dijit/form/ValidationTextBox".split(" "),
function(E,d,h,l,m,f,n,e,v,B,w,k){return E([d,h,n],{baseClass:"jimu-widget-ParcelDrafter-XYInput",templateString:l,constructor:function(p){f.mixin(this,p)},postCreate:function(){this.inherited(arguments);this.spatialReference=this.map.getLayer(this.config.polygonLayer.id).spatialReference;this.xRowWrapper.title=this.nls.xyInput.explanation;this.yRowWrapper.title=this.nls.xyInput.explanation;w.set(this.newTraverseX,"aria-label","x"+this.xRowWrapper.title);w.set(this.newTraverseY,"aria-label","y"+this.yRowWrapper.title);
this.own(m(this.newTraverseX,"change",f.hitch(this,function(){this._onTextBoxValueChanged()})));this.own(m(this.newTraverseY,"change",f.hitch(this,function(){this._onTextBoxValueChanged()})));this.own(m(this.xyStartButton,"click",f.hitch(this,function(){k.contains(this.xyStartButton,"jimu-state-disabled")||this.emit("newPoint",this.project(this.newTraverseX.value,this.newTraverseY.value))})));this.own(m(this.xyStartButton,"keydown",f.hitch(this,function(p){if(p.keyCode===v.ENTER||p.keyCode===v.SPACE)k.contains(this.xyStartButton,
"jimu-state-disabled")||this.emit("newPoint",this.project(this.newTraverseX.value,this.newTraverseY.value))})))},project:function(p,M){return new e(p,M,this.spatialReference)},_updateLastFocusNode:function(){k.contains(this.xyStartButton,"jimu-state-disabled")?(k.add(this.xyStartButton,"jimu-state-disabled"),w.set(this.xyStartButton,"tabIndex","-1"),B.initLastFocusNode(this.widgetDomNode,this.newTraverseY.domNode)):(k.remove(this.xyStartButton,"jimu-state-disabled"),w.set(this.xyStartButton,"tabIndex",
"0"),B.initLastFocusNode(this.widgetDomNode,this.xyStartButton))},_onTextBoxValueChanged:function(){this.newTraverseX.isValid()&&this.newTraverseY.isValid()?k.remove(this.xyStartButton,"jimu-state-disabled"):k.add(this.xyStartButton,"jimu-state-disabled");this._updateLastFocusNode()},resetXYTextBoxes:function(){this.newTraverseX.reset();this.newTraverseY.reset()}})})},"widgets/ParcelDrafter/NewTraverse":function(){define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./NewTraverse.html dojo/_base/lang dojo/_base/array dojo/dom-class dojo/dom-construct dojo/dom-style dojo/dnd/Source dojo/on dijit/form/ValidationTextBox ./SymbolSelector ./MiscloseDetails ./ParcelTools ./PlanInfo ./geometryUtils ./utils esri/graphic esri/symbols/jsonUtils esri/layers/GraphicsLayer esri/graphicsUtils dojo/dom-attr dojo/query esri/SpatialReference dojo/keys dijit/focus dijit/TooltipDialog dijit/popup dojo/Deferred esri/geometry/Extent esri/geometry/Point dojo/dom-geometry jimu/utils".split(" "),
function(E,d,h,l,m,f,n,e,v,B,w,k,p,M,z,r,t,A,N,I,P,S,Q,F,U,R,W,K,V,y,b,g,x,G,J){return E([d,h,l],{baseClass:"jimu-widget-ParcelDrafter",templateString:m,parcelLinesGraphicsLayer:null,parcelPointsGraphicsLayer:null,parcelPolygonGraphicsLayer:null,lineLayerSpatialReference:null,polygonLayerSpatialReference:null,_itemList:[],_nodes:[],_dndContainer:null,startPoint:null,_startPointForNextLine:null,_planSettings:null,_arrayOfAllBoundaryLines:[],_rotationAngle:0,_scaleValue:1,polygonDeleteArr:[],polylineDeleteArr:[],
_popupDialog:null,_popupCoords:null,_setExtentTimer:null,numberFieldTypes:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],lengthFieldPlaces:2,radiusFieldPlaces:2,miscloseDistanceFieldPlaces:2,postCreate:function(){this.rotationPointsGraphicsLayer=this.parcelPointsGraphicsLayer=this.parcelLinesGraphicsLayer=this.parcelPolygonGraphicsLayer=null;this.numberFieldTypes=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"];
this.polygonDeleteArr=[];this.polylineDeleteArr=[];this._arrayOfAllBoundaryLines=[];this._nodes=[];this._itemList=[];this._setExtentTimer=null;e.add(this.domNode,"esriCTNewTraverseGrid");this._addGraphicsLayer();this._createTraverseGrid();this._setValidatorForInitialRow();this._handleEventsOnInitialRow();this._symbolSelector=this._createLineSelector(this.lineSymbolNode,null);this.own(k(this.screenDigitizationNode,"click",f.hitch(this,this._onDigitizationButtonClicked)));this.own(k(this.screenDigitizationNode,
"keydown",f.hitch(this,function(a){if(a.keyCode===W.ENTER||a.keyCode===W.SPACE)a.preventDefault(),this._onDigitizationButtonClicked()})));this.own(k(this.updateRotationPointNode,"click",f.hitch(this,this._onUpdateRotationPointButtonClicked)));this.own(k(this.updateRotationPointNode,"keydown",f.hitch(this,function(a){if(a.keyCode===W.ENTER||a.keyCode===W.SPACE)a.preventDefault(),this._onUpdateRotationPointButtonClicked()})));this.own(k(this.zoomToNode,"click",f.hitch(this,this._onZoomButtonClicked)));
this.own(k(this.zoomToNode,"keydown",f.hitch(this,function(a){if(a.keyCode===W.ENTER||a.keyCode===W.SPACE)a.preventDefault(),this._onZoomButtonClicked()})));this.own(k(this.expandCollapseNode,"click",f.hitch(this,this._onExpandCollapseClicked)));this.own(k(this.expandCollapseNode,"keydown",f.hitch(this,function(a){if(a.keyCode===W.ENTER||a.keyCode===W.SPACE)a.preventDefault(),this._onExpandCollapseClicked()})));this.own(k(this.addButton,"click",f.hitch(this,function(){this._addNewItem(!1)})));this.own(k(this.addButton,
"keydown",f.hitch(this,function(a){a.keyCode!==W.ENTER&&a.keyCode!==W.SPACE||this._addNewItem(!1)})));this._createMiscloseDetails();this._createParcelTools();this._createPlanInfo();this._createTooltip();this.config.polylineLayer&&this.config.polylineLayer.popupInfo&&this.config.polylineLayer.popupInfo.fieldInfos&&n.forEach(this.config.polylineLayer.popupInfo.fieldInfos,f.hitch(this,function(a){a.fieldName===this.config.polylineLayer.bearing.name&&a.format&&(N.bearingFieldPlaces=a.format.places);a.fieldName===
this.config.polylineLayer.distance.name&&a.format&&(this.lengthFieldPlaces=a.format.places);a.fieldName===this.config.polylineLayer.radius.name&&a.format&&(this.radiusFieldPlaces=a.format.places)}));this.config.polygonLayer&&this.config.polygonLayer.popupInfo&&this.config.polygonLayer.popupInfo.fieldInfos&&n.forEach(this.config.polygonLayer.popupInfo.fieldInfos,f.hitch(this,function(a){a.fieldName===this.config.polygonLayer.miscloseDistance.name&&a.format&&(this.miscloseDistanceFieldPlaces=a.format.places)}))},
destroy:function(){this.parcelPolygonGraphicsLayer&&this.map.removeLayer(this.parcelPolygonGraphicsLayer);this.parcelLinesGraphicsLayer&&this.map.removeLayer(this.parcelLinesGraphicsLayer);this.parcelPointsGraphicsLayer&&this.map.removeLayer(this.parcelPointsGraphicsLayer);this.rotationPointsGraphicsLayer&&this.map.removeLayer(this.rotationPointsGraphicsLayer)},_addGraphicsLayer:function(){this.parcelPolygonGraphicsLayer=new S;this.parcelLinesGraphicsLayer=new S;this.parcelPointsGraphicsLayer=new S;
this.rotationPointsGraphicsLayer=new S;this.own(k(this.parcelPointsGraphicsLayer,"click",f.hitch(this,function(a){e.contains(this.updateRotationPointNode,"esriCTEnableButton")&&(this._setRotationPoint(a.graphic.attributes.rowIndex,a.graphic.geometry),this._showRotationPoint())})));this.map.addLayer(this.parcelPolygonGraphicsLayer);this.map.addLayer(this.parcelLinesGraphicsLayer);this.map.addLayer(this.parcelPointsGraphicsLayer);this.map.addLayer(this.rotationPointsGraphicsLayer)},_setValidatorForInitialRow:function(){this.bearingNode.validator=
f.hitch(this,function(a){return this._bearingValidator(a,["*","*tb"])});this.bearingNode.invalidMessage=this.nls.newTraverse.invalidBearingMessage;this.lengthNode.validator=f.hitch(this,function(a){if("*"===a&&this._itemList&&0<this._itemList.length)return!0;if(""===this.radiusNode.get("value")&&0>parseFloat(a))return this.lengthNode.invalidMessage=this.nls.newTraverse.negativeLengthMessage,!1;this.lengthNode.invalidMessage=this.nls.newTraverse.invalidLengthMessage;return this._lengthValidator(a)});
this.lengthNode.invalidMessage=this.nls.newTraverse.invalidLengthMessage;this.radiusNode.validator=f.hitch(this,function(a){if("*"===a&&this._itemList&&0<this._itemList.length)return!0;var c=this._radiusValidator(a);if(""!==a)if((a=this.lengthNode.isValid())&&c){if(!this._validateLengthRadiusProportion(c,a))return null;c&&(a=this.lengthNode.value,this.lengthNode.reset(),this.lengthNode.set("value",a))}else c=null;return c});this.radiusNode.invalidMessage=this.nls.newTraverse.invalidRadiusMessage},
_bearingValidator:function(a,c){return-1!==c.indexOf(a)&&this._itemList&&0<this._itemList.length?!0:this._validateBearing(a,c)},_lengthValidator:function(a,c){return""===a||"0"===a||0===a?!1:this._validateLength(a,c)},_radiusValidator:function(a,c){return""===a?!0:this._validateLength(a,c)},_handleEventsOnInitialRow:function(){this.own(k(this.bearingNode,"keypress",f.hitch(this,this._bearingValueEntered)));this.own(k(this.lengthNode,"keypress",f.hitch(this,this._lengthValueEntered)));this.own(k(this.radiusNode,
"keypress",f.hitch(this,this._radiusValueEntered)))},_copyPrevValue:function(a){switch(a){case "Bearing":a=this.bearingNode.get("value");"*"===a&&0<this._itemList.length&&(a=this._itemList[this._itemList.length-1].BearingConversions?this._getBearingAccordingToPlanSettings(this._itemList[this._itemList.length-1].BearingConversions):this._itemList[this._itemList.length-1].Bearing,this.bearingNode.set("value",a));break;case "Length":a=this.lengthNode.get("value");"*"===a&&0<this._itemList.length&&(a=
"radiusAndArcLength"===this._planSettings.circularCurveParameters&&this._itemList[this._itemList.length-1].ArcLengthConversions?this._itemList[this._itemList.length-1].ArcLengthConversions[this._planSettings.distanceAndLengthUnits]:this._itemList[this._itemList.length-1].LengthConversions?this._itemList[this._itemList.length-1].LengthConversions[this._planSettings.distanceAndLengthUnits]:this._itemList[this._itemList.length-1].Length,this.lengthNode.set("value",a));break;case "Radius":a=this.radiusNode.get("value"),
"*"===a&&0<this._itemList.length&&(a=this._itemList[this._itemList.length-1].RadiusConversions?this._itemList[this._itemList.length-1].RadiusConversions[this._planSettings.distanceAndLengthUnits]:this._itemList[this._itemList.length-1].Radius,this.radiusNode.set("value",a))}},_bearingValueEntered:function(a){a=a.charCode||a.keyCode;a===W.ENTER||a===W.TAB?(this.bearingNode.get("value"),this._copyPrevValue("Bearing"),a===W.ENTER&&this.bearingNode.isValid()?K.focus(this.lengthNode.focusNode):this.bearingNode.validate(!1)):
setTimeout(f.hitch(this,function(){this.bearingNode.validate(!1)}),100)},_lengthValueEntered:function(a){a=a.charCode||a.keyCode;a===W.ENTER||a===W.TAB?(this.lengthNode.get("value"),this._copyPrevValue("Length"),a===W.ENTER&&this.lengthNode.isValid()?K.focus(this.radiusNode.focusNode):this.lengthNode.validate(!1)):setTimeout(f.hitch(this,function(){this.lengthNode.validate(!1)}),100)},_radiusValueEntered:function(a){(a.charCode||a.keyCode)===W.ENTER?(a=this.radiusNode.get("value"),this._copyPrevValue("Radius"),
""===a||this.radiusNode.isValid()?this.bearingNode.isValid()?this.lengthNode.isValid()?(this._addNewItem(),K.focus(this.bearingNode.focusNode)):(this.lengthNode.validate(!1),K.focus(this.lengthNode.focusNode)):(this.bearingNode.validate(!1),K.focus(this.bearingNode.focusNode)):this.radiusNode.validate(!1)):setTimeout(f.hitch(this,function(){this.radiusNode.validate(!1)}),100)},_validateBearing:function(a){return(a=N.categorizeBearingFormat(a,this._planSettings))?a:null},_validateLength:function(a,
c){switch(c){case "feet":a=N.categorizeLengthFormat(a,"feet");break;case "meters":a=N.categorizeLengthFormat(a,"meters");break;case "uSSurveyFeet":a=N.categorizeLengthFormat(a,"uSSurveyFeet");break;default:a=N.categorizeLengthFormat(a,this._planSettings.distanceAndLengthUnits)}return a?a:null},_validateLengthRadiusProportion:function(a,c){return a&&c&&(a=a[this._planSettings.distanceAndLengthUnits],c=c[this._planSettings.distanceAndLengthUnits],0!==a&&(a=2*parseFloat(Math.abs(a)),"radiusAndArcLength"===
this._planSettings.circularCurveParameters&&(a*=Math.PI),a<parseFloat(Math.abs(c))))?null:!0},_getValidatedValues:function(a,c,q){var u={},H;a?(u=a,c&&("Bearing"!==c&&u.BearingConversions&&(u.Bearing=this._getBearingAccordingToPlanSettings(u.BearingConversions)),"Length"!==c&&u.LengthConversions&&(u.Length=u.LengthConversions[this._planSettings.distanceAndLengthUnits]),"Radius"!==c&&u.RadiusConversions&&(u.Radius=u.RadiusConversions[this._planSettings.distanceAndLengthUnits]),"Bearing"===c&&"*tb"===
u.Bearing.toString().toLowerCase()&&0<this._itemList.length&&0!==q&&(u.isTB=!0))):(this._copyPrevValue("Bearing"),this._copyPrevValue("Length"),this._copyPrevValue("Radius"),u.LineSymbol=this._symbolSelector.selectedSymbol,u.Bearing=this.bearingNode.get("value"),u.Length=this.lengthNode.get("value"),u.Radius=this.radiusNode.get("value"),"*tb"===u.Bearing.toString().toLowerCase()&&0<this._itemList.length?u.isTB=!0:u.isTB=!1);if(""!==f.trim(u.Bearing.toString())&&""!==f.trim(u.Length.toString())&&((c=
this._validateBearing(u.Bearing))||u.isTB)){u.BearingConversions=c;if(""===f.trim(u.Length.toString())&&""===f.trim(u.Radius.toString()))return null;if(""!==f.trim(u.Length.toString()))if((c=this._validateLength(u.Length))&&0!==c.meters){if(""!==f.trim(u.Radius.toString()))if(H=this._validateLength(u.Radius)){if(!this._validateLengthRadiusProportion(H,c))return null;u.RadiusConversions=H}else return null;else{if(0>parseInt(c.meters,10))return null;u.RadiusConversions=null}u.LengthConversions=c}else return null;
u.RadiusConversions&&(u=this._createValuesForArc(u));u.isTB&&(a=a&&!isNaN(q)?this._itemList[q-1]:this._itemList[this._itemList.length-1],u=this._setTangentBearing(u,a))}else return null;return u},_setTangentBearing:function(a,c){var q=f.clone(this._planSettings);q.directionOrAngleType="northAzimuth";q.directionOrAngleUnits="decimalDegree";var u=c.BearingConversions.naDD;c.RadiusConversions&&0!==c.RadiusConversions.meters&&(u=A.chordBearingToTangentBearing(u,c.RadiusConversions.meters,c.ChordLengthConversions.meters));
a.RadiusConversions&&0!==a.RadiusConversions.meters?(u=A.tangentBearingToChordBearing(u,a.RadiusConversions.meters,a.ChordLengthConversions.meters),a.Bearing=u,a.BearingConversions=N.categorizeBearingFormat(a.Bearing,q)):c.RadiusConversions&&0!==c.RadiusConversions.meters?(a.Bearing=u,a.BearingConversions=N.categorizeBearingFormat(a.Bearing,q)):(a.Bearing=c.Bearing,a.BearingConversions=f.clone(c.BearingConversions));return a},_updateTBFromIndex:function(a){var c;for(c=!1;a<this._itemList.length;a++)if(this._itemList[a]&&
this._itemList[a].isTB)this._itemList[a]=this._setTangentBearing(this._itemList[a],this._itemList[a-1]),c=!0;else break;return c},_onZoomButtonClicked:function(){this._setExtentToLayer(this.parcelLinesGraphicsLayer,!0)},_onExpandCollapseClicked:function(){e.toggle(this.traverseGrid,"esriCTHidden");e.contains(this.expandCollapseNode,"esriCTExpand")?(F.set(this.expandCollapseNode,"title",this.nls.planSettings.collapseGridTooltipText),e.replace(this.expandCollapseNode,"esriCTCollapse","esriCTExpand"),
F.set(this.expandCollapseNode,"aria-expanded",!0)):(F.set(this.expandCollapseNode,"title",this.nls.planSettings.expandGridTooltipText),e.replace(this.expandCollapseNode,"esriCTExpand","esriCTCollapse"),F.set(this.expandCollapseNode,"aria-expanded",!1))},setRotation:function(a){var c,q;var u=this.startPoint;this._rotationPointInfo&&this._rotationPointInfo.rotationPoint&&(u=this._rotationPointInfo.rotationPoint);var H=new R(4326);A.getProjectedGeometry(a,H,this.geometryService).then(f.hitch(this,function(O){c=
A.getRotationAngleBetweenPoints(u,O);0<this._itemList.length&&(q=0,this._rotationPointInfo&&this._rotationPointInfo.rotationPointIndex<this._itemList.length&&(q=this._rotationPointInfo.rotationPointIndex),c-=this._itemList[q].BearingConversions.naDDRound);360===c&&(c=0);this._parcelToolInstance.setRotation(c)}))},setScaling:function(a){a=A.getScaleDistanceBetweenPoints(this.startPoint,a);this.distance?(a/=this.distance,.1>a&&(a=.1),this._parcelToolInstance.setScale(a)):this.distance=a},_addNewItem:function(a){var c;
if(c=this._getValidatedValues()){if(a&&this._rotationAngle){var q=c.BearingConversions.naDD-this._rotationAngle;q=this.getAngleFromDDTOQB(360<=q?q%360:q);c.Bearing=q;c.BearingConversions=this._validateBearing(q)}q=f.trim(c.Radius.toString());c.rowIndex=this._itemList.length;this._itemList.push(c);this._createRow(c,this._itemList.length-1);K.focus(this.bearingNode.focusNode);this._resetEntryRow(a);""===q||"0"===q||0===q?this._drawStraightLine(c,!0):this._drawArc(c,!0);this._showHideTraverseTools();
this.appliedCompassRule&&this.setParcelClosure()}else this.bearingNode.isValid()?""!==this.lengthNode.get("value")&&this.lengthNode.isValid()?""===this.radiusNode.get("value")||this.radiusNode.isValid()||(K.focus(this.radiusNode.focusNode),this.radiusNode.validate(!1)):(K.focus(this.lengthNode.focusNode),this.lengthNode.validate(!1)):(K.focus(this.bearingNode.focusNode),this.bearingNode.validate(!1))},_createValuesForArc:function(a){if(a.RadiusConversions){var c=a.RadiusConversions.meters;"radiusAndArcLength"===
this._planSettings.circularCurveParameters?(a.ArcLength=a.LengthConversions.meters,a.ArcLengthConversions=f.clone(a.LengthConversions),a.ChordLength=A.getChordLengthFromArcLength(a.ArcLength,c),a.ChordLengthConversions=this._validateLength(a.ChordLength,"meters")):(a.ChordLength=a.LengthConversions.meters,a.ChordLengthConversions=f.clone(a.LengthConversions),a.ArcLength=A.getArcLengthFromChordLength(a.ChordLength,c),a.ArcLengthConversions=this._validateLength(a.ArcLength,"meters"))}else"radiusAndArcLength"===
this._planSettings.circularCurveParameters&&a.ArcLengthConversions&&(a.Length=a.ArcLength,a.LengthConversions=f.clone(a.ArcLengthConversions)),a.ChordLength=0,a.ChordLengthConversions=null,a.ArcLength=0,a.ArcLengthConversions=null;return a},_onDigitizationButtonClicked:function(){e.toggle(this.screenDigitizationNode,"esriCTEnableButton");e.contains(this.screenDigitizationNode,"esriCTEnableButton")?(F.set(this.screenDigitizationNode,"aria-pressed","true"),this.emit("activateDigitizationTool"),this.deActivateUpdateRotationPointTool()):
(F.set(this.screenDigitizationNode,"aria-pressed","false"),this.emit("deActivateDigitizationTool"))},_onUpdateRotationPointButtonClicked:function(){e.toggle(this.updateRotationPointNode,"esriCTEnableButton");e.contains(this.updateRotationPointNode,"esriCTEnableButton")?(F.set(this.updateRotationPointNode,"aria-pressed","true"),this.emit("activateUpdateRotationPointTool"),this.deActivateDigitizationTool()):(F.set(this.updateRotationPointNode,"aria-pressed","false"),this.emit("deActivateUpdateRotationPointTool"))},
_createMiscloseDetails:function(){this._misCloseDetailsInstance=new z({nls:this.nls,config:this.config,appConfig:this.appConfig,numberFieldTypes:this.numberFieldTypes,validateNumericField:this.validateNumericField},v.create("div",{},this.misCloseDetailsNode));this._misCloseDetailsInstance.setMiscloseDetails(null)},_createParcelTools:function(){this._parcelToolInstance=new r({nls:this.nls,config:this.config,canProjectLocally:A.canProjectLocally(this.map.spatialReference)},v.create("div",{},this.parcelToolsNode));
this.own(this._parcelToolInstance.on("rotateGeometries",f.hitch(this,function(a){a!==this._rotationAngle&&(this._rotationAngle=a,this._rotationPointInfo&&this._rotationPointInfo.rotationPoint?this._updateStartPointFromRotationPoint():this._itemList&&0<this._itemList.length&&this.setStartPoint(this.startPoint))})));this.own(this._parcelToolInstance.on("scaleGeometries",f.hitch(this,function(a){a!==this._scaleValue&&(this._scaleValue=a,this._rotationPointInfo&&this._rotationPointInfo.rotationPoint?
this._updateStartPointFromRotationPoint():this._itemList&&0<this._itemList.length&&this.setStartPoint(this.startPoint))})));this.own(this._parcelToolInstance.on("toggleRotating",f.hitch(this,function(a){this.emit("toggleRotating",a)})));this.own(this._parcelToolInstance.on("toggleScaling",f.hitch(this,function(a){this.emit("toggleScaling",a)})))},_createPlanInfo:function(){this._planInfoInstance=new t({map:this.map,nls:this.nls,config:this.config,loading:this.loading,numberFieldTypes:this.numberFieldTypes,
validateNumericField:this.validateNumericField,geometryService:this.geometryService,parcelPolygonGraphicsLayer:this.parcelPolygonGraphicsLayer,parcelLinesGraphicsLayer:this.parcelLinesGraphicsLayer,polylineLayerUnit:A.getUnitValueForSR(this.lineLayerSpatialReference),polygonLayerUnit:A.getUnitValueForSR(this.polygonLayerSpatialReference),widgetDomNode:this.widgetDomNode},v.create("div",{},this.planInfoNode));this.own(this._planInfoInstance.on("cancelTraversedParcel",f.hitch(this,function(){this.emit("cancelTraverse")})));
this.own(this._planInfoInstance.on("showMessage",f.hitch(this,function(a){this._showMessage(a)})));this.own(this._planInfoInstance.on("showParcelSavedAndDeleteMsg",f.hitch(this,function(a){this._showParcelSavedAndDeleteMsg(a)})));this.own(this._planInfoInstance.on("saveTraversedParcel",f.hitch(this,function(){this.closePopup();if(this._itemList&&0<this._itemList.length){var a=this._misCloseDetailsInstance.traverseStatedArea.get("value").trim();var c=this._planInfoInstance.validateParcelDetails(a);
c.status?(""===this._misCloseDetailsInstance.traverseStatedArea.get("value")&&(a=null),c={},c.itemList=this._itemList,c.statedArea=a,c.rotation=this._rotationAngle,c.scale=this._scaleValue,c.appliedCompassRule=this.appliedCompassRule,c.miscloseDetails=this._misCloseDetailsInstance.getMiscloseDetails(),c.polygonDeleteArr=this.polygonDeleteArr,c.polylineDeleteArr=this.polylineDeleteArr,c.planSettings=this._planSettings,this._planInfoInstance.saveData(c)):c.message&&this._showMessage(c.message)}else this._showMessage(this.nls.newTraverse.enterValidParcelInfoMessage)})));
this.own(this._planInfoInstance.on("displayMainPageAfterSave",f.hitch(this,function(){this.emit("displayMainPageAfterSave",!1)})))},_createTraverseGrid:function(){var a;this._nodes=[];v.empty(this.traverseGrid);this._dndContainer=new w(this.traverseGrid,{skipForm:!0,singular:!0});this._dndContainer.copyState=function(){return!1};for(a=0;a<this._itemList.length;a++)this._createRow(this._itemList[a],a);this.own(this._dndContainer.on("DndDrop",f.hitch(this,this._onDndDrop)));this._dndContainer.insertNodes(!1,
this._nodes)},_createFieldInputs:function(a,c,q,u){var H=new p({value:c,"class":q?q:""});H.placeAt(a);"esriCTBearingRow"===q?(F.set(H,"aria-label",this.nls.traverseSettings.bearingLabel),H.validator=f.hitch(this,function(O){"*tb"!==O&&"*"===O.charAt(0)&&(O=O.slice(1));return this._bearingValidator(O,["*tb"])}),H.invalidMessage=this.nls.newTraverse.invalidBearingMessage):"esriCTLengthRow"===q?(F.set(H,"aria-label",this.nls.traverseSettings.lengthLabel),H.validator=f.hitch(this,this._lengthValidator),
H.invalidMessage=this.nls.newTraverse.invalidLengthMessage):"esriCTRadiusRow"===q&&(F.set(H,"aria-label",this.nls.traverseSettings.radiusLabel),H.validator=f.hitch(this,this._radiusValidator),H.invalidMessage=this.nls.newTraverse.invalidRadiusMessage);this.own(k(H,"blur",f.hitch(this,function(){var O=parseInt(F.get(a,"rowIndex"),10);this._updateParcelValues(H,O,u)})));this.own(k(H,"keypress",f.hitch(this,function(O){(O.charCode||O.keyCode)===W.ENTER&&(O=parseInt(F.get(a,"rowIndex"),10),this._updateParcelValues(H,
O,u));setTimeout(f.hitch(this,function(){H.validate(!1)}),100)})))},_createRow:function(a,c){var q=v.create("div",{"class":"dojoDndItem esriCTRow",rowIndex:c});var u=v.create("div",{rowIndex:c},q);this._createLineSelector(u,a.LineSymbol,c);u=this._getBearingAccordingToPlanSettings(a.BearingConversions);a.isTB&&(u="*"+u);this._createFieldInputs(q,u,"esriCTBearingRow");a.RadiusConversions?(u=this._getRoundedValue(a.RadiusConversions,"Radius"),a="radiusAndArcLength"===this._planSettings.circularCurveParameters?
this._getRoundedValue(a.ArcLengthConversions,"Length"):this._getRoundedValue(a.ChordLengthConversions,"Length")):(u="",a=this._getRoundedValue(a.LengthConversions,"Length"));this._createFieldInputs(q,a,"esriCTLengthRow");this._createFieldInputs(q,u,"esriCTRadiusRow");this._createDeleteButton(q,c);this._nodes.push(q);this._dndContainer.clearItems();this._dndContainer.insertNodes(!1,this._nodes)},_createLineSelector:function(a,c,q){var u=new M({hideOnSelect:!0,symbolData:this.config.lineTypes,tabindex:"0",
"aria-label":this.nls.newTraverse.lineTypeLabel,role:"button","aria-haspopup":"true"},a);e.add(u.domNode,"esriCTSymbolContainer");c?(u.selectSymbol(c),F.set(u.domNode,"rowIndex",q),u.onSelect=f.hitch(this,function(H){var O=parseInt(F.get(u.domNode,"rowIndex"),10);this._itemList[O].LineSymbol=H;this.setStartPoint(this.startPoint)})):u.setDefault();return u},_createDeleteButton:function(a,c){var q=v.create("div",{"class":"esriCTDeleteRow"},a);c=v.create("div",{"class":"esriCTDeleteIcon",rowIndex:c,
title:this.nls.traverseSettings.deleteButtonTitle,tabindex:"0",role:"button","aria-label":this.nls.traverseSettings.deleteButtonTitle},q);this.own(k(c,"click",f.hitch(this,function(u){u=parseInt(F.get(u.currentTarget,"rowIndex"),10);this._deleteRow(a,u)})));this.own(k(c,"keydown",f.hitch(this,function(u){if(u.keyCode===W.ENTER||u.keyCode===W.SPACE)u=parseInt(F.get(u.currentTarget,"rowIndex"),10),this._deleteRow(a,u),K.focus(this.bearingNode.focusNode)})))},_deleteRow:function(a,c){var q;if(this._itemList.length){this._dndContainer.delItem(a.id);
v.destroy(a);this._nodes.splice(c,1);this._itemList.splice(c,1);this._dndContainer.sync();this._updateRowIndexes();if(this._itemList[c]&&this._itemList[c].isTB){if(1===this._itemList.length||0===c)this._itemList[0].isTB=!1,c++;1<this._itemList.length&&(q=this._updateTBFromIndex(c))}this.appliedCompassRule?this.setParcelClosure(!0,!0):this.setStartPoint(this.startPoint,!0);q&&this._reGenerateTraverseGrid();this._showHideTraverseTools()}},_updateRowIndexes:function(){var a=U(".esriCTRow",this.traverseGrid);
n.forEach(a,f.hitch(this,function(c,q){var u;this._itemList[q].rowIndex=q;F.set(c,"rowIndex",q);(u=U(".esriCTDeleteIcon",c)[0])&&F.set(u,"rowIndex",q);(c=U(".esriCTSymbolContainer",c)[0])&&F.set(c,"rowIndex",q)}))},_onDndDrop:function(){var a=[];this._dndContainer.sync();var c=this._dndContainer.getAllNodes();c.forEach(f.hitch(this,function(u,H){u=parseInt(F.get(u,"rowIndex"),10);a.push(this._itemList[u])}));this._nodes=c;this._itemList=[];this._itemList=a;this._updateRowIndexes();for(c=0;c<this._itemList.length;c++){if(0===
c&&this._itemList[c].isTB){this._itemList[c].isTB=!1;var q=!0}this._itemList[c]&&this._itemList[c].isTB&&(this._itemList[c]=this._setTangentBearing(this._itemList[c],this._itemList[c-1]),q=!0)}this.setStartPoint(this.startPoint,!0);q&&this._reGenerateTraverseGrid()},_updateParcelValues:function(a,c,q){var u,H=!1;if(u=this._itemList[c]){var O=(O=a.get("value"))?f.trim(O.toString()):"";if(e.contains(a.domNode,"esriCTBearingRow")&&String(this._getBearingAccordingToPlanSettings(u.BearingConversions))!==
O){var X="Bearing";u.Bearing=O;H=!0;-1===O.indexOf("*")&&(u.isTB=!1)}else e.contains(a.domNode,"esriCTLengthRow")&&String(this._getRoundedValue(u.LengthConversions,"Length"))!==O?(X="Length",u.Length=O,H=!0):e.contains(a.domNode,"esriCTRadiusRow")&&String(u.Radius)!==O&&(u.RadiusConversions?String(this._getRoundedValue(u.RadiusConversions,"Radius"))!==O&&(X="Radius",u.Radius=O,H=!0):(X="Radius",u.Radius=O,H=!0));if(H)if(O=this._getValidatedValues(u,X,c)){if("Bearing"===X){X=this._getBearingAccordingToPlanSettings(O.BearingConversions);
u.Bearing=this._getBearingAccordingToPlanSettings(O.BearingConversions,!0);u.isTB&&(X="*"+X);a.set("value",X);var C=this._updateTBFromIndex(c+1)}else"Length"===X?(X=this._getRoundedValue(u.LengthConversions,"Length"),u.Length=u.LengthConversions[this._planSettings.distanceAndLengthUnits],u.RadiusConversions&&(u=this._createValuesForArc(u)),a.set("value",X),C=this._updateTBFromIndex(c)):"Radius"===X&&(u.RadiusConversions?(u.Radius=u.RadiusConversions[this._planSettings.distanceAndLengthUnits],X=this._getRoundedValue(u.RadiusConversions,
"Radius")):X=u.Radius="",u=this._createValuesForArc(u),a.set("value",X),C=this._updateTBFromIndex(c));this.appliedCompassRule?this.setParcelClosure(!0,!0):this.setStartPoint(this.startPoint,!0);if(C||q)this._reGenerateTraverseGrid(),q&&this._popupCoords&&this._openPopup(this._popupCoords)}else this._updateValues(u,X,a)}},_updateValues:function(a,c,q){if("Bearing"===c){a.Bearing=this._getBearingAccordingToPlanSettings(a.BearingConversions,!0);var u=this._getBearingAccordingToPlanSettings(a.BearingConversions)}else"Length"===
c?(a.Length=a.LengthConversions[this._planSettings.distanceAndLengthUnits],u=this._getRoundedValue(a.LengthConversions,"Length")):"Radius"===c&&(a.RadiusConversions?(a.Radius=a.RadiusConversions[this._planSettings.distanceAndLengthUnits],u=this._getRoundedValue(a.RadiusConversions,"Radius")):u=a.Radius="");q.set("value",u)},_showHideTraverseTools:function(){this._itemList&&0<this._itemList.length?(e.remove(this.expandCollapseNode,"esriCTHidden"),e.remove(this.zoomToNode,"esriCTHidden")):(e.add(this.expandCollapseNode,
"esriCTHidden"),e.add(this.zoomToNode,"esriCTHidden"))},_getBearingAccordingToPlanSettings:function(a,c){if("northAzimuth"===this._planSettings.directionOrAngleType&&"decimalDegree"===this._planSettings.directionOrAngleUnits)return c?a.naDD:a.naDDRound;if("northAzimuth"===this._planSettings.directionOrAngleType&&"degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits)return a.naDMS;if("southAzimuth"===this._planSettings.directionOrAngleType&&"decimalDegree"===this._planSettings.directionOrAngleUnits)return c?
a.saDD:a.saDDRound;if("southAzimuth"===this._planSettings.directionOrAngleType&&"degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits)return a.saDMS;if("quadrantBearing"===this._planSettings.directionOrAngleType&&"decimalDegree"===this._planSettings.directionOrAngleUnits)return c?a.qb3DD:a.qb3DDRound;if("quadrantBearing"===this._planSettings.directionOrAngleType&&"degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits)return a.qb3DMS},_getRoundedValue:function(a,c){a=a[this._planSettings.distanceAndLengthUnits];
switch(c){case "Length":var q=this.lengthFieldPlaces;break;case "Radius":q=this.radiusFieldPlaces;break;case "MiscloseDistance":q=this.miscloseDistanceFieldPlaces}return N.honourPopupRounding(q,a)},_resetEntryRow:function(a){this.bearingNode.set("value","");this.lengthNode.set("value","");this.radiusNode.set("value","");this.bearingNode.reset();this.lengthNode.reset();this.radiusNode.reset();0<this._itemList.length&&(a=this._itemList[this._itemList.length-1].isTB?"*tb":a?this._getBearingAccordingToPlanSettings(this._itemList[this._itemList.length-
1].BearingConversions):this._itemList[this._itemList.length-1].Bearing,this.bearingNode.set("value",a),this.bearingNode.textbox.setSelectionRange(0,a.length))},_reGenerateTraverseGrid:function(){this._dndContainer&&(this._dndContainer.destroy(),this._dndContainer=null);v.empty(this.traverseGrid);this._createTraverseGrid()},_showRotationPoint:function(){var a=this.startPoint;if(this.config.startOrRotaionSymbol)var c=P.fromJson(this.config.startOrRotaionSymbol);else{var q={color:[136,136,136,255],size:11.25,
angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[29,29,53,255],width:.75,type:"esriSLS",style:"esriSLSSolid"}};c=P.fromJson(q)}this._rotationPointInfo&&this._rotationPointInfo.rotationPoint&&(a=this._rotationPointInfo.rotationPoint);4326!==this.map.spatialReference.wkid?A.getProjectedGeometry(a,this.map.spatialReference,this.geometryService).then(f.hitch(this,function(u){u&&(u=new I(u),u.setSymbol(c),this.rotationPointsGraphicsLayer.clear(),this.rotationPointsGraphicsLayer.add(u))})):
(q=new I(a),q.setSymbol(c),this.rotationPointsGraphicsLayer.clear(),this.rotationPointsGraphicsLayer.add(q))},resetRotationPoint:function(a){this._setRotationPoint(0,a)},_setRotationPoint:function(a,c){var q=c;c=new R(4326);A.getProjectedGeometry(q,c,this.geometryService).then(f.hitch(this,function(u){q=u;this._rotationPointInfo={rotationPointIndex:a,rotationPoint:q}}))},_updateStartPointFromRotationPoint:function(){var a=this._rotationPointInfo.rotationPoint,c=this._rotationPointInfo.rotationPointIndex;
if(null!==this._rotationAngle){for(--c;0<=c;c--){var q=this._itemList[c];var u=Number(q.BearingConversions.naDD)+this._rotationAngle;var H=q.LengthConversions.meters;this._scaleValue&&(H*=this._scaleValue);u=N.getSouthAzimuthFromNorthAzimuth(u);""===q.Radius||"0"===q.Radius||0===q.Radius?a=A.getDestinationPoint(a,u,H):(H=q.RadiusConversions.meters,q=q.ChordLengthConversions.meters,this._scaleValue&&(H*=this._scaleValue,q*=this._scaleValue),a=this.getArcInfo(a,u,H,q),a=a.endPoint)}this.setStartPoint(a)}},
_reDrawParcel:function(){this.parcelLinesGraphicsLayer.clear();this.parcelPointsGraphicsLayer.clear();this._arrayOfAllBoundaryLines=[];this._drawPoint(this.startPoint);n.forEach(this._itemList,f.hitch(this,function(a){""===a.Radius||"0"===a.Radius||0===a.Radius?this._drawStraightLine(a,!1):this._drawArc(a,!1)}));this._setExtentToLayer(this.parcelLinesGraphicsLayer);this.setParcelClosure()},setStartPoint:function(a,c,q,u){var H=new R(4326);A.getProjectedGeometry(a,H,this.geometryService).then(f.hitch(this,
function(O){q&&this._rotationPointInfo?(this._setRotationPoint(this._rotationPointInfo.rotationPointIndex,O),this._updateStartPointFromRotationPoint()):(this.startPoint=O,c&&this.resetRotationPoint(this.startPoint),this._showRotationPoint(),this._startPointForNextLine=f.clone(O),this._orgStartPointForNextLine=f.clone(O),this.appliedCompassRule=!1,0<this._itemList.length?this._reDrawParcel():(this.parcelPointsGraphicsLayer.clear(),this.parcelLinesGraphicsLayer.clear(),this._arrayOfAllBoundaryLines=
[],this._drawPoint(a,u)))}))},_addProjectedGraphic:function(a,c,q,u){var H,O={},X=q.setExtentToLayer,C=q.setParcelClosure,D=q.startNewTraverseBtnClick;O.rowIndex=u?u.rowIndex:a.graphics.length;c.attributes=O;4326!==this.map.spatialReference.wkid?A.getProjectedGeometry(c.geometry,this.map.spatialReference,this.geometryService).then(f.hitch(this,function(L){L&&(H=new I(L),H.setAttributes(O),H.setSymbol(c.symbol),a.add(H),u&&(u.graphic=H),D&&a.graphics&&0<a.graphics.length&&this.map.centerAt(a.graphics[0].geometry),
X&&(this._setExtentToLayer(a),C&&this.setParcelClosure()))})):(a.add(c),D&&a.graphics&&0<a.graphics.length&&this.map.centerAt(a.graphics[0].geometry),X&&(this._setExtentToLayer(a),C&&this.setParcelClosure()))},_drawPoint:function(a,c){a=new I(a,P.fromJson(this.config.pointSymbol));this._addProjectedGraphic(this.parcelPointsGraphicsLayer,a,{setExtentToLayer:!1,setParcelClosure:!1,startNewTraverseBtnClick:c})},_drawLineAndEndPoint:function(a,c,q,u){var H=!0;a?(c=A.getLineBetweenPoints(c))?(c=new I(c,
P.fromJson(q.LineSymbol.symbol)),this._addProjectedGraphic(this.parcelLinesGraphicsLayer,c,{setExtentToLayer:u,setParcelClosure:!0,startNewTraverseBtnClick:!1},q),this._startPointForNextLine=f.clone(a),this.appliedCompassRule&&this.parcelLinesGraphicsLayer.graphics.length===this._itemList.length&&(H=!1),H&&this._drawPoint(a)):this._showMessage(this.nls.newTraverse.unableToDrawLineMessage):this._showMessage(this.nls.newTraverse.invalidEndPointMessage)},setInfoForCalculatingMisclose:function(a,c,q){a.startPoint=
f.clone(this._orgStartPointForNextLine);a.endpoint=f.clone(c);q=A.getLineBetweenPoints(q);if(a.LineSymbol.type===this.config.BoundaryLineType)for(var u=0;u<q.paths.length;u++)this._arrayOfAllBoundaryLines.push(q.paths[u]);this._orgStartPointForNextLine=f.clone(c);return a},getArcInfo:function(a,c,q,u){var H=A.getDestinationPoint(a,c,Math.abs(u));var O=Math.abs(u)/2;var X=A.getDestinationPoint(a,c,O);a={distance:u,radius:q,initBearing:c,chordMidPoint:X,centerAndChordDistance:Math.sqrt(Math.abs(q*q-
O*O)),chordEndPoint:H,chordStartPoint:a};c=A.getArcParam(a);c.startAngle=c.startAngle>c.endAngle?c.startAngle-360:c.startAngle;c=A.getPointsForArc(c.startAngle,c.endAngle,c.centerPoint,q);0===c.length&&(c.push(a.chordStartPoint),c.push(a.chordEndPoint));0>q&&c.reverse();return{endPoint:H,arcGeometryPointsArray:c}},_drawStraightLine:function(a,c){var q=a.BearingConversions.naDD;var u=a.LengthConversions.meters;if(a.adjustedValues&&this.adjustPoints){q=a.adjustedValues.adjustedBearing;if("S"===a.BearingConversions.qb3DDRound.charAt(0)||
0>a.adjustedValues.lat)q=a.adjustedValues.adjustedBearingNADD;u=a.adjustedValues.adjustedLength;this.appliedCompassRule=!0}this._rotationAngle&&(q=Number(q)+this._rotationAngle);this._scaleValue&&(u*=this._scaleValue);var H=A.getDestinationPoint(this._orgStartPointForNextLine,a.BearingConversions.naDD,a.LengthConversions.meters);q=A.getDestinationPoint(this._startPointForNextLine,q,u);a=this.setInfoForCalculatingMisclose(a,H,[this._orgStartPointForNextLine,H]);this._drawLineAndEndPoint(q,[this._startPointForNextLine,
q],a,c)},_drawArc:function(a,c){var q=a.BearingConversions.naDD;var u=a.RadiusConversions.meters;var H=a.ChordLengthConversions.meters;if(a.adjustedValues&&this.adjustPoints){q=a.adjustedValues.adjustedBearing;if("S"===a.BearingConversions.qb3DDRound.charAt(0)||0>a.adjustedValues.lat)q=a.adjustedValues.adjustedBearingNADD;H=a.adjustedValues.adjustedLength;0>a.ChordLengthConversions.meters&&(H*=-1);this.appliedCompassRule=!0}this._rotationAngle&&(q=Number(q)+this._rotationAngle);this._scaleValue&&
(H*=this._scaleValue,u*=this._scaleValue);var O=this.getArcInfo(this._orgStartPointForNextLine,a.BearingConversions.naDD,a.RadiusConversions.meters,a.ChordLengthConversions.meters);a=this.setInfoForCalculatingMisclose(a,O.endPoint,O.arcGeometryPointsArray);u=this.getArcInfo(this._startPointForNextLine,q,u,H);this._drawLineAndEndPoint(u.endPoint,u.arcGeometryPointsArray,a,c)},_setExtentToLayer:function(a,c){this._setExtentTimer&&clearTimeout(this._setExtentTimer);this._setExtentTimer=setTimeout(f.hitch(this,
function(){if(0<a.graphics.length){var q=Q.graphicsExtent(a.graphics);!c&&this.map.extent.contains(q)||this.map.setExtent(q.expand(1.5))}}),200)},_showMessage:function(a){this.emit("showMessage",a)},updateAccordingToPlanSettings:function(a){this._planSettings=a;this.bearingNode.set("placeHolder",this._getAbbreviatedUnits(a.directionOrAngleUnits));this.lengthNode.set("placeHolder",this._getAbbreviatedUnits(a.distanceAndLengthUnits));this.radiusNode.set("placeHolder",this._getAbbreviatedUnits(a.distanceAndLengthUnits));
this._reGenerateTraverseGrid();this._misCloseDetailsInstance&&(a=this._misCloseDetailsInstance.getMiscloseDetails())&&(a=this._getMiscloseDetailsAccordingToPlanSettings(a),this._misCloseDetailsInstance.updateAccordingToPlanSettings(a))},deActivateUpdateRotationPointTool:function(){e.remove(this.updateRotationPointNode,"esriCTEnableButton");F.set(this.updateRotationPointNode,"aria-pressed","false")},deActivateDigitizationTool:function(){e.remove(this.screenDigitizationNode,"esriCTEnableButton");F.set(this.screenDigitizationNode,
"aria-pressed","false")},pointAddedFromDigitization:function(a){var c,q,u;var H=new R(4326);A.getProjectedGeometry(a,H,this.geometryService).then(f.hitch(this,function(O){c=A.getAngleBetweenPoints(this._startPointForNextLine,O);360===c&&(c=0);q=A.getDistanceBetweenPoints(this._startPointForNextLine,O);u=this.getAngleFromDDTOQB(c);0===q&&(u="");this.bearingNode.set("value",u);"uSSurveyFeet"===this._planSettings.distanceAndLengthUnits?q=N.metersToUSSurveyFeet(q):"feet"===this._planSettings.distanceAndLengthUnits&&
(q=N.metersToFeet(q));0<this._scaleValue&&(q/=this._scaleValue);this.lengthNode.set("value",q);this.radiusNode.set("value","");this._addNewItem(!0)}))},getParcelCloseDetails:function(){var a,c,q,u;var H={isClosed:!1,compassStartPoint:null,compassEndPoint:null};var O=!0;var X=a=c=0;n.forEach(this._itemList,f.hitch(this,function(L,T){L.LineSymbol.type===this.config.BoundaryLineType?(T=L.ChordLengthConversions?L.ChordLengthConversions.meters:L.LengthConversions.meters,0===c?q=L.startPoint:u=L.endpoint,
c++,a+=Math.cos(L.BearingConversions.naDD/180*Math.PI)*T,X+=Math.sin(L.BearingConversions.naDD/180*Math.PI)*T):0<T&&0!==c&&(O=!1)}));if(1<c&&O){var C=Math.sqrt(a*a+X*X);C=A.removeNegativeExponents(C);q.x=N.showFixedPlacesAfterDecimal(q.x,6);q.y=N.showFixedPlacesAfterDecimal(q.y,6);u.x=N.showFixedPlacesAfterDecimal(u.x,6);u.y=N.showFixedPlacesAfterDecimal(u.y,6);var D=A.getAngleBetweenPoints(u,q);H.isClosed=!0;H.compassStartPoint=q;H.compassEndPoint=u;H.miscloseDistance=C;H.miscloseBearing=D}return H},
setParcelClosure:function(a,c){var q=this.getParcelCloseDetails();if(q.isClosed)q=this.getCalculatedMiscloseDetails(q),this._misCloseDetailsInstance.setMiscloseDetails(q),q.adjustPoints?((this.adjustPoints=this._applyCompassRule(q))&&!this.appliedCompassRule||a)&&this.setStartPoint(this.startPoint,c):(this.adjustPoints=!1,(this.appliedCompassRule||a)&&this.setStartPoint(this.startPoint,c));else if(this._misCloseDetailsInstance.setMiscloseDetails(null),this.adjustPoints=!1,this.appliedCompassRule||
a)this.appliedCompassRule=!1,this.setStartPoint(this.startPoint,c)},_getMiscloseDetailsAccordingToPlanSettings:function(a){var c={};a.BearingConversions&&(c.miscloseBearing=this._getBearingAccordingToPlanSettings(a.BearingConversions));var q=this._getRoundedValue(a.LengthConversions,"MiscloseDistance");c.miscloseDistance=J.localizeNumber(Number(q))+" "+this._getAbbreviatedUnits(this._planSettings.distanceAndLengthUnits);a.AreaConversions?(a=a.AreaConversions[this._planSettings.areaUnits],isNaN(parseFloat(a))||
(a=N.honourPopupRounding(2,a.toFixed(1)))):a=0;a=J.localizeNumber(Number(a))+" "+this._getAbbreviatedUnits(this._planSettings.areaUnits);c.calculatedArea=a;return c},getCalculatedMiscloseDetails:function(a){var c,q={},u=c=0;u=0;var H=!1;c=a.compassStartPoint;if(a.compassEndPoint&&c){c=a.miscloseDistance;u=a.miscloseBearing;0===c&&(u=0);u=this.getAngleFromDDTOQB(u);if(a=N.categorizeBearingFormat(u,this._planSettings))q.BearingConversions=a;q.AreaConversions=this._getCalculatedArea();a=this._getMiscloseRatioInfo(c);
u=a.miscloseRatio;q.miscloseValue=a.miscloseValue;c=N.categorizeLengthFormat(c,"meters");q.LengthConversions=c;c=c[this.config.miscloseSnapDistanceUnit+"Round"];1E5<=u&&(H=!0);q.miscloseRatio=u;q.accuracy=H;q=f.mixin(q,this._getMiscloseDetailsAccordingToPlanSettings(q));if(0<c&&c<=this.config.miscloseSnapDistance||isFinite(u)&&u>=this.config.miscloseRatioSnap)q.adjustPoints=!0,q.compassCompleteLength=a.compassCompleteLength}return q},_getPolygonAtOrigin:function(){var a=new x(0,0,new R(4326)),c=[];
n.forEach(this._itemList,f.hitch(this,function(q){if(q.LineSymbol.type===this.config.BoundaryLineType){if(""===q.Radius||"0"===q.Radius||0===q.Radius){if(q.adjustedValues&&this.adjustPoints){var u=q.adjustedValues.adjustedBearing;if("S"===q.BearingConversions.qb3DDRound.charAt(0)||0>q.adjustedValues.lat)u=q.adjustedValues.adjustedBearingNADD;var H=q.adjustedValues.adjustedLength}else u=q.BearingConversions.naDD,H=q.LengthConversions.meters;q=A.getDestinationPoint(a,u,H);H=A.getLineBetweenPoints([a,
q])}else{if(q.adjustedValues&&this.adjustPoints){u=q.adjustedValues.adjustedBearing;if("S"===q.BearingConversions.qb3DDRound.charAt(0)||0>q.adjustedValues.lat)u=q.adjustedValues.adjustedBearingNADD;H=q.adjustedValues.adjustedLength;0>q.ChordLengthConversions.meters&&(H*=-1)}else u=q.BearingConversions.naDD,H=q.ChordLengthConversions.meters;H=this.getArcInfo(a,u,q.RadiusConversions.meters,H);q=H.endPoint;H=A.getLineBetweenPoints(H.arcGeometryPointsArray)}a=q;for(q=0;q<H.paths.length;q++)c.push(H.paths[q])}}));
return A.getPolygonFromPolyLines(c,!0)},_getCalculatedArea:function(){var a;if(this._arrayOfAllBoundaryLines&&0<this._arrayOfAllBoundaryLines.length&&(a=this._getPolygonAtOrigin())){var c=new I(a);this.parcelPolygonGraphicsLayer.clear();this.parcelPolygonGraphicsLayer.add(c);c=A.getAreaOfGeometry(a)}return c},_applyCompassRule:function(a){var c,q;var u=q=0;var H={};for(c=0;c<this._itemList.length;c++){var O=this._itemList[c];if(O.LineSymbol.type===this.config.BoundaryLineType){if(""===O.Radius||"0"===
O.Radius||0===O.Radius)var X=O.LengthConversions.meters;else O.ChordLengthConversions&&(X=O.ChordLengthConversions.meters);X=Math.abs(X);O.lat=X*Math.cos(Math.PI/180*O.BearingConversions.naDD);O.dep=X*Math.sin(Math.PI/180*O.BearingConversions.naDD);q+=O.lat;u+=O.dep}}H.sumOfLat=q;H.sumOfDep=u;H.sumOfAllLinesLength=a.compassCompleteLength;for(c=0;c<this._itemList.length;c++)O=this._itemList[c],""===O.Radius||"0"===O.Radius||0===O.Radius?X=O.LengthConversions.meters:O.ChordLengthConversions&&(X=O.ChordLengthConversions.meters),
X=Math.abs(X),O.LineSymbol.type===this.config.BoundaryLineType&&(O.adjustedValues=this._adjustBearingAndDistance(O.lat,O.dep,X,H));for(c=X=a=0;c<this._itemList.length;c++)O=this._itemList[c],O.LineSymbol.type===this.config.BoundaryLineType&&(a+=parseFloat(O.adjustedValues.lat.toFixed(2)),X+=parseFloat(O.adjustedValues.dep.toFixed(2)),a=parseFloat(a.toFixed(2)),X=parseFloat(X.toFixed(2)));return 0===parseInt(a,10)&&0===parseInt(X,10)?!0:!1},_adjustBearingAndDistance:function(a,c,q,u){var H={};a=parseFloat(a.toFixed(6));
c=parseFloat(c.toFixed(6));q=parseFloat(q.toFixed(6));var O=-u.sumOfLat/u.sumOfAllLinesLength*q;q*=-u.sumOfDep/u.sumOfAllLinesLength;O=parseFloat(O.toFixed(6));q=parseFloat(q.toFixed(6));c+=q;a=parseFloat((a+O).toFixed(6));c=parseFloat(c.toFixed(6));O=Math.sqrt(Math.pow(a,2)+Math.pow(c,2));q=Math.atan(c/a);q=parseFloat(q.toFixed(6));H.lat=a;H.dep=c;H.adjustedLength=O;H.adjustedBearing=180/Math.PI*q;a=N.categorizeBearingFormat(H.adjustedBearing,{directionOrAngleType:"southAzimuth",directionOrAngleUnits:"decimalDegree"});
H.adjustedBearingNADD=a.naDD;return H},_getMiscloseRatioInfo:function(a){var c,q=c=0;var u=0;this._arrayOfAllBoundaryLines&&0<this._arrayOfAllBoundaryLines.length&&(c=A.getPolyLineFromPaths(this._arrayOfAllBoundaryLines),c=A.getLengthOfGeometry(c),0<c&&(q=1/(a/c),10>q?q=0:1E5>q&&(u=parseInt(q,10),q="1:"+parseInt(q,10))));return{miscloseRatio:q,miscloseValue:u,compassCompleteLength:c}},getAngleFromDDTOQB:function(a){var c;var q=f.clone(this._planSettings);q.directionOrAngleType="northAzimuth";q.directionOrAngleUnits=
"decimalDegree";(a=N.categorizeBearingFormat(a,q))&&(c="degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits?a.qb3DMS:a.qb3DD);return c},initEditing:function(a,c,q){var u;this._planInfoInstance.setParcelInformation(this.polygonDeleteArr,c.features);var H=this.polygonDeleteArr[0].attributes[this.config.polygonLayer.rotation.name];(u=this.polygonDeleteArr[0].attributes[this.config.polygonLayer.scale.name])||(u=1);var O=this.polygonDeleteArr[0].attributes[this.config.polygonLayer.statedArea.name];
this._parcelToolInstance.setRotation(H);this._parcelToolInstance.setScale(u);null!==O&&void 0!==O&&this._misCloseDetailsInstance.traverseStatedArea.set("value",O);u=[];var X=A.getUnitValueForSR(q);var C=f.clone(this._planSettings);C.directionOrAngleType="northAzimuth";C.directionOrAngleUnits="decimalDegree";for(q=0;q<c.features.length;q++)if(H={},H.Bearing=c.features[q].attributes[this.config.polylineLayer.bearing.name],null!==H.Bearing&&void 0!==H.Bearing&&""!==H.Bearing){H.BearingConversions=N.categorizeBearingFormat(H.Bearing,
C);H.Bearing=this._getBearingAccordingToPlanSettings(H.BearingConversions,!0);H.Length=c.features[q].attributes[this.config.polylineLayer.distance.name];null!==H.Length&&""!==H.Length&&(H.LengthConversions=this._validateLength(H.Length,X),H.Length=H.LengthConversions[this._planSettings.distanceAndLengthUnits]);if(O=this.getLineSymbolForType(c.features[q].attributes[this.config.polylineLayer.lineType.name]))H.LineSymbol=O;H.Radius=c.features[q].attributes[this.config.polylineLayer.radius.name];null!==
H.Radius&&""!==H.Radius?(H.RadiusConversions=this._validateLength(H.Radius,X),H.Radius=H.RadiusConversions[this._planSettings.distanceAndLengthUnits],H.ArcLength=c.features[q].attributes[this.config.polylineLayer.arcLength.name],null!==H.ArcLength&&""!==H.ArcLength&&(H.ArcLengthConversions=this._validateLength(H.ArcLength,X),H.ArcLength=H.ArcLengthConversions[this._planSettings.distanceAndLengthUnits]),H.ChordLength=c.features[q].attributes[this.config.polylineLayer.chordLength.name],null!==H.ChordLength&&
""!==H.ChordLength&&(H.ChordLengthConversions=this._validateLength(H.ChordLength,X),H.ChordLength=H.ChordLengthConversions[this._planSettings.distanceAndLengthUnits]),"radiusAndArcLength"===this._planSettings.circularCurveParameters?(H.Length=H.ArcLength,H.LengthConversions=f.clone(H.ArcLengthConversions)):(H.Length=H.ChordLength,H.LengthConversions=f.clone(H.ChordLengthConversions))):(H.Radius="",H.RadiusConversions=null);H.rowIndex=u.length;u.push(H)}this._itemList=u;this._reGenerateTraverseGrid();
this._showHideTraverseTools();this.setStartPoint(a,!0);this.setBoundaryLineSymbol()},setBoundaryLineSymbol:function(){this._symbolSelector&&n.some(this.config.lineTypes,f.hitch(this,function(a){if(this.config.BoundaryLineType===a.type)return this._symbolSelector.selectSymbol(a),!1}))},getLineSymbolForType:function(a){var c;n.some(this.config.lineTypes,f.hitch(this,function(q){if(q.type===a)return c=f.clone(q),!0}));return c},deactivateParcelTools:function(){this._parcelToolInstance.disableRotating();
this._parcelToolInstance.disableScaling()},clearAll:function(){this.parcelLinesGraphicsLayer.clear();this.parcelPointsGraphicsLayer.clear();this.parcelPolygonGraphicsLayer.clear();this.rotationPointsGraphicsLayer.clear();this._resetEntryRow();this._dndContainer.clearItems();v.empty(this.traverseGrid);this._itemList=[];this._nodes=[];this._showHideTraverseTools();this._orgStartPointForNextLine=this._startPointForNextLine=this.startPoint=null;this._rotationAngle=0;this._scaleValue=1;this._symbolSelector.setDefault();
e.remove(this.screenDigitizationNode,"esriCTEnableButton");e.remove(this.updateRotationPointNode,"esriCTEnableButton");this._parcelToolInstance.resetTools();this.deactivateParcelTools();this._misCloseDetailsInstance.setMiscloseDetails(null);this._arrayOfAllBoundaryLines=[];this.polygonDeleteArr=[];this.polylineDeleteArr=[];this.domNode.scrollTop=0;this._planInfoInstance.resetValues();this._misCloseDetailsInstance.traverseStatedArea.set("value",null);this._rotationPointInfo=null;this.closePopup()},
_showParcelPopup:function(a){var c=[];var q=new b;var u=this._pointToExtent(a.mapPoint,8);c=n.filter(this.parcelLinesGraphicsLayer.graphics,function(H){return u.intersects(H.geometry)});c[0]?(this._createPopupContent(a,c[0]),q.resolve(!0)):(this.closePopup(),q.resolve(!1));return q},_getAbbreviatedUnits:function(a){return window.jimuNls.units[a+"Abbr"]},_pointToExtent:function(a,c){var q=this.map.extent.getWidth()/this.map.width;c*=q;return new g(a.x-c,a.y-c,a.x+c,a.y+c,this.map.spatialReference)},
_createPopupContent:function(a,c){var q;if(q=this._itemList[c.attributes.rowIndex]){var u=v.create("div",{"class":"esriCTParcelInfoPopup "+this.baseClass},null);var H=v.create("div",{"class":"esriCTLabelRows"},u);this._createFieldLabels(H,this.nls.traverseSettings.bearingLabel);this._createFieldLabels(H,this.nls.traverseSettings.lengthLabel);this._createFieldLabels(H,this.nls.traverseSettings.radiusLabel);c=v.create("div",{"class":"esriCTRowContainer esriCTRow",rowIndex:c.attributes.rowIndex},u);
this._createFieldInputs(c,this._getBearingAccordingToPlanSettings(q.BearingConversions),"esriCTBearingRow",!0);(H=q.RadiusConversions)?(H=this._getRoundedValue(q.RadiusConversions,"Radius"),q="radiusAndArcLength"===this._planSettings.circularCurveParameters?this._getRoundedValue(q.ArcLengthConversions,"Length"):this._getRoundedValue(q.ChordLengthConversions,"Length")):(H="",q=this._getRoundedValue(q.LengthConversions,"Length"));this._createFieldInputs(c,q,"esriCTLengthRow",!0);this._createFieldInputs(c,
H,"esriCTRadiusRow",!0);G.position(this.traverseEntryNode)&&G.position(this.traverseEntryNode).w&&(q=G.position(this.traverseEntryNode).w-42,B.set(this._popupDialog.domNode,"width",q+"px"));this._popupDialog.setContent(u);this._popupCoords={pageX:a.pageX,pageY:a.pageY};this._openPopup(a)}},_openPopup:function(a){B.set(this._popupDialog.domNode,"opacity",.9);y.open({popup:this._popupDialog,x:a.pageX,y:a.pageY})},closePopup:function(){this._popupDialog&&y.close(this._popupDialog)},_createFieldLabels:function(a,
c){v.create("div",{innerHTML:c,title:c,"class":"esriCTParcelInfoLabels"},a)},_createTooltip:function(){this._popupDialog=new V({"class":"esriCTEditParcelDialog"});this._popupDialog.startup()},validateNumericField:function(a,c){var q=/^[-+]?[0-9]+\.[0-9]+$/,u=/^[-+]?[0-9]+$/;a=f.trim(a);switch(c){case "esriFieldTypeSmallInteger":c=parseInt(a,10);var H=a.match(u)&&-32768<=c&&32767>=c&&0!==a.length?!0:!1;break;case "esriFieldTypeInteger":c=parseInt(a,10);H=a.match(u)&&-2147483648<=c&&2147483647>=c&&
0!==a.length?!0:!1;break;case "esriFieldTypeSingle":c=parseFloat(a);H=(a.match(u)||a.match(q))&&c>=-3.4*Math.pow(10,38)&&c<=1.2*Math.pow(10,38)&&0!==a.length?!0:!1;break;case "esriFieldTypeDouble":c=parseFloat(a),H=(a.match(u)||a.match(q))&&c>=-2.2*Math.pow(10,308)&&c<=1.8*Math.pow(10,38)&&0!==a.length?!0:!1}return H},updateLastNodeInTraversePanel:function(){this._planInfoInstance.setPlanInfoCancelBtnAsLastNode()},_showParcelSavedAndDeleteMsg:function(a){this.emit("showParcelSavedAndDeleteMsg",a)}})})},
"widgets/ParcelDrafter/SymbolSelector":function(){define("dojo/_base/declare jimu/BaseWidget dojo/_base/lang dojo/on dojo/dom-construct dojo/_base/array jimu/symbolUtils esri/symbols/jsonUtils dijit/popup dijit/TooltipDialog dojo/_base/html dojo/keys dojo/query dijit/focus".split(" "),function(E,d,h,l,m,f,n,e,v,B,w,k,p,M){return E([d],{_tooltipDialog:null,selectedSymbol:null,symbolData:[],constructor:function(z){h.mixin(this,z)},postCreate:function(){this.symbolData||(this.symbolData=[]);this._createSelectedSymbolNode();
this._hideTooltipDialog();this.symbolData&&0<this.symbolData.length&&(this._createTooltipDialog(),this.symbolData[1].isDefault?this.selectSymbol(this.symbolData[1]):this.selectSymbol(this.symbolData[0]));this.own(l(document.body,"click",h.hitch(this,function(z){this.isPartOfPopup(z.target||z.srcElement)||this._hideTooltipDialog()})))},setDefault:function(){this.symbolData&&1<this.symbolData.length&&this.symbolData[1].isDefault?this.selectSymbol(this.symbolData[1]):this.selectSymbol(this.symbolData[0])},
_createSelectedSymbolNode:function(){var z=m.create("div",{},this.domNode);this.selectedSymbolNode=m.create("div",{"class":"esriCTSelectedSymbol"},z)},_createTooltipDialog:function(){var z=this._createSymbolListMenu();this._tooltipDialog=new B({content:z,"class":"esriCTSymbolPopup"});this.own(l(this.domNode,"click",h.hitch(this,function(r){r.stopPropagation();r.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():this._showTooltipDialog()})));this.own(l(this.domNode,"keydown",h.hitch(this,
function(r){if(r.keyCode===k.ENTER||r.keyCode===k.SPACE)this._isTooltipDialogOpened?this._hideTooltipDialog():this._showTooltipDialog()})));this.own(l(document.body,"click",h.hitch(this,function(r){this.isPartOfPopup(r.target||r.srcElement)||this._hideTooltipDialog()})))},_createSymbolListMenu:function(){var z=m.create("div",{"class":"esriCTSymbolListContainer"},null);var r=m.create("div",{"class":"esriCTSymbolListContent",role:"menu"},z);f.forEach(this.symbolData,h.hitch(this,function(t){var A=m.create("div",
{"class":"esriCTSymbolOption",title:t.label,tabindex:"0",role:"menuitem","aria-label":t.label},r);this._attachRowClick(A,t);var N=m.create("div",{"class":"esriCTSymbolIcon"},A);m.create("div",{"class":"esriCTSymbolName",innerHTML:t.label},A);A=m.create("div",{},N);this._createSymbol(t,A)}));return z},_attachRowClick:function(z,r){this.own(l(z,"click",h.hitch(this,function(){this.selectSymbol(r);this.hideOnSelect&&this._hideTooltipDialog()})));this.own(l(z,"keydown",h.hitch(this,function(t){if(t.keyCode===
k.ENTER||t.keyCode===k.SPACE||t.keyCode===k.ESCAPE)this.selectSymbol(r),this.hideOnSelect&&(this._hideTooltipDialog(),M.focus(this.domNode))})))},_createSymbol:function(z,r){z&&(z=e.fromJson(z.symbol),(z=n.createSymbolNode(z))||(z=m.create("div")),m.place(z,r))},selectSymbol:function(z){m.empty(this.selectedSymbolNode);this.selectedSymbol={label:z.label||z.type,type:z.type,symbol:z.symbol};this._createSymbol(this.selectedSymbol,this.selectedSymbolNode);this.onSelect(z)},destroy:function(){v.close(this._tooltipDialog);
this._tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(z){var r=this._tooltipDialog.domNode;return z===r||w.isDescendant(z,r)},onSelect:function(z){return z},_showTooltipDialog:function(){v.open({parent:this.getParent(),popup:this._tooltipDialog,around:this.domNode,"class":"esriCTSymbolPopup"});this._isTooltipDialogOpened=!0;this.focusFirstSymbolOption()},_hideTooltipDialog:function(){v.close(this._tooltipDialog);this._isTooltipDialogOpened=!1},focusFirstSymbolOption:function(){var z=
p(".esriCTSymbolOption",this._tooltipDialog.domNode);M.focus(z[0])}})})},"widgets/ParcelDrafter/MiscloseDetails":function(){define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!./MiscloseDetails.html dojo/_base/lang dojo/Evented dojo/dom-class dojo/dom-attr".split(" "),function(E,d,h,l,m,f,n,e){return E([d,h,f],{baseClass:"jimu-widget-ParcelDrafter-MisclosedDetails",templateString:l,details:null,constructor:function(v){m.mixin(this,v)},postCreate:function(){this.inherited(arguments);
n.add(this.domNode,"esriCTFullWidth");this.config.polygonLayer.statedArea&&this.config.polygonLayer.statedArea.hasOwnProperty("name")&&(n.remove(this.traverseStatedAreaNode,"esriCTHidden"),this.traverseStatedArea.trim=!0,this.config.polygonLayer.statedArea.nullable||(this.traverseStatedArea.required=!0),0<=this.numberFieldTypes.indexOf(this.config.polygonLayer.statedArea.type)&&(this.traverseStatedArea.validator=m.hitch(this,function(v){return!this.config.polygonLayer.statedArea.nullable&&(null===
v||""===v)||""!==v&&!this.validateNumericField(v,this.config.polygonLayer.statedArea.type)?!1:!0})));this._setBackgroundColorForDartTheme()},_setBackgroundColorForDartTheme:function(){"DartTheme"===this.appConfig.theme.name&&n.add(this.traverseDetailsContainer,"esriCTMiscloseHeaderDiv")},getMiscloseDetails:function(){return this.details},updateAccordingToPlanSettings:function(v){e.set(this.miscloseBearingNode,"innerHTML",v.miscloseBearing);e.set(this.miscloseDistanceNode,"innerHTML",v.miscloseDistance);
e.set(this.calculatedAreaNode,"innerHTML",v.calculatedArea)},setMiscloseDetails:function(v){(this.details=v)?(e.set(this.miscloseBearingNode,"innerHTML",v.miscloseBearing),e.set(this.miscloseDistanceNode,"innerHTML",v.miscloseDistance),0!==v.miscloseRatio?(n.remove(this.traverseMiscloseRatioNode,"esriCTHidden"),e.set(this.miscloseRatioNode,"innerHTML",v.miscloseRatio)):n.add(this.traverseMiscloseRatioNode,"esriCTHidden"),v.accuracy?(n.add(this.traverseMiscloseRatioNode,"esriCTHidden"),n.remove(this.traverseAccuracyNode,
"esriCTHidden")):n.add(this.traverseAccuracyNode,"esriCTHidden"),v.calculatedArea?(e.set(this.calculatedAreaNode,"innerHTML",v.calculatedArea),n.remove(this.traverseCalculatedAreaNode,"esriCTHidden")):n.add(this.traverseCalculatedAreaNode,"esriCTHidden"),n.add(this.noMiscloseCalculated,"esriCTHidden"),n.remove(this.miscloseDetailsContainer,"esriCTHidden"),v.adjustPoints?n.remove(this.compassRuleAppliedHint,"esriCTHidden"):n.add(this.compassRuleAppliedHint,"esriCTHidden")):(n.add(this.miscloseDetailsContainer,
"esriCTHidden"),n.remove(this.noMiscloseCalculated,"esriCTHidden"))}})})},"widgets/ParcelDrafter/ParcelTools":function(){define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!./ParcelTools.html dojo/_base/lang dojo/Evented dojo/dom-class dojo/dom-attr dojo/on dojo/keys dijit/form/NumberTextBox".split(" "),function(E,d,h,l,m,f,n,e,v,B){return E([d,h,f],{baseClass:"jimu-widget-ParcelDrafter-ParcelTools",templateString:l,rotationAngle:0,scaledValue:1,constructor:function(w){m.mixin(this,
w)},postCreate:function(){this.inherited(arguments);n.add(this.domNode,"esriCTFullWidth");this.rotationTxt.constraints={min:-360,max:360,places:3};this.scaleTxt.constraints={min:.1,places:3};this.rotationTxt.set("value",this.rotationAngle);this.scaleTxt.set("value",this.scaledValue);this.own(v(this.rotationTxt,"blur",m.hitch(this,function(){this.setRotation(this.rotationTxt.displayedValue)})));this.own(v(this.scaleTxt,"blur",m.hitch(this,function(){this.setScale(this.scaleTxt.displayedValue)})));
this.canProjectLocally?(this.own(v(this.rotateButton,"click",m.hitch(this,function(){this._toggleRotating()}))),this.own(v(this.rotateButton,"keydown",m.hitch(this,function(w){if(w.keyCode===B.ENTER||w.keyCode===B.SPACE)w.preventDefault(),this._toggleRotating()}))),this.own(v(this.scaleButton,"click",m.hitch(this,function(){this._toggleScaling()}))),this.own(v(this.scaleButton,"keydown",m.hitch(this,function(w){if(w.keyCode===B.ENTER||w.keyCode===B.SPACE)w.preventDefault(),this._toggleScaling()})))):
(n.add(this.rotateButton,"esriCTDisabledParcelToolButton"),e.set(this.rotateButton,"tabindex","-1"),n.add(this.scaleButton,"esriCTDisabledParcelToolButton"),e.set(this.scaleButton,"tabindex","-1"));this.own(v(this.rotationTxt,"keypress",m.hitch(this,function(w){(w.charCode||w.keyCode)===B.ENTER&&this.setRotation(this.rotationTxt.displayedValue)})));this.own(v(this.scaleTxt,"keypress",m.hitch(this,function(w){(w.charCode||w.keyCode)===B.ENTER&&this.setScale(this.scaleTxt.displayedValue)})))},setScale:function(w){var k=
this.scaledValue;isNaN(Number(w))||this.scaleTxt.set("value",Number(w));this.scaleTxt.isValid()?this.scaleGeometries():this.scaleTxt.set("value",Number(k))},scaleGeometries:function(){var w=Number(this.scaleTxt.get("value"));isNaN(w)||(this.scaledValue=w,this.emit("scaleGeometries",w))},setRotation:function(w){var k=this.rotationAngle;isNaN(Number(w))||this.rotationTxt.set("value",Number(w));this.rotationTxt.isValid()?this.rotateGeometries():this.rotationTxt.set("value",Number(k))},rotateGeometries:function(){var w=
Number(this.rotationTxt.get("value"));isNaN(w)||(this.rotationAngle=w,this.emit("rotateGeometries",w))},resetTools:function(){this.rotationAngle=0;this.scaledValue=1;this.rotationTxt.set("value",Number(0));this.scaleTxt.set("value",Number(1))},_toggleRotating:function(){n.contains(this.rotateButton.parentElement,"esriCTDisableButton")?(n.remove(this.rotateButton.parentElement,"esriCTDisableButton"),e.set(this.rotateButton,"aria-pressed","true"),this.disableScaling(),this.emit("toggleRotating",!0)):
(this.disableRotating(),this.emit("toggleRotating",!1))},_toggleScaling:function(){n.contains(this.scaleButton.parentElement,"esriCTDisableButton")?(n.remove(this.scaleButton.parentElement,"esriCTDisableButton"),e.set(this.scaleButton,"aria-pressed","true"),this.disableRotating(),this.emit("toggleScaling",!0)):(this.disableScaling(),this.emit("toggleScaling",!1))},disableRotating:function(){n.add(this.rotateButton.parentElement,"esriCTDisableButton");e.set(this.rotateButton,"aria-pressed","false")},
disableScaling:function(){n.add(this.scaleButton.parentElement,"esriCTDisableButton");e.set(this.scaleButton,"aria-pressed","false")}})})},"widgets/ParcelDrafter/PlanInfo":function(){define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!./PlanInfo.html dojo/_base/lang dojo/_base/array dojo/Evented dojo/dom-attr dojo/dom-construct dojo/dom-class dojo/dom-style dojo/query dijit/registry dijit/form/ValidationTextBox dojo/store/Memory dijit/form/ComboBox dojo/on esri/geometry/Polyline esri/graphic esri/tasks/query esri/tasks/QueryTask esri/dijit/AttributeInspector esri/layers/FeatureLayer jimu/dijit/Message ./geometryUtils jimu/utils jimu/LayerInfos/LayerInfos dojo/keys dojo/aspect".split(" "),
function(E,d,h,l,m,f,n,e,v,B,w,k,p,M,z,r,t,A,N,I,P,S,Q,F,U,R,W,K,V){return E([d,h,n],{baseClass:"jimu-widget-ParcelDrafter-PlanInfo",templateString:l,_itemList:null,_polygonLayer:null,parcelNameTextBox:null,planNameTextBox:null,documentTypeControl:null,planSettings:null,_savedPolygonObjectId:null,_savedPolyLines:null,fieldInfosForPolygonLayer:null,constructor:function(y){m.mixin(this,y)},postCreate:function(){this.inherited(arguments);W.getInstance(this.map,this.map.itemInfo).then(m.hitch(this,function(y){this._layerInfosObj=
y;this._init()}))},_init:function(){if(0<this._getFieldInfosForPolygonLayer().length)if(this._addGraphicToLocalLayer(),this.config.polygonLayer.attributeListTitle){var y=R.sanitizeHTML(this.config.polygonLayer.attributeListTitle);e.set(this.attributeListTitle,"innerHTML",y)}else y=this._layerInfosObj.getLayerInfoById(this.config.polygonLayer.id),e.set(this.attributeListTitle,"innerHTML",y.layerObject.name);else B.add(this.expandCollapseParentNode,"esriCTHidden");B.add(this.domNode,"esriCTFullWidth");
this.own(t(this.planInfoCancelButton,"click",m.hitch(this,function(){this.emit("cancelTraversedParcel")})));this.own(t(this.planInfoCancelButton,"keydown",m.hitch(this,function(b){b.keyCode!==K.ENTER&&b.keyCode!==K.SPACE||this.emit("cancelTraversedParcel")})));this.own(t(this.planInfoSaveButton,"click",m.hitch(this,function(){this.emit("saveTraversedParcel")})));this.own(t(this.planInfoSaveButton,"keydown",m.hitch(this,function(b){b.keyCode!==K.ENTER&&b.keyCode!==K.SPACE||this.emit("saveTraversedParcel")})));
this.own(t(this.planInfoDeleteButton,"click",m.hitch(this,this.deleteParcel)));this.own(t(this.planInfoDeleteButton,"keydown",m.hitch(this,function(b){b.keyCode!==K.ENTER&&b.keyCode!==K.SPACE||this.deleteParcel()})));this.own(t(this.expandCollapseNode,"click",m.hitch(this,this._onExpandCollapseClicked)));this.own(t(this.expandCollapseNode,"keydown",m.hitch(this,function(b){if(b.keyCode===K.ENTER||b.keyCode===K.SPACE)b.preventDefault(),this._onExpandCollapseClicked()})))},_onExpandCollapseClicked:function(){B.toggle(this.expandCollapseNode,
"esriCTCollapsedParceLayer");B.toggle(this.attributeListNode,"esriCTHidden");var y=this.nls.planInfo.showAttributeList;B.contains(this.expandCollapseNode,"esriCTCollapsedParceLayer")&&(y=this.nls.planInfo.hideAttributeList);e.set(this.expandCollapseNode,"aria-label",y);e.set(this.expandCollapseNode,"title",y)},resetValues:function(){B.contains(this.expandCollapseNode,"esriCTCollapsedParceLayer")&&this._onExpandCollapseClicked();this._addGraphicToLocalLayer();this.parcelNameTextBox&&this.parcelNameTextBox.set("value",
"");this.planNameTextBox&&this.planNameTextBox.set("value","");this.documentTypeControl&&(this.config.polygonLayer.documentType.domain?this.documentTypeControl.set("item",null):this.documentTypeControl.set("value",""));B.add(this.planInfoDeleteButton,"esriCTHidden")},_showMessage:function(y){this.emit("showMessage",y)},_createDocumentTypeControl:function(){this.config.polygonLayer.documentType.domain?(this.documentTypeControl=this._createFieldSelect(this.config.polygonLayer.documentType,this.documentType,
this.nls.planInfo.parcelDocumentTypeText,!this.config.polygonLayer.documentType.nullable),this.own(t(this.documentTypeControl,"change",m.hitch(this,function(y){""===y||null===y||void 0===y||this.documentTypeControl.store.data.some(function(b){return b.name===y})||(this.documentTypeControl.set("item",null),this._showMessage(this.nls.planInfo.enterValidDocumentTypeMessage))})))):this.documentTypeControl=this._createFieldInputs(this.config.polygonLayer.documentType,this.documentType,this.nls.planInfo.parcelDocumentTypeText,
!this.config.polygonLayer.documentType.nullable)},_createFieldInputs:function(y,b,g,x){y.alias&&(g=y.alias);g=x?g+" "+this.nls.planInfo.requiredText:g+" "+this.nls.planInfo.optionalText;g=new M({placeHolder:g,"class":"esriCTFullWidth",required:x,"aria-label":g});0<=this.numberFieldTypes.indexOf(y.type)&&(g.validator=m.hitch(this,function(G){return""===G||this.validateNumericField(G,y.type)?!0:!1}));g.placeAt(b);return g},_createFieldSelect:function(y,b,g,x){var G=this._createDocTypeDataArr();G=new z({data:G});
y&&y.alias&&(g=y.alias);g=x?g+" "+this.nls.planInfo.requiredText:g+" "+this.nls.planInfo.optionalText;this.selectBox=new r({placeHolder:g,"class":"esriCTFullWidth",required:x,store:G},b);e.set(this.selectBox.domNode,"aria-label",g);e.set(this.selectBox.domNode,"role","combobox");e.set(this.selectBox.domNode,"aria-expanded","false");V.after(this.selectBox,"loadAndOpenDropDown",m.hitch(this,function(){e.set(this.selectBox.domNode,"aria-expanded","true")}));V.after(this.selectBox,"closeDropDown",m.hitch(this,
function(){e.set(this.selectBox.domNode,"aria-expanded","false")}));return this.selectBox},_createDocTypeDataArr:function(){var y=[];this.config.polygonLayer.documentType.domain.codedValues&&f.forEach(this.config.polygonLayer.documentType.domain.codedValues,m.hitch(this,function(b){y.push({name:b.name,id:b.code})}));return y},saveData:function(y){if(y.miscloseDetails&&(0===y.miscloseDetails.LengthConversions.meters||y.appliedCompassRule))this._saveParcel(y);else var b=new F({message:this.nls.planInfo.saveNonClosedParcelConfirmationMessage,
type:"question",buttons:[{label:this.nls.common.yes,onClick:m.hitch(this,function(){b.close();this._saveParcel(y)})},{label:this.nls.common.no}]})},_saveParcel:function(y){this._itemList=y.itemList;this.planSettings=y.planSettings;0===y.polygonDeleteArr.length?this._createPolygonData(y):this._deletePolygonBeforeSaving(y)},_createParcelPolygon:function(){var y,b,g;var x=[];var G=this.parcelLinesGraphicsLayer.graphics;for(y=0;y<this._itemList.length;y++)if(this._itemList[y].LineSymbol.type===this.config.BoundaryLineType)for(b=
0;b<this._itemList[y].graphic.geometry.paths.length;b++)x.push(this._itemList[y].graphic.geometry.paths[b]);0<x.length&&(g=U.getPolygonFromPolyLines(x,!1,!0,G[0].geometry.spatialReference))&&(this.parcelPolygonGraphicsLayer.clear(),y=new N(g),this.parcelPolygonGraphicsLayer.add(y),g=this.parcelPolygonGraphicsLayer.graphics[0].geometry);return g},_createPolygonData:function(y){this.loading.show();var b=[];var g={};var x=this.polygonLayerUnit;this.documentTypeControl&&(this.config.polygonLayer.documentType.domain?
this.documentTypeControl.hasOwnProperty("item")&&this.documentTypeControl.item&&this.documentTypeControl.item.hasOwnProperty("id"):""!==this.documentTypeControl.get("value")&&this.documentTypeControl.get("value"));var G=!1;if(y.miscloseDetails&&(0===y.miscloseDetails.LengthConversions.meters||y.appliedCompassRule))var J=this._createParcelPolygon();else J={},G=!0;J?(G&&(J=null),this._currentFeatureDetails&&this._currentFeatureDetails.attributes&&(g=m.clone(this._currentFeatureDetails.attributes)),
g[this.config.polygonLayer.rotation.name]=y.rotation,g[this.config.polygonLayer.scale.name]=y.scale,y.miscloseDetails&&(g[this.config.polygonLayer.miscloseRatio.name]=y.miscloseDetails.miscloseValue,g[this.config.polygonLayer.miscloseDistance.name]=this._getValueAccToFeatureLayerUnit(x,y.miscloseDetails,"LengthConversions")),this.config.polygonLayer.statedArea.hasOwnProperty("name")&&(g[this.config.polygonLayer.statedArea.name]=y.statedArea),y=new N(J,null,g),b.push(y),this._saveParcelPolygon(b)):
this._showMessage(this.nls.planInfo.unableToCreatePolygonParcel)},setParcelInformation:function(y,b){var g=this.map.getLayer(this.config.polygonLayer.id).objectIdField;this._savedPolygonObjectId=y[0].attributes[g];var x=m.clone(y[0].attributes);x[g]=x[g]?x[g]:0;this._addGraphicToLocalLayer(x);this._savedPolyLines=b;B.remove(this.planInfoDeleteButton,"esriCTHidden");this.parcelNameTextBox&&this.parcelNameTextBox.set("value",y[0].attributes[this.config.polygonLayer.parcelName.name]);this.planNameTextBox&&
this.planNameTextBox.set("value",y[0].attributes[this.config.polygonLayer.planName.name]);this.documentTypeControl&&(y=y[0].attributes[this.config.polygonLayer.documentType.name],null!==y&&""!==y&&void 0!==y&&(this.config.polygonLayer.documentType.domain?this.documentTypeControl.set("item",this.documentTypeControl.store.get(y)):this.documentTypeControl.set("value",y)))},_rollbackSavedPolygon:function(){var y;var b={attributes:{}};if((y=this.map.getLayer(this.config.polygonLayer.id))&&null!==this._savedPolygonObjectId){b.attributes[y.objectIdField]=
this._savedPolygonObjectId;var g=y.applyEdits(null,null,[b])}return g},_rollbackSavedPolyLines:function(y){var b,g;var x=[];var G=this.map.getLayer(this.config.polylineLayer.id);f.forEach(y,m.hitch(this,function(J){b={attributes:{}};J.hasOwnProperty("objectId")?(b.attributes[G.objectIdField]=J.objectId,x.push(b)):J.attributes.hasOwnProperty(G.objectIdField)&&(b.attributes[G.objectIdField]=J.attributes[G.objectIdField],x.push(b))}));G&&0<x.length&&(g=G.applyEdits(null,null,x));return g},_deletePolygonBeforeSaving:function(y){(this._polygonLayer=
this.map.getLayer(this.config.polygonLayer.id))?this._polygonLayer.applyEdits(null,null,y.polygonDeleteArr,m.hitch(this,function(){this._deleteLinesBeforeSaving(y)}),m.hitch(this,function(){this._showMessage(this.nls.planInfo.unableToSavePolygonParcel)})):this._showMessage(this.nls.planInfo.unableToSavePolygonParcel)},_deleteLinesBeforeSaving:function(y){var b;(b=this.map.getLayer(this.config.polylineLayer.id))?b.applyEdits(null,null,y.polylineDeleteArr,m.hitch(this,function(){this._createPolygonData(y)}),
m.hitch(this,function(){this._showMessage(this.nls.planInfo.unableToUpdateParcelLines)})):this._showMessage(this.nls.planInfo.unableToUpdateParcelLines)},_saveParcelPolygon:function(y){(this._polygonLayer=this.map.getLayer(this.config.polygonLayer.id))?(this._savedPolygonObjectId=null,this._polygonLayer.applyEdits(y,null,null,m.hitch(this,function(b){b&&0<b.length&&b[0].success?(this._savedPolygonObjectId=b[0].objectId,this._polygonLayer.refresh(),b=new I,b.objectIds=[this._savedPolygonObjectId],
b.returnGeometry=!1,b.outFields=[this.config.polygonLayer.relatedGUID.name],(new P(this._polygonLayer.url)).execute(b,m.hitch(this,function(g){this.loading.hide();this._createPolylineData(g.features[0].attributes[this.config.polygonLayer.relatedGUID.name])}),m.hitch(this,function(){this.loading.hide();this._showMessage(this.nls.planInfo.unableToSaveParcelLines)}))):(this.loading.hide(),this._showMessage(this.nls.planInfo.unableToSavePolygonParcel))}),m.hitch(this,function(){this.loading.hide();this._showMessage(this.nls.planInfo.unableToSavePolygonParcel)}))):
(this.loading.hide(),this._showMessage(this.nls.planInfo.unableToSavePolygonParcel))},_getValueAccToFeatureLayerUnit:function(y,b,g){if(b.hasOwnProperty(g)&&b[g])switch(y){case "meters":case "degrees":return b[g].meters;case "feet":return b[g].feet;case "uSSurveyFeet":return b[g].uSSurveyFeet;default:return null}else return null},_getCurrentLineFeatures:function(){for(var y=[],b=0;b<this._itemList.length;b++)y.push(this._itemList[b].graphic);return y},_createPolylineData:function(y){this.loading.show();
var b=this._getCurrentLineFeatures();var g=this.polylineLayerUnit;var x=this._itemList;var G=[];for(var J=0;J<b.length;J++){var a={};var c=x[J];a[this.config.polylineLayer.bearing.name]=c.BearingConversions.naDD;a[this.config.polylineLayer.distance.name]=this._getValueAccToFeatureLayerUnit(g,c,"LengthConversions");a[this.config.polylineLayer.lineType.name]=c.LineSymbol.type;a[this.config.polylineLayer.radius.name]=this._getValueAccToFeatureLayerUnit(g,c,"RadiusConversions");null!==a[this.config.polylineLayer.radius.name]&&
""!==a[this.config.polylineLayer.radius.name]&&void 0!==a[this.config.polylineLayer.radius.name]?(a[this.config.polylineLayer.arcLength.name]=this._getValueAccToFeatureLayerUnit(g,c,"ArcLengthConversions"),c=this._getValueAccToFeatureLayerUnit(g,c,"ChordLengthConversions"),a[this.config.polylineLayer.chordLength.name]=c,a[this.config.polylineLayer.distance.name]=c):(a[this.config.polylineLayer.arcLength.name]=null,a[this.config.polylineLayer.chordLength.name]=null);a[this.config.polylineLayer.relatedGUID.name]=
y;a[this.config.polylineLayer.sequenceId.name]=J;c=b[J].geometry.toJson();c=new A(c);a=new N(c,null,a,null);G.push(a)}this._saveParcelLines(G)},_saveParcelLines:function(y){var b;(b=this.map.getLayer(this.config.polylineLayer.id))?b.applyEdits(y,null,null,m.hitch(this,function(g){var x=[],G=[];f.forEach(g,function(J){J.success?G.push(J):x.push(J)});0<x.length?(this._rollbackSavedPolygon(),0<G.length&&x.length!==y.length&&this._rollbackSavedPolyLines(G),this._showMessage(this.nls.planInfo.unableToSaveParcelLines)):
(this._showParcelSavedAndDeleteMsg(this.nls.planInfo.parcelSavedSuccessMessage),this._savedPolygonObjectId=null,this.emit("displayMainPageAfterSave",!1));this.loading.hide()}),m.hitch(this,function(){this._rollbackSavedPolygon();this.loading.hide();this._showMessage(this.nls.planInfo.unableToSaveParcelLines)})):(this._rollbackSavedPolygon(),this.loading.hide(),this._showMessage(this.nls.planInfo.unableToSaveParcelLines))},_validateRequiredFields:function(){var y=[],b=this._currentFeatureDetails;if(!b)return y;
var g=b.getLayer();g=f.filter(g.fields,m.hitch(this,function(x){return!1===x.nullable&&!0===x.editable}));f.forEach(g,m.hitch(this,function(x){if(b.attributes.hasOwnProperty(x.name))if("undefined"===b.attributes[x.name])y.push(x.name);else if(null===b.attributes[x.name])y.push(x.name);else switch(x.type){case "esriFieldTypeString":(""===b.attributes[x.name]||b.attributes[x.name]&&""===b.attributes[x.name].trim())&&y.push(x.name)}else y.push(x.name)}));return y},_validateAttributes:function(){var y=
[],b;y=this._validateRequiredFields();var g=k("td.atiLabel",this._attributeInspector.domNode),x=[];this._clonedProjectPolygonLayerObject.globalIdField&&x.push(this._clonedProjectPolygonLayerObject.globalIdField);this._clonedProjectPolygonLayerObject.objectIdField&&x.push(this._clonedProjectPolygonLayerObject.objectIdField);g&&f.forEach(g,m.hitch(this,function(G){var J=e.get(G,"data-fieldname");-1===x.indexOf(J)&&(J=this._getAttrInspectorRowInfo(G))&&(0>y.indexOf(J[1])?J[0].isValid&&!J[0].isValid()?
(y.push(J[1]),b||(b=J[0])):1<G.parentNode.childNodes[1].childNodes.length&&(G=G.parentNode.childNodes[1].childNodes[1],G=p.getEnclosingWidget(G),G.isValid&&!G.isValid()&&(y.push(J[1]),b||(b=G))):b||(b=J[0]))}));b&&(B.contains(this.expandCollapseNode,"esriCTCollapsedParceLayer")||this._onExpandCollapseClicked(),b.focus());return y},validateParcelDetails:function(y){var b={};if(this._attributeInspector){var g=this._validateAttributes();if(g&&0<g.length)return b.status=!1,b.message="",b}if(this.config.polygonLayer.statedArea&&
this.config.polygonLayer.statedArea.hasOwnProperty("name")&&(!this.config.polygonLayer.statedArea.nullable&&(null===y||""===y)||null!==y&&""!==y&&-1<this.numberFieldTypes.indexOf(this.config.polygonLayer.statedArea.type)&&!this.validateNumericField(y,this.config.polygonLayer.statedArea.type)))return b.status=!1,b.message=this.nls.planInfo.enterValidStatedAreaNameMessage,b;b.status=!0;return b},deleteParcel:function(){this.loading.show();this._rollbackSavedPolygon().then(m.hitch(this,function(){this._rollbackSavedPolyLines(this._savedPolyLines).then(m.hitch(this,
function(){this.loading.hide();this._showParcelSavedAndDeleteMsg(this.nls.planInfo.parcelDeletedSuccessMessage);this._savedPolygonObjectId=null;this.emit("displayMainPageAfterSave",!1)}),m.hitch(this,function(){this.loading.hide();this._savedPolygonObjectId=null;this._showParcelSavedAndDeleteMsg(this.nls.planInfo.parcelDeleteErrorMessage);this.emit("displayMainPageAfterSave",!1)}))}),m.hitch(this,function(){this.loading.hide();this._savedPolygonObjectId=null;this._showParcelSavedAndDeleteMsg(this.nls.planInfo.parcelDeleteErrorMessage);
this.emit("displayMainPageAfterSave",!1)}))},setPlanInfoCancelBtnAsLastNode:function(){R.initLastFocusNode(this.widgetDomNode,this.planInfoCancelButton)},_showParcelSavedAndDeleteMsg:function(y){this.emit("showParcelSavedAndDeleteMsg",y)},mergeFirstToLast:function(){for(var y={},b=arguments.length-1,g;0<=b;b--)for(g in arguments[b])arguments[b].hasOwnProperty(g)&&(y[g]=arguments[b][g]);return y},_getFieldInfosFromLayer:function(y){var b=[];y&&y.layerObject&&f.forEach(y.layerObject.fields,function(g){var x=
R.getDefaultPortalFieldInfo(g);x=this.mergeFirstToLast(x,g);x.format&&x.format.dateFormat&&x.format.dateFormat.toLowerCase()&&0<=x.format.dateFormat.toLowerCase().indexOf("time")&&(x.format.time=!0);x.visible=!0;b.push(x)},this);return b},_createFieldsDetailsObject:function(y){var b={};f.forEach(y,m.hitch(this,function(g){b[g.name]=g.type}));return b},getFieldInfoByFieldName:function(y,b){var g={};f.some(y,function(x){if(x.name===b)return m.mixin(g,x),!0});return g},_getFieldInfosForPolygonLayer:function(){if(this.fieldInfosForPolygonLayer)return this.fieldInfosForPolygonLayer;
var y=[],b=[this.config.polygonLayer.rotation.name,this.config.polygonLayer.scale.name,this.config.polygonLayer.miscloseRatio.name,this.config.polygonLayer.miscloseDistance.name,this.config.polygonLayer.statedArea.name],g=this._layerInfosObj.getLayerInfoById(this.config.polygonLayer.id),x=this._createFieldsDetailsObject(g.layerObject.fields);var G=this._getFieldInfosFromLayer(g);if(this.config.hasOwnProperty("useFieldInfosFromWebmap")&&this.config.useFieldInfosFromWebmap&&g.controlPopupInfo&&g.controlPopupInfo.enablePopup&&
g.controlPopupInfo.infoTemplate)G=m.clone(g.controlPopupInfo.infoTemplate.info.fieldInfos);else if(this.config.polygonLayer.hasOwnProperty("additionalFieldsInfo")&&0<this.config.polygonLayer.additionalFieldsInfo.length){var J=[];f.forEach(this.config.polygonLayer.additionalFieldsInfo,function(c){var q=this.getFieldInfoByFieldName(G,c.fieldName);q=m.mixin(q,c);!q.nullable&&q.editable&&(q.visible=!0,q.isEditable=!0);J.push(q)},this);G=J}else this.config.polygonLayer.documentType.hasOwnProperty("name")&&
y.push(this.config.polygonLayer.documentType.name),this.config.polygonLayer.parcelName.hasOwnProperty("name")&&y.push(this.config.polygonLayer.parcelName.name),this.config.polygonLayer.planName.hasOwnProperty("name")&&y.push(this.config.polygonLayer.planName.name);var a=[];f.forEach(G,m.hitch(this,function(c){y&&0<y.length&&0>y.indexOf(c.fieldName)&&(c.visible=!1);-1<b.indexOf(c.fieldName)&&(c.visible=!1);c.visible&&x[c.fieldName]&&"esriFieldTypeRaster"!==x[c.fieldName]&&"esriFieldTypeBlob"!==x[c.fieldName]&&
"esriFieldTypeXML"!==x[c.fieldName]&&(c.format&&c.format.dateFormat&&c.format.dateFormat.toLowerCase()&&0<=c.format.dateFormat.toLowerCase().indexOf("time")&&(c.format.time=!0),a.push(c))}));return this.fieldInfosForPolygonLayer=a},_clearAttributeInspectorData:function(){this._attributeInspector&&(this._attributeInspector.layerInfos&&f.forEach(this._attributeInspector.layerInfos,function(y){y=y.featureLayer;y.clearSelection();y.refresh()}),this._attributeInspector.destroy())},_add508SupportToATI:function(){var y;
this._attributeInspector&&this._attributeInspector.domNode&&(y=k("td.atiLabel",this._attributeInspector.domNode))&&f.forEach(y,m.hitch(this,function(b){var g=this._getAttrInspectorRowInfo(b);g&&(g[0].set("aria-label",g[1]),1<b.parentNode.childNodes[1].childNodes.length&&(b=b.parentNode.childNodes[1].childNodes[1],b=p.getEnclosingWidget(b),b.set("aria-label",g[1])))}))},_getAttrInspectorRowInfo:function(y){try{if(y&&y.parentNode){var b=y.parentNode.childNodes[1].childNodes[0];return[p.getEnclosingWidget(b),
y.childNodes[0].data,b]}return null}catch(g){return console.log(g),null}},_getCurrentFieldDijit:function(y){var b;f.some(this._attributeInspector._currentLInfo.fieldInfos,m.hitch(this,function(g){if(g.name===y||g.field&&g.field.name===y||g.fieldName===y)return b=g.dijit,!0}));return b},_addGraphicToLocalLayer:function(y){var b,g,x,G;if((G=this._getFieldInfosForPolygonLayer())&&0!=G.length){this._clearAttributeInspectorData();this._removeClonedProjectPolygonLayer();var J=this.map.getLayer(this.config.polygonLayer.id);
this._clonedProjectPolygonLayerObject=this._cloneProjectPolygonLayer(J,G);var a=this.own(t(this._clonedProjectPolygonLayerObject,"load",m.hitch(this,function(){a&&a[0]&&a[0].remove();b=this._layerInfosObj.getLayerInfoById(this._clonedProjectPolygonLayerObject.originalLayerId);b.featureLayer=this._clonedProjectPolygonLayerObject;this._createAttributeInspector(G);g=new N(null,null,y?y:{},null);g.preEditAttrs=JSON.parse(JSON.stringify(g.attributes));this._clonedProjectPolygonLayerObject.applyEdits([g],
null,null,m.hitch(this,function(c){x=new I;x.objectIds=[c[0].objectId];this._clonedProjectPolygonLayerObject.selectFeatures(x,Q.SELECTION_NEW,m.hitch(this,function(){var q=this._attributeInspector.attributeTable.childNodes[0];e.set(q,"cellspacing","5");e.set(q,"cellpadding","5");this._currentFeatureDetails=g;this._add508SupportToATI();this._attributeInspector.attachmentEditor&&w.set(this._attributeInspector.attachmentEditor,"display","none");this._attributeInspector.editorTrackingInfoDiv&&w.set(this._attributeInspector.editorTrackingInfoDiv,
"display","none");if(q=this._clonedProjectPolygonLayerObject.objectIdField){var u=this._getCurrentFieldDijit(q);u&&g.preEditAttrs[q]&&u.set("value",g.preEditAttrs[q])}}),m.hitch(this,function(){}))}),m.hitch(this,function(){}))}),m.hitch(this,function(){})))}},_removeClonedProjectPolygonLayer:function(){this._clonedProjectPolygonLayerObject&&null!==this._clonedProjectPolygonLayerObject&&(this._clonedProjectPolygonLayerObject.clearSelection(),this._clonedProjectPolygonLayerObject.clear(),this.map.removeLayer(this._clonedProjectPolygonLayerObject),
this._clonedProjectPolygonLayerObject=null)},_filterFields:function(y,b){var g=[];f.forEach(b,m.hitch(this,function(x){x.visible&&f.forEach(y.fields,m.hitch(this,function(G){G.hasOwnProperty("name")&&x.hasOwnProperty("fieldName")&&G.name===x.fieldName&&g.push(G)}))}));y.fields=g},_cloneProjectPolygonLayer:function(y,b){var g=R.getFeatureLayerDefinition(y);this._filterFields(g,b);g.id="clonedPolygonLayer"+this.id;g.name=y.name+this.id;b={layerDefinition:g};g=y.fields.map(function(x){return x.name});
b=new Q(b,{outFields:g});b.visible=!0;b.renderer=y.renderer;b.originalLayerId=y.id;b._wabProperties={isTemporaryLayer:!0};this.map.addLayer(b);return b},_processLayerFields:function(y){f.forEach(y,function(b){void 0!==b.domain&&null!==b.domain&&void 0!==b.domain.type&&null!==b.domain.type&&"range"===b.domain.type&&!1===b.domain.hasOwnProperty("range")&&(b.domain.range=[b.domain.minValue,b.domain.maxValue])});return y},_createAttributeInspector:function(y){v.empty(this.attributeInspectorContainer);
this._attributeInspector=new (E([S],{constructor:function(){this._aiConnects=[];this._selection=[];this._toolTips=[]}}))({layerInfos:[{featureLayer:this._clonedProjectPolygonLayerObject,fieldInfos:y}]},v.create("div",{"class":"esriCTAttributeInspectorWidgetContainer"}));this.own(t(this._attributeInspector,"attribute-change",m.hitch(this,function(b){this._currentFeatureDetails&&(this._currentFeatureDetails.attributes[b.fieldName]=b.fieldValue)})));this._attributeInspector.startup();this.attributeInspectorContainer.appendChild(this._attributeInspector.domNode)}})})},
"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(E,d,h,l,m,f,n,e,v,B,w,k,p,M,z,r,t,A,N,I,P,S,Q,F,U,R,W,K,V,y,b,g,x,G,J,a,c,q,u,H,O){var X=E([Q,A,N],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:O,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,_currentFeature:null,
_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",red:"atiRequiredField"},
constructor:function(C,D){d.mixin(this,z.widgets.attributeInspector);C=C||{};C.featureLayer||C.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(C);this._layerInfos=C.layerInfos||[{featureLayer:C.featureLayer,options:C.options||[]}];this._layerInfos=h.filter(this._layerInfos,function(L){return!L.disableAttributeUpdate});this._hideNavButtons=C.hideNavButtons||!1},postCreate:function(){if(h.every(this._layerInfos,
function(D){return D.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var C=this._layerInfos.length;h.forEach(this._layerInfos,function(D){D=D.featureLayer;if(D.loaded)C--;else var L=l.connect(D,"onLoad",this,function(T){l.disconnect(L);L=null;C--;C||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();h.forEach(this._aiConnects,l.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(C,D){D&&(this._createOnlyFirstTime=!0);
this._updateSelection([C],D);this._updateUI()},onLayerSelectionChange:function(C,D,L){this._createOnlyFirstTime=!1;this._featureIdx=L===M.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(C,D,L,T){},onLayerError:function(C,D,L,T){},onLayerEditsError:function(C,
D,L,T){},onLayerEditsComplete:function(C,D,L,T){T=T||[];if(T.length){var Y=this._selection,ba=C.featureLayer.objectIdField;h.forEach(T,d.hitch(this,function(ca){h.some(Y,d.hitch(this,function(aa,da){if(aa.attributes[ba]!==ca.objectId)return!1;this._selection.splice(da,1);return!0}))}))}D=D||[];D.length&&(this._selection=U.findFeatures(D,C.featureLayer),this._featureIdx=0);T=this._numFeatures=(this._selection=U.sortFeaturesById(this._layerInfos,this._selection))?this._selection.length:0;if(D.length){if(D=
T?this._selection[this._featureIdx]:null)T=D.getLayer().getEditCapabilities(),T.canCreate&&!T.canUpdate||this._showFeature(D);this._updateUI()}L=L||[];if(L.length){var Z=this._rollbackInfo;h.forEach(L,function(ca){var aa=U.findFeatures(L,C.featureLayer)[0];if(!ca.success&&aa.attributes[C.featureLayer.objectIdField]===ca.objectId&&Z){var da=Z.field;ca=Z.graphic.attributes[da.name];var ea=h.filter(this._currentLInfo.fieldInfos,function(fa){return fa.fieldName===da.name},this)[0].dijit;aa.attributes[da.name]=
ca;"esriFieldTypeDate"===da.type&&(ca=new Date(ca));this._setValue(ea,ca)}},this)}this._rollbackInfo=null},onFieldValueChange:function(C,D){var L=C.field,T=C.dijit,Y=this._currentFeature,ba=this._currentLInfo,Z=L.name;C=this._isFieldRequired(L,C);if(""===T.displayedValue||"dijit.form.ValidationTextBox"!==T.declaredClass||T.isValid())if(""!==T.displayedValue&&T.displayedValue!==D&&T.isValid&&!T.isValid())this._setValue(T,Y.attributes[L.name]);else{var ca=!("esriFieldTypeInteger"!==L.type&&"esriFieldTypeSmallInteger"!==
L.type&&"esriFieldTypeSingle"!==L.type&&"esriFieldTypeDouble"!==L.type);if(C&&(null===D||""===D||"undefined"===typeof D||ca&&isNaN(D))){Z=Y.attributes[L.name];if("esriFieldTypeDate"===L.type&&(Z=new Date(Z),T instanceof Array)){this._setValue(T[0],Z);this._setValue(T[1],Z);return}this._setValue(T,Z)}else{if(ca){if(isNaN(D)||""===D)D=null;ca&&null!==D&&(D=Number(D))}"esriFieldTypeDate"===L.type&&(T instanceof Array?(D=T[0].getValue(),T=T[1].getValue(),D=D&&T?new Date(D.getFullYear(),D.getMonth(),D.getDate(),
T.getHours(),T.getMinutes(),T.getSeconds(),T.getMilliseconds()):D||T||null):(D=T.getValue(),L.domain&&(D=Number(D))),D=D&&D.getTime?D.getTime():D&&D.toGregorian?D.toGregorian().getTime():D);if(this._currentFeature.attributes[L.name]!==D){if(Z===ba.typeIdField){var aa=this._findFirst(ba.types,"id",D);h.forEach(ba.fieldInfos,function(da){(L=da.field)&&L.name!==ba.typeIdField&&(da=da.dijit,this._setFieldDomain(da,aa,L)&&da&&(this._setValue(da,Y.attributes[L.name]+""),!1===da.isValid()&&this._setValue(da,
null)))},this)}this.onAttributeChange(Y,Z,D)}}}else this._setValue(T,Y.attributes[L.name])},onDeleteBtn:function(C){this._deleteFeature()},onNextFeature:function(C){this._onNextFeature(1)},onPreviousFeature:function(C){this._onNextFeature(-1)},onFirstFeature:function(C){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(C){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var C=this._layerInfos;this._editorTrackingInfos={};h.forEach(C,this._initLayerInfo,
this)},_initLayerInfo:function(C){var D=C.featureLayer,L;this._userIds={};var T=D.id;D.credential&&(this._userIds[T]=D.credential.userId);C.userId&&(this._userIds[T]=C.userId);this._connect(D,"onSelectionComplete",d.hitch(this,"onLayerSelectionChange",C));this._connect(D,"onSelectionClear",d.hitch(this,"onLayerSelectionClear",C));this._connect(D,"onEditsComplete",d.hitch(this,"onLayerEditsComplete",C));this._connect(D,"error",d.hitch(this,"onLayerError",C));this._connect(D,"onUpdateEnd",d.hitch(this,
"onLayerUpdateEnd",C));C.showAttachments=D.hasAttachments?w.isDefined(C.showAttachments)?C.showAttachments:!0:!1;C.hideFields=C.hideFields||[];C.htmlFields=C.htmlFields||[];C.isEditable=D.isEditable()?w.isDefined(C.isEditable)?C.isEditable:!0:!1;C.typeIdField=D.typeIdField;C.layerId=D.id;C.types=D.types;D.globalIdField&&((L=this._findFirst(C.fieldInfos,"fieldName",D.globalIdField))||C.showGlobalID||C.hideFields.push(D.globalIdField));(T=this._findFirst(C.fieldInfos,"fieldName",D.objectIdField))||
C.showObjectID||C.hideFields.push(D.objectIdField);var Y=this._getFields(C.featureLayer);if(Y){var ba=C.fieldInfos||[];ba=h.map(ba,function(Z){return d.mixin({},Z)});ba.length?C.fieldInfos=h.filter(h.map(ba,d.hitch(this,function(Z){var ca=Z.stringFieldOption||(this._isInFields(Z.fieldName,C.htmlFields)?X.STRING_FIELD_OPTION_RICHTEXT:X.STRING_FIELD_OPTION_TEXTBOX);return d.mixin(Z,{field:this._findFirst(Y,"name",Z.fieldName),stringFieldOption:ca})})),"return item.field;"):(Y=h.filter(Y,d.hitch(this,
function(Z){return!this._isInFields(Z.name,C.hideFields)})),C.fieldInfos=h.map(Y,d.hitch(this,function(Z){var ca=this._isInFields(Z.name,C.htmlFields)?X.STRING_FIELD_OPTION_RICHTEXT:X.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:Z.name,field:Z,stringFieldOption:ca}})));C.showGlobalID&&!L&&ba.push(this._findFirst(Y,"name",D.globalIdField));C.showObjectID&&!T&&ba.push(this._findFirst(Y,"name",D.objectIdField));L=[];D.editFieldsInfo&&(D.editFieldsInfo.creatorField&&L.push(D.editFieldsInfo.creatorField),
D.editFieldsInfo.creationDateField&&L.push(D.editFieldsInfo.creationDateField),D.editFieldsInfo.editorField&&L.push(D.editFieldsInfo.editorField),D.editFieldsInfo.editDateField&&L.push(D.editFieldsInfo.editDateField));this._editorTrackingInfos[D.id]=L}},_createAttachmentEditor:function(){this._attachmentEditor=null;var C=h.filter(this._layerInfos,function(D){return D.showAttachments});C&&C.length&&(this._attachmentEditor=new F({"class":this.css.attachmentEditor},this.attachmentEditor),this._attachmentEditor.startup())},
_setCurrentLInfo:function(C){var D=this._currentLInfo?this._currentLInfo.featureLayer:null,L=C.featureLayer;if(D&&D.id===L.id&&!D.ownershipBasedAccessControlForFeatures&&(D=L.getEditCapabilities(),!D.canCreate||D.canUpdate))return;this._currentLInfo=C;this._createTable()},_updateSelection:function(C,D){this._selection=C||[];h.forEach(this._layerInfos,this._getSelection,this);this._selection=U.sortFeaturesById(this._layerInfos,this._selection);this._numFeatures=this._selection.length;this._showFeature(this._numFeatures?
this._selection[this._featureIdx]:null,D)},_getSelection:function(C){C=C.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(C)},_updateUI:function(){var C=this._numFeatures,D=this._currentLInfo;this.layerName.innerHTML=D&&0!==C?D.featureLayer?D.featureLayer.name:"":this.NLS_noFeaturesSelected;e.set(this.attributeTable,"display",C?"":"none");e.set(this.editButtons,"display",C?"":"none");e.set(this.navButtons,"display",!this._hideNavButtons&&1<C?"":"none");this.navMessage.innerHTML=
w.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&e.set(this._attachmentEditor.domNode,"display",D&&D.showAttachments&&C?"":"none");e.set(this.deleteBtn.domNode,"display",D&&!1===D.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(C){this._featureIdx+=C;0>this._featureIdx?this._featureIdx=this._numFeatures-
1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);C=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(C);this._updateUI();this.onNext(C)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(C,D){if(C){this._currentFeature=C;D=D?D:C.getLayer();var L=D.getEditCapabilities({feature:C,userId:this._userIds[D.id]});this._canUpdate=L.canUpdate;this._canDelete=L.canDelete;if(L=this._getLInfoFromFeatureLayer(D)){this._setCurrentLInfo(L);
var T=C.attributes,Y=this._findFirst(L.types,"id",T[L.typeIdField]),ba=null;h.forEach(L.fieldInfos,function(Z){ba=Z.field;var ca=[];Z.dijit&&1<Z.dijit.length?h.forEach(Z.dijit,function(aa){ca.push(aa)}):ca.push(Z.dijit);h.forEach(ca,d.hitch(this,function(aa){if(aa){var da=this._setFieldDomain(aa,Y,ba),ea=T[ba.name];ea=ea&&da&&da.codedValues&&da.codedValues.length?da.codedValues[ea]?da.codedValues[ea].name:ea:ea;w.isDefined(ea)||(ea="");"dijit.form.DateTextBox"===aa.declaredClass||"dijit.form.TimeTextBox"===
aa.declaredClass?ea=""===ea?null:new Date(ea):"dijit.form.FilteringSelect"===aa.declaredClass&&(aa._lastValueReported=null,ea=T[ba.name]+"");try{this._setValue(aa,ea),"dijit.form.FilteringSelect"===aa.declaredClass&&!1===aa.isValid()&&this._setValue(aa,null)}catch(fa){aa.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&L.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,D);(C=D.getEditSummary(C))?(this.editorTrackingInfoDiv.innerHTML=C,
k.show(this.editorTrackingInfoDiv)):k.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(C,D,L){if(!C)return null;var T=L.domain;D&&D.domains&&D.domains[L.name]&&!1===D.domains[L.name]instanceof p&&(T=D.domains[L.name]);if(!T)return null;T.codedValues&&0<T.codedValues.length?(C.set("store",this._toStore(h.map(T.codedValues,function(Y){return{id:Y.code+"",name:Y.name}}))),this._setValue(C,T.codedValues[0].code+"")):(C.constraints={min:w.isDefined(T.minValue)?T.minValue:Number.MIN_VALUE,max:w.isDefined(T.maxValue)?
T.maxValue:Number.MAX_VALUE},this._setValue(C,C.constraints.min));return T},_setValue:function(C,D){C.set&&(C._onChangeActive=!1,C.set("value",D,!0),C._onChangeActive=!0)},_getFields:function(C){var D=C._getOutFields();if(!D)return null;C=C.fields;return"*"==D?C:h.filter(h.map(D,d.hitch(this,"_findFirst",C,"name")),w.isDefined)},_isInFields:function(C,D){return C&&(D||D.length)?h.some(D,function(L){return L.toLowerCase()===C.toLowerCase()}):!1},_isFieldNullable:function(C,D){return!(!1===C.nullable||
D.field&&!1===D.field.nullable)},_isFieldRequired:function(C,D){return!1!==C.editable&&!1!==D.isEditable&&!this._isFieldNullable(C,D)},_findFirst:function(C,D,L){return(C=h.filter(C,function(T){return T.hasOwnProperty(D)&&T[D]===L}))&&C.length?C[0]:null},_getLInfoFromFeatureLayer:function(C){return this._findFirst(this._layerInfos,"layerId",C?C.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML="";this._attributes=v.create("table",{cellspacing:"0",cellpadding:"0"},
this.attributeTable);var C=v.create("tbody",null,this._attributes),D=this._currentLInfo,L=this._findFirst(D.types,"id",this._currentFeature.attributes[D.typeIdField]);h.forEach(D.fieldInfos,d.hitch(this,"_createField",L,C),this);this._createOnlyFirstTime=!1},_createField:function(C,D,L){var T=this._currentLInfo,Y=L.field;if(!this._isInFields(Y.name,T.hideFields)&&!this._isInFields(Y.name,this._editorTrackingInfos[T.featureLayer.id])){var ba=!1,Z;D=v.create("tr",null,D);var ca=v.create("td",{innerHTML:L.label||
Y.alias||Y.name,"class":this.css.label,"data-fieldname":Y.name},D);this._isFieldRequired(Y,L)&&v.create("span",{"class":this.css.red,innerHTML:" *"},ca);D=v.create("td",null,D);if(L.customField){v.place(L.customField.domNode||L.customField,v.create("div",null,D),"first");var aa=L.customField}else if(!1===T.isEditable||!1===Y.editable||!1===L.isEditable||"esriFieldTypeOID"===Y.type||"esriFieldTypeGlobalID"===Y.type||!this._canUpdate&&!this._createOnlyFirstTime)ba=!0;T=T.typeIdField&&Y.name.toLowerCase()==
T.typeIdField.toLowerCase();ca=!!this._getDomainForField(Y,C);!aa&&T?aa=this._createTypeField(Y,L,D):!aa&&ca&&(aa=this._createDomainField(Y,L,C,D));if(!aa)switch(Y.type){case "esriFieldTypeString":aa=this._createStringField(Y,L,D);break;case "esriFieldTypeDate":aa=this._createDateField(Y,L,D);L.format&&L.format.time&&(Z=this._createTimeField(Y,L,D));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":aa=this._createIntField(Y,L,D);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":aa=
this._createFltField(Y,L,D);break;default:aa=this._createStringField(Y,L,D)}L.tooltip&&L.tooltip.length&&this._toolTips.push(new a({connectId:[aa.id],label:L.tooltip}));aa.onChange=d.hitch(this,"onFieldValueChange",L);aa.set("disabled",ba);Z?(L.dijit=[aa,Z],Z.onChange=d.hitch(this,"onFieldValueChange",L),Z.set("disabled",ba)):L.dijit=aa}},_createTypeField:function(C,D,L){L=v.create("div",null,L);var T=C.domain;return T&&"range"===T.type&&T.minValue===T.maxValue?new G({"class":this.css.field,trim:!0,
maxLength:C.length,name:C.alias||C.name,required:this._isFieldRequired(C,D)},L):new y({"class":this.css.field,name:C.alias||C.name,required:this._isFieldRequired(C,D),store:this._toStore(h.map(this._currentLInfo.types,function(Y){return{id:Y.id,name:Y.name}})),searchAttr:"name"},L)},_getDomainForField:function(C,D){var L=C.domain;(C=C.name)&&D&&D.domains&&D.domains[C]&&!1===D.domains[C]instanceof p&&(L=D.domains[C]);return L||null},_createDomainField:function(C,D,L,T){L=this._getDomainForField(C,
L);T=v.create("div",null,T);return L.codedValues?new y({"class":this.css.field,name:C.alias||C.name,searchAttr:"name",required:this._isFieldRequired(C,D)},T):new b({"class":this.css.field},T)},_createStringField:function(C,D,L){L=v.create("div",null,L);var T={trim:!0,maxLength:C.length,required:this._isFieldRequired(C,D)};if(D.stringFieldOption===X.STRING_FIELD_OPTION_TEXTAREA)return T["class"]=this.css.field+" "+this.css.textArea,new x(T,L);if(D.stringFieldOption===X.STRING_FIELD_OPTION_RICHTEXT)return T["class"]=
this.css.field+" "+this.css.richText,T.height="100%",T.width="100%",T.plugins=D.richTextPlugins||this._defaultRichTextPlugins,L=new I(T,L),L.startup(),L;var Y=this;T.validator=function(ba,Z){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return Y._isFieldNullable(C,D)||!(""===ba||null===ba)};return new G(T,L)},_createTimeField:function(C,D,L){L=v.create("div",null,L);C={"class":this.css.field,trim:!0,required:this._isFieldRequired(C,D),constraints:{formatLength:"medium"}};this._datePackage&&
(C.datePackage=this._datePackage);return new J(C,L)},_createDateField:function(C,D,L){L=v.create("div",null,L);C={"class":this.css.field,trim:!0,required:this._isFieldRequired(C,D)};this._datePackage&&(C.datePackage=this._datePackage);return new W(C,L)},_createIntField:function(C,D,L){L=v.create("div",null,L);return new V({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===C.type?{min:-32768,max:32767,places:0}:{places:0},trim:!0,invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(C,
D)},L)},_createFltField:function(C,D,L){L=v.create("div",null,L);return new V({"class":this.css.field,constraints:{max:Infinity,min:-Infinity,places:"0,20"},trim:!0,invalidMessage:this.NLS_validationFlt,required:this._isFieldRequired(C,D)},L)},_toStore:function(C){return new c({data:{identifier:"id",label:"name",items:C}})},_connect:function(C,D,L){this._aiConnects.push(l.connect(C,D,L))},_getDatePackage:function(C){return null===C.datePackage?null:C.datePackage?C.datePackage:"ar"===f.locale?"dojox.date.islamic":
null},_destroyAttributeTable:function(){h.forEach(this._layerInfos,function(C){h.forEach(C.fieldInfos,function(D){var L=D.dijit;if(L){L._onChangeHandle=null;if(D.customField)return;L instanceof Array?h.forEach(L,d.hitch(this,function(T){T.destroyRecursive?T.destroyRecursive():T.destroy&&T.destroy();T._onChangeHandle=null})):L.destroyRecursive?L.destroyRecursive():L.destroy&&L.destroy()}D.dijit=null},this)},this);h.forEach(this._toolTips,function(C){C.destroy()});this._toolTips=[];this._attributes&&
v.destroy(this._attributes)}});d.mixin(X,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});n("extend-esri")&&d.setObject("dijit.AttributeInspector",X,B);return X})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(E,d,h,l,m,f,n,e,v,B,w,k,p,M,z,r,t,A,N,I,P,S,Q,F,U){function R(K){return new I({command:K.name})}function W(K){return new I({buttonClass:N,command:K.name})}h=h("dijit.Editor",F,{plugins:null,extraPlugins:null,constructor:function(){w.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",P]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(k("ie")||k("trident")||k("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new l;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);w.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=m.getLocalization("dijit._editor",
"commands",this.lang);k("webkit")&&v.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new r({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));d.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);n.add(this.iframe.parentNode,"dijitEditorIFrameContainer");n.add(this.iframe,"dijitEditorIFrame");f.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){d.forEach(this._plugins,function(K){K&&K.destroy&&K.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(K,V){var y=w.isString(K)?{name:K}:w.isFunction(K)?{ctor:K}:K;if(!y.setEditor){var b={args:y,plugin:null,editor:this};y.name&&(I.registry[y.name]?b.plugin=I.registry[y.name](y):M.publish(U._scopeName+".Editor.getPlugin",b));if(!b.plugin)try{var g=
y.ctor||w.getObject(y.name)||E(y.name);g&&(b.plugin=new g(y))}catch(x){throw Error(this.id+": cannot find plugin ["+y.name+"]");}if(!b.plugin)throw Error(this.id+": cannot find plugin ["+y.name+"]");K=b.plugin}1<arguments.length?this._plugins[V]=K:this._plugins.push(K);K.setEditor(this);w.isFunction(K.setToolbar)&&K.setToolbar(this.toolbar)},resize:function(K){K&&A.prototype.resize.apply(this,arguments)},layout:function(){var K=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+e.getPadBorderExtents(this.iframe.parentNode).h+
e.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=K+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(K){var V,y=this.document.body,b=y.clientWidth,g=y.clientHeight,x=y.clientLeft,G=y.offsetWidth,J=y.offsetHeight,a=y.offsetLeft;/^rtl$/i.test(y.dir||"")?b<G&&K.x>b&&K.x<G&&(V=!0):K.x<x&&K.x>a&&(V=!0);V||g<J&&K.y>g&&K.y<J&&(V=!0);V||(delete this._cursorToStart,delete this._savedSelection,"BODY"==K.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(K){this.customUndo&&this.endEditing(!0);"BODY"!=K.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(K){this._inEditing||(this._inEditing=!0,this._beginEditing(K));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(K){if(!this.customUndo||
"undo"!=K&&"redo"!=K){this.customUndo&&(this.endEditing(),this._beginEditing());var V=this.inherited(arguments);this.customUndo&&this._endEditing();return V}return this[K]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(K){try{var V=this.document.execCommand(K,!1,null);if(k("webkit")&&!V)throw{};}catch(y){V=p.substitute,alert(V(this.commands.systemShortcut,
[this.commands[K],V(this.commands[k("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[K]])])),V=!1}return V},queryCommandEnabled:function(K){return!this.customUndo||"undo"!=K&&"redo"!=K?this.inherited(arguments):"undo"==K?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(K){var V=K.mark,y=K.mark;K=K.isCollapsed;var b;if(y)if(9>k("ie")||9===k("ie")&&k("quirks"))if(w.isArray(y))V=[],d.forEach(y,function(G){V.push(Q.getNode(G,this.editNode))},this),this.selection.moveToBookmark({mark:V,
isCollapsed:K});else{if(y.startContainer&&y.endContainer&&(b=Q.getSelection(this.window))&&b.removeAllRanges){b.removeAllRanges();K=Q.create(this.window);var g=Q.getNode(y.startContainer,this.editNode);var x=Q.getNode(y.endContainer,this.editNode);g&&x&&(K.setStart(g,y.startOffset),K.setEnd(x,y.endOffset),b.addRange(K))}}else(b=Q.getSelection(this.window))&&b.removeAllRanges&&(b.removeAllRanges(),K=Q.create(this.window),g=Q.getNode(y.startContainer,this.editNode),x=Q.getNode(y.endContainer,this.editNode),
g&&x&&(K.setStart(g,y.startOffset),K.setEnd(x,y.endOffset),b.addRange(K)))},_changeToStep:function(K,V){this.setValue(V.text);(K=V.bookmark)&&this._moveToBookmark(K)},undo:function(){var K=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var V=this._steps.pop();V&&0<this._steps.length&&(this.focus(),this._changeToStep(V,this._steps[this._steps.length-1]),this._undoedSteps.push(V),this.onDisplayChanged(),delete this._undoRedoActive,K=!0);delete this._undoRedoActive}return K},
redo:function(){var K=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var V=this._undoedSteps.pop();V&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],V),this._steps.push(V),this.onDisplayChanged(),K=!0);delete this._undoRedoActive}return K},endEditing:function(K){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(K),this._inEditing=!1)},_getBookmark:function(){var K=this.selection.getBookmark(),
V=[];if(K&&K.mark){var y=K.mark;if(9>k("ie")||9===k("ie")&&k("quirks")){var b=Q.getSelection(this.window);if(w.isArray(y))d.forEach(K.mark,function(x){V.push(Q.getIndex(x,this.editNode).o)},this),K.mark=V;else if(b){var g;b.rangeCount&&(g=b.getRangeAt(0));K.mark=g?g.cloneRange():this.selection.getBookmark()}}try{K.mark&&K.mark.startContainer&&(V=Q.getIndex(K.mark.startContainer,this.editNode).o,K.mark={startContainer:V,startOffset:K.mark.startOffset,endContainer:K.mark.endContainer===K.mark.startContainer?
V:Q.getIndex(K.mark.endContainer,this.editNode).o,endOffset:K.mark.endOffset})}catch(x){K.mark=null}}return K},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:S.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var K=S.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:K,bookmark:this._getBookmark()})},onKeyDown:function(K){k("ie")||this.iframe||K.keyCode!=B.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var V=
K.keyCode;if(K.ctrlKey&&!K.shiftKey&&!K.altKey){if(90==V||122==V){K.stopPropagation();K.preventDefault();this.undo();return}if(89==V||121==V){K.stopPropagation();K.preventDefault();this.redo();return}}this.inherited(arguments);switch(V){case B.ENTER:case B.BACKSPACE:case B.DELETE:this.beginEditing();break;case 88:case 86:if(K.ctrlKey&&!K.altKey&&!K.metaKey){this.endEditing();88==K.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!K.ctrlKey&&!K.altKey&&
!K.metaKey&&(K.keyCode<B.F1||K.keyCode>B.F15)){this.beginEditing();break}case B.ALT:this.endEditing();break;case B.UP_ARROW:case B.DOWN_ARROW:case B.LEFT_ARROW:case B.RIGHT_ARROW:case B.HOME:case B.END:case B.PAGE_UP:case B.PAGE_DOWN:this.endEditing(!0);case B.CTRL:case B.SHIFT:case B.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(K){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(K){this.customUndo?this.isClosed?this.setValue(K):(this.beginEditing(),K||(K="\x26#160;"),this.setValue(K),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(K){this.setValueDeferred.then(w.hitch(this,function(){!this.disabled&&K||!this._buttonEnabledPlugins&&K?
d.forEach(this._plugins,function(V){V.set("disabled",!0)}):this.disabled&&!K&&d.forEach(this._plugins,function(V){V.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&(v.set(this.document.body,"color",v.get(this.iframe,"color")),v.set(this.document.body,"background-color",v.get(this.iframe,"background-color")))}catch(K){}}});w.mixin(I.registry,{undo:R,redo:R,cut:R,copy:R,paste:R,insertOrderedList:R,insertUnorderedList:R,
indent:R,outdent:R,justifyCenter:R,justifyFull:R,justifyLeft:R,justifyRight:R,"delete":R,selectAll:R,removeFormat:R,unlink:R,insertHorizontalRule:R,bold:W,italic:W,underline:W,strikethrough:W,subscript:W,superscript:W,"|":function(){return new I({setEditor:function(K){this.editor=K;this.button=new t({ownerDocument:K.ownerDocument})}})}});return h})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(E,d,h,l,m,f,n,e){h("dijit-legacy-requires")&&m(0,function(){E(["dijit/ToolbarSeparator"])});return d("dijit.Toolbar",[f,e,n],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],
function(E,d,h,l){return E("dijit.ToolbarSeparator",[h,l],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',buildRendering:function(){this.inherited(arguments);d.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(E,d,h,l,m){d=d("dijit._editor._Plugin",l,{constructor:function(f){this.params=
f||{};h.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:m,disabled:!1,getLabel:function(f){return this.editor.commands[f]},_initButton:function(){if(this.command.length){var f=this.getLabel(this.command),n=this.editor,e=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(f=h.mixin({label:f,ownerDocument:n.ownerDocument,dir:n.dir,
lang:n.lang,showLabel:!1,iconClass:e,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete f.name,this.button=new this.buttonClass(f))}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(f,n,e){this.own(E.connect(f,n,this,e))},updateState:function(){var f=this.editor,n=this.command;if(f&&f.isLoaded&&n.length){var e=this.get("disabled");if(this.button)try{var v=
f._implCommand(n);var B=!e&&(this[v]?this[v](n):f.queryCommandEnabled(n));this.enabled!==B&&(this.enabled=B,this.button.set("disabled",!B));if(B&&"boolean"==typeof this.button.checked){var w=f.queryCommandState(n);this.checked!==w&&(this.checked=w,this.button.set("checked",f.queryCommandState(n)))}}catch(k){console.log(k)}}},setEditor:function(f){this.editor=f;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",h.hitch(this.editor,
"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",h.hitch(this,"updateState")))},setToolbar:function(f){this.button&&f.addChild(this.button)},set:function(f,n){if("object"===typeof f){for(var e in f)this.set(e,f[e]);return this}e=this._getAttrNames(f);if(this[e.s])var v=this[e.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(f,n);return v||this},get:function(f){var n=this._getAttrNames(f);
return this[n.g]?this[n.g]():this[f]},_setDisabledAttr:function(f){this._set("disabled",f);this.updateState()},_getAttrNames:function(f){var n=this._attrPairNames;if(n[f])return n[f];var e=f.charAt(0).toUpperCase()+f.substr(1);return n[f]={s:"_set"+e+"Attr",g:"_get"+e+"Attr"}},_set:function(f,n){this[f]=n}});d.registry={};return d})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),
function(E,d,h,l,m,f,n,e,v,B,w){return E("dijit._editor.plugins.EnterKeyHandling",v,{blockNodeForEnter:"BR",constructor:function(k){k&&("blockNodeForEnter"in k&&(k.blockNodeForEnter=k.blockNodeForEnter.toUpperCase()),l.mixin(this,k))},setEditor:function(k){if(this.editor!==k)if(this.editor=k,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,k.onLoadDeferred.then(l.hitch(this,function(M){this.own(m(k.document,"keydown",l.hitch(this,function(z){if(z.keyCode==h.ENTER){var r=l.mixin({},z);r.shiftKey=
!0;this.handleEnterKey(r)||(z.stopPropagation(),z.preventDefault())}})));9<=f("ie")&&10>=f("ie")&&this.own(m(k.document,"paste",l.hitch(this,function(z){setTimeout(l.hitch(this,function(){var r=this.editor.document.selection.createRange();r.move("character",-1);r.select();r.move("character",1);r.select()}),0)})));return M}));else if(this.blockNodeForEnter){var p=l.hitch(this,"handleEnterKey");k.addKeyHandler(13,0,0,p);k.addKeyHandler(13,0,1,p);this.own(this.editor.on("KeyPressed",l.hitch(this,"onKeyPressed")))}},
onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var k=this.editor.selection.getAncestorElement("LI");if(k){f("mozilla")&&"LI"==k.parentNode.parentNode.nodeName&&(k=k.parentNode.parentNode);var p=k.firstChild;!p||1!=p.nodeType||"UL"!=p.nodeName&&"OL"!=p.nodeName||(k.insertBefore(p.ownerDocument.createTextNode("\u00a0"),p),p=w.create(this.editor.window),p.setStart(k.firstChild,0),k=w.getSelection(this.editor.window,!0),k.removeAllRanges(),k.addRange(p))}else B.prototype.execCommand.call(this.editor,
"formatblock",this.blockNodeForEnter),(k=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?(k.innerHTML=this.bogusHtmlContent,9>=f("ie")&&(k=this.editor.document.selection.createRange(),k.move("character",-1),k.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",
blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(k){var p,M=this.editor.document,z;if(k.shiftKey){k=this.editor.selection.getParentElement();if(p=w.getAncestor(k,this.blockNodes)){if("LI"==p.tagName)return!0;k=w.getSelection(this.editor.window);var r=k.getRangeAt(0);r.collapsed||(r.deleteContents(),k=w.getSelection(this.editor.window),r=k.getRangeAt(0));if(w.atBeginningOfContainer(p,r.startContainer,r.startOffset)){var t=M.createElement("br");r=w.create(this.editor.window);p.insertBefore(t,
p.firstChild);r.setStartAfter(t);k.removeAllRanges();k.addRange(r)}else if(w.atEndOfContainer(p,r.startContainer,r.startOffset))r=w.create(this.editor.window),t=M.createElement("br"),p.appendChild(t),p.appendChild(M.createTextNode("\u00a0")),r.setStart(p.lastChild,0),k.removeAllRanges(),k.addRange(r);else{if((z=r.startContainer)&&3==z.nodeType){var A=z.nodeValue;var N=M.createTextNode(A.substring(0,r.startOffset));var I=M.createTextNode(A.substring(r.startOffset));p=M.createElement("br");""==I.nodeValue&&
f("webkit")&&(I=M.createTextNode("\u00a0"));d.place(N,z,"after");d.place(p,N,"after");d.place(I,p,"after");d.destroy(z);r=w.create(this.editor.window);r.setStart(I,0);k.removeAllRanges();k.addRange(r);return!1}return!0}}else k=w.getSelection(this.editor.window),k.rangeCount?(r=k.getRangeAt(0))&&r.startContainer&&(r.collapsed||(r.deleteContents(),k=w.getSelection(this.editor.window),r=k.getRangeAt(0)),(z=r.startContainer)&&3==z.nodeType?(p=r.startOffset,z.length<p&&(I=this._adjustNodeAndOffset(z,p),
z=I.node,p=I.offset),A=z.nodeValue,N=M.createTextNode(A.substring(0,p)),I=M.createTextNode(A.substring(p)),p=M.createElement("br"),I.length||(I=M.createTextNode("\u00a0")),N.length?d.place(N,z,"after"):N=z,d.place(p,N,"after"),d.place(I,p,"after"),d.destroy(z)):(0<=r.startOffset&&(t=z.childNodes[r.startOffset]),p=M.createElement("br"),I=M.createTextNode("\u00a0"),t?(d.place(p,t,"before"),d.place(I,p,"after")):(z.appendChild(p),z.appendChild(I))),r=w.create(this.editor.window),r.setStart(I,0),r.setEnd(I,
I.length),k.removeAllRanges(),k.addRange(r),this.editor.selection.collapse(!0)):B.prototype.execCommand.call(this.editor,"inserthtml","\x3cbr\x3e");return!1}var P=!0;k=w.getSelection(this.editor.window);r=k.getRangeAt(0);r.collapsed||(r.deleteContents(),k=w.getSelection(this.editor.window),r=k.getRangeAt(0));t=w.getBlockAncestor(r.endContainer,null,this.editor.editNode);var S=t.blockNode;if(this._checkListLater=S&&("LI"==S.nodeName||"LI"==S.parentNode.nodeName))return f("mozilla")&&(this._pressedEnterInBlock=
S),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(S.innerHTML)&&(S.innerHTML="",f("webkit")&&(r=w.create(this.editor.window),r.setStart(S,0),k.removeAllRanges(),k.addRange(r)),this._checkListLater=!1),!0;if(!t.blockNode||t.blockNode===this.editor.editNode){try{B.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(Q){}t={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),
blockContainer:this.editor.editNode};if(t.blockNode){if(t.blockNode!=this.editor.editNode&&!(t.blockNode.textContent||t.blockNode.innerHTML).replace(/^\s+|\s+$/g,"").length)return this.removeTrailingBr(t.blockNode),!1}else t.blockNode=this.editor.editNode;k=w.getSelection(this.editor.window);r=k.getRangeAt(0)}S=M.createElement(this.blockNodeForEnter);S.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(t.blockNode);I=r.endOffset;P=r.endContainer;P.length<I&&(I=this._adjustNodeAndOffset(P,I),P=
I.node,I=I.offset);if(w.atEndOfContainer(t.blockNode,P,I))t.blockNode===t.blockContainer?t.blockNode.appendChild(S):d.place(S,t.blockNode,"after"),P=!1,r=w.create(this.editor.window),r.setStart(S,0),k.removeAllRanges(),k.addRange(r),this.editor.height&&e.scrollIntoView(S);else if(w.atBeginningOfContainer(t.blockNode,r.startContainer,r.startOffset))d.place(S,t.blockNode,t.blockNode===t.blockContainer?"first":"before"),S.nextSibling&&this.editor.height&&(r=w.create(this.editor.window),r.setStart(S.nextSibling,
0),k.removeAllRanges(),k.addRange(r),e.scrollIntoView(S.nextSibling)),P=!1;else{t.blockNode===t.blockContainer?t.blockNode.appendChild(S):d.place(S,t.blockNode,"after");P=!1;t.blockNode.style&&S.style&&t.blockNode.style.cssText&&(S.style.cssText=t.blockNode.style.cssText);if((z=r.startContainer)&&3==z.nodeType){I=r.endOffset;z.length<I&&(I=this._adjustNodeAndOffset(z,I),z=I.node,I=I.offset);A=z.nodeValue;N=M.createTextNode(A.substring(0,I));I=M.createTextNode(A.substring(I,A.length));d.place(N,z,
"before");d.place(I,z,"after");d.destroy(z);for(r=N.parentNode;r!==t.blockNode;){A=M.createElement(r.tagName);r.style&&A.style&&r.style.cssText&&(A.style.cssText=r.style.cssText);"FONT"===r.tagName&&(r.color&&(A.color=r.color),r.face&&(A.face=r.face),r.size&&(A.size=r.size));for(;I;)z=I.nextSibling,A.appendChild(I),I=z;d.place(A,r,"after");N=r;I=A;r=r.parentNode}if(1==I.nodeType||3==I.nodeType&&I.nodeValue)S.innerHTML="";for(N=I;I;)z=I.nextSibling,S.appendChild(I),I=z}r=w.create(this.editor.window);
M=N;if("BR"!==this.blockNodeForEnter){for(;M;)p=M,M=z=M.firstChild;p&&p.parentNode?(S=p.parentNode,r.setStart(S,0),k.removeAllRanges(),k.addRange(r),this.editor.height&&e.scrollIntoView(S),f("mozilla")&&(this._pressedEnterInBlock=t.blockNode)):P=!0}else r.setStart(S,0),k.removeAllRanges(),k.addRange(r),this.editor.height&&e.scrollIntoView(S),f("mozilla")&&(this._pressedEnterInBlock=t.blockNode)}return P},_adjustNodeAndOffset:function(k,p){for(;k.length<p&&k.nextSibling&&3==k.nextSibling.nodeType;)p-=
k.length,k=k.nextSibling;return{node:k,offset:p}},removeTrailingBr:function(k){if(k=/P|DIV|LI/i.test(k.tagName)?k:this.editor.selection.getParentOfType(k,["P","DIV","LI"]))k.lastChild&&(1<k.childNodes.length&&3==k.lastChild.nodeType&&/^[\s\xAD]*$/.test(k.lastChild.nodeValue)||"BR"==k.lastChild.tagName)&&d.destroy(k.lastChild),k.childNodes.length||(k.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(E,d,h,l,m,f,n,e,v,B,w,k,p,M,z,r,t,A,N,I,P,S,Q,F,U,R,W,K,V){var y=h("dijit._editor.RichText",[Q,F],{constructor:function(b){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};b&&p.isString(b.value)&&(this.value=b.value);this.onLoadDeferred=new l},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[p.trim,p.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);t("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));t("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(t("ie")||t("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[p.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[p.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);N.publish(V._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var b=p.hitch(this,function(G,J){return function(){return!this.execCommand(G,J)}}),g={b:b("bold"),i:b("italic"),u:b("underline"),a:b("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:b("formatblock",
"h1"),2:b("formatblock","h2"),3:b("formatblock","h3"),4:b("formatblock","h4"),"\\":b("insertunorderedlist")};t("ie")||(g.Z=b("redo"));for(var x in g)this.addKeyHandler(x,!0,!1,g[x])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(y._editorCommandsLocalized)this._local2NativeFormatNames=y._local2NativeFormatNames,this._native2LocalFormatNames=y._native2LocalFormatNames;else{y._editorCommandsLocalized=!0;y._local2NativeFormatNames={};
y._native2LocalFormatNames={};this._local2NativeFormatNames=y._local2NativeFormatNames;this._native2LocalFormatNames=y._native2LocalFormatNames;for(var b="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),g="",x,G=0;x=b[G++];)g="l"!==x.charAt(1)?g+("\x3c"+x+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+x+"\x3e\x3cbr/\x3e"):g+("\x3c"+x+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+x+"\x3e\x3cbr/\x3e");var J=e.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:g});this.ownerDocumentBody.appendChild(J);
b=p.hitch(this,function(){for(var a=J.firstChild;a;)try{this.selection.selectElement(a.firstChild);var c=a.tagName.toLowerCase();this._local2NativeFormatNames[c]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[c]]=c;a=a.nextSibling.nextSibling}catch(q){}e.destroy(J)});this.defer(b)}},open:function(b){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new l;this.isClosed||this.close();N.publish(V._scopeName+"._editor.RichText::open",
this);1===arguments.length&&b.nodeName&&(this.domNode=b);var g=this.domNode;if(p.isString(this.value)){var x=this.value;g.innerHTML=""}else if(g.nodeName&&"textarea"==g.nodeName.toLowerCase()){var G=this.textarea=g;this.name=G.name;x=G.value;g=this.domNode=this.ownerDocument.createElement("div");g.setAttribute("widgetId",this.id);G.removeAttribute("widgetId");g.cssText=G.cssText;g.className+=" "+G.className;e.place(g,G,"before");var J=p.hitch(this,function(){B.set(G,{display:"block",position:"absolute",
top:"-1000px"});if(t("ie")){var u=G.style;this.__overflow=u.overflow;u.overflow="hidden"}});t("ie")?this.defer(J,10):J();if(G.form){var a=G.value;this.reset=function(){this.getValue()!==a&&this.replaceValue(a)};M(G.form,"submit",p.hitch(this,function(){f.set(G,"disabled",this.disabled);G.value=this.getValue()}))}}else x=W.getChildrenHtml(g),g.innerHTML="";this.value=x;g.nodeName&&"LI"===g.nodeName&&(g.innerHTML=" \x3cbr\x3e");this.header=g.ownerDocument.createElement("div");g.appendChild(this.header);
this.editingArea=g.ownerDocument.createElement("div");g.appendChild(this.editingArea);this.footer=g.ownerDocument.createElement("div");g.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!d.useXDomain||d.allowXdRichTextSave)){if((x=m.byId(V._scopeName+"._editor.RichText.value"))&&""!==x.value){J=x.value.split(this._SEPARATOR);for(var c=0,q;q=J[c++];)if(q=q.split(this._NAME_CONTENT_SEP),q[0]===this.name){this.value=q[1];J=J.splice(c,1);x.value=J.join(this._SEPARATOR);
break}}y._globalSaveHandler||(y._globalSaveHandler={},I.addOnUnload(function(){for(var u in y._globalSaveHandler){var H=y._globalSaveHandler[u];p.isFunction(H)&&H()}}));y._globalSaveHandler[this.id]=p.hitch(this,"_saveContent")}this.isClosed=!1;x=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");x.id=this.id+"_iframe";x.style.border="none";x.style.width="100%";this._layoutMode?x.style.height="100%":7<=t("ie")?(this.height&&(x.style.height=this.height),this.minHeight&&(x.style.minHeight=
this.minHeight)):x.style.height=this.height?this.height:this.minHeight;x.frameBorder=0;x._loadFunc=p.hitch(this,function(u){this.window=u;this.document=u.document;this.selection=new U.SelectionManager(u);t("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});J=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");J=11>t("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+J+"');document.close()":"javascript: '"+
J+"'";this.editingArea.appendChild(x);x.src=J;"LI"===g.nodeName&&(g.lastChild.style.marginTop="-1.2em");n.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var b=B.getComputedStyle(this.domNode);if(this["aria-label"])var g=this["aria-label"];else{var x=z('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||m.byId(this["aria-labelledby"],this.ownerDocument);x&&(g=x.textContent||x.innerHTML||"")}x="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(g?" aria-label\x3d'"+A.escape(g)+"'":"")+"\x3e\x3c/div\x3e";var G=[b.fontWeight,b.fontSize,b.fontFamily].join(" "),J=b.lineHeight;J=0<=J.indexOf("px")?parseFloat(J)/parseFloat(b.fontSize):0<=J.indexOf("em")?parseFloat(J):"normal";var a="",c=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(q){q=q.replace(/^;/ig,"")+";";var u=q.split(":")[0];if(u){u=p.trim(u);u=u.toLowerCase();var H,O="";for(H=0;H<u.length;H++){var X=u.charAt(H);switch(X){case "-":H++,X=u.charAt(H).toUpperCase();default:O+=
X}}B.set(c.domNode,O,"")}a+=q+";"});this.iframe.setAttribute("title",g);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||w.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",g?"\x3ctitle\x3e"+A.escape(g)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",G,";\n",this.height||t("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",J,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",t("ie")||t("trident")||t("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",g?" aria-label\x3d'"+A.escape(g)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+a+"'\x3e",x,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var b=[];this.styleSheets&&(b=this.styleSheets.split(";"),this.styleSheets=
"");b=b.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var g="",x=0,G,J=S.get(this.ownerDocument);G=b[x++];)G=(new P(J.location,G)).toString(),this.editingAreaStyleSheets.push(G),g+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+G+'"/\x3e';return g},addStyleSheet:function(b){var g=b.toString(),x=S.get(this.ownerDocument);if("."===g.charAt(0)||"/"!==g.charAt(0)&&!b.host)g=(new P(x.location,g)).toString();-1<E.indexOf(this.editingAreaStyleSheets,g)||(this.editingAreaStyleSheets.push(g),
this.onLoadDeferred.then(p.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(g);else{var G=this.document.getElementsByTagName("head")[0],J=this.document.createElement("link");J.rel="stylesheet";J.type="text/css";J.href=g;G.appendChild(J)}})))},removeStyleSheet:function(b){var g=b.toString(),x=S.get(this.ownerDocument);if("."===g.charAt(0)||"/"!==g.charAt(0)&&!b.host)g=(new P(x.location,g)).toString();b=E.indexOf(this.editingAreaStyleSheets,g);-1!==b&&(delete this.editingAreaStyleSheets[b],
z('link[href\x3d"'+g+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(b){b=!!b;this._set("disabled",b);if(this.isLoaded){var g=t("ie")&&(this.isLoaded||!this.focusOnLoad);g&&(this.editNode.unselectable="on");this.editNode.contentEditable=!b;this.editNode.tabIndex=b?"-1":this.tabIndex;g&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(t("mozilla")&&!b&&this._mozSettingProps){b=this._mozSettingProps;for(var x in b)if(b.hasOwnProperty(x))try{this.document.execCommand(x,
!1,b[x])}catch(G){}}this._disabledOK=!0}},onLoad:function(b){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=K.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var g=this;this.beforeIframeNode=e.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=e.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){g.editNode.focus()};this.focusNode=
this.editNode;var x=this.events.concat(this.captureEvents),G=this.iframe?this.document:this.editNode;this.own.apply(this,E.map(x,function(J){var a=J.toLowerCase().replace(/^on/,"");return M(G,a,p.hitch(this,J))},this));this.own(M(G,"mouseup",p.hitch(this,"onClick")));t("ie")&&(this.own(M(this.document,"mousedown",p.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);t("webkit")&&(this._webkitListener=this.own(M(this.document,"mouseup",p.hitch(this,"onDisplayChanged")))[0],this.own(M(this.document,
"mousedown",p.hitch(this,function(J){J=J.target;!J||J!==this.document.body&&J!==this.document||this.defer("placeCursorAtEnd")}))));if(t("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(J){}this.isLoaded=!0;this.set("disabled",this.disabled);x=p.hitch(this,function(){this.setValue(b);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&r(p.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(x):x()},onKeyDown:function(b){if(b.keyCode===k.SHIFT||b.keyCode===k.ALT||b.keyCode===k.META||b.keyCode===k.CTRL)return!0;b.keyCode===k.TAB&&this.isTabIndent&&(b.stopPropagation(),b.preventDefault(),this.queryCommandEnabled(b.shiftKey?"outdent":"indent")&&this.execCommand(b.shiftKey?"outdent":"indent"));if(b.keyCode==k.TAB&&!this.isTabIndent&&!b.ctrlKey&&!b.altKey)return b.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>t("ie")&&b.keyCode===k.BACKSPACE&&"Control"===this.document.selection.type&&(b.stopPropagation(),b.preventDefault(),this.execCommand("delete"));t("ff")&&(b.keyCode===k.PAGE_UP||b.keyCode===k.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&b.preventDefault();var g=this._keyHandlers[b.keyCode],x=arguments;g&&!b.altKey&&E.some(g,function(G){if(!(G.shift^b.shiftKey||G.ctrl^(b.ctrlKey||b.metaKey)))return G.handler.apply(this,x)||b.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(b){w.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",b)},_setValueAttr:function(b){this.setValue(b)},_setDisableSpellCheckAttr:function(b){this.document?f.set(this.document.body,"spellcheck",!b):this.onLoadDeferred.then(p.hitch(this,function(){f.set(this.document.body,"spellcheck",!b)}));this._set("disableSpellCheck",b)},addKeyHandler:function(b,g,x,G){"string"==
typeof b&&(b=b.toUpperCase().charCodeAt(0));p.isArray(this._keyHandlers[b])||(this._keyHandlers[b]=[]);this._keyHandlers[b].push({shift:x||!1,ctrl:g||!1,handler:G})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(b){this.onDisplayChanged(b)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(b){(t("ie")||t("trident"))&&this.defer(function(){K.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var g=this.getValue(!0);if(g!==this.value)this.onChange(g);
this._set("value",g)},_onFocus:function(b){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!t("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>t("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(b,g){b=b.toLowerCase();"formatblock"===b?t("safari")&&void 0===g&&(b="heading"):"hilitecolor"!==b||t("mozilla")||(b="backcolor");return b},_implCommand:function(b){return"_"+this._normalizeCommand(b)+"EnabledImpl"},_qcaCache:{},
queryCommandAvailable:function(b){var g=this._qcaCache[b];return void 0!==g?g:this._qcaCache[b]=this._queryCommandAvailable(b)},_queryCommandAvailable:function(b){switch(b.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return t("ie")||t("trident")||t("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!t("webkit");default:return!1}},execCommand:function(b,g){this.focused&&this.focus();b=this._normalizeCommand(b,g);if(void 0!==g){if("heading"===b)throw Error("unimplemented");"formatblock"===
b&&(t("ie")||t("trident"))&&(g="\x3c"+g+"\x3e")}var x="_"+b+"Impl";if(this[x])var G=this[x](g);else if((g=1<arguments.length?g:null)||"createlink"!==b)G=this.document.execCommand(b,!1,g);this.onDisplayChanged();return G},queryCommandEnabled:function(b){if(this.disabled||!this._disabledOK)return!1;b=this._normalizeCommand(b);var g=this._implCommand(b);return this[g]?this[g](b):this._browserQueryCommandEnabled(b)},queryCommandState:function(b){if(this.disabled||!this._disabledOK)return!1;b=this._normalizeCommand(b);
try{return this.document.queryCommandState(b)}catch(g){return!1}},queryCommandValue:function(b){if(this.disabled||!this._disabledOK)return!1;b=this._normalizeCommand(b);if(t("ie")&&"formatblock"===b)b=this._native2LocalFormatNames[this.document.queryCommandValue(b)];else if(t("mozilla")&&"hilitecolor"===b){try{var g=this.document.queryCommandValue("styleWithCSS")}catch(x){g=!1}this.document.execCommand("styleWithCSS",!1,!0);b=this.document.queryCommandValue(b);this.document.execCommand("styleWithCSS",
!1,g)}else b=this.document.queryCommandValue(b);return b},_sCall:function(b,g){return this.selection[b].apply(this.selection,g)},placeCursorAtStart:function(){this.focus();var b=!1;if(t("mozilla"))for(var g=this.editNode.firstChild;g;){if(3===g.nodeType){if(0<g.nodeValue.replace(/^\s+|\s+$/g,"").length){b=!0;this.selection.selectElement(g);break}}else if(1===g.nodeType){b=!0;var x=g.tagName?g.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(x)?this.selection.selectElement(g):
this.selection.selectElementChildren(g);break}g=g.nextSibling}else b=!0,this.selection.selectElementChildren(this.editNode);b&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var b=!1;if(t("mozilla"))for(var g=this.editNode.lastChild;g;){if(3===g.nodeType){if(0<g.nodeValue.replace(/^\s+|\s+$/g,"").length){b=!0;this.selection.selectElement(g);break}}else if(1===g.nodeType){b=!0;this.selection.selectElement(g.lastChild||g);break}g=g.previousSibling}else b=!0,this.selection.selectElementChildren(this.editNode);
b&&this.selection.collapse(!1)},getValue:function(b){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,b):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(b){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){b=this._preFilterContent(b);var g=this.isClosed?this.domNode:this.editNode;g.innerHTML=b;this._preDomFilterContent(g)}else this.textarea.value=b;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(p.hitch(this,function(){this.setValue(b)}))},replaceValue:function(b){this.isClosed?this.setValue(b):this.window&&this.window.getSelection&&!t("mozilla")?this.setValue(b):this.window&&this.window.getSelection?(b=this._preFilterContent(b),this.execCommand("selectall"),this.execCommand("inserthtml",b),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(b);this._set("value",this.getValue(!0))},_preFilterContent:function(b){var g=
b;E.forEach(this.contentPreFilters,function(x){x&&(g=x(g))});return g},_preDomFilterContent:function(b){b=b||this.editNode;E.forEach(this.contentDomPreFilters,function(g){g&&p.isFunction(g)&&g(b)},this)},_postFilterContent:function(b,g){if(p.isString(b))var x=b;else b=b||this.editNode,this.contentDomPostFilters.length&&(g&&(b=p.clone(b)),E.forEach(this.contentDomPostFilters,function(G){b=G(b)})),x=W.getChildrenHtml(b);p.trim(x.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(x="");E.forEach(this.contentPostFilters,
function(G){x=G(x)});return x},_saveContent:function(){var b=m.byId(V._scopeName+"._editor.RichText.value");b&&(b.value&&(b.value+=this._SEPARATOR),b.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(b,g){b=b.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");g||(b=b.replace(/'/gm,"\x26#39;"));return b},getNodeHtml:function(b){w.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return W.getNodeHtml(b)},getNodeChildrenHtml:function(b){w.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return W.getChildrenHtml(b)},close:function(b){if(!this.isClosed){arguments.length||(b=!0);b&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);t("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var g=this.textarea.style;g.position="";g.left=g.top="";t("ie")&&(g.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;e.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;n.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);y._globalSaveHandler&&delete y._globalSaveHandler[this.id]},_removeMozBogus:function(b){return b.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(b){b=b.replace(/\sclass="webkit-block-placeholder"/gi,"");b=b.replace(/\sclass="apple-style-span"/gi,
"");return b=b.replace(/<meta charset="utf-8" \/>/gi,"")},_normalizeFontStyle:function(b){return b.replace(/<(\/)?strong([ >])/gi,"\x3c$1b$2").replace(/<(\/)?em([ >])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(b){return b.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(b){if(!b)return!1;
var g=9>t("ie")?this.document.selection.createRange():this.document;try{return g.queryCommandEnabled(b)}catch(x){return!1}},_createlinkEnabledImpl:function(){var b=!0;return b=t("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var b=!0;return b=t("mozilla")||t("webkit")?this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var b=
!0;return b=t("mozilla")||t("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var b=!0;t("webkit")?((b=this.window.getSelection())&&(b=b.toString()),b=!!b):b=this._browserQueryCommandEnabled("cut");return b},_copyEnabledImpl:function(){var b=!0;t("webkit")?((b=this.window.getSelection())&&(b=b.toString()),b=!!b):b=this._browserQueryCommandEnabled("copy");return b},_pasteEnabledImpl:function(){var b=!0;return t("webkit")?!0:b=this._browserQueryCommandEnabled("paste")},
_inserthorizontalruleImpl:function(b){return t("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,b)},_unlinkImpl:function(b){return this.queryCommandEnabled("unlink")&&(t("mozilla")||t("webkit"))?(b=this.selection.getAncestorElement("a"),this.selection.selectElement(b),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",!1,b)},_hilitecolorImpl:function(b){if(!this._handleTextColorOrProperties("hilitecolor",b))if(t("mozilla")){this.document.execCommand("styleWithCSS",
!1,!0);console.log("Executing color command.");var g=this.document.execCommand("hilitecolor",!1,b);this.document.execCommand("styleWithCSS",!1,!1)}else g=this.document.execCommand("hilitecolor",!1,b);return g},_backcolorImpl:function(b){t("ie")&&(b=b?b:null);var g=this._handleTextColorOrProperties("backcolor",b);g||(g=this.document.execCommand("backcolor",!1,b));return g},_forecolorImpl:function(b){t("ie")&&(b=b?b:null);var g=!1;(g=this._handleTextColorOrProperties("forecolor",b))||(g=this.document.execCommand("forecolor",
!1,b));return g},_inserthtmlImpl:function(b){b=this._preFilterContent(b);var g=!0;if(9>t("ie")){var x=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var G=x.item(0);x.length;)x.remove(x.item(0));G.outerHTML=b}else x.pasteHTML(b);x.select()}else if(8>t("trident")){var J=R.getSelection(this.window);if(J&&J.rangeCount&&J.getRangeAt){x=J.getRangeAt(0);x.deleteContents();var a=e.create("div");a.innerHTML=b;for(G=this.document.createDocumentFragment();b=
a.firstChild;)var c=G.appendChild(b);x.insertNode(G);c&&(x=x.cloneRange(),x.setStartAfter(c),x.collapse(!1),J.removeAllRanges(),J.addRange(x))}}else t("mozilla")&&!b.length?this.selection.remove():g=this.document.execCommand("inserthtml",!1,b);return g},_boldImpl:function(b){var g=!1;if(t("ie")||t("trident"))this._adaptIESelection(),g=this._adaptIEFormatAreaAndExec("bold");g||(g=this.document.execCommand("bold",!1,b));return g},_italicImpl:function(b){var g=!1;if(t("ie")||t("trident"))this._adaptIESelection(),
g=this._adaptIEFormatAreaAndExec("italic");g||(g=this.document.execCommand("italic",!1,b));return g},_underlineImpl:function(b){var g=!1;if(t("ie")||t("trident"))this._adaptIESelection(),g=this._adaptIEFormatAreaAndExec("underline");g||(g=this.document.execCommand("underline",!1,b));return g},_strikethroughImpl:function(b){var g=!1;if(t("ie")||t("trident"))this._adaptIESelection(),g=this._adaptIEFormatAreaAndExec("strikethrough");g||(g=this.document.execCommand("strikethrough",!1,b));return g},_superscriptImpl:function(b){var g=
!1;if(t("ie")||t("trident"))this._adaptIESelection(),g=this._adaptIEFormatAreaAndExec("superscript");g||(g=this.document.execCommand("superscript",!1,b));return g},_subscriptImpl:function(b){var g=!1;if(t("ie")||t("trident"))this._adaptIESelection(),g=this._adaptIEFormatAreaAndExec("subscript");g||(g=this.document.execCommand("subscript",!1,b));return g},_fontnameImpl:function(b){if(t("ie")||t("trident"))var g=this._handleTextColorOrProperties("fontname",b);g||(g=this.document.execCommand("fontname",
!1,b));return g},_fontsizeImpl:function(b){if(t("ie")||t("trident"))var g=this._handleTextColorOrProperties("fontsize",b);g||(g=this.document.execCommand("fontsize",!1,b));return g},_insertorderedlistImpl:function(b){var g=!1;if(t("ie")||t("trident")||t("edge"))g=this._adaptIEList("insertorderedlist",b);g||(g=this.document.execCommand("insertorderedlist",!1,b));return g},_insertunorderedlistImpl:function(b){var g=!1;if(t("ie")||t("trident")||t("edge"))g=this._adaptIEList("insertunorderedlist",b);
g||(g=this.document.execCommand("insertunorderedlist",!1,b));return g},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(b){var g=0;if(b&&b.childNodes){var x;for(x=0;x<b.childNodes.length;x++){var G=v.position(b.childNodes[x]);g+=G.h}}return g},_isNodeEmpty:function(b,g){return 1===b.nodeType?0<b.childNodes.length?this._isNodeEmpty(b.childNodes[0],g):!0:3===b.nodeType?
""===b.nodeValue.substring(g):!1},_removeStartingRangeFromRange:function(b,g){if(b.nextSibling)g.setStart(b.nextSibling,0);else{for(b=b.parentNode;b&&null==b.nextSibling;)b=b.parentNode;b&&g.setStart(b.nextSibling,0)}return g},_adaptIESelection:function(){var b=R.getSelection(this.window);if(b&&b.rangeCount&&!b.isCollapsed){for(var g=b.getRangeAt(0),x=g.startContainer,G=g.startOffset;3===x.nodeType&&G>=x.length&&x.nextSibling;)G-=x.length,x=x.nextSibling;for(var J=null;this._isNodeEmpty(x,G)&&x!==
J;)J=x,g=this._removeStartingRangeFromRange(x,g),x=g.startContainer,G=0;b.removeAllRanges();b.addRange(g)}},_adaptIEFormatAreaAndExec:function(b){var g=R.getSelection(this.window),x=this.document,G;if(b&&g&&g.isCollapsed){if(this.queryCommandValue(b)){b=this._tagNamesForCommand(b);var J=g.getRangeAt(0);var a=J.startContainer;if(3===a.nodeType){var c=J.endOffset;a.length<c&&(c=this._adjustNodeAndOffset(q,c),a=c.node,c=c.offset)}for(;a&&a!==this.editNode;){var q=a.tagName?a.tagName.toLowerCase():"";
if(-1<E.indexOf(b,q)){var u=a;break}a=a.parentNode}if(u&&(q=J.startContainer,b=x.createElement(u.tagName),e.place(b,u,"after"),q&&3===q.nodeType)){c=J.endOffset;q.length<c&&(c=this._adjustNodeAndOffset(q,c),q=c.node,c=c.offset);a=q.nodeValue;J=x.createTextNode(a.substring(0,c));var H=a.substring(c,a.length);H&&(G=x.createTextNode(H));e.place(J,q,"before");if(G){var O=x.createElement("span");O.className="ieFormatBreakerSpan";e.place(O,q,"after");e.place(G,O,"after");G=O}e.destroy(q);c=J.parentNode;
for(q=[];c!==u;){a=c.tagName;J={tagName:a};q.push(J);a=x.createElement(a);c.style&&a.style&&c.style.cssText&&(a.style.cssText=c.style.cssText,J.cssText=c.style.cssText);"FONT"===c.tagName&&(c.color&&(a.color=c.color,J.color=c.color),c.face&&(a.face=c.face,J.face=c.face),c.size&&(a.size=c.size,J.size=c.size));c.className&&(a.className=c.className,J.className=c.className);if(G)for(;G;)J=G.nextSibling,a.appendChild(G),G=J;a.tagName==c.tagName?(O=x.createElement("span"),O.className="ieFormatBreakerSpan",
e.place(O,c,"after"),e.place(a,O,"after")):e.place(a,c,"after");J=c;G=a;c=c.parentNode}if(G){if(1===G.nodeType||3===G.nodeType&&G.nodeValue)b.innerHTML="";for(;G;)J=G.nextSibling,b.appendChild(G),G=J}if(q.length){J=q.pop();G=x.createElement(J.tagName);J.cssText&&G.style&&(G.style.cssText=J.cssText);J.className&&(G.className=J.className);"FONT"===J.tagName&&(J.color&&(G.color=J.color),J.face&&(G.face=J.face),J.size&&(G.size=J.size));for(e.place(G,b,"before");q.length;)J=q.pop(),u=x.createElement(J.tagName),
J.cssText&&u.style&&(u.style.cssText=J.cssText),J.className&&(u.className=J.className),"FONT"===J.tagName&&(J.color&&(u.color=J.color),J.face&&(u.face=J.face),J.size&&(u.size=J.size)),G.appendChild(u),G=u;u=x.createTextNode(".");O.appendChild(u);G.appendChild(u)}else O=x.createElement("span"),O.className="ieFormatBreakerSpan",u=x.createTextNode("."),O.appendChild(u),e.place(O,b,"before");G=R.create(this.window);G.setStart(u,0);G.setEnd(u,u.length);g.removeAllRanges();g.addRange(G);this.selection.collapse(!1);
u.parentNode.innerHTML="";b.firstChild||e.destroy(b);return!0}return!1}J=g.getRangeAt(0);if((q=J.startContainer)&&3===q.nodeType)return c=J.startOffset,q.length<c&&(c=this._adjustNodeAndOffset(q,c),q=c.node,c=c.offset),a=q.nodeValue,J=x.createTextNode(a.substring(0,c)),H=a.substring(c),""!==H&&(G=x.createTextNode(a.substring(c))),O=x.createElement("span"),u=x.createTextNode("."),O.appendChild(u),J.length?e.place(J,q,"after"):J=q,e.place(O,J,"after"),G&&e.place(G,O,"after"),e.destroy(q),G=R.create(this.window),
G.setStart(u,0),G.setEnd(u,u.length),g.removeAllRanges(),g.addRange(G),x.execCommand(b),e.place(O.firstChild,O,"before"),e.destroy(O),G.setStart(u,0),G.setEnd(u,u.length),g.removeAllRanges(),g.addRange(G),this.selection.collapse(!1),u.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(b){var g=R.getSelection(this.window);if(g.isCollapsed&&g.rangeCount&&!this.queryCommandValue(b)){var x=g.getRangeAt(0),G=x.startContainer;if(G&&3==G.nodeType&&!x.startOffset)return x="ul","insertorderedlist"===
b&&(x="ol"),b=this.document.createElement(x),x=e.create("li",null,b),e.place(b,G,"before"),x.appendChild(G),e.create("br",null,b,"after"),b=R.create(this.window),b.setStart(G,0),b.setEnd(G,G.length),g.removeAllRanges(),g.addRange(b),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(b,g){var x=R.getSelection(this.window),G=this.document,J,a;g=g||null;if(b&&x&&x.isCollapsed&&x.rangeCount){var c=x.getRangeAt(0);if((J=c.startContainer)&&3===J.nodeType){var q=c.startOffset;
J.length<q&&(c=this._adjustNodeAndOffset(J,q),J=c.node,q=c.offset);var u=J.nodeValue;c=G.createTextNode(u.substring(0,q));""!==u.substring(q)&&(a=G.createTextNode(u.substring(q)));u=G.createElement("span");q=G.createTextNode(".");u.appendChild(q);G=G.createElement("span");u.appendChild(G);c.length?e.place(c,J,"after"):c=J;e.place(u,c,"after");a&&e.place(a,u,"after");e.destroy(J);J=R.create(this.window);J.setStart(q,0);J.setEnd(q,q.length);x.removeAllRanges();x.addRange(J);if(t("webkit")){x="color";
if("hilitecolor"===b||"backcolor"===b)x="backgroundColor";B.set(u,x,g);this.selection.remove();e.destroy(G);u.innerHTML="\x26#160;";this.selection.selectElement(u);this.focus()}else this.execCommand(b,g),e.place(u.firstChild,u,"before"),e.destroy(u),J.setStart(q,0),J.setEnd(q,q.length),x.removeAllRanges(),x.addRange(J),this.selection.collapse(!1),q.parentNode.removeChild(q);return!0}}return!1},_adjustNodeAndOffset:function(b,g){for(;b.length<g&&b.nextSibling&&3===b.nextSibling.nodeType;)g-=b.length,
b=b.nextSibling;return{node:b,offset:g}},_tagNamesForCommand:function(b){return"bold"===b?["b","strong"]:"italic"===b?["i","em"]:"strikethrough"===b?["s","strike"]:"superscript"===b?["sup"]:"subscript"===b?["sub"]:"underline"===b?["u"]:[]},_stripBreakerNodes:function(b){if(this.isLoaded)return z(".ieFormatBreakerSpan",b).forEach(function(g){for(;g.firstChild;)e.place(g.firstChild,g,"before");e.destroy(g)}),b},_stripTrailingEmptyNodes:function(b){function g(x){return/^(p|div|br)$/i.test(x.nodeName)&&
0==x.children.length&&/^[\s\xA0]*$/.test(x.textContent||x.innerText||"")||3===x.nodeType&&/^[\s\xA0]*$/.test(x.nodeValue)}for(;b.lastChild&&g(b.lastChild);)e.destroy(b.lastChild);return b},_setTextDirAttr:function(b){this._set("textDir",b);this.onLoadDeferred.then(p.hitch(this,function(){this.editNode.dir=b}))}});return y})},"dijit/_editor/range":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(E,d,h){var l={getIndex:function(n,e){for(var v=[],B=[],w=n,k,p;n!=
e;){var M=0;for(k=n.parentNode;p=k.childNodes[M++];)if(p===n){--M;break}v.unshift(M);B.unshift(M-k.childNodes.length);n=k}if(0<v.length&&3==w.nodeType){for(p=w.previousSibling;p&&3==p.nodeType;)v[v.length-1]--,p=p.previousSibling;for(p=w.nextSibling;p&&3==p.nodeType;)B[B.length-1]++,p=p.nextSibling}return{o:v,r:B}},getNode:function(n,e){if(!h.isArray(n)||0==n.length)return e;var v=e;E.every(n,function(B){if(0<=B&&B<v.childNodes.length)v=v.childNodes[B];else return v=null,!1;return!0});return v},getCommonAncestor:function(n,
e,v){v=v||n.ownerDocument.body;var B=function(p){for(var M=[];p;)if(M.unshift(p),p!==v)p=p.parentNode;else break;return M};n=B(n);e=B(e);B=Math.min(n.length,e.length);for(var w=n[0],k=1;k<B;k++)if(n[k]===e[k])w=n[k];else break;return w},getAncestor:function(n,e,v){for(v=v||n.ownerDocument.body;n&&n!==v;){var B=n.nodeName.toUpperCase();if(e.test(B))return n;n=n.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(n,e,v){v=v||n.ownerDocument.body;
e=e||l.BlockTagNames;for(var B=null,w;n&&n!==v;){var k=n.nodeName.toUpperCase();!B&&e.test(k)&&(B=n);!w&&/^(?:BODY|TD|TH|CAPTION)$/.test(k)&&(w=n);n=n.parentNode}return{blockNode:B,blockContainer:w||n.ownerDocument.body}},atBeginningOfContainer:function(n,e,v){var B=!1,w=0==v;w||3!=e.nodeType||/^[\s\xA0]+$/.test(e.nodeValue.substr(0,v))&&(w=!0);if(w)for(B=!0;e&&e!==n;){if(e.previousSibling){B=!1;break}e=e.parentNode}return B},atEndOfContainer:function(n,e,v){var B=!1,w=v==(e.length||e.childNodes.length);
w||3!=e.nodeType||/^[\s\xA0]+$/.test(e.nodeValue.substr(v))&&(w=!0);if(w)for(B=!0;e&&e!==n;){if(e.nextSibling){B=!1;break}e=e.parentNode}return B},adjacentNoneTextNode:function(n,e){var v=n;n=0-n.length||0;for(e=e?"nextSibling":"previousSibling";v&&3==v.nodeType;)n+=v.length,v=v[e];return[v,n]},create:function(n){n=n||window;return n.getSelection?n.document.createRange():new f},getSelection:function(n,e){if(n.getSelection)return n.getSelection();n=new m.selection(n);e||n._getCurrentSelection();return n}};
if(!window.getSelection)var m=l.ie={cachedSelection:{},selection:function(n){this._ranges=[];this.addRange=function(e,v){this._ranges.push(e);v||e._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(e){return this._ranges[e]};this._getCurrentSelection=function(){this.removeAllRanges();var e=n.document.selection.createRange();e="CONTROL"==n.document.selection.type.toUpperCase()?new f(m.decomposeControlRange(e)):
new f(m.decomposeTextRange(e));this.addRange(e,!0),this.isCollapsed=e.collapsed}},decomposeControlRange:function(n){var e=n.item(0),v=n.item(n.length-1);n=e.parentNode;var B=v.parentNode;e=l.getIndex(e,n).o[0];v=l.getIndex(v,B).o[0]+1;return[n,e,B,v]},getEndPoint:function(n,e){var v=n.duplicate();v.collapse(!e);var B="EndTo"+(e?"End":"Start"),w=v.parentElement(),k;if(0<w.childNodes.length)E.every(w.childNodes,function(z,r){if(3!=z.nodeType)if(v.moveToElementText(z),0<v.compareEndPoints(B,n))if(k&&
3==k.nodeType){p=k;var t=!0}else return p=w,M=r,!1;else{if(r==w.childNodes.length-1)return p=w,M=w.childNodes.length,!1}else r==w.childNodes.length-1&&(p=z,t=!0);if(t&&p)return p=(z=l.adjacentNoneTextNode(p)[0])?z.nextSibling:w.firstChild,r=l.adjacentNoneTextNode(p),z=r[0],r=r[1],z?(v.moveToElementText(z),v.collapse(!1)):v.moveToElementText(w),v.setEndPoint(B,n),M=v.text.length-r,!1;k=z;return!0});else{var p=w;var M=0}e||1!=p.nodeType||M!=p.childNodes.length||(e=p.nextSibling)&&3==e.nodeType&&(p=
e,M=0);return[p,M]},setEndPoint:function(n,e,v){n=n.duplicate();var B;if(3!=e.nodeType)if(0<v){if(B=e.childNodes[v-1])if(3==B.nodeType)e=B,v=B.length;else if(B.nextSibling&&3==B.nextSibling.nodeType)e=B.nextSibling,v=0;else{n.moveToElementText(B.nextSibling?B:e);var w=B.parentNode;B=w.insertBefore(B.ownerDocument.createTextNode(" "),B.nextSibling);n.collapse(!1);w.removeChild(B)}}else n.moveToElementText(e),n.collapse(!0);3==e.nodeType&&(B=l.adjacentNoneTextNode(e),w=B[0],B=B[1],w?(n.moveToElementText(w),
n.collapse(!1),"inherit"!=w.contentEditable&&B++):(n.moveToElementText(e.parentNode),n.collapse(!0),n.move("character",1),n.move("character",-1)),v+=B,0<v&&n.move("character",v)!=v&&console.error("Error when moving!"));return n},decomposeTextRange:function(n){var e=m.getEndPoint(n),v=e[0],B=e[1],w=e[0];e=e[1];n.htmlText.length&&(n.htmlText==n.text?e=B+n.text.length:(e=m.getEndPoint(n,!0),w=e[0],e=e[1]));return[v,B,w,e]},setRange:function(n,e,v,B,w,k){e=m.setEndPoint(n,e,v);n.setEndPoint("StartToStart",
e);if(!k)var p=m.setEndPoint(n,B,w);n.setEndPoint("EndToEnd",p||e);return n}},f=l.W3CRange=d(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=this.startContainer!==this.endContainer?l.getCommonAncestor(this.startContainer,
this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(n,e){e=parseInt(e);if(this.startContainer!==n||this.startOffset!=e)delete this._cachedBookmark,this.startContainer=n,this.startOffset=e,this.endContainer?this._updateInternal():this.setEnd(n,e)},setEnd:function(n,e){e=parseInt(e);if(this.endContainer!==n||this.endOffset!=e)delete this._cachedBookmark,this.endContainer=n,this.endOffset=e,this.startContainer?
this._updateInternal():this.setStart(n,e)},setStartAfter:function(n,e){this._setPoint("setStart",n,e,1)},setStartBefore:function(n,e){this._setPoint("setStart",n,e,0)},setEndAfter:function(n,e){this._setPoint("setEnd",n,e,1)},setEndBefore:function(n,e){this._setPoint("setEnd",n,e,0)},_setPoint:function(n,e,v,B){v=l.getIndex(e,e.parentNode).o;this[n](e.parentNode,v.pop()+B)},_getIERange:function(){var n=(this._body||this.endContainer.ownerDocument.body).createTextRange();m.setRange(n,this.startContainer,
this.startOffset,this.endContainer,this.endOffset,this.collapsed);return n},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var n=this.startContainer,e=this._getIERange();3!==n.nodeType||this.startOffset||this.setStartBefore(n);e.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var n=new f([this.startContainer,this.startOffset,
this.endContainer,this.endOffset]);n._body=this._body;return n},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});h.setObject("dijit.range",l);return l})},"dijit/_editor/html":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/sniff"],function(E,d,h){var l={};d.setObject("dijit._editor.html",l);var m=l.escapeXml=function(f,n){f=f.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,
"\x26gt;").replace(/"/gm,"\x26quot;");n||(f=f.replace(/'/gm,"\x26#39;"));return f};l.getNodeHtml=function(f){var n=[];l.getNodeHtmlHelper(f,n);return n.join("")};l.getNodeHtmlHelper=function(f,n){switch(f.nodeType){case 1:var e=f.nodeName.toLowerCase();if(!e||"/"==e.charAt(0))return"";n.push("\x3c",e);var v=[],B={},w;if(h("dom-attributes-explicit")||h("dom-attributes-specified-flag"))for(var k=0;w=f.attributes[k++];){var p=w.name;"_dj"===p.substr(0,3)||h("dom-attributes-specified-flag")&&!w.specified||
p in B||(w=w.value,("src"==p||"href"==p)&&f.getAttribute("_djrealurl")&&(w=f.getAttribute("_djrealurl")),8===h("ie")&&"style"===p&&(w=w.replace("HEIGHT:","height:").replace("WIDTH:","width:")),v.push([p,w]),B[p]=w)}else{var M=(/^input$|^img$/i.test(f.nodeName)?f:f.cloneNode(!1)).outerHTML;B=M.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi);M=M.substr(0,M.indexOf("\x3e"));E.forEach(B,function(z){if(z){var r=z.indexOf("\x3d");if(0<r&&(z=z.substring(0,r),"_dj"!=z.substr(0,3)))if("src"!=z&&"href"!=z||!f.getAttribute("_djrealurl")){switch(z){case "style":var t=
f.style.cssText.toLowerCase();break;case "class":t=f.className;break;case "width":if("img"===e){(r=/width=(\S+)/i.exec(M))&&(t=r[1]);break}case "height":if("img"===e){(r=/height=(\S+)/i.exec(M))&&(t=r[1]);break}default:t=f.getAttribute(z)}null!=t&&v.push([z,t.toString()])}else v.push([z,f.getAttribute("_djrealurl")])}},this)}v.sort(function(z,r){return z[0]<r[0]?-1:z[0]==r[0]?0:1});for(B=0;w=v[B++];)n.push(" ",w[0],'\x3d"',"string"===typeof w[1]?m(w[1],!0):w[1],'"');switch(e){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":n.push(" /\x3e");
break;case "script":n.push("\x3e",f.innerHTML,"\x3c/",e,"\x3e");break;default:n.push("\x3e"),f.hasChildNodes()&&l.getChildrenHtmlHelper(f,n),n.push("\x3c/",e,"\x3e")}break;case 4:case 3:n.push(m(f.nodeValue,!0));break;case 8:n.push("\x3c!--",m(f.nodeValue,!0),"--\x3e");break;default:n.push("\x3c!-- Element not recognized - Type: ",f.nodeType," Name: ",f.nodeName,"--\x3e")}};l.getChildrenHtml=function(f){var n=[];l.getChildrenHtmlHelper(f,n);return n.join("")};l.getChildrenHtmlHelper=function(f,n){if(f)for(var e=
f.childNodes||f,v=!h("ie")||e!==f,B,w=0;B=e[w++];)v&&B.parentNode!=f||l.getNodeHtmlHelper(B,n)};return l})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),function(E,d,h,l,m,f,n,e,v,B,w,k,p){var M=h("dijit._editor.plugins.LinkDialog",w,{allowUnsafeHtml:!1,linkFilter:[[/</g,"\x26lt;"]],buttonClass:k,useDefaultCommand:!1,
urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=f.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(r){E("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),f.hitch(this,function(t,A,N){var I=this;this.tag="insertImage"==this.command?"img":"a";t=f.delegate(t.getLocalization("dijit","common",this.lang),t.getLocalization("dijit._editor",
"LinkDialog",this.lang));var P=this.dropDown=this.button.dropDown=new A({title:t[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:f.hitch(this,"setValue"),onOpen:function(){I._onOpenDialog();A.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(f.hitch(I,"_onCloseDialog"),0)}});t.urlRegExp=this.urlRegExp;t.id=N.getUniqueId(this.editor.id);this._uniqueId=t.id;this._setContent(P.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
B.substitute(this.linkDialogTemplate,t));P.startup();this._urlInput=N.byId(this._uniqueId+"_urlInput");this._textInput=N.byId(this._uniqueId+"_textInput");this._setButton=N.byId(this._uniqueId+"_setButton");this.own(N.byId(this._uniqueId+"_cancelButton").on("click",f.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",f.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",f.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=f.hitch(this,function(){var S=this._urlInput.get("value");return this._urlRegExp.test(S)||this._emailRegExp.test(S)});this.own(n(P.domNode,"keydown",f.hitch(this,f.hitch(this,function(S){!S||S.keyCode!=m.ENTER||S.shiftKey||S.metaKey||S.ctrlKey||S.altKey||this._setButton.get("disabled")||(P.onExecute(),P.execute(P.get("value")))}))));r()}))},_checkAndFixInput:function(){var r=this,t=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var A=t,N=!1,I=!1;A&&1<A.length&&(A=f.trim(A),0!==A.indexOf("mailto:")&&(0<A.indexOf("/")?-1===A.indexOf("://")&&"/"!==A.charAt(0)&&A.indexOf("./")&&0!==A.indexOf("../")&&r._hostRxp.test(A)&&(N=!0):r._userAtRxp.test(A)&&(I=!0)));N&&r._urlInput.set("value","http://"+A);I&&r._urlInput.set("value","mailto:"+A);r._setButton.set("disabled",!r._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(f.hitch(this,
function(){this.own(n(this.editor.editNode,"mouseup",f.hitch(this,"_onMouseUp")));this.own(n(this.editor.editNode,"dblclick",f.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(r){this.dropDown.set({parserScope:"dojo",content:r})},_checkValues:function(r){r&&r.urlInput&&(r.urlInput=r.urlInput.replace(/"/g,"\x26quot;"));!this.allowUnsafeHtml&&r&&r.textInput&&("function"===typeof this.linkFilter?r.textInput=this.linkFilter(r.textInput):
d.forEach(this.linkFilter,function(t){r.textInput=r.textInput.replace(t[0],t[1])}));return r},_createlinkEnabledImpl:function(){return!0},setValue:function(r){this._onCloseDialog();if(9>e("ie")){var t=p.getSelection(this.editor.window).getRangeAt(0).endContainer;3===t.nodeType&&(t=t.parentNode);t&&t.nodeName&&t.nodeName.toLowerCase()!==this.tag&&(t=this.editor.selection.getSelectedElement(this.tag));t&&t.nodeName&&t.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(t),
this.editor.execCommand("unlink"))}r=this._checkValues(r);this.editor.execCommand("inserthtml",B.substitute(this.htmlTemplate,r));v("a",this.editor.document).forEach(function(A){A.innerHTML||l.has(A,"name")||A.parentNode.removeChild(A)},this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(r){if(r&&r.tagName.toLowerCase()===this.tag){var t=r.getAttribute("_djrealurl")||r.getAttribute("href");var A=r.getAttribute("target")||"_self";var N=r.textContent||
r.innerText;this.editor.selection.selectElement(r,!0)}else N=this.editor.selection.getSelectedText();return{urlInput:t||"",textInput:N||"",targetSelect:A||""}},_onOpenDialog:function(){if(e("ie")){var r=p.getSelection(this.editor.window);if(r.rangeCount){var t=r.getRangeAt(0);var A=t.endContainer;3===A.nodeType&&(A=A.parentNode);A&&A.nodeName&&A.nodeName.toLowerCase()!==this.tag&&(A=this.editor.selection.getSelectedElement(this.tag));if(!A||A.nodeName&&A.nodeName.toLowerCase()!==this.tag)(r=this.editor.selection.getAncestorElement(this.tag))&&
r.nodeName&&r.nodeName.toLowerCase()==this.tag?(A=r,this.editor.selection.selectElement(A)):t.startContainer===t.endContainer&&(r=t.startContainer.firstChild)&&r.nodeName&&r.nodeName.toLowerCase()==this.tag&&(A=r,this.editor.selection.selectElement(A))}}else A=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(A))},_onDblClick:function(r){if(r&&r.target&&(r=r.target,(r.tagName?r.tagName.toLowerCase():
"")===this.tag&&l.get(r,"href"))){var t=this.editor;this.editor.selection.selectElement(r);t.onDisplayChanged();t._updateTimer&&(t._updateTimer.remove(),delete t._updateTimer);t.onNormalizedDisplayChanged();var A=this.button;setTimeout(function(){A.set("disabled",!1);A.loadAndOpenDropDown().then(function(){A.dropDown.focus&&A.dropDown.focus()})},10)}},_onMouseUp:function(){if(e("ff")){var r=this.editor.selection.getAncestorElement(this.tag);if(r){var t=p.getSelection(this.editor.window).getRangeAt(0);
if(t.collapsed&&r.childNodes.length){var A=t.cloneRange();A.selectNodeContents(r.childNodes[r.childNodes.length-1]);A.setStart(r.childNodes[0],0);1!==t.compareBoundaryPoints(A.START_TO_START,A)?t.setStartBefore(r):-1!==t.compareBoundaryPoints(A.END_TO_START,A)&&t.setStartAfter(r)}}}}}),z=h("dijit._editor.plugins.ImgLinkDialog",[M],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(r){if(r&&r.tagName.toLowerCase()===this.tag){var t=r.getAttribute("_djrealurl")||r.getAttribute("src");var A=r.getAttribute("alt");this.editor.selection.selectElement(r,!0)}else A=this.editor.selection.getSelectedText();return{urlInput:t||"",textInput:A||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);
this.editor.onLoadDeferred.then(f.hitch(this,function(){this.own(n(this.editor.editNode,"mousedown",f.hitch(this,"_selectTag")))}))},_selectTag:function(r){r&&r.target&&(r=r.target,(r.tagName?r.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(r))},_checkValues:function(r){r&&r.urlInput&&(r.urlInput=r.urlInput.replace(/"/g,"\x26quot;"));r&&r.textInput&&(r.textInput=r.textInput.replace(/"/g,"\x26quot;"));return r},_onDblClick:function(r){if(r&&r.target&&(r=r.target,(r.tagName?
r.tagName.toLowerCase():"")===this.tag&&l.get(r,"src"))){var t=this.editor;this.editor.selection.selectElement(r);t.onDisplayChanged();t._updateTimer&&(t._updateTimer.remove(),delete t._updateTimer);t.onNormalizedDisplayChanged();var A=this.button;setTimeout(function(){A.set("disabled",!1);A.loadAndOpenDropDown().then(function(){A.dropDown.focus&&A.dropDown.focus()})},10)}}});w.registry.createLink=function(r){var t={command:"createLink",allowUnsafeHtml:"allowUnsafeHtml"in r?r.allowUnsafeHtml:!1};
"linkFilter"in r&&(t.linkFilter=r.linkFilter);return new M(t)};w.registry.insertImage=function(){return new z({command:"insertImage"})};M.ImgLinkDialog=z;return M})},"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(E,d,h,l,m,f){var n=h("dijit._editor.plugins.TextColor",m,{buttonClass:f,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;
this.inherited(arguments);var e=this;this.button.loadDropDown=function(v){function B(w){e.button.dropDown=new w({dir:e.editor.dir,ownerDocument:e.editor.ownerDocument,value:e.value,onChange:function(k){e.editor.execCommand(e.command,k)},onExecute:function(){e.editor.execCommand(e.command,this.get("value"))}});v()}"string"==typeof e.colorPicker?E([e.colorPicker],B):B(e.colorPicker)}},updateState:function(){var e=this.editor,v=this.command;if(e&&e.isLoaded&&v.length){if(this.button){var B=this.get("disabled");
this.button.set("disabled",B);if(B)return;try{var w=e.queryCommandValue(v)||""}catch(k){w=""}}""==w&&(w="#000000");"transparent"==w&&(w="#ffffff");"string"==typeof w?-1<w.indexOf("rgb")&&(w=d.fromRgb(w).toHex()):(w=((w&255)<<16|w&65280|(w&16711680)>>>16).toString(16),w="#000000".slice(0,7-w.length)+w);this.value=w;(e=this.button.dropDown)&&e.get&&w!==e.get("value")&&e.set("value",w,!1)}}});m.registry.foreColor=function(e){return new n(e)};m.registry.hiliteColor=function(e){return new n(e)};return n})},
"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),function(E,d,h,l,m,f,n,e,v,B,w,k,p,M,z,r,t){E=E([B,w],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,
templateString:r,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},_layerEditingCap:{},constructor:function(A,N){d.mixin(this,t.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);
this._uploadField_connect=h.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=h.connect(this._uploadField,"onfocus",d.hitch(this,function(A){z.hide(this._attachmentError)}))},destroy:function(){l.forEach(this._aeConnects,h.disconnect);h.disconnect(this._uploadField_connect);h.disconnect(this._uploadFieldFocus_connect);this.inherited(arguments)},showAttachments:function(A,N){this._attachmentList.innerHTML=this.NLS_none;
this._uploadField.value="";l.forEach(this.domNode.children,function(I,P){z.show(I)});z.hide(this._attachmentError);A&&(this._featureLayer=A.getLayer()||N)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=
this._featureLayer.getEditCapabilities({feature:A}).canUpdate,this._oid=A.attributes[this._featureLayer.objectIdField],this._getAttachments(A)):N&&N.getEditCapabilities()||(z.hide(this._uploadForm),l.forEach(this.domNode.children,function(I,P){z.hide(I)})))},_getAttachments:function(A){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,d.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){z.hide(this._attachmentError);
this._featureLayer&&this._featureLayer.addAttachment?(z.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,d.hitch(this,"_onAddAttachmentComplete"),d.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(A,N){this._tempUpload&&(z.show(this._attachmentProgress),N.addAttachment(A,this._tempUpload,d.hitch(this,"_onAddAttachmentComplete"),d.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(A,
N){z.show(this._attachmentProgress);this._featureLayer.deleteAttachments(A,[N],d.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(A){var N=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?(N=this._listHtml+this._endHtml,this._uploadForm.style.display=
"none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(N=this._listHtml+this._endHtml);var I=this._attachmentList;A=l.map(A,d.hitch(this,function(P){return M.substitute({href:P.url,name:P.name,oid:P.objectId,attid:P.id},N)}));I.innerHTML=A.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(A){z.hide(this._attachmentProgress.domNode);var N=this._attachmentList,I=this._uploadField,P=I.value,S=P.lastIndexOf("\\");
-1<S&&(P=P.substring(S+1,P.length));P=P.replace(/ /g,"_");S=e.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()});var Q=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(Q=this._listHtml+this._endHtml);A=M.substitute({href:this._featureLayer._url.path+"/"+A.objectId+"/attachments/"+A.attachmentId+(S?"?"+S:""),name:P,oid:A.objectId,attid:A.attachmentId},
Q);N.innerHTML=N.innerHTML==this.NLS_none?A:N.innerHTML+A;this._updateConnects();I.value=""},_onAddAttachmentError:function(A){z.hide(this._attachmentProgress.domNode);if(A){var N=this.NLS_error,I=this._attachmentError;M.isDefined(A.code)&&400===A.code&&(N=this.NLS_fileNotSupported);v.set(I,"innerHTML",N);z.show(I)}},_onDeleteAttachmentComplete:function(A){z.hide(this._attachmentProgress.domNode);var N=this._attachmentList;l.every(A,function(I){return I.success})&&(m.query("#node_"+A[0].objectId+
"_"+A[0].attachmentId).orphan(),N.children&&N.children.length||(N.innerHTML=this.NLS_none))},_updateConnects:function(){l.forEach(this._aeConnects,h.disconnect);m.query(".deleteAttachment").forEach(function(A){this._aeConnects.push(h.connect(A,"onclick",d.hitch(this,"_deleteAttachment",this._oid,A.id)))},this)}});f("extend-esri")&&d.setObject("dijit.editing.AttachmentEditor",E,p);return E})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(E,d,h,l,m,f,n,e){return d("dijit.ProgressBar",[f,n],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:e,_indeterminateHighContrastImagePath:E.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(v){var B="rtl"==v.toLowerCase();h.toggle(this.domNode,"dijitProgressBarRtl",B);h.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&B);this.inherited(arguments)},update:function(v){l.mixin(this,v||{});v=this.internalProgress;var B=this.domNode,w=1;this.indeterminate?B.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(w=Math.min(parseFloat(this.progress)/100,1),this.progress=w*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),w=this.maximum?this.progress/this.maximum:0),B.setAttribute("aria-valuenow",this.progress));B.setAttribute("aria-labelledby",this.labelNode.id);B.setAttribute("aria-valuemin",0);B.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(w);h.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);h.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());v.style.width=100*w+"%";this.onChange()},_setValueAttr:function(v){this._set("value",
v);Infinity==v?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:v})},_setLabelAttr:function(v){this._set("label",v);this.update()},_setIndeterminateAttr:function(v){this._set("indeterminate",v);this.update()},report:function(v){return this.label?this.label:this.indeterminate?"\x26#160;":m.format(v,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(E,d,h,l){var m={};m={findFeatures:function(f,n,e){var v=n.objectIdField;n=d.filter(n.graphics,function(B){return d.some(f,function(w){return B.attributes[v]===w.objectId})});if(e)e(n);else return n},getSelection:function(f){var n=[];d.forEach(f,function(e){e=e.getSelectedFeatures();d.forEach(e,function(v){n.push(v)})});return n},sortFeaturesById:function(f,n){var e=d.map(f,function(v){return v.featureLayer});n.sort(function(v,B){var w=v.getLayer(),k=B.getLayer();if(!w)return-1;if(!k)return 1;
var p=d.indexOf(e,w);k=d.indexOf(e,k);p-=k;p||(w=w.objectIdField,p=v.attributes[w]-B.attributes[w]);return p});return n}};h("extend-esri")&&E.setObject("dijit.editing.Util.LayerHelper",m,l);return m})},"dojox/date/islamic":function(){define(["dojox/main","dojo/_base/lang","dojo/date","./islamic/Date"],function(E,d,h,l){var m=d.getObject("date.islamic",!0,E);m.getDaysInMonth=function(f){return f.getDaysInIslamicMonth(f.getMonth(),f.getFullYear())};m.compare=function(f,n,e){f instanceof l&&(f=f.toGregorian());
n instanceof l&&(n=n.toGregorian());return h.compare.apply(null,arguments)};m.add=function(f,n,e){var v=new l(f);switch(n){case "day":v.setDate(f.getDate()+e);break;case "weekday":var B=f.getDay();if(5>B+e&&0<B+e)v.setDate(f.getDate()+e);else{var w=n=0;5==B?(B=4,w=0<e?-1:1):6==B&&(B=4,w=0<e?-2:2);B=0<e?5-B-1:-B;var k=e-B,p=parseInt(k/5);0!=k%5&&(n=0<e?2:-2);n=n+7*p+k%5+B;v.setDate(f.getDate()+n+w)}break;case "year":v.setFullYear(f.getFullYear()+e);break;case "week":e*=7;v.setDate(f.getDate()+e);break;
case "month":f=f.getMonth();v.setMonth(f+e);break;case "hour":v.setHours(f.getHours()+e);break;case "minute":v._addMinutes(e);break;case "second":v._addSeconds(e);break;case "millisecond":v._addMilliseconds(e)}return v};m.difference=function(f,n,e){n=n||new l;e=e||"day";var v=n.getFullYear()-f.getFullYear(),B=1;switch(e){case "weekday":v=Math.round(m.difference(f,n,"day"));B=parseInt(m.difference(f,n,"week"));if(0==v%7)v=5*B;else{e=0;var w=f.getDay(),k=n.getDay();B=parseInt(v/7);n=v%7;f=new l(f);
f.setDate(f.getDate()+7*B);f=f.getDay();if(0<v)switch(!0){case 5==w:e=-1;break;case 6==w:e=0;break;case 5==k:e=-1;break;case 6==k:e=-2;break;case 5<f+n:e=-2}else if(0>v)switch(!0){case 5==w:e=0;break;case 6==w:e=1;break;case 5==k:e=2;break;case 6==k:e=1;break;case 0>f+n:e=2}v=v+e-2*B}B=v;break;case "year":B=v;break;case "month":e=n.toGregorian()>f.toGregorian()?n:f;w=n.toGregorian()>f.toGregorian()?f:n;B=e.getMonth();k=w.getMonth();if(0==v)B=e.getMonth()-w.getMonth();else for(B=12-k+B,v=w.getFullYear()+
1,e=e.getFullYear(),v;v<e;v++)B+=12;n.toGregorian()<f.toGregorian()&&(B=-B);break;case "week":B=parseInt(m.difference(f,n,"day")/7);break;case "day":B/=24;case "hour":B/=60;case "minute":B/=60;case "second":B/=1E3;case "millisecond":B*=n.toGregorian().getTime()-f.toGregorian().getTime()}return Math.round(B)};return m})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(E,d,h){var l=d("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,
_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var m=arguments.length;m?1==m?(m=arguments[0],"number"==typeof m&&(m=new Date(m)),m instanceof Date?this.fromGregorian(m):""==m?this._date=new Date(""):(this._year=m._year,this._month=m._month,this._date=m._date,this._hours=m._hours,this._minutes=m._minutes,this._seconds=m._seconds,this._milliseconds=m._milliseconds)):3<=m&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=
arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},
setDate:function(m){m=parseInt(m);if(!(0<m&&m<=this.getDaysInIslamicMonth(this._month,this._year))){var f;if(0<m)for(f=this.getDaysInIslamicMonth(this._month,this._year);m>f;m-=f,f=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(f=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=m;f=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:
this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),m+=f}this._date=m;return this},setFullYear:function(m){this._year=+m},setMonth:function(m){this._year+=Math.floor(m/12);this._month=0<m?Math.floor(m%12):Math.floor((m%12+12)%12)},setHours:function(){var m=arguments.length,f=0;1<=m&&(f=parseInt(arguments[0]));2<=m&&(this._minutes=parseInt(arguments[1]));3<=m&&(this._seconds=parseInt(arguments[2]));4==m&&(this._milliseconds=parseInt(arguments[3]));for(;24<=f;)this._date++,m=this.getDaysInIslamicMonth(this._month,
this._year),this._date>m&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=m),f-=24;this._hours=f},_addMinutes:function(m){m+=this._minutes;this.setMinutes(m);this.setHours(this._hours+parseInt(m/60));return this},_addSeconds:function(m){m+=this._seconds;this.setSeconds(m);this._addMinutes(parseInt(m/60));return this},_addMilliseconds:function(m){m+=this._milliseconds;this.setMilliseconds(m);this._addSeconds(parseInt(m/1E3));return this},setMinutes:function(m){this._minutes=
m%60;return this},setSeconds:function(m){this._seconds=m%60;return this},setMilliseconds:function(m){this._milliseconds=m%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";var m=new Date;m.setHours(this._hours);m.setMinutes(this._minutes);m.setSeconds(this._seconds);m.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+m.toTimeString()},toGregorian:function(){var m=this._year;m=Math.floor(this._date+Math.ceil(29.5*this._month)+354*
(m-1)+Math.floor((3+11*m)/30)+this._ISLAMIC_EPOCH-1-.5)+.5;var f=m-this._GREGORIAN_EPOCH,n=Math.floor(f/146097),e=this._mod(f,146097);f=Math.floor(e/36524);var v=this._mod(e,36524);e=Math.floor(v/1461);v=this._mod(v,1461);v=Math.floor(v/365);n=400*n+100*f+4*e+v;4!=f&&4!=v&&n++;f=m-(this._GREGORIAN_EPOCH+365*(n-1)+Math.floor((n-1)/4)-Math.floor((n-1)/100)+Math.floor((n-1)/400));e=this._GREGORIAN_EPOCH-1+365*(n-1)+Math.floor((n-1)/4)-Math.floor((n-1)/100)+Math.floor((n-1)/400)+Math.floor(739/12+(h.isLeapYear(new Date(n,
3,1))?-1:-2)+1);e=m<e?0:h.isLeapYear(new Date(n,3,1))?1:2;f=Math.floor((12*(f+e)+373)/367);e=this._GREGORIAN_EPOCH-1+365*(n-1)+Math.floor((n-1)/4)-Math.floor((n-1)/100)+Math.floor((n-1)/400)+Math.floor((367*f-362)/12+(2>=f?0:h.isLeapYear(new Date(n,f-1,1))?-1:-2)+1);return new Date(n,f-1,m-e+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(m){m=new Date(m);var f=m.getFullYear(),n=m.getMonth(),e=m.getDate();f=this._GREGORIAN_EPOCH-1+365*(f-1)+Math.floor((f-1)/4)+
-Math.floor((f-1)/100)+Math.floor((f-1)/400)+Math.floor((367*(n+1)-362)/12+(2>=n+1?0:h.isLeapYear(m)?-1:-2)+e);f=Math.floor(f)+.5;f-=this._ISLAMIC_EPOCH;n=Math.floor((30*f+10646)/10631);e=Math.ceil((f-29-this._yearStart(n))/29.5);e=Math.min(e,11);this._date=Math.ceil(f-this._monthStart(n,e))+1;this._month=e;this._year=n;this._hours=m.getHours();this._minutes=m.getMinutes();this._seconds=m.getSeconds();this._milliseconds=m.getMilliseconds();this._day=m.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},
_yearStart:function(m){return 354*(m-1)+Math.floor((3+11*m)/30)},_monthStart:function(m,f){return Math.ceil(29.5*f)+354*(m-1)+Math.floor((3+11*m)/30)},_civilLeapYear:function(m){return 11>(14+11*m)%30},getDaysInIslamicMonth:function(m,f){var n=0;n=29+(m+1)%2;11==m&&this._civilLeapYear(f)&&n++;return n},_mod:function(m,f){return m-f*Math.floor(m/f)}});l.getDaysInIslamicMonth=function(m){return(new l).getDaysInIslamicMonth(m.getMonth(),m.getFullYear())};return l})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),
function(E,d,h,l,m,f,n,e,v){function B(z,r,t,A,N){return N.replace(/([a-z])\1*/ig,function(I){var P=I.charAt(0);I=I.length;var S=["abbr","wide","narrow"];switch(P){case "G":var Q=r.eraAbbr[0];break;case "y":Q=String(z.getFullYear());break;case "M":Q=z.getMonth();if(3>I){Q+=1;var F=!0}else P=["months-format",S[I-3]].join("-"),Q=r[P][Q];break;case "d":Q=z.getDate(!0);F=!0;break;case "E":Q=z.getDay();3>I?(Q+=1,F=!0):(P=["days-format",S[I-3]].join("-"),Q=r[P][Q]);break;case "a":Q=12>z.getHours()?"am":
"pm";Q=r["dayPeriods-format-wide-"+Q];break;case "h":case "H":case "K":case "k":F=z.getHours();switch(P){case "h":Q=F%12||12;break;case "H":Q=F;break;case "K":Q=F%12;break;case "k":Q=F||24}F=!0;break;case "m":Q=z.getMinutes();F=!0;break;case "s":Q=z.getSeconds();F=!0;break;case "S":Q=Math.round(z.getMilliseconds()*Math.pow(10,I-3));F=!0;break;case "z":if(Q=l.getTimezoneName(z.toGregorian()))break;I=4;case "Z":Q=z.toGregorian().getTimezoneOffset();Q=[0>=Q?"+":"-",n.pad(Math.floor(Math.abs(Q)/60),2),
n.pad(Math.abs(Q)%60,2)];4==I&&(Q.splice(0,0,"GMT"),Q.splice(3,0,":"));Q=Q.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+N);}F&&(Q=n.pad(Q,I));return Q})}function w(z,r,t,A){var N=function(S){return S};r=r||N;t=t||N;A=A||N;var I=z.match(/(''|[^'])+/g),P="'"==z.charAt(0);h.forEach(I,function(S,Q){S?(I[Q]=(P?t:r)(S),P=!P):I[Q]=""});return A(I.join(""))}function k(z,r,t,A){A=f.escapeString(A);m.normalizeLocale(t.locale);return A.replace(/([a-z])\1*/ig,
function(N){var I=N.charAt(0);var P=N.length,S="";t.strict?1<P&&(S="0{"+(P-1)+"}"):S="0?";switch(I){case "y":I="\\d+";break;case "M":I=2<P?"\\S+ ?\\S+":S+"[1-9]|1[0-2]";break;case "d":I="[12]\\d|"+S+"[1-9]|3[01]";break;case "E":I="\\S+";break;case "h":I=S+"[1-9]|1[0-2]";break;case "k":I=S+"\\d|1[01]";break;case "H":I=S+"\\d|1\\d|2[0-3]";break;case "K":I=S+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":I=S+"\\d|[0-5]\\d";break;case "S":I="\\d{"+P+"}";break;case "a":P=t.am||r["dayPeriods-format-wide-am"];
S=t.pm||r["dayPeriods-format-wide-pm"];t.strict?I=P+"|"+S:(I=P+"|"+S,P!=P.toLowerCase()&&(I+="|"+P.toLowerCase()),S!=S.toLowerCase()&&(I+="|"+S.toLowerCase()));break;default:I=".*"}z&&z.push(N);return"("+I+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var p=d.getObject("date.islamic.locale",!0,E);p.format=function(z,r){r=r||{};var t=m.normalizeLocale(r.locale),A=r.formatLength||"short",N=p._getIslamicBundle(t),I=[];t=d.hitch(this,B,z,N,t,r.fullYear);if("year"==r.selector)return z.getFullYear();"time"!=r.selector&&
(z=r.datePattern||N["dateFormat-"+A])&&I.push(w(z,t));"date"!=r.selector&&(r=r.timePattern||N["timeFormat-"+A])&&I.push(w(r,t));return I.join(" ")};p.regexp=function(z){return p._parseInfo(z).regexp};p._parseInfo=function(z){z=z||{};var r=m.normalizeLocale(z.locale);r=p._getIslamicBundle(r);var t=z.formatLength||"short",A=z.datePattern||r["dateFormat-"+t];t=z.timePattern||r["timeFormat-"+t];var N=[];return{regexp:w("date"==z.selector?A:"time"==z.selector?t:"undefined"==typeof t?A:A+" "+t,d.hitch(this,
k,N,r,z)),tokens:N,bundle:r}};p.parse=function(z,r){z=z.replace(/[\u200E\u200F\u202A\u202E]/g,"");r||(r={});var t=p._parseInfo(r),A=t.tokens,N=t.bundle;t=t.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,"");z=(new RegExp("^"+t+"$")).exec(z);m.normalizeLocale(r.locale);if(!z)return null;var I=[1389,0,1,0,0,0,0],P="",S=["abbr","wide","narrow"];h.every(z,function(Q,F){if(!F)return!0;F=A[F-1];var U=F.length;switch(F.charAt(0)){case "y":I[0]=Number(Q);break;case "M":if(2<U){if(F=N["months-format-"+S[U-3]].concat(),
r.strict||(Q=Q.replace(".","").toLowerCase(),F=h.map(F,function(W){return W?W.replace(".","").toLowerCase():W})),Q=h.indexOf(F,Q),-1==Q)return!1}else Q--;I[1]=Number(Q);break;case "D":I[1]=0;case "d":I[2]=Number(Q);break;case "a":F=r.am||N["dayPeriods-format-wide-am"];U=r.pm||N["dayPeriods-format-wide-pm"];if(!r.strict){var R=/\./g;Q=Q.replace(R,"").toLowerCase();F=F.replace(R,"").toLowerCase();U=U.replace(R,"").toLowerCase()}if(r.strict&&Q!=F&&Q!=U)return!1;P=Q==U?"p":Q==F?"a":"";break;case "K":24==
Q&&(Q=0);case "h":case "H":case "k":I[3]=Number(Q);break;case "m":I[4]=Number(Q);break;case "s":I[5]=Number(Q);break;case "S":I[6]=Number(Q)}return!0});z=+I[3];"p"===P&&12>z?I[3]=z+12:"a"===P&&12==z&&(I[3]=0);return new e(I[0],I[1],I[2],I[3],I[4],I[5],I[6])};var M=[];p.addCustomFormats=function(z,r){M.push({pkg:z,name:r})};p._getIslamicBundle=function(z){var r={};h.forEach(M,function(t){t=m.getLocalization(t.pkg,t.name,z);r=d.mixin(r,t)},this);return r};p.addCustomFormats("dojo.cldr","islamic");p.getNames=
function(z,r,t,A,N){A=p._getIslamicBundle(A);z=[z,t,r];if("standAlone"==t){t=z.join("-");var I=A[t];1==I[0]&&(I=void 0)}z[1]="format";return(I||A[z.join("-")]).concat()};p.weekDays=p.getNames("days","wide","format");p.months=p.getNames("months","wide","format");return p})},"widgets/ParcelDrafter/geometryUtils":function(){define("esri/geometry/Point esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils dojo/Deferred dojo/_base/array dojo/_base/lang esri/geometry/geometryEngine esri/SpatialReference esri/geometry/scaleUtils".split(" "),
function(E,d,h,l,m,f,n,e,v,B){var w={canProjectLocally:function(k){k=new E({x:0,y:0,spatialReference:k});return l.canProject(k,new v(4326))?!0:!1},getProjectedGeometry:function(k,p,M){var z=new m;if(l.canProject(k,p)){var r=l.project(k,p);z.resolve(r)}else M.project([k],p,function(t){r=t[0];z.resolve(r)});return z.promise},getDestinationPoint:function(k,p,M){var z=k.x*Math.PI/180,r=p*Math.PI/180;p=Math.sin(r);r=Math.cos(r);var t=.9966471893352243*Math.tan(k.y*Math.PI/180);k=1/Math.sqrt(1+t*t);var A=
t*k,N=Math.atan2(t,r);t=k*p;var I=1-t*t,P=2.7233160610984375E11*I/4.040829998465916E13,S=1+P/16384*(4096+P*(-768+P*(320-175*P))),Q=P/1024*(256+P*(-128+P*(74-47*P))),F=M/(6356752.314245*S),U=0;do{P=Math.cos(2*N+F);var R=Math.sin(F);var W=Math.cos(F);var K=Q*R*(P+Q/4*(W*(-1+2*P*P)-Q/6*P*(-3+4*R*R)*(-3+4*P*P)));var V=F;F=M/(6356752.314245*S)+K}while(1E-12<Math.abs(F-V)&&200>++U);if(200<=U)return console.log("Formula failed to converge"),null;M=A*R-k*W*r;M=Math.atan2(A*W+k*R*r,.9966471893352243*Math.sqrt(t*
t+M*M));I=2.0955066654848088E-4*I*(4+.003352810664775694*(4-3*I));z=(z+(Math.atan2(R*p,k*W-A*R*r)-.003352810664775694*(1-I)*t*(F+I*R*(P+I*W*(-1+2*P*P))))+3*Math.PI)%(2*Math.PI)-Math.PI;M=180*M/Math.PI;z=180*z/Math.PI;return new E(z,M,new v(4326))},getInverseCalculations:function(k,p){var M=p.x*Math.PI/180-k.x*Math.PI/180,z=.9966471893352243*Math.tan(k.y*Math.PI/180);k=1/Math.sqrt(1+z*z);z*=k;var r=.9966471893352243*Math.tan(p.y*Math.PI/180);p=1/Math.sqrt(1+r*r);r*=p;var t=M,A=0;do{var N=Math.sin(t);
var I=Math.cos(t);var P=p*N*p*N+(k*r-z*p*I)*(k*r-z*p*I);P=Math.sqrt(P);if(0==P)return{distance:0,initialBearing:0,finalBearing:0};var S=z*r+k*p*I;var Q=Math.atan2(P,S);var F=k*p*N/P;var U=1-F*F;var R=S-2*z*r/U;isNaN(R)&&(R=0);var W=2.0955066654848088E-4*U*(4+.003352810664775694*(4-3*U));var K=t;t=M+.003352810664775694*(1-W)*F*(Q+W*P*(R+W*S*(-1+2*R*R)))}while(1E-12<Math.abs(t-K)&&200>++A);if(200<=A)return null;t=2.7233160610984375E11*U/4.040829998465916E13;A=t/1024*(256+t*(-128+t*(74-47*t)));M=Math.atan2(p*
N,k*r-z*p*I);k=Math.atan2(k*N,-z*p+k*r*I);M=(M+2*Math.PI)%(2*Math.PI);k=(k+2*Math.PI)%(2*Math.PI);z=Number((6356752.314245*(1+t/16384*(4096+t*(-768+t*(320-175*t))))*(Q-A*P*(R+A/4*(S*(-1+2*R*R)-A/6*R*(-3+4*P*P)*(-3+4*R*R))))).toFixed(3));M=180*M/Math.PI;k=180*k/Math.PI;return{distance:z,initialBearing:M,finalBearing:k}},getLineBetweenPoints:function(k){var p,M=[];f.forEach(k,n.hitch(this,function(z){M.push([w.removeNegativeExponents(z.x),w.removeNegativeExponents(z.y)])}));0<M.length&&(p=new d({paths:[M],
spatialReference:{wkid:4326}}));return p},getAngleBetweenPoints:function(k,p){k=w.getInverseCalculations(k,p);return null===k?0:k.initialBearing},getDistanceBetweenPoints:function(k,p){k=w.getInverseCalculations(k,p);return null===k?0:k.distance},getLengthOfGeometry:function(k){return(k=e.simplify(k))?e.geodesicLength(k,9001):0},getAreaOfGeometry:function(k){k=e.simplify(k);var p={};k?(p.acres=e.geodesicArea(k,109402),p.squareMeters=e.geodesicArea(k,109404),p.squareFeet=e.geodesicArea(k,109405),p.squareUSSurveyFeet=
e.geodesicArea(k,109406)):(p.acres=0,p.squareMeters=0,p.squareFeet=0,p.squareUSSurveyFeet=0);return p},getPolyLineFromPaths:function(k){var p;var M=new d(new v({wkid:4326}));for(p=0;p<k.length;p++)M.addPath(k[p]);return M},getPolygonFromPolyLines:function(k,p,M,z){var r,t;var A=[];z=z?new h(new v(z)):new h(new v({wkid:4326}));for(r=0;r<k.length;r++)for(t=0;t<k[r].length;t++)A.push(k[r][t]);p?A.push(n.clone(A[0])):M&&(A[A.length-1][0]=A[0][0],A[A.length-1][1]=A[0][1]);z.isClockwise(A)||A.reverse();
z.addRing(A);return z},getPointsForArc:function(k,p,M,z){var r=[];var t=p-k;p=parseInt(t,10);0>=p&&(p=1);var A=Math.abs(t)/Math.abs(p);if(0<A)for(t=0;t<Math.abs(p)+1;t++){var N=k+A*t;(N=w.getDestinationPoint(M,N,Math.abs(z)))&&r.push(N)}return r},getArcParam:function(k){var p={};0>k.distance?0>k.radius?(p.bearing=k.initBearing+90,p.centerPoint=w.getDestinationPoint(k.chordMidPoint,p.bearing,k.centerAndChordDistance),p.startAngle=w.getAngleBetweenPoints(p.centerPoint,k.chordEndPoint),p.endAngle=w.getAngleBetweenPoints(p.centerPoint,
k.chordStartPoint)):(p.bearing=k.initBearing-90,p.centerPoint=w.getDestinationPoint(k.chordMidPoint,p.bearing,k.centerAndChordDistance),p.startAngle=w.getAngleBetweenPoints(p.centerPoint,k.chordStartPoint),p.endAngle=w.getAngleBetweenPoints(p.centerPoint,k.chordEndPoint)):0<k.radius?(p.bearing=k.initBearing+90,p.centerPoint=w.getDestinationPoint(k.chordMidPoint,p.bearing,k.centerAndChordDistance),p.startAngle=w.getAngleBetweenPoints(p.centerPoint,k.chordStartPoint),p.endAngle=w.getAngleBetweenPoints(p.centerPoint,
k.chordEndPoint)):(p.bearing=k.initBearing-90,p.centerPoint=w.getDestinationPoint(k.chordMidPoint,p.bearing,k.centerAndChordDistance),p.startAngle=w.getAngleBetweenPoints(p.centerPoint,k.chordEndPoint),p.endAngle=w.getAngleBetweenPoints(p.centerPoint,k.chordStartPoint));return p},removeNegativeExponents:function(k){return 1<k.toString().toLowerCase().split("e-").length?0:k},getChordLengthFromArcLength:function(k,p){k=Math.abs(k);var M=Math.PI*Math.abs(p);p=Math.abs(p)*Math.sin(Math.abs(k)/Math.abs(p)/
2);return k<=M?2*p:-2*p},getArcLengthFromChordLength:function(k,p){var M=Math.abs(k);p=Math.abs(p);M=2*Math.asin(M/(2*p))*p;0>k&&(M=2*Math.PI*p-M);return M},chordBearingToTangentBearing:function(k,p,M){var z=180/Math.PI*Math.acos(Math.abs(M)/2/Math.abs(p));p/=Math.abs(p);k=k+90*p-M/Math.abs(M)*p*z;return w.removeNegativeExponents(0>k?k+360:360<=k?k%360:k)},tangentBearingToChordBearing:function(k,p,M){var z=180/Math.PI*Math.acos(Math.abs(M)/2/Math.abs(p));p/=Math.abs(p);k=k+90*p-M/Math.abs(M)*p*z;
return w.removeNegativeExponents(0>k?k+360:360<=k?k%360:k)},getUnitValueForSR:function(k){switch(B.getUnitValueForSR(k)){case 1:return"meters";case 111194.87428468118:return"meters";case .3048:return"feet";case .3048006096:case .3048006096012192:return"uSSurveyFeet"}},getRotationAngleBetweenPoints:function(k,p){k=l.project(k,new v(102100));p=l.project(p,new v(102100));var M=p.x-k.x;k=p.y-k.y;p=180*Math.atan2(Math.abs(M),Math.abs(k))/Math.PI;var z=180*Math.atan2(Math.abs(k),Math.abs(M))/Math.PI;M=
w.removeNegativeExponents(M);k=w.removeNegativeExponents(k);p=w.removeNegativeExponents(p);z=w.removeNegativeExponents(z);if(0===k){if(0===M)return 0;if(0<M)return 90;if(0>M)return 270}else if(0<k){if(0===M)return 0;if(0<M)return p;if(0>M)return 270+z}else if(0>k){if(0===M)return 180;if(0<M)return 90+z;if(0>M)return 180+p}},getScaleDistanceBetweenPoints:function(k,p){k=l.project(k,new v(102100));p=l.project(p,new v(102100));k=e.distance(k,p,9001);return w.removeNegativeExponents(k)}};return w})},
"widgets/ParcelDrafter/MapTooltipHandler":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/Evented dojo/dom-style dojo/dom-construct dojo/on".split(" "),function(E,d,h,l,m,f,n){return E([d,l],{baseClass:"jimu-widget-ParcelDrafter-MapTooltipHandler",map:null,handleClickFor:null,_mapTooltip:null,_mapMoveHandler:null,_mapClickHandler:null,_mouseDragHandler:null,constructor:function(e){h.mixin(this,e)},startup:function(){this.handleClickFor||(this.handleClickFor=this.map);
this._createTooltip()},connectEventHandler:function(e){e&&this.updateTooltip(e);this._disableWebMapPopup();this._mapClickHandler=this.own(n(this.handleClickFor,"click",h.hitch(this,function(v){this._clicked(v)})))[0];"ontouchstart"in document.documentElement?m.set(this._mapTooltip,"display","none"):(this._mapMoveHandler=this.own(this.map.on("mouse-move",h.hitch(this,this._onMapMouseMove)))[0],this.own(this.map.on("mouse-out",h.hitch(this,function(){m.set(this._mapTooltip,"display","none")}))))},disconnectEventHandler:function(){this._enableWebMapPopup();
this._mapClickHandler&&this._mapClickHandler.remove();this._mapMoveHandler&&(this._mapMoveHandler.remove(),this._mapTooltip.style.display="none");this.disconnectMouseDragHandler()},connectMouseDragHandler:function(e){e&&this.updateTooltip(e);this._disableWebMapPopup();this._mapClickHandler&&this._mapClickHandler.remove();this.map.disableMapNavigation();this._mouseDragHandler=this.own(this.map.on("mouse-drag",h.hitch(this,function(v){this._onDragging(v)})))[0]},disconnectMouseDragHandler:function(){this._mouseDragHandler&&
(this._mouseDragHandler.remove(),this._mapTooltip.style.display="none");this.map.enableMapNavigation()},_createTooltip:function(){this._mapTooltip=f.create("div",{"class":"esriCTMapTooltip",innerHTML:this.toolTipText},this.map.container);m.set(this._mapTooltip,"position","fixed");m.set(this._mapTooltip,"display","none")},_enableWebMapPopup:function(){this.map&&(this.map.infoWindow.hide(),this.map.setInfoWindowOnClick(!0))},_disableWebMapPopup:function(){this.map&&(this.map.infoWindow.hide(),this.map.setInfoWindowOnClick(!1))},
_onMapMouseMove:function(e){if(e.clientX||e.pageY){var v=e.clientX;var B=e.clientY}else v=e.clientX+document.body.scrollLeft-document.body.clientLeft,B=e.clientY+document.body.scrollTop-document.body.clientTop;m.set(this._mapTooltip,"display","none");m.set(this._mapTooltip,{left:v+15+"px",top:B+"px"});m.set(this._mapTooltip,"display","");this._onMoving(e)},_clicked:function(e){this.emit("clicked",e)},_onDragging:function(e){this.emit("dragging",e)},_onMoving:function(e){this.emit("moving",e)},updateTooltip:function(e){this.toolTipText=
e;this._mapTooltip.innerHTML=this.toolTipText}})})},"widgets/ParcelDrafter/layerUtils":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/_base/array","dojo/_base/lang"],function(E,d,h,l){return E([d],{map:null,getPopupInfo:!0,getRenderer:!0,postCreate:function(){},getLayerDetailsFromMap:function(m,f,n){var e={},v;this.map&&this.map.webMapResponse&&this.map.webMapResponse.itemInfo&&this.map.webMapResponse.itemInfo.itemData&&this.map.webMapResponse.itemInfo.itemData.operationalLayers&&
h.forEach(this.map.webMapResponse.itemInfo.itemData.operationalLayers,l.hitch(this,function(B){B.layerObject&&("ArcGISMapServiceLayer"===B.layerType||"ArcGISTiledMapServiceLayer"===B.layerType?(v=n&&n.substring(0,n.lastIndexOf("_")),v&&B.id!==v||(e.isMapServer=!0,m.substring(0,m.length-1)===B.url&&(h.forEach(B.resourceInfo.layers,l.hitch(this,function(w){w.id===parseInt(f,10)&&(e.title=w.name)})),h.forEach(B.layers,l.hitch(this,function(w){w.id===parseInt(f,10)&&(w.name&&(e.title=w.name),this.getPopupInfo&&
(e.popupInfo=w.popupInfo),w.layerDefinition&&(w.layerDefinition.definitionExpression&&(e.definitionExpression=w.layerDefinition.definitionExpression),this.getRenderer&&w.layerDefinition.drawingInfo&&w.layerDefinition.drawingInfo.renderer&&(e.renderer=w.layerDefinition.drawingInfo.renderer)))}))))):n&&B.id!==n||B.url.replace(/.*?:\/\//g,"").toLowerCase()!==(m+f).replace(/.*?:\/\//g,"").toLowerCase()||B.id!==n||(e.isMapServer=!1,e.title=B.title,this.getPopupInfo&&(e.popupInfo=B.popupInfo),B.layerDefinition&&
(B.layerDefinition.definitionExpression&&(e.definitionExpression=B.layerDefinition.definitionExpression),this.getRenderer&&B.layerDefinition.drawingInfo&&B.layerDefinition.drawingInfo.renderer&&(e.renderer=B.layerDefinition.drawingInfo.renderer))))}));return e}})})},"widgets/ParcelDrafter/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/ParcelDrafter/PlanSettings.html":'\x3cdiv\x3e\r\n    \x3c!-- Direction or Angle Type Selector --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow"\x3e\r\n        \x3cdiv class\x3d"esriCTDropdownLabel esriCTEllipsis" title\x3d"${nls.planSettings.directionOrAngleTypeLabel}"\r\n        data-a11y-label-id\x3d"directionOrAngleTypeLabel"\x3e\r\n            ${nls.planSettings.directionOrAngleTypeLabel}\x3c/div\x3e\r\n        \x3cselect data-dojo-attach-point\x3d"directionOrAngleType" style\x3d"width: 100%" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n        data-a11y-label-by\x3d"directionOrAngleTypeLabel"\x3e\r\n        \x3c/select\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Direction or Angle Units Selector --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow"\x3e\r\n        \x3cdiv class\x3d"esriCTDropdownLabel esriCTEllipsis" title\x3d"${nls.planSettings.directionOrAngleUnitsLabel}"\r\n        data-a11y-label-id\x3d"directionOrAngleUnitsLabel"\x3e\r\n            ${nls.planSettings.directionOrAngleUnitsLabel}\x3c/div\x3e\r\n        \x3cselect data-dojo-attach-point\x3d"directionOrAngleUnits" style\x3d"width: 100%" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n        data-a11y-label-by\x3d"directionOrAngleUnitsLabel"\x3e\r\n        \x3c/select\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Distance and Length Units Selector --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow"\x3e\r\n        \x3cdiv class\x3d"esriCTDropdownLabel esriCTEllipsis" title\x3d"${nls.planSettings.distanceAndLengthUnitsLabel}"\r\n        data-a11y-label-id\x3d"distanceAndLengthUnitsLabel"\x3e\r\n            ${nls.planSettings.distanceAndLengthUnitsLabel}\x3c/div\x3e\r\n        \x3cselect data-dojo-attach-point\x3d"distanceAndLengthUnits" style\x3d"width: 100%" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n        data-a11y-label-by\x3d"distanceAndLengthUnitsLabel"\x3e\r\n        \x3c/select\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Area Units Selector--\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow"\x3e\r\n        \x3cdiv class\x3d"esriCTDropdownLabel esriCTEllipsis" title\x3d"${nls.planSettings.areaUnitsLabel}"\r\n        data-a11y-label-id\x3d"areaUnitsLabel"\x3e\r\n            ${nls.planSettings.areaUnitsLabel}\x3c/div\x3e\r\n        \x3cselect data-dojo-attach-point\x3d"areaUnits" style\x3d"width: 100%" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n        data-a11y-label-by\x3d"areaUnitsLabel"\x3e\r\n        \x3c/select\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Circular Curve Parameters Selector --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow"\x3e\r\n        \x3cdiv class\x3d"esriCTDropdownLabel esriCTEllipsis " title\x3d"${nls.planSettings.circularCurveParameters}"\r\n        data-a11y-label-id\x3d"circularCurveParameters"\x3e\r\n            ${nls.planSettings.circularCurveParameters}\x3c/div\x3e\r\n        \x3cselect data-dojo-attach-point\x3d"circularCurveParameters" style\x3d"width: 100%" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n        data-a11y-label-by\x3d"circularCurveParameters"\x3e\r\n        \x3c/select\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/ParcelDrafter/XYInput.html":'\x3cdiv class\x3d"esriCTAlignCenter" data-dojo-attach-point\x3d"newTraverseXYInputNode"\x3e\r\n  \x3cdiv class\x3d"xyRowWrapper" data-dojo-attach-point\x3d"xRowWrapper"\x3e\r\n    X:\r\n    \x3cdiv data-dojo-attach-point\x3d"newTraverseX" data-dojo-type\x3d"dijit/form/ValidationTextBox"\r\n      data-dojo-props\x3d"intermediateChanges:true,regExp:\'^[+-]?\\\\d+(\\\\.\\\\d+)?$\'" trim\x3d"true" required\x3d"true"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"xyRowWrapper" data-dojo-attach-point\x3d"yRowWrapper"\x3e\r\n    Y:\r\n    \x3cdiv data-dojo-attach-point\x3d"newTraverseY" data-dojo-type\x3d"dijit/form/ValidationTextBox"\r\n      data-dojo-props\x3d"intermediateChanges:true,regExp:\'^[+-]?\\\\d+(\\\\.\\\\d+)?$\'" trim\x3d"true" required\x3d"true"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"jimu-btn jimu-trailing-margin1 jimu-state-disabled" title\x3d"${nls.newTraverseButtonLabel}"\r\n    data-dojo-attach-point\x3d"xyStartButton" tabindex\x3d"-1" role\x3d"button" aria-label\x3d"${nls.newTraverseButtonLabel}"\x3e\r\n    ${nls.newTraverseButtonLabel}\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/ParcelDrafter/NewTraverse.html":'\x3cdiv\x3e\r\n    \x3c!-- Traverse grid container--\x3e\r\n    \x3cdiv class\x3d"esriCTNewTraverseContainer"\x3e\r\n        \x3c!-- Traverse grid title--\x3e\r\n        \x3cdiv class\x3d"esriCTNewTraverseLabelDiv"\x3e\r\n            \x3cdiv class\x3d"esriCTGridEmptyLabel"\x3e\r\n                \x26nbsp\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTGridLabels esriCTEllipsis esriCTGridBearingLabel" title\x3d"${nls.traverseSettings.bearingLabel}"\x3e\r\n                ${nls.traverseSettings.bearingLabel}\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTGridLabels esriCTEllipsis" title\x3d"${nls.traverseSettings.lengthLabel}"\x3e\r\n                ${nls.traverseSettings.lengthLabel}\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTGridLabels esriCTEllipsis" title\x3d"${nls.traverseSettings.radiusLabel}"\x3e\r\n                ${nls.traverseSettings.radiusLabel}\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Traverse grid items--\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"traverseGrid" class\x3d"esriCTTraverseGrid"\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Traverse grid initial entry row--\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"traverseEntryNode" class\x3d"esriCTEntrtyNodeContent esriCTRow"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"lineSymbolNode" class\x3d"esriCTSymbolContainer"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"bearingNode" class\x3d"esriCTBearingRow" data-dojo-type\x3d"dijit/form/ValidationTextBox" aria-label\x3d"${nls.traverseSettings.bearingLabel}"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"lengthNode" data-dojo-type\x3d"dijit/form/ValidationTextBox" aria-label\x3d"${nls.traverseSettings.lengthLabel}"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"radiusNode" data-dojo-type\x3d"dijit/form/ValidationTextBox" aria-label\x3d"${nls.traverseSettings.radiusLabel}"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTAddRow"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"addButton" class\x3d"esriCTAddIcon"\r\n                title\x3d"${nls.traverseSettings.addButtonTitle}" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.traverseSettings.addButtonTitle}"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Traverse grid tools container--\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseTool"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseToolContainer"\x3e\r\n                \x3c!-- Update rotation point tool--\x3e\r\n                \x3cdiv class\x3d"esriCTTraverseToolIcons ecriCTUpdateRotationPointIcon esriCTCursorPointer" title\x3d"${nls.planSettings.updateRotationPointTooltipText}"\r\n                    data-dojo-attach-point\x3d"updateRotationPointNode" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.planSettings.updateRotationPointTooltipText}" aria-pressed\x3d"false"\x3e\r\n                \x3c/div\x3e\r\n                \x3c!-- Screen digitization tool--\x3e\r\n                \x3cdiv class\x3d"esriCTTraverseToolIcons ecriCTLocationIcon esriCTCursorPointer" title\x3d"${nls.planSettings.onScreenDigitizationTooltipText}"\r\n                    data-dojo-attach-point\x3d"screenDigitizationNode" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.planSettings.onScreenDigitizationTooltipText}" aria-pressed\x3d"false"\x3e\r\n                \x3c/div\x3e\r\n                \x3c!-- Zoom tool--\x3e\r\n                \x3cdiv class\x3d"esriCTHidden esriCTTraverseToolIcons ecriCTZoomToIcon esriCTCursorPointer" title\x3d"${nls.planSettings.zoomToLocationTooltipText}"\r\n                    data-dojo-attach-point\x3d"zoomToNode" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.planSettings.zoomToLocationTooltipText}"\x3e\r\n                \x3c/div\x3e\r\n                \x3c!-- Expand/Collapse grid tool--\x3e\r\n                \x3cdiv class\x3d"esriCTHidden  esriCTTraverseToolIcons esriCTCollapse esriCTCursorPointer" title\x3d"${nls.planSettings.collapseGridTooltipText}"\r\n                    data-dojo-attach-point\x3d"expandCollapseNode" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.planSettings.collapseGridTooltipText}"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Misclose details container--\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"misCloseDetailsNode"\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Parcel tools (rotation/scale) container--\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"parcelToolsNode"\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Parcel info (polygon layer fields) \x26 save/cancle button container--\x3e\r\n    \x3cdiv class\x3d"esriCTPlanInfoNode" data-dojo-attach-point\x3d"planInfoNode"\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/ParcelDrafter/MiscloseDetails.html":'\x3cdiv class\x3d"esriCTTraverseDetailContainer esriCTFullWidth" data-dojo-attach-point\x3d"traverseDetailsContainer"\x3e\r\n    \x3c!-- Message div shown when misclose is not calculated --\x3e\r\n    \x3cdiv class\x3d"esriCTTraverseResultContainer esriCTEllipsis"\r\n    data-dojo-attach-point\x3d"noMiscloseCalculated"\x3e\r\n        ${nls.traverseSettings.noMiscloseCalculated}\r\n    \x3c/div\x3e\r\n    \x3c!-- Misclose details container --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTHidden" data-dojo-attach-point\x3d"miscloseDetailsContainer"\x3e\r\n        \x3c!-- Misclose Bearing Container --\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseResultContainer" data-dojo-attach-point\x3d"traverseMiscloseBearingNode"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis" title\x3d"${nls.traverseSettings.traverseMiscloseBearing}"\x3e\r\n                ${nls.traverseSettings.traverseMiscloseBearing}:\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv  esriCTEllipsis esriCTTraversedValueDiv" data-dojo-attach-point\x3d"miscloseBearingNode"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Misclose Distance Container --\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseResultContainer" data-dojo-attach-point\x3d"traverseDistanceNode"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis" title\x3d"${nls.traverseSettings.traverseDistance}"\x3e\r\n                ${nls.traverseSettings.traverseDistance}:\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis esriCTTraversedValueDiv"\r\n                data-dojo-attach-point\x3d"miscloseDistanceNode"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTCompassRuleAppliedHintContainer esriCTHidden" tabindex\x3d"0" role\x3d"document" aria-label\x3d"${nls.traverseSettings.compassRuleAppliedHint}"  data-dojo-attach-point\x3d"compassRuleAppliedHint"\r\n                title\x3d"${nls.traverseSettings.compassRuleAppliedHint}"\x3e\r\n                \x3cdiv class\x3d"esriCTCompassRuleAppliedHintIcon"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Misclose Ratio Container --\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseResultContainer" data-dojo-attach-point\x3d"traverseMiscloseRatioNode"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis" title\x3d"${nls.traverseSettings.traverseMiscloseRatio}"\x3e\r\n                ${nls.traverseSettings.traverseMiscloseRatio}:\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis esriCTTraversedValueDiv" data-dojo-attach-point\x3d"miscloseRatioNode"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Accuracy Container --\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseResultContainer" data-dojo-attach-point\x3d"traverseAccuracyNode"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis" title\x3d"${nls.traverseSettings.traverseAccuracy}"\x3e\r\n                ${nls.traverseSettings.traverseAccuracy}:\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis esriCTTraversedValueDiv" data-dojo-attach-point\x3d"accuracyNode"\x3e\r\n                ${nls.traverseSettings.accuracyHigh}\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Stated Area Container --\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseResultContainer esriCTHidden" data-dojo-attach-point\x3d"traverseStatedAreaNode"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis" title\x3d"${nls.traverseSettings.traverseStatedArea}"\x3e\r\n                ${nls.traverseSettings.traverseStatedArea}:\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis esriCTTraversedValueDiv"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"traverseStatedArea" style\x3d"font-weight:normal; width: 100px; height: 25px;" data-dojo-type\x3d"dijit/form/ValidationTextBox" aria-label\x3d"${nls.traverseSettings.traverseStatedArea}"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Calculated Area Container --\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseResultContainer" data-dojo-attach-point\x3d"traverseCalculatedAreaNode"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis" title\x3d"${nls.traverseSettings.traverseCalculatedArea}"\x3e\r\n                ${nls.traverseSettings.traverseCalculatedArea}:\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis esriCTTraversedValueDiv" data-dojo-attach-point\x3d"calculatedAreaNode"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c/div\x3e',
"url:widgets/ParcelDrafter/ParcelTools.html":'\x3cdiv class\x3d"esriCTFullWidth"\x3e\r\n    \x3c!-- Rotation tool container--\x3e\r\n    \x3cdiv class\x3d"esriCTMainPageRow"\x3e\r\n        \x3cdiv class\x3d"esriCTRotationButton esriCTButtonIcon esriCTParcelToolButtonIcon esriCTCursorPointer" title\x3d"${nls.parcelTools.rotationToolLabel}"\r\n            data-dojo-attach-point\x3d"rotateButton" tabindex\x3d"0" role\x3d"button"  aria-pressed\x3d"false" aria-label\x3d"${nls.parcelTools.rotationToolLabel}"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTParcelToolButtonLabel esriCTEllipsis" title\x3d"${nls.parcelTools.rotationToolLabel}"\x3e\r\n            ${nls.parcelTools.rotationToolLabel}\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTParcelToolInputNode" data-dojo-type\x3d"dijit/form/NumberTextBox" trim\x3d"true" required\x3d"true" data-dojo-attach-point\x3d"rotationTxt" aria-label\x3d"${nls.parcelTools.rotationToolLabel}"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Scale tool container--\x3e\r\n    \x3cdiv class\x3d"esriCTMainPageRow"\x3e\r\n        \x3cdiv class\x3d"esriCTScaleButton esriCTButtonIcon esriCTParcelToolButtonIcon esriCTCursorPointer" title\x3d"${nls.parcelTools.scaleToolLabel}"\r\n            data-dojo-attach-point\x3d"scaleButton" tabindex\x3d"0" role\x3d"button" aria-pressed\x3d"false" aria-label\x3d"${nls.parcelTools.scaleToolLabel}"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTParcelToolButtonLabel esriCTEllipsis" title\x3d"${nls.parcelTools.scaleToolLabel}"\x3e\r\n            ${nls.parcelTools.scaleToolLabel}\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTParcelToolInputNode" data-dojo-type\x3d"dijit/form/NumberTextBox" trim\x3d"true" required\x3d"true" data-dojo-attach-point\x3d"scaleTxt" aria-label\x3d"${nls.parcelTools.scaleToolLabel}"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/ParcelDrafter/PlanInfo.html":'\x3cdiv class\x3d"esriCTFullWidth"\x3e\r\n    \x3c!-- Parcel Layer Attribute list Parent--\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"parcelLayerRowNode"\x3e\r\n        \x3c!-- Parcel layer attribute list toggle node --\x3e\r\n        \x3cdiv class\x3d"esriCTParcelLayerParent" data-dojo-attach-point\x3d"expandCollapseParentNode"\x3e\r\n            \x3cdiv class\x3d"esriCTParcelLayerContainer esriCTEllipsis" data-dojo-attach-point\x3d"attributeListTitle"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTExpandCollapseParceLayer" data-dojo-attach-point\x3d"expandCollapseNode" tabindex\x3d"0"\r\n                role\x3d"button" aria-label\x3d"${nls.planInfo.showAttributeList}" title\x3d"${nls.planInfo.showAttributeList}"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Parcel Layer Attribute List Section--\x3e\r\n        \x3cdiv class\x3d"esriCTParcelAttributeList esriCTHidden" data-dojo-attach-point\x3d"attributeListNode"\x3e\r\n            \x3c!-- Attribute Inspector --\x3e\r\n            \x3cdiv class\x3d"esriCTAttributeInspectorContainer" data-dojo-attach-point\x3d"attributeInspectorContainer"\x3e\r\n            \x3c/div\x3e\r\n            \x3c!-- Parcel name input container --\x3e\r\n            \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow esriCTHidden" data-dojo-attach-point\x3d"parcelNameRow"\x3e\r\n                \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"parcelName"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3c!-- DocumentType input container --\x3e\r\n            \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow esriCTHidden" data-dojo-attach-point\x3d"documentTypeRow"\x3e\r\n                \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"documentType"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3c!-- Plan name input container --\x3e\r\n            \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow esriCTHidden" data-dojo-attach-point\x3d"planNameRow"\x3e\r\n                \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"planName"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Save/Cancle button container --\x3e\r\n        \x3cdiv class\x3d"esriCTPlanInfoNode"\x3e\r\n            \x3cdiv class\x3d"esriCTPlanInfoButton jimu-btn jimu-trailing-margin1" title\x3d"${nls.common.save}"\r\n                data-dojo-attach-point\x3d"planInfoSaveButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.save}"\x3e\r\n                ${nls.common.save}\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTPlanInfoButton jimu-btn jimu-trailing-margin1 esriCTHidden"\r\n                title\x3d"${nls.common.deleteText}" data-dojo-attach-point\x3d"planInfoDeleteButton" tabindex\x3d"0"\r\n                role\x3d"button" aria-label\x3d"${nls.common.deleteText}"\x3e\r\n                ${nls.common.deleteText}\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTPlanInfoButton jimu-btn" title\x3d"${nls.common.cancel}"\r\n                data-dojo-attach-point\x3d"planInfoCancelButton" tabindex\x3d"0" role\x3d"button"\r\n                aria-label\x3d"${nls.common.cancel}"\x3e\r\n                ${nls.common.cancel}\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/ParcelDrafter/Widget.html":'\x3cdiv style\x3d"height: calc(100% - 10px);" class\x3d"esriCTFullHeight" data-dojo-attach-point\x3d"mainNode"\x3e\r\n    \x3cdiv class\x3d"esriCTFullHeight esriCTFullWidth" data-dojo-attach-point\x3d"widgetMainNode"\x3e\r\n        \x3c!--Main Page Node--\x3e\r\n        \x3cdiv class\x3d"esirCTMainPage" data-dojo-attach-point\x3d"mainPageNode"\x3e\r\n            \x3cdiv class\x3d"esriCTMainPageRow"\x3e\r\n                \x3cdiv class\x3d"esriCTButtonLabel esriCTEllipsis" title\x3d"${nls.newTraverseButtonLabel}"\x3e\r\n                    ${nls.newTraverseButtonLabel}\x3c/div\x3e\r\n                    \x3c!-- code for accessibility --\x3e\r\n                \x3cdiv class\x3d"esriCTNewTraverseButton esriCTButtonIcon esriCTCursorPointer" title\x3d"${nls.newTraverseButtonLabel}" data-dojo-attach-point\x3d"newTraverseButton"\r\n                tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.newTraverseButtonLabel}" aria-pressed\x3d"false"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTMainPageRow"\x3e\r\n                \x3cdiv class\x3d"esriCTButtonLabel esriCTEllipsis" title\x3d"${nls.editTraverseButtonLabel}"\x3e\r\n                    ${nls.editTraverseButtonLabel}\x3c/div\x3e\r\n                    \x3c!-- code for accessibility --\x3e\r\n                \x3cdiv class\x3d"esriCTEditTraverseButton esriCTButtonIcon esriCTCursorPointer" title\x3d"${nls.editTraverseButtonLabel}" data-dojo-attach-point\x3d"editTraverseButton"\r\n                tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.editTraverseButtonLabel}" aria-pressed\x3d"false"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"newTraverseSelectMessageNodeWrapper" class\x3d"esriCTHidden"\x3e\r\n              \x3cdiv class\x3d"esriCTMainPageRow esriCTAlignCenter" data-dojo-attach-point\x3d"newTraverseSelectMessageNode"\x3e\r\n              \x3c/div\x3e\r\n              \x3c!-- XYInput Widget get inserted here --\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!--Traverse Page Node--\x3e\r\n        \x3cdiv class\x3d"esriCTFullHeight esriCTHidden" data-dojo-attach-point\x3d"traversePageNode"\x3e\r\n            \x3cdiv class\x3d"esriCTFullWidth esriCTNewTraverseHeader"\x3e\r\n                \x3cdiv class\x3d"esriCTBackButton esriCTCursorPointer"\x3e\r\n                    \x3cdiv class\x3d"esriCTItemLeftArrow" title\x3d"${nls.common.back}" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.back}" data-dojo-attach-point\x3d"traversePanelBackButton"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTTitleDiv esriCTEllipsis" title\x3d"${nls.newTraverseTitle}"  data-dojo-attach-point\x3d"traverseTitleNode"\x3e\r\n                    ${nls.newTraverseTitle}\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTPlanSettingsIcon esriCTCursorPointer" title\x3d"${nls.planSettings.planSettingsTitle}" data-dojo-attach-point\x3d"planSettingsButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.planSettings.planSettingsTitle}"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseNode" data-dojo-attach-point\x3d"traverseNode"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!--Plan Settings Node--\x3e\r\n        \x3cdiv class\x3d"esriCTHidden esriCTFullHeight" data-dojo-attach-point\x3d"planSettingsPageNode"\x3e\r\n            \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingHeader"\x3e\r\n                \x3cdiv class\x3d"esriCTBackButton esriCTCursorPointer"\x3e\r\n                    \x3cdiv class\x3d"esriCTItemLeftArrow" title\x3d"${nls.common.back}" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.common.back}" data-dojo-attach-point\x3d"planSettingsPanelBackButton"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTTitleDiv esriCTEllipsis" title\x3d"${nls.planSettings.planSettingsTitle}"\x3e\r\n                    ${nls.planSettings.planSettingsTitle}\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTPlanSettingsNode" data-dojo-attach-point\x3d"planSettingsNode"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTWidgetErrorNode esriCTHidden" data-dojo-attach-point\x3d"widgetErrorNode"\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/ParcelDrafter/css/style.css":".esriCTMainContainer{min-width: 222px; height: 100%; -webkit-overflow-scrolling: touch; overflow: hidden;}.esriCTOverridePanelStyle{padding: 15px 0 0 0 !important;}.esriCTMapTooltip{width: 100px; word-wrap: break-word; border: 1px solid #7EABCD; background-color: white; padding: 5px; font-size: 9pt; z-index: 9999; -o-border-radius: 4px; -moz-border-radius: 4px; -webkit-border-radius: 4px; border-radius: 4px;}.jimu-widget-ParcelDrafter .esriCTWidgetErrorNode{padding: 0px 20px;}.jimu-widget-ParcelDrafter .esriCTFullHeight{height: 100%;}.jimu-widget-ParcelDrafter .esriCTFullWidth{width: 100%;}.jimu-widget-ParcelDrafter .esriCTEllipsis{overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-ParcelDrafter .esriCTCursorPointer{cursor: pointer;}.jimu-widget-ParcelDrafter .esriCTCursorDefault{cursor: pointer;}.jimu-widget-ParcelDrafter .esriCTAlignCenter{text-align: center;}.jimu-widget-ParcelDrafter .esriCTMainPageRow{width: calc(100% - 40px); margin: 20px 20px 20px 20px; display: inline-block;}.jimu-widget-ParcelDrafter .esriCTButtonLabel{float: left; width: calc(100% - 45px); line-height: 35px; padding: 5px 5px 5px 0;}.jimu-widget-ParcelDrafter .esriCTEditTraverseButton{background: url(\"../images/edit-traverse.png\") no-repeat;}.jimu-widget-ParcelDrafter .esriCTNewTraverseButton{background: url(\"../images/new-traverse.png\") no-repeat;}.jimu-widget-ParcelDrafter .esriCTNewTraverseActive{background: url(\"../images/new-traverse-selected.png\") no-repeat; background-color: #8e8e8e;}.jimu-widget-ParcelDrafter .esriCTEditTraverseActive{background: url(\"../images/edit-traverse-selected.png\") no-repeat; background-color: #8e8e8e;}.jimu-widget-ParcelDrafter .esriCTButtonIcon{height: 45px; width: 45px; float: right; background-size: 45px;}.jimu-widget-ParcelDrafter .esriCTParcelToolButtonIcon{height: 45px; width: 45px; float: left; background-size: 45px 45px; background-color: #8e8e8e;}.jimu-widget-ParcelDrafter .esriCTDisabledParcelToolButton{background-color: #e8e8e8 !important; cursor: not-allowed;}.esriRtl .jimu-widget-ParcelDrafter .esriCTButtonIcon{float: left;}.jimu-widget-ParcelDrafter .esriCTTraverseTool{float: left; padding: 5px 5px 0 0; width: calc(100% - 20px);}.esriRtl .jimu-widget-ParcelDrafter .esriCTTraverseTool{float: right; padding: 5px 0 0 5px;}.jimu-widget-ParcelDrafter .esriCTTraverseToolContainer{float: right;}.esriRtl .jimu-widget-ParcelDrafter .esriCTTraverseToolContainer {float: left;}.jimu-widget-ParcelDrafter .esriCTTraverseToolIcons{height: 24px; width: 24px; background-size: 24px; float: left; background-repeat: no-repeat; margin: 5px 0px 5px 20px;}.esriRtl .jimu-widget-ParcelDrafter .esriCTTraverseToolIcons{float: right; margin: 5px 20px 5px 0px;}.jimu-widget-ParcelDrafter .ecriCTLocationIcon{background-image: url('../images/digitization.png');}.jimu-widget-ParcelDrafter .ecriCTUpdateRotationPointIcon{background-image: url('../images/update-rotation.png');}.jimu-widget-ParcelDrafter .ecriCTLocationIcon.esriCTEnableButton{background-image: url('../images/digitization-selected.png'); background-color: #8e8e8e;}.jimu-widget-ParcelDrafter .ecriCTUpdateRotationPointIcon.esriCTEnableButton{background-image: url('../images/update-rotation-selected.png'); background-color: #8e8e8e;}.jimu-widget-ParcelDrafter .ecriCTZoomToIcon{background-image: url('../images/zoom.png');}.jimu-widget-ParcelDrafter .esriCTCollapse{background-image: url('../images/collapse.png');}.jimu-widget-ParcelDrafter .esriCTExpand{background-image: url('../images/expand.png');}.jimu-widget-ParcelDrafter .esriCTNewTraverseHeader{float: left; height: 30px; border-bottom: 1px solid #464646; padding: 0px 10px;}.jimu-widget-ParcelDrafter .esriCTPlanSettingsIcon{background-image: url('../images/settings.png'); height: 20px; width: 20px; background-size: 20px; float: right; background-repeat: no-repeat;}.jimu-widget-ParcelDrafter .esriCTTraverseDetailContainer{float: left; border-top: 1px solid #464646; border-bottom: 1px solid #464646; margin-top: 20px; background-color: #E4E4ED;}.jimu-widget-ParcelDrafter .esriCTMiscloseHeaderDiv{background-color: rgba(0,0,0,0.5);}.jimu-widget-ParcelDrafter .esriCTTraverseResultContainer{width: 100%; height: 25px; line-height: 25px; padding: 0 10px; float: left; text-align: left;}.esriRtl .jimu-widget-ParcelDrafter .esriCTTraverseResultContainer{text-align: right;}.jimu-widget-ParcelDrafter .esriCTParcelLayerContainer {width: calc(100% - 40px); height: 40px; line-height: 40px; padding: 0 10px; float: left; text-align: left;}.esriRtl .jimu-widget-ParcelDrafter .esriCTParcelLayerContainer {text-align: right; float: right;}.jimu-widget-ParcelDrafter .esriCTExpandCollapseParceLayer {background-image: url(../images/right-arrow.png); height: 40px; width: 40px; line-height: 40px; float: right; background-repeat: no-repeat; transform: rotate(90deg); background-position: center center; cursor: pointer;}.jimu-widget-ParcelDrafter .esriCTCollapsedParceLayer {transform: rotate(-90deg);}.jimu-widget-ParcelDrafter .esriCTParcelLayerParent {width: 100%; height: 40px; border-top: 1px solid #464646; border-bottom: 1px solid #464646;}.jimu-widget-ParcelDrafter .esriCTParcelAttributeList {margin: 5px;}.jimu-widget-ParcelDrafter .esriCTGridEmptyLabel {width: 50px; float: left; text-align: left;}.jimu-widget-ParcelDrafter .esriCTGridLabels{width: 70px; float: left; text-align: left; padding-left: 4px;}.jimu-widget-ParcelDrafter .esriCTGridBearingLabel{width: calc(100% - 210px);}.esriRtl .jimu-widget-ParcelDrafter .esriCTGridEmptyLabel{float: right; text-align: right;}.esriRtl .jimu-widget-ParcelDrafter .esriCTGridLabels{float: right; text-align: right; padding-right: 4px; padding-left: 0px;}.jimu-widget-ParcelDrafter .dijitTextBox .dijitInputInner{height: 21px;}.jimu-widget-ParcelDrafter .dijitTextBoxFocused .dijitInputContainer{background: transparent;}.jimu-widget-ParcelDrafter .esriCTTraverseResultsDiv{max-width: 45%; float: left; padding-right: 5px;}.jimu-widget-ParcelDrafter .esriCTTraversedValueDiv{font-weight: bold;}.jimu-widget-ParcelDrafter .esriCTNewTraverseGrid{height: calc(100% - 40px); overflow: auto;}.jimu-widget-ParcelDrafter .esriCTNewTraverseContainer{padding: 10px; width: 100%; display: inline-block;}.jimu-widget-ParcelDrafter .esriCTNewTraverseLabelDiv{display: inline-block; width: 100%;}.jimu-widget-ParcelDrafter .esriCTTraverseGrid{width: 100%; display: table; border-collapse: collapse;}.jimu-widget-ParcelDrafter .esriCTHidden{display: none !important;}::-ms-clear{display: none;}.jimu-widget-ParcelDrafter .esriCTRotationButton{background-image: url('../images/scale-rotation-active.png');}.jimu-widget-ParcelDrafter .esriCTScaleButton{background-image: url('../images/scale-active.png');}.jimu-widget-ParcelDrafter .esriCTDisableButton .esriCTParcelToolButtonIcon{background-color: inherit;}.jimu-widget-ParcelDrafter .esriCTDisableButton .esriCTRotationButton{background-image: url('../images/scale-rotation.png');}.jimu-widget-ParcelDrafter .esriCTDisableButton .esriCTScaleButton{background-image: url('../images/scale.png');}.jimu-widget-ParcelDrafter .esriCTParcelToolButtonLabel{float: left; max-width: calc(100% - 145px); line-height: 35px; padding: 5px 20px;}.jimu-widget-ParcelDrafter .esriCTParcelToolInputNode{width: 100px; height: 25px; margin-top: 10px; float: right;}.esriRtl .jimu-widget-ParcelDrafter .esriCTParcelToolButtonIcon{float: right;}.esriRtl .jimu-widget-ParcelDrafter .esriCTParcelToolInputNode{float: left;}.esriRtl .jimu-widget-ParcelDrafter .esriCTParcelToolButtonLabel{float: right;}.jimu-widget-ParcelDrafter .esriCTPlanInfoNode{margin: 0 4px; display: inline-block; width: calc(100% - 8px)}.jimu-widget-ParcelDrafter .esriCTPlanInfoButton{width: 80px; margin-top: 10px;}.jimu-widget-ParcelDrafter .esriCTPlanSettingsNode{width: 100%; height: calc(100% - 30px); display: inline-block; overflow-y: auto;}.jimu-widget-ParcelDrafter .esriCTPlanSettingsContainer{margin: 20px; display: inline-block; width: calc(100% - 40px);}.jimu-widget-ParcelDrafter .esriCTPlanSettingRow{padding-bottom: 20px;}.jimu-widget-ParcelDrafter .esriCTDropdownLabel{padding-bottom: 5px;}.jimu-widget-ParcelDrafter .esriCTPlanSettingHeader{float: left; height: 30px; border-bottom: 1px solid #464646; padding: 0px 10px;}.jimu-widget-ParcelDrafter .esriCTBackButton{width: 25%;}.jimu-widget-ParcelDrafter .esriCTTitleDiv{line-height: 10px; font-weight: bold; text-align: center; width: calc(100% - 50px); padding: 5px; display: inline-block;}.jimu-widget-ParcelDrafter .esriCTItemLeftArrow{background-image: url('../images/left-arrow.png'); float: left; margin: 0px 5px 0px 0px; width: 15px; height: 20px; background-repeat: no-repeat; background-position: center center;}.jimu-widget-ParcelDrafter .dijitSelect .dijitButtonContents{border-style: none none none none; background-color: #fafafc;}.jimu-widget-ParcelDrafter .dijitSelect .dijitButtonContentsDartTheme {background-color: inherit;}.jimu-widget-ParcelDrafter .dijitSelect .dijitArrowButton{background-color: #fafafc; background-image: none; border-color: #fafafc;}.jimu-widget-ParcelDrafter .dijitSelect .dijitArrowButtonDartTheme {background-color: rgba(0, 0, 0, 0.5) !important;}.jimu-widget-ParcelDrafter .dijitMenuItem{color: #7989a0;}.jimu-widget-ParcelDrafter .dijitSelect .dijitInputField{margin-right: 8px;}input[type\x3dtext]::-ms-clear{display: none;}.jimu-widget-ParcelDrafter .esriCTRow {clear: both; display: table-row; width: 100%;}.jimu-widget-ParcelDrafter .esriCTNewTraverseGrid{float: left; width: 100%; position: relative; text-align: center; margin: 10px 0px;}.jimu-widget-ParcelDrafter .dijitTextBox .dijitPlaceHolder{font-size: 12px;}.jimu-widget-ParcelDrafter .esriCTRow .dijitTextBox{margin: 0; width: 70px; display: table-cell;}.jimu-widget-ParcelDrafter .dijitTextBoxError {border-color: #d9dde0 !important; box-shadow: inset 0 0 0 2px #d46464;}.jimu-widget-ParcelDrafter .esriCTRow .dijitTextBoxHover{border-color: #d9dde0;}.jimu-widget-ParcelDrafter .esriCTRow .dijitTextBoxFocused{border-color: #d9dde0 !important; box-shadow: none; outline: none;}.jimu-widget-ParcelDrafter .esriCTBearingRow{width: calc(100% - 210px) !important;}.jimu-widget-ParcelDrafter .dojoDndItemAfter .esriCTSymbolContainer, .jimu-widget-ParcelDrafter .dojoDndItemBefore .esriCTSymbolContainer{background: #E4E4ED !important;}.jimu-widget-ParcelDrafter .dojoDndItem, .jimu-widget-demo .dojoDndItemAnchor, .jimu-widget-demo .dojoDndItemSelected, .dojoDndContainerOver, .dojoDndItemOver{background: none; border: none; padding: 0; cursor: move;}.jimu-widget-ParcelDrafter .esriCTDeleteRow, .jimu-widget-ParcelDrafter .esriCTAddRow{color: #CCC; display: table-cell; vertical-align: middle; font-size: 18px; width: 15px;}.jimu-widget-ParcelDrafter .esriCTDeleteIcon, .jimu-widget-ParcelDrafter .esriCTAddIcon{cursor: pointer; height: 30px; width: 15px; margin-left: 5px;}.esriRtl .jimu-widget-ParcelDrafter .esriCTDeleteIcon,.esriRtl .jimu-widget-ParcelDrafter .esriCTAddIcon{margin-right: 5px; margin-left: 0;}.jimu-widget-ParcelDrafter .esriCTDeleteIcon{background: url('../images/delete.png') no-repeat center center;}.jimu-widget-ParcelDrafter .esriCTAddIcon{background: url('../images/add.png') no-repeat center center;}.jimu-widget-ParcelDrafter .esriCTEntryNodeContainer{float: left; width: 100%;}.jimu-widget-ParcelDrafter .esriCTEntrtyNodeContent{width: 100%; display: table; border-collapse: collapse;}.esriCTSymbolContainer{border: 1px solid #dedede; width: 50px; height: 30px; padding: 0px 5px; vertical-align: middle; display: table-cell;}.esriCTSymbolPopup .dijitTooltipContainer{padding: 0px;}.esriCTSymbolListContainer{max-height: 150px; overflow: auto; margin: 6px 0px; width: 170px;}.esriCTSymbolListContent{margin: 0px 6px;}.esriCTSelectedSymbol{width: 30px; height: 25px; overflow: hidden; margin-top: 4px; cursor: pointer;}.esriCTSymbolIcon{width: 35px; vertical-align: middle; margin: 2px 3px 0px 3px; overflow: hidden; display: inline-block;}.esriCTSymbolOption{height: 25px; width: 100%; cursor: pointer; margin-top: 1px; margin-bottom: 1px;}.esriCTSymbolOption:hover{background-color: #edf2f5;}.esriCTSymbolName{display: inline-block; white-space: nowrap; margin-left: 5px; overflow: hidden; text-overflow: ellipsis; width: 95px; color: #7989a0; vertical-align: middle;}.esriRtl .jimu-widget-ParcelDrafter .esriCTButtonLabel{float: right; padding: 5px 0px 5px 5px;}.esriRtl .jimu-widget-ParcelDrafter .esriCTItemLeftArrow{float: right; margin: 0px 0px 00px 10px;}.esriRtl .jimu-widget-ParcelDrafter .esriCTPlanSettingsIcon{float: left;}.esriRtl .jimu-widget-ParcelDrafter .esriCTItemLeftArrow{background-image: url('../images/right-arrow.png');}.esriRtl .jimu-widget-ParcelDrafter .esriCTTraverseResultsDiv{float: right;}.esriRtl .jimu-widget-ParcelDrafter .dijitSelect .dijitInputField{margin-left: 8px; margin-right: 0;}.jimu-widget-ParcelDrafter .esriCTEditParcelDialog{position: absolute; width: 250px; z-index:100;}.jimu-widget-ParcelDrafter .esriCTParcelInfoPopup{display: table; border-collapse: collapse; width: 100%;}.jimu-widget-ParcelDrafter .esriCTParcelInfoLabels{height: 20px; display: table-cell; text-align: center; text-overflow: ellipsis; overflow: hidden; word-wrap: nowrap; margin-right: 5px;}.jimu-widget-ParcelDrafter .esriCTLabelRows{display: table-row;}.jimu-widget-ParcelDrafter .esriCTParcelInfoPopup .esriCTRowContainer{display: table-row;}.jimu-widget-ParcelDrafter .jimu-widget-ParcelDrafter-XYInput .xyRowWrapper {margin: 5px;}.jimu-widget-ParcelDrafter .atiButton, .jimu-widget-ParcelDrafter .esriCTAttributeInspectorContainer .atiLayerName {display: none;}.jimu-widget-ParcelDrafter .esriCTAttributeInspectorContainer .atiButtons {display: none;}.jimu-widget-ParcelDrafter .esriCTAttributeInspectorContainer td {display: block; clear: both; height: auto; width: 100%; float: left;}.jimu-widget-ParcelDrafter .esriCTAttributeInspectorContainer table {width: 100%;}.jimu-widget-ParcelDrafter .esriCTAttributeInspectorContainer .atiField {width: 100%;}.jimu-widget-ParcelDrafter .esriCTAttributeInspectorContainer .atiLabel {margin-top: 6px !important; margin-bottom: 3px !important; text-align: left;}.jimu-rtl .jimu-widget-ParcelDrafter .esriCTAttributeInspectorContainer .atiLabel {text-align: right;}.jimu-widget-ParcelDrafter .esriCTAttributeInspectorContainer .dijitTextBox {width: 100% !important;}.jimu-widget-ParcelDrafter .esriCTAttributeInspectorContainer .dijitTextArea {width: 100% !important; min-height: 70px; resize: vertical; overflow: auto; font-family: inherit; line-height: 20px !important; font-size: 14px;}.jimu-widget-ParcelDrafter .atiAttributes {height: 100%; padding-right: 2px;}.jimu-rtl .jimu-widget-ParcelDrafter .atiAttributes {padding-right: 0px; padding-left: 2px;}.jimu-widget-ParcelDrafter .esriCTCompassRuleAppliedHintContainer {display: inline-block; line-height: 25px; width: 10%;}.jimu-widget-ParcelDrafter .esriCTCompassRuleAppliedHintIcon {background: url(../images/warning.png) center center no-repeat; background-size: 18px 18px; height: 20px; width: 30px; float: left; cursor: pointer; padding-right: 5px;}.esriRtl .jimu-widget-ParcelDrafter .esriCTCompassRuleAppliedHintIcon {float: right; padding-left: 5px;}.LaunchpadTheme .jimu-widget-ParcelDrafter .dijitTextBox .dijitInputField .dijitPlaceHolder {padding: 0; margin-top: 5px;}.LaunchpadTheme .jimu-widget-ParcelDrafter .esriCTAttributeInspectorContainer .esriAttributeInspector .dijitComboBox\x3ediv.dijitArrowButton.dijitDownArrowButton{height: 30px;}",
"*now":function(E){E(['dojo/i18n!*preload*widgets/ParcelDrafter/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare jimu/BaseWidget dojo/_base/array dojo/_base/lang dojo/dom-class dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/on ./PlanSettings ./XYInput ./NewTraverse ./MapTooltipHandler ./layerUtils esri/tasks/GeometryService jimu/dijit/Message jimu/dijit/LoadingIndicator esri/tasks/query esri/geometry/Extent esri/request jimu/utils dijit/focus dojo/keys".split(" "),function(E,d,h,l,m,f,n,e,v,B,w,k,p,M,z,r,t,A,N,I,P,S,Q){return E([d],{baseClass:"jimu-widget-ParcelDrafter",_prevOpenPanel:"mainPage",
_newTraverseInstance:null,_planSettingsInstance:null,_mapTooltipHandler:null,_startPoint:null,geometryService:null,_lineLayerSpatialReference:null,_polygonLayerSpatialReference:null,_isUpdateStartPoint:null,_featureReductionEnabledLayers:[],postMixInProperties:function(){this.nls.common={};l.mixin(this.nls.common,window.jimuNls.common)},postCreate:function(){this.inherited(arguments);this.openAtStartAysn=!0;if(this.appConfig.geometryService){this.geometryService=new z(this.appConfig.geometryService);
if(!this._isValidConfig())return this._showErrorInWidgetPanel(this.nls.invalidConfigMsg),!1;this._layerUtils=new M({map:this.map,getPopupInfo:!0,getRenderer:!1});l.mixin(this.config.polylineLayer,this._layerUtils.getLayerDetailsFromMap(this.config.polylineLayer.baseURL,this.config.polylineLayer.layerId,this.config.polylineLayer.id));l.mixin(this.config.polygonLayer,this._layerUtils.getLayerDetailsFromMap(this.config.polygonLayer.baseURL,this.config.polygonLayer.layerId,this.config.polygonLayer.id));
this._initLoading();this._getSpatialReferenceOfParcelLayers();this._setFirstLastNodeInWidget()}else this._showErrorInWidgetPanel(this.nls.geometryServiceURLNotFoundMSG)},startup:function(){this.inherited(arguments);m.add(this.domNode.parentElement,"esriCTOverridePanelStyle");this._featureReductionEnabledLayers=[];h.forEach(this.config.snappingLayers,function(F){F=this.map.getLayer(F.id);F.isFeatureReductionEnabled&&F.isFeatureReductionEnabled()&&this._featureReductionEnabledLayers.push(F)},this)},
onOpen:function(){this._mapTooltipHandler&&"mainPage"!==this._prevOpenPanel&&(this._isUpdateStartPoint=!0,this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForUpdateStartPoint),this._toggleSnapping(!0));P.isAutoFocusFirstNodeWidget(this)&&P.focusFirstFocusNode(this.domNode)},onActive:function(){h.forEach(this._featureReductionEnabledLayers,function(F){F.disableFeatureReduction()})},onDeActive:function(){h.forEach(this._featureReductionEnabledLayers,function(F){F.enableFeatureReduction()})},
onClose:function(){if("planSettingsPage"===this._prevOpenPanel)this._planSettingsInstance.onClose();this._mapTooltipHandler&&(this._toggleSnapping(!1),this._mapTooltipHandler.disconnectEventHandler(),m.replace(this.newTraverseButton,"esriCTNewTraverseButton","esriCTNewTraverseActive"),m.replace(this.editTraverseButton,"esriCTEditTraverseButton","esriCTEditTraverseActive"),f.set(this.newTraverseButton,"aria-pressed","false"),f.set(this.editTraverseButton,"aria-pressed","false"),this.newTraverseSelectMessageNode.innerHTML=
"",m.add(this.newTraverseSelectMessageNodeWrapper,"esriCTHidden"),this._newTraverseInstance.deActivateDigitizationTool(),this._newTraverseInstance.deactivateParcelTools(),this._newTraverseInstance.closePopup())},destroy:function(){h.forEach(this._featureReductionEnabledLayers,function(F){F.enableFeatureReduction()});this.inherited(arguments)},_initWidgetWorkFlow:function(){this._handleClickEvents();this._createMapTooltipHandler();this._createNewTraverse();this._createPlanSettings();this._createXYInput()},
_isValidConfig:function(){var F=!0;this.config?(this.config.polygonLayer&&this.map.getLayer(this.config.polygonLayer.id)||(F=!1),this.config.polylineLayer&&this.map.getLayer(this.config.polylineLayer.id)||(F=!1)):F=!1;return F},_initLoading:function(){this.loading=new t({hidden:!0});this.loading.placeAt(this.domNode);this.loading.startup()},_getSpatialReferenceOfParcelLayers:function(){var F;this.loading.show();I({url:this.config.polylineLayer.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(l.hitch(this,
function(U){this._lineLayerSpatialReference=U.extent.spatialReference;F=I({url:this.config.polygonLayer.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});F.then(l.hitch(this,function(R){this.loading.hide();this._polygonLayerSpatialReference=R.extent.spatialReference;this._initWidgetWorkFlow()}))}))},_newTraverseButtonClicked:function(){this._mapTooltipHandler.disconnectEventHandler();this._newTraverseInstance.clearAll();m.contains(this.newTraverseButton,"esriCTNewTraverseActive")?
(this._toggleSnapping(!1),m.replace(this.newTraverseButton,"esriCTNewTraverseButton","esriCTNewTraverseActive"),f.set(this.newTraverseButton,"aria-pressed","false"),this.newTraverseSelectMessageNode.innerHTML="",m.add(this.newTraverseSelectMessageNodeWrapper,"esriCTHidden")):(m.replace(this.editTraverseButton,"esriCTEditTraverseButton","esriCTEditTraverseActive"),m.replace(this.newTraverseButton,"esriCTNewTraverseActive","esriCTNewTraverseButton"),f.set(this.newTraverseButton,"aria-pressed","true"),
f.set(this.editTraverseButton,"aria-pressed","false"),this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForStartNewTraverse),this._isUpdateStartPoint=!0,this._toggleSnapping(!0),this.newTraverseSelectMessageNode.innerHTML=this.nls.mapTooltipForStartNewTraverse,m.remove(this.newTraverseSelectMessageNodeWrapper,"esriCTHidden"),this._xyInputInstance.resetXYTextBoxes());this._setFirstLastNodeInWidget()},_editTraverseButtonClicked:function(){this._mapTooltipHandler.disconnectEventHandler();
this._newTraverseInstance.clearAll();m.contains(this.editTraverseButton,"esriCTEditTraverseActive")?(m.replace(this.editTraverseButton,"esriCTEditTraverseButton","esriCTEditTraverseActive"),f.set(this.editTraverseButton,"aria-pressed","false"),this.newTraverseSelectMessageNode.innerHTML="",m.add(this.newTraverseSelectMessageNodeWrapper,"esriCTHidden")):(m.replace(this.newTraverseButton,"esriCTNewTraverseButton","esriCTNewTraverseActive"),m.replace(this.editTraverseButton,"esriCTEditTraverseActive",
"esriCTEditTraverseButton"),f.set(this.editTraverseButton,"aria-pressed","true"),f.set(this.newTraverseButton,"aria-pressed","false"),this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForEditNewTraverse),this.newTraverseSelectMessageNode.innerHTML=this.nls.mapTooltipForEditNewTraverse);this._setFirstLastNodeInWidget()},_handleClickEvents:function(){this.own(v(this.planSettingsButton,"click",l.hitch(this,function(){this._showPanel("planSettingsPage")})));this.own(v(this.planSettingsButton,
"keydown",l.hitch(this,function(F){F.keyCode!==Q.ENTER&&F.keyCode!==Q.SPACE||this._showPanel("planSettingsPage")})));this.own(v(this.newTraverseButton,"click",l.hitch(this,this._newTraverseButtonClicked)));this.own(v(this.newTraverseButton,"keydown",l.hitch(this,function(F){F.keyCode!==Q.ENTER&&F.keyCode!==Q.SPACE||this._newTraverseButtonClicked()})));this.own(v(this.editTraverseButton,"click",l.hitch(this,this._editTraverseButtonClicked)));this.own(v(this.editTraverseButton,"keydown",l.hitch(this,
function(F){F.keyCode!==Q.ENTER&&F.keyCode!==Q.SPACE||this._editTraverseButtonClicked()})));this.own(v(this.planSettingsPanelBackButton,"click",l.hitch(this,function(){this._planSettingsInstance.onClose();this._showPanel("traversePage")})));this.own(v(this.planSettingsPanelBackButton,"keydown",l.hitch(this,function(F){if(F.keyCode===Q.ENTER||F.keyCode===Q.SPACE)this._planSettingsInstance.onClose(),this._showPanel("traversePage"),S.focus(this.planSettingsButton)})));this.own(v(this.traversePanelBackButton,
"click",l.hitch(this,this._confirmCancelTraverse)));this.own(v(this.traversePanelBackButton,"keydown",l.hitch(this,function(F){F.keyCode!==Q.ENTER&&F.keyCode!==Q.SPACE||this._confirmCancelTraverse()})))},_setSnappingLayers:function(){var F=[],U,R;if(this.config.snappingLayers&&this.config.snappingLayers.length)for(R=0;R<this.config.snappingLayers.length;R++)(U=this.map.getLayer(this.config.snappingLayers[R].id))&&F.push({layer:U});this._isUpdateStartPoint||this._newTraverseInstance.parcelPointsGraphicsLayer&&
F.push({layer:this._newTraverseInstance.parcelPointsGraphicsLayer});this.map.snappingManager&&this.map.snappingManager.setLayerInfos(F)},_toggleSnapping:function(F){this.map.snappingManager&&(this.map.snappingManager._deactivateSnapping(),this.map.disableSnapping());F&&!this.map.snappingManager&&(this.map.enableSnapping({tolerance:this.config.snappingTolerance,snapToEdge:!0,snapToPoint:!0,snapToVertex:!0,alwaysSnap:!0}),this._setSnappingLayers(),this.map.snappingManager._setUpSnapping())},_confirmCancelTraverse:function(){this._newTraverseInstance.closePopup();
var F=new r({message:this.nls.clearingDataConfirmationMessage,type:"question",buttons:[{label:this.nls.common.yes,onClick:l.hitch(this,function(){F.close();this._resetOnBackToMainPage(!0)})},{label:this.nls.common.no}]})},_resetOnBackToMainPage:function(F){this._startPoint=null;m.replace(this.newTraverseButton,"esriCTNewTraverseButton","esriCTNewTraverseActive");m.replace(this.editTraverseButton,"esriCTEditTraverseButton","esriCTEditTraverseActive");f.set(this.newTraverseButton,"aria-pressed","false");
f.set(this.editTraverseButton,"aria-pressed","false");this.newTraverseSelectMessageNode.innerHTML="";m.add(this.newTraverseSelectMessageNodeWrapper,"esriCTHidden");this._toggleSnapping(!1);this._mapTooltipHandler.disconnectEventHandler();this._newTraverseInstance.clearAll();this._showPanel("mainPage");F&&S.focus(this.newTraverseButton)},_createMapTooltipHandler:function(){this._mapTooltipHandler=new p({toolTipText:this.nls.mapTooltipForStartNewTraverse,map:this.map});this._isUpdateStartPoint=!0;this.own(this._mapTooltipHandler.on("clicked",
l.hitch(this,function(F){if(this.map&&this.map.snappingManager){var U=this.map.snappingManager.getSnappingPoint(F.screenPoint);U.then(l.hitch(this,function(R){this._onMapPointSelected(R?R:F.mapPoint)}))}else this._onMapPointSelected(F.mapPoint)})));this.own(this._mapTooltipHandler.on("dragging",l.hitch(this,function(F){this._startPoint&&(this._mapTooltipHandler.toolTipText===this.nls.mapTooltipForRotate?this._newTraverseInstance.setRotation(F.mapPoint):this._mapTooltipHandler.toolTipText===this.nls.mapTooltipForScale&&
this._newTraverseInstance.setScaling(F.mapPoint))})));this.own(this._mapTooltipHandler.on("moving",l.hitch(this,function(F){this._mapTooltipHandler.toolTipText===this.nls.mapTooltipForUpdateStartPoint&&this._startPoint&&this._newTraverseInstance._showParcelPopup(F).then(l.hitch(this,function(U){U&&e.set(this._mapTooltipHandler._mapTooltip,"display","none")}))})));this._mapTooltipHandler.startup()},_onMapPointSelected:function(F,U){this._mapTooltipHandler.toolTipText!==this.nls.mapTooltipForUpdatingRotaionPoint&&
(this._mapTooltipHandler.toolTipText===this.nls.mapTooltipForScreenDigitization?this._newTraverseInstance.pointAddedFromDigitization(F):(this._startPoint||(this._mapTooltipHandler.toolTipText===this.nls.mapTooltipForEditNewTraverse?(this._startPoint=F,this._getPolygonForEdits(F)):(f.set(this.traverseTitleNode,"innerHTML",this.nls.newTraverseTitle),f.set(this.traverseTitleNode,"title",this.nls.newTraverseTitle),this._showPanel("traversePage"),S.focus(this.traversePanelBackButton),this._mapTooltipHandler.updateTooltip(this.nls.mapTooltipForUpdateStartPoint))),
this._startPoint=F,this._newTraverseInstance.setStartPoint(this._startPoint,!0,!0,U),S.focus(this.traversePanelBackButton)))},_getPolygonForEdits:function(F,U){this.loading.show();var R=(new Date).getTime();var W=new A;var K=this.map.getLayer(this.config.polygonLayer.id);W.geometry=F;W.outSpatialReference=this.map.spatialReference;W.returnGeometry=!1;W.outFields=["*"];W.where=R+"\x3d"+R;K?K.queryFeatures(U?U:W,l.hitch(this,function(V){this.loading.hide();V&&0<V.features.length?(this._newTraverseInstance.polygonDeleteArr=
[V.features[0]],this._getLinesForEdits(V.features[0])):U?(this._startPoint=null,this._showMessage(this.nls.unableToFetchParcelMessage)):this._getPolygonFromLinesForEdits(F)}),l.hitch(this,function(){this.loading.hide();this._startPoint=null;this._showMessage(this.nls.unableToFetchParcelMessage)})):(this.loading.hide(),this._startPoint=null,this._showMessage(this.nls.unableToFetchParcelMessage))},pointToExtent:function(F,U,R){if(0===R)return U;var W=F.extent.getWidth()/F.width;R*=W;return new N(U.x-
R,U.y-R,U.x+R,U.y+R,F.spatialReference)},_getPolygonFromLinesForEdits:function(F){this.loading.show();var U=(new Date).getTime();var R=new A;var W=this.map.getLayer(this.config.polylineLayer.id);R.geometry=this.pointToExtent(this.map,F,5);R.outSpatialReference=this.map.spatialReference;R.returnGeometry=!1;R.outFields=["*"];R.where=U+"\x3d"+U;W?W.queryFeatures(R,l.hitch(this,function(K){this.loading.hide();if(K&&0<K.features.length&&K.features[0].attributes&&K.features[0].attributes[this.config.polylineLayer.relatedGUID.name]){var V=
new A,y=(new Date).getTime();V.where=y+"\x3d"+y+" and "+this.config.polygonLayer.relatedGUID.name+"\x3d'"+K.features[0].attributes[this.config.polylineLayer.relatedGUID.name]+"'";this._getPolygonForEdits(F,V)}else this._startPoint=null,this._showMessage(this.nls.unableToFetchParcelMessage)}),l.hitch(this,function(){this.loading.hide();this._startPoint=null;this._showMessage(this.nls.unableToFetchParcelMessage)})):(this.loading.hide(),this._startPoint=null,this._showMessage(this.nls.unableToFetchParcelMessage))},
_sortFeatureAccToSequenceID:function(F){var U=this.config.polylineLayer.sequenceId.name;F.sort(function(R,W){return R.attributes[U]-W.attributes[U]});return F},_getLinesForEdits:function(F){this.loading.show();var U=F.attributes[this.config.polygonLayer.relatedGUID.name];F=new A;F.outSpatialReference=this.map.spatialReference;F.returnGeometry=!0;F.outFields=["*"];F.where=this.config.polylineLayer.relatedGUID.name+"\x3d'"+U+"'";(U=this.map.getLayer(this.config.polylineLayer.id))?U.queryFeatures(F,
l.hitch(this,function(R){this.loading.hide();R&&0<R.features.length?(R.features=this._sortFeatureAccToSequenceID(R.features),this._newTraverseInstance.polylineDeleteArr=R.features,this._startPoint=R.features[0].geometry.getPoint(0,0),f.set(this.traverseTitleNode,"innerHTML",this.nls.editTraverseTitle),f.set(this.traverseTitleNode,"title",this.nls.editTraverseTitle),this._newTraverseInstance.initEditing(this._startPoint,R,this._lineLayerSpatialReference),this._toggleSnapping(!0),this._showPanel("traversePage"),
S.focus(this.traversePanelBackButton),this._mapTooltipHandler.updateTooltip(this.nls.mapTooltipForUpdateStartPoint)):(this._startPoint=null,this._showMessage(this.nls.unableToFetchParcelLinesMessage))}),l.hitch(this,function(){this.loading.hide();this._startPoint=null;this._showMessage(this.nls.unableToFetchParcelLinesMessage)})):(this.loading.hide(),this._startPoint=null,this._showMessage(this.nls.unableToFetchParcelLinesMessage))},_createNewTraverse:function(){this._newTraverseInstance=new k({nls:this.nls,
config:this.config,map:this.map,loading:this.loading,geometryService:this.geometryService,appConfig:this.appConfig,lineLayerSpatialReference:this._lineLayerSpatialReference,polygonLayerSpatialReference:this._polygonLayerSpatialReference,widgetDomNode:this.domNode},this.traverseNode);this.own(this._newTraverseInstance.on("showMessage",l.hitch(this,this._showMessage)));this.own(this._newTraverseInstance.on("showParcelSavedAndDeleteMsg",l.hitch(this,this._showParcelSavedAndDeleteMsg)));this.own(this._newTraverseInstance.on("activateDigitizationTool",
l.hitch(this,function(){this._onActivateDigitization()})));this.own(this._newTraverseInstance.on("deActivateDigitizationTool",l.hitch(this,function(){this._onDeactivateDigitization()})));this.own(this._newTraverseInstance.on("activateUpdateRotationPointTool",l.hitch(this,function(){this._onActivateUpdateRotationPoint()})));this.own(this._newTraverseInstance.on("deActivateUpdateRotationPointTool",l.hitch(this,function(){this._onDeactivateUpdateRotationPoint()})));this.own(this._newTraverseInstance.on("cancelTraverse",
l.hitch(this,function(){this._confirmCancelTraverse()})));this.own(this._newTraverseInstance.on("displayMainPageAfterSave",l.hitch(this,function(F){this._resetOnBackToMainPage(F)})));this.own(this._newTraverseInstance.on("toggleRotating",l.hitch(this,function(F){this._toggleRotating(F)})));this.own(this._newTraverseInstance.on("toggleScaling",l.hitch(this,function(F){this._toggleScaling(F)})))},_toggleRotating:function(F){F?(this._mapTooltipHandler.connectMouseDragHandler(this.nls.mapTooltipForRotate),
this._newTraverseInstance.deActivateDigitizationTool(),this._newTraverseInstance.deActivateUpdateRotationPointTool()):(this._isUpdateStartPoint=!0,this._mapTooltipHandler.disconnectEventHandler(),this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForUpdateStartPoint));this._toggleSnapping(!F)},_toggleScaling:function(F){F?(this._mapTooltipHandler.connectMouseDragHandler(this.nls.mapTooltipForScale),this._newTraverseInstance.deActivateDigitizationTool(),this._newTraverseInstance.deActivateUpdateRotationPointTool()):
(this._newTraverseInstance.distance=null,this._isUpdateStartPoint=!0,this._mapTooltipHandler.disconnectEventHandler(),this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForUpdateStartPoint));this._toggleSnapping(!F)},_onActivateDigitization:function(){this._mapTooltipHandler.disconnectEventHandler();this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForScreenDigitization);this._newTraverseInstance.deactivateParcelTools();this._isUpdateStartPoint=!1;this._toggleSnapping(!0)},
_onDeactivateDigitization:function(){this._mapTooltipHandler.updateTooltip(this.nls.mapTooltipForUpdateStartPoint);this._isUpdateStartPoint=!0;this._toggleSnapping(!0)},_onActivateUpdateRotationPoint:function(){this._mapTooltipHandler.disconnectEventHandler();this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForUpdatingRotaionPoint);this._newTraverseInstance.deactivateParcelTools();this._isUpdateStartPoint=!1;this._toggleSnapping(!0)},_onDeactivateUpdateRotationPoint:function(){this._mapTooltipHandler.updateTooltip(this.nls.mapTooltipForUpdateStartPoint);
this._isUpdateStartPoint=!0;this._toggleSnapping(!0)},_createPlanSettings:function(){this._planSettingsInstance=new B({nls:this.nls,config:this.config,appConfig:this.appConfig,widgetId:this.id,widgetDomNode:this.domNode},n.create("div",{},this.planSettingsNode));this.own(this._planSettingsInstance.on("planSettingsChanged",l.hitch(this,function(F){this._newTraverseInstance.updateAccordingToPlanSettings(F)})));this._planSettingsInstance.startup()},_createXYInput:function(){this._xyInputInstance=(new w({nls:this.nls,
config:this.config,appConfig:this.appConfig,map:this.map,widgetDomNode:this.domNode})).placeAt(this.newTraverseSelectMessageNodeWrapper,"last");this.own(this._xyInputInstance.on("newPoint",l.hitch(this,function(F){this._onMapPointSelected(F,!0)})));this._xyInputInstance.startup()},_showPanel:function(F){if(this._prevOpenPanel){var U=this._getNodeByName(this._prevOpenPanel);m.add(U,"esriCTHidden")}U=this._getNodeByName(F);m.remove(U,"esriCTHidden");this._prevOpenPanel=F;setTimeout(l.hitch(this,function(){this._setFirstLastNodeInWidget()}),
100)},_showMessage:function(F){(new r({message:F,buttons:[{label:this.nls.common.ok}]})).message=F},_showErrorInWidgetPanel:function(F){f.set(this.widgetErrorNode,"innerHTML",F);m.add(this.widgetMainNode,"esriCTHidden");m.remove(this.widgetErrorNode,"esriCTHidden")},_getNodeByName:function(F){switch(F){case "mainPage":var U=this.mainPageNode;break;case "traversePage":U=this.traversePageNode;break;case "planSettingsPage":U=this.planSettingsPageNode}return U},_setFirstLastNodeInWidget:function(){!m.contains(this.mainPageNode,
"esriCTHidden")&&m.contains(this.newTraverseSelectMessageNodeWrapper,"esriCTHidden")?(P.initFirstFocusNode(this.domNode,this.newTraverseButton),P.initLastFocusNode(this.domNode,this.editTraverseButton)):m.contains(this.mainPageNode,"esriCTHidden")||m.contains(this.newTraverseSelectMessageNodeWrapper,"esriCTHidden")?m.contains(this.traversePageNode,"esriCTHidden")?m.contains(this.planSettingsPageNode,"esriCTHidden")||(P.initFirstFocusNode(this.domNode,this.planSettingsPanelBackButton),S.focus(this.planSettingsPanelBackButton),
this._planSettingsInstance.updateLastNodeInPlanSetting()):(P.initFirstFocusNode(this.domNode,this.traversePanelBackButton),this._newTraverseInstance.updateLastNodeInTraversePanel()):(P.initFirstFocusNode(this.domNode,this.newTraverseButton),this._xyInputInstance._updateLastFocusNode())},_showParcelSavedAndDeleteMsg:function(F){var U=new r({message:F,buttons:[{label:this.nls.common.ok,onClick:l.hitch(this,function(){U.close();setTimeout(l.hitch(this,function(){S.focus(this.newTraverseButton)}),100)})}]});
U.message=F}})});